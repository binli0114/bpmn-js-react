{"version":3,"file":"bpmn-js-react.es.js","sources":["../src/hooks/bpmn.hook.ts","../node_modules/.pnpm/react@18.3.1/node_modules/react/cjs/react-jsx-runtime.production.min.js","../node_modules/.pnpm/react@18.3.1/node_modules/react/cjs/react-jsx-runtime.development.js","../node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js","../node_modules/.pnpm/inherits-browser@0.1.0/node_modules/inherits-browser/dist/index.es.js","../node_modules/.pnpm/ids@1.0.5/node_modules/ids/dist/index.esm.js","../node_modules/.pnpm/min-dash@4.2.1/node_modules/min-dash/dist/index.esm.js","../node_modules/.pnpm/min-dom@4.1.0/node_modules/min-dom/dist/index.esm.js","../node_modules/.pnpm/tiny-svg@3.0.1/node_modules/tiny-svg/dist/index.esm.js","../node_modules/.pnpm/didi@10.2.2/node_modules/didi/dist/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/draw/BaseRenderer.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/RenderUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Elements.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/draw/DefaultRenderer.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/draw/Styles.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/draw/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Collections.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Geometry.js","../node_modules/.pnpm/path-intersection@3.1.0/node_modules/path-intersection/intersect.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/ModelUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/layout/LayoutUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/core/Canvas.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/core/ElementRegistry.js","../node_modules/.pnpm/object-refs@0.4.0/node_modules/object-refs/dist/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/model/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/core/ElementFactory.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/core/EventBus.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/GraphicsUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/SvgTransformUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/core/GraphicsFactory.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/core/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/Diagram.js","../node_modules/.pnpm/moddle@6.2.3/node_modules/moddle/dist/index.esm.js","../node_modules/.pnpm/saxen@8.1.2/node_modules/saxen/dist/index.esm.js","../node_modules/.pnpm/moddle-xml@10.1.0/node_modules/moddle-xml/dist/index.esm.js","../node_modules/.pnpm/bpmn-moddle@8.1.0/node_modules/bpmn-moddle/dist/index.esm.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/import/Util.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/util/CompatibilityUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/import/BpmnTreeWalker.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/util/ModelUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/import/Importer.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/util/PoweredByUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/BaseViewer.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/BaseModeler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/util/DiUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/util/LabelUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/draw/BpmnRenderUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/draw/BpmnRenderer.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Text.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/draw/TextRenderer.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/draw/PathMap.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/draw/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/i18n/translate/translate.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/i18n/translate/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/import/BpmnImporter.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/import/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/core/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/IdGenerator.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/overlays/Overlays.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/overlays/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/change-support/ChangeSupport.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/change-support/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/command/CommandInterceptor.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/root-elements/RootElementsBehavior.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/root-elements/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/EscapeUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/util/DrilldownUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/drilldown/DrilldownBreadcrumbs.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/drilldown/DrilldownCentering.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/drilldown/SubprocessCompatibility.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/drilldown/DrilldownOverlayBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/drilldown/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/outline/Outline.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/outline/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/outline/OutlineUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/outline/OutlineProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/outline/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Event.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Platform.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Mouse.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/interaction-events/InteractionEvents.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/interaction-events/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/selection/Selection.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/selection/SelectionVisuals.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/selection/SelectionBehavior.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/selection/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/Viewer.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/keyboard/KeyboardUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/keyboard/Keyboard.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/keyboard/KeyboardBindings.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/keyboard/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/navigation/keyboard-move/KeyboardMove.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/navigation/keyboard-move/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Cursor.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/ClickTrap.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/PositionUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/navigation/movecanvas/MoveCanvas.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/navigation/movecanvas/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Math.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/navigation/zoomscroll/ZoomUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/navigation/zoomscroll/ZoomScroll.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/navigation/zoomscroll/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/NavigatedViewer.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/align-elements/AlignElements.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/align-elements/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/context-pad/ContextPad.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/context-pad/index.js","../node_modules/.pnpm/preact@10.21.0/node_modules/preact/dist/preact.module.js","../node_modules/.pnpm/htm@3.1.1/node_modules/htm/dist/htm.module.js","../node_modules/.pnpm/htm@3.1.1/node_modules/htm/preact/index.module.js","../node_modules/.pnpm/preact@10.21.0/node_modules/preact/hooks/dist/hooks.module.js","../node_modules/.pnpm/clsx@2.1.1/node_modules/clsx/dist/clsx.mjs","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/popup-menu/PopupMenuItem.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/popup-menu/PopupMenuList.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/popup-menu/PopupMenuComponent.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/popup-menu/PopupMenu.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/popup-menu/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/align-elements/AlignElementsIcons.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/align-elements/AlignElementsContextPadProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/align-elements/AlignElementsMenuProvider.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/rules/RuleProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/align-elements/BpmnAlignElements.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/align-elements/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/auto-place/AutoPlaceUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/auto-place/AutoPlace.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/auto-place/AutoPlaceSelectionBehavior.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/auto-place/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/util/ModelingUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/auto-place/BpmnAutoPlaceUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/auto-place/BpmnAutoPlace.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/auto-place/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/auto-resize/AutoResize.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/auto-resize/BpmnAutoResize.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/auto-resize/AutoResizeProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/auto-resize/BpmnAutoResizeProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/auto-resize/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/hover-fix/HoverFix.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/hover-fix/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/dragging/Dragging.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/dragging/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/auto-scroll/AutoScroll.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/auto-scroll/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/rules/Rules.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/rules/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/LineIntersection.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/bendpoints/GeometricUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/bendpoints/BendpointUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/bendpoints/Bendpoints.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/bendpoints/BendpointMove.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/bendpoints/BendpointMovePreview.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/bendpoints/ConnectionSegmentMove.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/snapping/SnapUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/bendpoints/BendpointSnapping.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/bendpoints/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/connect/Connect.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/connect/ConnectPreview.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/connect/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/connection-preview/ConnectionPreview.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/connection-preview/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/preview-support/PreviewSupport.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/preview-support/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/complex-preview/ComplexPreview.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/complex-preview/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/AdaptiveLabelPositioningBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/AppendBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/AssociationBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/AttachEventBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/BoundaryEventBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/CompensateBoundaryEventBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/CreateBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/CreateDataObjectBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/CreateParticipantBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/DataInputAssociationBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/UpdateSemanticParentHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/DataStoreBehavior.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/resize/ResizeUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/util/LaneUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/DeleteLaneBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/DetachEventBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/DropOnFlowBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/EventBasedGatewayBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/FixHoverBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/util/CategoryUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/GroupBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/util/LineIntersect.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/ImportDockingFix.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/IsHorizontalFix.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/util/LineAttachmentUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/util/LayoutUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/util/LabelLayoutUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/AttachUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/LabelBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/util/ConnectionLayoutUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/LayoutConnectionBehavior.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/MessageFlowBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/util/NonInterruptingUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/NonInterruptingBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/RemoveEmbeddedLabelBoundsBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/RemoveElementBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/RemoveParticipantBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/ReplaceConnectionBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/ReplaceElementBehaviour.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/ResizeBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/ResizeLaneBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/RootElementReferenceBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/SpaceToolBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/SubProcessPlaneBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/SubProcessStartEventBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/TextAnnotationBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/ToggleCollapseConnectionBehaviour.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/ToggleElementCollapseBehaviour.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/UnclaimIdBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/UnsetDefaultFlowBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/UpdateFlowNodeRefsBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/behavior/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/snapping/BpmnSnappingUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/rules/BpmnRules.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/rules/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/di-ordering/BpmnDiOrdering.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/di-ordering/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/ordering/OrderingProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/ordering/BpmnOrderingProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/ordering/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/clipboard/Clipboard.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/clipboard/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/create/Create.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/create/CreatePreview.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/create/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/mouse/Mouse.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/mouse/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/copy-paste/CopyPaste.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/copy-paste/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/copy-paste/BpmnCopyPaste.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/copy-paste/ModdleCopy.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/copy-paste/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/replace/Replace.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/replace/ReplaceSelectionBehavior.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/replace/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/replace/BpmnReplace.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/replace/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/tool-manager/ToolManager.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/tool-manager/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/space-tool/SpaceUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/space-tool/SpaceTool.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/space-tool/SpaceToolPreview.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/space-tool/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/space-tool/BpmnSpaceTool.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/space-tool/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/command/CommandStack.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/command/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/util/Removal.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/label-support/LabelSupport.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/label-support/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/attach-support/AttachSupport.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/attach-support/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/BpmnFactory.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/BpmnUpdater.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/ElementFactory.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/AlignElementsHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/AppendShapeHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/CreateConnectionHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/CreateElementsHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/CreateShapeHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/CreateLabelHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/DeleteConnectionHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/DeleteElementsHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/DeleteShapeHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/DistributeElementsHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/LayoutConnectionHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/MoveConnectionHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/helper/MoveClosure.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/helper/MoveHelper.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/MoveElementsHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/MoveShapeHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/ReconnectConnectionHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/ReplaceShapeHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/ResizeShapeHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/SpaceToolHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/ToggleShapeCollapseHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/UpdateAttachmentHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/cmd/UpdateWaypointsHandler.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/modeling/Modeling.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/UpdateModdlePropertiesHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/UpdatePropertiesHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/UpdateCanvasRootHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/AddLaneHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/SplitLaneHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/ResizeLaneHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/UpdateFlowNodeRefsHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/IdClaimHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/cmd/SetColorHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/label-editing/cmd/UpdateLabelHandler.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/Modeling.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/layout/BaseLayouter.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/layout/ManhattanLayout.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/BpmnLayouter.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/layout/CroppingConnectionDocking.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/append-preview/AppendPreview.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/append-preview/index.js","../node_modules/.pnpm/diagram-js-direct-editing@3.0.1_diagram-js@14.5.3/node_modules/diagram-js-direct-editing/lib/TextBox.js","../node_modules/.pnpm/diagram-js-direct-editing@3.0.1_diagram-js@14.5.3/node_modules/diagram-js-direct-editing/lib/DirectEditing.js","../node_modules/.pnpm/diagram-js-direct-editing@3.0.1_diagram-js@14.5.3/node_modules/diagram-js-direct-editing/lib/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/popup-menu/util/TypeUtil.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/replace/ReplaceOptions.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/popup-menu/util/Icons.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/popup-menu/ReplaceMenuProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/popup-menu/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/context-pad/ContextPadProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/context-pad/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/distribute-elements/DistributeElements.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/distribute-elements/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/distribute-elements/BpmnDistributeElements.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/distribute-elements/DistributeElementsIcons.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/distribute-elements/DistributeElementsMenuProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/distribute-elements/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/editor-actions/EditorActions.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/editor-actions/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/editor-actions/BpmnEditorActions.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/editor-actions/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/grid-snapping/BpmnGridSnapping.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/grid-snapping/GridUtil.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/grid-snapping/GridSnapping.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/grid-snapping/behavior/ResizeBehavior.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/grid-snapping/behavior/SpaceToolBehavior.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/grid-snapping/behavior/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/grid-snapping/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/grid-snapping/behavior/GridSnappingAutoPlaceBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/grid-snapping/behavior/GridSnappingParticipantBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/grid-snapping/behavior/GridSnappingLayoutConnectionBehavior.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/grid-snapping/behavior/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/grid-snapping/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/interaction-events/BpmnInteractionEvents.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/interaction-events/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/keyboard/BpmnKeyboardBindings.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/keyboard/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/keyboard-move-selection/KeyboardMoveSelection.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/keyboard-move-selection/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/resize/Resize.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/resize/ResizePreview.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/resize/ResizeHandles.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/resize/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/label-editing/LabelEditingProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/label-editing/LabelEditingPreview.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/label-editing/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/tooltips/Tooltips.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/tooltips/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling-feedback/ModelingFeedback.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/modeling-feedback/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/move/Move.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/move/MovePreview.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/move/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/palette/Palette.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/palette/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/lasso-tool/LassoTool.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/lasso-tool/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/hand-tool/HandTool.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/hand-tool/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/global-connect/GlobalConnect.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/global-connect/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/palette/PaletteProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/palette/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/replace-preview/BpmnReplacePreview.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/replace-preview/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/snapping/BpmnConnectSnapping.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/snapping/SnapContext.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/snapping/CreateMoveSnapping.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/snapping/BpmnCreateMoveSnapping.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/snapping/ResizeSnapping.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/snapping/Snapping.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/snapping/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/snapping/index.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/search-pad/SearchPad.js","../node_modules/.pnpm/diagram-js@14.5.3/node_modules/diagram-js/lib/features/search-pad/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/search/BpmnSearchProvider.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/features/search/index.js","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/lib/Modeler.js","../src/utils/bpmn.utils.tsx","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/utils/keys/keys.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/utils/deep-merge/deep-merge.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/utils/camel-to-kebab-case/camel-to-kebab-case.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/utils/units-converters/px.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/utils/units-converters/rem.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/utils/filter-props/filter-props.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/utils/is-number-like/is-number-like.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/utils/get-size/get-size.mjs","../node_modules/.pnpm/@mantine+hooks@7.9.0_react@18.3.1/node_modules/@mantine/hooks/esm/use-media-query/use-media-query.mjs","../node_modules/.pnpm/@mantine+hooks@7.9.0_react@18.3.1/node_modules/@mantine/hooks/esm/use-isomorphic-effect/use-isomorphic-effect.mjs","../node_modules/.pnpm/@mantine+hooks@7.9.0_react@18.3.1/node_modules/@mantine/hooks/esm/use-did-update/use-did-update.mjs","../node_modules/.pnpm/@mantine+hooks@7.9.0_react@18.3.1/node_modules/@mantine/hooks/esm/use-reduced-motion/use-reduced-motion.mjs","../node_modules/.pnpm/clsx@2.1.0/node_modules/clsx/dist/clsx.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/resolve-class-names/resolve-class-names.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-style/resolve-styles/resolve-styles.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/Mantine.context.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/to-rgba/to-rgba.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/darken/darken.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/get-primary-shade/get-primary-shade.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/luminance/luminance.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/parse-theme-color/parse-theme-color.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/get-theme-color/get-theme-color.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/get-gradient/get-gradient.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/rgba/rgba.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/default-variant-colors-resolver/default-variant-colors-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/default-colors.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/default-theme.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-scheme-managers/is-mantine-color-scheme.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-scheme-managers/local-storage-manager.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/merge-mantine-theme/merge-mantine-theme.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineClasses/MantineClasses.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/convert-css-variables/css-variables-object-to-string.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/convert-css-variables/wrap-with-selector.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/convert-css-variables/convert-css-variables.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/color-functions/get-contrast-color/get-contrast-color.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineCssVariables/get-css-color-variables.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineCssVariables/virtual-color/virtual-color.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineCssVariables/default-css-variables-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineCssVariables/get-merged-variables.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineCssVariables/remove-default-variables.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/suppress-nextjs-warning.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/use-mantine-color-scheme/use-provider-color-scheme.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/use-respect-reduce-motion/use-respect-reduce-motion.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/MantineProvider.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-global-class-names/get-global-class-names.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-options-class-names/get-options-class-names.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-resolved-class-names/get-resolved-class-names.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-root-class-name/get-root-class-name.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-selector-class-name/get-selector-class-name.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-static-class-names/get-static-class-names.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-theme-class-names/get-theme-class-names.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-variant-class-name/get-variant-class-name.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-class-name/get-class-name.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-style/get-theme-styles/get-theme-styles.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-style/resolve-style/resolve-style.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-style/resolve-vars/merge-vars.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-style/resolve-vars/resolve-vars.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/get-style/get-style.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/use-transformed-styles.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/styles-api/use-styles/use-styles.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/MantineProvider/use-props/use-props.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/InlineStyles/css-object-to-string/css-object-to-string.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/InlineStyles/styles-to-string/styles-to-string.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/InlineStyles/InlineStyles.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/extract-style-props/extract-style-props.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/style-props-data.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/resolvers/color-resolver/color-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/resolvers/font-family-resolver/font-family-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/resolvers/font-size-resolver/font-size-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/resolvers/identity-resolver/identity-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/resolvers/line-height-resolver/line-height-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/resolvers/size-resolver/size-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/resolvers/spacing-resolver/spacing-resolver.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/resolvers/index.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/parse-style-props/sort-media-queries.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/style-props/parse-style-props/parse-style-props.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/use-random-classname/use-random-classname.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/get-box-mod/get-box-mod.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/get-box-style/get-box-style.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/Box/Box.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/factory/factory.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/core/factory/polymorphic-factory.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/UnstyledButton/UnstyledButton.module.css.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/UnstyledButton/UnstyledButton.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Transition/transitions.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Transition/get-transition-styles/get-transition-styles.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Transition/use-transition.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Transition/Transition.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Loader/Loader.module.css.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Loader/loaders/Bars.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Loader/loaders/Dots.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Loader/loaders/Oval.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Loader/Loader.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Button/Button.module.css.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Button/ButtonGroup/ButtonGroup.mjs","../node_modules/.pnpm/@mantine+core@7.9.0_@mantine+hooks@7.9.0_react@18.3.1__@types+react@18.3.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@mantine/core/esm/components/Button/Button.mjs","../node_modules/.pnpm/@tabler+icons-react@3.3.0_react@18.3.1/node_modules/@tabler/icons-react/dist/esm/defaultAttributes.mjs","../node_modules/.pnpm/@tabler+icons-react@3.3.0_react@18.3.1/node_modules/@tabler/icons-react/dist/esm/createReactComponent.mjs","../node_modules/.pnpm/@tabler+icons-react@3.3.0_react@18.3.1/node_modules/@tabler/icons-react/dist/esm/icons/IconViewfinder.mjs","../node_modules/.pnpm/@tabler+icons-react@3.3.0_react@18.3.1/node_modules/@tabler/icons-react/dist/esm/icons/IconZoomIn.mjs","../node_modules/.pnpm/@tabler+icons-react@3.3.0_react@18.3.1/node_modules/@tabler/icons-react/dist/esm/icons/IconZoomOut.mjs","../src/components/ZoomActions.tsx","../src/lib/BpmnJsModeler.tsx","../node_modules/.pnpm/bpmn-js@17.6.0/node_modules/bpmn-js/dist/bpmn-navigated-viewer.production.min.js","../src/lib/BpmnJsViewer.tsx","../src/lib/BpmnJsReact.tsx"],"sourcesContent":["import { useState } from \"react\";\n//import BpmnJSModeler from \"bpmn-js/dist/bpmn-modeler.production.min.js\";\n//@ts-ignore\nimport BpmnModeler, { BpmnModeler as IBpmnModeler } from \"bpmn-js/lib/Modeler\";\nimport {\n  ImportXMLResult,\n  ModdleElement,\n  SaveXMLOptions,\n  SaveXMLResult,\n} from \"bpmn-js/lib/BaseViewer\";\n\nexport type BpmnJsReactHook = () => {\n  bpmnModeler: ReturnType<typeof IBpmnModeler>;\n  setBpmnModeler: React.Dispatch<\n    React.SetStateAction<ReturnType<typeof IBpmnModeler>>\n  >;\n  importXml: (\n    xml: string,\n    bpmnDiagram?: ModdleElement | string\n  ) => Promise<ImportXMLResult>;\n  // saveXml: (\n  //   callback: (err: any, xml: string) => void,\n  //   options?: SaveXMLOptions\n  // ) => void;\n  saveXml: (options?: SaveXMLOptions) => Promise<SaveXMLResult>;\n  getElementById: (id: string) => any;\n\n  zoomIn: (step?: number) => void;\n  zoomOut: (step?: number) => void;\n  zoomFit: () => void;\n  setStyle: () => void;\n\n  setColor: (elements: any, color: any) => void;\n  addMarker: (id: string, cssClass: string) => void;\n  removeMarker: (id: string, cssClass: string) => void;\n\n  getCanvas: () => any;\n  getAttribute: (id: string, attr: string) => any;\n  setAttribute: (id: string, attr: string, value: any) => void;\n  getElements: () => any;\n  getBusinessObject: (id: string) => any;\n  getIncoming: (id: string) => any;\n  getOutgoing: (id: string) => any;\n};\n\nexport const useBpmnJsReact: BpmnJsReactHook = () => {\n  const [xml, setXml] = useState<string>(\"\");\n  const [bpmnModeler, setBpmnModeler] =\n    useState<ReturnType<typeof IBpmnModeler>>(null);\n\n  //BASIC\n\n  const getCanvas = () => bpmnModeler?.get(\"canvas\");\n\n  const importXml: (\n    xml: string,\n    bpmnDiagram?: ModdleElement | string\n  ) => Promise<ImportXMLResult> = (xml: string) => {\n    return bpmnModeler?.importXML(xml);\n  };\n\n  // const saveXml = (\n  //   callback: (err: any, xml: string) => void,\n  //   options: SaveXMLOptions = {\n  //     format: false,\n  //   }\n  // ) => {\n  //   // console.log(bpmnModeler);\n  //   bpmnModeler?.saveXML(options, callback);\n  // };\n\n  const saveXml: (options?: SaveXMLOptions) => Promise<SaveXMLResult> = async (\n    options = { format: false }\n  ) => bpmnModeler?.saveXML(options);\n\n  const getElements = () => {\n    return bpmnModeler?.get(\"elementRegistry\").getAll();\n  };\n  const getElementById = (id: string) => {\n    return bpmnModeler?.get(\"elementRegistry\").get(id);\n  };\n  //STYLING\n\n  const zoomIn = (step = 0.1) => {\n    bpmnModeler?.get(\"zoomScroll\")?.zoom(step);\n  };\n  const zoomOut = (step = 0.1) => {\n    bpmnModeler?.get(\"zoomScroll\")?.zoom(-step);\n  };\n  const zoomFit = () => {\n    bpmnModeler?.get(\"zoomScroll\")?.zoom(\"fit-viewport\");\n  };\n  const setStyle = () => {\n    const canvas = bpmnModeler?.get(\"canvas\");\n    canvas?.zoom(\"fit-viewport\");\n  };\n  const addMarker = (id: string, cssClass: string) => {\n    bpmnModeler.get(\"canvas\").addMarker(id, cssClass);\n  };\n  const removeMarker = (id: string, cssClass: string) => {\n    bpmnModeler?.get(\"canvas\").removeMarker(id, cssClass);\n  };\n  const setColor = (elements: any, color: any) => {\n    bpmnModeler.get(\"modeling\").setColor(elements, color);\n  };\n\n  //PROPERTIES\n  const getElementRegistry = () => bpmnModeler?.get(\"elementRegistry\");\n\n  const getBusinessObject = (id: string) => {\n    return getElementRegistry()?.get(id).businessObject;\n  };\n\n  const getAttribute = (id: string, key: string) => {\n    return getBusinessObject(id).$attrs[key];\n  };\n\n  const setAttribute = (id: any, name: string, value: any) => {\n    bpmnModeler\n      .get(\"modeling\")\n      .updateProperties(getElementById(id), { [name]: value });\n  };\n\n  const getIncoming = (id: string) => {\n    return getBusinessObject(id).incoming;\n  };\n\n  const getOutgoing = (id: string) => {\n    return getBusinessObject(id).outgoing;\n  };\n\n  return {\n    bpmnModeler,\n    setBpmnModeler,\n    importXml,\n    saveXml,\n    // saveXmlAsync,\n    getCanvas,\n    getElements,\n    getElementById,\n    getBusinessObject,\n    zoomIn,\n    zoomOut,\n    zoomFit,\n    setStyle,\n    setColor,\n    addMarker,\n    removeMarker,\n    getAttribute,\n    setAttribute,\n    getIncoming,\n    getOutgoing,\n  };\n};\n","/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","/**\n * @license React\n * react-jsx-runtime.development.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nif (process.env.NODE_ENV !== \"production\") {\n  (function() {\n'use strict';\n\nvar React = require('react');\n\n// ATTENTION\n// When adding new symbols to this file,\n// Please consider also adding to 'react-devtools-shared/src/backend/ReactSymbols'\n// The Symbol used to tag the ReactElement-like types.\nvar REACT_ELEMENT_TYPE = Symbol.for('react.element');\nvar REACT_PORTAL_TYPE = Symbol.for('react.portal');\nvar REACT_FRAGMENT_TYPE = Symbol.for('react.fragment');\nvar REACT_STRICT_MODE_TYPE = Symbol.for('react.strict_mode');\nvar REACT_PROFILER_TYPE = Symbol.for('react.profiler');\nvar REACT_PROVIDER_TYPE = Symbol.for('react.provider');\nvar REACT_CONTEXT_TYPE = Symbol.for('react.context');\nvar REACT_FORWARD_REF_TYPE = Symbol.for('react.forward_ref');\nvar REACT_SUSPENSE_TYPE = Symbol.for('react.suspense');\nvar REACT_SUSPENSE_LIST_TYPE = Symbol.for('react.suspense_list');\nvar REACT_MEMO_TYPE = Symbol.for('react.memo');\nvar REACT_LAZY_TYPE = Symbol.for('react.lazy');\nvar REACT_OFFSCREEN_TYPE = Symbol.for('react.offscreen');\nvar MAYBE_ITERATOR_SYMBOL = Symbol.iterator;\nvar FAUX_ITERATOR_SYMBOL = '@@iterator';\nfunction getIteratorFn(maybeIterable) {\n  if (maybeIterable === null || typeof maybeIterable !== 'object') {\n    return null;\n  }\n\n  var maybeIterator = MAYBE_ITERATOR_SYMBOL && maybeIterable[MAYBE_ITERATOR_SYMBOL] || maybeIterable[FAUX_ITERATOR_SYMBOL];\n\n  if (typeof maybeIterator === 'function') {\n    return maybeIterator;\n  }\n\n  return null;\n}\n\nvar ReactSharedInternals = React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n\nfunction error(format) {\n  {\n    {\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n\n      printWarning('error', format, args);\n    }\n  }\n}\n\nfunction printWarning(level, format, args) {\n  // When changing this logic, you might want to also\n  // update consoleWithStackDev.www.js as well.\n  {\n    var ReactDebugCurrentFrame = ReactSharedInternals.ReactDebugCurrentFrame;\n    var stack = ReactDebugCurrentFrame.getStackAddendum();\n\n    if (stack !== '') {\n      format += '%s';\n      args = args.concat([stack]);\n    } // eslint-disable-next-line react-internal/safe-string-coercion\n\n\n    var argsWithFormat = args.map(function (item) {\n      return String(item);\n    }); // Careful: RN currently depends on this prefix\n\n    argsWithFormat.unshift('Warning: ' + format); // We intentionally don't use spread (or .apply) directly because it\n    // breaks IE9: https://github.com/facebook/react/issues/13610\n    // eslint-disable-next-line react-internal/no-production-logging\n\n    Function.prototype.apply.call(console[level], console, argsWithFormat);\n  }\n}\n\n// -----------------------------------------------------------------------------\n\nvar enableScopeAPI = false; // Experimental Create Event Handle API.\nvar enableCacheElement = false;\nvar enableTransitionTracing = false; // No known bugs, but needs performance testing\n\nvar enableLegacyHidden = false; // Enables unstable_avoidThisFallback feature in Fiber\n// stuff. Intended to enable React core members to more easily debug scheduling\n// issues in DEV builds.\n\nvar enableDebugTracing = false; // Track which Fiber(s) schedule render work.\n\nvar REACT_MODULE_REFERENCE;\n\n{\n  REACT_MODULE_REFERENCE = Symbol.for('react.module.reference');\n}\n\nfunction isValidElementType(type) {\n  if (typeof type === 'string' || typeof type === 'function') {\n    return true;\n  } // Note: typeof might be other than 'symbol' or 'number' (e.g. if it's a polyfill).\n\n\n  if (type === REACT_FRAGMENT_TYPE || type === REACT_PROFILER_TYPE || enableDebugTracing  || type === REACT_STRICT_MODE_TYPE || type === REACT_SUSPENSE_TYPE || type === REACT_SUSPENSE_LIST_TYPE || enableLegacyHidden  || type === REACT_OFFSCREEN_TYPE || enableScopeAPI  || enableCacheElement  || enableTransitionTracing ) {\n    return true;\n  }\n\n  if (typeof type === 'object' && type !== null) {\n    if (type.$$typeof === REACT_LAZY_TYPE || type.$$typeof === REACT_MEMO_TYPE || type.$$typeof === REACT_PROVIDER_TYPE || type.$$typeof === REACT_CONTEXT_TYPE || type.$$typeof === REACT_FORWARD_REF_TYPE || // This needs to include all possible module reference object\n    // types supported by any Flight configuration anywhere since\n    // we don't know which Flight build this will end up being used\n    // with.\n    type.$$typeof === REACT_MODULE_REFERENCE || type.getModuleId !== undefined) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction getWrappedName(outerType, innerType, wrapperName) {\n  var displayName = outerType.displayName;\n\n  if (displayName) {\n    return displayName;\n  }\n\n  var functionName = innerType.displayName || innerType.name || '';\n  return functionName !== '' ? wrapperName + \"(\" + functionName + \")\" : wrapperName;\n} // Keep in sync with react-reconciler/getComponentNameFromFiber\n\n\nfunction getContextName(type) {\n  return type.displayName || 'Context';\n} // Note that the reconciler package should generally prefer to use getComponentNameFromFiber() instead.\n\n\nfunction getComponentNameFromType(type) {\n  if (type == null) {\n    // Host root, text node or just invalid type.\n    return null;\n  }\n\n  {\n    if (typeof type.tag === 'number') {\n      error('Received an unexpected object in getComponentNameFromType(). ' + 'This is likely a bug in React. Please file an issue.');\n    }\n  }\n\n  if (typeof type === 'function') {\n    return type.displayName || type.name || null;\n  }\n\n  if (typeof type === 'string') {\n    return type;\n  }\n\n  switch (type) {\n    case REACT_FRAGMENT_TYPE:\n      return 'Fragment';\n\n    case REACT_PORTAL_TYPE:\n      return 'Portal';\n\n    case REACT_PROFILER_TYPE:\n      return 'Profiler';\n\n    case REACT_STRICT_MODE_TYPE:\n      return 'StrictMode';\n\n    case REACT_SUSPENSE_TYPE:\n      return 'Suspense';\n\n    case REACT_SUSPENSE_LIST_TYPE:\n      return 'SuspenseList';\n\n  }\n\n  if (typeof type === 'object') {\n    switch (type.$$typeof) {\n      case REACT_CONTEXT_TYPE:\n        var context = type;\n        return getContextName(context) + '.Consumer';\n\n      case REACT_PROVIDER_TYPE:\n        var provider = type;\n        return getContextName(provider._context) + '.Provider';\n\n      case REACT_FORWARD_REF_TYPE:\n        return getWrappedName(type, type.render, 'ForwardRef');\n\n      case REACT_MEMO_TYPE:\n        var outerName = type.displayName || null;\n\n        if (outerName !== null) {\n          return outerName;\n        }\n\n        return getComponentNameFromType(type.type) || 'Memo';\n\n      case REACT_LAZY_TYPE:\n        {\n          var lazyComponent = type;\n          var payload = lazyComponent._payload;\n          var init = lazyComponent._init;\n\n          try {\n            return getComponentNameFromType(init(payload));\n          } catch (x) {\n            return null;\n          }\n        }\n\n      // eslint-disable-next-line no-fallthrough\n    }\n  }\n\n  return null;\n}\n\nvar assign = Object.assign;\n\n// Helpers to patch console.logs to avoid logging during side-effect free\n// replaying on render function. This currently only patches the object\n// lazily which won't cover if the log function was extracted eagerly.\n// We could also eagerly patch the method.\nvar disabledDepth = 0;\nvar prevLog;\nvar prevInfo;\nvar prevWarn;\nvar prevError;\nvar prevGroup;\nvar prevGroupCollapsed;\nvar prevGroupEnd;\n\nfunction disabledLog() {}\n\ndisabledLog.__reactDisabledLog = true;\nfunction disableLogs() {\n  {\n    if (disabledDepth === 0) {\n      /* eslint-disable react-internal/no-production-logging */\n      prevLog = console.log;\n      prevInfo = console.info;\n      prevWarn = console.warn;\n      prevError = console.error;\n      prevGroup = console.group;\n      prevGroupCollapsed = console.groupCollapsed;\n      prevGroupEnd = console.groupEnd; // https://github.com/facebook/react/issues/19099\n\n      var props = {\n        configurable: true,\n        enumerable: true,\n        value: disabledLog,\n        writable: true\n      }; // $FlowFixMe Flow thinks console is immutable.\n\n      Object.defineProperties(console, {\n        info: props,\n        log: props,\n        warn: props,\n        error: props,\n        group: props,\n        groupCollapsed: props,\n        groupEnd: props\n      });\n      /* eslint-enable react-internal/no-production-logging */\n    }\n\n    disabledDepth++;\n  }\n}\nfunction reenableLogs() {\n  {\n    disabledDepth--;\n\n    if (disabledDepth === 0) {\n      /* eslint-disable react-internal/no-production-logging */\n      var props = {\n        configurable: true,\n        enumerable: true,\n        writable: true\n      }; // $FlowFixMe Flow thinks console is immutable.\n\n      Object.defineProperties(console, {\n        log: assign({}, props, {\n          value: prevLog\n        }),\n        info: assign({}, props, {\n          value: prevInfo\n        }),\n        warn: assign({}, props, {\n          value: prevWarn\n        }),\n        error: assign({}, props, {\n          value: prevError\n        }),\n        group: assign({}, props, {\n          value: prevGroup\n        }),\n        groupCollapsed: assign({}, props, {\n          value: prevGroupCollapsed\n        }),\n        groupEnd: assign({}, props, {\n          value: prevGroupEnd\n        })\n      });\n      /* eslint-enable react-internal/no-production-logging */\n    }\n\n    if (disabledDepth < 0) {\n      error('disabledDepth fell below zero. ' + 'This is a bug in React. Please file an issue.');\n    }\n  }\n}\n\nvar ReactCurrentDispatcher = ReactSharedInternals.ReactCurrentDispatcher;\nvar prefix;\nfunction describeBuiltInComponentFrame(name, source, ownerFn) {\n  {\n    if (prefix === undefined) {\n      // Extract the VM specific prefix used by each line.\n      try {\n        throw Error();\n      } catch (x) {\n        var match = x.stack.trim().match(/\\n( *(at )?)/);\n        prefix = match && match[1] || '';\n      }\n    } // We use the prefix to ensure our stacks line up with native stack frames.\n\n\n    return '\\n' + prefix + name;\n  }\n}\nvar reentry = false;\nvar componentFrameCache;\n\n{\n  var PossiblyWeakMap = typeof WeakMap === 'function' ? WeakMap : Map;\n  componentFrameCache = new PossiblyWeakMap();\n}\n\nfunction describeNativeComponentFrame(fn, construct) {\n  // If something asked for a stack inside a fake render, it should get ignored.\n  if ( !fn || reentry) {\n    return '';\n  }\n\n  {\n    var frame = componentFrameCache.get(fn);\n\n    if (frame !== undefined) {\n      return frame;\n    }\n  }\n\n  var control;\n  reentry = true;\n  var previousPrepareStackTrace = Error.prepareStackTrace; // $FlowFixMe It does accept undefined.\n\n  Error.prepareStackTrace = undefined;\n  var previousDispatcher;\n\n  {\n    previousDispatcher = ReactCurrentDispatcher.current; // Set the dispatcher in DEV because this might be call in the render function\n    // for warnings.\n\n    ReactCurrentDispatcher.current = null;\n    disableLogs();\n  }\n\n  try {\n    // This should throw.\n    if (construct) {\n      // Something should be setting the props in the constructor.\n      var Fake = function () {\n        throw Error();\n      }; // $FlowFixMe\n\n\n      Object.defineProperty(Fake.prototype, 'props', {\n        set: function () {\n          // We use a throwing setter instead of frozen or non-writable props\n          // because that won't throw in a non-strict mode function.\n          throw Error();\n        }\n      });\n\n      if (typeof Reflect === 'object' && Reflect.construct) {\n        // We construct a different control for this case to include any extra\n        // frames added by the construct call.\n        try {\n          Reflect.construct(Fake, []);\n        } catch (x) {\n          control = x;\n        }\n\n        Reflect.construct(fn, [], Fake);\n      } else {\n        try {\n          Fake.call();\n        } catch (x) {\n          control = x;\n        }\n\n        fn.call(Fake.prototype);\n      }\n    } else {\n      try {\n        throw Error();\n      } catch (x) {\n        control = x;\n      }\n\n      fn();\n    }\n  } catch (sample) {\n    // This is inlined manually because closure doesn't do it for us.\n    if (sample && control && typeof sample.stack === 'string') {\n      // This extracts the first frame from the sample that isn't also in the control.\n      // Skipping one frame that we assume is the frame that calls the two.\n      var sampleLines = sample.stack.split('\\n');\n      var controlLines = control.stack.split('\\n');\n      var s = sampleLines.length - 1;\n      var c = controlLines.length - 1;\n\n      while (s >= 1 && c >= 0 && sampleLines[s] !== controlLines[c]) {\n        // We expect at least one stack frame to be shared.\n        // Typically this will be the root most one. However, stack frames may be\n        // cut off due to maximum stack limits. In this case, one maybe cut off\n        // earlier than the other. We assume that the sample is longer or the same\n        // and there for cut off earlier. So we should find the root most frame in\n        // the sample somewhere in the control.\n        c--;\n      }\n\n      for (; s >= 1 && c >= 0; s--, c--) {\n        // Next we find the first one that isn't the same which should be the\n        // frame that called our sample function and the control.\n        if (sampleLines[s] !== controlLines[c]) {\n          // In V8, the first line is describing the message but other VMs don't.\n          // If we're about to return the first line, and the control is also on the same\n          // line, that's a pretty good indicator that our sample threw at same line as\n          // the control. I.e. before we entered the sample frame. So we ignore this result.\n          // This can happen if you passed a class to function component, or non-function.\n          if (s !== 1 || c !== 1) {\n            do {\n              s--;\n              c--; // We may still have similar intermediate frames from the construct call.\n              // The next one that isn't the same should be our match though.\n\n              if (c < 0 || sampleLines[s] !== controlLines[c]) {\n                // V8 adds a \"new\" prefix for native classes. Let's remove it to make it prettier.\n                var _frame = '\\n' + sampleLines[s].replace(' at new ', ' at '); // If our component frame is labeled \"<anonymous>\"\n                // but we have a user-provided \"displayName\"\n                // splice it in to make the stack more readable.\n\n\n                if (fn.displayName && _frame.includes('<anonymous>')) {\n                  _frame = _frame.replace('<anonymous>', fn.displayName);\n                }\n\n                {\n                  if (typeof fn === 'function') {\n                    componentFrameCache.set(fn, _frame);\n                  }\n                } // Return the line we found.\n\n\n                return _frame;\n              }\n            } while (s >= 1 && c >= 0);\n          }\n\n          break;\n        }\n      }\n    }\n  } finally {\n    reentry = false;\n\n    {\n      ReactCurrentDispatcher.current = previousDispatcher;\n      reenableLogs();\n    }\n\n    Error.prepareStackTrace = previousPrepareStackTrace;\n  } // Fallback to just using the name if we couldn't make it throw.\n\n\n  var name = fn ? fn.displayName || fn.name : '';\n  var syntheticFrame = name ? describeBuiltInComponentFrame(name) : '';\n\n  {\n    if (typeof fn === 'function') {\n      componentFrameCache.set(fn, syntheticFrame);\n    }\n  }\n\n  return syntheticFrame;\n}\nfunction describeFunctionComponentFrame(fn, source, ownerFn) {\n  {\n    return describeNativeComponentFrame(fn, false);\n  }\n}\n\nfunction shouldConstruct(Component) {\n  var prototype = Component.prototype;\n  return !!(prototype && prototype.isReactComponent);\n}\n\nfunction describeUnknownElementTypeFrameInDEV(type, source, ownerFn) {\n\n  if (type == null) {\n    return '';\n  }\n\n  if (typeof type === 'function') {\n    {\n      return describeNativeComponentFrame(type, shouldConstruct(type));\n    }\n  }\n\n  if (typeof type === 'string') {\n    return describeBuiltInComponentFrame(type);\n  }\n\n  switch (type) {\n    case REACT_SUSPENSE_TYPE:\n      return describeBuiltInComponentFrame('Suspense');\n\n    case REACT_SUSPENSE_LIST_TYPE:\n      return describeBuiltInComponentFrame('SuspenseList');\n  }\n\n  if (typeof type === 'object') {\n    switch (type.$$typeof) {\n      case REACT_FORWARD_REF_TYPE:\n        return describeFunctionComponentFrame(type.render);\n\n      case REACT_MEMO_TYPE:\n        // Memo may contain any component type so we recursively resolve it.\n        return describeUnknownElementTypeFrameInDEV(type.type, source, ownerFn);\n\n      case REACT_LAZY_TYPE:\n        {\n          var lazyComponent = type;\n          var payload = lazyComponent._payload;\n          var init = lazyComponent._init;\n\n          try {\n            // Lazy may contain any component type so we recursively resolve it.\n            return describeUnknownElementTypeFrameInDEV(init(payload), source, ownerFn);\n          } catch (x) {}\n        }\n    }\n  }\n\n  return '';\n}\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar loggedTypeFailures = {};\nvar ReactDebugCurrentFrame = ReactSharedInternals.ReactDebugCurrentFrame;\n\nfunction setCurrentlyValidatingElement(element) {\n  {\n    if (element) {\n      var owner = element._owner;\n      var stack = describeUnknownElementTypeFrameInDEV(element.type, element._source, owner ? owner.type : null);\n      ReactDebugCurrentFrame.setExtraStackFrame(stack);\n    } else {\n      ReactDebugCurrentFrame.setExtraStackFrame(null);\n    }\n  }\n}\n\nfunction checkPropTypes(typeSpecs, values, location, componentName, element) {\n  {\n    // $FlowFixMe This is okay but Flow doesn't know it.\n    var has = Function.call.bind(hasOwnProperty);\n\n    for (var typeSpecName in typeSpecs) {\n      if (has(typeSpecs, typeSpecName)) {\n        var error$1 = void 0; // Prop type validation may throw. In case they do, we don't want to\n        // fail the render phase where it didn't fail before. So we log it.\n        // After these have been cleaned up, we'll let them throw.\n\n        try {\n          // This is intentionally an invariant that gets caught. It's the same\n          // behavior as without this statement except with a better message.\n          if (typeof typeSpecs[typeSpecName] !== 'function') {\n            // eslint-disable-next-line react-internal/prod-error-codes\n            var err = Error((componentName || 'React class') + ': ' + location + ' type `' + typeSpecName + '` is invalid; ' + 'it must be a function, usually from the `prop-types` package, but received `' + typeof typeSpecs[typeSpecName] + '`.' + 'This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.');\n            err.name = 'Invariant Violation';\n            throw err;\n          }\n\n          error$1 = typeSpecs[typeSpecName](values, typeSpecName, componentName, location, null, 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED');\n        } catch (ex) {\n          error$1 = ex;\n        }\n\n        if (error$1 && !(error$1 instanceof Error)) {\n          setCurrentlyValidatingElement(element);\n\n          error('%s: type specification of %s' + ' `%s` is invalid; the type checker ' + 'function must return `null` or an `Error` but returned a %s. ' + 'You may have forgotten to pass an argument to the type checker ' + 'creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and ' + 'shape all require an argument).', componentName || 'React class', location, typeSpecName, typeof error$1);\n\n          setCurrentlyValidatingElement(null);\n        }\n\n        if (error$1 instanceof Error && !(error$1.message in loggedTypeFailures)) {\n          // Only monitor this failure once because there tends to be a lot of the\n          // same error.\n          loggedTypeFailures[error$1.message] = true;\n          setCurrentlyValidatingElement(element);\n\n          error('Failed %s type: %s', location, error$1.message);\n\n          setCurrentlyValidatingElement(null);\n        }\n      }\n    }\n  }\n}\n\nvar isArrayImpl = Array.isArray; // eslint-disable-next-line no-redeclare\n\nfunction isArray(a) {\n  return isArrayImpl(a);\n}\n\n/*\n * The `'' + value` pattern (used in in perf-sensitive code) throws for Symbol\n * and Temporal.* types. See https://github.com/facebook/react/pull/22064.\n *\n * The functions in this module will throw an easier-to-understand,\n * easier-to-debug exception with a clear errors message message explaining the\n * problem. (Instead of a confusing exception thrown inside the implementation\n * of the `value` object).\n */\n// $FlowFixMe only called in DEV, so void return is not possible.\nfunction typeName(value) {\n  {\n    // toStringTag is needed for namespaced types like Temporal.Instant\n    var hasToStringTag = typeof Symbol === 'function' && Symbol.toStringTag;\n    var type = hasToStringTag && value[Symbol.toStringTag] || value.constructor.name || 'Object';\n    return type;\n  }\n} // $FlowFixMe only called in DEV, so void return is not possible.\n\n\nfunction willCoercionThrow(value) {\n  {\n    try {\n      testStringCoercion(value);\n      return false;\n    } catch (e) {\n      return true;\n    }\n  }\n}\n\nfunction testStringCoercion(value) {\n  // If you ended up here by following an exception call stack, here's what's\n  // happened: you supplied an object or symbol value to React (as a prop, key,\n  // DOM attribute, CSS property, string ref, etc.) and when React tried to\n  // coerce it to a string using `'' + value`, an exception was thrown.\n  //\n  // The most common types that will cause this exception are `Symbol` instances\n  // and Temporal objects like `Temporal.Instant`. But any object that has a\n  // `valueOf` or `[Symbol.toPrimitive]` method that throws will also cause this\n  // exception. (Library authors do this to prevent users from using built-in\n  // numeric operators like `+` or comparison operators like `>=` because custom\n  // methods are needed to perform accurate arithmetic or comparison.)\n  //\n  // To fix the problem, coerce this object or symbol value to a string before\n  // passing it to React. The most reliable way is usually `String(value)`.\n  //\n  // To find which value is throwing, check the browser or debugger console.\n  // Before this exception was thrown, there should be `console.error` output\n  // that shows the type (Symbol, Temporal.PlainDate, etc.) that caused the\n  // problem and how that type was used: key, atrribute, input value prop, etc.\n  // In most cases, this console output also shows the component and its\n  // ancestor components where the exception happened.\n  //\n  // eslint-disable-next-line react-internal/safe-string-coercion\n  return '' + value;\n}\nfunction checkKeyStringCoercion(value) {\n  {\n    if (willCoercionThrow(value)) {\n      error('The provided key is an unsupported type %s.' + ' This value must be coerced to a string before before using it here.', typeName(value));\n\n      return testStringCoercion(value); // throw (to help callers find troubleshooting comments)\n    }\n  }\n}\n\nvar ReactCurrentOwner = ReactSharedInternals.ReactCurrentOwner;\nvar RESERVED_PROPS = {\n  key: true,\n  ref: true,\n  __self: true,\n  __source: true\n};\nvar specialPropKeyWarningShown;\nvar specialPropRefWarningShown;\nvar didWarnAboutStringRefs;\n\n{\n  didWarnAboutStringRefs = {};\n}\n\nfunction hasValidRef(config) {\n  {\n    if (hasOwnProperty.call(config, 'ref')) {\n      var getter = Object.getOwnPropertyDescriptor(config, 'ref').get;\n\n      if (getter && getter.isReactWarning) {\n        return false;\n      }\n    }\n  }\n\n  return config.ref !== undefined;\n}\n\nfunction hasValidKey(config) {\n  {\n    if (hasOwnProperty.call(config, 'key')) {\n      var getter = Object.getOwnPropertyDescriptor(config, 'key').get;\n\n      if (getter && getter.isReactWarning) {\n        return false;\n      }\n    }\n  }\n\n  return config.key !== undefined;\n}\n\nfunction warnIfStringRefCannotBeAutoConverted(config, self) {\n  {\n    if (typeof config.ref === 'string' && ReactCurrentOwner.current && self && ReactCurrentOwner.current.stateNode !== self) {\n      var componentName = getComponentNameFromType(ReactCurrentOwner.current.type);\n\n      if (!didWarnAboutStringRefs[componentName]) {\n        error('Component \"%s\" contains the string ref \"%s\". ' + 'Support for string refs will be removed in a future major release. ' + 'This case cannot be automatically converted to an arrow function. ' + 'We ask you to manually fix this case by using useRef() or createRef() instead. ' + 'Learn more about using refs safely here: ' + 'https://reactjs.org/link/strict-mode-string-ref', getComponentNameFromType(ReactCurrentOwner.current.type), config.ref);\n\n        didWarnAboutStringRefs[componentName] = true;\n      }\n    }\n  }\n}\n\nfunction defineKeyPropWarningGetter(props, displayName) {\n  {\n    var warnAboutAccessingKey = function () {\n      if (!specialPropKeyWarningShown) {\n        specialPropKeyWarningShown = true;\n\n        error('%s: `key` is not a prop. Trying to access it will result ' + 'in `undefined` being returned. If you need to access the same ' + 'value within the child component, you should pass it as a different ' + 'prop. (https://reactjs.org/link/special-props)', displayName);\n      }\n    };\n\n    warnAboutAccessingKey.isReactWarning = true;\n    Object.defineProperty(props, 'key', {\n      get: warnAboutAccessingKey,\n      configurable: true\n    });\n  }\n}\n\nfunction defineRefPropWarningGetter(props, displayName) {\n  {\n    var warnAboutAccessingRef = function () {\n      if (!specialPropRefWarningShown) {\n        specialPropRefWarningShown = true;\n\n        error('%s: `ref` is not a prop. Trying to access it will result ' + 'in `undefined` being returned. If you need to access the same ' + 'value within the child component, you should pass it as a different ' + 'prop. (https://reactjs.org/link/special-props)', displayName);\n      }\n    };\n\n    warnAboutAccessingRef.isReactWarning = true;\n    Object.defineProperty(props, 'ref', {\n      get: warnAboutAccessingRef,\n      configurable: true\n    });\n  }\n}\n/**\n * Factory method to create a new React element. This no longer adheres to\n * the class pattern, so do not use new to call it. Also, instanceof check\n * will not work. Instead test $$typeof field against Symbol.for('react.element') to check\n * if something is a React Element.\n *\n * @param {*} type\n * @param {*} props\n * @param {*} key\n * @param {string|object} ref\n * @param {*} owner\n * @param {*} self A *temporary* helper to detect places where `this` is\n * different from the `owner` when React.createElement is called, so that we\n * can warn. We want to get rid of owner and replace string `ref`s with arrow\n * functions, and as long as `this` and owner are the same, there will be no\n * change in behavior.\n * @param {*} source An annotation object (added by a transpiler or otherwise)\n * indicating filename, line number, and/or other information.\n * @internal\n */\n\n\nvar ReactElement = function (type, key, ref, self, source, owner, props) {\n  var element = {\n    // This tag allows us to uniquely identify this as a React Element\n    $$typeof: REACT_ELEMENT_TYPE,\n    // Built-in properties that belong on the element\n    type: type,\n    key: key,\n    ref: ref,\n    props: props,\n    // Record the component responsible for creating this element.\n    _owner: owner\n  };\n\n  {\n    // The validation flag is currently mutative. We put it on\n    // an external backing store so that we can freeze the whole object.\n    // This can be replaced with a WeakMap once they are implemented in\n    // commonly used development environments.\n    element._store = {}; // To make comparing ReactElements easier for testing purposes, we make\n    // the validation flag non-enumerable (where possible, which should\n    // include every environment we run tests in), so the test framework\n    // ignores it.\n\n    Object.defineProperty(element._store, 'validated', {\n      configurable: false,\n      enumerable: false,\n      writable: true,\n      value: false\n    }); // self and source are DEV only properties.\n\n    Object.defineProperty(element, '_self', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: self\n    }); // Two elements created in two different places should be considered\n    // equal for testing purposes and therefore we hide it from enumeration.\n\n    Object.defineProperty(element, '_source', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: source\n    });\n\n    if (Object.freeze) {\n      Object.freeze(element.props);\n      Object.freeze(element);\n    }\n  }\n\n  return element;\n};\n/**\n * https://github.com/reactjs/rfcs/pull/107\n * @param {*} type\n * @param {object} props\n * @param {string} key\n */\n\nfunction jsxDEV(type, config, maybeKey, source, self) {\n  {\n    var propName; // Reserved names are extracted\n\n    var props = {};\n    var key = null;\n    var ref = null; // Currently, key can be spread in as a prop. This causes a potential\n    // issue if key is also explicitly declared (ie. <div {...props} key=\"Hi\" />\n    // or <div key=\"Hi\" {...props} /> ). We want to deprecate key spread,\n    // but as an intermediary step, we will use jsxDEV for everything except\n    // <div {...props} key=\"Hi\" />, because we aren't currently able to tell if\n    // key is explicitly declared to be undefined or not.\n\n    if (maybeKey !== undefined) {\n      {\n        checkKeyStringCoercion(maybeKey);\n      }\n\n      key = '' + maybeKey;\n    }\n\n    if (hasValidKey(config)) {\n      {\n        checkKeyStringCoercion(config.key);\n      }\n\n      key = '' + config.key;\n    }\n\n    if (hasValidRef(config)) {\n      ref = config.ref;\n      warnIfStringRefCannotBeAutoConverted(config, self);\n    } // Remaining properties are added to a new props object\n\n\n    for (propName in config) {\n      if (hasOwnProperty.call(config, propName) && !RESERVED_PROPS.hasOwnProperty(propName)) {\n        props[propName] = config[propName];\n      }\n    } // Resolve default props\n\n\n    if (type && type.defaultProps) {\n      var defaultProps = type.defaultProps;\n\n      for (propName in defaultProps) {\n        if (props[propName] === undefined) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    }\n\n    if (key || ref) {\n      var displayName = typeof type === 'function' ? type.displayName || type.name || 'Unknown' : type;\n\n      if (key) {\n        defineKeyPropWarningGetter(props, displayName);\n      }\n\n      if (ref) {\n        defineRefPropWarningGetter(props, displayName);\n      }\n    }\n\n    return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);\n  }\n}\n\nvar ReactCurrentOwner$1 = ReactSharedInternals.ReactCurrentOwner;\nvar ReactDebugCurrentFrame$1 = ReactSharedInternals.ReactDebugCurrentFrame;\n\nfunction setCurrentlyValidatingElement$1(element) {\n  {\n    if (element) {\n      var owner = element._owner;\n      var stack = describeUnknownElementTypeFrameInDEV(element.type, element._source, owner ? owner.type : null);\n      ReactDebugCurrentFrame$1.setExtraStackFrame(stack);\n    } else {\n      ReactDebugCurrentFrame$1.setExtraStackFrame(null);\n    }\n  }\n}\n\nvar propTypesMisspellWarningShown;\n\n{\n  propTypesMisspellWarningShown = false;\n}\n/**\n * Verifies the object is a ReactElement.\n * See https://reactjs.org/docs/react-api.html#isvalidelement\n * @param {?object} object\n * @return {boolean} True if `object` is a ReactElement.\n * @final\n */\n\n\nfunction isValidElement(object) {\n  {\n    return typeof object === 'object' && object !== null && object.$$typeof === REACT_ELEMENT_TYPE;\n  }\n}\n\nfunction getDeclarationErrorAddendum() {\n  {\n    if (ReactCurrentOwner$1.current) {\n      var name = getComponentNameFromType(ReactCurrentOwner$1.current.type);\n\n      if (name) {\n        return '\\n\\nCheck the render method of `' + name + '`.';\n      }\n    }\n\n    return '';\n  }\n}\n\nfunction getSourceInfoErrorAddendum(source) {\n  {\n    if (source !== undefined) {\n      var fileName = source.fileName.replace(/^.*[\\\\\\/]/, '');\n      var lineNumber = source.lineNumber;\n      return '\\n\\nCheck your code at ' + fileName + ':' + lineNumber + '.';\n    }\n\n    return '';\n  }\n}\n/**\n * Warn if there's no key explicitly set on dynamic arrays of children or\n * object keys are not valid. This allows us to keep track of children between\n * updates.\n */\n\n\nvar ownerHasKeyUseWarning = {};\n\nfunction getCurrentComponentErrorInfo(parentType) {\n  {\n    var info = getDeclarationErrorAddendum();\n\n    if (!info) {\n      var parentName = typeof parentType === 'string' ? parentType : parentType.displayName || parentType.name;\n\n      if (parentName) {\n        info = \"\\n\\nCheck the top-level render call using <\" + parentName + \">.\";\n      }\n    }\n\n    return info;\n  }\n}\n/**\n * Warn if the element doesn't have an explicit key assigned to it.\n * This element is in an array. The array could grow and shrink or be\n * reordered. All children that haven't already been validated are required to\n * have a \"key\" property assigned to it. Error statuses are cached so a warning\n * will only be shown once.\n *\n * @internal\n * @param {ReactElement} element Element that requires a key.\n * @param {*} parentType element's parent's type.\n */\n\n\nfunction validateExplicitKey(element, parentType) {\n  {\n    if (!element._store || element._store.validated || element.key != null) {\n      return;\n    }\n\n    element._store.validated = true;\n    var currentComponentErrorInfo = getCurrentComponentErrorInfo(parentType);\n\n    if (ownerHasKeyUseWarning[currentComponentErrorInfo]) {\n      return;\n    }\n\n    ownerHasKeyUseWarning[currentComponentErrorInfo] = true; // Usually the current owner is the offender, but if it accepts children as a\n    // property, it may be the creator of the child that's responsible for\n    // assigning it a key.\n\n    var childOwner = '';\n\n    if (element && element._owner && element._owner !== ReactCurrentOwner$1.current) {\n      // Give the component that originally created this child.\n      childOwner = \" It was passed a child from \" + getComponentNameFromType(element._owner.type) + \".\";\n    }\n\n    setCurrentlyValidatingElement$1(element);\n\n    error('Each child in a list should have a unique \"key\" prop.' + '%s%s See https://reactjs.org/link/warning-keys for more information.', currentComponentErrorInfo, childOwner);\n\n    setCurrentlyValidatingElement$1(null);\n  }\n}\n/**\n * Ensure that every element either is passed in a static location, in an\n * array with an explicit keys property defined, or in an object literal\n * with valid key property.\n *\n * @internal\n * @param {ReactNode} node Statically passed child of any type.\n * @param {*} parentType node's parent's type.\n */\n\n\nfunction validateChildKeys(node, parentType) {\n  {\n    if (typeof node !== 'object') {\n      return;\n    }\n\n    if (isArray(node)) {\n      for (var i = 0; i < node.length; i++) {\n        var child = node[i];\n\n        if (isValidElement(child)) {\n          validateExplicitKey(child, parentType);\n        }\n      }\n    } else if (isValidElement(node)) {\n      // This element was passed in a valid location.\n      if (node._store) {\n        node._store.validated = true;\n      }\n    } else if (node) {\n      var iteratorFn = getIteratorFn(node);\n\n      if (typeof iteratorFn === 'function') {\n        // Entry iterators used to provide implicit keys,\n        // but now we print a separate warning for them later.\n        if (iteratorFn !== node.entries) {\n          var iterator = iteratorFn.call(node);\n          var step;\n\n          while (!(step = iterator.next()).done) {\n            if (isValidElement(step.value)) {\n              validateExplicitKey(step.value, parentType);\n            }\n          }\n        }\n      }\n    }\n  }\n}\n/**\n * Given an element, validate that its props follow the propTypes definition,\n * provided by the type.\n *\n * @param {ReactElement} element\n */\n\n\nfunction validatePropTypes(element) {\n  {\n    var type = element.type;\n\n    if (type === null || type === undefined || typeof type === 'string') {\n      return;\n    }\n\n    var propTypes;\n\n    if (typeof type === 'function') {\n      propTypes = type.propTypes;\n    } else if (typeof type === 'object' && (type.$$typeof === REACT_FORWARD_REF_TYPE || // Note: Memo only checks outer props here.\n    // Inner props are checked in the reconciler.\n    type.$$typeof === REACT_MEMO_TYPE)) {\n      propTypes = type.propTypes;\n    } else {\n      return;\n    }\n\n    if (propTypes) {\n      // Intentionally inside to avoid triggering lazy initializers:\n      var name = getComponentNameFromType(type);\n      checkPropTypes(propTypes, element.props, 'prop', name, element);\n    } else if (type.PropTypes !== undefined && !propTypesMisspellWarningShown) {\n      propTypesMisspellWarningShown = true; // Intentionally inside to avoid triggering lazy initializers:\n\n      var _name = getComponentNameFromType(type);\n\n      error('Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?', _name || 'Unknown');\n    }\n\n    if (typeof type.getDefaultProps === 'function' && !type.getDefaultProps.isReactClassApproved) {\n      error('getDefaultProps is only used on classic React.createClass ' + 'definitions. Use a static property named `defaultProps` instead.');\n    }\n  }\n}\n/**\n * Given a fragment, validate that it can only be provided with fragment props\n * @param {ReactElement} fragment\n */\n\n\nfunction validateFragmentProps(fragment) {\n  {\n    var keys = Object.keys(fragment.props);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n\n      if (key !== 'children' && key !== 'key') {\n        setCurrentlyValidatingElement$1(fragment);\n\n        error('Invalid prop `%s` supplied to `React.Fragment`. ' + 'React.Fragment can only have `key` and `children` props.', key);\n\n        setCurrentlyValidatingElement$1(null);\n        break;\n      }\n    }\n\n    if (fragment.ref !== null) {\n      setCurrentlyValidatingElement$1(fragment);\n\n      error('Invalid attribute `ref` supplied to `React.Fragment`.');\n\n      setCurrentlyValidatingElement$1(null);\n    }\n  }\n}\n\nvar didWarnAboutKeySpread = {};\nfunction jsxWithValidation(type, props, key, isStaticChildren, source, self) {\n  {\n    var validType = isValidElementType(type); // We warn in this case but don't throw. We expect the element creation to\n    // succeed and there will likely be errors in render.\n\n    if (!validType) {\n      var info = '';\n\n      if (type === undefined || typeof type === 'object' && type !== null && Object.keys(type).length === 0) {\n        info += ' You likely forgot to export your component from the file ' + \"it's defined in, or you might have mixed up default and named imports.\";\n      }\n\n      var sourceInfo = getSourceInfoErrorAddendum(source);\n\n      if (sourceInfo) {\n        info += sourceInfo;\n      } else {\n        info += getDeclarationErrorAddendum();\n      }\n\n      var typeString;\n\n      if (type === null) {\n        typeString = 'null';\n      } else if (isArray(type)) {\n        typeString = 'array';\n      } else if (type !== undefined && type.$$typeof === REACT_ELEMENT_TYPE) {\n        typeString = \"<\" + (getComponentNameFromType(type.type) || 'Unknown') + \" />\";\n        info = ' Did you accidentally export a JSX literal instead of a component?';\n      } else {\n        typeString = typeof type;\n      }\n\n      error('React.jsx: type is invalid -- expected a string (for ' + 'built-in components) or a class/function (for composite ' + 'components) but got: %s.%s', typeString, info);\n    }\n\n    var element = jsxDEV(type, props, key, source, self); // The result can be nullish if a mock or a custom function is used.\n    // TODO: Drop this when these are no longer allowed as the type argument.\n\n    if (element == null) {\n      return element;\n    } // Skip key warning if the type isn't valid since our key validation logic\n    // doesn't expect a non-string/function type and can throw confusing errors.\n    // We don't want exception behavior to differ between dev and prod.\n    // (Rendering will throw with a helpful message and as soon as the type is\n    // fixed, the key warnings will appear.)\n\n\n    if (validType) {\n      var children = props.children;\n\n      if (children !== undefined) {\n        if (isStaticChildren) {\n          if (isArray(children)) {\n            for (var i = 0; i < children.length; i++) {\n              validateChildKeys(children[i], type);\n            }\n\n            if (Object.freeze) {\n              Object.freeze(children);\n            }\n          } else {\n            error('React.jsx: Static children should always be an array. ' + 'You are likely explicitly calling React.jsxs or React.jsxDEV. ' + 'Use the Babel transform instead.');\n          }\n        } else {\n          validateChildKeys(children, type);\n        }\n      }\n    }\n\n    {\n      if (hasOwnProperty.call(props, 'key')) {\n        var componentName = getComponentNameFromType(type);\n        var keys = Object.keys(props).filter(function (k) {\n          return k !== 'key';\n        });\n        var beforeExample = keys.length > 0 ? '{key: someKey, ' + keys.join(': ..., ') + ': ...}' : '{key: someKey}';\n\n        if (!didWarnAboutKeySpread[componentName + beforeExample]) {\n          var afterExample = keys.length > 0 ? '{' + keys.join(': ..., ') + ': ...}' : '{}';\n\n          error('A props object containing a \"key\" prop is being spread into JSX:\\n' + '  let props = %s;\\n' + '  <%s {...props} />\\n' + 'React keys must be passed directly to JSX without using spread:\\n' + '  let props = %s;\\n' + '  <%s key={someKey} {...props} />', beforeExample, componentName, afterExample, componentName);\n\n          didWarnAboutKeySpread[componentName + beforeExample] = true;\n        }\n      }\n    }\n\n    if (type === REACT_FRAGMENT_TYPE) {\n      validateFragmentProps(element);\n    } else {\n      validatePropTypes(element);\n    }\n\n    return element;\n  }\n} // These two functions exist to still get child warnings in dev\n// even with the prod transform. This means that jsxDEV is purely\n// opt-in behavior for better messages but that we won't stop\n// giving you warnings if you use production apis.\n\nfunction jsxWithValidationStatic(type, props, key) {\n  {\n    return jsxWithValidation(type, props, key, true);\n  }\n}\nfunction jsxWithValidationDynamic(type, props, key) {\n  {\n    return jsxWithValidation(type, props, key, false);\n  }\n}\n\nvar jsx =  jsxWithValidationDynamic ; // we may want to special case jsxs internally to take advantage of static children.\n// for now we can ship identical prod functions\n\nvar jsxs =  jsxWithValidationStatic ;\n\nexports.Fragment = REACT_FRAGMENT_TYPE;\nexports.jsx = jsx;\nexports.jsxs = jsxs;\n  })();\n}\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","function e(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}export{e as default};\n//# sourceMappingURL=index.es.js.map\n","function createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar hat_1 = createCommonjsModule(function (module) {\nvar hat = module.exports = function (bits, base) {\n    if (!base) base = 16;\n    if (bits === undefined) bits = 128;\n    if (bits <= 0) return '0';\n    \n    var digits = Math.log(Math.pow(2, bits)) / Math.log(base);\n    for (var i = 2; digits === Infinity; i *= 2) {\n        digits = Math.log(Math.pow(2, bits / i)) / Math.log(base) * i;\n    }\n    \n    var rem = digits - Math.floor(digits);\n    \n    var res = '';\n    \n    for (var i = 0; i < Math.floor(digits); i++) {\n        var x = Math.floor(Math.random() * base).toString(base);\n        res = x + res;\n    }\n    \n    if (rem) {\n        var b = Math.pow(base, rem);\n        var x = Math.floor(Math.random() * b).toString(base);\n        res = x + res;\n    }\n    \n    var parsed = parseInt(res, base);\n    if (parsed !== Infinity && parsed >= Math.pow(2, bits)) {\n        return hat(bits, base)\n    }\n    else return res;\n};\n\nhat.rack = function (bits, base, expandBy) {\n    var fn = function (data) {\n        var iters = 0;\n        do {\n            if (iters ++ > 10) {\n                if (expandBy) bits += expandBy;\n                else throw new Error('too many ID collisions, use more bits')\n            }\n            \n            var id = hat(bits, base);\n        } while (Object.hasOwnProperty.call(hats, id));\n        \n        hats[id] = data;\n        return id;\n    };\n    var hats = fn.hats = {};\n    \n    fn.get = function (id) {\n        return fn.hats[id];\n    };\n    \n    fn.set = function (id, value) {\n        fn.hats[id] = value;\n        return fn;\n    };\n    \n    fn.bits = bits || 128;\n    fn.base = base || 16;\n    return fn;\n};\n});\n\n/**\n * Create a new id generator / cache instance.\n *\n * You may optionally provide a seed that is used internally.\n *\n * @param {Seed} seed\n */\nfunction Ids(seed) {\n  if (!(this instanceof Ids)) {\n    return new Ids(seed);\n  }\n  seed = seed || [128, 36, 1];\n  this._seed = seed.length ? hat_1.rack(seed[0], seed[1], seed[2]) : seed;\n}\n\n/**\n * Generate a next id.\n *\n * @param {Object} [element] element to bind the id to\n *\n * @return {String} id\n */\nIds.prototype.next = function (element) {\n  return this._seed(element || true);\n};\n\n/**\n * Generate a next id with a given prefix.\n *\n * @param {Object} [element] element to bind the id to\n *\n * @return {String} id\n */\nIds.prototype.nextPrefixed = function (prefix, element) {\n  var id;\n  do {\n    id = prefix + this.next(true);\n  } while (this.assigned(id));\n\n  // claim {prefix}{random}\n  this.claim(id, element);\n\n  // return\n  return id;\n};\n\n/**\n * Manually claim an existing id.\n *\n * @param {String} id\n * @param {String} [element] element the id is claimed by\n */\nIds.prototype.claim = function (id, element) {\n  this._seed.set(id, element || true);\n};\n\n/**\n * Returns true if the given id has already been assigned.\n *\n * @param  {String} id\n * @return {Boolean}\n */\nIds.prototype.assigned = function (id) {\n  return this._seed.get(id) || false;\n};\n\n/**\n * Unclaim an id.\n *\n * @param  {String} id the id to unclaim\n */\nIds.prototype.unclaim = function (id) {\n  delete this._seed.hats[id];\n};\n\n/**\n * Clear all claimed ids.\n */\nIds.prototype.clear = function () {\n  var hats = this._seed.hats,\n    id;\n  for (id in hats) {\n    this.unclaim(id);\n  }\n};\n\nexport default Ids;\n//# sourceMappingURL=index.esm.js.map\n","/**\n * Flatten array, one level deep.\n *\n * @template T\n *\n * @param {T[][] | T[] | null} [arr]\n *\n * @return {T[]}\n */\nfunction flatten(arr) {\n  return Array.prototype.concat.apply([], arr);\n}\n\nconst nativeToString = Object.prototype.toString;\nconst nativeHasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction isUndefined(obj) {\n  return obj === undefined;\n}\n\nfunction isDefined(obj) {\n  return obj !== undefined;\n}\n\nfunction isNil(obj) {\n  return obj == null;\n}\n\nfunction isArray(obj) {\n  return nativeToString.call(obj) === '[object Array]';\n}\n\nfunction isObject(obj) {\n  return nativeToString.call(obj) === '[object Object]';\n}\n\nfunction isNumber(obj) {\n  return nativeToString.call(obj) === '[object Number]';\n}\n\n/**\n * @param {any} obj\n *\n * @return {boolean}\n */\nfunction isFunction(obj) {\n  const tag = nativeToString.call(obj);\n\n  return (\n    tag === '[object Function]' ||\n    tag === '[object AsyncFunction]' ||\n    tag === '[object GeneratorFunction]' ||\n    tag === '[object AsyncGeneratorFunction]' ||\n    tag === '[object Proxy]'\n  );\n}\n\nfunction isString(obj) {\n  return nativeToString.call(obj) === '[object String]';\n}\n\n\n/**\n * Ensure collection is an array.\n *\n * @param {Object} obj\n */\nfunction ensureArray(obj) {\n\n  if (isArray(obj)) {\n    return;\n  }\n\n  throw new Error('must supply array');\n}\n\n/**\n * Return true, if target owns a property with the given key.\n *\n * @param {Object} target\n * @param {String} key\n *\n * @return {Boolean}\n */\nfunction has(target, key) {\n  return nativeHasOwnProperty.call(target, key);\n}\n\n/**\n * @template T\n * @typedef { (\n *   ((e: T) => boolean) |\n *   ((e: T, idx: number) => boolean) |\n *   ((e: T, key: string) => boolean) |\n *   string |\n *   number\n * ) } Matcher\n */\n\n/**\n * @template T\n * @template U\n *\n * @typedef { (\n *   ((e: T) => U) | string | number\n * ) } Extractor\n */\n\n\n/**\n * @template T\n * @typedef { (val: T, key: any) => boolean } MatchFn\n */\n\n/**\n * @template T\n * @typedef { T[] } ArrayCollection\n */\n\n/**\n * @template T\n * @typedef { { [key: string]: T } } StringKeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { { [key: number]: T } } NumberKeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { StringKeyValueCollection<T> | NumberKeyValueCollection<T> } KeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { KeyValueCollection<T> | ArrayCollection<T> } Collection\n */\n\n/**\n * Find element in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {Object}\n */\nfunction find(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let match;\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      match = val;\n\n      return false;\n    }\n  });\n\n  return match;\n\n}\n\n\n/**\n * Find element index in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {number}\n */\nfunction findIndex(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let idx = isArray(collection) ? -1 : undefined;\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      idx = key;\n\n      return false;\n    }\n  });\n\n  return idx;\n}\n\n\n/**\n * Filter elements in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {T[]} result\n */\nfunction filter(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let result = [];\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      result.push(val);\n    }\n  });\n\n  return result;\n}\n\n\n/**\n * Iterate over collection; returning something\n * (non-undefined) will stop iteration.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param { ((item: T, idx: number) => (boolean|void)) | ((item: T, key: string) => (boolean|void)) } iterator\n *\n * @return {T} return result that stopped the iteration\n */\nfunction forEach(collection, iterator) {\n\n  let val,\n      result;\n\n  if (isUndefined(collection)) {\n    return;\n  }\n\n  const convertKey = isArray(collection) ? toNum : identity;\n\n  for (let key in collection) {\n\n    if (has(collection, key)) {\n      val = collection[key];\n\n      result = iterator(val, convertKey(key));\n\n      if (result === false) {\n        return val;\n      }\n    }\n  }\n}\n\n/**\n * Return collection without element.\n *\n * @template T\n * @param {ArrayCollection<T>} arr\n * @param {Matcher<T>} matcher\n *\n * @return {T[]}\n */\nfunction without(arr, matcher) {\n\n  if (isUndefined(arr)) {\n    return [];\n  }\n\n  ensureArray(arr);\n\n  const matchFn = toMatcher(matcher);\n\n  return arr.filter(function(el, idx) {\n    return !matchFn(el, idx);\n  });\n\n}\n\n\n/**\n * Reduce collection, returning a single result.\n *\n * @template T\n * @template V\n *\n * @param {Collection<T>} collection\n * @param {(result: V, entry: T, index: any) => V} iterator\n * @param {V} result\n *\n * @return {V} result returned from last iterator\n */\nfunction reduce(collection, iterator, result) {\n\n  forEach(collection, function(value, idx) {\n    result = iterator(result, value, idx);\n  });\n\n  return result;\n}\n\n\n/**\n * Return true if every element in the collection\n * matches the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\nfunction every(collection, matcher) {\n\n  return !!reduce(collection, function(matches, val, key) {\n    return matches && matcher(val, key);\n  }, true);\n}\n\n\n/**\n * Return true if some elements in the collection\n * match the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\nfunction some(collection, matcher) {\n\n  return !!find(collection, matcher);\n}\n\n\n/**\n * Transform a collection into another collection\n * by piping each member through the given fn.\n *\n * @param  {Object|Array}   collection\n * @param  {Function} fn\n *\n * @return {Array} transformed collection\n */\nfunction map(collection, fn) {\n\n  let result = [];\n\n  forEach(collection, function(val, key) {\n    result.push(fn(val, key));\n  });\n\n  return result;\n}\n\n\n/**\n * Get the collections keys.\n *\n * @param  {Object|Array} collection\n *\n * @return {Array}\n */\nfunction keys(collection) {\n  return collection && Object.keys(collection) || [];\n}\n\n\n/**\n * Shorthand for `keys(o).length`.\n *\n * @param  {Object|Array} collection\n *\n * @return {Number}\n */\nfunction size(collection) {\n  return keys(collection).length;\n}\n\n\n/**\n * Get the values in the collection.\n *\n * @param  {Object|Array} collection\n *\n * @return {Array}\n */\nfunction values(collection) {\n  return map(collection, (val) => val);\n}\n\n\n/**\n * Group collection members by attribute.\n *\n * @param {Object|Array} collection\n * @param {Extractor} extractor\n *\n * @return {Object} map with { attrValue => [ a, b, c ] }\n */\nfunction groupBy(collection, extractor, grouped = {}) {\n\n  extractor = toExtractor(extractor);\n\n  forEach(collection, function(val) {\n    let discriminator = extractor(val) || '_';\n\n    let group = grouped[discriminator];\n\n    if (!group) {\n      group = grouped[discriminator] = [];\n    }\n\n    group.push(val);\n  });\n\n  return grouped;\n}\n\n\nfunction uniqueBy(extractor, ...collections) {\n\n  extractor = toExtractor(extractor);\n\n  let grouped = {};\n\n  forEach(collections, (c) => groupBy(c, extractor, grouped));\n\n  let result = map(grouped, function(val, key) {\n    return val[0];\n  });\n\n  return result;\n}\n\n\nconst unionBy = uniqueBy;\n\n\n\n/**\n * Sort collection by criteria.\n *\n * @template T\n *\n * @param {Collection<T>} collection\n * @param {Extractor<T, number | string>} extractor\n *\n * @return {Array}\n */\nfunction sortBy(collection, extractor) {\n\n  extractor = toExtractor(extractor);\n\n  let sorted = [];\n\n  forEach(collection, function(value, key) {\n    let disc = extractor(value, key);\n\n    let entry = {\n      d: disc,\n      v: value\n    };\n\n    for (var idx = 0; idx < sorted.length; idx++) {\n      let { d } = sorted[idx];\n\n      if (disc < d) {\n        sorted.splice(idx, 0, entry);\n        return;\n      }\n    }\n\n    // not inserted, append (!)\n    sorted.push(entry);\n  });\n\n  return map(sorted, (e) => e.v);\n}\n\n\n/**\n * Create an object pattern matcher.\n *\n * @example\n *\n * ```javascript\n * const matcher = matchPattern({ id: 1 });\n *\n * let element = find(elements, matcher);\n * ```\n *\n * @template T\n *\n * @param {T} pattern\n *\n * @return { (el: any) =>  boolean } matcherFn\n */\nfunction matchPattern(pattern) {\n\n  return function(el) {\n\n    return every(pattern, function(val, key) {\n      return el[key] === val;\n    });\n\n  };\n}\n\n\n/**\n * @param {string | ((e: any) => any) } extractor\n *\n * @return { (e: any) => any }\n */\nfunction toExtractor(extractor) {\n\n  /**\n   * @satisfies { (e: any) => any }\n   */\n  return isFunction(extractor) ? extractor : (e) => {\n\n    // @ts-ignore: just works\n    return e[extractor];\n  };\n}\n\n\n/**\n * @template T\n * @param {Matcher<T>} matcher\n *\n * @return {MatchFn<T>}\n */\nfunction toMatcher(matcher) {\n  return isFunction(matcher) ? matcher : (e) => {\n    return e === matcher;\n  };\n}\n\n\nfunction identity(arg) {\n  return arg;\n}\n\nfunction toNum(arg) {\n  return Number(arg);\n}\n\n/* global setTimeout clearTimeout */\n\n/**\n * @typedef { {\n *   (...args: any[]): any;\n *   flush: () => void;\n *   cancel: () => void;\n * } } DebouncedFunction\n */\n\n/**\n * Debounce fn, calling it only once if the given time\n * elapsed between calls.\n *\n * Lodash-style the function exposes methods to `#clear`\n * and `#flush` to control internal behavior.\n *\n * @param  {Function} fn\n * @param  {Number} timeout\n *\n * @return {DebouncedFunction} debounced function\n */\nfunction debounce(fn, timeout) {\n\n  let timer;\n\n  let lastArgs;\n  let lastThis;\n\n  let lastNow;\n\n  function fire(force) {\n\n    let now = Date.now();\n\n    let scheduledDiff = force ? 0 : (lastNow + timeout) - now;\n\n    if (scheduledDiff > 0) {\n      return schedule(scheduledDiff);\n    }\n\n    fn.apply(lastThis, lastArgs);\n\n    clear();\n  }\n\n  function schedule(timeout) {\n    timer = setTimeout(fire, timeout);\n  }\n\n  function clear() {\n    if (timer) {\n      clearTimeout(timer);\n    }\n\n    timer = lastNow = lastArgs = lastThis = undefined;\n  }\n\n  function flush() {\n    if (timer) {\n      fire(true);\n    }\n\n    clear();\n  }\n\n  /**\n   * @type { DebouncedFunction }\n   */\n  function callback(...args) {\n    lastNow = Date.now();\n\n    lastArgs = args;\n    lastThis = this;\n\n    // ensure an execution is scheduled\n    if (!timer) {\n      schedule(timeout);\n    }\n  }\n\n  callback.flush = flush;\n  callback.cancel = clear;\n\n  return callback;\n}\n\n/**\n * Throttle fn, calling at most once\n * in the given interval.\n *\n * @param  {Function} fn\n * @param  {Number} interval\n *\n * @return {Function} throttled function\n */\nfunction throttle(fn, interval) {\n  let throttling = false;\n\n  return function(...args) {\n\n    if (throttling) {\n      return;\n    }\n\n    fn(...args);\n    throttling = true;\n\n    setTimeout(() => {\n      throttling = false;\n    }, interval);\n  };\n}\n\n/**\n * Bind function against target <this>.\n *\n * @param  {Function} fn\n * @param  {Object}   target\n *\n * @return {Function} bound function\n */\nfunction bind(fn, target) {\n  return fn.bind(target);\n}\n\n/**\n * Convenience wrapper for `Object.assign`.\n *\n * @param {Object} target\n * @param {...Object} others\n *\n * @return {Object} the target\n */\nfunction assign(target, ...others) {\n  return Object.assign(target, ...others);\n}\n\n/**\n * Sets a nested property of a given object to the specified value.\n *\n * This mutates the object and returns it.\n *\n * @template T\n *\n * @param {T} target The target of the set operation.\n * @param {(string|number)[]} path The path to the nested value.\n * @param {any} value The value to set.\n *\n * @return {T}\n */\nfunction set(target, path, value) {\n\n  let currentTarget = target;\n\n  forEach(path, function(key, idx) {\n\n    if (typeof key !== 'number' && typeof key !== 'string') {\n      throw new Error('illegal key type: ' + typeof key + '. Key should be of type number or string.');\n    }\n\n    if (key === 'constructor') {\n      throw new Error('illegal key: constructor');\n    }\n\n    if (key === '__proto__') {\n      throw new Error('illegal key: __proto__');\n    }\n\n    let nextKey = path[idx + 1];\n    let nextTarget = currentTarget[key];\n\n    if (isDefined(nextKey) && isNil(nextTarget)) {\n      nextTarget = currentTarget[key] = isNaN(+nextKey) ? {} : [];\n    }\n\n    if (isUndefined(nextKey)) {\n      if (isUndefined(value)) {\n        delete currentTarget[key];\n      } else {\n        currentTarget[key] = value;\n      }\n    } else {\n      currentTarget = nextTarget;\n    }\n  });\n\n  return target;\n}\n\n\n/**\n * Gets a nested property of a given object.\n *\n * @param {Object} target The target of the get operation.\n * @param {(string|number)[]} path The path to the nested value.\n * @param {any} [defaultValue] The value to return if no value exists.\n *\n * @return {any}\n */\nfunction get(target, path, defaultValue) {\n\n  let currentTarget = target;\n\n  forEach(path, function(key) {\n\n    // accessing nil property yields <undefined>\n    if (isNil(currentTarget)) {\n      currentTarget = undefined;\n\n      return false;\n    }\n\n    currentTarget = currentTarget[key];\n  });\n\n  return isUndefined(currentTarget) ? defaultValue : currentTarget;\n}\n\n/**\n * Pick properties from the given target.\n *\n * @template T\n * @template {any[]} V\n *\n * @param {T} target\n * @param {V} properties\n *\n * @return Pick<T, V>\n */\nfunction pick(target, properties) {\n\n  let result = {};\n\n  let obj = Object(target);\n\n  forEach(properties, function(prop) {\n\n    if (prop in obj) {\n      result[prop] = target[prop];\n    }\n  });\n\n  return result;\n}\n\n/**\n * Pick all target properties, excluding the given ones.\n *\n * @template T\n * @template {any[]} V\n *\n * @param {T} target\n * @param {V} properties\n *\n * @return {Omit<T, V>} target\n */\nfunction omit(target, properties) {\n\n  let result = {};\n\n  let obj = Object(target);\n\n  forEach(obj, function(prop, key) {\n\n    if (properties.indexOf(key) === -1) {\n      result[key] = prop;\n    }\n  });\n\n  return result;\n}\n\n/**\n * Recursively merge `...sources` into given target.\n *\n * Does support merging objects; does not support merging arrays.\n *\n * @param {Object} target\n * @param {...Object} sources\n *\n * @return {Object} the target\n */\nfunction merge(target, ...sources) {\n\n  if (!sources.length) {\n    return target;\n  }\n\n  forEach(sources, function(source) {\n\n    // skip non-obj sources, i.e. null\n    if (!source || !isObject(source)) {\n      return;\n    }\n\n    forEach(source, function(sourceVal, key) {\n\n      if (key === '__proto__') {\n        return;\n      }\n\n      let targetVal = target[key];\n\n      if (isObject(sourceVal)) {\n\n        if (!isObject(targetVal)) {\n\n          // override target[key] with object\n          targetVal = {};\n        }\n\n        target[key] = merge(targetVal, sourceVal);\n      } else {\n        target[key] = sourceVal;\n      }\n\n    });\n  });\n\n  return target;\n}\n\nexport { assign, bind, debounce, ensureArray, every, filter, find, findIndex, flatten, forEach, get, groupBy, has, isArray, isDefined, isFunction, isNil, isNumber, isObject, isString, isUndefined, keys, map, matchPattern, merge, omit, pick, reduce, set, size, some, sortBy, throttle, unionBy, uniqueBy, values, without };\n","function _mergeNamespaces(n, m) {\n  m.forEach(function (e) {\n    e && typeof e !== 'string' && !Array.isArray(e) && Object.keys(e).forEach(function (k) {\n      if (k !== 'default' && !(k in n)) {\n        var d = Object.getOwnPropertyDescriptor(e, k);\n        Object.defineProperty(n, k, d.get ? d : {\n          enumerable: true,\n          get: function () { return e[k]; }\n        });\n      }\n    });\n  });\n  return Object.freeze(n);\n}\n\n/**\n * Flatten array, one level deep.\n *\n * @param {Array<?>} arr\n *\n * @return {Array<?>}\n */\n\nconst nativeToString = Object.prototype.toString;\nconst nativeHasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction isUndefined(obj) {\n  return obj === undefined;\n}\n\nfunction isArray(obj) {\n  return nativeToString.call(obj) === '[object Array]';\n}\n\n/**\n * Return true, if target owns a property with the given key.\n *\n * @param {Object} target\n * @param {String} key\n *\n * @return {Boolean}\n */\nfunction has(target, key) {\n  return nativeHasOwnProperty.call(target, key);\n}\n\n\n/**\n * Iterate over collection; returning something\n * (non-undefined) will stop iteration.\n *\n * @param  {Array|Object} collection\n * @param  {Function} iterator\n *\n * @return {Object} return result that stopped the iteration\n */\nfunction forEach(collection, iterator) {\n\n  let val,\n      result;\n\n  if (isUndefined(collection)) {\n    return;\n  }\n\n  const convertKey = isArray(collection) ? toNum : identity;\n\n  for (let key in collection) {\n\n    if (has(collection, key)) {\n      val = collection[key];\n\n      result = iterator(val, convertKey(key));\n\n      if (result === false) {\n        return val;\n      }\n    }\n  }\n}\n\n\nfunction identity(arg) {\n  return arg;\n}\n\nfunction toNum(arg) {\n  return Number(arg);\n}\n\n/**\n * Assigns style attributes in a style-src compliant way.\n *\n * @param {Element} element\n * @param {...Object} styleSources\n *\n * @return {Element} the element\n */\nfunction assign(element, ...styleSources) {\n  const target = element.style;\n\n  forEach(styleSources, function(style) {\n    if (!style) {\n      return;\n    }\n\n    forEach(style, function(value, key) {\n      target[key] = value;\n    });\n  });\n\n  return element;\n}\n\n/**\n * Set attribute `name` to `val`, or get attr `name`.\n *\n * @param {Element} el\n * @param {String} name\n * @param {String} [val]\n * @api public\n */\nfunction attr(el, name, val) {\n\n  // get\n  if (arguments.length == 2) {\n    return el.getAttribute(name);\n  }\n\n  // remove\n  if (val === null) {\n    return el.removeAttribute(name);\n  }\n\n  // set\n  el.setAttribute(name, val);\n\n  return el;\n}\n\n/**\n * Taken from https://github.com/component/classes\n *\n * Without the component bits.\n */\n\n/**\n * toString reference.\n */\n\nconst toString = Object.prototype.toString;\n\n/**\n * Wrap `el` in a `ClassList`.\n *\n * @param {Element} el\n * @return {ClassList}\n * @api public\n */\n\nfunction classes(el) {\n  return new ClassList(el);\n}\n\n/**\n * Initialize a new ClassList for `el`.\n *\n * @param {Element} el\n * @api private\n */\n\nfunction ClassList(el) {\n  if (!el || !el.nodeType) {\n    throw new Error('A DOM element reference is required');\n  }\n  this.el = el;\n  this.list = el.classList;\n}\n\n/**\n * Add class `name` if not already present.\n *\n * @param {String} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.add = function(name) {\n  this.list.add(name);\n  return this;\n};\n\n/**\n * Remove class `name` when present, or\n * pass a regular expression to remove\n * any which match.\n *\n * @param {String|RegExp} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.remove = function(name) {\n  if ('[object RegExp]' == toString.call(name)) {\n    return this.removeMatching(name);\n  }\n\n  this.list.remove(name);\n  return this;\n};\n\n/**\n * Remove all classes matching `re`.\n *\n * @param {RegExp} re\n * @return {ClassList}\n * @api private\n */\n\nClassList.prototype.removeMatching = function(re) {\n  const arr = this.array();\n  for (let i = 0; i < arr.length; i++) {\n    if (re.test(arr[i])) {\n      this.remove(arr[i]);\n    }\n  }\n  return this;\n};\n\n/**\n * Toggle class `name`, can force state via `force`.\n *\n * For browsers that support classList, but do not support `force` yet,\n * the mistake will be detected and corrected.\n *\n * @param {String} name\n * @param {Boolean} force\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.toggle = function(name, force) {\n  if ('undefined' !== typeof force) {\n    if (force !== this.list.toggle(name, force)) {\n      this.list.toggle(name); // toggle again to correct\n    }\n  } else {\n    this.list.toggle(name);\n  }\n  return this;\n};\n\n/**\n * Return an array of classes.\n *\n * @return {Array}\n * @api public\n */\n\nClassList.prototype.array = function() {\n  return Array.from(this.list);\n};\n\n/**\n * Check if class `name` is present.\n *\n * @param {String} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.has =\nClassList.prototype.contains = function(name) {\n  return this.list.contains(name);\n};\n\n/**\n * Remove all children from the given element.\n */\nfunction clear(el) {\n\n  var c;\n\n  while (el.childNodes.length) {\n    c = el.childNodes[0];\n    el.removeChild(c);\n  }\n\n  return el;\n}\n\n/**\n * @param { HTMLElement } element\n * @param { String } selector\n *\n * @return { boolean }\n */\nfunction matches(element, selector) {\n  return element && typeof element.matches === 'function' && element.matches(selector);\n}\n\n/**\n * Closest\n *\n * @param {Element} el\n * @param {String} selector\n * @param {Boolean} checkYourSelf (optional)\n */\nfunction closest(element, selector, checkYourSelf) {\n  var currentElem = checkYourSelf ? element : element.parentNode;\n\n  while (currentElem && currentElem.nodeType !== document.DOCUMENT_NODE &&\n      currentElem.nodeType !== document.DOCUMENT_FRAGMENT_NODE) {\n\n    if (matches(currentElem, selector)) {\n      return currentElem;\n    }\n\n    currentElem = currentElem.parentNode;\n  }\n\n  return matches(currentElem, selector) ? currentElem : null;\n}\n\nvar componentEvent = {};\n\nvar bind$1, unbind$1, prefix;\n\nfunction detect () {\n  bind$1 = window.addEventListener ? 'addEventListener' : 'attachEvent';\n  unbind$1 = window.removeEventListener ? 'removeEventListener' : 'detachEvent';\n  prefix = bind$1 !== 'addEventListener' ? 'on' : '';\n}\n\n/**\n * Bind `el` event `type` to `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nvar bind_1 = componentEvent.bind = function(el, type, fn, capture){\n  if (!bind$1) detect();\n  el[bind$1](prefix + type, fn, capture || false);\n  return fn;\n};\n\n/**\n * Unbind `el` event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nvar unbind_1 = componentEvent.unbind = function(el, type, fn, capture){\n  if (!unbind$1) detect();\n  el[unbind$1](prefix + type, fn, capture || false);\n  return fn;\n};\n\nvar event = /*#__PURE__*/_mergeNamespaces({\n  __proto__: null,\n  bind: bind_1,\n  unbind: unbind_1,\n  'default': componentEvent\n}, [componentEvent]);\n\n/**\n * Module dependencies.\n */\n\n/**\n * Delegate event `type` to `selector`\n * and invoke `fn(e)`. A callback function\n * is returned which may be passed to `.unbind()`.\n *\n * @param {Element} el\n * @param {String} selector\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\n// Some events don't bubble, so we want to bind to the capture phase instead\n// when delegating.\nvar forceCaptureEvents = [ 'focus', 'blur' ];\n\nfunction bind(el, selector, type, fn, capture) {\n  if (forceCaptureEvents.indexOf(type) !== -1) {\n    capture = true;\n  }\n\n  return event.bind(el, type, function(e) {\n    var target = e.target || e.srcElement;\n    e.delegateTarget = closest(target, selector, true);\n    if (e.delegateTarget) {\n      fn.call(el, e);\n    }\n  }, capture);\n}\n\n/**\n * Unbind event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @api public\n */\nfunction unbind(el, type, fn, capture) {\n  if (forceCaptureEvents.indexOf(type) !== -1) {\n    capture = true;\n  }\n\n  return event.unbind(el, type, fn, capture);\n}\n\nvar delegate = {\n  bind,\n  unbind\n};\n\n/**\n * Expose `parse`.\n */\n\nvar domify = parse;\n\n/**\n * Tests for browser support.\n */\n\nvar innerHTMLBug = false;\nvar bugTestDiv;\nif (typeof document !== 'undefined') {\n  bugTestDiv = document.createElement('div');\n  // Setup\n  bugTestDiv.innerHTML = '  <link/><table></table><a href=\"/a\">a</a><input type=\"checkbox\"/>';\n  // Make sure that link elements get serialized correctly by innerHTML\n  // This requires a wrapper element in IE\n  innerHTMLBug = !bugTestDiv.getElementsByTagName('link').length;\n  bugTestDiv = undefined;\n}\n\n/**\n * Wrap map from jquery.\n */\n\nvar map = {\n  legend: [1, '<fieldset>', '</fieldset>'],\n  tr: [2, '<table><tbody>', '</tbody></table>'],\n  col: [2, '<table><tbody></tbody><colgroup>', '</colgroup></table>'],\n  // for script/link/style tags to work in IE6-8, you have to wrap\n  // in a div with a non-whitespace character in front, ha!\n  _default: innerHTMLBug ? [1, 'X<div>', '</div>'] : [0, '', '']\n};\n\nmap.td =\nmap.th = [3, '<table><tbody><tr>', '</tr></tbody></table>'];\n\nmap.option =\nmap.optgroup = [1, '<select multiple=\"multiple\">', '</select>'];\n\nmap.thead =\nmap.tbody =\nmap.colgroup =\nmap.caption =\nmap.tfoot = [1, '<table>', '</table>'];\n\nmap.polyline =\nmap.ellipse =\nmap.polygon =\nmap.circle =\nmap.text =\nmap.line =\nmap.path =\nmap.rect =\nmap.g = [1, '<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">','</svg>'];\n\n/**\n * Parse `html` and return a DOM Node instance, which could be a TextNode,\n * HTML DOM Node of some kind (<div> for example), or a DocumentFragment\n * instance, depending on the contents of the `html` string.\n *\n * @param {String} html - HTML string to \"domify\"\n * @param {Document} doc - The `document` instance to create the Node for\n * @return {DOMNode} the TextNode, DOM Node, or DocumentFragment instance\n * @api private\n */\n\nfunction parse(html, doc) {\n  if ('string' != typeof html) throw new TypeError('String expected');\n\n  // default to the global `document` object\n  if (!doc) doc = document;\n\n  // tag name\n  var m = /<([\\w:]+)/.exec(html);\n  if (!m) return doc.createTextNode(html);\n\n  html = html.replace(/^\\s+|\\s+$/g, ''); // Remove leading/trailing whitespace\n\n  var tag = m[1];\n\n  // body support\n  if (tag == 'body') {\n    var el = doc.createElement('html');\n    el.innerHTML = html;\n    return el.removeChild(el.lastChild);\n  }\n\n  // wrap map\n  var wrap = Object.prototype.hasOwnProperty.call(map, tag) ? map[tag] : map._default;\n  var depth = wrap[0];\n  var prefix = wrap[1];\n  var suffix = wrap[2];\n  var el = doc.createElement('div');\n  el.innerHTML = prefix + html + suffix;\n  while (depth--) el = el.lastChild;\n\n  // one element\n  if (el.firstChild == el.lastChild) {\n    return el.removeChild(el.firstChild);\n  }\n\n  // several elements\n  var fragment = doc.createDocumentFragment();\n  while (el.firstChild) {\n    fragment.appendChild(el.removeChild(el.firstChild));\n  }\n\n  return fragment;\n}\n\nvar domify$1 = domify;\n\nfunction query(selector, el) {\n  el = el || document;\n\n  return el.querySelector(selector);\n}\n\nfunction all(selector, el) {\n  el = el || document;\n\n  return el.querySelectorAll(selector);\n}\n\nfunction remove(el) {\n  el.parentNode && el.parentNode.removeChild(el);\n}\n\nexport { assign as assignStyle, attr, classes, clear, closest, delegate, domify$1 as domify, event, matches, query, all as queryAll, remove };\n//# sourceMappingURL=index.esm.js.map\n","function ensureImported(element, target) {\n\n  if (element.ownerDocument !== target.ownerDocument) {\n    try {\n\n      // may fail on webkit\n      return target.ownerDocument.importNode(element, true);\n    } catch (e) {\n\n      // ignore\n    }\n  }\n\n  return element;\n}\n\n/**\n * appendTo utility\n */\n\n/**\n * Append a node to a target element and return the appended node.\n *\n * @param  {SVGElement} element\n * @param  {SVGElement} target\n *\n * @return {SVGElement} the appended node\n */\nfunction appendTo(element, target) {\n  return target.appendChild(ensureImported(element, target));\n}\n\n/**\n * append utility\n */\n\n/**\n * Append a node to an element\n *\n * @param  {SVGElement} element\n * @param  {SVGElement} node\n *\n * @return {SVGElement} the element\n */\nfunction append(target, node) {\n  appendTo(node, target);\n  return target;\n}\n\n/**\n * attribute accessor utility\n */\n\nvar LENGTH_ATTR = 2;\n\nvar CSS_PROPERTIES = {\n  'alignment-baseline': 1,\n  'baseline-shift': 1,\n  'clip': 1,\n  'clip-path': 1,\n  'clip-rule': 1,\n  'color': 1,\n  'color-interpolation': 1,\n  'color-interpolation-filters': 1,\n  'color-profile': 1,\n  'color-rendering': 1,\n  'cursor': 1,\n  'direction': 1,\n  'display': 1,\n  'dominant-baseline': 1,\n  'enable-background': 1,\n  'fill': 1,\n  'fill-opacity': 1,\n  'fill-rule': 1,\n  'filter': 1,\n  'flood-color': 1,\n  'flood-opacity': 1,\n  'font': 1,\n  'font-family': 1,\n  'font-size': LENGTH_ATTR,\n  'font-size-adjust': 1,\n  'font-stretch': 1,\n  'font-style': 1,\n  'font-variant': 1,\n  'font-weight': 1,\n  'glyph-orientation-horizontal': 1,\n  'glyph-orientation-vertical': 1,\n  'image-rendering': 1,\n  'kerning': 1,\n  'letter-spacing': 1,\n  'lighting-color': 1,\n  'marker': 1,\n  'marker-end': 1,\n  'marker-mid': 1,\n  'marker-start': 1,\n  'mask': 1,\n  'opacity': 1,\n  'overflow': 1,\n  'pointer-events': 1,\n  'shape-rendering': 1,\n  'stop-color': 1,\n  'stop-opacity': 1,\n  'stroke': 1,\n  'stroke-dasharray': 1,\n  'stroke-dashoffset': 1,\n  'stroke-linecap': 1,\n  'stroke-linejoin': 1,\n  'stroke-miterlimit': 1,\n  'stroke-opacity': 1,\n  'stroke-width': LENGTH_ATTR,\n  'text-anchor': 1,\n  'text-decoration': 1,\n  'text-rendering': 1,\n  'unicode-bidi': 1,\n  'visibility': 1,\n  'word-spacing': 1,\n  'writing-mode': 1\n};\n\n\nfunction getAttribute(node, name) {\n  if (CSS_PROPERTIES[name]) {\n    return node.style[name];\n  } else {\n    return node.getAttributeNS(null, name);\n  }\n}\n\nfunction setAttribute(node, name, value) {\n  var hyphenated = name.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n\n  var type = CSS_PROPERTIES[hyphenated];\n\n  if (type) {\n\n    // append pixel unit, unless present\n    if (type === LENGTH_ATTR && typeof value === 'number') {\n      value = String(value) + 'px';\n    }\n\n    node.style[hyphenated] = value;\n  } else {\n    node.setAttributeNS(null, name, value);\n  }\n}\n\nfunction setAttributes(node, attrs) {\n\n  var names = Object.keys(attrs), i, name;\n\n  for (i = 0, name; (name = names[i]); i++) {\n    setAttribute(node, name, attrs[name]);\n  }\n}\n\n/**\n * Gets or sets raw attributes on a node.\n *\n * @param  {SVGElement} node\n * @param  {Object} [attrs]\n * @param  {String} [name]\n * @param  {String} [value]\n *\n * @return {String}\n */\nfunction attr(node, name, value) {\n  if (typeof name === 'string') {\n    if (value !== undefined) {\n      setAttribute(node, name, value);\n    } else {\n      return getAttribute(node, name);\n    }\n  } else {\n    setAttributes(node, name);\n  }\n\n  return node;\n}\n\n/**\r\n * Taken from https://github.com/component/classes\r\n *\r\n * Without the component bits.\r\n */\r\n\r\n/**\r\n * toString reference.\r\n */\r\n\r\nconst toString = Object.prototype.toString;\r\n\r\n/**\r\n  * Wrap `el` in a `ClassList`.\r\n  *\r\n  * @param {Element} el\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nfunction classes(el) {\r\n  return new ClassList(el);\r\n}\r\n\r\nfunction ClassList(el) {\r\n  if (!el || !el.nodeType) {\r\n    throw new Error('A DOM element reference is required');\r\n  }\r\n  this.el = el;\r\n  this.list = el.classList;\r\n}\r\n\r\n/**\r\n  * Add class `name` if not already present.\r\n  *\r\n  * @param {String} name\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.add = function(name) {\r\n  this.list.add(name);\r\n  return this;\r\n};\r\n\r\n/**\r\n  * Remove class `name` when present, or\r\n  * pass a regular expression to remove\r\n  * any which match.\r\n  *\r\n  * @param {String|RegExp} name\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.remove = function(name) {\r\n  if ('[object RegExp]' == toString.call(name)) {\r\n    return this.removeMatching(name);\r\n  }\r\n\r\n  this.list.remove(name);\r\n  return this;\r\n};\r\n\r\n/**\r\n  * Remove all classes matching `re`.\r\n  *\r\n  * @param {RegExp} re\r\n  * @return {ClassList}\r\n  * @api private\r\n  */\r\n\r\nClassList.prototype.removeMatching = function(re) {\r\n  const arr = this.array();\r\n  for (let i = 0; i < arr.length; i++) {\r\n    if (re.test(arr[i])) {\r\n      this.remove(arr[i]);\r\n    }\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n  * Toggle class `name`, can force state via `force`.\r\n  *\r\n  * For browsers that support classList, but do not support `force` yet,\r\n  * the mistake will be detected and corrected.\r\n  *\r\n  * @param {String} name\r\n  * @param {Boolean} force\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.toggle = function(name, force) {\r\n  if ('undefined' !== typeof force) {\r\n    if (force !== this.list.toggle(name, force)) {\r\n      this.list.toggle(name); // toggle again to correct\r\n    }\r\n  } else {\r\n    this.list.toggle(name);\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n  * Return an array of classes.\r\n  *\r\n  * @return {Array}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.array = function() {\r\n  return Array.from(this.list);\r\n};\r\n\r\n/**\r\n  * Check if class `name` is present.\r\n  *\r\n  * @param {String} name\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.has =\r\n ClassList.prototype.contains = function(name) {\r\n   return this.list.contains(name);\r\n };\n\nfunction remove(element) {\n  var parent = element.parentNode;\n\n  if (parent) {\n    parent.removeChild(element);\n  }\n\n  return element;\n}\n\n/**\n * Clear utility\n */\n\n/**\n * Removes all children from the given element\n *\n * @param  {DOMElement} element\n * @return {DOMElement} the element (for chaining)\n */\nfunction clear(element) {\n  var child;\n\n  while ((child = element.firstChild)) {\n    remove(child);\n  }\n\n  return element;\n}\n\nfunction clone(element) {\n  return element.cloneNode(true);\n}\n\nvar ns = {\n  svg: 'http://www.w3.org/2000/svg'\n};\n\n/**\n * DOM parsing utility\n */\n\nvar SVG_START = '<svg xmlns=\"' + ns.svg + '\"';\n\nfunction parse(svg) {\n\n  var unwrap = false;\n\n  // ensure we import a valid svg document\n  if (svg.substring(0, 4) === '<svg') {\n    if (svg.indexOf(ns.svg) === -1) {\n      svg = SVG_START + svg.substring(4);\n    }\n  } else {\n\n    // namespace svg\n    svg = SVG_START + '>' + svg + '</svg>';\n    unwrap = true;\n  }\n\n  var parsed = parseDocument(svg);\n\n  if (!unwrap) {\n    return parsed;\n  }\n\n  var fragment = document.createDocumentFragment();\n\n  var parent = parsed.firstChild;\n\n  while (parent.firstChild) {\n    fragment.appendChild(parent.firstChild);\n  }\n\n  return fragment;\n}\n\nfunction parseDocument(svg) {\n\n  var parser;\n\n  // parse\n  parser = new DOMParser();\n  parser.async = false;\n\n  return parser.parseFromString(svg, 'text/xml');\n}\n\n/**\n * Create utility for SVG elements\n */\n\n\n/**\n * Create a specific type from name or SVG markup.\n *\n * @param {String} name the name or markup of the element\n * @param {Object} [attrs] attributes to set on the element\n *\n * @returns {SVGElement}\n */\nfunction create(name, attrs) {\n  var element;\n\n  if (name.charAt(0) === '<') {\n    element = parse(name).firstChild;\n    element = document.importNode(element, true);\n  } else {\n    element = document.createElementNS(ns.svg, name);\n  }\n\n  if (attrs) {\n    attr(element, attrs);\n  }\n\n  return element;\n}\n\n/**\n * Events handling utility\n */\n\nfunction on(node, event, listener, useCapture) {\n  node.addEventListener(event, listener, useCapture);\n}\n\nfunction off(node, event, listener, useCapture) {\n  node.removeEventListener(event, listener, useCapture);\n}\n\n/**\n * Geometry helpers\n */\n\n// fake node used to instantiate svg geometry elements\nvar node = null;\n\nfunction getNode() {\n  if (node === null) {\n    node = create('svg');\n  }\n\n  return node;\n}\n\nfunction extend(object, props) {\n  var i, k, keys = Object.keys(props);\n\n  for (i = 0; (k = keys[i]); i++) {\n    object[k] = props[k];\n  }\n\n  return object;\n}\n\n\nfunction createPoint(x, y) {\n  var point = getNode().createSVGPoint();\n\n  switch (arguments.length) {\n  case 0:\n    return point;\n  case 2:\n    x = {\n      x: x,\n      y: y\n    };\n    break;\n  }\n\n  return extend(point, x);\n}\n\n/**\n * Create matrix via args.\n *\n * @example\n *\n * createMatrix({ a: 1, b: 1 });\n * createMatrix();\n * createMatrix(1, 2, 0, 0, 30, 20);\n *\n * @return {SVGMatrix}\n */\nfunction createMatrix(a, b, c, d, e, f) {\n  var matrix = getNode().createSVGMatrix();\n\n  switch (arguments.length) {\n  case 0:\n    return matrix;\n  case 1:\n    return extend(matrix, a);\n  case 6:\n    return extend(matrix, {\n      a: a,\n      b: b,\n      c: c,\n      d: d,\n      e: e,\n      f: f\n    });\n  }\n}\n\nfunction createTransform(matrix) {\n  if (matrix) {\n    return getNode().createSVGTransformFromMatrix(matrix);\n  } else {\n    return getNode().createSVGTransform();\n  }\n}\n\n/**\n * Serialization util\n */\n\nvar TEXT_ENTITIES = /([&<>]{1})/g;\nvar ATTR_ENTITIES = /([\\n\\r\"]{1})/g;\n\nvar ENTITY_REPLACEMENT = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '\\''\n};\n\nfunction escape(str, pattern) {\n\n  function replaceFn(match, entity) {\n    return ENTITY_REPLACEMENT[entity] || entity;\n  }\n\n  return str.replace(pattern, replaceFn);\n}\n\nfunction serialize(node, output) {\n\n  var i, len, attrMap, attrNode, childNodes;\n\n  switch (node.nodeType) {\n\n  // TEXT\n  case 3:\n\n    // replace special XML characters\n    output.push(escape(node.textContent, TEXT_ENTITIES));\n    break;\n\n  // ELEMENT\n  case 1:\n    output.push('<', node.tagName);\n\n    if (node.hasAttributes()) {\n      attrMap = node.attributes;\n      for (i = 0, len = attrMap.length; i < len; ++i) {\n        attrNode = attrMap.item(i);\n        output.push(' ', attrNode.name, '=\"', escape(attrNode.value, ATTR_ENTITIES), '\"');\n      }\n    }\n\n    if (node.hasChildNodes()) {\n      output.push('>');\n      childNodes = node.childNodes;\n      for (i = 0, len = childNodes.length; i < len; ++i) {\n        serialize(childNodes.item(i), output);\n      }\n      output.push('</', node.tagName, '>');\n    } else {\n      output.push('/>');\n    }\n    break;\n\n  // COMMENT\n  case 8:\n    output.push('<!--', escape(node.nodeValue, TEXT_ENTITIES), '-->');\n    break;\n\n  // CDATA\n  case 4:\n    output.push('<![CDATA[', node.nodeValue, ']]>');\n    break;\n\n  default:\n    throw new Error('unable to handle node ' + node.nodeType);\n  }\n\n  return output;\n}\n\n/**\n * innerHTML like functionality for SVG elements.\n * based on innerSVG (https://code.google.com/p/innersvg)\n */\n\n\nfunction set(element, svg) {\n\n  var parsed = parse(svg);\n\n  // clear element contents\n  clear(element);\n\n  if (!svg) {\n    return;\n  }\n\n  if (!isFragment(parsed)) {\n\n    // extract <svg> from parsed document\n    parsed = parsed.documentElement;\n  }\n\n  var nodes = slice(parsed.childNodes);\n\n  // import + append each node\n  for (var i = 0; i < nodes.length; i++) {\n    appendTo(nodes[i], element);\n  }\n\n}\n\nfunction get(element) {\n  var child = element.firstChild,\n      output = [];\n\n  while (child) {\n    serialize(child, output);\n    child = child.nextSibling;\n  }\n\n  return output.join('');\n}\n\nfunction isFragment(node) {\n  return node.nodeName === '#document-fragment';\n}\n\nfunction innerSVG(element, svg) {\n\n  if (svg !== undefined) {\n\n    try {\n      set(element, svg);\n    } catch (e) {\n      throw new Error('error parsing SVG: ' + e.message);\n    }\n\n    return element;\n  } else {\n    return get(element);\n  }\n}\n\n\nfunction slice(arr) {\n  return Array.prototype.slice.call(arr);\n}\n\n/**\n * Selection utilities\n */\n\nfunction select(node, selector) {\n  return node.querySelector(selector);\n}\n\nfunction selectAll(node, selector) {\n  var nodes = node.querySelectorAll(selector);\n\n  return [].map.call(nodes, function(element) {\n    return element;\n  });\n}\n\n/**\n * prependTo utility\n */\n\n/**\n * Prepend a node to a target element and return the prepended node.\n *\n * @param  {SVGElement} node\n * @param  {SVGElement} target\n *\n * @return {SVGElement} the prepended node\n */\nfunction prependTo(node, target) {\n  return target.insertBefore(ensureImported(node, target), target.firstChild || null);\n}\n\n/**\n * prepend utility\n */\n\n/**\n * Prepend a node to a target element\n *\n * @param  {SVGElement} target\n * @param  {SVGElement} node\n *\n * @return {SVGElement} the target element\n */\nfunction prepend(target, node) {\n  prependTo(node, target);\n  return target;\n}\n\n/**\n * Replace utility\n */\n\nfunction replace(element, replacement) {\n  element.parentNode.replaceChild(ensureImported(replacement, element), element);\n  return replacement;\n}\n\n/**\n * transform accessor utility\n */\n\nfunction wrapMatrix(transformList, transform) {\n  if (transform instanceof SVGMatrix) {\n    return transformList.createSVGTransformFromMatrix(transform);\n  }\n\n  return transform;\n}\n\n\nfunction setTransforms(transformList, transforms) {\n  var i, t;\n\n  transformList.clear();\n\n  for (i = 0; (t = transforms[i]); i++) {\n    transformList.appendItem(wrapMatrix(transformList, t));\n  }\n}\n\n/**\n * Get or set the transforms on the given node.\n *\n * @param {SVGElement} node\n * @param  {SVGTransform|SVGMatrix|Array<SVGTransform|SVGMatrix>} [transforms]\n *\n * @return {SVGTransform} the consolidated transform\n */\nfunction transform(node, transforms) {\n  var transformList = node.transform.baseVal;\n\n  if (transforms) {\n\n    if (!Array.isArray(transforms)) {\n      transforms = [ transforms ];\n    }\n\n    setTransforms(transformList, transforms);\n  }\n\n  return transformList.consolidate();\n}\n\nexport { append, appendTo, attr, classes, clear, clone, create, createMatrix, createPoint, createTransform, innerSVG, off, on, prepend, prependTo, remove, replace, select, selectAll, transform };\n","const CLASS_PATTERN = /^class[ {]/;\n\n\n/**\n * @param {function} fn\n *\n * @return {boolean}\n */\nfunction isClass(fn) {\n  return CLASS_PATTERN.test(fn.toString());\n}\n\n/**\n * @param {any} obj\n *\n * @return {boolean}\n */\nfunction isArray(obj) {\n  return Array.isArray(obj);\n}\n\n/**\n * @param {any} obj\n * @param {string} prop\n *\n * @return {boolean}\n */\nfunction hasOwnProp(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\n/**\n * @typedef {import('./index.js').InjectAnnotated } InjectAnnotated\n */\n\n/**\n * @template T\n *\n * @params {[...string[], T] | ...string[], T} args\n *\n * @return {T & InjectAnnotated}\n */\nfunction annotate(...args) {\n\n  if (args.length === 1 && isArray(args[0])) {\n    args = args[0];\n  }\n\n  args = [ ...args ];\n\n  const fn = args.pop();\n\n  fn.$inject = args;\n\n  return fn;\n}\n\n\n// Current limitations:\n// - can't put into \"function arg\" comments\n// function /* (no parenthesis like this) */ (){}\n// function abc( /* xx (no parenthesis like this) */ a, b) {}\n//\n// Just put the comment before function or inside:\n// /* (((this is fine))) */ function(a, b) {}\n// function abc(a) { /* (((this is fine))) */}\n//\n// - can't reliably auto-annotate constructor; we'll match the\n// first constructor(...) pattern found which may be the one\n// of a nested class, too.\n\nconst CONSTRUCTOR_ARGS = /constructor\\s*[^(]*\\(\\s*([^)]*)\\)/m;\nconst FN_ARGS = /^(?:async\\s+)?(?:function\\s*[^(]*)?(?:\\(\\s*([^)]*)\\)|(\\w+))/m;\nconst FN_ARG = /\\/\\*([^*]*)\\*\\//m;\n\n/**\n * @param {unknown} fn\n *\n * @return {string[]}\n */\nfunction parseAnnotations(fn) {\n\n  if (typeof fn !== 'function') {\n    throw new Error(`Cannot annotate \"${fn}\". Expected a function!`);\n  }\n\n  const match = fn.toString().match(isClass(fn) ? CONSTRUCTOR_ARGS : FN_ARGS);\n\n  // may parse class without constructor\n  if (!match) {\n    return [];\n  }\n\n  const args = match[1] || match[2];\n\n  return args && args.split(',').map(arg => {\n    const argMatch = arg.match(FN_ARG);\n    return (argMatch && argMatch[1] || arg).trim();\n  }) || [];\n}\n\n/**\n * @typedef { import('./index.js').ModuleDeclaration } ModuleDeclaration\n * @typedef { import('./index.js').ModuleDefinition } ModuleDefinition\n * @typedef { import('./index.js').InjectorContext } InjectorContext\n *\n * @typedef { import('./index.js').TypedDeclaration<any, any> } TypedDeclaration\n */\n\n/**\n * Create a new injector with the given modules.\n *\n * @param {ModuleDefinition[]} modules\n * @param {InjectorContext} [_parent]\n */\nfunction Injector(modules, _parent) {\n\n  const parent = _parent || /** @type InjectorContext */ ({\n    get: function(name, strict) {\n      currentlyResolving.push(name);\n\n      if (strict === false) {\n        return null;\n      } else {\n        throw error(`No provider for \"${ name }\"!`);\n      }\n    }\n  });\n\n  const currentlyResolving = [];\n  const providers = this._providers = Object.create(parent._providers || null);\n  const instances = this._instances = Object.create(null);\n\n  const self = instances.injector = this;\n\n  const error = function(msg) {\n    const stack = currentlyResolving.join(' -> ');\n    currentlyResolving.length = 0;\n    return new Error(stack ? `${ msg } (Resolving: ${ stack })` : msg);\n  };\n\n  /**\n   * Return a named service.\n   *\n   * @param {string} name\n   * @param {boolean} [strict=true] if false, resolve missing services to null\n   *\n   * @return {any}\n   */\n  function get(name, strict) {\n    if (!providers[name] && name.includes('.')) {\n\n      const parts = name.split('.');\n      let pivot = get(/** @type { string } */ (parts.shift()));\n\n      while (parts.length) {\n        pivot = pivot[/** @type { string } */ (parts.shift())];\n      }\n\n      return pivot;\n    }\n\n    if (hasOwnProp(instances, name)) {\n      return instances[name];\n    }\n\n    if (hasOwnProp(providers, name)) {\n      if (currentlyResolving.indexOf(name) !== -1) {\n        currentlyResolving.push(name);\n        throw error('Cannot resolve circular dependency!');\n      }\n\n      currentlyResolving.push(name);\n      instances[name] = providers[name][0](providers[name][1]);\n      currentlyResolving.pop();\n\n      return instances[name];\n    }\n\n    return parent.get(name, strict);\n  }\n\n  function fnDef(fn, locals) {\n\n    if (typeof locals === 'undefined') {\n      locals = {};\n    }\n\n    if (typeof fn !== 'function') {\n      if (isArray(fn)) {\n        fn = annotate(fn.slice());\n      } else {\n        throw error(`Cannot invoke \"${ fn }\". Expected a function!`);\n      }\n    }\n\n    /**\n     * @type {string[]}\n     */\n    const inject = fn.$inject || parseAnnotations(fn);\n    const dependencies = inject.map(dep => {\n      if (hasOwnProp(locals, dep)) {\n        return locals[dep];\n      } else {\n        return get(dep);\n      }\n    });\n\n    return {\n      fn: fn,\n      dependencies\n    };\n  }\n\n  /**\n   * Instantiate the given type, injecting dependencies.\n   *\n   * @template T\n   *\n   * @param { Function | [...string[], Function ]} type\n   *\n   * @return T\n   */\n  function instantiate(type) {\n    const {\n      fn,\n      dependencies\n    } = fnDef(type);\n\n    // instantiate var args constructor\n    const Constructor = Function.prototype.bind.call(fn, null, ...dependencies);\n\n    return new Constructor();\n  }\n\n  /**\n   * Invoke the given function, injecting dependencies. Return the result.\n   *\n   * @template T\n   *\n   * @param { Function | [...string[], Function ]} func\n   * @param { Object } [context]\n   * @param { Object } [locals]\n   *\n   * @return {T} invocation result\n   */\n  function invoke(func, context, locals) {\n    const {\n      fn,\n      dependencies\n    } = fnDef(func, locals);\n\n    return fn.apply(context, dependencies);\n  }\n\n  /**\n   * @param {Injector} childInjector\n   *\n   * @return {Function}\n   */\n  function createPrivateInjectorFactory(childInjector) {\n    return annotate(key => childInjector.get(key));\n  }\n\n  /**\n   * @param {ModuleDefinition[]} modules\n   * @param {string[]} [forceNewInstances]\n   *\n   * @return {Injector}\n   */\n  function createChild(modules, forceNewInstances) {\n    if (forceNewInstances && forceNewInstances.length) {\n      const fromParentModule = Object.create(null);\n      const matchedScopes = Object.create(null);\n\n      const privateInjectorsCache = [];\n      const privateChildInjectors = [];\n      const privateChildFactories = [];\n\n      let provider;\n      let cacheIdx;\n      let privateChildInjector;\n      let privateChildInjectorFactory;\n\n      for (let name in providers) {\n        provider = providers[name];\n\n        if (forceNewInstances.indexOf(name) !== -1) {\n          if (provider[2] === 'private') {\n            cacheIdx = privateInjectorsCache.indexOf(provider[3]);\n            if (cacheIdx === -1) {\n              privateChildInjector = provider[3].createChild([], forceNewInstances);\n              privateChildInjectorFactory = createPrivateInjectorFactory(privateChildInjector);\n              privateInjectorsCache.push(provider[3]);\n              privateChildInjectors.push(privateChildInjector);\n              privateChildFactories.push(privateChildInjectorFactory);\n              fromParentModule[name] = [ privateChildInjectorFactory, name, 'private', privateChildInjector ];\n            } else {\n              fromParentModule[name] = [ privateChildFactories[cacheIdx], name, 'private', privateChildInjectors[cacheIdx] ];\n            }\n          } else {\n            fromParentModule[name] = [ provider[2], provider[1] ];\n          }\n          matchedScopes[name] = true;\n        }\n\n        if ((provider[2] === 'factory' || provider[2] === 'type') && provider[1].$scope) {\n          /* jshint -W083 */\n          forceNewInstances.forEach(scope => {\n            if (provider[1].$scope.indexOf(scope) !== -1) {\n              fromParentModule[name] = [ provider[2], provider[1] ];\n              matchedScopes[scope] = true;\n            }\n          });\n        }\n      }\n\n      forceNewInstances.forEach(scope => {\n        if (!matchedScopes[scope]) {\n          throw new Error('No provider for \"' + scope + '\". Cannot use provider from the parent!');\n        }\n      });\n\n      modules.unshift(fromParentModule);\n    }\n\n    return new Injector(modules, self);\n  }\n\n  const factoryMap = {\n    factory: invoke,\n    type: instantiate,\n    value: function(value) {\n      return value;\n    }\n  };\n\n  /**\n   * @param {ModuleDefinition} moduleDefinition\n   * @param {Injector} injector\n   */\n  function createInitializer(moduleDefinition, injector) {\n\n    const initializers = moduleDefinition.__init__ || [];\n\n    return function() {\n      initializers.forEach(initializer => {\n\n        // eagerly resolve component (fn or string)\n        if (typeof initializer === 'string') {\n          injector.get(initializer);\n        } else {\n          injector.invoke(initializer);\n        }\n      });\n    };\n  }\n\n  /**\n   * @param {ModuleDefinition} moduleDefinition\n   */\n  function loadModule(moduleDefinition) {\n\n    const moduleExports = moduleDefinition.__exports__;\n\n    // private module\n    if (moduleExports) {\n      const nestedModules = moduleDefinition.__modules__;\n\n      const clonedModule = Object.keys(moduleDefinition).reduce((clonedModule, key) => {\n\n        if (key !== '__exports__' && key !== '__modules__' && key !== '__init__' && key !== '__depends__') {\n          clonedModule[key] = moduleDefinition[key];\n        }\n\n        return clonedModule;\n      }, Object.create(null));\n\n      const childModules = (nestedModules || []).concat(clonedModule);\n\n      const privateInjector = createChild(childModules);\n      const getFromPrivateInjector = annotate(function(key) {\n        return privateInjector.get(key);\n      });\n\n      moduleExports.forEach(function(key) {\n        providers[key] = [ getFromPrivateInjector, key, 'private', privateInjector ];\n      });\n\n      // ensure child injector initializes\n      const initializers = (moduleDefinition.__init__ || []).slice();\n\n      initializers.unshift(function() {\n        privateInjector.init();\n      });\n\n      moduleDefinition = Object.assign({}, moduleDefinition, {\n        __init__: initializers\n      });\n\n      return createInitializer(moduleDefinition, privateInjector);\n    }\n\n    // normal module\n    Object.keys(moduleDefinition).forEach(function(key) {\n\n      if (key === '__init__' || key === '__depends__') {\n        return;\n      }\n\n      const typeDeclaration = /** @type { TypedDeclaration } */ (\n        moduleDefinition[key]\n      );\n\n      if (typeDeclaration[2] === 'private') {\n        providers[key] = typeDeclaration;\n        return;\n      }\n\n      const type = typeDeclaration[0];\n      const value = typeDeclaration[1];\n\n      providers[key] = [ factoryMap[type], arrayUnwrap(type, value), type ];\n    });\n\n    return createInitializer(moduleDefinition, self);\n  }\n\n  /**\n   * @param {ModuleDefinition[]} moduleDefinitions\n   * @param {ModuleDefinition} moduleDefinition\n   *\n   * @return {ModuleDefinition[]}\n   */\n  function resolveDependencies(moduleDefinitions, moduleDefinition) {\n\n    if (moduleDefinitions.indexOf(moduleDefinition) !== -1) {\n      return moduleDefinitions;\n    }\n\n    moduleDefinitions = (moduleDefinition.__depends__ || []).reduce(resolveDependencies, moduleDefinitions);\n\n    if (moduleDefinitions.indexOf(moduleDefinition) !== -1) {\n      return moduleDefinitions;\n    }\n\n    return moduleDefinitions.concat(moduleDefinition);\n  }\n\n  /**\n   * @param {ModuleDefinition[]} moduleDefinitions\n   *\n   * @return { () => void } initializerFn\n   */\n  function bootstrap(moduleDefinitions) {\n\n    const initializers = moduleDefinitions\n      .reduce(resolveDependencies, [])\n      .map(loadModule);\n\n    let initialized = false;\n\n    return function() {\n\n      if (initialized) {\n        return;\n      }\n\n      initialized = true;\n\n      initializers.forEach(initializer => initializer());\n    };\n  }\n\n  // public API\n  this.get = get;\n  this.invoke = invoke;\n  this.instantiate = instantiate;\n  this.createChild = createChild;\n\n  // setup\n  this.init = bootstrap(modules);\n}\n\n\n// helpers ///////////////\n\nfunction arrayUnwrap(type, value) {\n  if (type !== 'value' && isArray(value)) {\n    value = annotate(value.slice());\n  }\n\n  return value;\n}\n\nexport { Injector, annotate, parseAnnotations };\n//# sourceMappingURL=index.js.map\n","var DEFAULT_RENDER_PRIORITY = 1000;\r\n\r\n/**\r\n * @typedef {import('../core/Types').ElementLike} Element\r\n * @typedef {import('../core/Types').ConnectionLike} Connection\r\n * @typedef {import('../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * The base implementation of shape and connection renderers.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {number} [renderPriority=1000]\r\n */\r\nexport default function BaseRenderer(eventBus, renderPriority) {\r\n  var self = this;\r\n\r\n  renderPriority = renderPriority || DEFAULT_RENDER_PRIORITY;\r\n\r\n  eventBus.on([ 'render.shape', 'render.connection' ], renderPriority, function(evt, context) {\r\n    var type = evt.type,\r\n        element = context.element,\r\n        visuals = context.gfx,\r\n        attrs = context.attrs;\r\n\r\n    if (self.canRender(element)) {\r\n      if (type === 'render.shape') {\r\n        return self.drawShape(visuals, element, attrs);\r\n      } else {\r\n        return self.drawConnection(visuals, element, attrs);\r\n      }\r\n    }\r\n  });\r\n\r\n  eventBus.on([ 'render.getShapePath', 'render.getConnectionPath' ], renderPriority, function(evt, element) {\r\n    if (self.canRender(element)) {\r\n      if (evt.type === 'render.getShapePath') {\r\n        return self.getShapePath(element);\r\n      } else {\r\n        return self.getConnectionPath(element);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Checks whether an element can be rendered.\r\n *\r\n * @param {Element} element The element to be rendered.\r\n *\r\n * @return {boolean} Whether the element can be rendered.\r\n */\r\nBaseRenderer.prototype.canRender = function(element) {};\r\n\r\n/**\r\n * Draws a shape.\r\n *\r\n * @param {SVGElement} visuals The SVG element to draw the shape into.\r\n * @param {Shape} shape The shape to be drawn.\r\n *\r\n * @return {SVGElement} The SVG element of the shape drawn.\r\n */\r\nBaseRenderer.prototype.drawShape = function(visuals, shape) {};\r\n\r\n/**\r\n * Draws a connection.\r\n *\r\n * @param {SVGElement} visuals The SVG element to draw the connection into.\r\n * @param {Connection} connection The connection to be drawn.\r\n *\r\n * @return {SVGElement} The SVG element of the connection drawn.\r\n */\r\nBaseRenderer.prototype.drawConnection = function(visuals, connection) {};\r\n\r\n/**\r\n * Gets the SVG path of the graphical representation of a shape.\r\n *\r\n * @param {Shape} shape The shape.\r\n *\r\n * @return {string} The SVG path of the shape.\r\n */\r\nBaseRenderer.prototype.getShapePath = function(shape) {};\r\n\r\n/**\r\n * Gets the SVG path of the graphical representation of a connection.\r\n *\r\n * @param {Connection} connection The connection.\r\n *\r\n * @return {string} The SVG path of the connection.\r\n */\r\nBaseRenderer.prototype.getConnectionPath = function(connection) {};\r\n","import {\r\n  isNumber\r\n} from 'min-dash';\r\n\r\nimport {\r\n  attr as svgAttr,\r\n  create as svgCreate\r\n} from 'tiny-svg';\r\n\r\n\r\n/**\r\n * @typedef {(string|number)[]} Component\r\n *\r\n * @typedef {import('../util/Types').Point} Point\r\n */\r\n\r\n/**\r\n * @param {Component[] | Component[][]} elements\r\n *\r\n * @return {string}\r\n */\r\nexport function componentsToPath(elements) {\r\n  return elements.flat().join(',').replace(/,?([A-z]),?/g, '$1');\r\n}\r\n\r\n/**\r\n * @param {Point[]} points\r\n *\r\n * @return {string}\r\n */\r\nexport function toSVGPoints(points) {\r\n  var result = '';\r\n\r\n  for (var i = 0, p; (p = points[i]); i++) {\r\n    result += p.x + ',' + p.y + ' ';\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * @param {Point} point\r\n *\r\n * @return {Component[]}\r\n */\r\nfunction move(point) {\r\n  return [ 'M', point.x, point.y ];\r\n}\r\n\r\n/**\r\n * @param {Point} point\r\n *\r\n * @return {Component[]}\r\n */\r\nfunction lineTo(point) {\r\n  return [ 'L', point.x, point.y ];\r\n}\r\n\r\n/**\r\n * @param {Point} p1\r\n * @param {Point} p2\r\n * @param {Point} p3\r\n *\r\n * @return {Component[]}\r\n */\r\nfunction curveTo(p1, p2, p3) {\r\n  return [ 'C', p1.x, p1.y, p2.x, p2.y, p3.x, p3.y ];\r\n}\r\n\r\n/**\r\n * @param {Point[]} waypoints\r\n * @param {number} [cornerRadius]\r\n * @return {Component[][]}\r\n */\r\nfunction drawPath(waypoints, cornerRadius) {\r\n  const pointCount = waypoints.length;\r\n\r\n  const path = [ move(waypoints[0]) ];\r\n\r\n  for (let i = 1; i < pointCount; i++) {\r\n\r\n    const pointBefore = waypoints[i - 1];\r\n    const point = waypoints[i];\r\n    const pointAfter = waypoints[i + 1];\r\n\r\n    if (!pointAfter || !cornerRadius) {\r\n      path.push(lineTo(point));\r\n\r\n      continue;\r\n    }\r\n\r\n    const effectiveRadius = Math.min(\r\n      cornerRadius,\r\n      vectorLength(point.x - pointBefore.x, point.y - pointBefore.y),\r\n      vectorLength(pointAfter.x - point.x, pointAfter.y - point.y)\r\n    );\r\n\r\n    if (!effectiveRadius) {\r\n      path.push(lineTo(point));\r\n\r\n      continue;\r\n    }\r\n\r\n    const beforePoint = getPointAtLength(point, pointBefore, effectiveRadius);\r\n    const beforePoint2 = getPointAtLength(point, pointBefore, effectiveRadius * .5);\r\n\r\n    const afterPoint = getPointAtLength(point, pointAfter, effectiveRadius);\r\n    const afterPoint2 = getPointAtLength(point, pointAfter, effectiveRadius * .5);\r\n\r\n    path.push(lineTo(beforePoint));\r\n    path.push(curveTo(beforePoint2, afterPoint2, afterPoint));\r\n  }\r\n\r\n  return path;\r\n}\r\n\r\nfunction getPointAtLength(start, end, length) {\r\n\r\n  const deltaX = end.x - start.x;\r\n  const deltaY = end.y - start.y;\r\n\r\n  const totalLength = vectorLength(deltaX, deltaY);\r\n\r\n  const percent = length / totalLength;\r\n\r\n  return {\r\n    x: start.x + deltaX * percent,\r\n    y: start.y + deltaY * percent\r\n  };\r\n}\r\n\r\nfunction vectorLength(x, y) {\r\n  return Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));\r\n}\r\n\r\n/**\r\n * @param {Point[]} points\r\n * @param {number|Object} [attrs]\r\n * @param {number} [radius]\r\n *\r\n * @return {SVGElement}\r\n */\r\nexport function createLine(points, attrs, radius) {\r\n\r\n  if (isNumber(attrs)) {\r\n    radius = attrs;\r\n    attrs = null;\r\n  }\r\n\r\n  if (!attrs) {\r\n    attrs = {};\r\n  }\r\n\r\n  const line = svgCreate('path', attrs);\r\n\r\n  if (isNumber(radius)) {\r\n    line.dataset.cornerRadius = String(radius);\r\n  }\r\n\r\n  return updateLine(line, points);\r\n}\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {Point[]} points\r\n *\r\n * @return {SVGElement}\r\n */\r\nexport function updateLine(gfx, points) {\r\n\r\n  const cornerRadius = parseInt(gfx.dataset.cornerRadius, 10) || 0;\r\n\r\n  svgAttr(gfx, {\r\n    d: componentsToPath(drawPath(points, cornerRadius))\r\n  });\r\n\r\n  return gfx;\r\n}\r\n","import {\r\n  assign,\r\n  filter,\r\n  find,\r\n  isArray,\r\n  isNumber,\r\n  isObject,\r\n  isUndefined,\r\n  groupBy,\r\n  forEach\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../model/Types').Connection} Connection\r\n * @typedef {import('../model/Types').Element} Element\r\n * @typedef {import('../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../util/Types').Rect} Rect\r\n *\r\n * @typedef { {\r\n *   allShapes: Record<string, Shape>,\r\n *   allConnections: Record<string, Connection>,\r\n *   topLevel: Record<string, Element>,\r\n *   enclosedConnections: Record<string, Connection>,\r\n *   enclosedElements: Record<string, Element>\r\n * } } Closure\r\n */\r\n\r\n/**\r\n * Get parent elements.\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {Element[]}\r\n */\r\nexport function getParents(elements) {\r\n\r\n  // find elements that are not children of any other elements\r\n  return filter(elements, function(element) {\r\n    return !find(elements, function(e) {\r\n      return e !== element && getParent(element, e);\r\n    });\r\n  });\r\n}\r\n\r\n\r\nfunction getParent(element, parent) {\r\n  if (!parent) {\r\n    return;\r\n  }\r\n\r\n  if (element === parent) {\r\n    return parent;\r\n  }\r\n\r\n  if (!element.parent) {\r\n    return;\r\n  }\r\n\r\n  return getParent(element.parent, parent);\r\n}\r\n\r\n\r\n/**\r\n * Adds an element to a collection and returns true if the\r\n * element was added.\r\n *\r\n * @param {Object[]} elements\r\n * @param {Object} element\r\n * @param {boolean} [unique]\r\n */\r\nexport function add(elements, element, unique) {\r\n  var canAdd = !unique || elements.indexOf(element) === -1;\r\n\r\n  if (canAdd) {\r\n    elements.push(element);\r\n  }\r\n\r\n  return canAdd;\r\n}\r\n\r\n\r\n/**\r\n * Iterate over each element in a collection, calling the iterator function `fn`\r\n * with (element, index, recursionDepth).\r\n *\r\n * Recurse into all elements that are returned by `fn`.\r\n *\r\n * @param {Element|Element[]} elements\r\n * @param {(element: Element, index: number, depth: number) => Element[] | boolean | undefined} fn\r\n * @param {number} [depth] maximum recursion depth\r\n */\r\nexport function eachElement(elements, fn, depth) {\r\n\r\n  depth = depth || 0;\r\n\r\n  if (!isArray(elements)) {\r\n    elements = [ elements ];\r\n  }\r\n\r\n  forEach(elements, function(s, i) {\r\n    var filter = fn(s, i, depth);\r\n\r\n    if (isArray(filter) && filter.length) {\r\n      eachElement(filter, fn, depth + 1);\r\n    }\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * Collects self + child elements up to a given depth from a list of elements.\r\n *\r\n * @param {Element|Element[]} elements the elements to select the children from\r\n * @param {boolean} unique whether to return a unique result set (no duplicates)\r\n * @param {number} maxDepth the depth to search through or -1 for infinite\r\n *\r\n * @return {Element[]} found elements\r\n */\r\nexport function selfAndChildren(elements, unique, maxDepth) {\r\n  var result = [],\r\n      processedChildren = [];\r\n\r\n  eachElement(elements, function(element, i, depth) {\r\n    add(result, element, unique);\r\n\r\n    var children = element.children;\r\n\r\n    // max traversal depth not reached yet\r\n    if (maxDepth === -1 || depth < maxDepth) {\r\n\r\n      // children exist && children not yet processed\r\n      if (children && add(processedChildren, children, unique)) {\r\n        return children;\r\n      }\r\n    }\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Return self + direct children for a number of elements\r\n *\r\n * @param {Element[]} elements to query\r\n * @param {boolean} [allowDuplicates] to allow duplicates in the result set\r\n *\r\n * @return {Element[]} the collected elements\r\n */\r\nexport function selfAndDirectChildren(elements, allowDuplicates) {\r\n  return selfAndChildren(elements, !allowDuplicates, 1);\r\n}\r\n\r\n\r\n/**\r\n * Return self + ALL children for a number of elements\r\n *\r\n * @param {Element[]} elements to query\r\n * @param {boolean} [allowDuplicates] to allow duplicates in the result set\r\n *\r\n * @return {Element[]} the collected elements\r\n */\r\nexport function selfAndAllChildren(elements, allowDuplicates) {\r\n  return selfAndChildren(elements, !allowDuplicates, -1);\r\n}\r\n\r\n\r\n/**\r\n * Gets the the closure for all selected elements,\r\n * their enclosed children and connections.\r\n *\r\n * @param {Element[]} elements\r\n * @param {boolean} [isTopLevel=true]\r\n * @param {Closure} [closure]\r\n *\r\n * @return {Closure} newClosure\r\n */\r\nexport function getClosure(elements, isTopLevel, closure) {\r\n\r\n  if (isUndefined(isTopLevel)) {\r\n    isTopLevel = true;\r\n  }\r\n\r\n  if (isObject(isTopLevel)) {\r\n    closure = isTopLevel;\r\n    isTopLevel = true;\r\n  }\r\n\r\n\r\n  closure = closure || {};\r\n\r\n  var allShapes = copyObject(closure.allShapes),\r\n      allConnections = copyObject(closure.allConnections),\r\n      enclosedElements = copyObject(closure.enclosedElements),\r\n      enclosedConnections = copyObject(closure.enclosedConnections);\r\n\r\n  var topLevel = copyObject(\r\n    closure.topLevel,\r\n    isTopLevel && groupBy(elements, function(e) { return e.id; })\r\n  );\r\n\r\n\r\n  function handleConnection(c) {\r\n    if (topLevel[c.source.id] && topLevel[c.target.id]) {\r\n      topLevel[c.id] = [ c ];\r\n    }\r\n\r\n    // not enclosed as a child, but maybe logically\r\n    // (connecting two moved elements?)\r\n    if (allShapes[c.source.id] && allShapes[c.target.id]) {\r\n      enclosedConnections[c.id] = enclosedElements[c.id] = c;\r\n    }\r\n\r\n    allConnections[c.id] = c;\r\n  }\r\n\r\n  function handleElement(element) {\r\n\r\n    enclosedElements[element.id] = element;\r\n\r\n    if (element.waypoints) {\r\n\r\n      // remember connection\r\n      enclosedConnections[element.id] = allConnections[element.id] = element;\r\n    } else {\r\n\r\n      // remember shape\r\n      allShapes[element.id] = element;\r\n\r\n      // remember all connections\r\n      forEach(element.incoming, handleConnection);\r\n\r\n      forEach(element.outgoing, handleConnection);\r\n\r\n      // recurse into children\r\n      return element.children;\r\n    }\r\n  }\r\n\r\n  eachElement(elements, handleElement);\r\n\r\n  return {\r\n    allShapes: allShapes,\r\n    allConnections: allConnections,\r\n    topLevel: topLevel,\r\n    enclosedConnections: enclosedConnections,\r\n    enclosedElements: enclosedElements\r\n  };\r\n}\r\n\r\n/**\r\n * Returns the surrounding bbox for all elements in\r\n * the array or the element primitive.\r\n *\r\n * @param {Element|Element[]} elements\r\n * @param {boolean} [stopRecursion=false]\r\n *\r\n * @return {Rect}\r\n */\r\nexport function getBBox(elements, stopRecursion) {\r\n\r\n  stopRecursion = !!stopRecursion;\r\n  if (!isArray(elements)) {\r\n    elements = [ elements ];\r\n  }\r\n\r\n  var minX,\r\n      minY,\r\n      maxX,\r\n      maxY;\r\n\r\n  forEach(elements, function(element) {\r\n\r\n    // If element is a connection the bbox must be computed first\r\n    var bbox = element;\r\n    if (element.waypoints && !stopRecursion) {\r\n      bbox = getBBox(element.waypoints, true);\r\n    }\r\n\r\n    var x = bbox.x,\r\n        y = bbox.y,\r\n        height = bbox.height || 0,\r\n        width = bbox.width || 0;\r\n\r\n    if (x < minX || minX === undefined) {\r\n      minX = x;\r\n    }\r\n    if (y < minY || minY === undefined) {\r\n      minY = y;\r\n    }\r\n\r\n    if ((x + width) > maxX || maxX === undefined) {\r\n      maxX = x + width;\r\n    }\r\n    if ((y + height) > maxY || maxY === undefined) {\r\n      maxY = y + height;\r\n    }\r\n  });\r\n\r\n  return {\r\n    x: minX,\r\n    y: minY,\r\n    height: maxY - minY,\r\n    width: maxX - minX\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Returns all elements that are enclosed from the bounding box.\r\n *\r\n *   * If bbox.(width|height) is not specified the method returns\r\n *     all elements with element.x/y > bbox.x/y\r\n *   * If only bbox.x or bbox.y is specified, method return all elements with\r\n *     e.x > bbox.x or e.y > bbox.y\r\n *\r\n * @param {Element[]} elements List of Elements to search through\r\n * @param {Rect} bbox the enclosing bbox.\r\n *\r\n * @return {Element[]} enclosed elements\r\n */\r\nexport function getEnclosedElements(elements, bbox) {\r\n\r\n  var filteredElements = {};\r\n\r\n  forEach(elements, function(element) {\r\n\r\n    var e = element;\r\n\r\n    if (e.waypoints) {\r\n      e = getBBox(e);\r\n    }\r\n\r\n    if (!isNumber(bbox.y) && (e.x > bbox.x)) {\r\n      filteredElements[element.id] = element;\r\n    }\r\n    if (!isNumber(bbox.x) && (e.y > bbox.y)) {\r\n      filteredElements[element.id] = element;\r\n    }\r\n    if (e.x > bbox.x && e.y > bbox.y) {\r\n      if (isNumber(bbox.width) && isNumber(bbox.height) &&\r\n          e.width + e.x < bbox.width + bbox.x &&\r\n          e.height + e.y < bbox.height + bbox.y) {\r\n\r\n        filteredElements[element.id] = element;\r\n      } else if (!isNumber(bbox.width) || !isNumber(bbox.height)) {\r\n        filteredElements[element.id] = element;\r\n      }\r\n    }\r\n  });\r\n\r\n  return filteredElements;\r\n}\r\n\r\n/**\r\n * Get the element's type\r\n *\r\n * @param {Element} element\r\n *\r\n * @return {'connection' | 'shape' | 'root'}\r\n */\r\nexport function getType(element) {\r\n\r\n  if ('waypoints' in element) {\r\n    return 'connection';\r\n  }\r\n\r\n  if ('x' in element) {\r\n    return 'shape';\r\n  }\r\n\r\n  return 'root';\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isFrameElement(element) {\r\n  return !!(element && element.isFrame);\r\n}\r\n\r\n// helpers ///////////////////////////////\r\n\r\nfunction copyObject(src1, src2) {\r\n  return assign({}, src1 || {}, src2 || {});\r\n}\r\n","import inherits from 'inherits-browser';\r\n\r\nimport BaseRenderer from './BaseRenderer';\r\n\r\nimport {\r\n  componentsToPath,\r\n  createLine\r\n} from '../util/RenderUtil';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate\r\n} from 'tiny-svg';\r\n\r\nimport { assign } from 'min-dash';\r\n\r\nimport {\r\n  isFrameElement\r\n} from '../util/Elements';\r\n\r\n/**\r\n * @typedef {import('../core/EventBus').default} EventBus\r\n * @typedef {import('./Styles').default} Styles\r\n */\r\n\r\n// apply default renderer with lowest possible priority\r\n// so that it only kicks in if noone else could render\r\nvar DEFAULT_RENDER_PRIORITY = 1;\r\n\r\n/**\r\n * The default renderer used for shapes and connections.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Styles} styles\r\n */\r\nexport default function DefaultRenderer(eventBus, styles) {\r\n\r\n  BaseRenderer.call(this, eventBus, DEFAULT_RENDER_PRIORITY);\r\n\r\n  this.CONNECTION_STYLE = styles.style([ 'no-fill' ], { strokeWidth: 5, stroke: 'fuchsia' });\r\n  this.SHAPE_STYLE = styles.style({ fill: 'white', stroke: 'fuchsia', strokeWidth: 2 });\r\n  this.FRAME_STYLE = styles.style([ 'no-fill' ], { stroke: 'fuchsia', strokeDasharray: 4, strokeWidth: 2 });\r\n}\r\n\r\ninherits(DefaultRenderer, BaseRenderer);\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nDefaultRenderer.prototype.canRender = function() {\r\n  return true;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nDefaultRenderer.prototype.drawShape = function drawShape(visuals, element, attrs) {\r\n  var rect = svgCreate('rect');\r\n\r\n  svgAttr(rect, {\r\n    x: 0,\r\n    y: 0,\r\n    width: element.width || 0,\r\n    height: element.height || 0\r\n  });\r\n\r\n  if (isFrameElement(element)) {\r\n    svgAttr(rect, assign({}, this.FRAME_STYLE, attrs || {}));\r\n  } else {\r\n    svgAttr(rect, assign({}, this.SHAPE_STYLE, attrs || {}));\r\n  }\r\n\r\n  svgAppend(visuals, rect);\r\n\r\n  return rect;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nDefaultRenderer.prototype.drawConnection = function drawConnection(visuals, connection, attrs) {\r\n\r\n  var line = createLine(connection.waypoints, assign({}, this.CONNECTION_STYLE, attrs || {}));\r\n  svgAppend(visuals, line);\r\n\r\n  return line;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nDefaultRenderer.prototype.getShapePath = function getShapePath(shape) {\r\n\r\n  var x = shape.x,\r\n      y = shape.y,\r\n      width = shape.width,\r\n      height = shape.height;\r\n\r\n  var shapePath = [\r\n    [ 'M', x, y ],\r\n    [ 'l', width, 0 ],\r\n    [ 'l', 0, height ],\r\n    [ 'l', -width, 0 ],\r\n    [ 'z' ]\r\n  ];\r\n\r\n  return componentsToPath(shapePath);\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nDefaultRenderer.prototype.getConnectionPath = function getConnectionPath(connection) {\r\n  var waypoints = connection.waypoints;\r\n\r\n  var idx, point, connectionPath = [];\r\n\r\n  for (idx = 0; (point = waypoints[idx]); idx++) {\r\n\r\n    // take invisible docking into account\r\n    // when creating the path\r\n    point = point.original || point;\r\n\r\n    connectionPath.push([ idx === 0 ? 'M' : 'L', point.x, point.y ]);\r\n  }\r\n\r\n  return componentsToPath(connectionPath);\r\n};\r\n\r\nDefaultRenderer.$inject = [ 'eventBus', 'styles' ];\r\n","import {\r\n  isArray,\r\n  assign,\r\n  reduce\r\n} from 'min-dash';\r\n\r\n\r\n/**\r\n * A component that manages shape styles\r\n */\r\nexport default function Styles() {\r\n\r\n  var defaultTraits = {\r\n\r\n    'no-fill': {\r\n      fill: 'none'\r\n    },\r\n    'no-border': {\r\n      strokeOpacity: 0.0\r\n    },\r\n    'no-events': {\r\n      pointerEvents: 'none'\r\n    }\r\n  };\r\n\r\n  var self = this;\r\n\r\n  /**\r\n   * Builds a style definition from a className, a list of traits and an object\r\n   * of additional attributes.\r\n   *\r\n   * @param {string} className\r\n   * @param {string[]} [traits]\r\n   * @param {Object} [additionalAttrs]\r\n   *\r\n   * @return {Object} the style definition\r\n   */\r\n  this.cls = function(className, traits, additionalAttrs) {\r\n    var attrs = this.style(traits, additionalAttrs);\r\n\r\n    return assign(attrs, { 'class': className });\r\n  };\r\n\r\n  /**\r\n   * Builds a style definition from a list of traits and an object of additional\r\n   * attributes.\r\n   *\r\n   * @param {string[]} [traits]\r\n   * @param {Object} additionalAttrs\r\n   *\r\n   * @return {Object} the style definition\r\n   */\r\n  this.style = function(traits, additionalAttrs) {\r\n\r\n    if (!isArray(traits) && !additionalAttrs) {\r\n      additionalAttrs = traits;\r\n      traits = [];\r\n    }\r\n\r\n    var attrs = reduce(traits, function(attrs, t) {\r\n      return assign(attrs, defaultTraits[t] || {});\r\n    }, {});\r\n\r\n    return additionalAttrs ? assign(attrs, additionalAttrs) : attrs;\r\n  };\r\n\r\n\r\n  /**\r\n   * Computes a style definition from a list of traits and an object of\r\n   * additional attributes, with custom style definition object.\r\n   *\r\n   * @param {Object} custom\r\n   * @param {string[]} [traits]\r\n   * @param {Object} defaultStyles\r\n   *\r\n   * @return {Object} the style definition\r\n   */\r\n  this.computeStyle = function(custom, traits, defaultStyles) {\r\n    if (!isArray(traits)) {\r\n      defaultStyles = traits;\r\n      traits = [];\r\n    }\r\n\r\n    return self.style(traits || [], assign({}, defaultStyles, custom || {}));\r\n  };\r\n}\r\n","import DefaultRenderer from './DefaultRenderer';\r\nimport Styles from './Styles';\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'defaultRenderer' ],\r\n  defaultRenderer: [ 'type', DefaultRenderer ],\r\n  styles: [ 'type', Styles ]\r\n};\r\n","/**\r\n * Failsafe remove an element from a collection\r\n *\r\n * @param {Array<Object>} [collection]\r\n * @param {Object} [element]\r\n *\r\n * @return {number} the previous index of the element\r\n */\r\nexport function remove(collection, element) {\r\n\r\n  if (!collection || !element) {\r\n    return -1;\r\n  }\r\n\r\n  var idx = collection.indexOf(element);\r\n\r\n  if (idx !== -1) {\r\n    collection.splice(idx, 1);\r\n  }\r\n\r\n  return idx;\r\n}\r\n\r\n/**\r\n * Fail save add an element to the given connection, ensuring\r\n * it does not yet exist.\r\n *\r\n * @param {Array<Object>} collection\r\n * @param {Object} element\r\n * @param {number} [idx]\r\n */\r\nexport function add(collection, element, idx) {\r\n\r\n  if (!collection || !element) {\r\n    return;\r\n  }\r\n\r\n  if (typeof idx !== 'number') {\r\n    idx = -1;\r\n  }\r\n\r\n  var currentIdx = collection.indexOf(element);\r\n\r\n  if (currentIdx !== -1) {\r\n\r\n    if (currentIdx === idx) {\r\n\r\n      // nothing to do, position has not changed\r\n      return;\r\n    } else {\r\n\r\n      if (idx !== -1) {\r\n\r\n        // remove from current position\r\n        collection.splice(currentIdx, 1);\r\n      } else {\r\n\r\n        // already exists in collection\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (idx !== -1) {\r\n\r\n    // insert at specified position\r\n    collection.splice(idx, 0, element);\r\n  } else {\r\n\r\n    // push to end\r\n    collection.push(element);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Fail save get the index of an element in a collection.\r\n *\r\n * @param {Array<Object>} collection\r\n * @param {Object} element\r\n *\r\n * @return {number} the index or -1 if collection or element do\r\n *                  not exist or the element is not contained.\r\n */\r\nexport function indexOf(collection, element) {\r\n\r\n  if (!collection || !element) {\r\n    return -1;\r\n  }\r\n\r\n  return collection.indexOf(element);\r\n}\r\n","import {\r\n  every\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../util/Types').Axis} Axis\r\n * @typedef {import('../util/Types').Point} Point\r\n * @typedef {import('../util/Types').Rect} Rect\r\n */\r\n\r\n/**\r\n * Computes the distance between two points.\r\n *\r\n * @param {Point} a\r\n * @param {Point} b\r\n *\r\n * @return {number} The distance between the two points.\r\n */\r\nexport function pointDistance(a, b) {\r\n  if (!a || !b) {\r\n    return -1;\r\n  }\r\n\r\n  return Math.sqrt(\r\n    Math.pow(a.x - b.x, 2) +\r\n    Math.pow(a.y - b.y, 2)\r\n  );\r\n}\r\n\r\n\r\n/**\r\n * Returns true if the point r is on the line between p and q.\r\n *\r\n * @param {Point} p\r\n * @param {Point} q\r\n * @param {Point} r\r\n * @param {number} [accuracy=5] The accuracy with which to check (lower is better).\r\n *\r\n * @return {boolean}\r\n */\r\nexport function pointsOnLine(p, q, r, accuracy) {\r\n\r\n  if (typeof accuracy === 'undefined') {\r\n    accuracy = 5;\r\n  }\r\n\r\n  if (!p || !q || !r) {\r\n    return false;\r\n  }\r\n\r\n  var val = (q.x - p.x) * (r.y - p.y) - (q.y - p.y) * (r.x - p.x),\r\n      dist = pointDistance(p, q);\r\n\r\n  // @see http://stackoverflow.com/a/907491/412190\r\n  return Math.abs(val / dist) <= accuracy;\r\n}\r\n\r\n\r\nvar ALIGNED_THRESHOLD = 2;\r\n\r\n/**\r\n * Check whether two points are horizontally or vertically aligned.\r\n *\r\n * @param {Point[]|Point} a\r\n * @param {Point} [b]\r\n *\r\n * @return {string|boolean} If and how the two points are aligned ('h', 'v' or `false`).\r\n */\r\nexport function pointsAligned(a, b) {\r\n  var points = Array.from(arguments).flat();\r\n\r\n  const axisMap = {\r\n    'x': 'v',\r\n    'y': 'h'\r\n  };\r\n\r\n  for (const [ axis, orientation ] of Object.entries(axisMap)) {\r\n    if (pointsAlignedOnAxis(axis, points)) {\r\n      return orientation;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * @param {Axis} axis\r\n * @param {Point[]} points\r\n *\r\n * @return {boolean}\r\n */\r\nexport function pointsAlignedOnAxis(axis, points) {\r\n  const referencePoint = points[0];\r\n\r\n  return every(points, function(point) {\r\n    return Math.abs(referencePoint[axis] - point[axis]) <= ALIGNED_THRESHOLD;\r\n  });\r\n}\r\n\r\n/**\r\n * Returns true if the point p is inside the rectangle rect\r\n *\r\n * @param {Point} p\r\n * @param {Rect} rect\r\n * @param {number} tolerance\r\n *\r\n * @return {boolean}\r\n */\r\nexport function pointInRect(p, rect, tolerance) {\r\n  tolerance = tolerance || 0;\r\n\r\n  return p.x > rect.x - tolerance &&\r\n         p.y > rect.y - tolerance &&\r\n         p.x < rect.x + rect.width + tolerance &&\r\n         p.y < rect.y + rect.height + tolerance;\r\n}\r\n\r\n/**\r\n * Returns a point in the middle of points p and q\r\n *\r\n * @param {Point} p\r\n * @param {Point} q\r\n *\r\n * @return {Point} The mid point between the two points.\r\n */\r\nexport function getMidPoint(p, q) {\r\n  return {\r\n    x: Math.round(p.x + ((q.x - p.x) / 2.0)),\r\n    y: Math.round(p.y + ((q.y - p.y) / 2.0))\r\n  };\r\n}\r\n","/**\n * This file contains source code adapted from Snap.svg (licensed Apache-2.0).\n *\n * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js\n */\n\n/* eslint no-fallthrough: \"off\" */\n\nvar p2s = /,?([a-z]),?/gi,\n    toFloat = parseFloat,\n    math = Math,\n    PI = math.PI,\n    mmin = math.min,\n    mmax = math.max,\n    pow = math.pow,\n    abs = math.abs,\n    pathCommand = /([a-z])[\\s,]*((-?\\d*\\.?\\d*(?:e[-+]?\\d+)?[\\s]*,?[\\s]*)+)/ig,\n    pathValues = /(-?\\d*\\.?\\d*(?:e[-+]?\\d+)?)[\\s]*,?[\\s]*/ig;\n\nvar isArray = Array.isArray || function(o) { return o instanceof Array; };\n\nfunction hasProperty(obj, property) {\n  return Object.prototype.hasOwnProperty.call(obj, property);\n}\n\nfunction clone(obj) {\n\n  if (typeof obj == 'function' || Object(obj) !== obj) {\n    return obj;\n  }\n\n  var res = new obj.constructor;\n\n  for (var key in obj) {\n    if (hasProperty(obj, key)) {\n      res[key] = clone(obj[key]);\n    }\n  }\n\n  return res;\n}\n\nfunction repush(array, item) {\n  for (var i = 0, ii = array.length; i < ii; i++) if (array[i] === item) {\n    return array.push(array.splice(i, 1)[0]);\n  }\n}\n\nfunction cacher(f) {\n\n  function newf() {\n\n    var arg = Array.prototype.slice.call(arguments, 0),\n        args = arg.join('\\u2400'),\n        cache = newf.cache = newf.cache || {},\n        count = newf.count = newf.count || [];\n\n    if (hasProperty(cache, args)) {\n      repush(count, args);\n      return cache[args];\n    }\n\n    count.length >= 1e3 && delete cache[count.shift()];\n    count.push(args);\n    cache[args] = f(...arguments);\n\n    return cache[args];\n  }\n  return newf;\n}\n\nfunction parsePathString(pathString) {\n\n  if (!pathString) {\n    return null;\n  }\n\n  var pth = paths(pathString);\n\n  if (pth.arr) {\n    return clone(pth.arr);\n  }\n\n  var paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0 },\n      data = [];\n\n  if (isArray(pathString) && isArray(pathString[0])) { // rough assumption\n    data = clone(pathString);\n  }\n\n  if (!data.length) {\n\n    String(pathString).replace(pathCommand, function(a, b, c) {\n      var params = [],\n          name = b.toLowerCase();\n\n      c.replace(pathValues, function(a, b) {\n        b && params.push(+b);\n      });\n\n      if (name == 'm' && params.length > 2) {\n        data.push([ b, ...params.splice(0, 2) ]);\n        name = 'l';\n        b = b == 'm' ? 'l' : 'L';\n      }\n\n      while (params.length >= paramCounts[name]) {\n        data.push([ b, ...params.splice(0, paramCounts[name]) ]);\n        if (!paramCounts[name]) {\n          break;\n        }\n      }\n    });\n  }\n\n  data.toString = paths.toString;\n  pth.arr = clone(data);\n\n  return data;\n}\n\nfunction paths(ps) {\n  var p = paths.ps = paths.ps || {};\n\n  if (p[ps]) {\n    p[ps].sleep = 100;\n  } else {\n    p[ps] = {\n      sleep: 100\n    };\n  }\n\n  setTimeout(function() {\n    for (var key in p) {\n      if (hasProperty(p, key) && key != ps) {\n        p[key].sleep--;\n        !p[key].sleep && delete p[key];\n      }\n    }\n  });\n\n  return p[ps];\n}\n\nfunction rectBBox(x, y, width, height) {\n\n  if (arguments.length === 1) {\n    y = x.y;\n    width = x.width;\n    height = x.height;\n    x = x.x;\n  }\n\n  return {\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n    x2: x + width,\n    y2: y + height\n  };\n}\n\nfunction pathToString() {\n  return this.join(',').replace(p2s, '$1');\n}\n\nfunction pathClone(pathArray) {\n  var res = clone(pathArray);\n  res.toString = pathToString;\n  return res;\n}\n\nfunction findDotsAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n  var t1 = 1 - t,\n      t13 = pow(t1, 3),\n      t12 = pow(t1, 2),\n      t2 = t * t,\n      t3 = t2 * t,\n      x = t13 * p1x + t12 * 3 * t * c1x + t1 * 3 * t * t * c2x + t3 * p2x,\n      y = t13 * p1y + t12 * 3 * t * c1y + t1 * 3 * t * t * c2y + t3 * p2y;\n\n  return {\n    x: fixError(x),\n    y: fixError(y)\n  };\n}\n\nfunction bezierBBox(points) {\n\n  var bbox = curveBBox(...points);\n\n  return rectBBox(\n    bbox.x0,\n    bbox.y0,\n    bbox.x1 - bbox.x0,\n    bbox.y1 - bbox.y0\n  );\n}\n\nfunction isPointInsideBBox(bbox, x, y) {\n  return x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height;\n}\n\nfunction isBBoxIntersect(bbox1, bbox2) {\n  bbox1 = rectBBox(bbox1);\n  bbox2 = rectBBox(bbox2);\n  return isPointInsideBBox(bbox2, bbox1.x, bbox1.y)\n    || isPointInsideBBox(bbox2, bbox1.x2, bbox1.y)\n    || isPointInsideBBox(bbox2, bbox1.x, bbox1.y2)\n    || isPointInsideBBox(bbox2, bbox1.x2, bbox1.y2)\n    || isPointInsideBBox(bbox1, bbox2.x, bbox2.y)\n    || isPointInsideBBox(bbox1, bbox2.x2, bbox2.y)\n    || isPointInsideBBox(bbox1, bbox2.x, bbox2.y2)\n    || isPointInsideBBox(bbox1, bbox2.x2, bbox2.y2)\n    || (bbox1.x < bbox2.x2 && bbox1.x > bbox2.x\n        || bbox2.x < bbox1.x2 && bbox2.x > bbox1.x)\n    && (bbox1.y < bbox2.y2 && bbox1.y > bbox2.y\n        || bbox2.y < bbox1.y2 && bbox2.y > bbox1.y);\n}\n\nfunction base3(t, p1, p2, p3, p4) {\n  var t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4,\n      t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;\n  return t * t2 - 3 * p1 + 3 * p2;\n}\n\nfunction bezlen(x1, y1, x2, y2, x3, y3, x4, y4, z) {\n\n  if (z == null) {\n    z = 1;\n  }\n\n  z = z > 1 ? 1 : z < 0 ? 0 : z;\n\n  var z2 = z / 2,\n      n = 12,\n      Tvalues = [ -.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816 ],\n      Cvalues = [ 0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472 ],\n      sum = 0;\n\n  for (var i = 0; i < n; i++) {\n    var ct = z2 * Tvalues[i] + z2,\n        xbase = base3(ct, x1, x2, x3, x4),\n        ybase = base3(ct, y1, y2, y3, y4),\n        comb = xbase * xbase + ybase * ybase;\n\n    sum += Cvalues[i] * math.sqrt(comb);\n  }\n\n  return z2 * sum;\n}\n\n\nfunction intersectLines(x1, y1, x2, y2, x3, y3, x4, y4) {\n\n  if (\n    mmax(x1, x2) < mmin(x3, x4) ||\n      mmin(x1, x2) > mmax(x3, x4) ||\n      mmax(y1, y2) < mmin(y3, y4) ||\n      mmin(y1, y2) > mmax(y3, y4)\n  ) {\n    return;\n  }\n\n  var nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\n  if (!denominator) {\n    return;\n  }\n\n  var px = fixError(nx / denominator),\n      py = fixError(ny / denominator),\n      px2 = +px.toFixed(2),\n      py2 = +py.toFixed(2);\n\n  if (\n    px2 < +mmin(x1, x2).toFixed(2) ||\n      px2 > +mmax(x1, x2).toFixed(2) ||\n      px2 < +mmin(x3, x4).toFixed(2) ||\n      px2 > +mmax(x3, x4).toFixed(2) ||\n      py2 < +mmin(y1, y2).toFixed(2) ||\n      py2 > +mmax(y1, y2).toFixed(2) ||\n      py2 < +mmin(y3, y4).toFixed(2) ||\n      py2 > +mmax(y3, y4).toFixed(2)\n  ) {\n    return;\n  }\n\n  return { x: px, y: py };\n}\n\nfunction fixError(number) {\n  return Math.round(number * 100000000000) / 100000000000;\n}\n\nfunction findBezierIntersections(bez1, bez2, justCount) {\n  var bbox1 = bezierBBox(bez1),\n      bbox2 = bezierBBox(bez2);\n\n  if (!isBBoxIntersect(bbox1, bbox2)) {\n    return justCount ? 0 : [];\n  }\n\n  // As an optimization, lines will have only 1 segment\n\n  var l1 = bezlen(...bez1),\n      l2 = bezlen(...bez2),\n      n1 = isLine(bez1) ? 1 : ~~(l1 / 5) || 1,\n      n2 = isLine(bez2) ? 1 : ~~(l2 / 5) || 1,\n      dots1 = [],\n      dots2 = [],\n      xy = {},\n      res = justCount ? 0 : [];\n\n  for (var i = 0; i < n1 + 1; i++) {\n    var p = findDotsAtSegment(...bez1, i / n1);\n    dots1.push({ x: p.x, y: p.y, t: i / n1 });\n  }\n\n  for (i = 0; i < n2 + 1; i++) {\n    p = findDotsAtSegment(...bez2, i / n2);\n    dots2.push({ x: p.x, y: p.y, t: i / n2 });\n  }\n\n  for (i = 0; i < n1; i++) {\n\n    for (var j = 0; j < n2; j++) {\n      var di = dots1[i],\n          di1 = dots1[i + 1],\n          dj = dots2[j],\n          dj1 = dots2[j + 1],\n          ci = abs(di1.x - di.x) < .01 ? 'y' : 'x',\n          cj = abs(dj1.x - dj.x) < .01 ? 'y' : 'x',\n          is = intersectLines(di.x, di.y, di1.x, di1.y, dj.x, dj.y, dj1.x, dj1.y),\n          key;\n\n      if (is) {\n        key = is.x.toFixed(9) + '#' + is.y.toFixed(9);\n\n        if (xy[key]) {\n          continue;\n        }\n\n        xy[key] = true;\n\n        var t1 = di.t + abs((is[ci] - di[ci]) / (di1[ci] - di[ci])) * (di1.t - di.t),\n            t2 = dj.t + abs((is[cj] - dj[cj]) / (dj1[cj] - dj[cj])) * (dj1.t - dj.t);\n\n        if (t1 >= 0 && t1 <= 1 && t2 >= 0 && t2 <= 1) {\n\n          if (justCount) {\n            res++;\n          } else {\n            res.push({\n              x: is.x,\n              y: is.y,\n              t1: t1,\n              t2: t2\n            });\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n}\n\n\n/**\n * Find or counts the intersections between two SVG paths.\n *\n * Returns a number in counting mode and a list of intersections otherwise.\n *\n * A single intersection entry contains the intersection coordinates (x, y)\n * as well as additional information regarding the intersecting segments\n * on each path (segment1, segment2) and the relative location of the\n * intersection on these segments (t1, t2).\n *\n * The path may be an SVG path string or a list of path components\n * such as `[ [ 'M', 0, 10 ], [ 'L', 20, 0 ] ]`.\n *\n * @example\n *\n * var intersections = findPathIntersections(\n *   'M0,0L100,100',\n *   [ [ 'M', 0, 100 ], [ 'L', 100, 0 ] ]\n * );\n *\n * // intersections = [\n * //   { x: 50, y: 50, segment1: 1, segment2: 1, t1: 0.5, t2: 0.5 }\n * // ]\n *\n * @param {String|Array<PathDef>} path1\n * @param {String|Array<PathDef>} path2\n * @param {Boolean} [justCount=false]\n *\n * @return {Array<Intersection>|Number}\n */\nexport default function findPathIntersections(path1, path2, justCount) {\n  path1 = pathToCurve(path1);\n  path2 = pathToCurve(path2);\n\n  var x1, y1, x2, y2, x1m, y1m, x2m, y2m, bez1, bez2,\n      res = justCount ? 0 : [];\n\n  for (var i = 0, ii = path1.length; i < ii; i++) {\n    var pi = path1[i];\n\n    if (pi[0] == 'M') {\n      x1 = x1m = pi[1];\n      y1 = y1m = pi[2];\n    } else {\n\n      if (pi[0] == 'C') {\n        bez1 = [ x1, y1, ...pi.slice(1) ];\n        x1 = bez1[6];\n        y1 = bez1[7];\n      } else {\n        bez1 = [ x1, y1, x1, y1, x1m, y1m, x1m, y1m ];\n        x1 = x1m;\n        y1 = y1m;\n      }\n\n      for (var j = 0, jj = path2.length; j < jj; j++) {\n        var pj = path2[j];\n\n        if (pj[0] == 'M') {\n          x2 = x2m = pj[1];\n          y2 = y2m = pj[2];\n        } else {\n\n          if (pj[0] == 'C') {\n            bez2 = [ x2, y2, ...pj.slice(1) ];\n            x2 = bez2[6];\n            y2 = bez2[7];\n          } else {\n            bez2 = [ x2, y2, x2, y2, x2m, y2m, x2m, y2m ];\n            x2 = x2m;\n            y2 = y2m;\n          }\n\n          var intr = findBezierIntersections(bez1, bez2, justCount);\n\n          if (justCount) {\n            res += intr;\n          } else {\n\n            for (var k = 0, kk = intr.length; k < kk; k++) {\n              intr[k].segment1 = i;\n              intr[k].segment2 = j;\n              intr[k].bez1 = bez1;\n              intr[k].bez2 = bez2;\n            }\n\n            res = res.concat(intr);\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n}\n\n\nfunction pathToAbsolute(pathArray) {\n  var pth = paths(pathArray);\n\n  if (pth.abs) {\n    return pathClone(pth.abs);\n  }\n\n  if (!isArray(pathArray) || !isArray(pathArray && pathArray[0])) { // rough assumption\n    pathArray = parsePathString(pathArray);\n  }\n\n  if (!pathArray || !pathArray.length) {\n    return [ [ 'M', 0, 0 ] ];\n  }\n\n  var res = [],\n      x = 0,\n      y = 0,\n      mx = 0,\n      my = 0,\n      start = 0,\n      pa0;\n\n  if (pathArray[0][0] == 'M') {\n    x = +pathArray[0][1];\n    y = +pathArray[0][2];\n    mx = x;\n    my = y;\n    start++;\n    res[0] = [ 'M', x, y ];\n  }\n\n  for (var r, pa, i = start, ii = pathArray.length; i < ii; i++) {\n    res.push(r = []);\n    pa = pathArray[i];\n    pa0 = pa[0];\n\n    if (pa0 != pa0.toUpperCase()) {\n      r[0] = pa0.toUpperCase();\n\n      switch (r[0]) {\n      case 'A':\n        r[1] = pa[1];\n        r[2] = pa[2];\n        r[3] = pa[3];\n        r[4] = pa[4];\n        r[5] = pa[5];\n        r[6] = +pa[6] + x;\n        r[7] = +pa[7] + y;\n        break;\n      case 'V':\n        r[1] = +pa[1] + y;\n        break;\n      case 'H':\n        r[1] = +pa[1] + x;\n        break;\n      case 'M':\n        mx = +pa[1] + x;\n        my = +pa[2] + y;\n      default:\n        for (var j = 1, jj = pa.length; j < jj; j++) {\n          r[j] = +pa[j] + ((j % 2) ? x : y);\n        }\n      }\n    } else {\n      for (var k = 0, kk = pa.length; k < kk; k++) {\n        r[k] = pa[k];\n      }\n    }\n    pa0 = pa0.toUpperCase();\n\n    switch (r[0]) {\n    case 'Z':\n      x = +mx;\n      y = +my;\n      break;\n    case 'H':\n      x = r[1];\n      break;\n    case 'V':\n      y = r[1];\n      break;\n    case 'M':\n      mx = r[r.length - 2];\n      my = r[r.length - 1];\n    default:\n      x = r[r.length - 2];\n      y = r[r.length - 1];\n    }\n  }\n\n  res.toString = pathToString;\n  pth.abs = pathClone(res);\n\n  return res;\n}\n\nfunction isLine(bez) {\n  return (\n    bez[0] === bez[2] &&\n    bez[1] === bez[3] &&\n    bez[4] === bez[6] &&\n    bez[5] === bez[7]\n  );\n}\n\nfunction lineToCurve(x1, y1, x2, y2) {\n  return [\n    x1, y1, x2,\n    y2, x2, y2\n  ];\n}\n\nfunction qubicToCurve(x1, y1, ax, ay, x2, y2) {\n  var _13 = 1 / 3,\n      _23 = 2 / 3;\n\n  return [\n    _13 * x1 + _23 * ax,\n    _13 * y1 + _23 * ay,\n    _13 * x2 + _23 * ax,\n    _13 * y2 + _23 * ay,\n    x2,\n    y2\n  ];\n}\n\nfunction arcToCurve(x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\n\n  // for more information of where this math came from visit:\n  // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n  var _120 = PI * 120 / 180,\n      rad = PI / 180 * (+angle || 0),\n      res = [],\n      xy,\n      rotate = cacher(function(x, y, rad) {\n        var X = x * math.cos(rad) - y * math.sin(rad),\n            Y = x * math.sin(rad) + y * math.cos(rad);\n\n        return { x: X, y: Y };\n      });\n\n  if (!recursive) {\n    xy = rotate(x1, y1, -rad);\n    x1 = xy.x;\n    y1 = xy.y;\n    xy = rotate(x2, y2, -rad);\n    x2 = xy.x;\n    y2 = xy.y;\n\n    var x = (x1 - x2) / 2,\n        y = (y1 - y2) / 2;\n\n    var h = (x * x) / (rx * rx) + (y * y) / (ry * ry);\n\n    if (h > 1) {\n      h = math.sqrt(h);\n      rx = h * rx;\n      ry = h * ry;\n    }\n\n    var rx2 = rx * rx,\n        ry2 = ry * ry,\n        k = (large_arc_flag == sweep_flag ? -1 : 1) *\n            math.sqrt(abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x))),\n        cx = k * rx * y / ry + (x1 + x2) / 2,\n        cy = k * -ry * x / rx + (y1 + y2) / 2,\n        f1 = math.asin(((y1 - cy) / ry).toFixed(9)),\n        f2 = math.asin(((y2 - cy) / ry).toFixed(9));\n\n    f1 = x1 < cx ? PI - f1 : f1;\n    f2 = x2 < cx ? PI - f2 : f2;\n    f1 < 0 && (f1 = PI * 2 + f1);\n    f2 < 0 && (f2 = PI * 2 + f2);\n\n    if (sweep_flag && f1 > f2) {\n      f1 = f1 - PI * 2;\n    }\n    if (!sweep_flag && f2 > f1) {\n      f2 = f2 - PI * 2;\n    }\n  } else {\n    f1 = recursive[0];\n    f2 = recursive[1];\n    cx = recursive[2];\n    cy = recursive[3];\n  }\n\n  var df = f2 - f1;\n\n  if (abs(df) > _120) {\n    var f2old = f2,\n        x2old = x2,\n        y2old = y2;\n\n    f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);\n    x2 = cx + rx * math.cos(f2);\n    y2 = cy + ry * math.sin(f2);\n    res = arcToCurve(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [ f2, f2old, cx, cy ]);\n  }\n\n  df = f2 - f1;\n\n  var c1 = math.cos(f1),\n      s1 = math.sin(f1),\n      c2 = math.cos(f2),\n      s2 = math.sin(f2),\n      t = math.tan(df / 4),\n      hx = 4 / 3 * rx * t,\n      hy = 4 / 3 * ry * t,\n      m1 = [ x1, y1 ],\n      m2 = [ x1 + hx * s1, y1 - hy * c1 ],\n      m3 = [ x2 + hx * s2, y2 - hy * c2 ],\n      m4 = [ x2, y2 ];\n\n  m2[0] = 2 * m1[0] - m2[0];\n  m2[1] = 2 * m1[1] - m2[1];\n\n  if (recursive) {\n    return [ m2, m3, m4 ].concat(res);\n  } else {\n    res = [ m2, m3, m4 ].concat(res).join().split(',');\n    var newres = [];\n\n    for (var i = 0, ii = res.length; i < ii; i++) {\n      newres[i] = i % 2 ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;\n    }\n\n    return newres;\n  }\n}\n\n// Returns bounding box of cubic bezier curve.\n// Source: http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\n// Original version: NISHIO Hirokazu\n// Modifications: https://github.com/timo22345\nfunction curveBBox(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var tvalues = [],\n      bounds = [ [], [] ],\n      a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n  for (var i = 0; i < 2; ++i) {\n\n    if (i == 0) {\n      b = 6 * x0 - 12 * x1 + 6 * x2;\n      a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n      c = 3 * x1 - 3 * x0;\n    } else {\n      b = 6 * y0 - 12 * y1 + 6 * y2;\n      a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n      c = 3 * y1 - 3 * y0;\n    }\n\n    if (abs(a) < 1e-12) {\n\n      if (abs(b) < 1e-12) {\n        continue;\n      }\n\n      t = -c / b;\n\n      if (0 < t && t < 1) {\n        tvalues.push(t);\n      }\n\n      continue;\n    }\n\n    b2ac = b * b - 4 * c * a;\n    sqrtb2ac = math.sqrt(b2ac);\n\n    if (b2ac < 0) {\n      continue;\n    }\n\n    t1 = (-b + sqrtb2ac) / (2 * a);\n\n    if (0 < t1 && t1 < 1) {\n      tvalues.push(t1);\n    }\n\n    t2 = (-b - sqrtb2ac) / (2 * a);\n\n    if (0 < t2 && t2 < 1) {\n      tvalues.push(t2);\n    }\n  }\n\n  var j = tvalues.length,\n      jlen = j,\n      mt;\n\n  while (j--) {\n    t = tvalues[j];\n    mt = 1 - t;\n    bounds[0][j] = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n    bounds[1][j] = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n  }\n\n  bounds[0][jlen] = x0;\n  bounds[1][jlen] = y0;\n  bounds[0][jlen + 1] = x3;\n  bounds[1][jlen + 1] = y3;\n  bounds[0].length = bounds[1].length = jlen + 2;\n\n  return {\n    x0: mmin(...bounds[0]),\n    y0: mmin(...bounds[1]),\n    x1: mmax(...bounds[0]),\n    y1: mmax(...bounds[1])\n  };\n}\n\nfunction pathToCurve(path) {\n\n  var pth = paths(path);\n\n  // return cached curve, if existing\n  if (pth.curve) {\n    return pathClone(pth.curve);\n  }\n\n  var curvedPath = pathToAbsolute(path),\n      attrs = { x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null },\n      processPath = function(path, d, pathCommand) {\n        var nx, ny;\n\n        if (!path) {\n          return [ 'C', d.x, d.y, d.x, d.y, d.x, d.y ];\n        }\n\n        !(path[0] in { T: 1, Q: 1 }) && (d.qx = d.qy = null);\n\n        switch (path[0]) {\n        case 'M':\n          d.X = path[1];\n          d.Y = path[2];\n          break;\n        case 'A':\n          path = [ 'C', ...arcToCurve(d.x, d.y, ...path.slice(1)) ];\n          break;\n        case 'S':\n          if (pathCommand == 'C' || pathCommand == 'S') {\n\n            // In 'S' case we have to take into account, if the previous command is C/S.\n            nx = d.x * 2 - d.bx;\n\n            // And reflect the previous\n            ny = d.y * 2 - d.by;\n\n            // command's control point relative to the current point.\n          }\n          else {\n\n            // or some else or nothing\n            nx = d.x;\n            ny = d.y;\n          }\n          path = [ 'C', nx, ny, ...path.slice(1) ];\n          break;\n        case 'T':\n          if (pathCommand == 'Q' || pathCommand == 'T') {\n\n            // In 'T' case we have to take into account, if the previous command is Q/T.\n            d.qx = d.x * 2 - d.qx;\n\n            // And make a reflection similar\n            d.qy = d.y * 2 - d.qy;\n\n            // to case 'S'.\n          }\n          else {\n\n            // or something else or nothing\n            d.qx = d.x;\n            d.qy = d.y;\n          }\n          path = [ 'C', ...qubicToCurve(d.x, d.y, d.qx, d.qy, path[1], path[2]) ];\n          break;\n        case 'Q':\n          d.qx = path[1];\n          d.qy = path[2];\n          path = [ 'C', ...qubicToCurve(d.x, d.y, path[1], path[2], path[3], path[4]) ];\n          break;\n        case 'L':\n          path = [ 'C', ...lineToCurve(d.x, d.y, path[1], path[2]) ];\n          break;\n        case 'H':\n          path = [ 'C', ...lineToCurve(d.x, d.y, path[1], d.y) ];\n          break;\n        case 'V':\n          path = [ 'C', ...lineToCurve(d.x, d.y, d.x, path[1]) ];\n          break;\n        case 'Z':\n          path = [ 'C', ...lineToCurve(d.x, d.y, d.X, d.Y) ];\n          break;\n        }\n\n        return path;\n      },\n\n      fixArc = function(pp, i) {\n\n        if (pp[i].length > 7) {\n          pp[i].shift();\n          var pi = pp[i];\n\n          while (pi.length) {\n            pathCommands[i] = 'A'; // if created multiple C:s, their original seg is saved\n            pp.splice(i++, 0, [ 'C', ...pi.splice(0, 6) ]);\n          }\n\n          pp.splice(i, 1);\n          ii = curvedPath.length;\n        }\n      },\n\n      pathCommands = [], // path commands of original path p\n      pfirst = '', // temporary holder for original path command\n      pathCommand = ''; // holder for previous path command of original path\n\n  for (var i = 0, ii = curvedPath.length; i < ii; i++) {\n    curvedPath[i] && (pfirst = curvedPath[i][0]); // save current path command\n\n    if (pfirst != 'C') // C is not saved yet, because it may be result of conversion\n    {\n      pathCommands[i] = pfirst; // Save current path command\n      i && (pathCommand = pathCommands[i - 1]); // Get previous path command pathCommand\n    }\n    curvedPath[i] = processPath(curvedPath[i], attrs, pathCommand); // Previous path command is inputted to processPath\n\n    if (pathCommands[i] != 'A' && pfirst == 'C') pathCommands[i] = 'C'; // A is the only command\n    // which may produce multiple C:s\n    // so we have to make sure that C is also C in original path\n\n    fixArc(curvedPath, i); // fixArc adds also the right amount of A:s to pathCommands\n\n    var seg = curvedPath[i],\n        seglen = seg.length;\n\n    attrs.x = seg[seglen - 2];\n    attrs.y = seg[seglen - 1];\n    attrs.bx = toFloat(seg[seglen - 4]) || attrs.x;\n    attrs.by = toFloat(seg[seglen - 3]) || attrs.y;\n  }\n\n  // cache curve\n  pth.curve = pathClone(curvedPath);\n\n  return curvedPath;\n}","import {\r\n  has,\r\n  isNil,\r\n  isObject\r\n} from 'min-dash';\r\n\r\n/**\r\n * Checks whether a value is an instance of Connection.\r\n *\r\n * @param {any} value\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isConnection(value) {\r\n  return isObject(value) && has(value, 'waypoints');\r\n}\r\n\r\n/**\r\n * Checks whether a value is an instance of Label.\r\n *\r\n * @param {any} value\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isLabel(value) {\r\n  return isObject(value) && has(value, 'labelTarget');\r\n}\r\n\r\n/**\r\n * Checks whether a value is an instance of Root.\r\n *\r\n * @param {any} value\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isRoot(value) {\r\n  return isObject(value) && isNil(value.parent);\r\n}","import {\r\n  isObject,\r\n  sortBy\r\n} from 'min-dash';\r\n\r\nimport {\r\n  pointDistance,\r\n  pointsOnLine\r\n} from '../util/Geometry';\r\n\r\nimport intersectPaths from 'path-intersection';\r\n\r\nimport { isConnection } from '../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../core/Types').ElementLike} Element\r\n * @typedef {import('../core/Types').ConnectionLike} Connection\r\n *\r\n * @typedef {import('../util/Types').DirectionTRBL} DirectionTRBL\r\n * @typedef {import('../util/Types').Intersection} Intersection\r\n * @typedef {import('../util/Types').Point} Point\r\n * @typedef {import('../util/Types').Rect} Rect\r\n * @typedef {import('../util/Types').RectTRBL} RectTRBL\r\n */\r\n\r\n/**\r\n * @param {Rect} bounds\r\n *\r\n * @returns {Rect}\r\n */\r\nexport function roundBounds(bounds) {\r\n  return {\r\n    x: Math.round(bounds.x),\r\n    y: Math.round(bounds.y),\r\n    width: Math.round(bounds.width),\r\n    height: Math.round(bounds.height)\r\n  };\r\n}\r\n\r\n/**\r\n * @param {Point} point\r\n *\r\n * @returns {Point}\r\n */\r\nexport function roundPoint(point) {\r\n\r\n  return {\r\n    x: Math.round(point.x),\r\n    y: Math.round(point.y)\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Convert the given bounds to a { top, left, bottom, right } descriptor.\r\n *\r\n * @param {Point|Rect} bounds\r\n *\r\n * @return {RectTRBL}\r\n */\r\nexport function asTRBL(bounds) {\r\n  return {\r\n    top: bounds.y,\r\n    right: bounds.x + (bounds.width || 0),\r\n    bottom: bounds.y + (bounds.height || 0),\r\n    left: bounds.x\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Convert a { top, left, bottom, right } to an objects bounds.\r\n *\r\n * @param {RectTRBL} trbl\r\n *\r\n * @return {Rect}\r\n */\r\nexport function asBounds(trbl) {\r\n  return {\r\n    x: trbl.left,\r\n    y: trbl.top,\r\n    width: trbl.right - trbl.left,\r\n    height: trbl.bottom - trbl.top\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Get the mid of the given bounds or point.\r\n *\r\n * @param {Point|Rect} bounds\r\n *\r\n * @return {Point}\r\n */\r\nexport function getBoundsMid(bounds) {\r\n  return roundPoint({\r\n    x: bounds.x + (bounds.width || 0) / 2,\r\n    y: bounds.y + (bounds.height || 0) / 2\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * Get the mid of the given Connection.\r\n *\r\n * @param {Connection} connection\r\n *\r\n * @return {Point}\r\n */\r\nexport function getConnectionMid(connection) {\r\n  var waypoints = connection.waypoints;\r\n\r\n  // calculate total length and length of each segment\r\n  var parts = waypoints.reduce(function(parts, point, index) {\r\n\r\n    var lastPoint = waypoints[index - 1];\r\n\r\n    if (lastPoint) {\r\n      var lastPart = parts[parts.length - 1];\r\n\r\n      var startLength = lastPart && lastPart.endLength || 0;\r\n      var length = distance(lastPoint, point);\r\n\r\n      parts.push({\r\n        start: lastPoint,\r\n        end: point,\r\n        startLength: startLength,\r\n        endLength: startLength + length,\r\n        length: length\r\n      });\r\n    }\r\n\r\n    return parts;\r\n  }, []);\r\n\r\n  var totalLength = parts.reduce(function(length, part) {\r\n    return length + part.length;\r\n  }, 0);\r\n\r\n  // find which segement contains middle point\r\n  var midLength = totalLength / 2;\r\n\r\n  var i = 0;\r\n  var midSegment = parts[i];\r\n\r\n  while (midSegment.endLength < midLength) {\r\n    midSegment = parts[++i];\r\n  }\r\n\r\n  // calculate relative position on mid segment\r\n  var segmentProgress = (midLength - midSegment.startLength) / midSegment.length;\r\n\r\n  var midPoint = {\r\n    x: midSegment.start.x + (midSegment.end.x - midSegment.start.x) * segmentProgress,\r\n    y: midSegment.start.y + (midSegment.end.y - midSegment.start.y) * segmentProgress\r\n  };\r\n\r\n  return midPoint;\r\n}\r\n\r\n\r\n/**\r\n * Get the mid of the given Element.\r\n *\r\n * @param {Element} element\r\n *\r\n * @return {Point}\r\n */\r\nexport function getMid(element) {\r\n  if (isConnection(element)) {\r\n    return getConnectionMid(element);\r\n  }\r\n\r\n  return getBoundsMid(element);\r\n}\r\n\r\n// orientation utils //////////////////////\r\n\r\n/**\r\n * Get orientation of the given rectangle with respect to\r\n * the reference rectangle.\r\n *\r\n * A padding (positive or negative) may be passed to influence\r\n * horizontal / vertical orientation and intersection.\r\n *\r\n * @param {Rect} rect\r\n * @param {Rect} reference\r\n * @param {Point|number} padding\r\n *\r\n * @return {DirectionTRBL|Intersection} the orientation; one of top, top-left, left, ..., bottom, right or intersect.\r\n */\r\nexport function getOrientation(rect, reference, padding) {\r\n\r\n  padding = padding || 0;\r\n\r\n  // make sure we can use an object, too\r\n  // for individual { x, y } padding\r\n  if (!isObject(padding)) {\r\n    padding = { x: padding, y: padding };\r\n  }\r\n\r\n\r\n  var rectOrientation = asTRBL(rect),\r\n      referenceOrientation = asTRBL(reference);\r\n\r\n  var top = rectOrientation.bottom + padding.y <= referenceOrientation.top,\r\n      right = rectOrientation.left - padding.x >= referenceOrientation.right,\r\n      bottom = rectOrientation.top - padding.y >= referenceOrientation.bottom,\r\n      left = rectOrientation.right + padding.x <= referenceOrientation.left;\r\n\r\n  var vertical = top ? 'top' : (bottom ? 'bottom' : null),\r\n      horizontal = left ? 'left' : (right ? 'right' : null);\r\n\r\n  if (horizontal && vertical) {\r\n    return vertical + '-' + horizontal;\r\n  } else {\r\n    return horizontal || vertical || 'intersect';\r\n  }\r\n}\r\n\r\n\r\n// intersection utils //////////////////////\r\n\r\n/**\r\n * Get intersection between an element and a line path.\r\n *\r\n * @param {string} elementPath\r\n * @param {string} linePath\r\n * @param {boolean} cropStart Whether to crop start or end.\r\n *\r\n * @return {Point}\r\n */\r\nexport function getElementLineIntersection(elementPath, linePath, cropStart) {\r\n\r\n  var intersections = getIntersections(elementPath, linePath);\r\n\r\n  // recognize intersections\r\n  // only one -> choose\r\n  // two close together -> choose first\r\n  // two or more distinct -> pull out appropriate one\r\n  // none -> ok (fallback to point itself)\r\n  if (intersections.length === 1) {\r\n    return roundPoint(intersections[0]);\r\n  } else if (intersections.length === 2 && pointDistance(intersections[0], intersections[1]) < 1) {\r\n    return roundPoint(intersections[0]);\r\n  } else if (intersections.length > 1) {\r\n\r\n    // sort by intersections based on connection segment +\r\n    // distance from start\r\n    intersections = sortBy(intersections, function(i) {\r\n      var distance = Math.floor(i.t2 * 100) || 1;\r\n\r\n      distance = 100 - distance;\r\n\r\n      distance = (distance < 10 ? '0' : '') + distance;\r\n\r\n      // create a sort string that makes sure we sort\r\n      // line segment ASC + line segment position DESC (for cropStart)\r\n      // line segment ASC + line segment position ASC (for cropEnd)\r\n      return i.segment2 + '#' + distance;\r\n    });\r\n\r\n    return roundPoint(intersections[cropStart ? 0 : intersections.length - 1]);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n\r\nexport function getIntersections(a, b) {\r\n  return intersectPaths(a, b);\r\n}\r\n\r\n\r\nexport function filterRedundantWaypoints(waypoints) {\r\n\r\n  // alter copy of waypoints, not original\r\n  waypoints = waypoints.slice();\r\n\r\n  var idx = 0,\r\n      point,\r\n      previousPoint,\r\n      nextPoint;\r\n\r\n  while (waypoints[idx]) {\r\n    point = waypoints[idx];\r\n    previousPoint = waypoints[idx - 1];\r\n    nextPoint = waypoints[idx + 1];\r\n\r\n    if (pointDistance(point, nextPoint) === 0 ||\r\n        pointsOnLine(previousPoint, nextPoint, point)) {\r\n\r\n      // remove point, if overlapping with {nextPoint}\r\n      // or on line with {previousPoint} -> {point} -> {nextPoint}\r\n      waypoints.splice(idx, 1);\r\n    } else {\r\n      idx++;\r\n    }\r\n  }\r\n\r\n  return waypoints;\r\n}\r\n\r\n// helpers //////////////////////\r\n\r\nfunction distance(a, b) {\r\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\r\n}","import {\r\n  isNumber,\r\n  assign,\r\n  forEach,\r\n  every,\r\n  debounce,\r\n  bind,\r\n  reduce,\r\n  find\r\n} from 'min-dash';\r\n\r\nimport {\r\n  assignStyle\r\n} from 'min-dom';\r\n\r\nimport {\r\n  add as collectionAdd,\r\n  remove as collectionRemove\r\n} from '../util/Collections';\r\n\r\nimport {\r\n  getType,\r\n  getBBox as getBoundingBox\r\n} from '../util/Elements';\r\n\r\nimport { asTRBL } from '../layout/LayoutUtil';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  create as svgCreate,\r\n  transform as svgTransform,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport { createMatrix as createMatrix } from 'tiny-svg';\r\n\r\n\r\n/**\r\n * @typedef {import('./Types').ConnectionLike} ConnectionLike\r\n * @typedef {import('./Types').RootLike} RootLike\r\n * @typedef {import('./Types').ParentLike } ParentLike\r\n * @typedef {import('./Types').ShapeLike} ShapeLike\r\n *\r\n * @typedef { {\r\n *   container?: HTMLElement;\r\n *   deferUpdate?: boolean;\r\n *   width?: number;\r\n *   height?: number;\r\n * } } CanvasConfig\r\n * @typedef { {\r\n *   group: SVGElement;\r\n *   index: number;\r\n *   visible: boolean;\r\n * } } CanvasLayer\r\n * @typedef { {\r\n *   [key: string]: CanvasLayer;\r\n * } } CanvasLayers\r\n * @typedef { {\r\n *   rootElement: ShapeLike;\r\n *   layer: CanvasLayer;\r\n * } } CanvasPlane\r\n * @typedef { {\r\n *   scale: number;\r\n *   inner: Rect;\r\n *   outer: Dimensions;\r\n * } & Rect } CanvasViewbox\r\n *\r\n * @typedef {import('./ElementRegistry').default} ElementRegistry\r\n * @typedef {import('./EventBus').default} EventBus\r\n * @typedef {import('./GraphicsFactory').default} GraphicsFactory\r\n *\r\n * @typedef {import('../util/Types').Dimensions} Dimensions\r\n * @typedef {import('../util/Types').Point} Point\r\n * @typedef {import('../util/Types').Rect} Rect\r\n * @typedef {import('../util/Types').RectTRBL} RectTRBL\r\n * @typedef {import('../util/Types').ScrollDelta} ScrollDelta\r\n */\r\n\r\nfunction round(number, resolution) {\r\n  return Math.round(number * resolution) / resolution;\r\n}\r\n\r\nfunction ensurePx(number) {\r\n  return isNumber(number) ? number + 'px' : number;\r\n}\r\n\r\nfunction findRoot(element) {\r\n  while (element.parent) {\r\n    element = element.parent;\r\n  }\r\n\r\n  return element;\r\n}\r\n\r\n/**\r\n * Creates a HTML container element for a SVG element with\r\n * the given configuration\r\n *\r\n * @param {CanvasConfig} options\r\n *\r\n * @return {HTMLElement} the container element\r\n */\r\nfunction createContainer(options) {\r\n\r\n  options = assign({}, { width: '100%', height: '100%' }, options);\r\n\r\n  const container = options.container || document.body;\r\n\r\n  // create a <div> around the svg element with the respective size\r\n  // this way we can always get the correct container size\r\n  // (this is impossible for <svg> elements at the moment)\r\n  const parent = document.createElement('div');\r\n  parent.setAttribute('class', 'djs-container djs-parent');\r\n\r\n  assignStyle(parent, {\r\n    position: 'relative',\r\n    overflow: 'hidden',\r\n    width: ensurePx(options.width),\r\n    height: ensurePx(options.height)\r\n  });\r\n\r\n  container.appendChild(parent);\r\n\r\n  return parent;\r\n}\r\n\r\nfunction createGroup(parent, cls, childIndex) {\r\n  const group = svgCreate('g');\r\n  svgClasses(group).add(cls);\r\n\r\n  const index = childIndex !== undefined ? childIndex : parent.childNodes.length - 1;\r\n\r\n  // must ensure second argument is node or _null_\r\n  // cf. https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore\r\n  parent.insertBefore(group, parent.childNodes[index] || null);\r\n\r\n  return group;\r\n}\r\n\r\nconst BASE_LAYER = 'base';\r\n\r\n// render plane contents behind utility layers\r\nconst PLANE_LAYER_INDEX = 0;\r\nconst UTILITY_LAYER_INDEX = 1;\r\n\r\n\r\nconst REQUIRED_MODEL_ATTRS = {\r\n  shape: [ 'x', 'y', 'width', 'height' ],\r\n  connection: [ 'waypoints' ]\r\n};\r\n\r\n/**\r\n * The main drawing canvas.\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * @emits Canvas#canvas.init\r\n *\r\n * @param {CanvasConfig|null} config\r\n * @param {EventBus} eventBus\r\n * @param {GraphicsFactory} graphicsFactory\r\n * @param {ElementRegistry} elementRegistry\r\n */\r\nexport default function Canvas(config, eventBus, graphicsFactory, elementRegistry) {\r\n  this._eventBus = eventBus;\r\n  this._elementRegistry = elementRegistry;\r\n  this._graphicsFactory = graphicsFactory;\r\n\r\n  /**\r\n   * @type {number}\r\n   */\r\n  this._rootsIdx = 0;\r\n\r\n  /**\r\n   * @type {CanvasLayers}\r\n   */\r\n  this._layers = {};\r\n\r\n  /**\r\n   * @type {CanvasPlane[]}\r\n   */\r\n  this._planes = [];\r\n\r\n  /**\r\n   * @type {RootLike|null}\r\n   */\r\n  this._rootElement = null;\r\n\r\n  this._init(config || {});\r\n}\r\n\r\nCanvas.$inject = [\r\n  'config.canvas',\r\n  'eventBus',\r\n  'graphicsFactory',\r\n  'elementRegistry'\r\n];\r\n\r\n/**\r\n * Creates a <svg> element that is wrapped into a <div>.\r\n * This way we are always able to correctly figure out the size of the svg element\r\n * by querying the parent node.\r\n\r\n * (It is not possible to get the size of a svg element cross browser @ 2014-04-01)\r\n\r\n * <div class=\"djs-container\" style=\"width: {desired-width}, height: {desired-height}\">\r\n *   <svg width=\"100%\" height=\"100%\">\r\n *    ...\r\n *   </svg>\r\n * </div>\r\n *\r\n * @param {CanvasConfig} config\r\n */\r\nCanvas.prototype._init = function(config) {\r\n\r\n  const eventBus = this._eventBus;\r\n\r\n  // html container\r\n  const container = this._container = createContainer(config);\r\n\r\n  const svg = this._svg = svgCreate('svg');\r\n  svgAttr(svg, { width: '100%', height: '100%' });\r\n\r\n  svgAppend(container, svg);\r\n\r\n  const viewport = this._viewport = createGroup(svg, 'viewport');\r\n\r\n  // debounce canvas.viewbox.changed events when deferUpdate is set\r\n  // to help with potential performance issues\r\n  if (config.deferUpdate) {\r\n    this._viewboxChanged = debounce(bind(this._viewboxChanged, this), 300);\r\n  }\r\n\r\n  eventBus.on('diagram.init', () => {\r\n\r\n    /**\r\n     * An event indicating that the canvas is ready to be drawn on.\r\n     *\r\n     * @memberOf Canvas\r\n     *\r\n     * @event canvas.init\r\n     *\r\n     * @type {Object}\r\n     * @property {SVGElement} svg the created svg element\r\n     * @property {SVGElement} viewport the direct parent of diagram elements and shapes\r\n     */\r\n    eventBus.fire('canvas.init', {\r\n      svg: svg,\r\n      viewport: viewport\r\n    });\r\n\r\n  });\r\n\r\n  // reset viewbox on shape changes to\r\n  // recompute the viewbox\r\n  eventBus.on([\r\n    'shape.added',\r\n    'connection.added',\r\n    'shape.removed',\r\n    'connection.removed',\r\n    'elements.changed',\r\n    'root.set'\r\n  ], () => {\r\n    delete this._cachedViewbox;\r\n  });\r\n\r\n  eventBus.on('diagram.destroy', 500, this._destroy, this);\r\n  eventBus.on('diagram.clear', 500, this._clear, this);\r\n};\r\n\r\nCanvas.prototype._destroy = function() {\r\n  this._eventBus.fire('canvas.destroy', {\r\n    svg: this._svg,\r\n    viewport: this._viewport\r\n  });\r\n\r\n  const parent = this._container.parentNode;\r\n\r\n  if (parent) {\r\n    parent.removeChild(this._container);\r\n  }\r\n\r\n  delete this._svg;\r\n  delete this._container;\r\n  delete this._layers;\r\n  delete this._planes;\r\n  delete this._rootElement;\r\n  delete this._viewport;\r\n};\r\n\r\nCanvas.prototype._clear = function() {\r\n\r\n  const allElements = this._elementRegistry.getAll();\r\n\r\n  // remove all elements\r\n  allElements.forEach(element => {\r\n    const type = getType(element);\r\n\r\n    if (type === 'root') {\r\n      this.removeRootElement(element);\r\n    } else {\r\n      this._removeElement(element, type);\r\n    }\r\n  });\r\n\r\n  // remove all planes\r\n  this._planes = [];\r\n  this._rootElement = null;\r\n\r\n  // force recomputation of view box\r\n  delete this._cachedViewbox;\r\n};\r\n\r\n/**\r\n * Returns the default layer on which\r\n * all elements are drawn.\r\n *\r\n * @return {SVGElement}  The SVG element of the layer.\r\n */\r\nCanvas.prototype.getDefaultLayer = function() {\r\n  return this.getLayer(BASE_LAYER, PLANE_LAYER_INDEX);\r\n};\r\n\r\n/**\r\n * Returns a layer that is used to draw elements\r\n * or annotations on it.\r\n *\r\n * Non-existing layers retrieved through this method\r\n * will be created. During creation, the optional index\r\n * may be used to create layers below or above existing layers.\r\n * A layer with a certain index is always created above all\r\n * existing layers with the same index.\r\n *\r\n * @param {string} name The name of the layer.\r\n * @param {number} [index] The index of the layer.\r\n *\r\n * @return {SVGElement} The SVG element of the layer.\r\n */\r\nCanvas.prototype.getLayer = function(name, index) {\r\n\r\n  if (!name) {\r\n    throw new Error('must specify a name');\r\n  }\r\n\r\n  let layer = this._layers[name];\r\n\r\n  if (!layer) {\r\n    layer = this._layers[name] = this._createLayer(name, index);\r\n  }\r\n\r\n  // throw an error if layer creation / retrival is\r\n  // requested on different index\r\n  if (typeof index !== 'undefined' && layer.index !== index) {\r\n    throw new Error('layer <' + name + '> already created at index <' + index + '>');\r\n  }\r\n\r\n  return layer.group;\r\n};\r\n\r\n/**\r\n * For a given index, return the number of layers that have a higher index and\r\n * are visible.\r\n *\r\n * This is used to determine the node a layer should be inserted at.\r\n *\r\n * @param {number} index\r\n *\r\n * @return {number}\r\n */\r\nCanvas.prototype._getChildIndex = function(index) {\r\n  return reduce(this._layers, function(childIndex, layer) {\r\n    if (layer.visible && index >= layer.index) {\r\n      childIndex++;\r\n    }\r\n\r\n    return childIndex;\r\n  }, 0);\r\n};\r\n\r\n/**\r\n * Creates a given layer and returns it.\r\n *\r\n * @param {string} name\r\n * @param {number} [index=0]\r\n *\r\n * @return {CanvasLayer}\r\n */\r\nCanvas.prototype._createLayer = function(name, index) {\r\n\r\n  if (typeof index === 'undefined') {\r\n    index = UTILITY_LAYER_INDEX;\r\n  }\r\n\r\n  const childIndex = this._getChildIndex(index);\r\n\r\n  return {\r\n    group: createGroup(this._viewport, 'layer-' + name, childIndex),\r\n    index: index,\r\n    visible: true\r\n  };\r\n};\r\n\r\n\r\n/**\r\n * Shows a given layer.\r\n *\r\n * @param {string} name The name of the layer.\r\n *\r\n * @return {SVGElement} The SVG element of the layer.\r\n */\r\nCanvas.prototype.showLayer = function(name) {\r\n\r\n  if (!name) {\r\n    throw new Error('must specify a name');\r\n  }\r\n\r\n  const layer = this._layers[name];\r\n\r\n  if (!layer) {\r\n    throw new Error('layer <' + name + '> does not exist');\r\n  }\r\n\r\n  const viewport = this._viewport;\r\n  const group = layer.group;\r\n  const index = layer.index;\r\n\r\n  if (layer.visible) {\r\n    return group;\r\n  }\r\n\r\n  const childIndex = this._getChildIndex(index);\r\n\r\n  viewport.insertBefore(group, viewport.childNodes[childIndex] || null);\r\n\r\n  layer.visible = true;\r\n\r\n  return group;\r\n};\r\n\r\n/**\r\n * Hides a given layer.\r\n *\r\n * @param {string} name The name of the layer.\r\n *\r\n * @return {SVGElement} The SVG element of the layer.\r\n */\r\nCanvas.prototype.hideLayer = function(name) {\r\n\r\n  if (!name) {\r\n    throw new Error('must specify a name');\r\n  }\r\n\r\n  const layer = this._layers[name];\r\n\r\n  if (!layer) {\r\n    throw new Error('layer <' + name + '> does not exist');\r\n  }\r\n\r\n  const group = layer.group;\r\n\r\n  if (!layer.visible) {\r\n    return group;\r\n  }\r\n\r\n  svgRemove(group);\r\n\r\n  layer.visible = false;\r\n\r\n  return group;\r\n};\r\n\r\n\r\nCanvas.prototype._removeLayer = function(name) {\r\n\r\n  const layer = this._layers[name];\r\n\r\n  if (layer) {\r\n    delete this._layers[name];\r\n\r\n    svgRemove(layer.group);\r\n  }\r\n};\r\n\r\n/**\r\n * Returns the currently active layer. Can be null.\r\n *\r\n * @return {CanvasLayer|null} The active layer of `null`.\r\n */\r\nCanvas.prototype.getActiveLayer = function() {\r\n  const plane = this._findPlaneForRoot(this.getRootElement());\r\n\r\n  if (!plane) {\r\n    return null;\r\n  }\r\n\r\n  return plane.layer;\r\n};\r\n\r\n\r\n/**\r\n * Returns the plane which contains the given element.\r\n *\r\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\r\n *\r\n * @return {RootLike|undefined} The root of the element.\r\n */\r\nCanvas.prototype.findRoot = function(element) {\r\n  if (typeof element === 'string') {\r\n    element = this._elementRegistry.get(element);\r\n  }\r\n\r\n  if (!element) {\r\n    return;\r\n  }\r\n\r\n  const plane = this._findPlaneForRoot(\r\n    findRoot(element)\r\n  ) || {};\r\n\r\n  return plane.rootElement;\r\n};\r\n\r\n/**\r\n * Return a list of all root elements on the diagram.\r\n *\r\n * @return {(RootLike)[]} The list of root elements.\r\n */\r\nCanvas.prototype.getRootElements = function() {\r\n  return this._planes.map(function(plane) {\r\n    return plane.rootElement;\r\n  });\r\n};\r\n\r\nCanvas.prototype._findPlaneForRoot = function(rootElement) {\r\n  return find(this._planes, function(plane) {\r\n    return plane.rootElement === rootElement;\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Returns the html element that encloses the\r\n * drawing canvas.\r\n *\r\n * @return {HTMLElement} The HTML element of the container.\r\n */\r\nCanvas.prototype.getContainer = function() {\r\n  return this._container;\r\n};\r\n\r\n\r\n// markers //////////////////////\r\n\r\nCanvas.prototype._updateMarker = function(element, marker, add) {\r\n  let container;\r\n\r\n  if (!element.id) {\r\n    element = this._elementRegistry.get(element);\r\n  }\r\n\r\n  // we need to access all\r\n  container = this._elementRegistry._elements[element.id];\r\n\r\n  if (!container) {\r\n    return;\r\n  }\r\n\r\n  forEach([ container.gfx, container.secondaryGfx ], function(gfx) {\r\n    if (gfx) {\r\n\r\n      // invoke either addClass or removeClass based on mode\r\n      if (add) {\r\n        svgClasses(gfx).add(marker);\r\n      } else {\r\n        svgClasses(gfx).remove(marker);\r\n      }\r\n    }\r\n  });\r\n\r\n  /**\r\n   * An event indicating that a marker has been updated for an element\r\n   *\r\n   * @event element.marker.update\r\n   * @type {Object}\r\n   * @property {Element} element the shape\r\n   * @property {SVGElement} gfx the graphical representation of the shape\r\n   * @property {string} marker\r\n   * @property {boolean} add true if the marker was added, false if it got removed\r\n   */\r\n  this._eventBus.fire('element.marker.update', { element: element, gfx: container.gfx, marker: marker, add: !!add });\r\n};\r\n\r\n\r\n/**\r\n * Adds a marker to an element (basically a css class).\r\n *\r\n * Fires the element.marker.update event, making it possible to\r\n * integrate extension into the marker life-cycle, too.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * canvas.addMarker('foo', 'some-marker');\r\n *\r\n * const fooGfx = canvas.getGraphics('foo');\r\n *\r\n * fooGfx; // <g class=\"... some-marker\"> ... </g>\r\n * ```\r\n *\r\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\r\n * @param {string} marker The marker.\r\n */\r\nCanvas.prototype.addMarker = function(element, marker) {\r\n  this._updateMarker(element, marker, true);\r\n};\r\n\r\n\r\n/**\r\n * Remove a marker from an element.\r\n *\r\n * Fires the element.marker.update event, making it possible to\r\n * integrate extension into the marker life-cycle, too.\r\n *\r\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\r\n * @param {string} marker The marker.\r\n */\r\nCanvas.prototype.removeMarker = function(element, marker) {\r\n  this._updateMarker(element, marker, false);\r\n};\r\n\r\n/**\r\n * Check whether an element has a given marker.\r\n *\r\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\r\n * @param {string} marker The marker.\r\n */\r\nCanvas.prototype.hasMarker = function(element, marker) {\r\n  if (!element.id) {\r\n    element = this._elementRegistry.get(element);\r\n  }\r\n\r\n  const gfx = this.getGraphics(element);\r\n\r\n  return svgClasses(gfx).has(marker);\r\n};\r\n\r\n/**\r\n * Toggles a marker on an element.\r\n *\r\n * Fires the element.marker.update event, making it possible to\r\n * integrate extension into the marker life-cycle, too.\r\n *\r\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\r\n * @param {string} marker The marker.\r\n */\r\nCanvas.prototype.toggleMarker = function(element, marker) {\r\n  if (this.hasMarker(element, marker)) {\r\n    this.removeMarker(element, marker);\r\n  } else {\r\n    this.addMarker(element, marker);\r\n  }\r\n};\r\n\r\n/**\r\n * Returns the current root element.\r\n *\r\n * Supports two different modes for handling root elements:\r\n *\r\n * 1. if no root element has been added before, an implicit root will be added\r\n * and returned. This is used in applications that don't require explicit\r\n * root elements.\r\n *\r\n * 2. when root elements have been added before calling `getRootElement`,\r\n * root elements can be null. This is used for applications that want to manage\r\n * root elements themselves.\r\n *\r\n * @return {RootLike} The current root element.\r\n */\r\nCanvas.prototype.getRootElement = function() {\r\n  const rootElement = this._rootElement;\r\n\r\n  // can return null if root elements are present but none was set yet\r\n  if (rootElement || this._planes.length) {\r\n    return rootElement;\r\n  }\r\n\r\n  return this.setRootElement(this.addRootElement(null));\r\n};\r\n\r\n/**\r\n * Adds a given root element and returns it.\r\n *\r\n * @param {RootLike} [rootElement] The root element to be added.\r\n *\r\n * @return {RootLike} The added root element or an implicit root element.\r\n */\r\nCanvas.prototype.addRootElement = function(rootElement) {\r\n  const idx = this._rootsIdx++;\r\n\r\n  if (!rootElement) {\r\n    rootElement = {\r\n      id: '__implicitroot_' + idx,\r\n      children: [],\r\n      isImplicit: true\r\n    };\r\n  }\r\n\r\n  const layerName = rootElement.layer = 'root-' + idx;\r\n\r\n  this._ensureValid('root', rootElement);\r\n\r\n  const layer = this.getLayer(layerName, PLANE_LAYER_INDEX);\r\n\r\n  this.hideLayer(layerName);\r\n\r\n  this._addRoot(rootElement, layer);\r\n\r\n  this._planes.push({\r\n    rootElement: rootElement,\r\n    layer: layer\r\n  });\r\n\r\n  return rootElement;\r\n};\r\n\r\n/**\r\n * Removes a given root element and returns it.\r\n *\r\n * @param {RootLike|string} rootElement element or element ID\r\n *\r\n * @return {RootLike|undefined} removed element\r\n */\r\nCanvas.prototype.removeRootElement = function(rootElement) {\r\n\r\n  if (typeof rootElement === 'string') {\r\n    rootElement = this._elementRegistry.get(rootElement);\r\n  }\r\n\r\n  const plane = this._findPlaneForRoot(rootElement);\r\n\r\n  if (!plane) {\r\n    return;\r\n  }\r\n\r\n  // hook up life-cycle events\r\n  this._removeRoot(rootElement);\r\n\r\n  // clean up layer\r\n  this._removeLayer(rootElement.layer);\r\n\r\n  // clean up plane\r\n  this._planes = this._planes.filter(function(plane) {\r\n    return plane.rootElement !== rootElement;\r\n  });\r\n\r\n  // clean up active root\r\n  if (this._rootElement === rootElement) {\r\n    this._rootElement = null;\r\n  }\r\n\r\n  return rootElement;\r\n};\r\n\r\n\r\n/**\r\n * Sets a given element as the new root element for the canvas\r\n * and returns the new root element.\r\n *\r\n * @param {RootLike} rootElement The root element to be set.\r\n *\r\n * @return {RootLike} The set root element.\r\n */\r\nCanvas.prototype.setRootElement = function(rootElement) {\r\n\r\n  if (rootElement === this._rootElement) {\r\n    return rootElement;\r\n  }\r\n\r\n  let plane;\r\n\r\n  if (!rootElement) {\r\n    throw new Error('rootElement required');\r\n  }\r\n\r\n  plane = this._findPlaneForRoot(rootElement);\r\n\r\n  // give set add semantics for backwards compatibility\r\n  if (!plane) {\r\n    rootElement = this.addRootElement(rootElement);\r\n  }\r\n\r\n  this._setRoot(rootElement);\r\n\r\n  return rootElement;\r\n};\r\n\r\n\r\nCanvas.prototype._removeRoot = function(element) {\r\n  const elementRegistry = this._elementRegistry,\r\n        eventBus = this._eventBus;\r\n\r\n  // simulate element remove event sequence\r\n  eventBus.fire('root.remove', { element: element });\r\n  eventBus.fire('root.removed', { element: element });\r\n\r\n  elementRegistry.remove(element);\r\n};\r\n\r\n\r\nCanvas.prototype._addRoot = function(element, gfx) {\r\n  const elementRegistry = this._elementRegistry,\r\n        eventBus = this._eventBus;\r\n\r\n  // resemble element add event sequence\r\n  eventBus.fire('root.add', { element: element });\r\n\r\n  elementRegistry.add(element, gfx);\r\n\r\n  eventBus.fire('root.added', { element: element, gfx: gfx });\r\n};\r\n\r\n\r\nCanvas.prototype._setRoot = function(rootElement, layer) {\r\n\r\n  const currentRoot = this._rootElement;\r\n\r\n  if (currentRoot) {\r\n\r\n    // un-associate previous root element <svg>\r\n    this._elementRegistry.updateGraphics(currentRoot, null, true);\r\n\r\n    // hide previous layer\r\n    this.hideLayer(currentRoot.layer);\r\n  }\r\n\r\n  if (rootElement) {\r\n\r\n    if (!layer) {\r\n      layer = this._findPlaneForRoot(rootElement).layer;\r\n    }\r\n\r\n    // associate element with <svg>\r\n    this._elementRegistry.updateGraphics(rootElement, this._svg, true);\r\n\r\n    // show root layer\r\n    this.showLayer(rootElement.layer);\r\n  }\r\n\r\n  this._rootElement = rootElement;\r\n\r\n  this._eventBus.fire('root.set', { element: rootElement });\r\n};\r\n\r\nCanvas.prototype._ensureValid = function(type, element) {\r\n  if (!element.id) {\r\n    throw new Error('element must have an id');\r\n  }\r\n\r\n  if (this._elementRegistry.get(element.id)) {\r\n    throw new Error('element <' + element.id + '> already exists');\r\n  }\r\n\r\n  const requiredAttrs = REQUIRED_MODEL_ATTRS[type];\r\n\r\n  const valid = every(requiredAttrs, function(attr) {\r\n    return typeof element[attr] !== 'undefined';\r\n  });\r\n\r\n  if (!valid) {\r\n    throw new Error(\r\n      'must supply { ' + requiredAttrs.join(', ') + ' } with ' + type);\r\n  }\r\n};\r\n\r\nCanvas.prototype._setParent = function(element, parent, parentIndex) {\r\n  collectionAdd(parent.children, element, parentIndex);\r\n  element.parent = parent;\r\n};\r\n\r\n/**\r\n * Adds an element to the canvas.\r\n *\r\n * This wires the parent <-> child relationship between the element and\r\n * a explicitly specified parent or an implicit root element.\r\n *\r\n * During add it emits the events\r\n *\r\n *  * <{type}.add> (element, parent)\r\n *  * <{type}.added> (element, gfx)\r\n *\r\n * Extensions may hook into these events to perform their magic.\r\n *\r\n * @param {string} type\r\n * @param {ConnectionLike|ShapeLike} element\r\n * @param {ShapeLike} [parent]\r\n * @param {number} [parentIndex]\r\n *\r\n * @return {ConnectionLike|ShapeLike} The added element.\r\n */\r\nCanvas.prototype._addElement = function(type, element, parent, parentIndex) {\r\n\r\n  parent = parent || this.getRootElement();\r\n\r\n  const eventBus = this._eventBus,\r\n        graphicsFactory = this._graphicsFactory;\r\n\r\n  this._ensureValid(type, element);\r\n\r\n  eventBus.fire(type + '.add', { element: element, parent: parent });\r\n\r\n  this._setParent(element, parent, parentIndex);\r\n\r\n  // create graphics\r\n  const gfx = graphicsFactory.create(type, element, parentIndex);\r\n\r\n  this._elementRegistry.add(element, gfx);\r\n\r\n  // update its visual\r\n  graphicsFactory.update(type, element, gfx);\r\n\r\n  eventBus.fire(type + '.added', { element: element, gfx: gfx });\r\n\r\n  return element;\r\n};\r\n\r\n/**\r\n * Adds a shape to the canvas.\r\n *\r\n * @param {ShapeLike} shape The shape to be added\r\n * @param {ParentLike} [parent] The shape's parent.\r\n * @param {number} [parentIndex] The index at which to add the shape to the parent's children.\r\n *\r\n * @return {ShapeLike} The added shape.\r\n */\r\nCanvas.prototype.addShape = function(shape, parent, parentIndex) {\r\n  return this._addElement('shape', shape, parent, parentIndex);\r\n};\r\n\r\n/**\r\n * Adds a connection to the canvas.\r\n *\r\n * @param {ConnectionLike} connection The connection to be added.\r\n * @param {ParentLike} [parent] The connection's parent.\r\n * @param {number} [parentIndex] The index at which to add the connection to the parent's children.\r\n *\r\n * @return {ConnectionLike} The added connection.\r\n */\r\nCanvas.prototype.addConnection = function(connection, parent, parentIndex) {\r\n  return this._addElement('connection', connection, parent, parentIndex);\r\n};\r\n\r\n\r\n/**\r\n * Internal remove element\r\n */\r\nCanvas.prototype._removeElement = function(element, type) {\r\n\r\n  const elementRegistry = this._elementRegistry,\r\n        graphicsFactory = this._graphicsFactory,\r\n        eventBus = this._eventBus;\r\n\r\n  element = elementRegistry.get(element.id || element);\r\n\r\n  if (!element) {\r\n\r\n    // element was removed already\r\n    return;\r\n  }\r\n\r\n  eventBus.fire(type + '.remove', { element: element });\r\n\r\n  graphicsFactory.remove(element);\r\n\r\n  // unset parent <-> child relationship\r\n  collectionRemove(element.parent && element.parent.children, element);\r\n  element.parent = null;\r\n\r\n  eventBus.fire(type + '.removed', { element: element });\r\n\r\n  elementRegistry.remove(element);\r\n\r\n  return element;\r\n};\r\n\r\n\r\n/**\r\n * Removes a shape from the canvas.\r\n *\r\n * @fires ShapeRemoveEvent\r\n * @fires ShapeRemovedEvent\r\n *\r\n * @param {ShapeLike|string} shape The shape or its ID.\r\n *\r\n * @return {ShapeLike} The removed shape.\r\n */\r\nCanvas.prototype.removeShape = function(shape) {\r\n\r\n  /**\r\n   * An event indicating that a shape is about to be removed from the canvas.\r\n   *\r\n   * @memberOf Canvas\r\n   *\r\n   * @event ShapeRemoveEvent\r\n   * @type {Object}\r\n   * @property {ShapeLike} element The shape.\r\n   * @property {SVGElement} gfx The graphical element.\r\n   */\r\n\r\n  /**\r\n   * An event indicating that a shape has been removed from the canvas.\r\n   *\r\n   * @memberOf Canvas\r\n   *\r\n   * @event ShapeRemovedEvent\r\n   * @type {Object}\r\n   * @property {ShapeLike} element The shape.\r\n   * @property {SVGElement} gfx The graphical element.\r\n   */\r\n  return this._removeElement(shape, 'shape');\r\n};\r\n\r\n\r\n/**\r\n * Removes a connection from the canvas.\r\n *\r\n * @fires ConnectionRemoveEvent\r\n * @fires ConnectionRemovedEvent\r\n *\r\n * @param {ConnectionLike|string} connection The connection or its ID.\r\n *\r\n * @return {ConnectionLike} The removed connection.\r\n */\r\nCanvas.prototype.removeConnection = function(connection) {\r\n\r\n  /**\r\n   * An event indicating that a connection is about to be removed from the canvas.\r\n   *\r\n   * @memberOf Canvas\r\n   *\r\n   * @event ConnectionRemoveEvent\r\n   * @type {Object}\r\n   * @property {ConnectionLike} element The connection.\r\n   * @property {SVGElement} gfx The graphical element.\r\n   */\r\n\r\n  /**\r\n   * An event indicating that a connection has been removed from the canvas.\r\n   *\r\n   * @memberOf Canvas\r\n   *\r\n   * @event ConnectionRemovedEvent\r\n   * @type {Object}\r\n   * @property {ConnectionLike} element The connection.\r\n   * @property {SVGElement} gfx The graphical element.\r\n   */\r\n  return this._removeElement(connection, 'connection');\r\n};\r\n\r\n\r\n/**\r\n * Returns the graphical element of an element.\r\n *\r\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\r\n * @param {boolean} [secondary=false] Whether to return the secondary graphical element.\r\n *\r\n * @return {SVGElement} The graphical element.\r\n */\r\nCanvas.prototype.getGraphics = function(element, secondary) {\r\n  return this._elementRegistry.getGraphics(element, secondary);\r\n};\r\n\r\n\r\n/**\r\n * Perform a viewbox update via a given change function.\r\n *\r\n * @param {Function} changeFn\r\n */\r\nCanvas.prototype._changeViewbox = function(changeFn) {\r\n\r\n  // notify others of the upcoming viewbox change\r\n  this._eventBus.fire('canvas.viewbox.changing');\r\n\r\n  // perform actual change\r\n  changeFn.apply(this);\r\n\r\n  // reset the cached viewbox so that\r\n  // a new get operation on viewbox or zoom\r\n  // triggers a viewbox re-computation\r\n  this._cachedViewbox = null;\r\n\r\n  // notify others of the change; this step\r\n  // may or may not be debounced\r\n  this._viewboxChanged();\r\n};\r\n\r\nCanvas.prototype._viewboxChanged = function() {\r\n  this._eventBus.fire('canvas.viewbox.changed', { viewbox: this.viewbox() });\r\n};\r\n\r\n\r\n/**\r\n * Gets or sets the view box of the canvas, i.e. the\r\n * area that is currently displayed.\r\n *\r\n * The getter may return a cached viewbox (if it is currently\r\n * changing). To force a recomputation, pass `false` as the first argument.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * canvas.viewbox({ x: 100, y: 100, width: 500, height: 500 })\r\n *\r\n * // sets the visible area of the diagram to (100|100) -> (600|100)\r\n * // and and scales it according to the diagram width\r\n *\r\n * const viewbox = canvas.viewbox(); // pass `false` to force recomputing the box.\r\n *\r\n * console.log(viewbox);\r\n * // {\r\n * //   inner: Dimensions,\r\n * //   outer: Dimensions,\r\n * //   scale,\r\n * //   x, y,\r\n * //   width, height\r\n * // }\r\n *\r\n * // if the current diagram is zoomed and scrolled, you may reset it to the\r\n * // default zoom via this method, too:\r\n *\r\n * const zoomedAndScrolledViewbox = canvas.viewbox();\r\n *\r\n * canvas.viewbox({\r\n *   x: 0,\r\n *   y: 0,\r\n *   width: zoomedAndScrolledViewbox.outer.width,\r\n *   height: zoomedAndScrolledViewbox.outer.height\r\n * });\r\n * ```\r\n *\r\n * @param {Rect} [box] The viewbox to be set.\r\n *\r\n * @return {CanvasViewbox} The set viewbox.\r\n */\r\nCanvas.prototype.viewbox = function(box) {\r\n\r\n  if (box === undefined && this._cachedViewbox) {\r\n    return this._cachedViewbox;\r\n  }\r\n\r\n  const viewport = this._viewport,\r\n        outerBox = this.getSize();\r\n  let innerBox,\r\n      matrix,\r\n      activeLayer,\r\n      transform,\r\n      scale,\r\n      x, y;\r\n\r\n  if (!box) {\r\n\r\n    // compute the inner box based on the\r\n    // diagrams active layer. This allows us to exclude\r\n    // external components, such as overlays\r\n\r\n    activeLayer = this._rootElement ? this.getActiveLayer() : null;\r\n    innerBox = activeLayer && activeLayer.getBBox() || {};\r\n\r\n    transform = svgTransform(viewport);\r\n    matrix = transform ? transform.matrix : createMatrix();\r\n    scale = round(matrix.a, 1000);\r\n\r\n    x = round(-matrix.e || 0, 1000);\r\n    y = round(-matrix.f || 0, 1000);\r\n\r\n    box = this._cachedViewbox = {\r\n      x: x ? x / scale : 0,\r\n      y: y ? y / scale : 0,\r\n      width: outerBox.width / scale,\r\n      height: outerBox.height / scale,\r\n      scale: scale,\r\n      inner: {\r\n        width: innerBox.width || 0,\r\n        height: innerBox.height || 0,\r\n        x: innerBox.x || 0,\r\n        y: innerBox.y || 0\r\n      },\r\n      outer: outerBox\r\n    };\r\n\r\n    return box;\r\n  } else {\r\n\r\n    this._changeViewbox(function() {\r\n      scale = Math.min(outerBox.width / box.width, outerBox.height / box.height);\r\n\r\n      const matrix = this._svg.createSVGMatrix()\r\n        .scale(scale)\r\n        .translate(-box.x, -box.y);\r\n\r\n      svgTransform(viewport, matrix);\r\n    });\r\n  }\r\n\r\n  return box;\r\n};\r\n\r\n\r\n/**\r\n * Gets or sets the scroll of the canvas.\r\n *\r\n * @param {ScrollDelta} [delta] The scroll to be set.\r\n *\r\n * @return {Point}\r\n */\r\nCanvas.prototype.scroll = function(delta) {\r\n\r\n  const node = this._viewport;\r\n  let matrix = node.getCTM();\r\n\r\n  if (delta) {\r\n    this._changeViewbox(function() {\r\n      delta = assign({ dx: 0, dy: 0 }, delta || {});\r\n\r\n      matrix = this._svg.createSVGMatrix().translate(delta.dx, delta.dy).multiply(matrix);\r\n\r\n      setCTM(node, matrix);\r\n    });\r\n  }\r\n\r\n  return { x: matrix.e, y: matrix.f };\r\n};\r\n\r\n/**\r\n * Scrolls the viewbox to contain the given element.\r\n * Optionally specify a padding to be applied to the edges.\r\n *\r\n * @param {ShapeLike|ConnectionLike|string} element The element to scroll to or its ID.\r\n * @param {RectTRBL|number} [padding=100] The padding to be applied. Can also specify top, bottom, left and right.\r\n */\r\nCanvas.prototype.scrollToElement = function(element, padding) {\r\n  let defaultPadding = 100;\r\n\r\n  if (typeof element === 'string') {\r\n    element = this._elementRegistry.get(element);\r\n  }\r\n\r\n  // set to correct rootElement\r\n  const rootElement = this.findRoot(element);\r\n\r\n  if (rootElement !== this.getRootElement()) {\r\n    this.setRootElement(rootElement);\r\n  }\r\n\r\n  // element is rootElement, do not change viewport\r\n  if (rootElement === element) {\r\n    return;\r\n  }\r\n\r\n  if (!padding) {\r\n    padding = {};\r\n  }\r\n  if (typeof padding === 'number') {\r\n    defaultPadding = padding;\r\n  }\r\n\r\n  padding = {\r\n    top: padding.top || defaultPadding,\r\n    right: padding.right || defaultPadding,\r\n    bottom: padding.bottom || defaultPadding,\r\n    left: padding.left || defaultPadding\r\n  };\r\n\r\n  const elementBounds = getBoundingBox(element),\r\n        elementTrbl = asTRBL(elementBounds),\r\n        viewboxBounds = this.viewbox(),\r\n        zoom = this.zoom();\r\n  let dx, dy;\r\n\r\n  // shrink viewboxBounds with padding\r\n  viewboxBounds.y += padding.top / zoom;\r\n  viewboxBounds.x += padding.left / zoom;\r\n  viewboxBounds.width -= (padding.right + padding.left) / zoom;\r\n  viewboxBounds.height -= (padding.bottom + padding.top) / zoom;\r\n\r\n  const viewboxTrbl = asTRBL(viewboxBounds);\r\n\r\n  const canFit = elementBounds.width < viewboxBounds.width && elementBounds.height < viewboxBounds.height;\r\n\r\n  if (!canFit) {\r\n\r\n    // top-left when element can't fit\r\n    dx = elementBounds.x - viewboxBounds.x;\r\n    dy = elementBounds.y - viewboxBounds.y;\r\n\r\n  } else {\r\n\r\n    const dRight = Math.max(0, elementTrbl.right - viewboxTrbl.right),\r\n          dLeft = Math.min(0, elementTrbl.left - viewboxTrbl.left),\r\n          dBottom = Math.max(0, elementTrbl.bottom - viewboxTrbl.bottom),\r\n          dTop = Math.min(0, elementTrbl.top - viewboxTrbl.top);\r\n\r\n    dx = dRight || dLeft;\r\n    dy = dBottom || dTop;\r\n\r\n  }\r\n\r\n  this.scroll({ dx: -dx * zoom, dy: -dy * zoom });\r\n};\r\n\r\n/**\r\n * Gets or sets the current zoom of the canvas, optionally zooming to the\r\n * specified position.\r\n *\r\n * The getter may return a cached zoom level. Call it with `false` as the first\r\n * argument to force recomputation of the current level.\r\n *\r\n * @param {number|'fit-viewport'} [newScale] The new zoom level, either a number,\r\n * i.e. 0.9, or `fit-viewport` to adjust the size to fit the current viewport.\r\n * @param {Point} [center] The reference point { x: ..., y: ...} to zoom to.\r\n *\r\n * @return {number} The set zoom level.\r\n */\r\nCanvas.prototype.zoom = function(newScale, center) {\r\n\r\n  if (!newScale) {\r\n    return this.viewbox(newScale).scale;\r\n  }\r\n\r\n  if (newScale === 'fit-viewport') {\r\n    return this._fitViewport(center);\r\n  }\r\n\r\n  let outer,\r\n      matrix;\r\n\r\n  this._changeViewbox(function() {\r\n\r\n    if (typeof center !== 'object') {\r\n      outer = this.viewbox().outer;\r\n\r\n      center = {\r\n        x: outer.width / 2,\r\n        y: outer.height / 2\r\n      };\r\n    }\r\n\r\n    matrix = this._setZoom(newScale, center);\r\n  });\r\n\r\n  return round(matrix.a, 1000);\r\n};\r\n\r\nfunction setCTM(node, m) {\r\n  const mstr = 'matrix(' + m.a + ',' + m.b + ',' + m.c + ',' + m.d + ',' + m.e + ',' + m.f + ')';\r\n  node.setAttribute('transform', mstr);\r\n}\r\n\r\nCanvas.prototype._fitViewport = function(center) {\r\n\r\n  const vbox = this.viewbox(),\r\n        outer = vbox.outer,\r\n        inner = vbox.inner;\r\n  let newScale,\r\n      newViewbox;\r\n\r\n  // display the complete diagram without zooming in.\r\n  // instead of relying on internal zoom, we perform a\r\n  // hard reset on the canvas viewbox to realize this\r\n  //\r\n  // if diagram does not need to be zoomed in, we focus it around\r\n  // the diagram origin instead\r\n\r\n  if (inner.x >= 0 &&\r\n      inner.y >= 0 &&\r\n      inner.x + inner.width <= outer.width &&\r\n      inner.y + inner.height <= outer.height &&\r\n      !center) {\r\n\r\n    newViewbox = {\r\n      x: 0,\r\n      y: 0,\r\n      width: Math.max(inner.width + inner.x, outer.width),\r\n      height: Math.max(inner.height + inner.y, outer.height)\r\n    };\r\n  } else {\r\n\r\n    newScale = Math.min(1, outer.width / inner.width, outer.height / inner.height);\r\n    newViewbox = {\r\n      x: inner.x + (center ? inner.width / 2 - outer.width / newScale / 2 : 0),\r\n      y: inner.y + (center ? inner.height / 2 - outer.height / newScale / 2 : 0),\r\n      width: outer.width / newScale,\r\n      height: outer.height / newScale\r\n    };\r\n  }\r\n\r\n  this.viewbox(newViewbox);\r\n\r\n  return this.viewbox(false).scale;\r\n};\r\n\r\n\r\nCanvas.prototype._setZoom = function(scale, center) {\r\n\r\n  const svg = this._svg,\r\n        viewport = this._viewport;\r\n\r\n  const matrix = svg.createSVGMatrix();\r\n  const point = svg.createSVGPoint();\r\n\r\n  let centerPoint,\r\n      originalPoint,\r\n      currentMatrix,\r\n      scaleMatrix,\r\n      newMatrix;\r\n\r\n  currentMatrix = viewport.getCTM();\r\n\r\n  const currentScale = currentMatrix.a;\r\n\r\n  if (center) {\r\n    centerPoint = assign(point, center);\r\n\r\n    // revert applied viewport transformations\r\n    originalPoint = centerPoint.matrixTransform(currentMatrix.inverse());\r\n\r\n    // create scale matrix\r\n    scaleMatrix = matrix\r\n      .translate(originalPoint.x, originalPoint.y)\r\n      .scale(1 / currentScale * scale)\r\n      .translate(-originalPoint.x, -originalPoint.y);\r\n\r\n    newMatrix = currentMatrix.multiply(scaleMatrix);\r\n  } else {\r\n    newMatrix = matrix.scale(scale);\r\n  }\r\n\r\n  setCTM(this._viewport, newMatrix);\r\n\r\n  return newMatrix;\r\n};\r\n\r\n\r\n/**\r\n * Returns the size of the canvas.\r\n *\r\n * @return {Dimensions} The size of the canvas.\r\n */\r\nCanvas.prototype.getSize = function() {\r\n  return {\r\n    width: this._container.clientWidth,\r\n    height: this._container.clientHeight\r\n  };\r\n};\r\n\r\n\r\n/**\r\n * Returns the absolute bounding box of an element.\r\n *\r\n * The absolute bounding box may be used to display overlays in the callers\r\n * (browser) coordinate system rather than the zoomed in/out canvas coordinates.\r\n *\r\n * @param {ShapeLike|ConnectionLike} element The element.\r\n *\r\n * @return {Rect} The element's absolute bounding box.\r\n */\r\nCanvas.prototype.getAbsoluteBBox = function(element) {\r\n  const vbox = this.viewbox();\r\n  let bbox;\r\n\r\n  // connection\r\n  // use svg bbox\r\n  if (element.waypoints) {\r\n    const gfx = this.getGraphics(element);\r\n\r\n    bbox = gfx.getBBox();\r\n  }\r\n\r\n  // shapes\r\n  // use data\r\n  else {\r\n    bbox = element;\r\n  }\r\n\r\n  const x = bbox.x * vbox.scale - vbox.x * vbox.scale;\r\n  const y = bbox.y * vbox.scale - vbox.y * vbox.scale;\r\n\r\n  const width = bbox.width * vbox.scale;\r\n  const height = bbox.height * vbox.scale;\r\n\r\n  return {\r\n    x: x,\r\n    y: y,\r\n    width: width,\r\n    height: height\r\n  };\r\n};\r\n\r\n/**\r\n * Fires an event so other modules can react to the canvas resizing.\r\n */\r\nCanvas.prototype.resized = function() {\r\n\r\n  // force recomputation of view box\r\n  delete this._cachedViewbox;\r\n\r\n  this._eventBus.fire('canvas.resized');\r\n};\r\n","var ELEMENT_ID = 'data-element-id';\r\n\r\nimport { attr as svgAttr } from 'tiny-svg';\r\n\r\n/**\r\n * @typedef {import('./Types').ElementLike} ElementLike\r\n *\r\n * @typedef {import('./EventBus').default} EventBus\r\n *\r\n * @typedef { (element: ElementLike, gfx: SVGElement) => boolean|any } ElementRegistryFilterCallback\r\n * @typedef { (element: ElementLike, gfx: SVGElement) => any } ElementRegistryForEachCallback\r\n */\r\n\r\n/**\r\n * A registry that keeps track of all shapes in the diagram.\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function ElementRegistry(eventBus) {\r\n\r\n  /**\r\n   * @type { {\r\n   *   [id: string]: {\r\n   *     element: ElementLike;\r\n   *     gfx?: SVGElement;\r\n   *     secondaryGfx?: SVGElement;\r\n   *   }\r\n   * } }\r\n   */\r\n  this._elements = {};\r\n\r\n  this._eventBus = eventBus;\r\n}\r\n\r\nElementRegistry.$inject = [ 'eventBus' ];\r\n\r\n/**\r\n * Add an element and its graphical representation(s) to the registry.\r\n *\r\n * @param {ElementLike} element The element to be added.\r\n * @param {SVGElement} gfx The primary graphical representation.\r\n * @param {SVGElement} [secondaryGfx] The secondary graphical representation.\r\n */\r\nElementRegistry.prototype.add = function(element, gfx, secondaryGfx) {\r\n\r\n  var id = element.id;\r\n\r\n  this._validateId(id);\r\n\r\n  // associate dom node with element\r\n  svgAttr(gfx, ELEMENT_ID, id);\r\n\r\n  if (secondaryGfx) {\r\n    svgAttr(secondaryGfx, ELEMENT_ID, id);\r\n  }\r\n\r\n  this._elements[id] = { element: element, gfx: gfx, secondaryGfx: secondaryGfx };\r\n};\r\n\r\n/**\r\n * Remove an element from the registry.\r\n *\r\n * @param {ElementLike|string} element\r\n */\r\nElementRegistry.prototype.remove = function(element) {\r\n  var elements = this._elements,\r\n      id = element.id || element,\r\n      container = id && elements[id];\r\n\r\n  if (container) {\r\n\r\n    // unset element id on gfx\r\n    svgAttr(container.gfx, ELEMENT_ID, '');\r\n\r\n    if (container.secondaryGfx) {\r\n      svgAttr(container.secondaryGfx, ELEMENT_ID, '');\r\n    }\r\n\r\n    delete elements[id];\r\n  }\r\n};\r\n\r\n/**\r\n * Update an elements ID.\r\n *\r\n * @param {ElementLike|string} element The element or its ID.\r\n * @param {string} newId The new ID.\r\n */\r\nElementRegistry.prototype.updateId = function(element, newId) {\r\n\r\n  this._validateId(newId);\r\n\r\n  if (typeof element === 'string') {\r\n    element = this.get(element);\r\n  }\r\n\r\n  this._eventBus.fire('element.updateId', {\r\n    element: element,\r\n    newId: newId\r\n  });\r\n\r\n  var gfx = this.getGraphics(element),\r\n      secondaryGfx = this.getGraphics(element, true);\r\n\r\n  this.remove(element);\r\n\r\n  element.id = newId;\r\n\r\n  this.add(element, gfx, secondaryGfx);\r\n};\r\n\r\n/**\r\n * Update the graphical representation of an element.\r\n *\r\n * @param {ElementLike|string} filter The element or its ID.\r\n * @param {SVGElement} gfx The new graphical representation.\r\n * @param {boolean} [secondary=false] Whether to update the secondary graphical representation.\r\n */\r\nElementRegistry.prototype.updateGraphics = function(filter, gfx, secondary) {\r\n  var id = filter.id || filter;\r\n\r\n  var container = this._elements[id];\r\n\r\n  if (secondary) {\r\n    container.secondaryGfx = gfx;\r\n  } else {\r\n    container.gfx = gfx;\r\n  }\r\n\r\n  if (gfx) {\r\n    svgAttr(gfx, ELEMENT_ID, id);\r\n  }\r\n\r\n  return gfx;\r\n};\r\n\r\n/**\r\n * Get the element with the given ID or graphical representation.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * elementRegistry.get('SomeElementId_1');\r\n *\r\n * elementRegistry.get(gfx);\r\n * ```\r\n *\r\n * @param {string|SVGElement} filter The elements ID or graphical representation.\r\n *\r\n * @return {ElementLike|undefined} The element.\r\n */\r\nElementRegistry.prototype.get = function(filter) {\r\n  var id;\r\n\r\n  if (typeof filter === 'string') {\r\n    id = filter;\r\n  } else {\r\n    id = filter && svgAttr(filter, ELEMENT_ID);\r\n  }\r\n\r\n  var container = this._elements[id];\r\n  return container && container.element;\r\n};\r\n\r\n/**\r\n * Return all elements that match a given filter function.\r\n *\r\n * @param {ElementRegistryFilterCallback} fn The filter function.\r\n *\r\n * @return {ElementLike[]} The matching elements.\r\n */\r\nElementRegistry.prototype.filter = function(fn) {\r\n\r\n  var filtered = [];\r\n\r\n  this.forEach(function(element, gfx) {\r\n    if (fn(element, gfx)) {\r\n      filtered.push(element);\r\n    }\r\n  });\r\n\r\n  return filtered;\r\n};\r\n\r\n/**\r\n * Return the first element that matches the given filter function.\r\n *\r\n * @param {ElementRegistryFilterCallback} fn The filter function.\r\n *\r\n * @return {ElementLike|undefined} The matching element.\r\n */\r\nElementRegistry.prototype.find = function(fn) {\r\n  var map = this._elements,\r\n      keys = Object.keys(map);\r\n\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var id = keys[i],\r\n        container = map[id],\r\n        element = container.element,\r\n        gfx = container.gfx;\r\n\r\n    if (fn(element, gfx)) {\r\n      return element;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Get all elements.\r\n *\r\n * @return {ElementLike[]} All elements.\r\n */\r\nElementRegistry.prototype.getAll = function() {\r\n  return this.filter(function(e) { return e; });\r\n};\r\n\r\n/**\r\n * Execute a given function for each element.\r\n *\r\n * @param {ElementRegistryForEachCallback} fn The function to execute.\r\n */\r\nElementRegistry.prototype.forEach = function(fn) {\r\n\r\n  var map = this._elements;\r\n\r\n  Object.keys(map).forEach(function(id) {\r\n    var container = map[id],\r\n        element = container.element,\r\n        gfx = container.gfx;\r\n\r\n    return fn(element, gfx);\r\n  });\r\n};\r\n\r\n/**\r\n * Return the graphical representation of an element.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * elementRegistry.getGraphics('SomeElementId_1');\r\n *\r\n * elementRegistry.getGraphics(rootElement); // <g ...>\r\n *\r\n * elementRegistry.getGraphics(rootElement, true); // <svg ...>\r\n * ```\r\n *\r\n * @param {ElementLike|string} filter The element or its ID.\r\n * @param {boolean} [secondary=false] Whether to return the secondary graphical representation.\r\n *\r\n * @return {SVGElement} The graphical representation.\r\n */\r\nElementRegistry.prototype.getGraphics = function(filter, secondary) {\r\n  var id = filter.id || filter;\r\n\r\n  var container = this._elements[id];\r\n  return container && (secondary ? container.secondaryGfx : container.gfx);\r\n};\r\n\r\n/**\r\n * Validate an ID and throw an error if invalid.\r\n *\r\n * @param {string} id\r\n *\r\n * @throws {Error} Error indicating that the ID is invalid or already assigned.\r\n */\r\nElementRegistry.prototype._validateId = function(id) {\r\n  if (!id) {\r\n    throw new Error('element must have an id');\r\n  }\r\n\r\n  if (this._elements[id]) {\r\n    throw new Error('element with id ' + id + ' already added');\r\n  }\r\n};\r\n","/**\n * Extends a collection with {@link Refs} aware methods\n *\n * @param {Array<Object>} collection\n * @param {Refs} refs instance\n * @param {Object} property represented by the collection\n * @param {Object} target object the collection is attached to\n *\n * @return {RefsCollection<Object>} the extended array\n */\nfunction extend(collection, refs, property, target) {\n  var inverseProperty = property.inverse;\n\n  /**\n   * Removes the given element from the array and returns it.\n   *\n   * @method RefsCollection#remove\n   *\n   * @param {Object} element the element to remove\n   */\n  Object.defineProperty(collection, 'remove', {\n    value: function (element) {\n      var idx = this.indexOf(element);\n      if (idx !== -1) {\n        this.splice(idx, 1);\n\n        // unset inverse\n        refs.unset(element, inverseProperty, target);\n      }\n      return element;\n    }\n  });\n\n  /**\n   * Returns true if the collection contains the given element\n   *\n   * @method RefsCollection#contains\n   *\n   * @param {Object} element the element to check for\n   */\n  Object.defineProperty(collection, 'contains', {\n    value: function (element) {\n      return this.indexOf(element) !== -1;\n    }\n  });\n\n  /**\n   * Adds an element to the array, unless it exists already (set semantics).\n   *\n   * @method RefsCollection#add\n   *\n   * @param {Object} element the element to add\n   * @param {Number} optional index to add element to\n   *                 (possibly moving other elements around)\n   */\n  Object.defineProperty(collection, 'add', {\n    value: function (element, idx) {\n      var currentIdx = this.indexOf(element);\n      if (typeof idx === 'undefined') {\n        if (currentIdx !== -1) {\n          // element already in collection (!)\n          return;\n        }\n\n        // add to end of array, as no idx is specified\n        idx = this.length;\n      }\n\n      // handle already in collection\n      if (currentIdx !== -1) {\n        // remove element from currentIdx\n        this.splice(currentIdx, 1);\n      }\n\n      // add element at idx\n      this.splice(idx, 0, element);\n      if (currentIdx === -1) {\n        // set inverse, unless element was\n        // in collection already\n        refs.set(element, inverseProperty, target);\n      }\n    }\n  });\n\n  // a simple marker, identifying this element\n  // as being a refs collection\n  Object.defineProperty(collection, '__refs_collection', {\n    value: true\n  });\n  return collection;\n}\n\n/**\n * Checks if a given collection is extended\n *\n * @param {Array<Object>} collection\n *\n * @return {boolean}\n */\nfunction isExtended(collection) {\n  return collection.__refs_collection === true;\n}\n\nvar collection = {\n  __proto__: null,\n  extend: extend,\n  isExtended: isExtended\n};\n\nfunction hasOwnProperty(e, property) {\n  return Object.prototype.hasOwnProperty.call(e, property.name || property);\n}\nfunction defineCollectionProperty(ref, property, target) {\n  var collection = extend(target[property.name] || [], ref, property, target);\n  Object.defineProperty(target, property.name, {\n    enumerable: property.enumerable,\n    value: collection\n  });\n  if (collection.length) {\n    collection.forEach(function (o) {\n      ref.set(o, property.inverse, target);\n    });\n  }\n}\nfunction defineProperty(ref, property, target) {\n  var inverseProperty = property.inverse;\n  var _value = target[property.name];\n  Object.defineProperty(target, property.name, {\n    configurable: property.configurable,\n    enumerable: property.enumerable,\n    get: function () {\n      return _value;\n    },\n    set: function (value) {\n      // return if we already performed all changes\n      if (value === _value) {\n        return;\n      }\n      var old = _value;\n\n      // temporary set null\n      _value = null;\n      if (old) {\n        ref.unset(old, inverseProperty, target);\n      }\n\n      // set new value\n      _value = value;\n\n      // set inverse value\n      ref.set(_value, inverseProperty, target);\n    }\n  });\n}\n\n/**\n * Creates a new references object defining two inversly related\n * attribute descriptors a and b.\n *\n * <p>\n *   When bound to an object using {@link Refs#bind} the references\n *   get activated and ensure that add and remove operations are applied\n *   reversely, too.\n * </p>\n *\n * <p>\n *   For attributes represented as collections {@link Refs} provides the\n *   {@link RefsCollection#add}, {@link RefsCollection#remove} and {@link RefsCollection#contains} extensions\n *   that must be used to properly hook into the inverse change mechanism.\n * </p>\n *\n * @class Refs\n *\n * @classdesc A bi-directional reference between two attributes.\n *\n * @param {Refs.AttributeDescriptor} a property descriptor\n * @param {Refs.AttributeDescriptor} b property descriptor\n *\n * @example\n *\n * var refs = Refs({ name: 'wheels', collection: true, enumerable: true }, { name: 'car' });\n *\n * var car = { name: 'toyota' };\n * var wheels = [{ pos: 'front-left' }, { pos: 'front-right' }];\n *\n * refs.bind(car, 'wheels');\n *\n * car.wheels // []\n * car.wheels.add(wheels[0]);\n * car.wheels.add(wheels[1]);\n *\n * car.wheels // [{ pos: 'front-left' }, { pos: 'front-right' }]\n *\n * wheels[0].car // { name: 'toyota' };\n * car.wheels.remove(wheels[0]);\n *\n * wheels[0].car // undefined\n */\nfunction Refs(a, b) {\n  if (!(this instanceof Refs)) {\n    return new Refs(a, b);\n  }\n\n  // link\n  a.inverse = b;\n  b.inverse = a;\n  this.props = {};\n  this.props[a.name] = a;\n  this.props[b.name] = b;\n}\n\n/**\n * Binds one side of a bi-directional reference to a\n * target object.\n *\n * @memberOf Refs\n *\n * @param  {Object} target\n * @param  {String} property\n */\nRefs.prototype.bind = function (target, property) {\n  if (typeof property === 'string') {\n    if (!this.props[property]) {\n      throw new Error('no property <' + property + '> in ref');\n    }\n    property = this.props[property];\n  }\n  if (property.collection) {\n    defineCollectionProperty(this, property, target);\n  } else {\n    defineProperty(this, property, target);\n  }\n};\nRefs.prototype.ensureRefsCollection = function (target, property) {\n  var collection = target[property.name];\n  if (!isExtended(collection)) {\n    defineCollectionProperty(this, property, target);\n  }\n  return collection;\n};\nRefs.prototype.ensureBound = function (target, property) {\n  if (!hasOwnProperty(target, property)) {\n    this.bind(target, property);\n  }\n};\nRefs.prototype.unset = function (target, property, value) {\n  if (target) {\n    this.ensureBound(target, property);\n    if (property.collection) {\n      this.ensureRefsCollection(target, property).remove(value);\n    } else {\n      target[property.name] = undefined;\n    }\n  }\n};\nRefs.prototype.set = function (target, property, value) {\n  if (target) {\n    this.ensureBound(target, property);\n    if (property.collection) {\n      this.ensureRefsCollection(target, property).add(value);\n    } else {\n      target[property.name] = value;\n    }\n  }\n};\n\n/**\n * An attribute descriptor to be used specify an attribute in a {@link Refs} instance\n *\n * @typedef {Object} Refs.AttributeDescriptor\n * @property {String} name\n * @property {boolean} [collection=false]\n * @property {boolean} [enumerable=false]\n */\n\nexport { collection as Collection, Refs };\n","import { assign } from 'min-dash';\r\nimport inherits from 'inherits-browser';\r\n\r\nimport { Refs } from 'object-refs';\r\n\r\nvar parentRefs = new Refs({ name: 'children', enumerable: true, collection: true }, { name: 'parent' }),\r\n    labelRefs = new Refs({ name: 'labels', enumerable: true, collection: true }, { name: 'labelTarget' }),\r\n    attacherRefs = new Refs({ name: 'attachers', collection: true }, { name: 'host' }),\r\n    outgoingRefs = new Refs({ name: 'outgoing', collection: true }, { name: 'source' }),\r\n    incomingRefs = new Refs({ name: 'incoming', collection: true }, { name: 'target' });\r\n\r\n/**\r\n * @typedef {import('./Types').Element} Element\r\n * @typedef {import('./Types').Shape} Shape\r\n * @typedef {import('./Types').Root} Root\r\n * @typedef {import('./Types').Label} Label\r\n * @typedef {import('./Types').Connection} Connection\r\n */\r\n\r\n/**\r\n * The basic graphical representation\r\n *\r\n * @class\r\n * @constructor\r\n */\r\nfunction ElementImpl() {\r\n\r\n  /**\r\n   * The object that backs up the shape\r\n   *\r\n   * @name Element#businessObject\r\n   * @type Object\r\n   */\r\n  Object.defineProperty(this, 'businessObject', {\r\n    writable: true\r\n  });\r\n\r\n\r\n  /**\r\n   * Single label support, will mapped to multi label array\r\n   *\r\n   * @name Element#label\r\n   * @type Object\r\n   */\r\n  Object.defineProperty(this, 'label', {\r\n    get: function() {\r\n      return this.labels[0];\r\n    },\r\n    set: function(newLabel) {\r\n\r\n      var label = this.label,\r\n          labels = this.labels;\r\n\r\n      if (!newLabel && label) {\r\n        labels.remove(label);\r\n      } else {\r\n        labels.add(newLabel, 0);\r\n      }\r\n    }\r\n  });\r\n\r\n  /**\r\n   * The parent shape\r\n   *\r\n   * @name Element#parent\r\n   * @type Shape\r\n   */\r\n  parentRefs.bind(this, 'parent');\r\n\r\n  /**\r\n   * The list of labels\r\n   *\r\n   * @name Element#labels\r\n   * @type Label\r\n   */\r\n  labelRefs.bind(this, 'labels');\r\n\r\n  /**\r\n   * The list of outgoing connections\r\n   *\r\n   * @name Element#outgoing\r\n   * @type Array<Connection>\r\n   */\r\n  outgoingRefs.bind(this, 'outgoing');\r\n\r\n  /**\r\n   * The list of incoming connections\r\n   *\r\n   * @name Element#incoming\r\n   * @type Array<Connection>\r\n   */\r\n  incomingRefs.bind(this, 'incoming');\r\n}\r\n\r\n\r\n/**\r\n * A graphical object\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * @extends ElementImpl\r\n */\r\nfunction ShapeImpl() {\r\n  ElementImpl.call(this);\r\n\r\n  /**\r\n   * Indicates frame shapes\r\n   *\r\n   * @name ShapeImpl#isFrame\r\n   * @type boolean\r\n   */\r\n\r\n  /**\r\n   * The list of children\r\n   *\r\n   * @name ShapeImpl#children\r\n   * @type Element[]\r\n   */\r\n  parentRefs.bind(this, 'children');\r\n\r\n  /**\r\n   * @name ShapeImpl#host\r\n   * @type Shape\r\n   */\r\n  attacherRefs.bind(this, 'host');\r\n\r\n  /**\r\n   * @name ShapeImpl#attachers\r\n   * @type Shape\r\n   */\r\n  attacherRefs.bind(this, 'attachers');\r\n}\r\n\r\ninherits(ShapeImpl, ElementImpl);\r\n\r\n\r\n/**\r\n * A root graphical object\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * @extends ElementImpl\r\n */\r\nfunction RootImpl() {\r\n  ElementImpl.call(this);\r\n\r\n  /**\r\n   * The list of children\r\n   *\r\n   * @name RootImpl#children\r\n   * @type Element[]\r\n   */\r\n  parentRefs.bind(this, 'children');\r\n}\r\n\r\ninherits(RootImpl, ShapeImpl);\r\n\r\n\r\n/**\r\n * A label for an element\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * @extends ShapeImpl\r\n */\r\nfunction LabelImpl() {\r\n  ShapeImpl.call(this);\r\n\r\n  /**\r\n   * The labeled element\r\n   *\r\n   * @name LabelImpl#labelTarget\r\n   * @type Element\r\n   */\r\n  labelRefs.bind(this, 'labelTarget');\r\n}\r\n\r\ninherits(LabelImpl, ShapeImpl);\r\n\r\n\r\n/**\r\n * A connection between two elements\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * @extends ElementImpl\r\n */\r\nfunction ConnectionImpl() {\r\n  ElementImpl.call(this);\r\n\r\n  /**\r\n   * The element this connection originates from\r\n   *\r\n   * @name ConnectionImpl#source\r\n   * @type Element\r\n   */\r\n  outgoingRefs.bind(this, 'source');\r\n\r\n  /**\r\n   * The element this connection points to\r\n   *\r\n   * @name ConnectionImpl#target\r\n   * @type Element\r\n   */\r\n  incomingRefs.bind(this, 'target');\r\n}\r\n\r\ninherits(ConnectionImpl, ElementImpl);\r\n\r\n\r\nvar types = {\r\n  connection: ConnectionImpl,\r\n  shape: ShapeImpl,\r\n  label: LabelImpl,\r\n  root: RootImpl\r\n};\r\n\r\n/**\r\n * Creates a root element.\r\n *\r\n * @overlord\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * import * as Model from 'diagram-js/lib/model';\r\n *\r\n * const root = Model.create('root', {\r\n *   x: 100,\r\n *   y: 100,\r\n *   width: 100,\r\n *   height: 100\r\n * });\r\n * ```\r\n *\r\n * @param {'root'} type\r\n * @param {any} [attrs]\r\n *\r\n * @return {Root}\r\n */\r\n\r\n/**\r\n * Creates a connection.\r\n *\r\n * @overlord\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * import * as Model from 'diagram-js/lib/model';\r\n *\r\n * const connection = Model.create('connection', {\r\n *   waypoints: [\r\n *     { x: 100, y: 100 },\r\n *     { x: 200, y: 100 }\r\n *   ]\r\n * });\r\n * ```\r\n *\r\n * @param {'connection'} type\r\n * @param {any} [attrs]\r\n *\r\n * @return {Connection}\r\n */\r\n\r\n/**\r\n * Creates a shape.\r\n *\r\n * @overlord\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * import * as Model from 'diagram-js/lib/model';\r\n *\r\n * const shape = Model.create('shape', {\r\n *   x: 100,\r\n *   y: 100,\r\n *   width: 100,\r\n *   height: 100\r\n * });\r\n * ```\r\n *\r\n * @param {'shape'} type\r\n * @param {any} [attrs]\r\n *\r\n * @return {Shape}\r\n */\r\n\r\n/**\r\n * Creates a label.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * import * as Model from 'diagram-js/lib/model';\r\n *\r\n * const label = Model.create('label', {\r\n *   x: 100,\r\n *   y: 100,\r\n *   width: 100,\r\n *   height: 100,\r\n *   labelTarget: shape\r\n * });\r\n * ```\r\n *\r\n * @param {'label'} type\r\n * @param {Object} [attrs]\r\n *\r\n * @return {Label}\r\n */\r\nexport function create(type, attrs) {\r\n  var Type = types[type];\r\n  if (!Type) {\r\n    throw new Error('unknown type: <' + type + '>');\r\n  }\r\n  return assign(new Type(), attrs);\r\n}\r\n\r\n/**\r\n * Checks whether an object is a model instance.\r\n *\r\n * @param {any} obj\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isModelElement(obj) {\r\n  return obj instanceof ElementImpl;\r\n}","import {\r\n  create\r\n} from '../model';\r\n\r\nimport { assign } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../model/Types').Element} Element\r\n * @typedef {import('../model/Types').Connection} Connection\r\n * @typedef {import('../model/Types').Label} Label\r\n * @typedef {import('../model/Types').Root} Root\r\n * @typedef {import('../model/Types').Shape} Shape\r\n */\r\n\r\n/**\r\n * A factory for model elements.\r\n *\r\n * @template {Connection} [T=Connection]\r\n * @template {Label} [U=Label]\r\n * @template {Root} [V=Root]\r\n * @template {Shape} [W=Shape]\r\n */\r\nexport default function ElementFactory() {\r\n  this._uid = 12;\r\n}\r\n\r\n/**\r\n * Create a root element.\r\n *\r\n * @param {Partial<Root>} [attrs]\r\n *\r\n * @return {V} The created root element.\r\n */\r\nElementFactory.prototype.createRoot = function(attrs) {\r\n  return this.create('root', attrs);\r\n};\r\n\r\n/**\r\n * Create a label.\r\n *\r\n * @param {Partial<Label>} [attrs]\r\n *\r\n * @return {U} The created label.\r\n */\r\nElementFactory.prototype.createLabel = function(attrs) {\r\n  return this.create('label', attrs);\r\n};\r\n\r\n/**\r\n * Create a shape.\r\n *\r\n * @param {Partial<Shape>} [attrs]\r\n *\r\n * @return {W} The created shape.\r\n */\r\nElementFactory.prototype.createShape = function(attrs) {\r\n  return this.create('shape', attrs);\r\n};\r\n\r\n/**\r\n * Create a connection.\r\n *\r\n * @param {Partial<Connection>} [attrs]\r\n *\r\n * @return {T} The created connection.\r\n */\r\nElementFactory.prototype.createConnection = function(attrs) {\r\n  return this.create('connection', attrs);\r\n};\r\n\r\n/**\r\n * Create a root element.\r\n *\r\n * @overlord\r\n * @param {'root'} type\r\n * @param {Partial<Root>} [attrs]\r\n * @return {V}\r\n */\r\n/**\r\n * Create a shape.\r\n *\r\n * @overlord\r\n * @param {'shape'} type\r\n * @param {Partial<Shape>} [attrs]\r\n * @return {W}\r\n */\r\n/**\r\n * Create a connection.\r\n *\r\n * @overlord\r\n * @param {'connection'} type\r\n * @param {Partial<Connection>} [attrs]\r\n * @return {T}\r\n */\r\n/**\r\n * Create a label.\r\n *\r\n * @param {'label'} type\r\n * @param {Partial<Label>} [attrs]\r\n * @return {U}\r\n */\r\nElementFactory.prototype.create = function(type, attrs) {\r\n\r\n  attrs = assign({}, attrs || {});\r\n\r\n  if (!attrs.id) {\r\n    attrs.id = type + '_' + (this._uid++);\r\n  }\r\n\r\n  return create(type, attrs);\r\n};","import {\r\n  isFunction,\r\n  isArray,\r\n  isNumber,\r\n  bind,\r\n  assign\r\n} from 'min-dash';\r\n\r\nvar FN_REF = '__fn';\r\n\r\nvar DEFAULT_PRIORITY = 1000;\r\n\r\nvar slice = Array.prototype.slice;\r\n\r\n/**\r\n * @typedef { {\r\n *   stopPropagation(): void;\r\n *   preventDefault(): void;\r\n *   cancelBubble: boolean;\r\n *   defaultPrevented: boolean;\r\n *   returnValue: any;\r\n * } } Event\r\n */\r\n\r\n/**\r\n * @template E\r\n *\r\n * @typedef { (event: E & Event, ...any) => any } EventBusEventCallback\r\n */\r\n\r\n/**\r\n * @typedef { {\r\n *  priority: number;\r\n *  next: EventBusListener | null;\r\n *  callback: EventBusEventCallback<any>;\r\n * } } EventBusListener\r\n */\r\n\r\n/**\r\n * A general purpose event bus.\r\n *\r\n * This component is used to communicate across a diagram instance.\r\n * Other parts of a diagram can use it to listen to and broadcast events.\r\n *\r\n *\r\n * ## Registering for Events\r\n *\r\n * The event bus provides the {@link EventBus#on} and {@link EventBus#once}\r\n * methods to register for events. {@link EventBus#off} can be used to\r\n * remove event registrations. Listeners receive an instance of {@link Event}\r\n * as the first argument. It allows them to hook into the event execution.\r\n *\r\n * ```javascript\r\n *\r\n * // listen for event\r\n * eventBus.on('foo', function(event) {\r\n *\r\n *   // access event type\r\n *   event.type; // 'foo'\r\n *\r\n *   // stop propagation to other listeners\r\n *   event.stopPropagation();\r\n *\r\n *   // prevent event default\r\n *   event.preventDefault();\r\n * });\r\n *\r\n * // listen for event with custom payload\r\n * eventBus.on('bar', function(event, payload) {\r\n *   console.log(payload);\r\n * });\r\n *\r\n * // listen for event returning value\r\n * eventBus.on('foobar', function(event) {\r\n *\r\n *   // stop event propagation + prevent default\r\n *   return false;\r\n *\r\n *   // stop event propagation + return custom result\r\n *   return {\r\n *     complex: 'listening result'\r\n *   };\r\n * });\r\n *\r\n *\r\n * // listen with custom priority (default=1000, higher is better)\r\n * eventBus.on('priorityfoo', 1500, function(event) {\r\n *   console.log('invoked first!');\r\n * });\r\n *\r\n *\r\n * // listen for event and pass the context (`this`)\r\n * eventBus.on('foobar', function(event) {\r\n *   this.foo();\r\n * }, this);\r\n * ```\r\n *\r\n *\r\n * ## Emitting Events\r\n *\r\n * Events can be emitted via the event bus using {@link EventBus#fire}.\r\n *\r\n * ```javascript\r\n *\r\n * // false indicates that the default action\r\n * // was prevented by listeners\r\n * if (eventBus.fire('foo') === false) {\r\n *   console.log('default has been prevented!');\r\n * };\r\n *\r\n *\r\n * // custom args + return value listener\r\n * eventBus.on('sum', function(event, a, b) {\r\n *   return a + b;\r\n * });\r\n *\r\n * // you can pass custom arguments + retrieve result values.\r\n * var sum = eventBus.fire('sum', 1, 2);\r\n * console.log(sum); // 3\r\n * ```\r\n *\r\n * @template [EventMap=null]\r\n */\r\nexport default function EventBus() {\r\n\r\n  /**\r\n   * @type { Record<string, EventBusListener> }\r\n   */\r\n  this._listeners = {};\r\n\r\n  // cleanup on destroy on lowest priority to allow\r\n  // message passing until the bitter end\r\n  this.on('diagram.destroy', 1, this._destroy, this);\r\n}\r\n\r\n/**\r\n * @overlord\r\n *\r\n * Register an event listener for events with the given name.\r\n *\r\n * The callback will be invoked with `event, ...additionalArguments`\r\n * that have been passed to {@link EventBus#fire}.\r\n *\r\n * Returning false from a listener will prevent the events default action\r\n * (if any is specified). To stop an event from being processed further in\r\n * other listeners execute {@link Event#stopPropagation}.\r\n *\r\n * Returning anything but `undefined` from a listener will stop the listener propagation.\r\n *\r\n * @template T\r\n *\r\n * @param {string|string[]} events to subscribe to\r\n * @param {number} [priority=1000] listen priority\r\n * @param {EventBusEventCallback<T>} callback\r\n * @param {any} [that] callback context\r\n */\r\n/**\r\n * Register an event listener for events with the given name.\r\n *\r\n * The callback will be invoked with `event, ...additionalArguments`\r\n * that have been passed to {@link EventBus#fire}.\r\n *\r\n * Returning false from a listener will prevent the events default action\r\n * (if any is specified). To stop an event from being processed further in\r\n * other listeners execute {@link Event#stopPropagation}.\r\n *\r\n * Returning anything but `undefined` from a listener will stop the listener propagation.\r\n *\r\n * @template {keyof EventMap} EventName\r\n *\r\n * @param {EventName} events to subscribe to\r\n * @param {number} [priority=1000] listen priority\r\n * @param {EventBusEventCallback<EventMap[EventName]>} callback\r\n * @param {any} [that] callback context\r\n */\r\nEventBus.prototype.on = function(events, priority, callback, that) {\r\n\r\n  events = isArray(events) ? events : [ events ];\r\n\r\n  if (isFunction(priority)) {\r\n    that = callback;\r\n    callback = priority;\r\n    priority = DEFAULT_PRIORITY;\r\n  }\r\n\r\n  if (!isNumber(priority)) {\r\n    throw new Error('priority must be a number');\r\n  }\r\n\r\n  var actualCallback = callback;\r\n\r\n  if (that) {\r\n    actualCallback = bind(callback, that);\r\n\r\n    // make sure we remember and are able to remove\r\n    // bound callbacks via {@link #off} using the original\r\n    // callback\r\n    actualCallback[FN_REF] = callback[FN_REF] || callback;\r\n  }\r\n\r\n  var self = this;\r\n\r\n  events.forEach(function(e) {\r\n    self._addListener(e, {\r\n      priority: priority,\r\n      callback: actualCallback,\r\n      next: null\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * @overlord\r\n *\r\n * Register an event listener that is called only once.\r\n *\r\n * @template T\r\n *\r\n * @param {string|string[]} events to subscribe to\r\n * @param {number} [priority=1000] the listen priority\r\n * @param {EventBusEventCallback<T>} callback\r\n * @param {any} [that] callback context\r\n */\r\n/**\r\n * Register an event listener that is called only once.\r\n *\r\n * @template {keyof EventMap} EventName\r\n *\r\n * @param {EventName} events to subscribe to\r\n * @param {number} [priority=1000] listen priority\r\n * @param {EventBusEventCallback<EventMap[EventName]>} callback\r\n * @param {any} [that] callback context\r\n */\r\nEventBus.prototype.once = function(events, priority, callback, that) {\r\n  var self = this;\r\n\r\n  if (isFunction(priority)) {\r\n    that = callback;\r\n    callback = priority;\r\n    priority = DEFAULT_PRIORITY;\r\n  }\r\n\r\n  if (!isNumber(priority)) {\r\n    throw new Error('priority must be a number');\r\n  }\r\n\r\n  function wrappedCallback() {\r\n    wrappedCallback.__isTomb = true;\r\n\r\n    var result = callback.apply(that, arguments);\r\n\r\n    self.off(events, wrappedCallback);\r\n\r\n    return result;\r\n  }\r\n\r\n  // make sure we remember and are able to remove\r\n  // bound callbacks via {@link #off} using the original\r\n  // callback\r\n  wrappedCallback[FN_REF] = callback;\r\n\r\n  this.on(events, priority, wrappedCallback);\r\n};\r\n\r\n\r\n/**\r\n * Removes event listeners by event and callback.\r\n *\r\n * If no callback is given, all listeners for a given event name are being removed.\r\n *\r\n * @param {string|string[]} events\r\n * @param {EventBusEventCallback} [callback]\r\n */\r\nEventBus.prototype.off = function(events, callback) {\r\n\r\n  events = isArray(events) ? events : [ events ];\r\n\r\n  var self = this;\r\n\r\n  events.forEach(function(event) {\r\n    self._removeListener(event, callback);\r\n  });\r\n\r\n};\r\n\r\n\r\n/**\r\n * Create an event recognized be the event bus.\r\n *\r\n * @param {Object} data Event data.\r\n *\r\n * @return {Event} An event that will be recognized by the event bus.\r\n */\r\nEventBus.prototype.createEvent = function(data) {\r\n  var event = new InternalEvent();\r\n\r\n  event.init(data);\r\n\r\n  return event;\r\n};\r\n\r\n\r\n/**\r\n * Fires an event.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * // fire event by name\r\n * events.fire('foo');\r\n *\r\n * // fire event object with nested type\r\n * var event = { type: 'foo' };\r\n * events.fire(event);\r\n *\r\n * // fire event with explicit type\r\n * var event = { x: 10, y: 20 };\r\n * events.fire('element.moved', event);\r\n *\r\n * // pass additional arguments to the event\r\n * events.on('foo', function(event, bar) {\r\n *   alert(bar);\r\n * });\r\n *\r\n * events.fire({ type: 'foo' }, 'I am bar!');\r\n * ```\r\n *\r\n * @param {string} [type] event type\r\n * @param {Object} [data] event or event data\r\n * @param {...any} [args] additional arguments the callback will be called with.\r\n *\r\n * @return {any} The return value. Will be set to `false` if the default was prevented.\r\n */\r\nEventBus.prototype.fire = function(type, data) {\r\n  var event,\r\n      firstListener,\r\n      returnValue,\r\n      args;\r\n\r\n  args = slice.call(arguments);\r\n\r\n  if (typeof type === 'object') {\r\n    data = type;\r\n    type = data.type;\r\n  }\r\n\r\n  if (!type) {\r\n    throw new Error('no event type specified');\r\n  }\r\n\r\n  firstListener = this._listeners[type];\r\n\r\n  if (!firstListener) {\r\n    return;\r\n  }\r\n\r\n  // we make sure we fire instances of our home made\r\n  // events here. We wrap them only once, though\r\n  if (data instanceof InternalEvent) {\r\n\r\n    // we are fine, we alread have an event\r\n    event = data;\r\n  } else {\r\n    event = this.createEvent(data);\r\n  }\r\n\r\n  // ensure we pass the event as the first parameter\r\n  args[0] = event;\r\n\r\n  // original event type (in case we delegate)\r\n  var originalType = event.type;\r\n\r\n  // update event type before delegation\r\n  if (type !== originalType) {\r\n    event.type = type;\r\n  }\r\n\r\n  try {\r\n    returnValue = this._invokeListeners(event, args, firstListener);\r\n  } finally {\r\n\r\n    // reset event type after delegation\r\n    if (type !== originalType) {\r\n      event.type = originalType;\r\n    }\r\n  }\r\n\r\n  // set the return value to false if the event default\r\n  // got prevented and no other return value exists\r\n  if (returnValue === undefined && event.defaultPrevented) {\r\n    returnValue = false;\r\n  }\r\n\r\n  return returnValue;\r\n};\r\n\r\n/**\r\n * Handle an error by firing an event.\r\n *\r\n * @param {Error} error The error to be handled.\r\n *\r\n * @return {boolean} Whether the error was handled.\r\n */\r\nEventBus.prototype.handleError = function(error) {\r\n  return this.fire('error', { error: error }) === false;\r\n};\r\n\r\n\r\nEventBus.prototype._destroy = function() {\r\n  this._listeners = {};\r\n};\r\n\r\n/**\r\n * @param {Event} event\r\n * @param {any[]} args\r\n * @param {EventBusListener} listener\r\n *\r\n * @return {any}\r\n */\r\nEventBus.prototype._invokeListeners = function(event, args, listener) {\r\n\r\n  var returnValue;\r\n\r\n  while (listener) {\r\n\r\n    // handle stopped propagation\r\n    if (event.cancelBubble) {\r\n      break;\r\n    }\r\n\r\n    returnValue = this._invokeListener(event, args, listener);\r\n\r\n    listener = listener.next;\r\n  }\r\n\r\n  return returnValue;\r\n};\r\n\r\n/**\r\n * @param {Event} event\r\n * @param {any[]} args\r\n * @param {EventBusListener} listener\r\n *\r\n * @return {any}\r\n */\r\nEventBus.prototype._invokeListener = function(event, args, listener) {\r\n\r\n  var returnValue;\r\n\r\n  if (listener.callback.__isTomb) {\r\n    return returnValue;\r\n  }\r\n\r\n  try {\r\n\r\n    // returning false prevents the default action\r\n    returnValue = invokeFunction(listener.callback, args);\r\n\r\n    // stop propagation on return value\r\n    if (returnValue !== undefined) {\r\n      event.returnValue = returnValue;\r\n      event.stopPropagation();\r\n    }\r\n\r\n    // prevent default on return false\r\n    if (returnValue === false) {\r\n      event.preventDefault();\r\n    }\r\n  } catch (error) {\r\n    if (!this.handleError(error)) {\r\n      console.error('unhandled error in event listener', error);\r\n\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  return returnValue;\r\n};\r\n\r\n/**\r\n * Add new listener with a certain priority to the list\r\n * of listeners (for the given event).\r\n *\r\n * The semantics of listener registration / listener execution are\r\n * first register, first serve: New listeners will always be inserted\r\n * after existing listeners with the same priority.\r\n *\r\n * Example: Inserting two listeners with priority 1000 and 1300\r\n *\r\n *    * before: [ 1500, 1500, 1000, 1000 ]\r\n *    * after: [ 1500, 1500, (new=1300), 1000, 1000, (new=1000) ]\r\n *\r\n * @param {string} event\r\n * @param {EventBusListener} newListener\r\n */\r\nEventBus.prototype._addListener = function(event, newListener) {\r\n\r\n  var listener = this._getListeners(event),\r\n      previousListener;\r\n\r\n  // no prior listeners\r\n  if (!listener) {\r\n    this._setListeners(event, newListener);\r\n\r\n    return;\r\n  }\r\n\r\n  // ensure we order listeners by priority from\r\n  // 0 (high) to n > 0 (low)\r\n  while (listener) {\r\n\r\n    if (listener.priority < newListener.priority) {\r\n\r\n      newListener.next = listener;\r\n\r\n      if (previousListener) {\r\n        previousListener.next = newListener;\r\n      } else {\r\n        this._setListeners(event, newListener);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    previousListener = listener;\r\n    listener = listener.next;\r\n  }\r\n\r\n  // add new listener to back\r\n  previousListener.next = newListener;\r\n};\r\n\r\n\r\n/**\r\n * @param {string} name\r\n *\r\n * @return {EventBusListener}\r\n */\r\nEventBus.prototype._getListeners = function(name) {\r\n  return this._listeners[name];\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n * @param {EventBusListener} listener\r\n */\r\nEventBus.prototype._setListeners = function(name, listener) {\r\n  this._listeners[name] = listener;\r\n};\r\n\r\nEventBus.prototype._removeListener = function(event, callback) {\r\n\r\n  var listener = this._getListeners(event),\r\n      nextListener,\r\n      previousListener,\r\n      listenerCallback;\r\n\r\n  if (!callback) {\r\n\r\n    // clear listeners\r\n    this._setListeners(event, null);\r\n\r\n    return;\r\n  }\r\n\r\n  while (listener) {\r\n\r\n    nextListener = listener.next;\r\n\r\n    listenerCallback = listener.callback;\r\n\r\n    if (listenerCallback === callback || listenerCallback[FN_REF] === callback) {\r\n      if (previousListener) {\r\n        previousListener.next = nextListener;\r\n      } else {\r\n\r\n        // new first listener\r\n        this._setListeners(event, nextListener);\r\n      }\r\n    }\r\n\r\n    previousListener = listener;\r\n    listener = nextListener;\r\n  }\r\n};\r\n\r\n/**\r\n * A event that is emitted via the event bus.\r\n */\r\nfunction InternalEvent() { }\r\n\r\nInternalEvent.prototype.stopPropagation = function() {\r\n  this.cancelBubble = true;\r\n};\r\n\r\nInternalEvent.prototype.preventDefault = function() {\r\n  this.defaultPrevented = true;\r\n};\r\n\r\nInternalEvent.prototype.init = function(data) {\r\n  assign(this, data || {});\r\n};\r\n\r\n\r\n/**\r\n * Invoke function. Be fast...\r\n *\r\n * @param {Function} fn\r\n * @param {any[]} args\r\n *\r\n * @return {any}\r\n */\r\nfunction invokeFunction(fn, args) {\r\n  return fn.apply(null, args);\r\n}\r\n","/**\r\n * SVGs for elements are generated by the {@link GraphicsFactory}.\r\n *\r\n * This utility gives quick access to the important semantic\r\n * parts of an element.\r\n */\r\n\r\n/**\r\n * Returns the visual part of a diagram element.\r\n *\r\n * @param {SVGElement} gfx\r\n *\r\n * @return {SVGElement}\r\n */\r\nexport function getVisual(gfx) {\r\n  return gfx.childNodes[0];\r\n}\r\n\r\n/**\r\n * Returns the children for a given diagram element.\r\n *\r\n * @param {SVGElement} gfx\r\n * @return {SVGElement}\r\n */\r\nexport function getChildren(gfx) {\r\n  return gfx.parentNode.childNodes[1];\r\n}","import {\r\n  transform as svgTransform,\r\n  createTransform\r\n} from 'tiny-svg';\r\n\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {number} [angle]\r\n * @param {number} [amount]\r\n */\r\nexport function transform(gfx, x, y, angle, amount) {\r\n  var translate = createTransform();\r\n  translate.setTranslate(x, y);\r\n\r\n  var rotate = createTransform();\r\n  rotate.setRotate(angle || 0, 0, 0);\r\n\r\n  var scale = createTransform();\r\n  scale.setScale(amount || 1, amount || 1);\r\n\r\n  svgTransform(gfx, [ translate, rotate, scale ]);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {number} x\r\n * @param {number} y\r\n */\r\nexport function translate(gfx, x, y) {\r\n  var translate = createTransform();\r\n  translate.setTranslate(x, y);\r\n\r\n  svgTransform(gfx, translate);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {number} angle\r\n */\r\nexport function rotate(gfx, angle) {\r\n  var rotate = createTransform();\r\n  rotate.setRotate(angle, 0, 0);\r\n\r\n  svgTransform(gfx, rotate);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {number} amount\r\n */\r\nexport function scale(gfx, amount) {\r\n  var scale = createTransform();\r\n  scale.setScale(amount, amount);\r\n\r\n  svgTransform(gfx, scale);\r\n}\r\n","import {\r\n  forEach,\r\n  reduce\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getChildren,\r\n  getVisual\r\n} from '../util/GraphicsUtil';\r\n\r\nimport { translate } from '../util/SvgTransformUtil';\r\n\r\nimport { clear as domClear } from 'min-dom';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  isFrameElement\r\n} from '../util/Elements';\r\n\r\n/**\r\n * @typedef {import('./Types').ConnectionLike} ConnectionLike\r\n * @typedef {import('./Types').ElementLike} ElementLike\r\n * @typedef {import('./Types').ShapeLike} ShapeLike\r\n *\r\n * @typedef {import('./ElementRegistry').default} ElementRegistry\r\n * @typedef {import('./EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * A factory that creates graphical elements.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {ElementRegistry} elementRegistry\r\n */\r\nexport default function GraphicsFactory(eventBus, elementRegistry) {\r\n  this._eventBus = eventBus;\r\n  this._elementRegistry = elementRegistry;\r\n}\r\n\r\nGraphicsFactory.$inject = [ 'eventBus' , 'elementRegistry' ];\r\n\r\n/**\r\n * @param { { parent?: any } } element\r\n * @return {SVGElement}\r\n */\r\nGraphicsFactory.prototype._getChildrenContainer = function(element) {\r\n\r\n  var gfx = this._elementRegistry.getGraphics(element);\r\n\r\n  var childrenGfx;\r\n\r\n  // root element\r\n  if (!element.parent) {\r\n    childrenGfx = gfx;\r\n  } else {\r\n    childrenGfx = getChildren(gfx);\r\n    if (!childrenGfx) {\r\n      childrenGfx = svgCreate('g');\r\n      svgClasses(childrenGfx).add('djs-children');\r\n\r\n      svgAppend(gfx.parentNode, childrenGfx);\r\n    }\r\n  }\r\n\r\n  return childrenGfx;\r\n};\r\n\r\n/**\r\n * Clears the graphical representation of the element and returns the\r\n * cleared visual (the <g class=\"djs-visual\" /> element).\r\n */\r\nGraphicsFactory.prototype._clear = function(gfx) {\r\n  var visual = getVisual(gfx);\r\n\r\n  domClear(visual);\r\n\r\n  return visual;\r\n};\r\n\r\n/**\r\n * Creates a gfx container for shapes and connections\r\n *\r\n * The layout is as follows:\r\n *\r\n * <g class=\"djs-group\">\r\n *\r\n *   <!-- the gfx -->\r\n *   <g class=\"djs-element djs-(shape|connection|frame)\">\r\n *     <g class=\"djs-visual\">\r\n *       <!-- the renderer draws in here -->\r\n *     </g>\r\n *\r\n *     <!-- extensions (overlays, click box, ...) goes here\r\n *   </g>\r\n *\r\n *   <!-- the gfx child nodes -->\r\n *   <g class=\"djs-children\"></g>\r\n * </g>\r\n *\r\n * @param {string} type the type of the element, i.e. shape | connection\r\n * @param {SVGElement} childrenGfx\r\n * @param {number} [parentIndex] position to create container in parent\r\n * @param {boolean} [isFrame] is frame element\r\n *\r\n * @return {SVGElement}\r\n */\r\nGraphicsFactory.prototype._createContainer = function(\r\n    type, childrenGfx, parentIndex, isFrame\r\n) {\r\n  var outerGfx = svgCreate('g');\r\n  svgClasses(outerGfx).add('djs-group');\r\n\r\n  // insert node at position\r\n  if (typeof parentIndex !== 'undefined') {\r\n    prependTo(outerGfx, childrenGfx, childrenGfx.childNodes[parentIndex]);\r\n  } else {\r\n    svgAppend(childrenGfx, outerGfx);\r\n  }\r\n\r\n  var gfx = svgCreate('g');\r\n  svgClasses(gfx).add('djs-element');\r\n  svgClasses(gfx).add('djs-' + type);\r\n\r\n  if (isFrame) {\r\n    svgClasses(gfx).add('djs-frame');\r\n  }\r\n\r\n  svgAppend(outerGfx, gfx);\r\n\r\n  // create visual\r\n  var visual = svgCreate('g');\r\n  svgClasses(visual).add('djs-visual');\r\n\r\n  svgAppend(gfx, visual);\r\n\r\n  return gfx;\r\n};\r\n\r\n/**\r\n * Create a graphical element.\r\n *\r\n * @param { 'shape' | 'connection' | 'label' | 'root' } type The type of the element.\r\n * @param {ElementLike} element The element.\r\n * @param {number} [parentIndex] The index at which to add the graphical element to its parent's children.\r\n *\r\n * @return {SVGElement} The graphical element.\r\n */\r\nGraphicsFactory.prototype.create = function(type, element, parentIndex) {\r\n  var childrenGfx = this._getChildrenContainer(element.parent);\r\n  return this._createContainer(type, childrenGfx, parentIndex, isFrameElement(element));\r\n};\r\n\r\n/**\r\n * Update the containments of the given elements.\r\n *\r\n * @param {ElementLike[]} elements The elements.\r\n */\r\nGraphicsFactory.prototype.updateContainments = function(elements) {\r\n\r\n  var self = this,\r\n      elementRegistry = this._elementRegistry,\r\n      parents;\r\n\r\n  parents = reduce(elements, function(map, e) {\r\n\r\n    if (e.parent) {\r\n      map[e.parent.id] = e.parent;\r\n    }\r\n\r\n    return map;\r\n  }, {});\r\n\r\n  // update all parents of changed and reorganized their children\r\n  // in the correct order (as indicated in our model)\r\n  forEach(parents, function(parent) {\r\n\r\n    var children = parent.children;\r\n\r\n    if (!children) {\r\n      return;\r\n    }\r\n\r\n    var childrenGfx = self._getChildrenContainer(parent);\r\n\r\n    forEach(children.slice().reverse(), function(child) {\r\n      var childGfx = elementRegistry.getGraphics(child);\r\n\r\n      prependTo(childGfx.parentNode, childrenGfx);\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * Draw a shape.\r\n *\r\n * @param {SVGElement} visual The graphical element.\r\n * @param {ShapeLike} element The shape.\r\n * @param {Object} attrs Optional attributes.\r\n *\r\n * @return {SVGElement}\r\n */\r\nGraphicsFactory.prototype.drawShape = function(visual, element, attrs = {}) {\r\n  var eventBus = this._eventBus;\r\n\r\n  return eventBus.fire('render.shape', { gfx: visual, element, attrs });\r\n};\r\n\r\n/**\r\n * Get the path of a shape.\r\n *\r\n * @param {ShapeLike} element The shape.\r\n *\r\n * @return {string} The path of the shape.\r\n */\r\nGraphicsFactory.prototype.getShapePath = function(element) {\r\n  var eventBus = this._eventBus;\r\n\r\n  return eventBus.fire('render.getShapePath', element);\r\n};\r\n\r\n/**\r\n * Draw a connection.\r\n *\r\n * @param {SVGElement} visual The graphical element.\r\n * @param {ConnectionLike} element The connection.\r\n * @param {Object} attrs Optional attributes.\r\n *\r\n * @return {SVGElement}\r\n */\r\nGraphicsFactory.prototype.drawConnection = function(visual, element, attrs = {}) {\r\n  var eventBus = this._eventBus;\r\n\r\n  return eventBus.fire('render.connection', { gfx: visual, element, attrs });\r\n};\r\n\r\n/**\r\n * Get the path of a connection.\r\n *\r\n * @param {ConnectionLike} connection The connection.\r\n *\r\n * @return {string} The path of the connection.\r\n */\r\nGraphicsFactory.prototype.getConnectionPath = function(connection) {\r\n  var eventBus = this._eventBus;\r\n\r\n  return eventBus.fire('render.getConnectionPath', connection);\r\n};\r\n\r\n/**\r\n * Update an elements graphical representation.\r\n *\r\n * @param {'shape'|'connection'} type\r\n * @param {ElementLike} element\r\n * @param {SVGElement} gfx\r\n */\r\nGraphicsFactory.prototype.update = function(type, element, gfx) {\r\n\r\n  // do NOT update root element\r\n  if (!element.parent) {\r\n    return;\r\n  }\r\n\r\n  var visual = this._clear(gfx);\r\n\r\n  // redraw\r\n  if (type === 'shape') {\r\n    this.drawShape(visual, element);\r\n\r\n    // update positioning\r\n    translate(gfx, element.x, element.y);\r\n  } else if (type === 'connection') {\r\n    this.drawConnection(visual, element);\r\n  } else {\r\n    throw new Error('unknown type: ' + type);\r\n  }\r\n\r\n  if (element.hidden) {\r\n    svgAttr(gfx, 'display', 'none');\r\n  } else {\r\n    svgAttr(gfx, 'display', 'block');\r\n  }\r\n};\r\n\r\n/**\r\n * Remove a graphical element.\r\n *\r\n * @param {ElementLike} element The element.\r\n */\r\nGraphicsFactory.prototype.remove = function(element) {\r\n  var gfx = this._elementRegistry.getGraphics(element);\r\n\r\n  // remove\r\n  svgRemove(gfx.parentNode);\r\n};\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction prependTo(newNode, parentNode, siblingNode) {\r\n  var node = siblingNode || parentNode.firstChild;\r\n\r\n  // do not prepend node to itself to prevent IE from crashing\r\n  // https://github.com/bpmn-io/bpmn-js/issues/746\r\n  if (newNode === node) {\r\n    return;\r\n  }\r\n\r\n  parentNode.insertBefore(newNode, node);\r\n}\r\n","import DrawModule from '../draw';\r\n\r\nimport Canvas from './Canvas';\r\nimport ElementRegistry from './ElementRegistry';\r\nimport ElementFactory from './ElementFactory';\r\nimport EventBus from './EventBus';\r\nimport GraphicsFactory from './GraphicsFactory';\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [ DrawModule ],\r\n  __init__: [ 'canvas' ],\r\n  canvas: [ 'type', Canvas ],\r\n  elementRegistry: [ 'type', ElementRegistry ],\r\n  elementFactory: [ 'type', ElementFactory ],\r\n  eventBus: [ 'type', EventBus ],\r\n  graphicsFactory: [ 'type', GraphicsFactory ]\r\n};","import { Injector } from 'didi';\r\n\r\nimport CoreModule from './core';\r\n\r\n/**\r\n * @typedef {import('didi').InjectionContext} InjectionContext\r\n * @typedef {import('didi').LocalsMap} LocalsMap\r\n * @typedef {import('didi').ModuleDeclaration} ModuleDeclaration\r\n *\r\n * @typedef { {\r\n *   modules?: ModuleDeclaration[];\r\n * } & Record<string, any> } DiagramOptions\r\n */\r\n\r\n/**\r\n * @template T\r\n * @typedef {import('didi').FactoryFunction<T>} FactoryFunction\r\n */\r\n\r\n/**\r\n * @template T\r\n * @typedef {import('didi').ArrayFunc<T>} ArrayFunc\r\n */\r\n\r\n/**\r\n * Bootstrap an injector from a list of modules, instantiating a number of default components\r\n *\r\n * @param {ModuleDeclaration[]} modules\r\n *\r\n * @return {Injector} a injector to use to access the components\r\n */\r\nfunction bootstrap(modules) {\r\n  var injector = new Injector(modules);\r\n\r\n  injector.init();\r\n\r\n  return injector;\r\n}\r\n\r\n/**\r\n * Creates an injector from passed options.\r\n *\r\n * @template ServiceMap\r\n * @param {DiagramOptions} [options]\r\n *\r\n * @return {Injector<ServiceMap>}\r\n */\r\nfunction createInjector(options) {\r\n\r\n  options = options || {};\r\n\r\n  /**\r\n   * @type { ModuleDeclaration }\r\n   */\r\n  var configModule = {\r\n    'config': [ 'value', options ]\r\n  };\r\n\r\n  var modules = [ configModule, CoreModule ].concat(options.modules || []);\r\n\r\n  return bootstrap(modules);\r\n}\r\n\r\n\r\n/**\r\n * The main diagram-js entry point that bootstraps the diagram with the given\r\n * configuration.\r\n *\r\n * To register extensions with the diagram, pass them as Array<Module> to the constructor.\r\n *\r\n * @class\r\n * @constructor\r\n * @template [ServiceMap=null]\r\n *\r\n * @example Creating a plug-in that logs whenever a shape is added to the canvas.\r\n *\r\n * ```javascript\r\n * // plug-in implementation\r\n * function MyLoggingPlugin(eventBus) {\r\n *   eventBus.on('shape.added', function(event) {\r\n *     console.log('shape ', event.shape, ' was added to the diagram');\r\n *   });\r\n * }\r\n *\r\n * // export as module\r\n * export default {\r\n *   __init__: [ 'myLoggingPlugin' ],\r\n *     myLoggingPlugin: [ 'type', MyLoggingPlugin ]\r\n * };\r\n * ```\r\n *\r\n * Use the plug-in in a Diagram instance:\r\n *\r\n * ```javascript\r\n * import MyLoggingModule from 'path-to-my-logging-plugin';\r\n *\r\n * var diagram = new Diagram({\r\n *   modules: [\r\n *     MyLoggingModule\r\n *   ]\r\n * });\r\n *\r\n * diagram.invoke([ 'canvas', function(canvas) {\r\n *   // add shape to drawing canvas\r\n *   canvas.addShape({ x: 10, y: 10 });\r\n * });\r\n *\r\n * // 'shape ... was added to the diagram' logged to console\r\n * ```\r\n *\r\n * @param {DiagramOptions} [options]\r\n * @param {Injector<ServiceMap>} [injector] An (optional) injector to bootstrap the diagram with.\r\n */\r\nexport default function Diagram(options, injector) {\r\n\r\n  /**\r\n   * @type {Injector<ServiceMap>}\r\n   */\r\n  this._injector = injector || createInjector(options);\r\n\r\n  // init\r\n\r\n  /**\r\n   * An event indicating that all plug-ins are loaded.\r\n   *\r\n   * Use this event to fire other events to interested plug-ins\r\n   *\r\n   * @memberOf Diagram\r\n   *\r\n   * @event diagram.init\r\n   *\r\n   * @example\r\n   *\r\n   * ```javascript\r\n   * eventBus.on('diagram.init', function() {\r\n   *   eventBus.fire('my-custom-event', { foo: 'BAR' });\r\n   * });\r\n   * ```\r\n   *\r\n   * @type {Object}\r\n   */\r\n  this.get('eventBus').fire('diagram.init');\r\n}\r\n\r\n/**\r\n * @overlord\r\n *\r\n * Resolves a diagram service.\r\n *\r\n * @template T\r\n *\r\n * @param {string} name The name of the service to get.\r\n *\r\n * @return {T}\r\n */\r\n/**\r\n * @overlord\r\n *\r\n * Resolves a diagram service.\r\n *\r\n * @template T\r\n *\r\n * @param {string} name The name of the service to get.\r\n * @param {true} strict If false, resolve missing services to null.\r\n *\r\n * @return {T}\r\n */\r\n/**\r\n * @overlord\r\n *\r\n * Resolves a diagram service.\r\n *\r\n * @template T\r\n *\r\n * @param {string} name The name of the service to get.\r\n * @param {boolean} strict If false, resolve missing services to null.\r\n *\r\n * @return {T|null}\r\n */\r\n/**\r\n * Resolves a diagram service.\r\n *\r\n * @template {keyof ServiceMap} Name\r\n *\r\n * @param {Name} name The name of the service to get.\r\n *\r\n * @return {ServiceMap[Name]}\r\n */\r\nDiagram.prototype.get = function(name, strict) {\r\n  return this._injector.get(name, strict);\r\n};\r\n\r\n/**\r\n * @overlord\r\n *\r\n * Invoke the given function, injecting dependencies. Return the result.\r\n *\r\n * @template T\r\n *\r\n * @param {FactoryFunction<T>} func\r\n * @param {InjectionContext} [context]\r\n * @param {LocalsMap} [locals]\r\n *\r\n * @return {T}\r\n */\r\n/**\r\n * Invoke the given function, injecting dependencies provided in\r\n * array notation. Return the result.\r\n *\r\n * @template T\r\n *\r\n * @param {ArrayFunc<T>} func function to be invoked\r\n * @param {InjectionContext} [context] context of the invocation\r\n * @param {LocalsMap} [locals] locals provided\r\n *\r\n * @return {T}\r\n */\r\nDiagram.prototype.invoke = function(func, context, locals) {\r\n  return this._injector.invoke(func, context, locals);\r\n};\r\n\r\n/**\r\n * Destroys the diagram\r\n */\r\nDiagram.prototype.destroy = function() {\r\n  this.get('eventBus').fire('diagram.destroy');\r\n};\r\n\r\n/**\r\n * Clear the diagram, removing all contents.\r\n */\r\nDiagram.prototype.clear = function() {\r\n  this.get('eventBus').fire('diagram.clear');\r\n};\r\n","import { forEach, bind, pick, assign, isString, isObject, set } from 'min-dash';\n\n/**\n * Moddle base element.\n */\nfunction Base() { }\n\nBase.prototype.get = function(name) {\n  return this.$model.properties.get(this, name);\n};\n\nBase.prototype.set = function(name, value) {\n  this.$model.properties.set(this, name, value);\n};\n\n/**\n * A model element factory.\n *\n * @param {Moddle} model\n * @param {Properties} properties\n */\nfunction Factory(model, properties) {\n  this.model = model;\n  this.properties = properties;\n}\n\n\nFactory.prototype.createType = function(descriptor) {\n\n  var model = this.model;\n\n  var props = this.properties,\n      prototype = Object.create(Base.prototype);\n\n  // initialize default values\n  forEach(descriptor.properties, function(p) {\n    if (!p.isMany && p.default !== undefined) {\n      prototype[p.name] = p.default;\n    }\n  });\n\n  props.defineModel(prototype, model);\n  props.defineDescriptor(prototype, descriptor);\n\n  var name = descriptor.ns.name;\n\n  /**\n   * The new type constructor\n   */\n  function ModdleElement(attrs) {\n    props.define(this, '$type', { value: name, enumerable: true });\n    props.define(this, '$attrs', { value: {} });\n    props.define(this, '$parent', { writable: true });\n\n    forEach(attrs, bind(function(val, key) {\n      this.set(key, val);\n    }, this));\n  }\n\n  ModdleElement.prototype = prototype;\n\n  ModdleElement.hasType = prototype.$instanceOf = this.model.hasType;\n\n  // static links\n  props.defineModel(ModdleElement, model);\n  props.defineDescriptor(ModdleElement, descriptor);\n\n  return ModdleElement;\n};\n\n/**\n * Built-in moddle types\n */\nvar BUILTINS = {\n  String: true,\n  Boolean: true,\n  Integer: true,\n  Real: true,\n  Element: true\n};\n\n/**\n * Converters for built in types from string representations\n */\nvar TYPE_CONVERTERS = {\n  String: function(s) { return s; },\n  Boolean: function(s) { return s === 'true'; },\n  Integer: function(s) { return parseInt(s, 10); },\n  Real: function(s) { return parseFloat(s); }\n};\n\n/**\n * Convert a type to its real representation\n */\nfunction coerceType(type, value) {\n\n  var converter = TYPE_CONVERTERS[type];\n\n  if (converter) {\n    return converter(value);\n  } else {\n    return value;\n  }\n}\n\n/**\n * Return whether the given type is built-in\n */\nfunction isBuiltIn(type) {\n  return !!BUILTINS[type];\n}\n\n/**\n * Return whether the given type is simple\n */\nfunction isSimple(type) {\n  return !!TYPE_CONVERTERS[type];\n}\n\n/**\n * Parses a namespaced attribute name of the form (ns:)localName to an object,\n * given a default prefix to assume in case no explicit namespace is given.\n *\n * @param {String} name\n * @param {String} [defaultPrefix] the default prefix to take, if none is present.\n *\n * @return {Object} the parsed name\n */\nfunction parseName(name, defaultPrefix) {\n  var parts = name.split(/:/),\n      localName, prefix;\n\n  // no prefix (i.e. only local name)\n  if (parts.length === 1) {\n    localName = name;\n    prefix = defaultPrefix;\n  } else\n\n  // prefix + local name\n  if (parts.length === 2) {\n    localName = parts[1];\n    prefix = parts[0];\n  } else {\n    throw new Error('expected <prefix:localName> or <localName>, got ' + name);\n  }\n\n  name = (prefix ? prefix + ':' : '') + localName;\n\n  return {\n    name: name,\n    prefix: prefix,\n    localName: localName\n  };\n}\n\n/**\n * A utility to build element descriptors.\n */\nfunction DescriptorBuilder(nameNs) {\n  this.ns = nameNs;\n  this.name = nameNs.name;\n  this.allTypes = [];\n  this.allTypesByName = {};\n  this.properties = [];\n  this.propertiesByName = {};\n}\n\n\nDescriptorBuilder.prototype.build = function() {\n  return pick(this, [\n    'ns',\n    'name',\n    'allTypes',\n    'allTypesByName',\n    'properties',\n    'propertiesByName',\n    'bodyProperty',\n    'idProperty'\n  ]);\n};\n\n/**\n * Add property at given index.\n *\n * @param {Object} p\n * @param {Number} [idx]\n * @param {Boolean} [validate=true]\n */\nDescriptorBuilder.prototype.addProperty = function(p, idx, validate) {\n\n  if (typeof idx === 'boolean') {\n    validate = idx;\n    idx = undefined;\n  }\n\n  this.addNamedProperty(p, validate !== false);\n\n  var properties = this.properties;\n\n  if (idx !== undefined) {\n    properties.splice(idx, 0, p);\n  } else {\n    properties.push(p);\n  }\n};\n\n\nDescriptorBuilder.prototype.replaceProperty = function(oldProperty, newProperty, replace) {\n  var oldNameNs = oldProperty.ns;\n\n  var props = this.properties,\n      propertiesByName = this.propertiesByName,\n      rename = oldProperty.name !== newProperty.name;\n\n  if (oldProperty.isId) {\n    if (!newProperty.isId) {\n      throw new Error(\n        'property <' + newProperty.ns.name + '> must be id property ' +\n        'to refine <' + oldProperty.ns.name + '>');\n    }\n\n    this.setIdProperty(newProperty, false);\n  }\n\n  if (oldProperty.isBody) {\n\n    if (!newProperty.isBody) {\n      throw new Error(\n        'property <' + newProperty.ns.name + '> must be body property ' +\n        'to refine <' + oldProperty.ns.name + '>');\n    }\n\n    // TODO: Check compatibility\n    this.setBodyProperty(newProperty, false);\n  }\n\n  // validate existence and get location of old property\n  var idx = props.indexOf(oldProperty);\n  if (idx === -1) {\n    throw new Error('property <' + oldNameNs.name + '> not found in property list');\n  }\n\n  // remove old property\n  props.splice(idx, 1);\n\n  // replacing the named property is intentional\n  //\n  //  * validate only if this is a \"rename\" operation\n  //  * add at specific index unless we \"replace\"\n  //\n  this.addProperty(newProperty, replace ? undefined : idx, rename);\n\n  // make new property available under old name\n  propertiesByName[oldNameNs.name] = propertiesByName[oldNameNs.localName] = newProperty;\n};\n\n\nDescriptorBuilder.prototype.redefineProperty = function(p, targetPropertyName, replace) {\n\n  var nsPrefix = p.ns.prefix;\n  var parts = targetPropertyName.split('#');\n\n  var name = parseName(parts[0], nsPrefix);\n  var attrName = parseName(parts[1], name.prefix).name;\n\n  var redefinedProperty = this.propertiesByName[attrName];\n  if (!redefinedProperty) {\n    throw new Error('refined property <' + attrName + '> not found');\n  } else {\n    this.replaceProperty(redefinedProperty, p, replace);\n  }\n\n  delete p.redefines;\n};\n\nDescriptorBuilder.prototype.addNamedProperty = function(p, validate) {\n  var ns = p.ns,\n      propsByName = this.propertiesByName;\n\n  if (validate) {\n    this.assertNotDefined(p, ns.name);\n    this.assertNotDefined(p, ns.localName);\n  }\n\n  propsByName[ns.name] = propsByName[ns.localName] = p;\n};\n\nDescriptorBuilder.prototype.removeNamedProperty = function(p) {\n  var ns = p.ns,\n      propsByName = this.propertiesByName;\n\n  delete propsByName[ns.name];\n  delete propsByName[ns.localName];\n};\n\nDescriptorBuilder.prototype.setBodyProperty = function(p, validate) {\n\n  if (validate && this.bodyProperty) {\n    throw new Error(\n      'body property defined multiple times ' +\n      '(<' + this.bodyProperty.ns.name + '>, <' + p.ns.name + '>)');\n  }\n\n  this.bodyProperty = p;\n};\n\nDescriptorBuilder.prototype.setIdProperty = function(p, validate) {\n\n  if (validate && this.idProperty) {\n    throw new Error(\n      'id property defined multiple times ' +\n      '(<' + this.idProperty.ns.name + '>, <' + p.ns.name + '>)');\n  }\n\n  this.idProperty = p;\n};\n\nDescriptorBuilder.prototype.assertNotTrait = function(typeDescriptor) {\n\n  const _extends = typeDescriptor.extends || [];\n\n  if (_extends.length) {\n    throw new Error(\n      `cannot create <${ typeDescriptor.name }> extending <${ typeDescriptor.extends }>`\n    );\n  }\n};\n\nDescriptorBuilder.prototype.assertNotDefined = function(p, name) {\n  var propertyName = p.name,\n      definedProperty = this.propertiesByName[propertyName];\n\n  if (definedProperty) {\n    throw new Error(\n      'property <' + propertyName + '> already defined; ' +\n      'override of <' + definedProperty.definedBy.ns.name + '#' + definedProperty.ns.name + '> by ' +\n      '<' + p.definedBy.ns.name + '#' + p.ns.name + '> not allowed without redefines');\n  }\n};\n\nDescriptorBuilder.prototype.hasProperty = function(name) {\n  return this.propertiesByName[name];\n};\n\nDescriptorBuilder.prototype.addTrait = function(t, inherited) {\n\n  if (inherited) {\n    this.assertNotTrait(t);\n  }\n\n  var typesByName = this.allTypesByName,\n      types = this.allTypes;\n\n  var typeName = t.name;\n\n  if (typeName in typesByName) {\n    return;\n  }\n\n  forEach(t.properties, bind(function(p) {\n\n    // clone property to allow extensions\n    p = assign({}, p, {\n      name: p.ns.localName,\n      inherited: inherited\n    });\n\n    Object.defineProperty(p, 'definedBy', {\n      value: t\n    });\n\n    var replaces = p.replaces,\n        redefines = p.redefines;\n\n    // add replace/redefine support\n    if (replaces || redefines) {\n      this.redefineProperty(p, replaces || redefines, replaces);\n    } else {\n      if (p.isBody) {\n        this.setBodyProperty(p);\n      }\n      if (p.isId) {\n        this.setIdProperty(p);\n      }\n      this.addProperty(p);\n    }\n  }, this));\n\n  types.push(t);\n  typesByName[typeName] = t;\n};\n\n/**\n * A registry of Moddle packages.\n *\n * @param {Array<Package>} packages\n * @param {Properties} properties\n */\nfunction Registry(packages, properties) {\n  this.packageMap = {};\n  this.typeMap = {};\n\n  this.packages = [];\n\n  this.properties = properties;\n\n  forEach(packages, bind(this.registerPackage, this));\n}\n\n\nRegistry.prototype.getPackage = function(uriOrPrefix) {\n  return this.packageMap[uriOrPrefix];\n};\n\nRegistry.prototype.getPackages = function() {\n  return this.packages;\n};\n\n\nRegistry.prototype.registerPackage = function(pkg) {\n\n  // copy package\n  pkg = assign({}, pkg);\n\n  var pkgMap = this.packageMap;\n\n  ensureAvailable(pkgMap, pkg, 'prefix');\n  ensureAvailable(pkgMap, pkg, 'uri');\n\n  // register types\n  forEach(pkg.types, bind(function(descriptor) {\n    this.registerType(descriptor, pkg);\n  }, this));\n\n  pkgMap[pkg.uri] = pkgMap[pkg.prefix] = pkg;\n  this.packages.push(pkg);\n};\n\n\n/**\n * Register a type from a specific package with us\n */\nRegistry.prototype.registerType = function(type, pkg) {\n\n  type = assign({}, type, {\n    superClass: (type.superClass || []).slice(),\n    extends: (type.extends || []).slice(),\n    properties: (type.properties || []).slice(),\n    meta: assign((type.meta || {}))\n  });\n\n  var ns = parseName(type.name, pkg.prefix),\n      name = ns.name,\n      propertiesByName = {};\n\n  // parse properties\n  forEach(type.properties, bind(function(p) {\n\n    // namespace property names\n    var propertyNs = parseName(p.name, ns.prefix),\n        propertyName = propertyNs.name;\n\n    // namespace property types\n    if (!isBuiltIn(p.type)) {\n      p.type = parseName(p.type, propertyNs.prefix).name;\n    }\n\n    assign(p, {\n      ns: propertyNs,\n      name: propertyName\n    });\n\n    propertiesByName[propertyName] = p;\n  }, this));\n\n  // update ns + name\n  assign(type, {\n    ns: ns,\n    name: name,\n    propertiesByName: propertiesByName\n  });\n\n  forEach(type.extends, bind(function(extendsName) {\n    var extendsNameNs = parseName(extendsName, ns.prefix);\n\n    var extended = this.typeMap[extendsNameNs.name];\n\n    extended.traits = extended.traits || [];\n    extended.traits.push(name);\n  }, this));\n\n  // link to package\n  this.definePackage(type, pkg);\n\n  // register\n  this.typeMap[name] = type;\n};\n\n\n/**\n * Traverse the type hierarchy from bottom to top,\n * calling iterator with (type, inherited) for all elements in\n * the inheritance chain.\n *\n * @param {Object} nsName\n * @param {Function} iterator\n * @param {Boolean} [trait=false]\n */\nRegistry.prototype.mapTypes = function(nsName, iterator, trait) {\n\n  var type = isBuiltIn(nsName.name) ? { name: nsName.name } : this.typeMap[nsName.name];\n\n  var self = this;\n\n  /**\n   * Traverse the selected super type or trait\n   *\n   * @param {String} cls\n   * @param {Boolean} [trait=false]\n   */\n  function traverse(cls, trait) {\n    var parentNs = parseName(cls, isBuiltIn(cls) ? '' : nsName.prefix);\n    self.mapTypes(parentNs, iterator, trait);\n  }\n\n  /**\n   * Traverse the selected trait.\n   *\n   * @param {String} cls\n   */\n  function traverseTrait(cls) {\n    return traverse(cls, true);\n  }\n\n  /**\n   * Traverse the selected super type\n   *\n   * @param {String} cls\n   */\n  function traverseSuper(cls) {\n    return traverse(cls, false);\n  }\n\n  if (!type) {\n    throw new Error('unknown type <' + nsName.name + '>');\n  }\n\n  forEach(type.superClass, trait ? traverseTrait : traverseSuper);\n\n  // call iterator with (type, inherited=!trait)\n  iterator(type, !trait);\n\n  forEach(type.traits, traverseTrait);\n};\n\n\n/**\n * Returns the effective descriptor for a type.\n *\n * @param  {String} type the namespaced name (ns:localName) of the type\n *\n * @return {Descriptor} the resulting effective descriptor\n */\nRegistry.prototype.getEffectiveDescriptor = function(name) {\n\n  var nsName = parseName(name);\n\n  var builder = new DescriptorBuilder(nsName);\n\n  this.mapTypes(nsName, function(type, inherited) {\n    builder.addTrait(type, inherited);\n  });\n\n  var descriptor = builder.build();\n\n  // define package link\n  this.definePackage(descriptor, descriptor.allTypes[descriptor.allTypes.length - 1].$pkg);\n\n  return descriptor;\n};\n\n\nRegistry.prototype.definePackage = function(target, pkg) {\n  this.properties.define(target, '$pkg', { value: pkg });\n};\n\n\n\n// helpers ////////////////////////////\n\nfunction ensureAvailable(packageMap, pkg, identifierKey) {\n\n  var value = pkg[identifierKey];\n\n  if (value in packageMap) {\n    throw new Error('package with ' + identifierKey + ' <' + value + '> already defined');\n  }\n}\n\n/**\n * A utility that gets and sets properties of model elements.\n *\n * @param {Model} model\n */\nfunction Properties(model) {\n  this.model = model;\n}\n\n\n/**\n * Sets a named property on the target element.\n * If the value is undefined, the property gets deleted.\n *\n * @param {Object} target\n * @param {String} name\n * @param {Object} value\n */\nProperties.prototype.set = function(target, name, value) {\n\n  if (!isString(name) || !name.length) {\n    throw new TypeError('property name must be a non-empty string');\n  }\n\n  var property = this.getProperty(target, name);\n\n  var propertyName = property && property.name;\n\n  if (isUndefined(value)) {\n\n    // unset the property, if the specified value is undefined;\n    // delete from $attrs (for extensions) or the target itself\n    if (property) {\n      delete target[propertyName];\n    } else {\n      delete target.$attrs[stripGlobal(name)];\n    }\n  } else {\n\n    // set the property, defining well defined properties on the fly\n    // or simply updating them in target.$attrs (for extensions)\n    if (property) {\n      if (propertyName in target) {\n        target[propertyName] = value;\n      } else {\n        defineProperty(target, property, value);\n      }\n    } else {\n      target.$attrs[stripGlobal(name)] = value;\n    }\n  }\n};\n\n/**\n * Returns the named property of the given element\n *\n * @param  {Object} target\n * @param  {String} name\n *\n * @return {Object}\n */\nProperties.prototype.get = function(target, name) {\n\n  var property = this.getProperty(target, name);\n\n  if (!property) {\n    return target.$attrs[stripGlobal(name)];\n  }\n\n  var propertyName = property.name;\n\n  // check if access to collection property and lazily initialize it\n  if (!target[propertyName] && property.isMany) {\n    defineProperty(target, property, []);\n  }\n\n  return target[propertyName];\n};\n\n\n/**\n * Define a property on the target element\n *\n * @param  {Object} target\n * @param  {String} name\n * @param  {Object} options\n */\nProperties.prototype.define = function(target, name, options) {\n\n  if (!options.writable) {\n\n    var value = options.value;\n\n    // use getters for read-only variables to support ES6 proxies\n    // cf. https://github.com/bpmn-io/internal-docs/issues/386\n    options = assign({}, options, {\n      get: function() { return value; }\n    });\n\n    delete options.value;\n  }\n\n  Object.defineProperty(target, name, options);\n};\n\n\n/**\n * Define the descriptor for an element\n */\nProperties.prototype.defineDescriptor = function(target, descriptor) {\n  this.define(target, '$descriptor', { value: descriptor });\n};\n\n/**\n * Define the model for an element\n */\nProperties.prototype.defineModel = function(target, model) {\n  this.define(target, '$model', { value: model });\n};\n\n/**\n * Return property with the given name on the element.\n *\n * @param {any} target\n * @param {string} name\n *\n * @return {object | null} property\n */\nProperties.prototype.getProperty = function(target, name) {\n\n  var model = this.model;\n\n  var property = model.getPropertyDescriptor(target, name);\n\n  if (property) {\n    return property;\n  }\n\n  if (name.includes(':')) {\n    return null;\n  }\n\n  const strict = model.config.strict;\n\n  if (typeof strict !== 'undefined') {\n    const error = new TypeError(`unknown property <${ name }> on <${ target.$type }>`);\n\n    if (strict) {\n      throw error;\n    } else {\n\n      // eslint-disable-next-line no-undef\n      typeof console !== 'undefined' && console.warn(error);\n    }\n  }\n\n  return null;\n};\n\nfunction isUndefined(val) {\n  return typeof val === 'undefined';\n}\n\nfunction defineProperty(target, property, value) {\n  Object.defineProperty(target, property.name, {\n    enumerable: !property.isReference,\n    writable: true,\n    value: value,\n    configurable: true\n  });\n}\n\nfunction stripGlobal(name) {\n  return name.replace(/^:/, '');\n}\n\n// Moddle implementation /////////////////////////////////////////////////\n\n/**\n * @class Moddle\n *\n * A model that can be used to create elements of a specific type.\n *\n * @example\n *\n * var Moddle = require('moddle');\n *\n * var pkg = {\n *   name: 'mypackage',\n *   prefix: 'my',\n *   types: [\n *     { name: 'Root' }\n *   ]\n * };\n *\n * var moddle = new Moddle([pkg]);\n *\n * @param {Array<Package>} packages the packages to contain\n *\n * @param { { strict?: boolean } } [config] moddle configuration\n */\nfunction Moddle(packages, config = {}) {\n\n  this.properties = new Properties(this);\n\n  this.factory = new Factory(this, this.properties);\n  this.registry = new Registry(packages, this.properties);\n\n  this.typeCache = {};\n\n  this.config = config;\n}\n\n\n/**\n * Create an instance of the specified type.\n *\n * @method Moddle#create\n *\n * @example\n *\n * var foo = moddle.create('my:Foo');\n * var bar = moddle.create('my:Bar', { id: 'BAR_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @param  {Object} attrs   a number of attributes to initialize the model instance with\n * @return {Object}         model instance\n */\nModdle.prototype.create = function(descriptor, attrs) {\n  var Type = this.getType(descriptor);\n\n  if (!Type) {\n    throw new Error('unknown type <' + descriptor + '>');\n  }\n\n  return new Type(attrs);\n};\n\n\n/**\n * Returns the type representing a given descriptor\n *\n * @method Moddle#getType\n *\n * @example\n *\n * var Foo = moddle.getType('my:Foo');\n * var foo = new Foo({ 'id' : 'FOO_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @return {Object}         the type representing the descriptor\n */\nModdle.prototype.getType = function(descriptor) {\n\n  var cache = this.typeCache;\n\n  var name = isString(descriptor) ? descriptor : descriptor.ns.name;\n\n  var type = cache[name];\n\n  if (!type) {\n    descriptor = this.registry.getEffectiveDescriptor(name);\n    type = cache[name] = this.factory.createType(descriptor);\n  }\n\n  return type;\n};\n\n\n/**\n * Creates an any-element type to be used within model instances.\n *\n * This can be used to create custom elements that lie outside the meta-model.\n * The created element contains all the meta-data required to serialize it\n * as part of meta-model elements.\n *\n * @method Moddle#createAny\n *\n * @example\n *\n * var foo = moddle.createAny('vendor:Foo', 'http://vendor', {\n *   value: 'bar'\n * });\n *\n * var container = moddle.create('my:Container', 'http://my', {\n *   any: [ foo ]\n * });\n *\n * // go ahead and serialize the stuff\n *\n *\n * @param  {String} name  the name of the element\n * @param  {String} nsUri the namespace uri of the element\n * @param  {Object} [properties] a map of properties to initialize the instance with\n * @return {Object} the any type instance\n */\nModdle.prototype.createAny = function(name, nsUri, properties) {\n\n  var nameNs = parseName(name);\n\n  var element = {\n    $type: name,\n    $instanceOf: function(type) {\n      return type === this.$type;\n    },\n    get: function(key) {\n      return this[key];\n    },\n    set: function(key, value) {\n      set(this, [ key ], value);\n    }\n  };\n\n  var descriptor = {\n    name: name,\n    isGeneric: true,\n    ns: {\n      prefix: nameNs.prefix,\n      localName: nameNs.localName,\n      uri: nsUri\n    }\n  };\n\n  this.properties.defineDescriptor(element, descriptor);\n  this.properties.defineModel(element, this);\n  this.properties.define(element, 'get', { enumerable: false, writable: true });\n  this.properties.define(element, 'set', { enumerable: false, writable: true });\n  this.properties.define(element, '$parent', { enumerable: false, writable: true });\n  this.properties.define(element, '$instanceOf', { enumerable: false, writable: true });\n\n  forEach(properties, function(a, key) {\n    if (isObject(a) && a.value !== undefined) {\n      element[a.name] = a.value;\n    } else {\n      element[key] = a;\n    }\n  });\n\n  return element;\n};\n\n/**\n * Returns a registered package by uri or prefix\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackage = function(uriOrPrefix) {\n  return this.registry.getPackage(uriOrPrefix);\n};\n\n/**\n * Returns a snapshot of all known packages\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackages = function() {\n  return this.registry.getPackages();\n};\n\n/**\n * Returns the descriptor for an element\n */\nModdle.prototype.getElementDescriptor = function(element) {\n  return element.$descriptor;\n};\n\n/**\n * Returns true if the given descriptor or instance\n * represents the given type.\n *\n * May be applied to this, if element is omitted.\n */\nModdle.prototype.hasType = function(element, type) {\n  if (type === undefined) {\n    type = element;\n    element = this;\n  }\n\n  var descriptor = element.$model.getElementDescriptor(element);\n\n  return (type in descriptor.allTypesByName);\n};\n\n/**\n * Returns the descriptor of an elements named property\n */\nModdle.prototype.getPropertyDescriptor = function(element, property) {\n  return this.getElementDescriptor(element).propertiesByName[property];\n};\n\n/**\n * Returns a mapped type's descriptor\n */\nModdle.prototype.getTypeDescriptor = function(type) {\n  return this.registry.typeMap[type];\n};\n\nexport { Moddle, coerceType, isBuiltIn as isBuiltInType, isSimple as isSimpleType, parseName as parseNameNS };\n//# sourceMappingURL=index.esm.js.map\n","var fromCharCode = String.fromCharCode;\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar ENTITY_PATTERN = /&#(\\d+);|&#x([0-9a-f]+);|&(\\w+);/ig;\n\nvar ENTITY_MAPPING = {\n  'amp': '&',\n  'apos': '\\'',\n  'gt': '>',\n  'lt': '<',\n  'quot': '\"'\n};\n\n// map UPPERCASE variants of supported special chars\nObject.keys(ENTITY_MAPPING).forEach(function(k) {\n  ENTITY_MAPPING[k.toUpperCase()] = ENTITY_MAPPING[k];\n});\n\n\nfunction replaceEntities(_, d, x, z) {\n\n  // reserved names, i.e. &nbsp;\n  if (z) {\n    if (hasOwnProperty.call(ENTITY_MAPPING, z)) {\n      return ENTITY_MAPPING[z];\n    } else {\n\n      // fall back to original value\n      return '&' + z + ';';\n    }\n  }\n\n  // decimal encoded char\n  if (d) {\n    return fromCharCode(d);\n  }\n\n  // hex encoded char\n  return fromCharCode(parseInt(x, 16));\n}\n\n\n/**\n * A basic entity decoder that can decode a minimal\n * sub-set of reserved names (&amp;) as well as\n * hex (&#xaaf;) and decimal (&#1231;) encoded characters.\n *\n * @param {string} str\n *\n * @return {string} decoded string\n */\nfunction decodeEntities(s) {\n  if (s.length > 3 && s.indexOf('&') !== -1) {\n    return s.replace(ENTITY_PATTERN, replaceEntities);\n  }\n\n  return s;\n}\n\nvar XSI_URI = 'http://www.w3.org/2001/XMLSchema-instance';\nvar XSI_PREFIX = 'xsi';\nvar XSI_TYPE = 'xsi:type';\n\nvar NON_WHITESPACE_OUTSIDE_ROOT_NODE = 'non-whitespace outside of root node';\n\nfunction error(msg) {\n  return new Error(msg);\n}\n\nfunction missingNamespaceForPrefix(prefix) {\n  return 'missing namespace for prefix <' + prefix + '>';\n}\n\nfunction getter(getFn) {\n  return {\n    'get': getFn,\n    'enumerable': true\n  };\n}\n\nfunction cloneNsMatrix(nsMatrix) {\n  var clone = {}, key;\n  for (key in nsMatrix) {\n    clone[key] = nsMatrix[key];\n  }\n  return clone;\n}\n\nfunction uriPrefix(prefix) {\n  return prefix + '$uri';\n}\n\nfunction buildNsMatrix(nsUriToPrefix) {\n  var nsMatrix = {},\n      uri,\n      prefix;\n\n  for (uri in nsUriToPrefix) {\n    prefix = nsUriToPrefix[uri];\n    nsMatrix[prefix] = prefix;\n    nsMatrix[uriPrefix(prefix)] = uri;\n  }\n\n  return nsMatrix;\n}\n\nfunction noopGetContext() {\n  return { 'line': 0, 'column': 0 };\n}\n\nfunction throwFunc(err) {\n  throw err;\n}\n\n/**\n * Creates a new parser with the given options.\n *\n * @constructor\n *\n * @param  {!Object<string, ?>=} options\n */\nfunction Parser(options) {\n\n  if (!this) {\n    return new Parser(options);\n  }\n\n  var proxy = options && options['proxy'];\n\n  var onText,\n      onOpenTag,\n      onCloseTag,\n      onCDATA,\n      onError = throwFunc,\n      onWarning,\n      onComment,\n      onQuestion,\n      onAttention;\n\n  var getContext = noopGetContext;\n\n  /**\n   * Do we need to parse the current elements attributes for namespaces?\n   *\n   * @type {boolean}\n   */\n  var maybeNS = false;\n\n  /**\n   * Do we process namespaces at all?\n   *\n   * @type {boolean}\n   */\n  var isNamespace = false;\n\n  /**\n   * The caught error returned on parse end\n   *\n   * @type {Error}\n   */\n  var returnError = null;\n\n  /**\n   * Should we stop parsing?\n   *\n   * @type {boolean}\n   */\n  var parseStop = false;\n\n  /**\n   * A map of { uri: prefix } used by the parser.\n   *\n   * This map will ensure we can normalize prefixes during processing;\n   * for each uri, only one prefix will be exposed to the handlers.\n   *\n   * @type {!Object<string, string>}}\n   */\n  var nsUriToPrefix;\n\n  /**\n   * Handle parse error.\n   *\n   * @param  {string|Error} err\n   */\n  function handleError(err) {\n    if (!(err instanceof Error)) {\n      err = error(err);\n    }\n\n    returnError = err;\n\n    onError(err, getContext);\n  }\n\n  /**\n   * Handle parse error.\n   *\n   * @param  {string|Error} err\n   */\n  function handleWarning(err) {\n\n    if (!onWarning) {\n      return;\n    }\n\n    if (!(err instanceof Error)) {\n      err = error(err);\n    }\n\n    onWarning(err, getContext);\n  }\n\n  /**\n   * Register parse listener.\n   *\n   * @param  {string}   name\n   * @param  {Function} cb\n   *\n   * @return {Parser}\n   */\n  this['on'] = function(name, cb) {\n\n    if (typeof cb !== 'function') {\n      throw error('required args <name, cb>');\n    }\n\n    switch (name) {\n    case 'openTag': onOpenTag = cb; break;\n    case 'text': onText = cb; break;\n    case 'closeTag': onCloseTag = cb; break;\n    case 'error': onError = cb; break;\n    case 'warn': onWarning = cb; break;\n    case 'cdata': onCDATA = cb; break;\n    case 'attention': onAttention = cb; break; // <!XXXXX zzzz=\"eeee\">\n    case 'question': onQuestion = cb; break; // <? ....  ?>\n    case 'comment': onComment = cb; break;\n    default:\n      throw error('unsupported event: ' + name);\n    }\n\n    return this;\n  };\n\n  /**\n   * Set the namespace to prefix mapping.\n   *\n   * @example\n   *\n   * parser.ns({\n   *   'http://foo': 'foo',\n   *   'http://bar': 'bar'\n   * });\n   *\n   * @param  {!Object<string, string>} nsMap\n   *\n   * @return {Parser}\n   */\n  this['ns'] = function(nsMap) {\n\n    if (typeof nsMap === 'undefined') {\n      nsMap = {};\n    }\n\n    if (typeof nsMap !== 'object') {\n      throw error('required args <nsMap={}>');\n    }\n\n    var _nsUriToPrefix = {}, k;\n\n    for (k in nsMap) {\n      _nsUriToPrefix[k] = nsMap[k];\n    }\n\n    // FORCE default mapping for schema instance\n    _nsUriToPrefix[XSI_URI] = XSI_PREFIX;\n\n    isNamespace = true;\n    nsUriToPrefix = _nsUriToPrefix;\n\n    return this;\n  };\n\n  /**\n   * Parse xml string.\n   *\n   * @param  {string} xml\n   *\n   * @return {Error} returnError, if not thrown\n   */\n  this['parse'] = function(xml) {\n    if (typeof xml !== 'string') {\n      throw error('required args <xml=string>');\n    }\n\n    returnError = null;\n\n    parse(xml);\n\n    getContext = noopGetContext;\n    parseStop = false;\n\n    return returnError;\n  };\n\n  /**\n   * Stop parsing.\n   */\n  this['stop'] = function() {\n    parseStop = true;\n  };\n\n  /**\n   * Parse string, invoking configured listeners on element.\n   *\n   * @param  {string} xml\n   */\n  function parse(xml) {\n    var nsMatrixStack = isNamespace ? [] : null,\n        nsMatrix = isNamespace ? buildNsMatrix(nsUriToPrefix) : null,\n        _nsMatrix,\n        nodeStack = [],\n        anonymousNsCount = 0,\n        tagStart = false,\n        tagEnd = false,\n        i = 0, j = 0,\n        x, y, q, w, v,\n        xmlns,\n        elementName,\n        _elementName,\n        elementProxy\n        ;\n\n    var attrsString = '',\n        attrsStart = 0,\n        cachedAttrs // false = parsed with errors, null = needs parsing\n        ;\n\n    /**\n     * Parse attributes on demand and returns the parsed attributes.\n     *\n     * Return semantics: (1) `false` on attribute parse error,\n     * (2) object hash on extracted attrs.\n     *\n     * @return {boolean|Object}\n     */\n    function getAttrs() {\n      if (cachedAttrs !== null) {\n        return cachedAttrs;\n      }\n\n      var nsUri,\n          nsUriPrefix,\n          nsName,\n          defaultAlias = isNamespace && nsMatrix['xmlns'],\n          attrList = isNamespace && maybeNS ? [] : null,\n          i = attrsStart,\n          s = attrsString,\n          l = s.length,\n          hasNewMatrix,\n          newalias,\n          value,\n          alias,\n          name,\n          attrs = {},\n          seenAttrs = {},\n          skipAttr,\n          w,\n          j;\n\n      parseAttr:\n      for (; i < l; i++) {\n        skipAttr = false;\n        w = s.charCodeAt(i);\n\n        if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE={ \\f\\n\\r\\t\\v}\n          continue;\n        }\n\n        // wait for non whitespace character\n        if (w < 65 || w > 122 || (w > 90 && w < 97)) {\n          if (w !== 95 && w !== 58) { // char 95\"_\" 58\":\"\n            handleWarning('illegal first char attribute name');\n            skipAttr = true;\n          }\n        }\n\n        // parse attribute name\n        for (j = i + 1; j < l; j++) {\n          w = s.charCodeAt(j);\n\n          if (\n            w > 96 && w < 123 ||\n            w > 64 && w < 91 ||\n            w > 47 && w < 59 ||\n            w === 46 || // '.'\n            w === 45 || // '-'\n            w === 95 // '_'\n          ) {\n            continue;\n          }\n\n          // unexpected whitespace\n          if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n            handleWarning('missing attribute value');\n            i = j;\n\n            continue parseAttr;\n          }\n\n          // expected \"=\"\n          if (w === 61) { // \"=\" == 61\n            break;\n          }\n\n          handleWarning('illegal attribute name char');\n          skipAttr = true;\n        }\n\n        name = s.substring(i, j);\n\n        if (name === 'xmlns:xmlns') {\n          handleWarning('illegal declaration of xmlns');\n          skipAttr = true;\n        }\n\n        w = s.charCodeAt(j + 1);\n\n        if (w === 34) { // '\"'\n          j = s.indexOf('\"', i = j + 2);\n\n          if (j === -1) {\n            j = s.indexOf('\\'', i);\n\n            if (j !== -1) {\n              handleWarning('attribute value quote missmatch');\n              skipAttr = true;\n            }\n          }\n\n        } else if (w === 39) { // \"'\"\n          j = s.indexOf('\\'', i = j + 2);\n\n          if (j === -1) {\n            j = s.indexOf('\"', i);\n\n            if (j !== -1) {\n              handleWarning('attribute value quote missmatch');\n              skipAttr = true;\n            }\n          }\n\n        } else {\n          handleWarning('missing attribute value quotes');\n          skipAttr = true;\n\n          // skip to next space\n          for (j = j + 1; j < l; j++) {\n            w = s.charCodeAt(j + 1);\n\n            if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n              break;\n            }\n          }\n\n        }\n\n        if (j === -1) {\n          handleWarning('missing closing quotes');\n\n          j = l;\n          skipAttr = true;\n        }\n\n        if (!skipAttr) {\n          value = s.substring(i, j);\n        }\n\n        i = j;\n\n        // ensure SPACE follows attribute\n        // skip illegal content otherwise\n        // example a=\"b\"c\n        for (; j + 1 < l; j++) {\n          w = s.charCodeAt(j + 1);\n\n          if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n            break;\n          }\n\n          // FIRST ILLEGAL CHAR\n          if (i === j) {\n            handleWarning('illegal character after attribute end');\n            skipAttr = true;\n          }\n        }\n\n        // advance cursor to next attribute\n        i = j + 1;\n\n        if (skipAttr) {\n          continue parseAttr;\n        }\n\n        // check attribute re-declaration\n        if (name in seenAttrs) {\n          handleWarning('attribute <' + name + '> already defined');\n          continue;\n        }\n\n        seenAttrs[name] = true;\n\n        if (!isNamespace) {\n          attrs[name] = value;\n          continue;\n        }\n\n        // try to extract namespace information\n        if (maybeNS) {\n          newalias = (\n            name === 'xmlns'\n              ? 'xmlns'\n              : (name.charCodeAt(0) === 120 && name.substr(0, 6) === 'xmlns:')\n                ? name.substr(6)\n                : null\n          );\n\n          // handle xmlns(:alias) assignment\n          if (newalias !== null) {\n            nsUri = decodeEntities(value);\n            nsUriPrefix = uriPrefix(newalias);\n\n            alias = nsUriToPrefix[nsUri];\n\n            if (!alias) {\n\n              // no prefix defined or prefix collision\n              if (\n                (newalias === 'xmlns') ||\n                (nsUriPrefix in nsMatrix && nsMatrix[nsUriPrefix] !== nsUri)\n              ) {\n\n                // alocate free ns prefix\n                do {\n                  alias = 'ns' + (anonymousNsCount++);\n                } while (typeof nsMatrix[alias] !== 'undefined');\n              } else {\n                alias = newalias;\n              }\n\n              nsUriToPrefix[nsUri] = alias;\n            }\n\n            if (nsMatrix[newalias] !== alias) {\n              if (!hasNewMatrix) {\n                nsMatrix = cloneNsMatrix(nsMatrix);\n                hasNewMatrix = true;\n              }\n\n              nsMatrix[newalias] = alias;\n              if (newalias === 'xmlns') {\n                nsMatrix[uriPrefix(alias)] = nsUri;\n                defaultAlias = alias;\n              }\n\n              nsMatrix[nsUriPrefix] = nsUri;\n            }\n\n            // expose xmlns(:asd)=\"...\" in attributes\n            attrs[name] = value;\n            continue;\n          }\n\n          // collect attributes until all namespace\n          // declarations are processed\n          attrList.push(name, value);\n          continue;\n\n        } /** end if (maybeNs) */\n\n        // handle attributes on element without\n        // namespace declarations\n        w = name.indexOf(':');\n        if (w === -1) {\n          attrs[name] = value;\n          continue;\n        }\n\n        // normalize ns attribute name\n        if (!(nsName = nsMatrix[name.substring(0, w)])) {\n          handleWarning(missingNamespaceForPrefix(name.substring(0, w)));\n          continue;\n        }\n\n        name = defaultAlias === nsName\n          ? name.substr(w + 1)\n          : nsName + name.substr(w);\n\n        // end: normalize ns attribute name\n\n        // normalize xsi:type ns attribute value\n        if (name === XSI_TYPE) {\n          w = value.indexOf(':');\n\n          if (w !== -1) {\n            nsName = value.substring(0, w);\n\n            // handle default prefixes, i.e. xs:String gracefully\n            nsName = nsMatrix[nsName] || nsName;\n            value = nsName + value.substring(w);\n          } else {\n            value = defaultAlias + ':' + value;\n          }\n        }\n\n        // end: normalize xsi:type ns attribute value\n\n        attrs[name] = value;\n      }\n\n\n      // handle deferred, possibly namespaced attributes\n      if (maybeNS) {\n\n        // normalize captured attributes\n        for (i = 0, l = attrList.length; i < l; i++) {\n\n          name = attrList[i++];\n          value = attrList[i];\n\n          w = name.indexOf(':');\n\n          if (w !== -1) {\n\n            // normalize ns attribute name\n            if (!(nsName = nsMatrix[name.substring(0, w)])) {\n              handleWarning(missingNamespaceForPrefix(name.substring(0, w)));\n              continue;\n            }\n\n            name = defaultAlias === nsName\n              ? name.substr(w + 1)\n              : nsName + name.substr(w);\n\n            // end: normalize ns attribute name\n\n            // normalize xsi:type ns attribute value\n            if (name === XSI_TYPE) {\n              w = value.indexOf(':');\n\n              if (w !== -1) {\n                nsName = value.substring(0, w);\n\n                // handle default prefixes, i.e. xs:String gracefully\n                nsName = nsMatrix[nsName] || nsName;\n                value = nsName + value.substring(w);\n              } else {\n                value = defaultAlias + ':' + value;\n              }\n            }\n\n            // end: normalize xsi:type ns attribute value\n          }\n\n          attrs[name] = value;\n        }\n\n        // end: normalize captured attributes\n      }\n\n      return cachedAttrs = attrs;\n    }\n\n    /**\n     * Extract the parse context { line, column, part }\n     * from the current parser position.\n     *\n     * @return {Object} parse context\n     */\n    function getParseContext() {\n      var splitsRe = /(\\r\\n|\\r|\\n)/g;\n\n      var line = 0;\n      var column = 0;\n      var startOfLine = 0;\n      var endOfLine = j;\n      var match;\n      var data;\n\n      while (i >= startOfLine) {\n\n        match = splitsRe.exec(xml);\n\n        if (!match) {\n          break;\n        }\n\n        // end of line = (break idx + break chars)\n        endOfLine = match[0].length + match.index;\n\n        if (endOfLine > i) {\n          break;\n        }\n\n        // advance to next line\n        line += 1;\n\n        startOfLine = endOfLine;\n      }\n\n      // EOF errors\n      if (i == -1) {\n        column = endOfLine;\n        data = xml.substring(j);\n      } else\n\n      // start errors\n      if (j === 0) {\n        data = xml.substring(j, i);\n      }\n\n      // other errors\n      else {\n        column = i - startOfLine;\n        data = (j == -1 ? xml.substring(i) : xml.substring(i, j + 1));\n      }\n\n      return {\n        'data': data,\n        'line': line,\n        'column': column\n      };\n    }\n\n    getContext = getParseContext;\n\n\n    if (proxy) {\n      elementProxy = Object.create({}, {\n        'name': getter(function() {\n          return elementName;\n        }),\n        'originalName': getter(function() {\n          return _elementName;\n        }),\n        'attrs': getter(getAttrs),\n        'ns': getter(function() {\n          return nsMatrix;\n        })\n      });\n    }\n\n    // actual parse logic\n    while (j !== -1) {\n\n      if (xml.charCodeAt(j) === 60) { // \"<\"\n        i = j;\n      } else {\n        i = xml.indexOf('<', j);\n      }\n\n      // parse end\n      if (i === -1) {\n        if (nodeStack.length) {\n          return handleError('unexpected end of file');\n        }\n\n        if (j === 0) {\n          return handleError('missing start tag');\n        }\n\n        if (j < xml.length) {\n          if (xml.substring(j).trim()) {\n            handleWarning(NON_WHITESPACE_OUTSIDE_ROOT_NODE);\n          }\n        }\n\n        return;\n      }\n\n      // parse text\n      if (j !== i) {\n\n        if (nodeStack.length) {\n          if (onText) {\n            onText(xml.substring(j, i), decodeEntities, getContext);\n\n            if (parseStop) {\n              return;\n            }\n          }\n        } else {\n          if (xml.substring(j, i).trim()) {\n            handleWarning(NON_WHITESPACE_OUTSIDE_ROOT_NODE);\n\n            if (parseStop) {\n              return;\n            }\n          }\n        }\n      }\n\n      w = xml.charCodeAt(i+1);\n\n      // parse comments + CDATA\n      if (w === 33) { // \"!\"\n        q = xml.charCodeAt(i+2);\n\n        // CDATA section\n        if (q === 91 && xml.substr(i + 3, 6) === 'CDATA[') { // 91 == \"[\"\n          j = xml.indexOf(']]>', i);\n          if (j === -1) {\n            return handleError('unclosed cdata');\n          }\n\n          if (onCDATA) {\n            onCDATA(xml.substring(i + 9, j), getContext);\n            if (parseStop) {\n              return;\n            }\n          }\n\n          j += 3;\n          continue;\n        }\n\n        // comment\n        if (q === 45 && xml.charCodeAt(i + 3) === 45) { // 45 == \"-\"\n          j = xml.indexOf('-->', i);\n          if (j === -1) {\n            return handleError('unclosed comment');\n          }\n\n\n          if (onComment) {\n            onComment(xml.substring(i + 4, j), decodeEntities, getContext);\n            if (parseStop) {\n              return;\n            }\n          }\n\n          j += 3;\n          continue;\n        }\n      }\n\n      // parse question <? ... ?>\n      if (w === 63) { // \"?\"\n        j = xml.indexOf('?>', i);\n        if (j === -1) {\n          return handleError('unclosed question');\n        }\n\n        if (onQuestion) {\n          onQuestion(xml.substring(i, j + 2), getContext);\n          if (parseStop) {\n            return;\n          }\n        }\n\n        j += 2;\n        continue;\n      }\n\n      // find matching closing tag for attention or standard tags\n      // for that we must skip through attribute values\n      // (enclosed in single or double quotes)\n      for (x = i + 1; ; x++) {\n        v = xml.charCodeAt(x);\n        if (isNaN(v)) {\n          j = -1;\n          return handleError('unclosed tag');\n        }\n\n        // [10] AttValue ::= '\"' ([^<&\"] | Reference)* '\"' | \"'\" ([^<&'] | Reference)* \"'\"\n        // skips the quoted string\n        // (double quotes) does not appear in a literal enclosed by (double quotes)\n        // (single quote) does not appear in a literal enclosed by (single quote)\n        if (v === 34) { //  '\"'\n          q = xml.indexOf('\"', x + 1);\n          x = q !== -1 ? q : x;\n        } else if (v === 39) { // \"'\"\n          q = xml.indexOf(\"'\", x + 1);\n          x = q !== -1 ? q : x;\n        } else if (v === 62) { // '>'\n          j = x;\n          break;\n        }\n      }\n\n\n      // parse attention <! ...>\n      // previously comment and CDATA have already been parsed\n      if (w === 33) { // \"!\"\n\n        if (onAttention) {\n          onAttention(xml.substring(i, j + 1), decodeEntities, getContext);\n          if (parseStop) {\n            return;\n          }\n        }\n\n        j += 1;\n        continue;\n      }\n\n      // don't process attributes;\n      // there are none\n      cachedAttrs = {};\n\n      // if (xml.charCodeAt(i+1) === 47) { // </...\n      if (w === 47) { // </...\n        tagStart = false;\n        tagEnd = true;\n\n        if (!nodeStack.length) {\n          return handleError('missing open tag');\n        }\n\n        // verify open <-> close tag match\n        x = elementName = nodeStack.pop();\n        q = i + 2 + x.length;\n\n        if (xml.substring(i + 2, q) !== x) {\n          return handleError('closing tag mismatch');\n        }\n\n        // verify chars in close tag\n        for (; q < j; q++) {\n          w = xml.charCodeAt(q);\n\n          if (w === 32 || (w > 8 && w < 14)) { // \\f\\n\\r\\t\\v space\n            continue;\n          }\n\n          return handleError('close tag');\n        }\n\n      } else {\n        if (xml.charCodeAt(j - 1) === 47) { // .../>\n          x = elementName = xml.substring(i + 1, j - 1);\n\n          tagStart = true;\n          tagEnd = true;\n\n        } else {\n          x = elementName = xml.substring(i + 1, j);\n\n          tagStart = true;\n          tagEnd = false;\n        }\n\n        if (!(w > 96 && w < 123 || w > 64 && w < 91 || w === 95 || w === 58)) { // char 95\"_\" 58\":\"\n          return handleError('illegal first char nodeName');\n        }\n\n        for (q = 1, y = x.length; q < y; q++) {\n          w = x.charCodeAt(q);\n\n          if (w > 96 && w < 123 || w > 64 && w < 91 || w > 47 && w < 59 || w === 45 || w === 95 || w == 46) {\n            continue;\n          }\n\n          if (w === 32 || (w < 14 && w > 8)) { // \\f\\n\\r\\t\\v space\n            elementName = x.substring(0, q);\n\n            // maybe there are attributes\n            cachedAttrs = null;\n            break;\n          }\n\n          return handleError('invalid nodeName');\n        }\n\n        if (!tagEnd) {\n          nodeStack.push(elementName);\n        }\n      }\n\n      if (isNamespace) {\n\n        _nsMatrix = nsMatrix;\n\n        if (tagStart) {\n\n          // remember old namespace\n          // unless we're self-closing\n          if (!tagEnd) {\n            nsMatrixStack.push(_nsMatrix);\n          }\n\n          if (cachedAttrs === null) {\n\n            // quick check, whether there may be namespace\n            // declarations on the node; if that is the case\n            // we need to eagerly parse the node attributes\n            if ((maybeNS = x.indexOf('xmlns', q) !== -1)) {\n              attrsStart = q;\n              attrsString = x;\n\n              getAttrs();\n\n              maybeNS = false;\n            }\n          }\n        }\n\n        _elementName = elementName;\n\n        w = elementName.indexOf(':');\n        if (w !== -1) {\n          xmlns = nsMatrix[elementName.substring(0, w)];\n\n          // prefix given; namespace must exist\n          if (!xmlns) {\n            return handleError('missing namespace on <' + _elementName + '>');\n          }\n\n          elementName = elementName.substr(w + 1);\n        } else {\n          xmlns = nsMatrix['xmlns'];\n\n          // if no default namespace is defined,\n          // we'll import the element as anonymous.\n          //\n          // it is up to users to correct that to the document defined\n          // targetNamespace, or whatever their undersanding of the\n          // XML spec mandates.\n        }\n\n        // adjust namespace prefixs as configured\n        if (xmlns) {\n          elementName = xmlns + ':' + elementName;\n        }\n\n      }\n\n      if (tagStart) {\n        attrsStart = q;\n        attrsString = x;\n\n        if (onOpenTag) {\n          if (proxy) {\n            onOpenTag(elementProxy, decodeEntities, tagEnd, getContext);\n          } else {\n            onOpenTag(elementName, getAttrs, decodeEntities, tagEnd, getContext);\n          }\n\n          if (parseStop) {\n            return;\n          }\n        }\n\n      }\n\n      if (tagEnd) {\n\n        if (onCloseTag) {\n          onCloseTag(proxy ? elementProxy : elementName, decodeEntities, tagStart, getContext);\n\n          if (parseStop) {\n            return;\n          }\n        }\n\n        // restore old namespace\n        if (isNamespace) {\n          if (!tagStart) {\n            nsMatrix = nsMatrixStack.pop();\n          } else {\n            nsMatrix = _nsMatrix;\n          }\n        }\n      }\n\n      j += 1;\n    }\n  } /** end parse */\n\n}\n\nexport { Parser, decodeEntities as decode };\n","import { forEach, assign, find, isString, findIndex, filter, has } from 'min-dash';\nimport { Parser } from 'saxen';\nimport { coerceType, parseNameNS, isSimpleType, Moddle } from 'moddle';\n\nfunction hasLowerCaseAlias(pkg) {\n  return pkg.xml && pkg.xml.tagAlias === 'lowerCase';\n}\n\nvar DEFAULT_NS_MAP = {\n  'xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n  'xml': 'http://www.w3.org/XML/1998/namespace'\n};\n\nvar XSI_TYPE = 'xsi:type';\n\nfunction serializeFormat(element) {\n  return element.xml && element.xml.serialize;\n}\n\nfunction serializeAsType(element) {\n  return serializeFormat(element) === XSI_TYPE;\n}\n\nfunction serializeAsProperty(element) {\n  return serializeFormat(element) === 'property';\n}\n\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction aliasToName(aliasNs, pkg) {\n\n  if (!hasLowerCaseAlias(pkg)) {\n    return aliasNs.name;\n  }\n\n  return aliasNs.prefix + ':' + capitalize(aliasNs.localName);\n}\n\nfunction prefixedToName(nameNs, pkg) {\n\n  var name = nameNs.name,\n      localName = nameNs.localName;\n\n  var typePrefix = pkg.xml && pkg.xml.typePrefix;\n\n  if (typePrefix && localName.indexOf(typePrefix) === 0) {\n    return nameNs.prefix + ':' + localName.slice(typePrefix.length);\n  } else {\n    return name;\n  }\n}\n\nfunction normalizeXsiTypeName(name, model) {\n\n  var nameNs = parseNameNS(name);\n  var pkg = model.getPackage(nameNs.prefix);\n\n  return prefixedToName(nameNs, pkg);\n}\n\nfunction error(message) {\n  return new Error(message);\n}\n\n/**\n * Get the moddle descriptor for a given instance or type.\n *\n * @param  {ModdleElement|Function} element\n *\n * @return {Object} the moddle descriptor\n */\nfunction getModdleDescriptor(element) {\n  return element.$descriptor;\n}\n\n\n/**\n * A parse context.\n *\n * @class\n *\n * @param {Object} options\n * @param {ElementHandler} options.rootHandler the root handler for parsing a document\n * @param {boolean} [options.lax=false] whether or not to ignore invalid elements\n */\nfunction Context(options) {\n\n  /**\n   * @property {ElementHandler} rootHandler\n   */\n\n  /**\n   * @property {Boolean} lax\n   */\n\n  assign(this, options);\n\n  this.elementsById = {};\n  this.references = [];\n  this.warnings = [];\n\n  /**\n   * Add an unresolved reference.\n   *\n   * @param {Object} reference\n   */\n  this.addReference = function(reference) {\n    this.references.push(reference);\n  };\n\n  /**\n   * Add a processed element.\n   *\n   * @param {ModdleElement} element\n   */\n  this.addElement = function(element) {\n\n    if (!element) {\n      throw error('expected element');\n    }\n\n    var elementsById = this.elementsById;\n\n    var descriptor = getModdleDescriptor(element);\n\n    var idProperty = descriptor.idProperty,\n        id;\n\n    if (idProperty) {\n      id = element.get(idProperty.name);\n\n      if (id) {\n\n        // for QName validation as per http://www.w3.org/TR/REC-xml/#NT-NameChar\n        if (!/^([a-z][\\w-.]*:)?[a-z_][\\w-.]*$/i.test(id)) {\n          throw new Error('illegal ID <' + id + '>');\n        }\n\n        if (elementsById[id]) {\n          throw error('duplicate ID <' + id + '>');\n        }\n\n        elementsById[id] = element;\n      }\n    }\n  };\n\n  /**\n   * Add an import warning.\n   *\n   * @param {Object} warning\n   * @param {String} warning.message\n   * @param {Error} [warning.error]\n   */\n  this.addWarning = function(warning) {\n    this.warnings.push(warning);\n  };\n}\n\nfunction BaseHandler() {}\n\nBaseHandler.prototype.handleEnd = function() {};\nBaseHandler.prototype.handleText = function() {};\nBaseHandler.prototype.handleNode = function() {};\n\n\n/**\n * A simple pass through handler that does nothing except for\n * ignoring all input it receives.\n *\n * This is used to ignore unknown elements and\n * attributes.\n */\nfunction NoopHandler() { }\n\nNoopHandler.prototype = Object.create(BaseHandler.prototype);\n\nNoopHandler.prototype.handleNode = function() {\n  return this;\n};\n\nfunction BodyHandler() {}\n\nBodyHandler.prototype = Object.create(BaseHandler.prototype);\n\nBodyHandler.prototype.handleText = function(text) {\n  this.body = (this.body || '') + text;\n};\n\nfunction ReferenceHandler(property, context) {\n  this.property = property;\n  this.context = context;\n}\n\nReferenceHandler.prototype = Object.create(BodyHandler.prototype);\n\nReferenceHandler.prototype.handleNode = function(node) {\n\n  if (this.element) {\n    throw error('expected no sub nodes');\n  } else {\n    this.element = this.createReference(node);\n  }\n\n  return this;\n};\n\nReferenceHandler.prototype.handleEnd = function() {\n  this.element.id = this.body;\n};\n\nReferenceHandler.prototype.createReference = function(node) {\n  return {\n    property: this.property.ns.name,\n    id: ''\n  };\n};\n\nfunction ValueHandler(propertyDesc, element) {\n  this.element = element;\n  this.propertyDesc = propertyDesc;\n}\n\nValueHandler.prototype = Object.create(BodyHandler.prototype);\n\nValueHandler.prototype.handleEnd = function() {\n\n  var value = this.body || '',\n      element = this.element,\n      propertyDesc = this.propertyDesc;\n\n  value = coerceType(propertyDesc.type, value);\n\n  if (propertyDesc.isMany) {\n    element.get(propertyDesc.name).push(value);\n  } else {\n    element.set(propertyDesc.name, value);\n  }\n};\n\n\nfunction BaseElementHandler() {}\n\nBaseElementHandler.prototype = Object.create(BodyHandler.prototype);\n\nBaseElementHandler.prototype.handleNode = function(node) {\n  var parser = this,\n      element = this.element;\n\n  if (!element) {\n    element = this.element = this.createElement(node);\n\n    this.context.addElement(element);\n  } else {\n    parser = this.handleChild(node);\n  }\n\n  return parser;\n};\n\n/**\n * @class Reader.ElementHandler\n *\n */\nfunction ElementHandler(model, typeName, context) {\n  this.model = model;\n  this.type = model.getType(typeName);\n  this.context = context;\n}\n\nElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nElementHandler.prototype.addReference = function(reference) {\n  this.context.addReference(reference);\n};\n\nElementHandler.prototype.handleText = function(text) {\n\n  var element = this.element,\n      descriptor = getModdleDescriptor(element),\n      bodyProperty = descriptor.bodyProperty;\n\n  if (!bodyProperty) {\n    throw error('unexpected body text <' + text + '>');\n  }\n\n  BodyHandler.prototype.handleText.call(this, text);\n};\n\nElementHandler.prototype.handleEnd = function() {\n\n  var value = this.body,\n      element = this.element,\n      descriptor = getModdleDescriptor(element),\n      bodyProperty = descriptor.bodyProperty;\n\n  if (bodyProperty && value !== undefined) {\n    value = coerceType(bodyProperty.type, value);\n    element.set(bodyProperty.name, value);\n  }\n};\n\n/**\n * Create an instance of the model from the given node.\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.createElement = function(node) {\n  var attributes = node.attributes,\n      Type = this.type,\n      descriptor = getModdleDescriptor(Type),\n      context = this.context,\n      instance = new Type({}),\n      model = this.model,\n      propNameNs;\n\n  forEach(attributes, function(value, name) {\n\n    var prop = descriptor.propertiesByName[name],\n        values;\n\n    if (prop && prop.isReference) {\n\n      if (!prop.isMany) {\n        context.addReference({\n          element: instance,\n          property: prop.ns.name,\n          id: value\n        });\n      } else {\n\n        // IDREFS: parse references as whitespace-separated list\n        values = value.split(' ');\n\n        forEach(values, function(v) {\n          context.addReference({\n            element: instance,\n            property: prop.ns.name,\n            id: v\n          });\n        });\n      }\n\n    } else {\n      if (prop) {\n        value = coerceType(prop.type, value);\n      } else\n      if (name !== 'xmlns') {\n        propNameNs = parseNameNS(name, descriptor.ns.prefix);\n\n        // check whether attribute is defined in a well-known namespace\n        // if that is the case we emit a warning to indicate potential misuse\n        if (model.getPackage(propNameNs.prefix)) {\n\n          context.addWarning({\n            message: 'unknown attribute <' + name + '>',\n            element: instance,\n            property: name,\n            value: value\n          });\n        }\n      }\n\n      instance.set(name, value);\n    }\n  });\n\n  return instance;\n};\n\nElementHandler.prototype.getPropertyForNode = function(node) {\n\n  var name = node.name;\n  var nameNs = parseNameNS(name);\n\n  var type = this.type,\n      model = this.model,\n      descriptor = getModdleDescriptor(type);\n\n  var propertyName = nameNs.name,\n      property = descriptor.propertiesByName[propertyName],\n      elementTypeName,\n      elementType;\n\n  // search for properties by name first\n\n  if (property && !property.isAttr) {\n\n    if (serializeAsType(property)) {\n      elementTypeName = node.attributes[XSI_TYPE];\n\n      // xsi type is optional, if it does not exists the\n      // default type is assumed\n      if (elementTypeName) {\n\n        // take possible type prefixes from XML\n        // into account, i.e.: xsi:type=\"t{ActualType}\"\n        elementTypeName = normalizeXsiTypeName(elementTypeName, model);\n\n        elementType = model.getType(elementTypeName);\n\n        return assign({}, property, {\n          effectiveType: getModdleDescriptor(elementType).name\n        });\n      }\n    }\n\n    // search for properties by name first\n    return property;\n  }\n\n  var pkg = model.getPackage(nameNs.prefix);\n\n  if (pkg) {\n    elementTypeName = aliasToName(nameNs, pkg);\n    elementType = model.getType(elementTypeName);\n\n    // search for collection members later\n    property = find(descriptor.properties, function(p) {\n      return !p.isVirtual && !p.isReference && !p.isAttribute && elementType.hasType(p.type);\n    });\n\n    if (property) {\n      return assign({}, property, {\n        effectiveType: getModdleDescriptor(elementType).name\n      });\n    }\n  } else {\n\n    // parse unknown element (maybe extension)\n    property = find(descriptor.properties, function(p) {\n      return !p.isReference && !p.isAttribute && p.type === 'Element';\n    });\n\n    if (property) {\n      return property;\n    }\n  }\n\n  throw error('unrecognized element <' + nameNs.name + '>');\n};\n\nElementHandler.prototype.toString = function() {\n  return 'ElementDescriptor[' + getModdleDescriptor(this.type).name + ']';\n};\n\nElementHandler.prototype.valueHandler = function(propertyDesc, element) {\n  return new ValueHandler(propertyDesc, element);\n};\n\nElementHandler.prototype.referenceHandler = function(propertyDesc) {\n  return new ReferenceHandler(propertyDesc, this.context);\n};\n\nElementHandler.prototype.handler = function(type) {\n  if (type === 'Element') {\n    return new GenericElementHandler(this.model, type, this.context);\n  } else {\n    return new ElementHandler(this.model, type, this.context);\n  }\n};\n\n/**\n * Handle the child element parsing\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.handleChild = function(node) {\n  var propertyDesc, type, element, childHandler;\n\n  propertyDesc = this.getPropertyForNode(node);\n  element = this.element;\n\n  type = propertyDesc.effectiveType || propertyDesc.type;\n\n  if (isSimpleType(type)) {\n    return this.valueHandler(propertyDesc, element);\n  }\n\n  if (propertyDesc.isReference) {\n    childHandler = this.referenceHandler(propertyDesc).handleNode(node);\n  } else {\n    childHandler = this.handler(type).handleNode(node);\n  }\n\n  var newElement = childHandler.element;\n\n  // child handles may decide to skip elements\n  // by not returning anything\n  if (newElement !== undefined) {\n\n    if (propertyDesc.isMany) {\n      element.get(propertyDesc.name).push(newElement);\n    } else {\n      element.set(propertyDesc.name, newElement);\n    }\n\n    if (propertyDesc.isReference) {\n      assign(newElement, {\n        element: element\n      });\n\n      this.context.addReference(newElement);\n    } else {\n\n      // establish child -> parent relationship\n      newElement.$parent = element;\n    }\n  }\n\n  return childHandler;\n};\n\n/**\n * An element handler that performs special validation\n * to ensure the node it gets initialized with matches\n * the handlers type (namespace wise).\n *\n * @param {Moddle} model\n * @param {String} typeName\n * @param {Context} context\n */\nfunction RootElementHandler(model, typeName, context) {\n  ElementHandler.call(this, model, typeName, context);\n}\n\nRootElementHandler.prototype = Object.create(ElementHandler.prototype);\n\nRootElementHandler.prototype.createElement = function(node) {\n\n  var name = node.name,\n      nameNs = parseNameNS(name),\n      model = this.model,\n      type = this.type,\n      pkg = model.getPackage(nameNs.prefix),\n      typeName = pkg && aliasToName(nameNs, pkg) || name;\n\n  // verify the correct namespace if we parse\n  // the first element in the handler tree\n  //\n  // this ensures we don't mistakenly import wrong namespace elements\n  if (!type.hasType(typeName)) {\n    throw error('unexpected element <' + node.originalName + '>');\n  }\n\n  return ElementHandler.prototype.createElement.call(this, node);\n};\n\n\nfunction GenericElementHandler(model, typeName, context) {\n  this.model = model;\n  this.context = context;\n}\n\nGenericElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nGenericElementHandler.prototype.createElement = function(node) {\n\n  var name = node.name,\n      ns = parseNameNS(name),\n      prefix = ns.prefix,\n      uri = node.ns[prefix + '$uri'],\n      attributes = node.attributes;\n\n  return this.model.createAny(name, uri, attributes);\n};\n\nGenericElementHandler.prototype.handleChild = function(node) {\n\n  var handler = new GenericElementHandler(this.model, 'Element', this.context).handleNode(node),\n      element = this.element;\n\n  var newElement = handler.element,\n      children;\n\n  if (newElement !== undefined) {\n    children = element.$children = element.$children || [];\n    children.push(newElement);\n\n    // establish child -> parent relationship\n    newElement.$parent = element;\n  }\n\n  return handler;\n};\n\nGenericElementHandler.prototype.handleEnd = function() {\n  if (this.body) {\n    this.element.$body = this.body;\n  }\n};\n\n/**\n * A reader for a meta-model\n *\n * @param {Object} options\n * @param {Model} options.model used to read xml files\n * @param {Boolean} options.lax whether to make parse errors warnings\n */\nfunction Reader(options) {\n\n  if (options instanceof Moddle) {\n    options = {\n      model: options\n    };\n  }\n\n  assign(this, { lax: false }, options);\n}\n\n/**\n * The fromXML result.\n *\n * @typedef {Object} ParseResult\n *\n * @property {ModdleElement} rootElement\n * @property {Array<Object>} references\n * @property {Array<Error>} warnings\n * @property {Object} elementsById - a mapping containing each ID -> ModdleElement\n */\n\n/**\n * The fromXML result.\n *\n * @typedef {Error} ParseError\n *\n * @property {Array<Error>} warnings\n */\n\n/**\n * Parse the given XML into a moddle document tree.\n *\n * @param {String} xml\n * @param {ElementHandler|Object} options or rootHandler\n *\n * @returns {Promise<ParseResult, ParseError>}\n */\nReader.prototype.fromXML = function(xml, options, done) {\n\n  var rootHandler = options.rootHandler;\n\n  if (options instanceof ElementHandler) {\n\n    // root handler passed via (xml, { rootHandler: ElementHandler }, ...)\n    rootHandler = options;\n    options = {};\n  } else {\n    if (typeof options === 'string') {\n\n      // rootHandler passed via (xml, 'someString', ...)\n      rootHandler = this.handler(options);\n      options = {};\n    } else if (typeof rootHandler === 'string') {\n\n      // rootHandler passed via (xml, { rootHandler: 'someString' }, ...)\n      rootHandler = this.handler(rootHandler);\n    }\n  }\n\n  var model = this.model,\n      lax = this.lax;\n\n  var context = new Context(assign({}, options, { rootHandler: rootHandler })),\n      parser = new Parser({ proxy: true }),\n      stack = createStack();\n\n  rootHandler.context = context;\n\n  // push root handler\n  stack.push(rootHandler);\n\n\n  /**\n   * Handle error.\n   *\n   * @param  {Error} err\n   * @param  {Function} getContext\n   * @param  {boolean} lax\n   *\n   * @return {boolean} true if handled\n   */\n  function handleError(err, getContext, lax) {\n\n    var ctx = getContext();\n\n    var line = ctx.line,\n        column = ctx.column,\n        data = ctx.data;\n\n    // we receive the full context data here,\n    // for elements trim down the information\n    // to the tag name, only\n    if (data.charAt(0) === '<' && data.indexOf(' ') !== -1) {\n      data = data.slice(0, data.indexOf(' ')) + '>';\n    }\n\n    var message =\n      'unparsable content ' + (data ? data + ' ' : '') + 'detected\\n\\t' +\n        'line: ' + line + '\\n\\t' +\n        'column: ' + column + '\\n\\t' +\n        'nested error: ' + err.message;\n\n    if (lax) {\n      context.addWarning({\n        message: message,\n        error: err\n      });\n\n      return true;\n    } else {\n      throw error(message);\n    }\n  }\n\n  function handleWarning(err, getContext) {\n\n    // just like handling errors in <lax=true> mode\n    return handleError(err, getContext, true);\n  }\n\n  /**\n   * Resolve collected references on parse end.\n   */\n  function resolveReferences() {\n\n    var elementsById = context.elementsById;\n    var references = context.references;\n\n    var i, r;\n\n    for (i = 0; (r = references[i]); i++) {\n      var element = r.element;\n      var reference = elementsById[r.id];\n      var property = getModdleDescriptor(element).propertiesByName[r.property];\n\n      if (!reference) {\n        context.addWarning({\n          message: 'unresolved reference <' + r.id + '>',\n          element: r.element,\n          property: r.property,\n          value: r.id\n        });\n      }\n\n      if (property.isMany) {\n        var collection = element.get(property.name),\n            idx = collection.indexOf(r);\n\n        // we replace an existing place holder (idx != -1) or\n        // append to the collection instead\n        if (idx === -1) {\n          idx = collection.length;\n        }\n\n        if (!reference) {\n\n          // remove unresolvable reference\n          collection.splice(idx, 1);\n        } else {\n\n          // add or update reference in collection\n          collection[idx] = reference;\n        }\n      } else {\n        element.set(property.name, reference);\n      }\n    }\n  }\n\n  function handleClose() {\n    stack.pop().handleEnd();\n  }\n\n  var PREAMBLE_START_PATTERN = /^<\\?xml /i;\n\n  var ENCODING_PATTERN = / encoding=\"([^\"]+)\"/i;\n\n  var UTF_8_PATTERN = /^utf-8$/i;\n\n  function handleQuestion(question) {\n\n    if (!PREAMBLE_START_PATTERN.test(question)) {\n      return;\n    }\n\n    var match = ENCODING_PATTERN.exec(question);\n    var encoding = match && match[1];\n\n    if (!encoding || UTF_8_PATTERN.test(encoding)) {\n      return;\n    }\n\n    context.addWarning({\n      message:\n        'unsupported document encoding <' + encoding + '>, ' +\n        'falling back to UTF-8'\n    });\n  }\n\n  function handleOpen(node, getContext) {\n    var handler = stack.peek();\n\n    try {\n      stack.push(handler.handleNode(node));\n    } catch (err) {\n\n      if (handleError(err, getContext, lax)) {\n        stack.push(new NoopHandler());\n      }\n    }\n  }\n\n  function handleCData(text, getContext) {\n\n    try {\n      stack.peek().handleText(text);\n    } catch (err) {\n      handleWarning(err, getContext);\n    }\n  }\n\n  function handleText(text, getContext) {\n\n    // strip whitespace only nodes, i.e. before\n    // <!CDATA[ ... ]> sections and in between tags\n\n    if (!text.trim()) {\n      return;\n    }\n\n    handleCData(text, getContext);\n  }\n\n  var uriMap = model.getPackages().reduce(function(uriMap, p) {\n    uriMap[p.uri] = p.prefix;\n\n    return uriMap;\n  }, {\n    'http://www.w3.org/XML/1998/namespace': 'xml' // add default xml ns\n  });\n  parser\n    .ns(uriMap)\n    .on('openTag', function(obj, decodeStr, selfClosing, getContext) {\n\n      // gracefully handle unparsable attributes (attrs=false)\n      var attrs = obj.attrs || {};\n\n      var decodedAttrs = Object.keys(attrs).reduce(function(d, key) {\n        var value = decodeStr(attrs[key]);\n\n        d[key] = value;\n\n        return d;\n      }, {});\n\n      var node = {\n        name: obj.name,\n        originalName: obj.originalName,\n        attributes: decodedAttrs,\n        ns: obj.ns\n      };\n\n      handleOpen(node, getContext);\n    })\n    .on('question', handleQuestion)\n    .on('closeTag', handleClose)\n    .on('cdata', handleCData)\n    .on('text', function(text, decodeEntities, getContext) {\n      handleText(decodeEntities(text), getContext);\n    })\n    .on('error', handleError)\n    .on('warn', handleWarning);\n\n  // async XML parsing to make sure the execution environment\n  // (node or brower) is kept responsive and that certain optimization\n  // strategies can kick in.\n  return new Promise(function(resolve, reject) {\n\n    var err;\n\n    try {\n      parser.parse(xml);\n\n      resolveReferences();\n    } catch (e) {\n      err = e;\n    }\n\n    var rootElement = rootHandler.element;\n\n    if (!err && !rootElement) {\n      err = error('failed to parse document as <' + rootHandler.type.$descriptor.name + '>');\n    }\n\n    var warnings = context.warnings;\n    var references = context.references;\n    var elementsById = context.elementsById;\n\n    if (err) {\n      err.warnings = warnings;\n\n      return reject(err);\n    } else {\n      return resolve({\n        rootElement: rootElement,\n        elementsById: elementsById,\n        references: references,\n        warnings: warnings\n      });\n    }\n  });\n};\n\nReader.prototype.handler = function(name) {\n  return new RootElementHandler(this.model, name);\n};\n\n\n// helpers //////////////////////////\n\nfunction createStack() {\n  var stack = [];\n\n  Object.defineProperty(stack, 'peek', {\n    value: function() {\n      return this[this.length - 1];\n    }\n  });\n\n  return stack;\n}\n\nvar XML_PREAMBLE = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\n\nvar ESCAPE_ATTR_CHARS = /<|>|'|\"|&|\\n\\r|\\n/g;\nvar ESCAPE_CHARS = /<|>|&/g;\n\n\nfunction Namespaces(parent) {\n\n  var prefixMap = {};\n  var uriMap = {};\n  var used = {};\n\n  var wellknown = [];\n  var custom = [];\n\n  // API\n\n  this.byUri = function(uri) {\n    return uriMap[uri] || (\n      parent && parent.byUri(uri)\n    );\n  };\n\n  this.add = function(ns, isWellknown) {\n\n    uriMap[ns.uri] = ns;\n\n    if (isWellknown) {\n      wellknown.push(ns);\n    } else {\n      custom.push(ns);\n    }\n\n    this.mapPrefix(ns.prefix, ns.uri);\n  };\n\n  this.uriByPrefix = function(prefix) {\n    return prefixMap[prefix || 'xmlns'];\n  };\n\n  this.mapPrefix = function(prefix, uri) {\n    prefixMap[prefix || 'xmlns'] = uri;\n  };\n\n  this.getNSKey = function(ns) {\n    return (ns.prefix !== undefined) ? (ns.uri + '|' + ns.prefix) : ns.uri;\n  };\n\n  this.logUsed = function(ns) {\n\n    var uri = ns.uri;\n    var nsKey = this.getNSKey(ns);\n\n    used[nsKey] = this.byUri(uri);\n\n    // Inform parent recursively about the usage of this NS\n    if (parent) {\n      parent.logUsed(ns);\n    }\n  };\n\n  this.getUsed = function(ns) {\n\n    function isUsed(ns) {\n      var nsKey = self.getNSKey(ns);\n\n      return used[nsKey];\n    }\n\n    var self = this;\n\n    var allNs = [].concat(wellknown, custom);\n\n    return allNs.filter(isUsed);\n  };\n\n}\n\nfunction lower(string) {\n  return string.charAt(0).toLowerCase() + string.slice(1);\n}\n\nfunction nameToAlias(name, pkg) {\n  if (hasLowerCaseAlias(pkg)) {\n    return lower(name);\n  } else {\n    return name;\n  }\n}\n\nfunction inherits(ctor, superCtor) {\n  ctor.super_ = superCtor;\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n}\n\nfunction nsName(ns) {\n  if (isString(ns)) {\n    return ns;\n  } else {\n    return (ns.prefix ? ns.prefix + ':' : '') + ns.localName;\n  }\n}\n\nfunction getNsAttrs(namespaces) {\n\n  return namespaces.getUsed().filter(function(ns) {\n\n    // do not serialize built in <xml> namespace\n    return ns.prefix !== 'xml';\n  }).map(function(ns) {\n    var name = 'xmlns' + (ns.prefix ? ':' + ns.prefix : '');\n    return { name: name, value: ns.uri };\n  });\n\n}\n\nfunction getElementNs(ns, descriptor) {\n  if (descriptor.isGeneric) {\n    return assign({ localName: descriptor.ns.localName }, ns);\n  } else {\n    return assign({ localName: nameToAlias(descriptor.ns.localName, descriptor.$pkg) }, ns);\n  }\n}\n\nfunction getPropertyNs(ns, descriptor) {\n  return assign({ localName: descriptor.ns.localName }, ns);\n}\n\nfunction getSerializableProperties(element) {\n  var descriptor = element.$descriptor;\n\n  return filter(descriptor.properties, function(p) {\n    var name = p.name;\n\n    if (p.isVirtual) {\n      return false;\n    }\n\n    // do not serialize defaults\n    if (!has(element, name)) {\n      return false;\n    }\n\n    var value = element[name];\n\n    // do not serialize default equals\n    if (value === p.default) {\n      return false;\n    }\n\n    // do not serialize null properties\n    if (value === null) {\n      return false;\n    }\n\n    return p.isMany ? value.length : true;\n  });\n}\n\nvar ESCAPE_ATTR_MAP = {\n  '\\n': '#10',\n  '\\n\\r': '#10',\n  '\"': '#34',\n  '\\'': '#39',\n  '<': '#60',\n  '>': '#62',\n  '&': '#38'\n};\n\nvar ESCAPE_MAP = {\n  '<': 'lt',\n  '>': 'gt',\n  '&': 'amp'\n};\n\nfunction escape(str, charPattern, replaceMap) {\n\n  // ensure we are handling strings here\n  str = isString(str) ? str : '' + str;\n\n  return str.replace(charPattern, function(s) {\n    return '&' + replaceMap[s] + ';';\n  });\n}\n\n/**\n * Escape a string attribute to not contain any bad values (line breaks, '\"', ...)\n *\n * @param {String} str the string to escape\n * @return {String} the escaped string\n */\nfunction escapeAttr(str) {\n  return escape(str, ESCAPE_ATTR_CHARS, ESCAPE_ATTR_MAP);\n}\n\nfunction escapeBody(str) {\n  return escape(str, ESCAPE_CHARS, ESCAPE_MAP);\n}\n\nfunction filterAttributes(props) {\n  return filter(props, function(p) { return p.isAttr; });\n}\n\nfunction filterContained(props) {\n  return filter(props, function(p) { return !p.isAttr; });\n}\n\n\nfunction ReferenceSerializer(tagName) {\n  this.tagName = tagName;\n}\n\nReferenceSerializer.prototype.build = function(element) {\n  this.element = element;\n  return this;\n};\n\nReferenceSerializer.prototype.serializeTo = function(writer) {\n  writer\n    .appendIndent()\n    .append('<' + this.tagName + '>' + this.element.id + '</' + this.tagName + '>')\n    .appendNewLine();\n};\n\nfunction BodySerializer() {}\n\nBodySerializer.prototype.serializeValue =\nBodySerializer.prototype.serializeTo = function(writer) {\n  writer.append(\n    this.escape\n      ? escapeBody(this.value)\n      : this.value\n  );\n};\n\nBodySerializer.prototype.build = function(prop, value) {\n  this.value = value;\n\n  if (prop.type === 'String' && value.search(ESCAPE_CHARS) !== -1) {\n    this.escape = true;\n  }\n\n  return this;\n};\n\nfunction ValueSerializer(tagName) {\n  this.tagName = tagName;\n}\n\ninherits(ValueSerializer, BodySerializer);\n\nValueSerializer.prototype.serializeTo = function(writer) {\n\n  writer\n    .appendIndent()\n    .append('<' + this.tagName + '>');\n\n  this.serializeValue(writer);\n\n  writer\n    .append('</' + this.tagName + '>')\n    .appendNewLine();\n};\n\nfunction ElementSerializer(parent, propertyDescriptor) {\n  this.body = [];\n  this.attrs = [];\n\n  this.parent = parent;\n  this.propertyDescriptor = propertyDescriptor;\n}\n\nElementSerializer.prototype.build = function(element) {\n  this.element = element;\n\n  var elementDescriptor = element.$descriptor,\n      propertyDescriptor = this.propertyDescriptor;\n\n  var otherAttrs,\n      properties;\n\n  var isGeneric = elementDescriptor.isGeneric;\n\n  if (isGeneric) {\n    otherAttrs = this.parseGeneric(element);\n  } else {\n    otherAttrs = this.parseNsAttributes(element);\n  }\n\n  if (propertyDescriptor) {\n    this.ns = this.nsPropertyTagName(propertyDescriptor);\n  } else {\n    this.ns = this.nsTagName(elementDescriptor);\n  }\n\n  // compute tag name\n  this.tagName = this.addTagName(this.ns);\n\n  if (!isGeneric) {\n    properties = getSerializableProperties(element);\n\n    this.parseAttributes(filterAttributes(properties));\n    this.parseContainments(filterContained(properties));\n  }\n\n  this.parseGenericAttributes(element, otherAttrs);\n\n  return this;\n};\n\nElementSerializer.prototype.nsTagName = function(descriptor) {\n  var effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getElementNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.nsPropertyTagName = function(descriptor) {\n  var effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getPropertyNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.isLocalNs = function(ns) {\n  return ns.uri === this.ns.uri;\n};\n\n/**\n * Get the actual ns attribute name for the given element.\n *\n * @param {Object} element\n * @param {Boolean} [element.inherited=false]\n *\n * @return {Object} nsName\n */\nElementSerializer.prototype.nsAttributeName = function(element) {\n\n  var ns;\n\n  if (isString(element)) {\n    ns = parseNameNS(element);\n  } else {\n    ns = element.ns;\n  }\n\n  // return just local name for inherited attributes\n  if (element.inherited) {\n    return { localName: ns.localName };\n  }\n\n  // parse + log effective ns\n  var effectiveNs = this.logNamespaceUsed(ns);\n\n  // LOG ACTUAL namespace use\n  this.getNamespaces().logUsed(effectiveNs);\n\n  // strip prefix if same namespace like parent\n  if (this.isLocalNs(effectiveNs)) {\n    return { localName: ns.localName };\n  } else {\n    return assign({ localName: ns.localName }, effectiveNs);\n  }\n};\n\nElementSerializer.prototype.parseGeneric = function(element) {\n\n  var self = this,\n      body = this.body;\n\n  var attributes = [];\n\n  forEach(element, function(val, key) {\n\n    var nonNsAttr;\n\n    if (key === '$body') {\n      body.push(new BodySerializer().build({ type: 'String' }, val));\n    } else\n    if (key === '$children') {\n      forEach(val, function(child) {\n        body.push(new ElementSerializer(self).build(child));\n      });\n    } else\n    if (key.indexOf('$') !== 0) {\n      nonNsAttr = self.parseNsAttribute(element, key, val);\n\n      if (nonNsAttr) {\n        attributes.push({ name: key, value: val });\n      }\n    }\n  });\n\n  return attributes;\n};\n\nElementSerializer.prototype.parseNsAttribute = function(element, name, value) {\n  var model = element.$model;\n\n  var nameNs = parseNameNS(name);\n\n  var ns;\n\n  // parse xmlns:foo=\"http://foo.bar\"\n  if (nameNs.prefix === 'xmlns') {\n    ns = { prefix: nameNs.localName, uri: value };\n  }\n\n  // parse xmlns=\"http://foo.bar\"\n  if (!nameNs.prefix && nameNs.localName === 'xmlns') {\n    ns = { uri: value };\n  }\n\n  if (!ns) {\n    return {\n      name: name,\n      value: value\n    };\n  }\n\n  if (model && model.getPackage(value)) {\n\n    // register well known namespace\n    this.logNamespace(ns, true, true);\n  } else {\n\n    // log custom namespace directly as used\n    var actualNs = this.logNamespaceUsed(ns, true);\n\n    this.getNamespaces().logUsed(actualNs);\n  }\n};\n\n\n/**\n * Parse namespaces and return a list of left over generic attributes\n *\n * @param  {Object} element\n * @return {Array<Object>}\n */\nElementSerializer.prototype.parseNsAttributes = function(element, attrs) {\n  var self = this;\n\n  var genericAttrs = element.$attrs;\n\n  var attributes = [];\n\n  // parse namespace attributes first\n  // and log them. push non namespace attributes to a list\n  // and process them later\n  forEach(genericAttrs, function(value, name) {\n\n    var nonNsAttr = self.parseNsAttribute(element, name, value);\n\n    if (nonNsAttr) {\n      attributes.push(nonNsAttr);\n    }\n  });\n\n  return attributes;\n};\n\nElementSerializer.prototype.parseGenericAttributes = function(element, attributes) {\n\n  var self = this;\n\n  forEach(attributes, function(attr) {\n\n    // do not serialize xsi:type attribute\n    // it is set manually based on the actual implementation type\n    if (attr.name === XSI_TYPE) {\n      return;\n    }\n\n    try {\n      self.addAttribute(self.nsAttributeName(attr.name), attr.value);\n    } catch (e) {\n      /* global console */\n\n      console.warn(\n        'missing namespace information for ',\n        attr.name, '=', attr.value, 'on', element,\n        e);\n    }\n  });\n};\n\nElementSerializer.prototype.parseContainments = function(properties) {\n\n  var self = this,\n      body = this.body,\n      element = this.element;\n\n  forEach(properties, function(p) {\n    var value = element.get(p.name),\n        isReference = p.isReference,\n        isMany = p.isMany;\n\n    if (!isMany) {\n      value = [ value ];\n    }\n\n    if (p.isBody) {\n      body.push(new BodySerializer().build(p, value[0]));\n    } else\n    if (isSimpleType(p.type)) {\n      forEach(value, function(v) {\n        body.push(new ValueSerializer(self.addTagName(self.nsPropertyTagName(p))).build(p, v));\n      });\n    } else\n    if (isReference) {\n      forEach(value, function(v) {\n        body.push(new ReferenceSerializer(self.addTagName(self.nsPropertyTagName(p))).build(v));\n      });\n    } else {\n\n      // allow serialization via type\n      // rather than element name\n      var asType = serializeAsType(p),\n          asProperty = serializeAsProperty(p);\n\n      forEach(value, function(v) {\n        var serializer;\n\n        if (asType) {\n          serializer = new TypeSerializer(self, p);\n        } else\n        if (asProperty) {\n          serializer = new ElementSerializer(self, p);\n        } else {\n          serializer = new ElementSerializer(self);\n        }\n\n        body.push(serializer.build(v));\n      });\n    }\n  });\n};\n\nElementSerializer.prototype.getNamespaces = function(local) {\n\n  var namespaces = this.namespaces,\n      parent = this.parent,\n      parentNamespaces;\n\n  if (!namespaces) {\n    parentNamespaces = parent && parent.getNamespaces();\n\n    if (local || !parentNamespaces) {\n      this.namespaces = namespaces = new Namespaces(parentNamespaces);\n    } else {\n      namespaces = parentNamespaces;\n    }\n  }\n\n  return namespaces;\n};\n\nElementSerializer.prototype.logNamespace = function(ns, wellknown, local) {\n  var namespaces = this.getNamespaces(local);\n\n  var nsUri = ns.uri,\n      nsPrefix = ns.prefix;\n\n  var existing = namespaces.byUri(nsUri);\n\n  if (!existing || local) {\n    namespaces.add(ns, wellknown);\n  }\n\n  namespaces.mapPrefix(nsPrefix, nsUri);\n\n  return ns;\n};\n\nElementSerializer.prototype.logNamespaceUsed = function(ns, local) {\n  var element = this.element,\n      model = element.$model,\n      namespaces = this.getNamespaces(local);\n\n  // ns may be\n  //\n  //   * prefix only\n  //   * prefix:uri\n  //   * localName only\n\n  var prefix = ns.prefix,\n      uri = ns.uri,\n      newPrefix, idx,\n      wellknownUri;\n\n  // handle anonymous namespaces (elementForm=unqualified), cf. #23\n  if (!prefix && !uri) {\n    return { localName: ns.localName };\n  }\n\n  wellknownUri = DEFAULT_NS_MAP[prefix] || model && (model.getPackage(prefix) || {}).uri;\n\n  uri = uri || wellknownUri || namespaces.uriByPrefix(prefix);\n\n  if (!uri) {\n    throw new Error('no namespace uri given for prefix <' + prefix + '>');\n  }\n\n  ns = namespaces.byUri(uri);\n\n  if (!ns) {\n    newPrefix = prefix;\n    idx = 1;\n\n    // find a prefix that is not mapped yet\n    while (namespaces.uriByPrefix(newPrefix)) {\n      newPrefix = prefix + '_' + idx++;\n    }\n\n    ns = this.logNamespace({ prefix: newPrefix, uri: uri }, wellknownUri === uri);\n  }\n\n  if (prefix) {\n    namespaces.mapPrefix(prefix, uri);\n  }\n\n  return ns;\n};\n\nElementSerializer.prototype.parseAttributes = function(properties) {\n  var self = this,\n      element = this.element;\n\n  forEach(properties, function(p) {\n\n    var value = element.get(p.name);\n\n    if (p.isReference) {\n\n      if (!p.isMany) {\n        value = value.id;\n      }\n      else {\n        var values = [];\n        forEach(value, function(v) {\n          values.push(v.id);\n        });\n\n        // IDREFS is a whitespace-separated list of references.\n        value = values.join(' ');\n      }\n\n    }\n\n    self.addAttribute(self.nsAttributeName(p), value);\n  });\n};\n\nElementSerializer.prototype.addTagName = function(nsTagName) {\n  var actualNs = this.logNamespaceUsed(nsTagName);\n\n  this.getNamespaces().logUsed(actualNs);\n\n  return nsName(nsTagName);\n};\n\nElementSerializer.prototype.addAttribute = function(name, value) {\n  var attrs = this.attrs;\n\n  if (isString(value)) {\n    value = escapeAttr(value);\n  }\n\n  // de-duplicate attributes\n  // https://github.com/bpmn-io/moddle-xml/issues/66\n  var idx = findIndex(attrs, function(element) {\n    return (\n      element.name.localName === name.localName &&\n      element.name.uri === name.uri &&\n      element.name.prefix === name.prefix\n    );\n  });\n\n  var attr = { name: name, value: value };\n\n  if (idx !== -1) {\n    attrs.splice(idx, 1, attr);\n  } else {\n    attrs.push(attr);\n  }\n};\n\nElementSerializer.prototype.serializeAttributes = function(writer) {\n  var attrs = this.attrs,\n      namespaces = this.namespaces;\n\n  if (namespaces) {\n    attrs = getNsAttrs(namespaces).concat(attrs);\n  }\n\n  forEach(attrs, function(a) {\n    writer\n      .append(' ')\n      .append(nsName(a.name)).append('=\"').append(a.value).append('\"');\n  });\n};\n\nElementSerializer.prototype.serializeTo = function(writer) {\n  var firstBody = this.body[0],\n      indent = firstBody && firstBody.constructor !== BodySerializer;\n\n  writer\n    .appendIndent()\n    .append('<' + this.tagName);\n\n  this.serializeAttributes(writer);\n\n  writer.append(firstBody ? '>' : ' />');\n\n  if (firstBody) {\n\n    if (indent) {\n      writer\n        .appendNewLine()\n        .indent();\n    }\n\n    forEach(this.body, function(b) {\n      b.serializeTo(writer);\n    });\n\n    if (indent) {\n      writer\n        .unindent()\n        .appendIndent();\n    }\n\n    writer.append('</' + this.tagName + '>');\n  }\n\n  writer.appendNewLine();\n};\n\n/**\n * A serializer for types that handles serialization of data types\n */\nfunction TypeSerializer(parent, propertyDescriptor) {\n  ElementSerializer.call(this, parent, propertyDescriptor);\n}\n\ninherits(TypeSerializer, ElementSerializer);\n\nTypeSerializer.prototype.parseNsAttributes = function(element) {\n\n  // extracted attributes\n  var attributes = ElementSerializer.prototype.parseNsAttributes.call(this, element);\n\n  var descriptor = element.$descriptor;\n\n  // only serialize xsi:type if necessary\n  if (descriptor.name === this.propertyDescriptor.type) {\n    return attributes;\n  }\n\n  var typeNs = this.typeNs = this.nsTagName(descriptor);\n  this.getNamespaces().logUsed(this.typeNs);\n\n  // add xsi:type attribute to represent the elements\n  // actual type\n\n  var pkg = element.$model.getPackage(typeNs.uri),\n      typePrefix = (pkg.xml && pkg.xml.typePrefix) || '';\n\n  this.addAttribute(\n    this.nsAttributeName(XSI_TYPE),\n    (typeNs.prefix ? typeNs.prefix + ':' : '') + typePrefix + descriptor.ns.localName\n  );\n\n  return attributes;\n};\n\nTypeSerializer.prototype.isLocalNs = function(ns) {\n  return ns.uri === (this.typeNs || this.ns).uri;\n};\n\nfunction SavingWriter() {\n  this.value = '';\n\n  this.write = function(str) {\n    this.value += str;\n  };\n}\n\nfunction FormatingWriter(out, format) {\n\n  var indent = [ '' ];\n\n  this.append = function(str) {\n    out.write(str);\n\n    return this;\n  };\n\n  this.appendNewLine = function() {\n    if (format) {\n      out.write('\\n');\n    }\n\n    return this;\n  };\n\n  this.appendIndent = function() {\n    if (format) {\n      out.write(indent.join('  '));\n    }\n\n    return this;\n  };\n\n  this.indent = function() {\n    indent.push('');\n    return this;\n  };\n\n  this.unindent = function() {\n    indent.pop();\n    return this;\n  };\n}\n\n/**\n * A writer for meta-model backed document trees\n *\n * @param {Object} options output options to pass into the writer\n */\nfunction Writer(options) {\n\n  options = assign({ format: false, preamble: true }, options || {});\n\n  function toXML(tree, writer) {\n    var internalWriter = writer || new SavingWriter();\n    var formatingWriter = new FormatingWriter(internalWriter, options.format);\n\n    if (options.preamble) {\n      formatingWriter.append(XML_PREAMBLE);\n    }\n\n    new ElementSerializer().build(tree).serializeTo(formatingWriter);\n\n    if (!writer) {\n      return internalWriter.value;\n    }\n  }\n\n  return {\n    toXML: toXML\n  };\n}\n\nexport { Reader, Writer };\n//# sourceMappingURL=index.esm.js.map\n","import { isString, assign } from 'min-dash';\nimport { Moddle } from 'moddle';\nimport { Reader, Writer } from 'moddle-xml';\n\n/**\n * A sub class of {@link Moddle} with support for import and export of BPMN 2.0 xml files.\n *\n * @class BpmnModdle\n * @extends Moddle\n *\n * @param {Object|Array} packages to use for instantiating the model\n * @param {Object} [options] additional options to pass over\n */\nfunction BpmnModdle(packages, options) {\n  Moddle.call(this, packages, options);\n}\n\nBpmnModdle.prototype = Object.create(Moddle.prototype);\n\n/**\n * The fromXML result.\n *\n * @typedef {Object} ParseResult\n *\n * @property {ModdleElement} rootElement\n * @property {Array<Object>} references\n * @property {Array<Error>} warnings\n * @property {Object} elementsById - a mapping containing each ID -> ModdleElement\n */\n\n/**\n * The fromXML error.\n *\n * @typedef {Error} ParseError\n *\n * @property {Array<Error>} warnings\n */\n\n/**\n * Instantiates a BPMN model tree from a given xml string.\n *\n * @param {String}   xmlStr\n * @param {String}   [typeName='bpmn:Definitions'] name of the root element\n * @param {Object}   [options]  options to pass to the underlying reader\n *\n * @returns {Promise<ParseResult, ParseError>}\n */\nBpmnModdle.prototype.fromXML = function(xmlStr, typeName, options) {\n\n  if (!isString(typeName)) {\n    options = typeName;\n    typeName = 'bpmn:Definitions';\n  }\n\n  var reader = new Reader(assign({ model: this, lax: true }, options));\n  var rootHandler = reader.handler(typeName);\n\n  return reader.fromXML(xmlStr, rootHandler);\n};\n\n\n/**\n * The toXML result.\n *\n * @typedef {Object} SerializationResult\n *\n * @property {String} xml\n */\n\n/**\n * Serializes a BPMN 2.0 object tree to XML.\n *\n * @param {String}   element    the root element, typically an instance of `bpmn:Definitions`\n * @param {Object}   [options]  to pass to the underlying writer\n *\n * @returns {Promise<SerializationResult, Error>}\n */\nBpmnModdle.prototype.toXML = function(element, options) {\n\n  var writer = new Writer(options);\n\n  return new Promise(function(resolve, reject) {\n    try {\n      var result = writer.toXML(element);\n\n      return resolve({\n        xml: result\n      });\n    } catch (err) {\n      return reject(err);\n    }\n  });\n};\n\nvar name$5 = \"BPMN20\";\nvar uri$5 = \"http://www.omg.org/spec/BPMN/20100524/MODEL\";\nvar prefix$5 = \"bpmn\";\nvar associations$5 = [\n];\nvar types$5 = [\n\t{\n\t\tname: \"Interface\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operations\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"implementationRef\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Operation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inMessageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outMessageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"errorRef\",\n\t\t\t\ttype: \"Error\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"implementationRef\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"EndPoint\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Auditing\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalTask\",\n\t\tsuperClass: [\n\t\t\t\"CallableElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"resources\",\n\t\t\t\ttype: \"ResourceRole\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Monitoring\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Performer\",\n\t\tsuperClass: [\n\t\t\t\"ResourceRole\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Process\",\n\t\tsuperClass: [\n\t\t\t\"FlowElementsContainer\",\n\t\t\t\"CallableElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"processType\",\n\t\t\t\ttype: \"ProcessType\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isClosed\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"auditing\",\n\t\t\t\ttype: \"Auditing\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"monitoring\",\n\t\t\t\ttype: \"Monitoring\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"properties\",\n\t\t\t\ttype: \"Property\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"laneSets\",\n\t\t\t\tisMany: true,\n\t\t\t\treplaces: \"FlowElementsContainer#laneSets\",\n\t\t\t\ttype: \"LaneSet\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"flowElements\",\n\t\t\t\tisMany: true,\n\t\t\t\treplaces: \"FlowElementsContainer#flowElements\",\n\t\t\t\ttype: \"FlowElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"artifacts\",\n\t\t\t\ttype: \"Artifact\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resources\",\n\t\t\t\ttype: \"ResourceRole\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationSubscriptions\",\n\t\t\t\ttype: \"CorrelationSubscription\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"supports\",\n\t\t\t\ttype: \"Process\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"definitionalCollaborationRef\",\n\t\t\t\ttype: \"Collaboration\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isExecutable\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LaneSet\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"lanes\",\n\t\t\t\ttype: \"Lane\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Lane\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"partitionElementRef\",\n\t\t\t\ttype: \"BaseElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"partitionElement\",\n\t\t\t\ttype: \"BaseElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"flowNodeRef\",\n\t\t\t\ttype: \"FlowNode\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"childLaneSet\",\n\t\t\t\ttype: \"LaneSet\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalManualTask\",\n\t\tsuperClass: [\n\t\t\t\"GlobalTask\"\n\t\t]\n\t},\n\t{\n\t\tname: \"ManualTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t]\n\t},\n\t{\n\t\tname: \"UserTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"renderings\",\n\t\t\t\ttype: \"Rendering\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Rendering\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"HumanPerformer\",\n\t\tsuperClass: [\n\t\t\t\"Performer\"\n\t\t]\n\t},\n\t{\n\t\tname: \"PotentialOwner\",\n\t\tsuperClass: [\n\t\t\t\"HumanPerformer\"\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalUserTask\",\n\t\tsuperClass: [\n\t\t\t\"GlobalTask\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"renderings\",\n\t\t\t\ttype: \"Rendering\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Gateway\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"gatewayDirection\",\n\t\t\t\ttype: \"GatewayDirection\",\n\t\t\t\t\"default\": \"Unspecified\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"EventBasedGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"instantiate\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventGatewayType\",\n\t\t\t\ttype: \"EventBasedGatewayType\",\n\t\t\t\tisAttr: true,\n\t\t\t\t\"default\": \"Exclusive\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ComplexGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"activationCondition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"default\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ExclusiveGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"default\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"InclusiveGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"default\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ParallelGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t]\n\t},\n\t{\n\t\tname: \"RootElement\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Relationship\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"type\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"direction\",\n\t\t\t\ttype: \"RelationshipDirection\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"source\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"target\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"BaseElement\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"id\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\",\n\t\t\t\tisId: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"documentation\",\n\t\t\t\ttype: \"Documentation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionDefinitions\",\n\t\t\t\ttype: \"ExtensionDefinition\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionElements\",\n\t\t\t\ttype: \"ExtensionElements\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Extension\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"mustUnderstand\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"definition\",\n\t\t\t\ttype: \"ExtensionDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ExtensionDefinition\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionAttributeDefinitions\",\n\t\t\t\ttype: \"ExtensionAttributeDefinition\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ExtensionAttributeDefinition\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"type\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isReference\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionDefinition\",\n\t\t\t\ttype: \"ExtensionDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ExtensionElements\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"valueRef\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"values\",\n\t\t\t\ttype: \"Element\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionAttributeDefinition\",\n\t\t\t\ttype: \"ExtensionAttributeDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Documentation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"text\",\n\t\t\t\ttype: \"String\",\n\t\t\t\tisBody: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"textFormat\",\n\t\t\t\t\"default\": \"text/plain\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Event\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowNode\",\n\t\t\t\"InteractionNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"properties\",\n\t\t\t\ttype: \"Property\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"IntermediateCatchEvent\",\n\t\tsuperClass: [\n\t\t\t\"CatchEvent\"\n\t\t]\n\t},\n\t{\n\t\tname: \"IntermediateThrowEvent\",\n\t\tsuperClass: [\n\t\t\t\"ThrowEvent\"\n\t\t]\n\t},\n\t{\n\t\tname: \"EndEvent\",\n\t\tsuperClass: [\n\t\t\t\"ThrowEvent\"\n\t\t]\n\t},\n\t{\n\t\tname: \"StartEvent\",\n\t\tsuperClass: [\n\t\t\t\"CatchEvent\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isInterrupting\",\n\t\t\t\t\"default\": true,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ThrowEvent\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Event\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataInputs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataInputAssociations\",\n\t\t\t\ttype: \"DataInputAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSet\",\n\t\t\t\ttype: \"InputSet\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventDefinitions\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventDefinitionRef\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CatchEvent\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Event\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"parallelMultiple\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\t\"default\": false\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataOutputs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataOutputAssociations\",\n\t\t\t\ttype: \"DataOutputAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSet\",\n\t\t\t\ttype: \"OutputSet\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventDefinitions\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventDefinitionRef\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"BoundaryEvent\",\n\t\tsuperClass: [\n\t\t\t\"CatchEvent\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"cancelActivity\",\n\t\t\t\t\"default\": true,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"attachedToRef\",\n\t\t\t\ttype: \"Activity\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"EventDefinition\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"CancelEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t]\n\t},\n\t{\n\t\tname: \"ErrorEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"errorRef\",\n\t\t\t\ttype: \"Error\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"TerminateEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t]\n\t},\n\t{\n\t\tname: \"EscalationEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"escalationRef\",\n\t\t\t\ttype: \"Escalation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Escalation\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"structureRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"escalationCode\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"CompensateEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"waitForCompletion\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\t\"default\": true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"activityRef\",\n\t\t\t\ttype: \"Activity\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"TimerEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"timeDate\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"timeCycle\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"timeDuration\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LinkEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"target\",\n\t\t\t\ttype: \"LinkEventDefinition\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"source\",\n\t\t\t\ttype: \"LinkEventDefinition\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MessageEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ConditionalEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"condition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"SignalEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"signalRef\",\n\t\t\t\ttype: \"Signal\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Signal\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"structureRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ImplicitThrowEvent\",\n\t\tsuperClass: [\n\t\t\t\"ThrowEvent\"\n\t\t]\n\t},\n\t{\n\t\tname: \"DataState\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ItemAwareElement\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"itemSubjectRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataState\",\n\t\t\t\ttype: \"DataState\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataAssociation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"ItemAwareElement\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"ItemAwareElement\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"transformation\",\n\t\t\t\ttype: \"FormalExpression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"assignment\",\n\t\t\t\ttype: \"Assignment\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataInput\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isCollection\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSetRef\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSetWithOptional\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSetWithWhileExecuting\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataOutput\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isCollection\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSetRef\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSetWithOptional\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSetWithWhileExecuting\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"InputSet\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataInputRefs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"optionalInputRefs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"whileExecutingInputRefs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSetRefs\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"OutputSet\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataOutputRefs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSetRefs\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"optionalOutputRefs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"whileExecutingOutputRefs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Property\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataInputAssociation\",\n\t\tsuperClass: [\n\t\t\t\"DataAssociation\"\n\t\t]\n\t},\n\t{\n\t\tname: \"DataOutputAssociation\",\n\t\tsuperClass: [\n\t\t\t\"DataAssociation\"\n\t\t]\n\t},\n\t{\n\t\tname: \"InputOutputSpecification\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataInputs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataOutputs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSets\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSets\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataObject\",\n\t\tsuperClass: [\n\t\t\t\"FlowElement\",\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isCollection\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"InputOutputBinding\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"inputDataRef\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputDataRef\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Assignment\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"from\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"to\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataStore\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\",\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"capacity\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isUnlimited\",\n\t\t\t\t\"default\": true,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataStoreReference\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\",\n\t\t\t\"FlowElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataStoreRef\",\n\t\t\t\ttype: \"DataStore\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataObjectReference\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\",\n\t\t\t\"FlowElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataObjectRef\",\n\t\t\t\ttype: \"DataObject\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ConversationLink\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"InteractionNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"InteractionNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ConversationAssociation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"innerConversationNodeRef\",\n\t\t\t\ttype: \"ConversationNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outerConversationNodeRef\",\n\t\t\t\ttype: \"ConversationNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CallConversation\",\n\t\tsuperClass: [\n\t\t\t\"ConversationNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"calledCollaborationRef\",\n\t\t\t\ttype: \"Collaboration\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantAssociations\",\n\t\t\t\ttype: \"ParticipantAssociation\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Conversation\",\n\t\tsuperClass: [\n\t\t\t\"ConversationNode\"\n\t\t]\n\t},\n\t{\n\t\tname: \"SubConversation\",\n\t\tsuperClass: [\n\t\t\t\"ConversationNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"conversationNodes\",\n\t\t\t\ttype: \"ConversationNode\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ConversationNode\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"InteractionNode\",\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageFlowRefs\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationKeys\",\n\t\t\t\ttype: \"CorrelationKey\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalConversation\",\n\t\tsuperClass: [\n\t\t\t\"Collaboration\"\n\t\t]\n\t},\n\t{\n\t\tname: \"PartnerEntity\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"PartnerRole\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationProperty\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"correlationPropertyRetrievalExpression\",\n\t\t\t\ttype: \"CorrelationPropertyRetrievalExpression\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"type\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Error\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"structureRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"errorCode\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationKey\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"correlationPropertyRef\",\n\t\t\t\ttype: \"CorrelationProperty\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Expression\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tisAbstract: false,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"body\",\n\t\t\t\tisBody: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"FormalExpression\",\n\t\tsuperClass: [\n\t\t\t\"Expression\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"language\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"evaluatesToTypeRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Message\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"itemRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ItemDefinition\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"itemKind\",\n\t\t\t\ttype: \"ItemKind\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"structureRef\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isCollection\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"import\",\n\t\t\t\ttype: \"Import\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"FlowElement\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"auditing\",\n\t\t\t\ttype: \"Auditing\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"monitoring\",\n\t\t\t\ttype: \"Monitoring\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"categoryValueRef\",\n\t\t\t\ttype: \"CategoryValue\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"SequenceFlow\",\n\t\tsuperClass: [\n\t\t\t\"FlowElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isImmediate\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"conditionExpression\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"FlowNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"FlowNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"FlowElementsContainer\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"laneSets\",\n\t\t\t\ttype: \"LaneSet\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"flowElements\",\n\t\t\t\ttype: \"FlowElement\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CallableElement\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ioSpecification\",\n\t\t\t\ttype: \"InputOutputSpecification\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"supportedInterfaceRef\",\n\t\t\t\ttype: \"Interface\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ioBinding\",\n\t\t\t\ttype: \"InputOutputBinding\",\n\t\t\t\tisMany: true,\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"FlowNode\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"incoming\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outgoing\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"lanes\",\n\t\t\t\ttype: \"Lane\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationPropertyRetrievalExpression\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"messagePath\",\n\t\t\t\ttype: \"FormalExpression\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationPropertyBinding\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataPath\",\n\t\t\t\ttype: \"FormalExpression\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationPropertyRef\",\n\t\t\t\ttype: \"CorrelationProperty\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Resource\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resourceParameters\",\n\t\t\t\ttype: \"ResourceParameter\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ResourceParameter\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isRequired\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"type\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationSubscription\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"correlationKeyRef\",\n\t\t\t\ttype: \"CorrelationKey\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationPropertyBinding\",\n\t\t\t\ttype: \"CorrelationPropertyBinding\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MessageFlow\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"InteractionNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"InteractionNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MessageFlowAssociation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"innerMessageFlowRef\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outerMessageFlowRef\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"InteractionNode\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"incomingConversationLinks\",\n\t\t\t\ttype: \"ConversationLink\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outgoingConversationLinks\",\n\t\t\t\ttype: \"ConversationLink\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Participant\",\n\t\tsuperClass: [\n\t\t\t\"InteractionNode\",\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"interfaceRef\",\n\t\t\t\ttype: \"Interface\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantMultiplicity\",\n\t\t\t\ttype: \"ParticipantMultiplicity\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"endPointRefs\",\n\t\t\t\ttype: \"EndPoint\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"processRef\",\n\t\t\t\ttype: \"Process\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ParticipantAssociation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"innerParticipantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outerParticipantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ParticipantMultiplicity\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"minimum\",\n\t\t\t\t\"default\": 0,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"maximum\",\n\t\t\t\t\"default\": 1,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Collaboration\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isClosed\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participants\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageFlows\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"artifacts\",\n\t\t\t\ttype: \"Artifact\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"conversations\",\n\t\t\t\ttype: \"ConversationNode\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"conversationAssociations\",\n\t\t\t\ttype: \"ConversationAssociation\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantAssociations\",\n\t\t\t\ttype: \"ParticipantAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageFlowAssociations\",\n\t\t\t\ttype: \"MessageFlowAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationKeys\",\n\t\t\t\ttype: \"CorrelationKey\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"choreographyRef\",\n\t\t\t\ttype: \"Choreography\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"conversationLinks\",\n\t\t\t\ttype: \"ConversationLink\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ChoreographyActivity\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"participantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"initiatingParticipantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationKeys\",\n\t\t\t\ttype: \"CorrelationKey\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopType\",\n\t\t\t\ttype: \"ChoreographyLoopType\",\n\t\t\t\t\"default\": \"None\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CallChoreography\",\n\t\tsuperClass: [\n\t\t\t\"ChoreographyActivity\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"calledChoreographyRef\",\n\t\t\t\ttype: \"Choreography\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantAssociations\",\n\t\t\t\ttype: \"ParticipantAssociation\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"SubChoreography\",\n\t\tsuperClass: [\n\t\t\t\"ChoreographyActivity\",\n\t\t\t\"FlowElementsContainer\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"artifacts\",\n\t\t\t\ttype: \"Artifact\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ChoreographyTask\",\n\t\tsuperClass: [\n\t\t\t\"ChoreographyActivity\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"messageFlowRef\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Choreography\",\n\t\tsuperClass: [\n\t\t\t\"Collaboration\",\n\t\t\t\"FlowElementsContainer\"\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalChoreographyTask\",\n\t\tsuperClass: [\n\t\t\t\"Choreography\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"initiatingParticipantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"TextAnnotation\",\n\t\tsuperClass: [\n\t\t\t\"Artifact\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"text\",\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"textFormat\",\n\t\t\t\t\"default\": \"text/plain\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Group\",\n\t\tsuperClass: [\n\t\t\t\"Artifact\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"categoryValueRef\",\n\t\t\t\ttype: \"CategoryValue\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Association\",\n\t\tsuperClass: [\n\t\t\t\"Artifact\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"associationDirection\",\n\t\t\t\ttype: \"AssociationDirection\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"BaseElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"BaseElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Category\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"categoryValue\",\n\t\t\t\ttype: \"CategoryValue\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Artifact\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"CategoryValue\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"categorizedFlowElements\",\n\t\t\t\ttype: \"FlowElement\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"value\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Activity\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isForCompensation\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"default\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ioSpecification\",\n\t\t\t\ttype: \"InputOutputSpecification\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"boundaryEventRefs\",\n\t\t\t\ttype: \"BoundaryEvent\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"properties\",\n\t\t\t\ttype: \"Property\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataInputAssociations\",\n\t\t\t\ttype: \"DataInputAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataOutputAssociations\",\n\t\t\t\ttype: \"DataOutputAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"startQuantity\",\n\t\t\t\t\"default\": 1,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resources\",\n\t\t\t\ttype: \"ResourceRole\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"completionQuantity\",\n\t\t\t\t\"default\": 1,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopCharacteristics\",\n\t\t\t\ttype: \"LoopCharacteristics\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ServiceTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"SubProcess\",\n\t\tsuperClass: [\n\t\t\t\"Activity\",\n\t\t\t\"FlowElementsContainer\",\n\t\t\t\"InteractionNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"triggeredByEvent\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"artifacts\",\n\t\t\t\ttype: \"Artifact\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LoopCharacteristics\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"MultiInstanceLoopCharacteristics\",\n\t\tsuperClass: [\n\t\t\t\"LoopCharacteristics\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isSequential\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"behavior\",\n\t\t\t\ttype: \"MultiInstanceBehavior\",\n\t\t\t\t\"default\": \"All\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopCardinality\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopDataInputRef\",\n\t\t\t\ttype: \"ItemAwareElement\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopDataOutputRef\",\n\t\t\t\ttype: \"ItemAwareElement\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputDataItem\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputDataItem\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"complexBehaviorDefinition\",\n\t\t\t\ttype: \"ComplexBehaviorDefinition\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"completionCondition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"oneBehaviorEventRef\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"noneBehaviorEventRef\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"StandardLoopCharacteristics\",\n\t\tsuperClass: [\n\t\t\t\"LoopCharacteristics\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"testBefore\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopCondition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopMaximum\",\n\t\t\t\ttype: \"Integer\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CallActivity\",\n\t\tsuperClass: [\n\t\t\t\"Activity\",\n\t\t\t\"InteractionNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"calledElement\",\n\t\t\t\ttype: \"String\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Task\",\n\t\tsuperClass: [\n\t\t\t\"Activity\",\n\t\t\t\"InteractionNode\"\n\t\t]\n\t},\n\t{\n\t\tname: \"SendTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ReceiveTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"instantiate\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ScriptTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"scriptFormat\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"script\",\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"BusinessRuleTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"AdHocSubProcess\",\n\t\tsuperClass: [\n\t\t\t\"SubProcess\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"completionCondition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ordering\",\n\t\t\t\ttype: \"AdHocOrdering\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"cancelRemainingInstances\",\n\t\t\t\t\"default\": true,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Transaction\",\n\t\tsuperClass: [\n\t\t\t\"SubProcess\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"protocol\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"method\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalScriptTask\",\n\t\tsuperClass: [\n\t\t\t\"GlobalTask\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"scriptLanguage\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"script\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalBusinessRuleTask\",\n\t\tsuperClass: [\n\t\t\t\"GlobalTask\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ComplexBehaviorDefinition\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"condition\",\n\t\t\t\ttype: \"FormalExpression\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"event\",\n\t\t\t\ttype: \"ImplicitThrowEvent\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ResourceRole\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"resourceRef\",\n\t\t\t\ttype: \"Resource\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resourceParameterBindings\",\n\t\t\t\ttype: \"ResourceParameterBinding\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resourceAssignmentExpression\",\n\t\t\t\ttype: \"ResourceAssignmentExpression\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ResourceParameterBinding\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"expression\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"parameterRef\",\n\t\t\t\ttype: \"ResourceParameter\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"ResourceAssignmentExpression\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"expression\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Import\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"importType\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"location\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"namespace\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Definitions\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetNamespace\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"expressionLanguage\",\n\t\t\t\t\"default\": \"http://www.w3.org/1999/XPath\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"typeLanguage\",\n\t\t\t\t\"default\": \"http://www.w3.org/2001/XMLSchema\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"imports\",\n\t\t\t\ttype: \"Import\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensions\",\n\t\t\t\ttype: \"Extension\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"rootElements\",\n\t\t\t\ttype: \"RootElement\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"diagrams\",\n\t\t\t\tisMany: true,\n\t\t\t\ttype: \"bpmndi:BPMNDiagram\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"exporter\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"relationships\",\n\t\t\t\ttype: \"Relationship\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"exporterVersion\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar enumerations$3 = [\n\t{\n\t\tname: \"ProcessType\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Public\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Private\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GatewayDirection\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"Unspecified\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Converging\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Diverging\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Mixed\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"EventBasedGatewayType\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"Parallel\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Exclusive\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"RelationshipDirection\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Forward\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Backward\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Both\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ItemKind\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"Physical\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Information\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ChoreographyLoopType\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Standard\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"MultiInstanceSequential\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"MultiInstanceParallel\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"AssociationDirection\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"One\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Both\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MultiInstanceBehavior\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"One\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"All\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Complex\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"AdHocOrdering\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"Parallel\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Sequential\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar xml$1 = {\n\ttagAlias: \"lowerCase\",\n\ttypePrefix: \"t\"\n};\nvar BpmnPackage = {\n\tname: name$5,\n\turi: uri$5,\n\tprefix: prefix$5,\n\tassociations: associations$5,\n\ttypes: types$5,\n\tenumerations: enumerations$3,\n\txml: xml$1\n};\n\nvar name$4 = \"BPMNDI\";\nvar uri$4 = \"http://www.omg.org/spec/BPMN/20100524/DI\";\nvar prefix$4 = \"bpmndi\";\nvar types$4 = [\n\t{\n\t\tname: \"BPMNDiagram\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"plane\",\n\t\t\t\ttype: \"BPMNPlane\",\n\t\t\t\tredefines: \"di:Diagram#rootElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"labelStyle\",\n\t\t\t\ttype: \"BPMNLabelStyle\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:Diagram\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNPlane\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"bpmnElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"bpmn:BaseElement\",\n\t\t\t\tredefines: \"di:DiagramElement#modelElement\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:Plane\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNShape\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"bpmnElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"bpmn:BaseElement\",\n\t\t\t\tredefines: \"di:DiagramElement#modelElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isHorizontal\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isExpanded\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isMarkerVisible\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"label\",\n\t\t\t\ttype: \"BPMNLabel\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isMessageVisible\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantBandKind\",\n\t\t\t\ttype: \"ParticipantBandKind\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"choreographyActivityShape\",\n\t\t\t\ttype: \"BPMNShape\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:LabeledShape\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNEdge\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"label\",\n\t\t\t\ttype: \"BPMNLabel\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"bpmnElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"bpmn:BaseElement\",\n\t\t\t\tredefines: \"di:DiagramElement#modelElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"sourceElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"di:DiagramElement\",\n\t\t\t\tredefines: \"di:Edge#source\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"di:DiagramElement\",\n\t\t\t\tredefines: \"di:Edge#target\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageVisibleKind\",\n\t\t\t\ttype: \"MessageVisibleKind\",\n\t\t\t\tisAttr: true,\n\t\t\t\t\"default\": \"initiating\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:LabeledEdge\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNLabel\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"labelStyle\",\n\t\t\t\ttype: \"BPMNLabelStyle\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\tredefines: \"di:DiagramElement#style\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:Label\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNLabelStyle\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"font\",\n\t\t\t\ttype: \"dc:Font\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:Style\"\n\t\t]\n\t}\n];\nvar enumerations$2 = [\n\t{\n\t\tname: \"ParticipantBandKind\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"top_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"middle_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"bottom_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"top_non_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"middle_non_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"bottom_non_initiating\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MessageVisibleKind\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"non_initiating\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar associations$4 = [\n];\nvar BpmnDiPackage = {\n\tname: name$4,\n\turi: uri$4,\n\tprefix: prefix$4,\n\ttypes: types$4,\n\tenumerations: enumerations$2,\n\tassociations: associations$4\n};\n\nvar name$3 = \"DC\";\nvar uri$3 = \"http://www.omg.org/spec/DD/20100524/DC\";\nvar prefix$3 = \"dc\";\nvar types$3 = [\n\t{\n\t\tname: \"Boolean\"\n\t},\n\t{\n\t\tname: \"Integer\"\n\t},\n\t{\n\t\tname: \"Real\"\n\t},\n\t{\n\t\tname: \"String\"\n\t},\n\t{\n\t\tname: \"Font\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\ttype: \"String\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"size\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isBold\",\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isItalic\",\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isUnderline\",\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isStrikeThrough\",\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Point\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"x\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\t\"default\": \"0\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"y\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\t\"default\": \"0\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Bounds\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"x\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\t\"default\": \"0\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"y\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\t\"default\": \"0\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"width\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"height\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t}\n];\nvar associations$3 = [\n];\nvar DcPackage = {\n\tname: name$3,\n\turi: uri$3,\n\tprefix: prefix$3,\n\ttypes: types$3,\n\tassociations: associations$3\n};\n\nvar name$2 = \"DI\";\nvar uri$2 = \"http://www.omg.org/spec/DD/20100524/DI\";\nvar prefix$2 = \"di\";\nvar types$2 = [\n\t{\n\t\tname: \"DiagramElement\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"id\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisId: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extension\",\n\t\t\t\ttype: \"Extension\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"owningDiagram\",\n\t\t\t\ttype: \"Diagram\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"owningElement\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"modelElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"style\",\n\t\t\t\ttype: \"Style\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ownedElement\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Node\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"DiagramElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Edge\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"DiagramElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"source\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"target\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"waypoint\",\n\t\t\t\tisUnique: false,\n\t\t\t\tisMany: true,\n\t\t\t\ttype: \"dc:Point\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Diagram\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"id\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisId: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"rootElement\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"documentation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resolution\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Real\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ownedStyle\",\n\t\t\t\ttype: \"Style\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Shape\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Node\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"bounds\",\n\t\t\t\ttype: \"dc:Bounds\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Plane\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Node\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"planeElement\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tsubsettedProperty: \"DiagramElement-ownedElement\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LabeledEdge\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Edge\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"ownedLabel\",\n\t\t\t\ttype: \"Label\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tsubsettedProperty: \"DiagramElement-ownedElement\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LabeledShape\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Shape\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"ownedLabel\",\n\t\t\t\ttype: \"Label\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tsubsettedProperty: \"DiagramElement-ownedElement\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Label\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Node\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"bounds\",\n\t\t\t\ttype: \"dc:Bounds\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Style\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"id\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisId: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Extension\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"values\",\n\t\t\t\tisMany: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar associations$2 = [\n];\nvar xml = {\n\ttagAlias: \"lowerCase\"\n};\nvar DiPackage = {\n\tname: name$2,\n\turi: uri$2,\n\tprefix: prefix$2,\n\ttypes: types$2,\n\tassociations: associations$2,\n\txml: xml\n};\n\nvar name$1 = \"bpmn.io colors for BPMN\";\nvar uri$1 = \"http://bpmn.io/schema/bpmn/biocolor/1.0\";\nvar prefix$1 = \"bioc\";\nvar types$1 = [\n\t{\n\t\tname: \"ColoredShape\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNShape\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"stroke\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"fill\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ColoredEdge\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNEdge\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"stroke\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"fill\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar enumerations$1 = [\n];\nvar associations$1 = [\n];\nvar BiocPackage = {\n\tname: name$1,\n\turi: uri$1,\n\tprefix: prefix$1,\n\ttypes: types$1,\n\tenumerations: enumerations$1,\n\tassociations: associations$1\n};\n\nvar name = \"BPMN in Color\";\nvar uri = \"http://www.omg.org/spec/BPMN/non-normative/color/1.0\";\nvar prefix = \"color\";\nvar types = [\n\t{\n\t\tname: \"ColoredLabel\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNLabel\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"color\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ColoredShape\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNShape\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"background-color\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"border-color\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ColoredEdge\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNEdge\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"border-color\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar enumerations = [\n];\nvar associations = [\n];\nvar BpmnInColorPackage = {\n\tname: name,\n\turi: uri,\n\tprefix: prefix,\n\ttypes: types,\n\tenumerations: enumerations,\n\tassociations: associations\n};\n\nvar packages = {\n  bpmn: BpmnPackage,\n  bpmndi: BpmnDiPackage,\n  dc: DcPackage,\n  di: DiPackage,\n  bioc: BiocPackage,\n  color: BpmnInColorPackage\n};\n\nfunction simple(additionalPackages, options) {\n  var pks = assign({}, packages, additionalPackages);\n\n  return new BpmnModdle(pks, options);\n}\n\nexport { simple as default };\n","export function elementToString(e) {\n  if (!e) {\n    return '<null>';\n  }\n\n  return '<' + e.$type + (e.id ? ' id=\"' + e.id : '') + '\" />';\n}","import {\n  has\n} from 'min-dash';\n\n/**\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\n\n// TODO(nikku): remove with future bpmn-js version\n\nvar DI_ERROR_MESSAGE = 'Tried to access di from the businessObject. The di is available through the diagram element only. For more information, see https://github.com/bpmn-io/bpmn-js/issues/1472';\n\n/**\n * @private\n *\n * @param {ModdleElement} businessObject\n */\nexport function ensureCompatDiRef(businessObject) {\n\n  // bpmnElement can have multiple independent DIs\n  if (!has(businessObject, 'di')) {\n    Object.defineProperty(businessObject, 'di', {\n      enumerable: false,\n      get: function() {\n        throw new Error(DI_ERROR_MESSAGE);\n      }\n    });\n  }\n}","import {\n  filter,\n  find,\n  forEach\n} from 'min-dash';\n\nimport {\n  elementToString\n} from './Util';\n\nimport {\n  ensureCompatDiRef\n} from '../util/CompatibilityUtil';\n\n/**\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * Returns true if an element is of the given meta-model type.\n *\n * @param {ModdleElement} element\n * @param {string} type\n *\n * @return {boolean}\n */\nfunction is(element, type) {\n  return element.$instanceOf(type);\n}\n\n\n/**\n * Find a suitable display candidate for definitions where the DI does not\n * correctly specify one.\n *\n * @param {ModdleElement} definitions\n *\n * @return {ModdleElement}\n */\nfunction findDisplayCandidate(definitions) {\n  return find(definitions.rootElements, function(e) {\n    return is(e, 'bpmn:Process') || is(e, 'bpmn:Collaboration');\n  });\n}\n\n/**\n * @param {Record<'element' | 'root' | 'error', Function>} handler\n */\nexport default function BpmnTreeWalker(handler) {\n\n  // list of containers already walked\n  var handledElements = {};\n\n  // list of elements to handle deferred to ensure\n  // prerequisites are drawn\n  var deferred = [];\n\n  var diMap = {};\n\n  // Helpers //////////////////////\n\n  function contextual(fn, ctx) {\n    return function(e) {\n      fn(e, ctx);\n    };\n  }\n\n  function handled(element) {\n    handledElements[element.id] = element;\n  }\n\n  function isHandled(element) {\n    return handledElements[element.id];\n  }\n\n  function visit(element, ctx) {\n\n    var gfx = element.gfx;\n\n    // avoid multiple rendering of elements\n    if (gfx) {\n      throw new Error(\n        `already rendered ${ elementToString(element) }`\n      );\n    }\n\n    // call handler\n    return handler.element(element, diMap[element.id], ctx);\n  }\n\n  function visitRoot(element, diagram) {\n    return handler.root(element, diMap[element.id], diagram);\n  }\n\n  function visitIfDi(element, ctx) {\n\n    try {\n      var gfx = diMap[element.id] && visit(element, ctx);\n\n      handled(element);\n\n      return gfx;\n    } catch (error) {\n      logError(error.message, { element, error });\n\n      console.error(`failed to import ${ elementToString(element) }`, error);\n    }\n  }\n\n  function logError(message, context) {\n    handler.error(message, context);\n  }\n\n  // DI handling //////////////////////\n\n  var registerDi = this.registerDi = function registerDi(di) {\n    var bpmnElement = di.bpmnElement;\n\n    if (bpmnElement) {\n      if (diMap[bpmnElement.id]) {\n        logError(\n          `multiple DI elements defined for ${ elementToString(bpmnElement) }`,\n          { element: bpmnElement }\n        );\n      } else {\n        diMap[bpmnElement.id] = di;\n\n        ensureCompatDiRef(bpmnElement);\n      }\n    } else {\n      logError(\n        `no bpmnElement referenced in ${ elementToString(di) }`,\n        { element: di }\n      );\n    }\n  };\n\n  function handleDiagram(diagram) {\n    handlePlane(diagram.plane);\n  }\n\n  function handlePlane(plane) {\n    registerDi(plane);\n\n    forEach(plane.planeElement, handlePlaneElement);\n  }\n\n  function handlePlaneElement(planeElement) {\n    registerDi(planeElement);\n  }\n\n\n  // Semantic handling //////////////////////\n\n  /**\n   * Handle definitions and return the rendered diagram (if any).\n   *\n   * @param {ModdleElement} definitions to walk and import\n   * @param {ModdleElement} [diagram] specific diagram to import and display\n   *\n   * @throws {Error} if no diagram to display could be found\n   */\n  this.handleDefinitions = function handleDefinitions(definitions, diagram) {\n\n    // make sure we walk the correct bpmnElement\n\n    var diagrams = definitions.diagrams;\n\n    if (diagram && diagrams.indexOf(diagram) === -1) {\n      throw new Error('diagram not part of <bpmn:Definitions />');\n    }\n\n    if (!diagram && diagrams && diagrams.length) {\n      diagram = diagrams[0];\n    }\n\n    // no diagram -> nothing to import\n    if (!diagram) {\n      throw new Error('no diagram to display');\n    }\n\n    // load DI from selected diagram only\n    diMap = {};\n    handleDiagram(diagram);\n\n\n    var plane = diagram.plane;\n\n    if (!plane) {\n      throw new Error(\n        `no plane for ${ elementToString(diagram) }`\n      );\n    }\n\n    var rootElement = plane.bpmnElement;\n\n    // ensure we default to a suitable display candidate (process or collaboration),\n    // even if non is specified in DI\n    if (!rootElement) {\n      rootElement = findDisplayCandidate(definitions);\n\n      if (!rootElement) {\n        throw new Error('no process or collaboration to display');\n      } else {\n\n        logError(\n          `correcting missing bpmnElement on ${ elementToString(plane) } to ${ elementToString(rootElement) }`\n        );\n\n        // correct DI on the fly\n        plane.bpmnElement = rootElement;\n        registerDi(plane);\n      }\n    }\n\n\n    var ctx = visitRoot(rootElement, plane);\n\n    if (is(rootElement, 'bpmn:Process') || is(rootElement, 'bpmn:SubProcess')) {\n      handleProcess(rootElement, ctx);\n    } else if (is(rootElement, 'bpmn:Collaboration')) {\n      handleCollaboration(rootElement, ctx);\n\n      // force drawing of everything not yet drawn that is part of the target DI\n      handleUnhandledProcesses(definitions.rootElements, ctx);\n    } else {\n      throw new Error(\n        `unsupported bpmnElement for ${ elementToString(plane) }: ${ elementToString(rootElement) }`\n      );\n    }\n\n    // handle all deferred elements\n    handleDeferred(deferred);\n  };\n\n  var handleDeferred = this.handleDeferred = function handleDeferred() {\n\n    var fn;\n\n    // drain deferred until empty\n    while (deferred.length) {\n      fn = deferred.shift();\n\n      fn();\n    }\n  };\n\n  function handleProcess(process, context) {\n    handleFlowElementsContainer(process, context);\n    handleIoSpecification(process.ioSpecification, context);\n\n    handleArtifacts(process.artifacts, context);\n\n    // log process handled\n    handled(process);\n  }\n\n  function handleUnhandledProcesses(rootElements, ctx) {\n\n    // walk through all processes that have not yet been drawn and draw them\n    // if they contain lanes with DI information.\n    // we do this to pass the free-floating lane test cases in the MIWG test suite\n    var processes = filter(rootElements, function(e) {\n      return !isHandled(e) && is(e, 'bpmn:Process') && e.laneSets;\n    });\n\n    processes.forEach(contextual(handleProcess, ctx));\n  }\n\n  function handleMessageFlow(messageFlow, context) {\n    visitIfDi(messageFlow, context);\n  }\n\n  function handleMessageFlows(messageFlows, context) {\n    forEach(messageFlows, contextual(handleMessageFlow, context));\n  }\n\n  function handleDataAssociation(association, context) {\n    visitIfDi(association, context);\n  }\n\n  function handleDataInput(dataInput, context) {\n    visitIfDi(dataInput, context);\n  }\n\n  function handleDataOutput(dataOutput, context) {\n    visitIfDi(dataOutput, context);\n  }\n\n  function handleArtifact(artifact, context) {\n\n    // bpmn:TextAnnotation\n    // bpmn:Group\n    // bpmn:Association\n\n    visitIfDi(artifact, context);\n  }\n\n  function handleArtifacts(artifacts, context) {\n\n    forEach(artifacts, function(e) {\n      if (is(e, 'bpmn:Association')) {\n        deferred.push(function() {\n          handleArtifact(e, context);\n        });\n      } else {\n        handleArtifact(e, context);\n      }\n    });\n  }\n\n  function handleIoSpecification(ioSpecification, context) {\n\n    if (!ioSpecification) {\n      return;\n    }\n\n    forEach(ioSpecification.dataInputs, contextual(handleDataInput, context));\n    forEach(ioSpecification.dataOutputs, contextual(handleDataOutput, context));\n  }\n\n  var handleSubProcess = this.handleSubProcess = function handleSubProcess(subProcess, context) {\n    handleFlowElementsContainer(subProcess, context);\n    handleArtifacts(subProcess.artifacts, context);\n  };\n\n  function handleFlowNode(flowNode, context) {\n    var childCtx = visitIfDi(flowNode, context);\n\n    if (is(flowNode, 'bpmn:SubProcess')) {\n      handleSubProcess(flowNode, childCtx || context);\n    }\n\n    if (is(flowNode, 'bpmn:Activity')) {\n      handleIoSpecification(flowNode.ioSpecification, context);\n    }\n\n    // defer handling of associations\n    // affected types:\n    //\n    //   * bpmn:Activity\n    //   * bpmn:ThrowEvent\n    //   * bpmn:CatchEvent\n    //\n    deferred.push(function() {\n      forEach(flowNode.dataInputAssociations, contextual(handleDataAssociation, context));\n      forEach(flowNode.dataOutputAssociations, contextual(handleDataAssociation, context));\n    });\n  }\n\n  function handleSequenceFlow(sequenceFlow, context) {\n    visitIfDi(sequenceFlow, context);\n  }\n\n  function handleDataElement(dataObject, context) {\n    visitIfDi(dataObject, context);\n  }\n\n  function handleLane(lane, context) {\n\n    deferred.push(function() {\n\n      var newContext = visitIfDi(lane, context);\n\n      if (lane.childLaneSet) {\n        handleLaneSet(lane.childLaneSet, newContext || context);\n      }\n\n      wireFlowNodeRefs(lane);\n    });\n  }\n\n  function handleLaneSet(laneSet, context) {\n    forEach(laneSet.lanes, contextual(handleLane, context));\n  }\n\n  function handleLaneSets(laneSets, context) {\n    forEach(laneSets, contextual(handleLaneSet, context));\n  }\n\n  function handleFlowElementsContainer(container, context) {\n    handleFlowElements(container.flowElements, context);\n\n    if (container.laneSets) {\n      handleLaneSets(container.laneSets, context);\n    }\n  }\n\n  function handleFlowElements(flowElements, context) {\n    forEach(flowElements, function(flowElement) {\n      if (is(flowElement, 'bpmn:SequenceFlow')) {\n        deferred.push(function() {\n          handleSequenceFlow(flowElement, context);\n        });\n      } else if (is(flowElement, 'bpmn:BoundaryEvent')) {\n        deferred.unshift(function() {\n          handleFlowNode(flowElement, context);\n        });\n      } else if (is(flowElement, 'bpmn:FlowNode')) {\n        handleFlowNode(flowElement, context);\n      } else if (is(flowElement, 'bpmn:DataObject')) {\n\n        // SKIP (assume correct referencing via DataObjectReference)\n      } else if (is(flowElement, 'bpmn:DataStoreReference')) {\n        handleDataElement(flowElement, context);\n      } else if (is(flowElement, 'bpmn:DataObjectReference')) {\n        handleDataElement(flowElement, context);\n      } else {\n        logError(\n          `unrecognized flowElement ${ elementToString(flowElement) } in context ${ elementToString(context && context.businessObject) }`,\n          {\n            element: flowElement,\n            context\n          }\n        );\n      }\n    });\n  }\n\n  function handleParticipant(participant, context) {\n    var newCtx = visitIfDi(participant, context);\n\n    var process = participant.processRef;\n    if (process) {\n      handleProcess(process, newCtx || context);\n    }\n  }\n\n  function handleCollaboration(collaboration, context) {\n\n    forEach(collaboration.participants, contextual(handleParticipant, context));\n\n    handleArtifacts(collaboration.artifacts, context);\n\n    // handle message flows latest in the process\n    deferred.push(function() {\n      handleMessageFlows(collaboration.messageFlows, context);\n    });\n  }\n\n\n  function wireFlowNodeRefs(lane) {\n\n    // wire the virtual flowNodeRefs <-> relationship\n    forEach(lane.flowNodeRef, function(flowNode) {\n      var lanes = flowNode.get('lanes');\n\n      if (lanes) {\n        lanes.push(lane);\n      }\n    });\n  }\n}\n","import {\n  some\n} from 'min-dash';\n\n/**\n * @typedef { import('../model/Types').Element } Element\n * @typedef { import('../model/Types').ModdleElement } ModdleElement\n */\n\n/**\n * Is an element of the given BPMN type?\n *\n * @param  {Element|ModdleElement} element\n * @param  {string} type\n *\n * @return {boolean}\n */\nexport function is(element, type) {\n  var bo = getBusinessObject(element);\n\n  return bo && (typeof bo.$instanceOf === 'function') && bo.$instanceOf(type);\n}\n\n\n/**\n * Return true if element has any of the given types.\n *\n * @param {Element|ModdleElement} element\n * @param {string[]} types\n *\n * @return {boolean}\n */\nexport function isAny(element, types) {\n  return some(types, function(t) {\n    return is(element, t);\n  });\n}\n\n/**\n * Return the business object for a given element.\n *\n * @param {Element|ModdleElement} element\n *\n * @return {ModdleElement}\n */\nexport function getBusinessObject(element) {\n  return (element && element.businessObject) || element;\n}\n\n/**\n * Return the di object for a given element.\n *\n * @param {Element} element\n *\n * @return {ModdleElement}\n */\nexport function getDi(element) {\n  return element && element.di;\n}","import {\n  find,\n  forEach,\n  map\n} from 'min-dash';\n\nimport BpmnTreeWalker from './BpmnTreeWalker';\n\nimport { is } from '../util/ModelUtil';\n\n\n/**\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n *\n * @typedef { {\n *   warnings: string[];\n * } } ImportBPMNDiagramResult\n *\n * @typedef {ImportBPMNDiagramResult & Error} ImportBPMNDiagramError\n */\n\n/**\n * Import the definitions into a diagram.\n *\n * Errors and warnings are reported through the specified callback.\n *\n * @param {ModdleElement} diagram\n * @param {ModdleElement} definitions\n * @param {ModdleElement} [bpmnDiagram] The diagram to be rendered (if not\n * provided, the first one will be rendered).\n *\n * @return {Promise<ImportBPMNDiagramResult>}\n */\nexport function importBpmnDiagram(diagram, definitions, bpmnDiagram) {\n\n  var importer,\n      eventBus,\n      canvas;\n\n  var error,\n      warnings = [];\n\n  /**\n   * Walk the diagram semantically, importing (=drawing)\n   * all elements you encounter.\n   *\n   * @param {ModdleElement} definitions\n   * @param {ModdleElement} bpmnDiagram\n   */\n  function render(definitions, bpmnDiagram) {\n\n    var visitor = {\n\n      root: function(element, di) {\n        return importer.add(element, di);\n      },\n\n      element: function(element, di, parentShape) {\n        return importer.add(element, di, parentShape);\n      },\n\n      error: function(message, context) {\n        warnings.push({ message: message, context: context });\n      }\n    };\n\n    var walker = new BpmnTreeWalker(visitor);\n\n\n    bpmnDiagram = bpmnDiagram || (definitions.diagrams && definitions.diagrams[0]);\n\n    var diagramsToImport = getDiagramsToImport(definitions, bpmnDiagram);\n\n    if (!diagramsToImport) {\n      throw new Error('no diagram to display');\n    }\n\n    // traverse BPMN 2.0 document model,\n    // starting at definitions\n    forEach(diagramsToImport, function(diagram) {\n      walker.handleDefinitions(definitions, diagram);\n    });\n\n    var rootId = bpmnDiagram.plane.bpmnElement.id;\n\n    // we do need to account for different ways we create root elements\n    // each nested imported <root> do have the `_plane` suffix, while\n    // the root <root> is found under the business object ID\n    canvas.setRootElement(\n      canvas.findRoot(rootId + '_plane') || canvas.findRoot(rootId)\n    );\n  }\n\n  return new Promise(function(resolve, reject) {\n    try {\n      importer = diagram.get('bpmnImporter');\n      eventBus = diagram.get('eventBus');\n      canvas = diagram.get('canvas');\n\n      eventBus.fire('import.render.start', { definitions: definitions });\n\n      render(definitions, bpmnDiagram);\n\n      eventBus.fire('import.render.complete', {\n        error: error,\n        warnings: warnings\n      });\n\n      return resolve({ warnings: warnings });\n    } catch (e) {\n\n      e.warnings = warnings;\n      return reject(e);\n    }\n  });\n}\n\n/**\n * Returns all diagrams in the same hierarchy as the requested diagram.\n * Includes all parent and sub process diagrams.\n *\n * @param {ModdleElement} definitions\n * @param {ModdleElement} bpmnDiagram\n *\n * @return {ModdleElement[]}\n */\nfunction getDiagramsToImport(definitions, bpmnDiagram) {\n  if (!bpmnDiagram) {\n    return;\n  }\n\n  var bpmnElement = bpmnDiagram.plane.bpmnElement,\n      rootElement = bpmnElement;\n\n  if (!is(bpmnElement, 'bpmn:Process') && !is(bpmnElement, 'bpmn:Collaboration')) {\n    rootElement = findRootProcess(bpmnElement);\n  }\n\n  // in case the process is part of a collaboration, the plane references the\n  // collaboration, not the process\n  var collaboration;\n\n  if (is(rootElement, 'bpmn:Collaboration')) {\n    collaboration = rootElement;\n  } else {\n    collaboration = find(definitions.rootElements, function(element) {\n      if (!is(element, 'bpmn:Collaboration')) {\n        return;\n      }\n\n      return find(element.participants, function(participant) {\n        return participant.processRef === rootElement;\n      });\n    });\n  }\n\n  var rootElements = [ rootElement ];\n\n  // all collaboration processes can contain sub-diagrams\n  if (collaboration) {\n    rootElements = map(collaboration.participants, function(participant) {\n      return participant.processRef;\n    });\n\n    rootElements.push(collaboration);\n  }\n\n  var allChildren = selfAndAllFlowElements(rootElements);\n\n  // if we have multiple diagrams referencing the same element, we\n  // use the first in the file\n  var diagramsToImport = [ bpmnDiagram ];\n  var handledElements = [ bpmnElement ];\n\n  forEach(definitions.diagrams, function(diagram) {\n    var businessObject = diagram.plane.bpmnElement;\n\n    if (\n      allChildren.indexOf(businessObject) !== -1 &&\n      handledElements.indexOf(businessObject) === -1\n    ) {\n      diagramsToImport.push(diagram);\n      handledElements.push(businessObject);\n    }\n  });\n\n\n  return diagramsToImport;\n}\n\nfunction selfAndAllFlowElements(elements) {\n  var result = [];\n\n  forEach(elements, function(element) {\n    if (!element) {\n      return;\n    }\n\n    result.push(element);\n\n    result = result.concat(selfAndAllFlowElements(element.flowElements));\n  });\n\n  return result;\n}\n\nfunction findRootProcess(element) {\n  var parent = element;\n\n  while (parent) {\n    if (is(parent, 'bpmn:Process')) {\n      return parent;\n    }\n\n    parent = parent.$parent;\n  }\n}\n","/**\n * This file must not be changed or exchanged.\n *\n * @see http://bpmn.io/license for more information.\n */\n\nimport {\n  assignStyle,\n  domify,\n  delegate as domDelegate,\n  query as domQuery\n} from 'min-dom';\n\n\n// inlined ../../resources/logo.svg\nvar BPMNIO_LOGO_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14.02 5.57\" width=\"53\" height=\"21\"><path fill=\"currentColor\" d=\"M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z\"/><path fill=\"currentColor\" d=\"M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z\"/></svg>';\n\nexport var BPMNIO_IMG = BPMNIO_LOGO_SVG;\n\nexport var LOGO_STYLES = {\n  verticalAlign: 'middle'\n};\n\nexport var LINK_STYLES = {\n  'color': '#404040'\n};\n\nvar LIGHTBOX_STYLES = {\n  'zIndex': '1001',\n  'position': 'fixed',\n  'top': '0',\n  'left': '0',\n  'right': '0',\n  'bottom': '0'\n};\n\nvar BACKDROP_STYLES = {\n  'width': '100%',\n  'height': '100%',\n  'background': 'rgba(40,40,40,0.2)'\n};\n\nvar NOTICE_STYLES = {\n  'position': 'absolute',\n  'left': '50%',\n  'top': '40%',\n  'transform': 'translate(-50%)',\n  'width': '260px',\n  'padding': '10px',\n  'background': 'white',\n  'boxShadow': '0 1px 4px rgba(0,0,0,0.3)',\n  'fontFamily': 'Helvetica, Arial, sans-serif',\n  'fontSize': '14px',\n  'display': 'flex',\n  'lineHeight': '1.3'\n};\n\nvar LIGHTBOX_MARKUP =\n  '<div class=\"bjs-powered-by-lightbox\">' +\n    '<div class=\"backdrop\"></div>' +\n    '<div class=\"notice\">' +\n      '<a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\" class=\"link\">' +\n        BPMNIO_IMG +\n      '</a>' +\n      '<span>' +\n        'Web-based tooling for BPMN, DMN and forms ' +\n        'powered by <a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\">bpmn.io</a>.' +\n      '</span>' +\n    '</div>' +\n  '</div>';\n\n\nvar lightbox;\n\nfunction createLightbox() {\n  lightbox = domify(LIGHTBOX_MARKUP);\n\n  assignStyle(lightbox, LIGHTBOX_STYLES);\n  assignStyle(domQuery('svg', lightbox), LOGO_STYLES);\n  assignStyle(domQuery('.backdrop', lightbox), BACKDROP_STYLES);\n  assignStyle(domQuery('.notice', lightbox), NOTICE_STYLES);\n  assignStyle(domQuery('.link', lightbox), LINK_STYLES, {\n    'margin': '15px 20px 15px 10px',\n    'alignSelf': 'center'\n  });\n}\n\nexport function open() {\n\n  if (!lightbox) {\n    createLightbox();\n\n    domDelegate.bind(lightbox, '.backdrop', 'click', function(event) {\n      document.body.removeChild(lightbox);\n    });\n  }\n\n  document.body.appendChild(lightbox);\n}\n","/**\n * The code in the <project-logo></project-logo> area\n * must not be changed.\n *\n * @see http://bpmn.io/license for more information.\n */\nimport {\n  assign,\n  find,\n  isNumber,\n  omit\n} from 'min-dash';\n\nimport {\n  domify,\n  assignStyle,\n  query as domQuery,\n  remove as domRemove\n} from 'min-dom';\n\nimport {\n  innerSVG\n} from 'tiny-svg';\n\nimport Diagram from 'diagram-js';\nimport BpmnModdle from 'bpmn-moddle';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  importBpmnDiagram\n} from './import/Importer';\n\n/**\n * @template T\n *\n * @typedef { import('diagram-js/lib/core/EventBus').default<T> } EventBus\n */\n\n/**\n * @template T\n *\n * @typedef {import('diagram-js/lib/core/EventBus').EventBusEventCallback<T>} EventBusEventCallback\n */\n\n/**\n * @typedef {import('didi').ModuleDeclaration} ModuleDeclaration\n *\n * @typedef {import('./model/Types').Moddle} Moddle\n * @typedef {import('./model/Types').ModdleElement} ModdleElement\n * @typedef {import('./model/Types').ModdleExtension} ModdleExtension\n *\n * @typedef { {\n *   width?: number|string;\n *   height?: number|string;\n *   position?: string;\n *   container?: string|HTMLElement;\n *   moddleExtensions?: ModdleExtensions;\n *   additionalModules?: ModuleDeclaration[];\n * } & Record<string, any> } BaseViewerOptions\n *\n * @typedef {Record<string, ModdleElement>} ModdleElementsById\n *\n * @typedef { {\n *   [key: string]: ModdleExtension;\n * } } ModdleExtensions\n *\n * @typedef { {\n *   warnings: string[];\n * } } ImportXMLResult\n *\n * @typedef {ImportXMLResult & Error} ImportXMLError\n *\n * @typedef {ImportXMLResult} ImportDefinitionsResult\n *\n * @typedef {ImportXMLError} ImportDefinitionsError\n *\n * @typedef {ImportXMLResult} OpenResult\n *\n * @typedef {ImportXMLError} OpenError\n *\n * @typedef { {\n *   format?: boolean;\n *   preamble?: boolean;\n * } } SaveXMLOptions\n *\n * @typedef { {\n *   xml?: string;\n *   error?: Error;\n * } } SaveXMLResult\n *\n * @typedef { {\n *   svg: string;\n * } } SaveSVGResult\n *\n * @typedef { {\n *   xml: string;\n * } } ImportParseStartEvent\n *\n * @typedef { {\n *   error?: ImportXMLError;\n *   definitions?: ModdleElement;\n *   elementsById?: ModdleElementsById;\n *   references?: ModdleElement[];\n *   warnings: string[];\n * } } ImportParseCompleteEvent\n *\n * @typedef { {\n *   error?: ImportXMLError;\n *   warnings: string[];\n * } } ImportDoneEvent\n *\n * @typedef { {\n *   definitions: ModdleElement;\n * } } SaveXMLStartEvent\n *\n * @typedef {SaveXMLResult} SaveXMLDoneEvent\n *\n * @typedef { {\n *   error?: Error;\n *   svg: string;\n * } } SaveSVGDoneEvent\n */\n\n/**\n * @template Type\n *\n * @typedef { Type extends { eventBus: EventBus<infer X> } ? X : never } EventMap\n */\n\n/**\n * A base viewer for BPMN 2.0 diagrams.\n *\n * Have a look at {@link bpmn-js/lib/Viewer}, {@link bpmn-js/lib/NavigatedViewer} or {@link bpmn-js/lib/Modeler} for\n * bundles that include actual features.\n *\n * @template [ServiceMap=null]\n *\n * @extends Diagram<ServiceMap>\n *\n * @param {BaseViewerOptions} [options] The options to configure the viewer.\n */\nexport default function BaseViewer(options) {\n\n  /**\n   * @type {BaseViewerOptions}\n   */\n  options = assign({}, DEFAULT_OPTIONS, options);\n\n  /**\n   * @type {Moddle}\n   */\n  this._moddle = this._createModdle(options);\n\n  /**\n   * @type {HTMLElement}\n   */\n  this._container = this._createContainer(options);\n\n  /* <project-logo> */\n\n  addProjectLogo(this._container);\n\n  /* </project-logo> */\n\n  this._init(this._container, this._moddle, options);\n}\n\ninherits(BaseViewer, Diagram);\n\n/**\n * Parse and render a BPMN 2.0 diagram.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During import the viewer will fire life-cycle events:\n *\n *   * import.parse.start (about to read model from XML)\n *   * import.parse.complete (model read; may have worked or not)\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *   * import.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {ImportXMLError} An error thrown during the import of the XML.\n *\n * @fires BaseViewer#ImportParseStartEvent\n * @fires BaseViewer#ImportParseCompleteEvent\n * @fires Importer#ImportRenderStartEvent\n * @fires Importer#ImportRenderCompleteEvent\n * @fires BaseViewer#ImportDoneEvent\n *\n * @param {string} xml The BPMN 2.0 XML to be imported.\n * @param {ModdleElement|string} [bpmnDiagram] The optional diagram or Id of the BPMN diagram to open.\n *\n * @return {Promise<ImportXMLResult>} A promise resolving with warnings that were produced during the import.\n */\nBaseViewer.prototype.importXML = async function importXML(xml, bpmnDiagram) {\n\n  const self = this;\n\n  function ParseCompleteEvent(data) {\n    return self.get('eventBus').createEvent(data);\n  }\n\n  let aggregatedWarnings = [];\n  try {\n\n    // hook in pre-parse listeners +\n    // allow xml manipulation\n\n    /**\n     * A `import.parse.start` event.\n     *\n     * @event BaseViewer#ImportParseStartEvent\n     * @type {ImportParseStartEvent}\n     */\n    xml = this._emit('import.parse.start', { xml: xml }) || xml;\n\n    let parseResult;\n    try {\n      parseResult = await this._moddle.fromXML(xml, 'bpmn:Definitions');\n    } catch (error) {\n      this._emit('import.parse.complete', {\n        error\n      });\n\n      throw error;\n    }\n\n    let definitions = parseResult.rootElement;\n    const references = parseResult.references;\n    const parseWarnings = parseResult.warnings;\n    const elementsById = parseResult.elementsById;\n\n    aggregatedWarnings = aggregatedWarnings.concat(parseWarnings);\n\n    // hook in post parse listeners +\n    // allow definitions manipulation\n\n    /**\n     * A `import.parse.complete` event.\n     *\n     * @event BaseViewer#ImportParseCompleteEvent\n     * @type {ImportParseCompleteEvent}\n     */\n    definitions = this._emit('import.parse.complete', ParseCompleteEvent({\n      error: null,\n      definitions: definitions,\n      elementsById: elementsById,\n      references: references,\n      warnings: aggregatedWarnings\n    })) || definitions;\n\n    const importResult = await this.importDefinitions(definitions, bpmnDiagram);\n\n    aggregatedWarnings = aggregatedWarnings.concat(importResult.warnings);\n\n    /**\n     * A `import.parse.complete` event.\n     *\n     * @event BaseViewer#ImportDoneEvent\n     * @type {ImportDoneEvent}\n     */\n    this._emit('import.done', { error: null, warnings: aggregatedWarnings });\n\n    return { warnings: aggregatedWarnings };\n  } catch (err) {\n    let error = err;\n    aggregatedWarnings = aggregatedWarnings.concat(error.warnings || []);\n    addWarningsToError(error, aggregatedWarnings);\n\n    error = checkValidationError(error);\n\n    this._emit('import.done', { error, warnings: error.warnings });\n\n    throw error;\n  }\n};\n\n\n/**\n * Import parsed definitions and render a BPMN 2.0 diagram.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During import the viewer will fire life-cycle events:\n *\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {ImportDefinitionsError} An error thrown during the import of the definitions.\n *\n * @param {ModdleElement} definitions The definitions.\n * @param {ModdleElement|string} [bpmnDiagram] The optional diagram or ID of the BPMN diagram to open.\n *\n * @return {Promise<ImportDefinitionsResult>} A promise resolving with warnings that were produced during the import.\n */\nBaseViewer.prototype.importDefinitions = async function importDefinitions(definitions, bpmnDiagram) {\n  this._setDefinitions(definitions);\n  const result = await this.open(bpmnDiagram);\n\n  return { warnings: result.warnings };\n};\n\n\n/**\n * Open diagram of previously imported XML.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During switch the viewer will fire life-cycle events:\n *\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {OpenError} An error thrown during opening.\n *\n * @param {ModdleElement|string} bpmnDiagramOrId The diagram or Id of the BPMN diagram to open.\n *\n * @return {Promise<OpenResult>} A promise resolving with warnings that were produced during opening.\n */\nBaseViewer.prototype.open = async function open(bpmnDiagramOrId) {\n\n  const definitions = this._definitions;\n  let bpmnDiagram = bpmnDiagramOrId;\n\n  if (!definitions) {\n    const error = new Error('no XML imported');\n    addWarningsToError(error, []);\n\n    throw error;\n  }\n\n  if (typeof bpmnDiagramOrId === 'string') {\n    bpmnDiagram = findBPMNDiagram(definitions, bpmnDiagramOrId);\n\n    if (!bpmnDiagram) {\n      const error = new Error('BPMNDiagram <' + bpmnDiagramOrId + '> not found');\n      addWarningsToError(error, []);\n\n      throw error;\n    }\n  }\n\n  // clear existing rendered diagram\n  // catch synchronous exceptions during #clear()\n  try {\n    this.clear();\n  } catch (error) {\n    addWarningsToError(error, []);\n\n    throw error;\n  }\n\n  // perform graphical import\n  const { warnings } = await importBpmnDiagram(this, definitions, bpmnDiagram);\n\n  return { warnings };\n};\n\n/**\n * Export the currently displayed BPMN 2.0 diagram as\n * a BPMN 2.0 XML document.\n *\n * ## Life-Cycle Events\n *\n * During XML saving the viewer will fire life-cycle events:\n *\n *   * saveXML.start (before serialization)\n *   * saveXML.serialized (after xml generation)\n *   * saveXML.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {Error} An error thrown during export.\n *\n * @fires BaseViewer#SaveXMLStart\n * @fires BaseViewer#SaveXMLDone\n *\n * @param {SaveXMLOptions} [options] The options.\n *\n * @return {Promise<SaveXMLResult>} A promise resolving with the XML.\n */\nBaseViewer.prototype.saveXML = async function saveXML(options) {\n\n  options = options || {};\n\n  let definitions = this._definitions,\n      error, xml;\n\n  try {\n    if (!definitions) {\n      throw new Error('no definitions loaded');\n    }\n\n    // allow to fiddle around with definitions\n\n    /**\n     * A `saveXML.start` event.\n     *\n     * @event BaseViewer#SaveXMLStartEvent\n     * @type {SaveXMLStartEvent}\n     */\n    definitions = this._emit('saveXML.start', {\n      definitions\n    }) || definitions;\n\n    const result = await this._moddle.toXML(definitions, options);\n    xml = result.xml;\n\n    xml = this._emit('saveXML.serialized', {\n      xml\n    }) || xml;\n  } catch (err) {\n    error = err;\n  }\n\n  const result = error ? { error } : { xml };\n\n  /**\n   * A `saveXML.done` event.\n   *\n   * @event BaseViewer#SaveXMLDoneEvent\n   * @type {SaveXMLDoneEvent}\n   */\n  this._emit('saveXML.done', result);\n\n  if (error) {\n    throw error;\n  }\n\n  return result;\n};\n\n\n/**\n * Export the currently displayed BPMN 2.0 diagram as\n * an SVG image.\n *\n * ## Life-Cycle Events\n *\n * During SVG saving the viewer will fire life-cycle events:\n *\n *   * saveSVG.start (before serialization)\n *   * saveSVG.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {Error} An error thrown during export.\n *\n * @fires BaseViewer#SaveSVGDone\n *\n * @return {Promise<SaveSVGResult>} A promise resolving with the SVG.\n */\nBaseViewer.prototype.saveSVG = async function saveSVG() {\n  this._emit('saveSVG.start');\n\n  let svg, err;\n\n  try {\n    const canvas = this.get('canvas');\n\n    const contentNode = canvas.getActiveLayer(),\n          defsNode = domQuery('defs', canvas._svg);\n\n    const contents = innerSVG(contentNode),\n          defs = defsNode ? '<defs>' + innerSVG(defsNode) + '</defs>' : '';\n\n    const bbox = contentNode.getBBox();\n\n    svg =\n      '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' +\n      '<!-- created with bpmn-js / http://bpmn.io -->\\n' +\n      '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n' +\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n      'width=\"' + bbox.width + '\" height=\"' + bbox.height + '\" ' +\n      'viewBox=\"' + bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height + '\" version=\"1.1\">' +\n      defs + contents +\n      '</svg>';\n  } catch (e) {\n    err = e;\n  }\n\n  /**\n   * A `saveSVG.done` event.\n   *\n   * @event BaseViewer#SaveSVGDoneEvent\n   * @type {SaveSVGDoneEvent}\n   */\n  this._emit('saveSVG.done', {\n    error: err,\n    svg: svg\n  });\n\n  if (err) {\n    throw err;\n  }\n\n  return { svg };\n};\n\nBaseViewer.prototype._setDefinitions = function(definitions) {\n  this._definitions = definitions;\n};\n\n/**\n * Return modules to instantiate with.\n *\n * @return {ModuleDeclaration[]} The modules.\n */\nBaseViewer.prototype.getModules = function() {\n  return this._modules;\n};\n\n/**\n * Remove all drawn elements from the viewer.\n *\n * After calling this method the viewer can still be reused for opening another\n * diagram.\n */\nBaseViewer.prototype.clear = function() {\n  if (!this.getDefinitions()) {\n\n    // no diagram to clear\n    return;\n  }\n\n  // remove drawn elements\n  Diagram.prototype.clear.call(this);\n};\n\n/**\n * Destroy the viewer instance and remove all its remainders from the document\n * tree.\n */\nBaseViewer.prototype.destroy = function() {\n\n  // diagram destroy\n  Diagram.prototype.destroy.call(this);\n\n  // dom detach\n  domRemove(this._container);\n};\n\n/**\n * @overlord\n *\n * Register an event listener for events with the given name.\n *\n * The callback will be invoked with `event, ...additionalArguments`\n * that have been passed to {@link EventBus#fire}.\n *\n * Returning false from a listener will prevent the events default action\n * (if any is specified). To stop an event from being processed further in\n * other listeners execute {@link Event#stopPropagation}.\n *\n * Returning anything but `undefined` from a listener will stop the listener propagation.\n *\n * @template T\n *\n * @param {string|string[]} events The event(s) to listen to.\n * @param {number} [priority] The priority with which to listen.\n * @param {EventBusEventCallback<T>} callback The callback.\n * @param {any} [that] Value of `this` the callback will be called with.\n */\n/**\n * Register an event listener for events with the given name.\n *\n * The callback will be invoked with `event, ...additionalArguments`\n * that have been passed to {@link EventBus#fire}.\n *\n * Returning false from a listener will prevent the events default action\n * (if any is specified). To stop an event from being processed further in\n * other listeners execute {@link Event#stopPropagation}.\n *\n * Returning anything but `undefined` from a listener will stop the listener propagation.\n *\n * @template {keyof EventMap<ServiceMap>} EventName\n *\n * @param {EventName} events to subscribe to\n * @param {number} [priority=1000] listen priority\n * @param {EventBusEventCallback<(EventMap<ServiceMap>)[EventName]>} callback\n * @param {any} [that] callback context\n */\nBaseViewer.prototype.on = function(events, priority, callback, that) {\n  return this.get('eventBus').on(events, priority, callback, that);\n};\n\n/**\n * Remove an event listener.\n *\n * @param {string|string[]} events The event(s).\n * @param {Function} [callback] The callback.\n */\nBaseViewer.prototype.off = function(events, callback) {\n  this.get('eventBus').off(events, callback);\n};\n\n/**\n * Attach the viewer to an HTML element.\n *\n * @param {HTMLElement} parentNode The parent node to attach to.\n */\nBaseViewer.prototype.attachTo = function(parentNode) {\n\n  if (!parentNode) {\n    throw new Error('parentNode required');\n  }\n\n  // ensure we detach from the\n  // previous, old parent\n  this.detach();\n\n  // unwrap jQuery if provided\n  if (parentNode.get && parentNode.constructor.prototype.jquery) {\n    parentNode = parentNode.get(0);\n  }\n\n  if (typeof parentNode === 'string') {\n    parentNode = domQuery(parentNode);\n  }\n\n  parentNode.appendChild(this._container);\n\n  this._emit('attach', {});\n\n  this.get('canvas').resized();\n};\n\n/**\n * Get the definitions model element.\n *\n * @return {ModdleElement} The definitions model element.\n */\nBaseViewer.prototype.getDefinitions = function() {\n  return this._definitions;\n};\n\n/**\n * Detach the viewer.\n *\n * @fires BaseViewer#DetachEvent\n */\nBaseViewer.prototype.detach = function() {\n\n  const container = this._container,\n        parentNode = container.parentNode;\n\n  if (!parentNode) {\n    return;\n  }\n\n  /**\n   * A `detach` event.\n   *\n   * @event BaseViewer#DetachEvent\n   * @type {Object}\n   */\n  this._emit('detach', {});\n\n  parentNode.removeChild(container);\n};\n\nBaseViewer.prototype._init = function(container, moddle, options) {\n\n  const baseModules = options.modules || this.getModules(options),\n        additionalModules = options.additionalModules || [],\n        staticModules = [\n          {\n            bpmnjs: [ 'value', this ],\n            moddle: [ 'value', moddle ]\n          }\n        ];\n\n  const diagramModules = [].concat(staticModules, baseModules, additionalModules);\n\n  const diagramOptions = assign(omit(options, [ 'additionalModules' ]), {\n    canvas: assign({}, options.canvas, { container: container }),\n    modules: diagramModules\n  });\n\n  // invoke diagram constructor\n  Diagram.call(this, diagramOptions);\n\n  if (options && options.container) {\n    this.attachTo(options.container);\n  }\n};\n\n/**\n * Emit an event on the underlying {@link EventBus}\n *\n * @param  {string} type\n * @param  {Object} event\n *\n * @return {Object} The return value after calling all event listeners.\n */\nBaseViewer.prototype._emit = function(type, event) {\n  return this.get('eventBus').fire(type, event);\n};\n\n/**\n * @param {BaseViewerOptions} options\n *\n * @return {HTMLElement}\n */\nBaseViewer.prototype._createContainer = function(options) {\n\n  const container = domify('<div class=\"bjs-container\"></div>');\n\n  assignStyle(container, {\n    width: ensureUnit(options.width),\n    height: ensureUnit(options.height),\n    position: options.position\n  });\n\n  return container;\n};\n\n/**\n * @param {BaseViewerOptions} options\n *\n * @return {Moddle}\n */\nBaseViewer.prototype._createModdle = function(options) {\n  const moddleOptions = assign({}, this._moddleExtensions, options.moddleExtensions);\n\n  return new BpmnModdle(moddleOptions);\n};\n\nBaseViewer.prototype._modules = [];\n\n// helpers ///////////////\n\nfunction addWarningsToError(err, warningsAry) {\n  err.warnings = warningsAry;\n  return err;\n}\n\nfunction checkValidationError(err) {\n\n  // check if we can help the user by indicating wrong BPMN 2.0 xml\n  // (in case he or the exporting tool did not get that right)\n\n  const pattern = /unparsable content <([^>]+)> detected([\\s\\S]*)$/;\n  const match = pattern.exec(err.message);\n\n  if (match) {\n    err.message =\n      'unparsable content <' + match[1] + '> detected; ' +\n      'this may indicate an invalid BPMN 2.0 diagram file' + match[2];\n  }\n\n  return err;\n}\n\nconst DEFAULT_OPTIONS = {\n  width: '100%',\n  height: '100%',\n  position: 'relative'\n};\n\n\n/**\n * Ensure the passed argument is a proper unit (defaulting to px)\n */\nfunction ensureUnit(val) {\n  return val + (isNumber(val) ? 'px' : '');\n}\n\n\n/**\n * Find BPMNDiagram in definitions by ID\n *\n * @param {ModdleElement<Definitions>} definitions\n * @param {string} diagramId\n *\n * @return {ModdleElement<BPMNDiagram>|null}\n */\nfunction findBPMNDiagram(definitions, diagramId) {\n  if (!diagramId) {\n    return null;\n  }\n\n  return find(definitions.diagrams, function(element) {\n    return element.id === diagramId;\n  }) || null;\n}\n\n\n/* <project-logo> */\n\nimport {\n  open as openPoweredBy,\n  BPMNIO_IMG,\n  LOGO_STYLES,\n  LINK_STYLES\n} from './util/PoweredByUtil';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\n/**\n * Adds the project logo to the diagram container as\n * required by the bpmn.io license.\n *\n * @see http://bpmn.io/license\n *\n * @param {Element} container\n */\nfunction addProjectLogo(container) {\n  const img = BPMNIO_IMG;\n\n  const linkMarkup =\n    '<a href=\"http://bpmn.io\" ' +\n    'target=\"_blank\" ' +\n    'class=\"bjs-powered-by\" ' +\n    'title=\"Powered by bpmn.io\" ' +\n    '>' +\n    img +\n    '</a>';\n\n  const linkElement = domify(linkMarkup);\n\n  assignStyle(domQuery('svg', linkElement), LOGO_STYLES);\n  assignStyle(linkElement, LINK_STYLES, {\n    position: 'absolute',\n    bottom: '15px',\n    right: '15px',\n    zIndex: '100'\n  });\n\n  container.appendChild(linkElement);\n\n  domEvent.bind(linkElement, 'click', function(event) {\n    openPoweredBy();\n\n    event.preventDefault();\n  });\n}\n\n/* </project-logo> */\n","import inherits from 'inherits-browser';\n\nimport Ids from 'ids';\n\nimport BaseViewer from './BaseViewer';\n\n\n/**\n * @typedef {import('./BaseViewer').BaseViewerOptions} BaseViewerOptions\n * @typedef {import('./BaseViewer').ModdleElementsById} ModdleElementsById\n *\n * @typedef {import('./model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * A base modeler for BPMN 2.0 diagrams.\n *\n * See {@link bpmn-js/lib/Modeler} for a fully-featured modeler.\n *\n * @template [ServiceMap=null]\n *\n * @extends BaseViewer<ServiceMap>\n *\n * @param {BaseViewerOptions} [options] The options to configure the modeler.\n */\nexport default function BaseModeler(options) {\n  BaseViewer.call(this, options);\n\n  // hook ID collection into the modeler\n  this.on('import.parse.complete', function(event) {\n    if (!event.error) {\n      this._collectIds(event.definitions, event.elementsById);\n    }\n  }, this);\n\n  this.on('diagram.destroy', function() {\n    this.get('moddle').ids.clear();\n  }, this);\n}\n\ninherits(BaseModeler, BaseViewer);\n\n\n/**\n * Create a moddle instance, attaching IDs to it.\n *\n * @param {BaseViewerOptions} options\n *\n * @return {Moddle}\n */\nBaseModeler.prototype._createModdle = function(options) {\n  var moddle = BaseViewer.prototype._createModdle.call(this, options);\n\n  // attach ids to moddle to be able to track and validated ids in the BPMN 2.0\n  // XML document tree\n  moddle.ids = new Ids([ 32, 36, 1 ]);\n\n  return moddle;\n};\n\n/**\n * Collect IDs processed during parsing of the definitions object.\n *\n * @param {ModdleElement} definitions\n * @param {ModdleElementsById} elementsById\n */\nBaseModeler.prototype._collectIds = function(definitions, elementsById) {\n\n  var moddle = definitions.$model,\n      ids = moddle.ids,\n      id;\n\n  // remove references from previous import\n  ids.clear();\n\n  for (id in elementsById) {\n    ids.claim(id, elementsById[ id ]);\n  }\n};\n","import {\n  is,\n  getBusinessObject,\n  getDi\n} from './ModelUtil';\n\nimport {\n  some\n} from 'min-dash';\n\n/**\n * @typedef {import('../model/Types').Element} Element\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * @param {Element} element\n * @param {ModdleElement} [di]\n *\n * @return {boolean}\n */\nexport function isExpanded(element, di) {\n\n  if (is(element, 'bpmn:CallActivity')) {\n    return false;\n  }\n\n  if (is(element, 'bpmn:SubProcess')) {\n    di = di || getDi(element);\n\n    if (di && is(di, 'bpmndi:BPMNPlane')) {\n      return true;\n    }\n\n    return di && !!di.isExpanded;\n  }\n\n  if (is(element, 'bpmn:Participant')) {\n    return !!getBusinessObject(element).processRef;\n  }\n\n  return true;\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nexport function isHorizontal(element) {\n\n  if (!is(element, 'bpmn:Participant') && !is(element, 'bpmn:Lane')) {\n    return undefined;\n  }\n\n  var isHorizontal = getDi(element).isHorizontal;\n\n  if (isHorizontal === undefined) {\n    return true;\n  }\n\n  return isHorizontal;\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nexport function isInterrupting(element) {\n  return element && getBusinessObject(element).isInterrupting !== false;\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nexport function isEventSubProcess(element) {\n  return element && !!getBusinessObject(element).triggeredByEvent;\n}\n\n/**\n * @param {Element} element\n * @param {string} eventType\n *\n * @return {boolean}\n */\nexport function hasEventDefinition(element, eventType) {\n  var eventDefinitions = getBusinessObject(element).eventDefinitions;\n\n  return some(eventDefinitions, function(event) {\n    return is(event, eventType);\n  });\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nexport function hasErrorEventDefinition(element) {\n  return hasEventDefinition(element, 'bpmn:ErrorEventDefinition');\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nexport function hasEscalationEventDefinition(element) {\n  return hasEventDefinition(element, 'bpmn:EscalationEventDefinition');\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nexport function hasCompensateEventDefinition(element) {\n  return hasEventDefinition(element, 'bpmn:CompensateEventDefinition');\n}\n","import {\n  assign\n} from 'min-dash';\n\nimport { is } from './ModelUtil';\n\nimport { isLabel } from 'diagram-js/lib/util/ModelUtil';\n\nexport { isLabel } from 'diagram-js/lib/util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n *\n * @typedef {import('../model/Types').Element} Element\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\nexport var DEFAULT_LABEL_SIZE = {\n  width: 90,\n  height: 20\n};\n\nexport var FLOW_LABEL_INDENT = 15;\n\n\n/**\n * Return true if the given semantic has an external label.\n *\n * @param {Element} semantic\n *\n * @return {boolean}\n */\nexport function isLabelExternal(semantic) {\n  return is(semantic, 'bpmn:Event') ||\n         is(semantic, 'bpmn:Gateway') ||\n         is(semantic, 'bpmn:DataStoreReference') ||\n         is(semantic, 'bpmn:DataObjectReference') ||\n         is(semantic, 'bpmn:DataInput') ||\n         is(semantic, 'bpmn:DataOutput') ||\n         is(semantic, 'bpmn:SequenceFlow') ||\n         is(semantic, 'bpmn:MessageFlow') ||\n         is(semantic, 'bpmn:Group');\n}\n\n/**\n * Return true if the given element has an external label.\n *\n * @param {Element} element\n *\n * @return {boolean}\n */\nexport function hasExternalLabel(element) {\n  return isLabel(element.label);\n}\n\n/**\n * Get the position of a sequence flow label.\n *\n * @param  {Point[]} waypoints\n *\n * @return {Point}\n */\nexport function getFlowLabelPosition(waypoints) {\n\n  // get the waypoints mid\n  var mid = waypoints.length / 2 - 1;\n\n  var first = waypoints[Math.floor(mid)];\n  var second = waypoints[Math.ceil(mid + 0.01)];\n\n  // get position\n  var position = getWaypointsMid(waypoints);\n\n  // calculate angle\n  var angle = Math.atan((second.y - first.y) / (second.x - first.x));\n\n  var x = position.x,\n      y = position.y;\n\n  if (Math.abs(angle) < Math.PI / 2) {\n    y -= FLOW_LABEL_INDENT;\n  } else {\n    x += FLOW_LABEL_INDENT;\n  }\n\n  return { x: x, y: y };\n}\n\n\n/**\n * Get the middle of a number of waypoints.\n *\n * @param  {Point[]} waypoints\n *\n * @return {Point}\n */\nexport function getWaypointsMid(waypoints) {\n\n  var mid = waypoints.length / 2 - 1;\n\n  var first = waypoints[Math.floor(mid)];\n  var second = waypoints[Math.ceil(mid + 0.01)];\n\n  return {\n    x: first.x + (second.x - first.x) / 2,\n    y: first.y + (second.y - first.y) / 2\n  };\n}\n\n/**\n * Get the middle of the external label of an element.\n *\n * @param {Element} element\n *\n * @return {Point}\n */\nexport function getExternalLabelMid(element) {\n\n  if (element.waypoints) {\n    return getFlowLabelPosition(element.waypoints);\n  } else if (is(element, 'bpmn:Group')) {\n    return {\n      x: element.x + element.width / 2,\n      y: element.y + DEFAULT_LABEL_SIZE.height / 2\n    };\n  } else {\n    return {\n      x: element.x + element.width / 2,\n      y: element.y + element.height + DEFAULT_LABEL_SIZE.height / 2\n    };\n  }\n}\n\n\n/**\n * Return the bounds of an elements label, parsed from the elements DI or\n * generated from its bounds.\n *\n * @param {ModdleElement} di\n * @param {Element} element\n *\n * @return {Rect}\n */\nexport function getExternalLabelBounds(di, element) {\n\n  var mid,\n      size,\n      bounds,\n      label = di.label;\n\n  if (label && label.bounds) {\n    bounds = label.bounds;\n\n    size = {\n      width: Math.max(DEFAULT_LABEL_SIZE.width, bounds.width),\n      height: bounds.height\n    };\n\n    mid = {\n      x: bounds.x + bounds.width / 2,\n      y: bounds.y + bounds.height / 2\n    };\n  } else {\n\n    mid = getExternalLabelMid(element);\n\n    size = DEFAULT_LABEL_SIZE;\n  }\n\n  return assign({\n    x: mid.x - size.width / 2,\n    y: mid.y - size.height / 2\n  }, size);\n}\n\n/**\n * @param {ModdleElement} semantic\n *\n * @returns {string}\n */\nfunction getLabelAttr(semantic) {\n  if (\n    is(semantic, 'bpmn:FlowElement') ||\n    is(semantic, 'bpmn:Participant') ||\n    is(semantic, 'bpmn:Lane') ||\n    is(semantic, 'bpmn:SequenceFlow') ||\n    is(semantic, 'bpmn:MessageFlow') ||\n    is(semantic, 'bpmn:DataInput') ||\n    is(semantic, 'bpmn:DataOutput')\n  ) {\n    return 'name';\n  }\n\n  if (is(semantic, 'bpmn:TextAnnotation')) {\n    return 'text';\n  }\n\n  if (is(semantic, 'bpmn:Group')) {\n    return 'categoryValueRef';\n  }\n}\n\n/**\n * @param {ModdleElement} semantic\n *\n * @returns {string}\n */\nfunction getCategoryValue(semantic) {\n  var categoryValueRef = semantic['categoryValueRef'];\n\n  if (!categoryValueRef) {\n    return '';\n  }\n\n\n  return categoryValueRef.value || '';\n}\n\n/**\n * @param {Element} element\n *\n * @return {string}\n */\nexport function getLabel(element) {\n  var semantic = element.businessObject,\n      attr = getLabelAttr(semantic);\n\n  if (attr) {\n\n    if (attr === 'categoryValueRef') {\n\n      return getCategoryValue(semantic);\n    }\n\n    return semantic[attr] || '';\n  }\n}\n\n\n/**\n * @param {Element} element\n * @param {string} text\n *\n * @return {Element}\n */\nexport function setLabel(element, text) {\n  var semantic = element.businessObject,\n      attr = getLabelAttr(semantic);\n\n  if (attr) {\n\n    if (attr === 'categoryValueRef') {\n      semantic['categoryValueRef'].value = text;\n    } else {\n      semantic[attr] = text;\n    }\n\n  }\n\n  return element;\n}\n","import {\n  has,\n  some\n} from 'min-dash';\n\nimport {\n  getDi\n} from '../util/ModelUtil';\n\nimport {\n  componentsToPath\n} from 'diagram-js/lib/util/RenderUtil';\n\n\n/**\n * @typedef {import('../model').ModdleElement} ModdleElement\n * @typedef {import('../model').Element} Element\n *\n * @typedef {import('../model').ShapeLike} ShapeLike\n *\n * @typedef {import('diagram-js/lib/util/Types').Dimensions} Dimensions\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\n// re-export for compatibility\nexport {\n  getDi,\n  getBusinessObject as getSemantic\n} from '../util/ModelUtil';\n\n\nexport var black = 'hsl(225, 10%, 15%)';\nexport var white = 'white';\n\n// element utils //////////////////////\n\n/**\n * Checks if eventDefinition of the given element matches with semantic type.\n *\n * @param {ModdleElement} event\n * @param {string} eventDefinitionType\n *\n * @return {boolean}\n */\nexport function isTypedEvent(event, eventDefinitionType) {\n  return some(event.eventDefinitions, function(definition) {\n    return definition.$type === eventDefinitionType;\n  });\n}\n\n/**\n * Check if element is a throw event.\n *\n * @param {ModdleElement} event\n *\n * @return {boolean}\n */\nexport function isThrowEvent(event) {\n  return (event.$type === 'bpmn:IntermediateThrowEvent') || (event.$type === 'bpmn:EndEvent');\n}\n\n/**\n * Check if element is a throw event.\n *\n * @param {ModdleElement} element\n *\n * @return {boolean}\n */\nexport function isCollection(element) {\n  var dataObject = element.dataObjectRef;\n\n  return element.isCollection || (dataObject && dataObject.isCollection);\n}\n\n\n// color access //////////////////////\n\n/**\n * @param {Element} element\n * @param {string} [defaultColor]\n * @param {string} [overrideColor]\n *\n * @return {string}\n */\nexport function getFillColor(element, defaultColor, overrideColor) {\n  var di = getDi(element);\n\n  return overrideColor || di.get('color:background-color') || di.get('bioc:fill') || defaultColor || white;\n}\n\n/**\n * @param {Element} element\n * @param {string} [defaultColor]\n * @param {string} [overrideColor]\n *\n * @return {string}\n */\nexport function getStrokeColor(element, defaultColor, overrideColor) {\n  var di = getDi(element);\n\n  return overrideColor || di.get('color:border-color') || di.get('bioc:stroke') || defaultColor || black;\n}\n\n/**\n * @param {Element} element\n * @param {string} [defaultColor]\n * @param {string} [defaultStrokeColor]\n * @param {string} [overrideColor]\n *\n * @return {string}\n */\nexport function getLabelColor(element, defaultColor, defaultStrokeColor, overrideColor) {\n  var di = getDi(element),\n      label = di.get('label');\n\n  return overrideColor || (label && label.get('color:color')) || defaultColor ||\n    getStrokeColor(element, defaultStrokeColor);\n}\n\n// cropping path customizations //////////////////////\n\n/**\n * @param {ShapeLike} shape\n *\n * @return {string} path\n */\nexport function getCirclePath(shape) {\n\n  var cx = shape.x + shape.width / 2,\n      cy = shape.y + shape.height / 2,\n      radius = shape.width / 2;\n\n  var circlePath = [\n    [ 'M', cx, cy ],\n    [ 'm', 0, -radius ],\n    [ 'a', radius, radius, 0, 1, 1, 0, 2 * radius ],\n    [ 'a', radius, radius, 0, 1, 1, 0, -2 * radius ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(circlePath);\n}\n\n/**\n * @param {ShapeLike} shape\n * @param {number} [borderRadius]\n *\n * @return {string} path\n */\nexport function getRoundRectPath(shape, borderRadius) {\n\n  var x = shape.x,\n      y = shape.y,\n      width = shape.width,\n      height = shape.height;\n\n  var roundRectPath = [\n    [ 'M', x + borderRadius, y ],\n    [ 'l', width - borderRadius * 2, 0 ],\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, borderRadius, borderRadius ],\n    [ 'l', 0, height - borderRadius * 2 ],\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, -borderRadius, borderRadius ],\n    [ 'l', borderRadius * 2 - width, 0 ],\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, -borderRadius, -borderRadius ],\n    [ 'l', 0, borderRadius * 2 - height ],\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, borderRadius, -borderRadius ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(roundRectPath);\n}\n\n/**\n * @param {ShapeLike} shape\n *\n * @return {string} path\n */\nexport function getDiamondPath(shape) {\n\n  var width = shape.width,\n      height = shape.height,\n      x = shape.x,\n      y = shape.y,\n      halfWidth = width / 2,\n      halfHeight = height / 2;\n\n  var diamondPath = [\n    [ 'M', x + halfWidth, y ],\n    [ 'l', halfWidth, halfHeight ],\n    [ 'l', -halfWidth, halfHeight ],\n    [ 'l', -halfWidth, -halfHeight ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(diamondPath);\n}\n\n/**\n * @param {ShapeLike} shape\n *\n * @return {string} path\n */\nexport function getRectPath(shape) {\n  var x = shape.x,\n      y = shape.y,\n      width = shape.width,\n      height = shape.height;\n\n  var rectPath = [\n    [ 'M', x, y ],\n    [ 'l', width, 0 ],\n    [ 'l', 0, height ],\n    [ 'l', -width, 0 ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(rectPath);\n}\n\n/**\n * Get width and height from element or overrides.\n *\n * @param {Dimensions|Rect|ShapeLike} bounds\n * @param {Object} overrides\n *\n * @returns {Dimensions}\n */\nexport function getBounds(bounds, overrides = {}) {\n  return {\n    width: getWidth(bounds, overrides),\n    height: getHeight(bounds, overrides)\n  };\n}\n\n/**\n * Get width from element or overrides.\n *\n * @param {Dimensions|Rect|ShapeLike} bounds\n * @param {Object} overrides\n *\n * @returns {number}\n */\nexport function getWidth(bounds, overrides = {}) {\n  return has(overrides, 'width') ? overrides.width : bounds.width;\n}\n\n/**\n * Get height from element or overrides.\n *\n * @param {Dimensions|Rect|ShapeLike} bounds\n * @param {Object} overrides\n *\n * @returns {number}\n */\nexport function getHeight(bounds, overrides = {}) {\n  return has(overrides, 'height') ? overrides.height : bounds.height;\n}","import inherits from 'inherits-browser';\n\nimport {\n  assign,\n  forEach,\n  isObject\n} from 'min-dash';\n\nimport BaseRenderer from 'diagram-js/lib/draw/BaseRenderer';\n\nimport {\n  isExpanded,\n  isHorizontal,\n  isEventSubProcess\n} from '../util/DiUtil';\n\nimport {\n  getLabel\n} from '../util/LabelUtil';\n\nimport {\n  is\n} from '../util/ModelUtil';\n\nimport {\n  createLine\n} from 'diagram-js/lib/util/RenderUtil';\n\nimport {\n  isTypedEvent,\n  isThrowEvent,\n  isCollection,\n  getBounds,\n  getDi,\n  getSemantic,\n  getCirclePath,\n  getRoundRectPath,\n  getDiamondPath,\n  getRectPath,\n  getFillColor,\n  getStrokeColor,\n  getLabelColor,\n  getHeight,\n  getWidth\n} from './BpmnRenderUtil';\n\nimport {\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  classes as svgClasses\n} from 'tiny-svg';\n\nimport {\n  rotate,\n  transform,\n  translate\n} from 'diagram-js/lib/util/SvgTransformUtil';\n\nimport Ids from 'ids';\n\nimport { black } from './BpmnRenderUtil';\n\nvar rendererIds = new Ids();\n\nvar ELEMENT_LABEL_DISTANCE = 10,\n    INNER_OUTER_DIST = 3,\n    PARTICIPANT_STROKE_WIDTH = 1.5,\n    TASK_BORDER_RADIUS = 10;\n\nvar DEFAULT_OPACITY = 0.95,\n    FULL_OPACITY = 1,\n    LOW_OPACITY = 0.25;\n\n/**\n * @typedef { Partial<{\n *   defaultFillColor: string,\n *   defaultStrokeColor: string,\n *   defaultLabelColor: string\n * }> } BpmnRendererConfig\n *\n * @typedef { Partial<{\n *   fill: string,\n *   stroke: string,\n *   width: string,\n *   height: string\n * }> } Attrs\n */\n\n/**\n * @typedef { import('../model/Types').Element } Element\n */\n\n/**\n * A renderer for BPMN elements\n *\n * @param {BpmnRendererConfig} config\n * @param {import('diagram-js/lib/core/EventBus').default} eventBus\n * @param {import('diagram-js/lib/draw/Styles').default} styles\n * @param {import('./PathMap').default} pathMap\n * @param {import('diagram-js/lib/core/Canvas').default} canvas\n * @param {import('./TextRenderer').default} textRenderer\n * @param {number} [priority]\n */\nexport default function BpmnRenderer(\n    config, eventBus, styles, pathMap,\n    canvas, textRenderer, priority) {\n\n  BaseRenderer.call(this, eventBus, priority);\n\n  var defaultFillColor = config && config.defaultFillColor,\n      defaultStrokeColor = config && config.defaultStrokeColor,\n      defaultLabelColor = config && config.defaultLabelColor;\n\n  var rendererId = rendererIds.next();\n\n  var markers = {};\n\n  function shapeStyle(attrs) {\n    return styles.computeStyle(attrs, {\n      strokeLinecap: 'round',\n      strokeLinejoin: 'round',\n      stroke: black,\n      strokeWidth: 2,\n      fill: 'white'\n    });\n  }\n\n  function lineStyle(attrs) {\n    return styles.computeStyle(attrs, [ 'no-fill' ], {\n      strokeLinecap: 'round',\n      strokeLinejoin: 'round',\n      stroke: black,\n      strokeWidth: 2\n    });\n  }\n\n  function addMarker(id, options) {\n    var {\n      ref = { x: 0, y: 0 },\n      scale = 1,\n      element\n    } = options;\n\n    var marker = svgCreate('marker', {\n      id: id,\n      viewBox: '0 0 20 20',\n      refX: ref.x,\n      refY: ref.y,\n      markerWidth: 20 * scale,\n      markerHeight: 20 * scale,\n      orient: 'auto'\n    });\n\n    svgAppend(marker, element);\n\n    var defs = domQuery('defs', canvas._svg);\n\n    if (!defs) {\n      defs = svgCreate('defs');\n\n      svgAppend(canvas._svg, defs);\n    }\n\n    svgAppend(defs, marker);\n\n    markers[id] = marker;\n  }\n\n  function colorEscape(str) {\n\n    // only allow characters and numbers\n    return str.replace(/[^0-9a-zA-Z]+/g, '_');\n  }\n\n  function marker(type, fill, stroke) {\n    var id = type + '-' + colorEscape(fill) + '-' + colorEscape(stroke) + '-' + rendererId;\n\n    if (!markers[id]) {\n      createMarker(id, type, fill, stroke);\n    }\n\n    return 'url(#' + id + ')';\n  }\n\n  function createMarker(id, type, fill, stroke) {\n\n    if (type === 'sequenceflow-end') {\n      var sequenceflowEnd = svgCreate('path', {\n        d: 'M 1 5 L 11 10 L 1 15 Z',\n        ...shapeStyle({\n          fill: stroke,\n          stroke: stroke,\n          strokeWidth: 1\n        })\n      });\n\n      addMarker(id, {\n        element: sequenceflowEnd,\n        ref: { x: 11, y: 10 },\n        scale: 0.5\n      });\n    }\n\n    if (type === 'messageflow-start') {\n      var messageflowStart = svgCreate('circle', {\n        cx: 6,\n        cy: 6,\n        r: 3.5,\n        ...shapeStyle({\n          fill,\n          stroke: stroke,\n          strokeWidth: 1,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: messageflowStart,\n        ref: { x: 6, y: 6 }\n      });\n    }\n\n    if (type === 'messageflow-end') {\n      var messageflowEnd = svgCreate('path', {\n        d: 'm 1 5 l 0 -3 l 7 3 l -7 3 z',\n        ...shapeStyle({\n          fill,\n          stroke: stroke,\n          strokeWidth: 1,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: messageflowEnd,\n        ref: { x: 8.5, y: 5 }\n      });\n    }\n\n    if (type === 'association-start') {\n      var associationStart = svgCreate('path', {\n        d: 'M 11 5 L 1 10 L 11 15',\n        ...lineStyle({\n          fill: 'none',\n          stroke,\n          strokeWidth: 1.5,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: associationStart,\n        ref: { x: 1, y: 10 },\n        scale: 0.5\n      });\n    }\n\n    if (type === 'association-end') {\n      var associationEnd = svgCreate('path', {\n        d: 'M 1 5 L 11 10 L 1 15',\n        ...lineStyle({\n          fill: 'none',\n          stroke,\n          strokeWidth: 1.5,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: associationEnd,\n        ref: { x: 11, y: 10 },\n        scale: 0.5\n      });\n    }\n\n    if (type === 'conditional-flow-marker') {\n      var conditionalFlowMarker = svgCreate('path', {\n        d: 'M 0 10 L 8 6 L 16 10 L 8 14 Z',\n        ...shapeStyle({\n          fill,\n          stroke: stroke\n        })\n      });\n\n      addMarker(id, {\n        element: conditionalFlowMarker,\n        ref: { x: -1, y: 10 },\n        scale: 0.5\n      });\n    }\n\n    if (type === 'conditional-default-flow-marker') {\n      var defaultFlowMarker = svgCreate('path', {\n        d: 'M 6 4 L 10 16',\n        ...shapeStyle({\n          stroke: stroke\n        })\n      });\n\n      addMarker(id, {\n        element: defaultFlowMarker,\n        ref: { x: 0, y: 10 },\n        scale: 0.5\n      });\n    }\n  }\n\n  function drawCircle(parentGfx, width, height, offset, attrs = {}) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = shapeStyle(attrs);\n\n    var cx = width / 2,\n        cy = height / 2;\n\n    var circle = svgCreate('circle', {\n      cx: cx,\n      cy: cy,\n      r: Math.round((width + height) / 4 - offset),\n      ...attrs\n    });\n\n    svgAppend(parentGfx, circle);\n\n    return circle;\n  }\n\n  function drawRect(parentGfx, width, height, r, offset, attrs) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = shapeStyle(attrs);\n\n    var rect = svgCreate('rect', {\n      x: offset,\n      y: offset,\n      width: width - offset * 2,\n      height: height - offset * 2,\n      rx: r,\n      ry: r,\n      ...attrs\n    });\n\n    svgAppend(parentGfx, rect);\n\n    return rect;\n  }\n\n  function drawDiamond(parentGfx, width, height, attrs) {\n\n    var x_2 = width / 2;\n    var y_2 = height / 2;\n\n    var points = [\n      { x: x_2, y: 0 },\n      { x: width, y: y_2 },\n      { x: x_2, y: height },\n      { x: 0, y: y_2 }\n    ];\n\n    var pointsString = points.map(function(point) {\n      return point.x + ',' + point.y;\n    }).join(' ');\n\n    attrs = shapeStyle(attrs);\n\n    var polygon = svgCreate('polygon', {\n      ...attrs,\n      points: pointsString\n    });\n\n    svgAppend(parentGfx, polygon);\n\n    return polygon;\n  }\n\n  /**\n   * @param {SVGElement} parentGfx\n   * @param {Point[]} waypoints\n   * @param {any} attrs\n   * @param {number} [radius]\n   *\n   * @return {SVGElement}\n   */\n  function drawLine(parentGfx, waypoints, attrs, radius) {\n    attrs = lineStyle(attrs);\n\n    var line = createLine(waypoints, attrs, radius);\n\n    svgAppend(parentGfx, line);\n\n    return line;\n  }\n\n  /**\n   * @param {SVGElement} parentGfx\n   * @param {Point[]} waypoints\n   * @param {any} attrs\n   *\n   * @return {SVGElement}\n   */\n  function drawConnectionSegments(parentGfx, waypoints, attrs) {\n    return drawLine(parentGfx, waypoints, attrs, 5);\n  }\n\n  function drawPath(parentGfx, d, attrs) {\n    attrs = lineStyle(attrs);\n\n    var path = svgCreate('path', {\n      ...attrs,\n      d\n    });\n\n    svgAppend(parentGfx, path);\n\n    return path;\n  }\n\n  function drawMarker(type, parentGfx, path, attrs) {\n    return drawPath(parentGfx, path, assign({ 'data-marker': type }, attrs));\n  }\n\n  function renderer(type) {\n    return handlers[type];\n  }\n\n  function as(type) {\n    return function(parentGfx, element, attrs) {\n      return renderer(type)(parentGfx, element, attrs);\n    };\n  }\n\n  var eventIconRenderers = {\n    'bpmn:MessageEventDefinition': function(parentGfx, element, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_MESSAGE', {\n        xScaleFactor: 0.9,\n        yScaleFactor: 0.9,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.235,\n          my: 0.315\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n        : getFillColor(element, defaultFillColor, attrs.fill);\n\n      var stroke = isThrowing\n        ? getFillColor(element, defaultFillColor, attrs.fill)\n        : getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var messagePath = drawPath(parentGfx, pathData, {\n        fill,\n        stroke,\n        strokeWidth: 1\n      });\n\n      return messagePath;\n    },\n    'bpmn:TimerEventDefinition': function(parentGfx, element, attrs = {}) {\n      var circle = drawCircle(parentGfx, element.width, element.height, 0.2 * element.height, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 2\n      });\n\n      var pathData = pathMap.getScaledPath('EVENT_TIMER_WH', {\n        xScaleFactor: 0.75,\n        yScaleFactor: 0.75,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.5,\n          my: 0.5\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 2\n      });\n\n      for (var i = 0; i < 12; i++) {\n        var linePathData = pathMap.getScaledPath('EVENT_TIMER_LINE', {\n          xScaleFactor: 0.75,\n          yScaleFactor: 0.75,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.5,\n            my: 0.5\n          }\n        });\n\n        var width = element.width / 2,\n            height = element.height / 2;\n\n        drawPath(parentGfx, linePathData, {\n          strokeWidth: 1,\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          transform: 'rotate(' + (i * 30) + ',' + height + ',' + width + ')'\n        });\n      }\n\n      return circle;\n    },\n    'bpmn:EscalationEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_ESCALATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.5,\n          my: 0.2\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ConditionalEventDefinition': function(parentGfx, event, attrs = {}) {\n      var pathData = pathMap.getScaledPath('EVENT_CONDITIONAL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.5,\n          my: 0.222\n        }\n      });\n\n      return drawPath(parentGfx, pathData, {\n        fill: getFillColor(event, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:LinkEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_LINK', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.57,\n          my: 0.263\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ErrorEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_ERROR', {\n        xScaleFactor: 1.1,\n        yScaleFactor: 1.1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.2,\n          my: 0.722\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:CancelEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_CANCEL_45', {\n        xScaleFactor: 1.0,\n        yScaleFactor: 1.0,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.638,\n          my: -0.055\n        }\n      });\n\n      var fill = isThrowing ? getStrokeColor(event, defaultStrokeColor, attrs.stroke) : 'none';\n\n      var path = drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      rotate(path, 45);\n\n      return path;\n    },\n    'bpmn:CompensateEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_COMPENSATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.22,\n          my: 0.5\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:SignalEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_SIGNAL', {\n        xScaleFactor: 0.9,\n        yScaleFactor: 0.9,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.5,\n          my: 0.2\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'bpmn:MultipleEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_MULTIPLE', {\n        xScaleFactor: 1.1,\n        yScaleFactor: 1.1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.222,\n          my: 0.36\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ParallelMultipleEventDefinition': function(parentGfx, event, attrs = {}) {\n      var pathData = pathMap.getScaledPath('EVENT_PARALLEL_MULTIPLE', {\n        xScaleFactor: 1.2,\n        yScaleFactor: 1.2,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.458,\n          my: 0.194\n        }\n      });\n\n      return drawPath(parentGfx, pathData, {\n        fill: getFillColor(event, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:TerminateEventDefinition': function(parentGfx, element, attrs = {}) {\n      var circle = drawCircle(parentGfx, element.width, element.height, 8, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 4\n      });\n\n      return circle;\n    }\n  };\n\n  function renderEventIcon(element, parentGfx, attrs = {}) {\n    var semantic = getSemantic(element),\n        isThrowing = isThrowEvent(semantic);\n\n    if (semantic.get('eventDefinitions') && semantic.get('eventDefinitions').length > 1) {\n      if (semantic.get('parallelMultiple')) {\n        return eventIconRenderers[ 'bpmn:ParallelMultipleEventDefinition' ](parentGfx, element, attrs, isThrowing);\n      }\n      else {\n        return eventIconRenderers[ 'bpmn:MultipleEventDefinition' ](parentGfx, element, attrs, isThrowing);\n      }\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:MessageEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:MessageEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:TimerEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:TimerEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:ConditionalEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:ConditionalEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:SignalEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:SignalEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:EscalationEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:EscalationEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:LinkEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:LinkEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:ErrorEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:ErrorEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:CancelEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:CancelEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:CompensateEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:CompensateEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:TerminateEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:TerminateEventDefinition' ](parentGfx, element, attrs, isThrowing);\n    }\n\n    return null;\n  }\n\n  var taskMarkerRenderers = {\n    'ParticipantMultiplicityMarker': function(parentGfx, element, attrs = {}) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_PARALLEL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 - 6) / width),\n          my: (height - 15) / height\n        }\n      });\n\n      drawMarker('participant-multiplicity', parentGfx, markerPath, {\n        strokeWidth: 2,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'SubProcessMarker': function(parentGfx, element, attrs = {}) {\n      var markerRect = drawRect(parentGfx, 14, 14, 0, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      translate(markerRect, element.width / 2 - 7.5, element.height - 20);\n\n      var markerPath = pathMap.getScaledPath('MARKER_SUB_PROCESS', {\n        xScaleFactor: 1.5,\n        yScaleFactor: 1.5,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 - 7.5) / element.width,\n          my: (element.height - 20) / element.height\n        }\n      });\n\n      drawMarker('sub-process', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'ParallelMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_PARALLEL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.parallel) / width),\n          my: (height - 20) / height\n        }\n      });\n\n      drawMarker('parallel', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'SequentialMarker': function(parentGfx, element, attrs) {\n      var markerPath = pathMap.getScaledPath('MARKER_SEQUENTIAL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: ((element.width / 2 + attrs.seq) / element.width),\n          my: (element.height - 19) / element.height\n        }\n      });\n\n      drawMarker('sequential', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'CompensationMarker': function(parentGfx, element, attrs) {\n      var markerMath = pathMap.getScaledPath('MARKER_COMPENSATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: ((element.width / 2 + attrs.compensation) / element.width),\n          my: (element.height - 13) / element.height\n        }\n      });\n\n      drawMarker('compensation', parentGfx, markerMath, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'LoopMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_LOOP', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.loop) / width),\n          my: (height - 7) / height\n        }\n      });\n\n      drawMarker('loop', parentGfx, markerPath, {\n        strokeWidth: 1.5,\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeMiterlimit: 0.5\n      });\n    },\n    'AdhocMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_ADHOC', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.adhoc) / width),\n          my: (height - 15) / height\n        }\n      });\n\n      drawMarker('adhoc', parentGfx, markerPath, {\n        strokeWidth: 1,\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    }\n  };\n\n  function renderTaskMarker(type, parentGfx, element, attrs) {\n    taskMarkerRenderers[ type ](parentGfx, element, attrs);\n  }\n\n  function renderTaskMarkers(parentGfx, element, taskMarkers, attrs = {}) {\n    attrs = {\n      fill: attrs.fill,\n      stroke: attrs.stroke,\n      width: getWidth(element, attrs),\n      height: getHeight(element, attrs)\n    };\n\n    var semantic = getSemantic(element);\n\n    var subprocess = taskMarkers && taskMarkers.includes('SubProcessMarker');\n\n    if (subprocess) {\n      attrs = {\n        ...attrs,\n        seq: -21,\n        parallel: -22,\n        compensation: -42,\n        loop: -18,\n        adhoc: 10\n      };\n    } else {\n      attrs = {\n        ...attrs,\n        seq: -5,\n        parallel: -6,\n        compensation: -27,\n        loop: 0,\n        adhoc: 10\n      };\n    }\n\n    forEach(taskMarkers, function(marker) {\n      renderTaskMarker(marker, parentGfx, element, attrs);\n    });\n\n    if (semantic.get('isForCompensation')) {\n      renderTaskMarker('CompensationMarker', parentGfx, element, attrs);\n    }\n\n    if (is(semantic, 'bpmn:AdHocSubProcess')) {\n      renderTaskMarker('AdhocMarker', parentGfx, element, attrs);\n    }\n\n    var loopCharacteristics = semantic.get('loopCharacteristics'),\n        isSequential = loopCharacteristics && loopCharacteristics.get('isSequential');\n\n    if (loopCharacteristics) {\n\n      if (isSequential === undefined) {\n        renderTaskMarker('LoopMarker', parentGfx, element, attrs);\n      }\n\n      if (isSequential === false) {\n        renderTaskMarker('ParallelMarker', parentGfx, element, attrs);\n      }\n\n      if (isSequential === true) {\n        renderTaskMarker('SequentialMarker', parentGfx, element, attrs);\n      }\n    }\n  }\n\n  function renderLabel(parentGfx, label, attrs = {}) {\n    attrs = assign({\n      size: {\n        width: 100\n      }\n    }, attrs);\n\n    var text = textRenderer.createText(label || '', attrs);\n\n    svgClasses(text).add('djs-label');\n\n    svgAppend(parentGfx, text);\n\n    return text;\n  }\n\n  function renderEmbeddedLabel(parentGfx, element, align, attrs = {}) {\n    var semantic = getSemantic(element);\n\n    var box = getBounds({\n      x: element.x,\n      y: element.y,\n      width: element.width,\n      height: element.height\n    }, attrs);\n\n    return renderLabel(parentGfx, semantic.name, {\n      align,\n      box,\n      padding: 7,\n      style: {\n        fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n      }\n    });\n  }\n\n  function renderExternalLabel(parentGfx, element, attrs = {}) {\n    var box = {\n      width: 90,\n      height: 30,\n      x: element.width / 2 + element.x,\n      y: element.height / 2 + element.y\n    };\n\n    return renderLabel(parentGfx, getLabel(element), {\n      box: box,\n      fitBox: true,\n      style: assign(\n        {},\n        textRenderer.getExternalStyle(),\n        {\n          fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n        }\n      )\n    });\n  }\n\n  function renderLaneLabel(parentGfx, text, element, attrs = {}) {\n    var isHorizontalLane = isHorizontal(element);\n\n    var textBox = renderLabel(parentGfx, text, {\n      box: {\n        height: 30,\n        width: isHorizontalLane ? getHeight(element, attrs) : getWidth(element, attrs),\n      },\n      align: 'center-middle',\n      style: {\n        fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n      }\n    });\n\n    if (isHorizontalLane) {\n      var top = -1 * getHeight(element, attrs);\n      transform(textBox, 0, -top, 270);\n    }\n  }\n\n  function renderActivity(parentGfx, element, attrs = {}) {\n    var {\n      width,\n      height\n    } = getBounds(element, attrs);\n\n    return drawRect(parentGfx, width, height, TASK_BORDER_RADIUS, {\n      ...attrs,\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderAssociation(parentGfx, element, attrs = {}) {\n    var semantic = getSemantic(element);\n\n    var fill = getFillColor(element, defaultFillColor, attrs.fill),\n        stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n    if (semantic.get('associationDirection') === 'One' ||\n        semantic.get('associationDirection') === 'Both') {\n      attrs.markerEnd = marker('association-end', fill, stroke);\n    }\n\n    if (semantic.get('associationDirection') === 'Both') {\n      attrs.markerStart = marker('association-start', fill, stroke);\n    }\n\n    attrs = pickAttrs(attrs, [\n      'markerStart',\n      'markerEnd'\n    ]);\n\n    return drawConnectionSegments(parentGfx, element.waypoints, {\n      ...attrs,\n      stroke,\n      strokeDasharray: '0, 5'\n    });\n  }\n\n  function renderDataObject(parentGfx, element, attrs = {}) {\n    var fill = getFillColor(element, defaultFillColor, attrs.fill),\n        stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n    var pathData = pathMap.getScaledPath('DATA_OBJECT_PATH', {\n      xScaleFactor: 1,\n      yScaleFactor: 1,\n      containerWidth: element.width,\n      containerHeight: element.height,\n      position: {\n        mx: 0.474,\n        my: 0.296\n      }\n    });\n\n    var dataObject = drawPath(parentGfx, pathData, {\n      fill,\n      fillOpacity: DEFAULT_OPACITY,\n      stroke\n    });\n\n    var semantic = getSemantic(element);\n\n    if (isCollection(semantic)) {\n      var collectionPathData = pathMap.getScaledPath('DATA_OBJECT_COLLECTION_PATH', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.33,\n          my: (element.height - 18) / element.height\n        }\n      });\n\n      drawPath(parentGfx, collectionPathData, {\n        strokeWidth: 2,\n        fill,\n        stroke\n      });\n    }\n\n    return dataObject;\n  }\n\n  function renderEvent(parentGfx, element, attrs = {}) {\n    return drawCircle(parentGfx, element.width, element.height, {\n      fillOpacity: DEFAULT_OPACITY,\n      ...attrs,\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderGateway(parentGfx, element, attrs = {}) {\n    return drawDiamond(parentGfx, element.width, element.height, {\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderLane(parentGfx, element, attrs = {}) {\n    var lane = drawRect(parentGfx, getWidth(element, attrs), getHeight(element, attrs), 0, {\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: attrs.fillOpacity || DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n      strokeWidth: 1.5\n    });\n\n    var semantic = getSemantic(element);\n\n    if (is(semantic, 'bpmn:Lane')) {\n      var text = semantic.get('name');\n\n      renderLaneLabel(parentGfx, text, element, attrs);\n    }\n\n    return lane;\n  }\n\n  function renderSubProcess(parentGfx, element, attrs = {}) {\n    var activity = renderActivity(parentGfx, element, attrs);\n\n    if (isEventSubProcess(element)) {\n      svgAttr(activity, {\n        strokeDasharray: '0, 5.5',\n        strokeWidth: 2.5\n      });\n    }\n\n    var expanded = isExpanded(element);\n\n    renderEmbeddedLabel(parentGfx, element, expanded ? 'center-top' : 'center-middle', attrs);\n\n    if (expanded) {\n      renderTaskMarkers(parentGfx, element, undefined, attrs);\n    } else {\n      renderTaskMarkers(parentGfx, element, [ 'SubProcessMarker' ], attrs);\n    }\n\n    return activity;\n  }\n\n  function renderTask(parentGfx, element, attrs = {}) {\n    var activity = renderActivity(parentGfx, element, attrs);\n\n    renderEmbeddedLabel(parentGfx, element, 'center-middle', attrs);\n\n    renderTaskMarkers(parentGfx, element, undefined, attrs);\n\n    return activity;\n  }\n\n  var handlers = this.handlers = {\n    'bpmn:AdHocSubProcess': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      return renderSubProcess(parentGfx, element, attrs);\n    },\n    'bpmn:Association': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, attrs);\n    },\n    'bpmn:BoundaryEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element),\n          cancelActivity = semantic.get('cancelActivity');\n\n      attrs = {\n        strokeWidth: 1.5,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        fillOpacity: FULL_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      };\n\n      if (!cancelActivity) {\n        attrs.strokeDasharray = '6';\n      }\n\n      var event = renderEvent(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, INNER_OUTER_DIST, {\n        ...attrs,\n        fill: 'none'\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:BusinessRuleTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var headerData = pathMap.getScaledPath('TASK_TYPE_BUSINESS_RULE_MAIN', {\n        abspos: {\n          x: 8,\n          y: 8\n        }\n      });\n\n      var businessPath = drawPath(parentGfx, headerData);\n\n      svgAttr(businessPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      var headerPathData = pathMap.getScaledPath('TASK_TYPE_BUSINESS_RULE_HEADER', {\n        abspos: {\n          x: 8,\n          y: 8\n        }\n      });\n\n      var businessHeaderPath = drawPath(parentGfx, headerPathData);\n\n      svgAttr(businessHeaderPath, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:CallActivity': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderSubProcess(parentGfx, element, {\n        strokeWidth: 5,\n        ...attrs\n      });\n    },\n    'bpmn:ComplexGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_COMPLEX', {\n        xScaleFactor: 0.5,\n        yScaleFactor:0.5,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.46,\n          my: 0.26\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return gateway;\n    },\n    'bpmn:DataInput': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var arrowPathData = pathMap.getRawPath('DATA_ARROW');\n\n      var dataObject = renderDataObject(parentGfx, element, attrs);\n\n      drawPath(parentGfx, arrowPathData, {\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return dataObject;\n    },\n    'bpmn:DataInputAssociation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, {\n        ...attrs,\n        markerEnd: marker('association-end', getFillColor(element, defaultFillColor, attrs.fill), getStrokeColor(element, defaultStrokeColor, attrs.stroke))\n      });\n    },\n    'bpmn:DataObject': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderDataObject(parentGfx, element, attrs);\n    },\n    'bpmn:DataObjectReference': as('bpmn:DataObject'),\n    'bpmn:DataOutput': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var arrowPathData = pathMap.getRawPath('DATA_ARROW');\n\n      var dataObject = renderDataObject(parentGfx, element, attrs);\n\n      drawPath(parentGfx, arrowPathData, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      return dataObject;\n    },\n    'bpmn:DataOutputAssociation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, {\n        ...attrs,\n        markerEnd: marker('association-end', getFillColor(element, defaultFillColor, attrs.fill), getStrokeColor(element, defaultStrokeColor, attrs.stroke))\n      });\n    },\n    'bpmn:DataStoreReference': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var dataStorePath = pathMap.getScaledPath('DATA_STORE', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0,\n          my: 0.133\n        }\n      });\n\n      return drawPath(parentGfx, dataStorePath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        fillOpacity: DEFAULT_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 2\n      });\n    },\n    'bpmn:EndEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var event = renderEvent(parentGfx, element, {\n        ...attrs,\n        strokeWidth: 4\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:EventBasedGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      var diamond = renderGateway(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, element.height * 0.20, {\n        fill: getFillColor(element, 'none', attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      var type = semantic.get('eventGatewayType'),\n          instantiate = !!semantic.get('instantiate');\n\n      function drawEvent() {\n\n        var pathData = pathMap.getScaledPath('GATEWAY_EVENT_BASED', {\n          xScaleFactor: 0.18,\n          yScaleFactor: 0.18,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.36,\n            my: 0.44\n          }\n        });\n\n        drawPath(parentGfx, pathData, {\n          fill: 'none',\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 2\n        });\n      }\n\n      if (type === 'Parallel') {\n        var pathData = pathMap.getScaledPath('GATEWAY_PARALLEL', {\n          xScaleFactor: 0.4,\n          yScaleFactor: 0.4,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.474,\n            my: 0.296\n          }\n        });\n\n        drawPath(parentGfx, pathData, {\n          fill: 'none',\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n      } else if (type === 'Exclusive') {\n        if (!instantiate) {\n          drawCircle(parentGfx, element.width, element.height, element.height * 0.26, {\n            fill: 'none',\n            stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n            strokeWidth: 1\n          });\n        }\n\n        drawEvent();\n      }\n\n\n      return diamond;\n    },\n    'bpmn:ExclusiveGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_EXCLUSIVE', {\n        xScaleFactor: 0.4,\n        yScaleFactor: 0.4,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.32,\n          my: 0.3\n        }\n      });\n\n      var di = getDi(element);\n\n      if (di.get('isMarkerVisible')) {\n        drawPath(parentGfx, pathData, {\n          fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n      }\n\n      return gateway;\n    },\n    'bpmn:Gateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderGateway(parentGfx, element, attrs);\n    },\n    'bpmn:Group': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      return drawRect(parentGfx, element.width, element.height, TASK_BORDER_RADIUS, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5,\n        strokeDasharray: '10, 6, 0, 6',\n        fill: 'none',\n        pointerEvents: 'none',\n        width: getWidth(element, attrs),\n        height: getHeight(element, attrs)\n      });\n    },\n    'bpmn:InclusiveGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, element.height * 0.24, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 2.5\n      });\n\n      return gateway;\n    },\n    'bpmn:IntermediateEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var outer = renderEvent(parentGfx, element, {\n        ...attrs,\n        strokeWidth: 1.5\n      });\n\n      drawCircle(parentGfx, element.width, element.height, INNER_OUTER_DIST, {\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return outer;\n    },\n    'bpmn:IntermediateCatchEvent': as('bpmn:IntermediateEvent'),\n    'bpmn:IntermediateThrowEvent': as('bpmn:IntermediateEvent'),\n    'bpmn:Lane': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      return renderLane(parentGfx, element, {\n        ...attrs,\n        fillOpacity: LOW_OPACITY\n      });\n    },\n    'bpmn:ManualTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_MANUAL', {\n        abspos: {\n          x: 17,\n          y: 15\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      return task;\n    },\n    'bpmn:MessageFlow': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element),\n          di = getDi(element);\n\n      var fill = getFillColor(element, defaultFillColor, attrs.fill),\n          stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var path = drawConnectionSegments(parentGfx, element.waypoints, {\n        markerEnd: marker('messageflow-end', fill, stroke),\n        markerStart: marker('messageflow-start', fill, stroke),\n        stroke,\n        strokeDasharray: '10, 11',\n        strokeWidth: 1.5\n      });\n\n      if (semantic.get('messageRef')) {\n        var midPoint = path.getPointAtLength(path.getTotalLength() / 2);\n\n        var markerPathData = pathMap.getScaledPath('MESSAGE_FLOW_MARKER', {\n          abspos: {\n            x: midPoint.x,\n            y: midPoint.y\n          }\n        });\n\n        var messageAttrs = {\n          strokeWidth: 1\n        };\n\n        if (di.get('messageVisibleKind') === 'initiating') {\n          messageAttrs.fill = fill;\n          messageAttrs.stroke = stroke;\n        } else {\n          messageAttrs.fill = stroke;\n          messageAttrs.stroke = fill;\n        }\n\n        var message = drawPath(parentGfx, markerPathData, messageAttrs);\n\n        var messageRef = semantic.get('messageRef'),\n            name = messageRef.get('name');\n\n        var label = renderLabel(parentGfx, name, {\n          align: 'center-top',\n          fitBox: true,\n          style: {\n            fill: stroke\n          }\n        });\n\n        var messageBounds = message.getBBox(),\n            labelBounds = label.getBBox();\n\n        var translateX = midPoint.x - labelBounds.width / 2,\n            translateY = midPoint.y + messageBounds.height / 2 + ELEMENT_LABEL_DISTANCE;\n\n        transform(label, translateX, translateY, 0);\n      }\n\n      return path;\n    },\n    'bpmn:ParallelGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var diamond = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_PARALLEL', {\n        xScaleFactor: 0.6,\n        yScaleFactor: 0.6,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.46,\n          my: 0.2\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return diamond;\n    },\n    'bpmn:Participant': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      var participant = renderLane(parentGfx, element, attrs);\n\n      var expandedParticipant = isExpanded(element);\n      var horizontalParticipant = isHorizontal(element);\n\n      var semantic = getSemantic(element),\n          name = semantic.get('name');\n\n      if (expandedParticipant) {\n        var waypoints = horizontalParticipant ? [\n          {\n            x: 30,\n            y: 0\n          },\n          {\n            x: 30,\n            y: getHeight(element, attrs)\n          }\n        ] : [\n          {\n            x: 0,\n            y: 30\n          },\n          {\n            x: getWidth(element, attrs),\n            y: 30\n          }\n        ];\n\n        drawLine(parentGfx, waypoints, {\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: PARTICIPANT_STROKE_WIDTH\n        });\n\n        renderLaneLabel(parentGfx, name, element, attrs);\n      } else {\n        var bounds = getBounds(element, attrs);\n\n        if (!horizontalParticipant) {\n          bounds.height = getWidth(element, attrs);\n          bounds.width = getHeight(element, attrs);\n        }\n\n        var textBox = renderLabel(parentGfx, name, {\n          box: bounds,\n          align: 'center-middle',\n          style: {\n            fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n          }\n        });\n\n        if (!horizontalParticipant) {\n          var top = -1 * getHeight(element, attrs);\n          transform(textBox, 0, -top, 270);\n        }\n      }\n\n      if (semantic.get('participantMultiplicity')) {\n        renderTaskMarker('ParticipantMultiplicityMarker', parentGfx, element, attrs);\n      }\n\n      return participant;\n    },\n    'bpmn:ReceiveTask' : function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData;\n\n      if (semantic.get('instantiate')) {\n        drawCircle(parentGfx, 28, 28, 20 * 0.22, {\n          fill: getFillColor(element, defaultFillColor, attrs.fill),\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n\n        pathData = pathMap.getScaledPath('TASK_TYPE_INSTANTIATING_SEND', {\n          abspos: {\n            x: 7.77,\n            y: 9.52\n          }\n        });\n      } else {\n        pathData = pathMap.getScaledPath('TASK_TYPE_SEND', {\n          xScaleFactor: 0.9,\n          yScaleFactor: 0.9,\n          containerWidth: 21,\n          containerHeight: 14,\n          position: {\n            mx: 0.3,\n            my: 0.4\n          }\n        });\n      }\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:ScriptTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_SCRIPT', {\n        abspos: {\n          x: 15,\n          y: 20\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:SendTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_SEND', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: 21,\n        containerHeight: 14,\n        position: {\n          mx: 0.285,\n          my: 0.357\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getFillColor(element, defaultFillColor, attrs.fill),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:SequenceFlow': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var fill = getFillColor(element, defaultFillColor, attrs.fill),\n          stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var connection = drawConnectionSegments(parentGfx, element.waypoints, {\n        markerEnd: marker('sequenceflow-end', fill, stroke),\n        stroke\n      });\n\n      var semantic = getSemantic(element);\n\n      var { source } = element;\n\n      if (source) {\n        var sourceSemantic = getSemantic(source);\n\n        // conditional flow marker\n        if (semantic.get('conditionExpression') && is(sourceSemantic, 'bpmn:Activity')) {\n          svgAttr(connection, {\n            markerStart: marker('conditional-flow-marker', fill, stroke)\n          });\n        }\n\n        // default marker\n        if (sourceSemantic.get('default') && (is(sourceSemantic, 'bpmn:Gateway') || is(sourceSemantic, 'bpmn:Activity')) &&\n            sourceSemantic.get('default') === semantic) {\n          svgAttr(connection, {\n            markerStart: marker('conditional-default-flow-marker', fill, stroke)\n          });\n        }\n      }\n\n      return connection;\n    },\n    'bpmn:ServiceTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, 10, 10, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: 'none',\n        transform: 'translate(6, 6)'\n      });\n\n      var pathDataService1 = pathMap.getScaledPath('TASK_TYPE_SERVICE', {\n        abspos: {\n          x: 12,\n          y: 18\n        }\n      });\n\n      drawPath(parentGfx, pathDataService1, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      drawCircle(parentGfx, 10, 10, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: 'none',\n        transform: 'translate(11, 10)'\n      });\n\n      var pathDataService2 = pathMap.getScaledPath('TASK_TYPE_SERVICE', {\n        abspos: {\n          x: 17,\n          y: 22\n        }\n      });\n\n      drawPath(parentGfx, pathDataService2, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:StartEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      if (!semantic.get('isInterrupting')) {\n        attrs = {\n          ...attrs,\n          strokeDasharray: '6'\n        };\n      }\n\n      var event = renderEvent(parentGfx, element, attrs);\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:SubProcess': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      return renderSubProcess(parentGfx, element, attrs);\n    },\n    'bpmn:Task': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderTask(parentGfx, element, attrs);\n    },\n    'bpmn:TextAnnotation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      var {\n        width,\n        height\n      } = getBounds(element, attrs);\n\n      var textElement = drawRect(parentGfx, width, height, 0, 0, {\n        fill: 'none',\n        stroke: 'none'\n      });\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      drawPath(parentGfx, textPathData, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      var semantic = getSemantic(element),\n          text = semantic.get('text') || '';\n\n      renderLabel(parentGfx, text, {\n        align: 'left-top',\n        box: getBounds(element, attrs),\n        padding: 7,\n        style: {\n          fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n        }\n      });\n\n      return textElement;\n    },\n    'bpmn:Transaction': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      var outer = renderSubProcess(parentGfx, element, {\n        strokeWidth: 1.5,\n        ...attrs\n      });\n\n      var innerAttrs = styles.style([ 'no-fill', 'no-events' ], {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5\n      });\n\n      var expanded = isExpanded(element);\n\n      if (!expanded) {\n        attrs = {};\n      }\n\n      drawRect(\n        parentGfx,\n        getWidth(element, attrs),\n        getHeight(element, attrs),\n        TASK_BORDER_RADIUS - INNER_OUTER_DIST,\n        INNER_OUTER_DIST,\n        innerAttrs\n      );\n\n      return outer;\n    },\n    'bpmn:UserTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var x = 15;\n      var y = 12;\n\n      var pathDataUser1 = pathMap.getScaledPath('TASK_TYPE_USER_1', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser1, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      var pathDataUser2 = pathMap.getScaledPath('TASK_TYPE_USER_2', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser2, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      var pathDataUser3 = pathMap.getScaledPath('TASK_TYPE_USER_3', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser3, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      return task;\n    },\n    'label': function(parentGfx, element, attrs = {}) {\n      return renderExternalLabel(parentGfx, element, attrs);\n    }\n  };\n\n  // extension API, use at your own risk\n  this._drawPath = drawPath;\n\n  this._renderer = renderer;\n}\n\n\ninherits(BpmnRenderer, BaseRenderer);\n\nBpmnRenderer.$inject = [\n  'config.bpmnRenderer',\n  'eventBus',\n  'styles',\n  'pathMap',\n  'canvas',\n  'textRenderer'\n];\n\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nBpmnRenderer.prototype.canRender = function(element) {\n  return is(element, 'bpmn:BaseElement');\n};\n\n/**\n * Draw shape into parentGfx.\n *\n * @param {SVGElement} parentGfx\n * @param {Element} element\n * @param {Attrs} [attrs]\n *\n * @return {SVGElement} mainGfx\n */\nBpmnRenderer.prototype.drawShape = function(parentGfx, element, attrs = {}) {\n  var { type } = element;\n\n  var handler = this._renderer(type);\n\n  return handler(parentGfx, element, attrs);\n};\n\n/**\n * Draw connection into parentGfx.\n *\n * @param {SVGElement} parentGfx\n * @param {Element} element\n * @param {Attrs} [attrs]\n *\n * @return {SVGElement} mainGfx\n */\nBpmnRenderer.prototype.drawConnection = function(parentGfx, element, attrs = {}) {\n  var { type } = element;\n\n  var handler = this._renderer(type);\n\n  return handler(parentGfx, element, attrs);\n};\n\n/**\n * Get shape path.\n *\n * @param {Element} element\n *\n * @return {string} path\n */\nBpmnRenderer.prototype.getShapePath = function(element) {\n  if (is(element, 'bpmn:Event')) {\n    return getCirclePath(element);\n  }\n\n  if (is(element, 'bpmn:Activity')) {\n    return getRoundRectPath(element, TASK_BORDER_RADIUS);\n  }\n\n  if (is(element, 'bpmn:Gateway')) {\n    return getDiamondPath(element);\n  }\n\n  return getRectPath(element);\n};\n\n/**\n * Pick attributes if they exist.\n *\n * @param {Object} attrs\n * @param {string[]} keys\n *\n * @returns {Object}\n */\nfunction pickAttrs(attrs, keys = []) {\n  return keys.reduce((pickedAttrs, key) => {\n    if (attrs[ key ]) {\n      pickedAttrs[ key ] = attrs[ key ];\n    }\n\n    return pickedAttrs;\n  }, {});\n}","import {\r\n  isObject,\r\n  assign,\r\n  forEach,\r\n  reduce\r\n} from 'min-dash';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  assignStyle\r\n} from 'min-dom';\r\n\r\n\r\n/**\r\n * @typedef {import('../util/Types').Dimensions} Dimensions\r\n *\r\n * @typedef { {\r\n *   top: number;\r\n *   left: number;\r\n *   right: number;\r\n *   bottom: number;\r\n * } } Padding\r\n *\r\n * @typedef { number | Partial<Padding> } PaddingConfig\r\n *\r\n * @typedef { {\r\n *   horizontal: 'center' | 'left' | 'right';\r\n *   vertical: 'top' | 'middle';\r\n * } } Alignment\r\n *\r\n *  @typedef { 'center-middle' | 'center-top' } AlignmentConfig\r\n *\r\n * @typedef { Partial<{\r\n *   align: AlignmentConfig;\r\n *   style: Record<string, number | string>;\r\n *   padding: PaddingConfig;\r\n * }> } BaseTextConfig\r\n *\r\n * @typedef { BaseTextConfig & Partial<{\r\n *   size: Dimensions;\r\n * }> } TextConfig\r\n *\r\n * @typedef { BaseTextConfig & Partial<{\r\n *   box: Dimensions;\r\n *   fitBox: boolean;\r\n * }> } TextLayoutConfig\r\n *\r\n *  @typedef { Dimensions & {\r\n *  text: string;\r\n * } } LineDescriptor\r\n */\r\n\r\nvar DEFAULT_BOX_PADDING = 0;\r\n\r\nvar DEFAULT_LABEL_SIZE = {\r\n  width: 150,\r\n  height: 50\r\n};\r\n\r\n\r\n/**\r\n * @param {AlignmentConfig} align\r\n * @return {Alignment}\r\n */\r\nfunction parseAlign(align) {\r\n\r\n  var parts = align.split('-');\r\n\r\n  return {\r\n    horizontal: parts[0] || 'center',\r\n    vertical: parts[1] || 'top'\r\n  };\r\n}\r\n\r\n/**\r\n * @param {PaddingConfig} padding\r\n *\r\n * @return {Padding}\r\n */\r\nfunction parsePadding(padding) {\r\n\r\n  if (isObject(padding)) {\r\n    return assign({ top: 0, left: 0, right: 0, bottom: 0 }, padding);\r\n  } else {\r\n    return {\r\n      top: padding,\r\n      left: padding,\r\n      right: padding,\r\n      bottom: padding\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * @param {string} text\r\n * @param {SVGTextElement} fakeText\r\n *\r\n * @return {import('../util/Types').Dimensions}\r\n */\r\nfunction getTextBBox(text, fakeText) {\r\n\r\n  fakeText.textContent = text;\r\n\r\n  var textBBox;\r\n\r\n  try {\r\n    var bbox,\r\n        emptyLine = text === '';\r\n\r\n    // add dummy text, when line is empty to\r\n    // determine correct height\r\n    fakeText.textContent = emptyLine ? 'dummy' : text;\r\n\r\n    textBBox = fakeText.getBBox();\r\n\r\n    // take text rendering related horizontal\r\n    // padding into account\r\n    bbox = {\r\n      width: textBBox.width + textBBox.x * 2,\r\n      height: textBBox.height\r\n    };\r\n\r\n    if (emptyLine) {\r\n\r\n      // correct width\r\n      bbox.width = 0;\r\n    }\r\n\r\n    return bbox;\r\n  } catch (e) {\r\n    return { width: 0, height: 0 };\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Layout the next line and return the layouted element.\r\n *\r\n * Alters the lines passed.\r\n *\r\n * @param {string[]} lines\r\n * @param {number} maxWidth\r\n * @param {SVGTextElement} fakeText\r\n *\r\n * @return {LineDescriptor} the line descriptor\r\n */\r\nfunction layoutNext(lines, maxWidth, fakeText) {\r\n\r\n  var originalLine = lines.shift(),\r\n      fitLine = originalLine;\r\n\r\n  var textBBox;\r\n\r\n  for (;;) {\r\n    textBBox = getTextBBox(fitLine, fakeText);\r\n\r\n    textBBox.width = fitLine ? textBBox.width : 0;\r\n\r\n    // try to fit\r\n    if (fitLine === ' ' || fitLine === '' || textBBox.width < Math.round(maxWidth) || fitLine.length < 2) {\r\n      return fit(lines, fitLine, originalLine, textBBox);\r\n    }\r\n\r\n    fitLine = shortenLine(fitLine, textBBox.width, maxWidth);\r\n  }\r\n}\r\n\r\n/**\r\n * @param {string[]} lines\r\n * @param {string} fitLine\r\n * @param {string} originalLine\r\n * @param {Dimensions} textBBox\r\n *\r\n * @return {LineDescriptor}\r\n */\r\nfunction fit(lines, fitLine, originalLine, textBBox) {\r\n  if (fitLine.length < originalLine.length) {\r\n    var remainder = originalLine.slice(fitLine.length).trim();\r\n\r\n    lines.unshift(remainder);\r\n  }\r\n\r\n  return {\r\n    width: textBBox.width,\r\n    height: textBBox.height,\r\n    text: fitLine\r\n  };\r\n}\r\n\r\nvar SOFT_BREAK = '\\u00AD';\r\n\r\n\r\n/**\r\n * Shortens a line based on spacing and hyphens.\r\n * Returns the shortened result on success.\r\n *\r\n * @param {string} line\r\n * @param {number} maxLength the maximum characters of the string\r\n *\r\n * @return {string} the shortened string\r\n */\r\nfunction semanticShorten(line, maxLength) {\r\n\r\n  var parts = line.split(/(\\s|-|\\u00AD)/g),\r\n      part,\r\n      shortenedParts = [],\r\n      length = 0;\r\n\r\n  // try to shorten via break chars\r\n  if (parts.length > 1) {\r\n\r\n    while ((part = parts.shift())) {\r\n      if (part.length + length < maxLength) {\r\n        shortenedParts.push(part);\r\n        length += part.length;\r\n      } else {\r\n\r\n        // remove previous part, too if hyphen does not fit anymore\r\n        if (part === '-' || part === SOFT_BREAK) {\r\n          shortenedParts.pop();\r\n        }\r\n\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  var last = shortenedParts[shortenedParts.length - 1];\r\n\r\n  // translate trailing soft break to actual hyphen\r\n  if (last && last === SOFT_BREAK) {\r\n    shortenedParts[shortenedParts.length - 1] = '-';\r\n  }\r\n\r\n  return shortenedParts.join('');\r\n}\r\n\r\n\r\n/**\r\n * @param {string} line\r\n * @param {number} width\r\n * @param {number} maxWidth\r\n *\r\n * @return {string}\r\n */\r\nfunction shortenLine(line, width, maxWidth) {\r\n  var length = Math.max(line.length * (maxWidth / width), 1);\r\n\r\n  // try to shorten semantically (i.e. based on spaces and hyphens)\r\n  var shortenedLine = semanticShorten(line, length);\r\n\r\n  if (!shortenedLine) {\r\n\r\n    // force shorten by cutting the long word\r\n    shortenedLine = line.slice(0, Math.max(Math.round(length - 1), 1));\r\n  }\r\n\r\n  return shortenedLine;\r\n}\r\n\r\n\r\n/**\r\n * @return {SVGSVGElement}\r\n */\r\nfunction getHelperSvg() {\r\n  var helperSvg = document.getElementById('helper-svg');\r\n\r\n  if (!helperSvg) {\r\n    helperSvg = svgCreate('svg');\r\n\r\n    svgAttr(helperSvg, {\r\n      id: 'helper-svg'\r\n    });\r\n\r\n    assignStyle(helperSvg, {\r\n      visibility: 'hidden',\r\n      position: 'fixed',\r\n      width: 0,\r\n      height: 0\r\n    });\r\n\r\n    document.body.appendChild(helperSvg);\r\n  }\r\n\r\n  return helperSvg;\r\n}\r\n\r\n\r\n/**\r\n * Creates a new label utility\r\n *\r\n * @param {TextConfig} [config]\r\n */\r\nexport default function Text(config) {\r\n\r\n  this._config = assign({}, {\r\n    size: DEFAULT_LABEL_SIZE,\r\n    padding: DEFAULT_BOX_PADDING,\r\n    style: {},\r\n    align: 'center-top'\r\n  }, config || {});\r\n}\r\n\r\n/**\r\n * Returns the layouted text as an SVG element.\r\n *\r\n * @param {string} text\r\n * @param {TextLayoutConfig} options\r\n *\r\n * @return {SVGElement}\r\n */\r\nText.prototype.createText = function(text, options) {\r\n  return this.layoutText(text, options).element;\r\n};\r\n\r\n/**\r\n * Returns a labels layouted dimensions.\r\n *\r\n * @param {string} text to layout\r\n * @param {TextLayoutConfig} options\r\n *\r\n * @return {Dimensions}\r\n */\r\nText.prototype.getDimensions = function(text, options) {\r\n  return this.layoutText(text, options).dimensions;\r\n};\r\n\r\n/**\r\n * Creates and returns a label and its bounding box.\r\n *\r\n * @param {string} text the text to render on the label\r\n * @param {TextLayoutConfig} options\r\n *\r\n * @return { {\r\n *   element: SVGElement,\r\n *   dimensions: Dimensions\r\n * } }\r\n */\r\nText.prototype.layoutText = function(text, options) {\r\n  var box = assign({}, this._config.size, options.box),\r\n      style = assign({}, this._config.style, options.style),\r\n      align = parseAlign(options.align || this._config.align),\r\n      padding = parsePadding(options.padding !== undefined ? options.padding : this._config.padding),\r\n      fitBox = options.fitBox || false;\r\n\r\n  var lineHeight = getLineHeight(style);\r\n\r\n  // we split text by lines and normalize\r\n  // {soft break} + {line break} => { line break }\r\n  var lines = text.split(/\\u00AD?\\r?\\n/),\r\n      layouted = [];\r\n\r\n  var maxWidth = box.width - padding.left - padding.right;\r\n\r\n  // ensure correct rendering by attaching helper text node to invisible SVG\r\n  var helperText = svgCreate('text');\r\n  svgAttr(helperText, { x: 0, y: 0 });\r\n  svgAttr(helperText, style);\r\n\r\n  var helperSvg = getHelperSvg();\r\n\r\n  svgAppend(helperSvg, helperText);\r\n\r\n  while (lines.length) {\r\n    layouted.push(layoutNext(lines, maxWidth, helperText));\r\n  }\r\n\r\n  if (align.vertical === 'middle') {\r\n    padding.top = padding.bottom = 0;\r\n  }\r\n\r\n  var totalHeight = reduce(layouted, function(sum, line, idx) {\r\n    return sum + (lineHeight || line.height);\r\n  }, 0) + padding.top + padding.bottom;\r\n\r\n  var maxLineWidth = reduce(layouted, function(sum, line, idx) {\r\n    return line.width > sum ? line.width : sum;\r\n  }, 0);\r\n\r\n  // the y position of the next line\r\n  var y = padding.top;\r\n\r\n  if (align.vertical === 'middle') {\r\n    y += (box.height - totalHeight) / 2;\r\n  }\r\n\r\n  // magic number initial offset\r\n  y -= (lineHeight || layouted[0].height) / 4;\r\n\r\n\r\n  var textElement = svgCreate('text');\r\n\r\n  svgAttr(textElement, style);\r\n\r\n  // layout each line taking into account that parent\r\n  // shape might resize to fit text size\r\n  forEach(layouted, function(line) {\r\n\r\n    var x;\r\n\r\n    y += (lineHeight || line.height);\r\n\r\n    switch (align.horizontal) {\r\n    case 'left':\r\n      x = padding.left;\r\n      break;\r\n\r\n    case 'right':\r\n      x = ((fitBox ? maxLineWidth : maxWidth)\r\n        - padding.right - line.width);\r\n      break;\r\n\r\n    default:\r\n\r\n      // aka center\r\n      x = Math.max((((fitBox ? maxLineWidth : maxWidth)\r\n        - line.width) / 2 + padding.left), 0);\r\n    }\r\n\r\n    var tspan = svgCreate('tspan');\r\n    svgAttr(tspan, { x: x, y: y });\r\n\r\n    tspan.textContent = line.text;\r\n\r\n    svgAppend(textElement, tspan);\r\n  });\r\n\r\n  svgRemove(helperText);\r\n\r\n  var dimensions = {\r\n    width: maxLineWidth,\r\n    height: totalHeight\r\n  };\r\n\r\n  return {\r\n    dimensions: dimensions,\r\n    element: textElement\r\n  };\r\n};\r\n\r\n\r\nfunction getLineHeight(style) {\r\n  if ('fontSize' in style && 'lineHeight' in style) {\r\n    return style.lineHeight * parseInt(style.fontSize, 10);\r\n  }\r\n}\r\n","import { assign } from 'min-dash';\n\nimport TextUtil from 'diagram-js/lib/util/Text';\n\nvar DEFAULT_FONT_SIZE = 12;\nvar LINE_HEIGHT_RATIO = 1.2;\n\nvar MIN_TEXT_ANNOTATION_HEIGHT = 30;\n\n/**\n * @typedef { {\n *   fontFamily: string;\n *   fontSize: number;\n *   fontWeight: string;\n *   lineHeight: number;\n * } } TextRendererStyle\n *\n * @typedef { {\n *   defaultStyle?: Partial<TextRendererStyle>;\n *   externalStyle?: Partial<TextRendererStyle>;\n * } } TextRendererConfig\n *\n * @typedef { import('diagram-js/lib/util/Text').TextLayoutConfig } TextLayoutConfig\n *\n * @typedef { import('diagram-js/lib/util/Types').Rect } Rect\n */\n\n\n/**\n * Renders text and computes text bounding boxes.\n *\n * @param {TextRendererConfig} [config]\n */\nexport default function TextRenderer(config) {\n\n  var defaultStyle = assign({\n    fontFamily: 'Arial, sans-serif',\n    fontSize: DEFAULT_FONT_SIZE,\n    fontWeight: 'normal',\n    lineHeight: LINE_HEIGHT_RATIO\n  }, config && config.defaultStyle || {});\n\n  var fontSize = parseInt(defaultStyle.fontSize, 10) - 1;\n\n  var externalStyle = assign({}, defaultStyle, {\n    fontSize: fontSize\n  }, config && config.externalStyle || {});\n\n  var textUtil = new TextUtil({\n    style: defaultStyle\n  });\n\n  /**\n   * Get the new bounds of an externally rendered,\n   * layouted label.\n   *\n   * @param {Rect} bounds\n   * @param {string} text\n   *\n   * @return {Rect}\n   */\n  this.getExternalLabelBounds = function(bounds, text) {\n\n    var layoutedDimensions = textUtil.getDimensions(text, {\n      box: {\n        width: 90,\n        height: 30\n      },\n      style: externalStyle\n    });\n\n    // resize label shape to fit label text\n    return {\n      x: Math.round(bounds.x + bounds.width / 2 - layoutedDimensions.width / 2),\n      y: Math.round(bounds.y),\n      width: Math.ceil(layoutedDimensions.width),\n      height: Math.ceil(layoutedDimensions.height)\n    };\n\n  };\n\n  /**\n   * Get the new bounds of text annotation.\n   *\n   * @param {Rect} bounds\n   * @param {string} text\n   *\n   * @return {Rect}\n   */\n  this.getTextAnnotationBounds = function(bounds, text) {\n\n    var layoutedDimensions = textUtil.getDimensions(text, {\n      box: bounds,\n      style: defaultStyle,\n      align: 'left-top',\n      padding: 5\n    });\n\n    return {\n      x: bounds.x,\n      y: bounds.y,\n      width: bounds.width,\n      height: Math.max(MIN_TEXT_ANNOTATION_HEIGHT, Math.round(layoutedDimensions.height))\n    };\n  };\n\n  /**\n   * Create a layouted text element.\n   *\n   * @param {string} text\n   * @param {TextLayoutConfig} [options]\n   *\n   * @return {SVGElement} rendered text\n   */\n  this.createText = function(text, options) {\n    return textUtil.createText(text, options || {});\n  };\n\n  /**\n   * Get default text style.\n   */\n  this.getDefaultStyle = function() {\n    return defaultStyle;\n  };\n\n  /**\n   * Get the external text style.\n   */\n  this.getExternalStyle = function() {\n    return externalStyle;\n  };\n\n}\n\nTextRenderer.$inject = [\n  'config.textRenderer'\n];","/**\n * Map containing SVG paths needed by BpmnRenderer\n */\nexport default function PathMap() {\n\n  /**\n   * Contains a map of path elements\n   *\n   * <h1>Path definition</h1>\n   * A parameterized path is defined like this:\n   * <pre>\n   * 'GATEWAY_PARALLEL': {\n   *   d: 'm {mx},{my} {e.x0},0 0,{e.x1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\n          '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\n   *   height: 17.5,\n   *   width:  17.5,\n   *   heightElements: [2.5, 7.5],\n   *   widthElements: [2.5, 7.5]\n   * }\n   * </pre>\n   * <p>It's important to specify a correct <b>height and width</b> for the path as the scaling\n   * is based on the ratio between the specified height and width in this object and the\n   * height and width that is set as scale target (Note x,y coordinates will be scaled with\n   * individual ratios).</p>\n   * <p>The '<b>heightElements</b>' and '<b>widthElements</b>' array must contain the values that will be scaled.\n   * The scaling is based on the computed ratios.\n   * Coordinates on the y axis should be in the <b>heightElement</b>'s array, they will be scaled using\n   * the computed ratio coefficient.\n   * In the parameterized path the scaled values can be accessed through the 'e' object in {} brackets.\n   *   <ul>\n   *    <li>The values for the y axis can be accessed in the path string using {e.y0}, {e.y1}, ....</li>\n   *    <li>The values for the x axis can be accessed in the path string using {e.x0}, {e.x1}, ....</li>\n   *   </ul>\n   *   The numbers x0, x1 respectively y0, y1, ... map to the corresponding array index.\n   * </p>\n   */\n  this.pathMap = {\n    'EVENT_MESSAGE': {\n      d: 'm {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',\n      height: 36,\n      width:  36,\n      heightElements: [ 6, 14 ],\n      widthElements: [ 10.5, 21 ]\n    },\n    'EVENT_SIGNAL': {\n      d: 'M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z',\n      height: 36,\n      width: 36,\n      heightElements: [ 18 ],\n      widthElements: [ 10, 20 ]\n    },\n    'EVENT_ESCALATION': {\n      d: 'M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z',\n      height: 36,\n      width: 36,\n      heightElements: [ 20, 7 ],\n      widthElements: [ 8 ]\n    },\n    'EVENT_CONDITIONAL': {\n      d: 'M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z ' +\n         'M {e.x2},{e.y3} l {e.x0},0 ' +\n         'M {e.x2},{e.y4} l {e.x0},0 ' +\n         'M {e.x2},{e.y5} l {e.x0},0 ' +\n         'M {e.x2},{e.y6} l {e.x0},0 ' +\n         'M {e.x2},{e.y7} l {e.x0},0 ' +\n         'M {e.x2},{e.y8} l {e.x0},0 ',\n      height: 36,\n      width:  36,\n      heightElements: [ 8.5, 14.5, 18, 11.5, 14.5, 17.5, 20.5, 23.5, 26.5 ],\n      widthElements:  [ 10.5, 14.5, 12.5 ]\n    },\n    'EVENT_LINK': {\n      d: 'm {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z',\n      height: 36,\n      width: 36,\n      heightElements: [ 4.4375, 6.75, 7.8125 ],\n      widthElements: [ 9.84375, 13.5 ]\n    },\n    'EVENT_ERROR': {\n      d: 'm {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z',\n      height: 36,\n      width: 36,\n      heightElements: [ 0.023, 8.737, 8.151, 16.564, 10.591, 8.714 ],\n      widthElements: [ 0.085, 6.672, 6.97, 4.273, 5.337, 6.636 ]\n    },\n    'EVENT_CANCEL_45': {\n      d: 'm {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 ' +\n        '0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',\n      height: 36,\n      width: 36,\n      heightElements: [ 4.75, 8.5 ],\n      widthElements: [ 4.75, 8.5 ]\n    },\n    'EVENT_COMPENSATION': {\n      d: 'm {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z',\n      height: 36,\n      width: 36,\n      heightElements: [ 6.5, 13, 0.4, 6.1 ],\n      widthElements: [ 9, 9.3, 8.7 ]\n    },\n    'EVENT_TIMER_WH': {\n      d: 'M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ',\n      height: 36,\n      width:  36,\n      heightElements: [ 10, 2 ],\n      widthElements: [ 3, 7 ]\n    },\n    'EVENT_TIMER_LINE': {\n      d:  'M {mx},{my} ' +\n          'm {e.x0},{e.y0} l -{e.x1},{e.y1} ',\n      height: 36,\n      width:  36,\n      heightElements: [ 10, 3 ],\n      widthElements: [ 0, 0 ]\n    },\n    'EVENT_MULTIPLE': {\n      d:'m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z',\n      height: 36,\n      width:  36,\n      heightElements: [ 6.28099, 12.56199 ],\n      widthElements: [ 3.1405, 9.42149, 12.56198 ]\n    },\n    'EVENT_PARALLEL_MULTIPLE': {\n      d:'m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\n        '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\n      height: 36,\n      width:  36,\n      heightElements: [ 2.56228, 7.68683 ],\n      widthElements: [ 2.56228, 7.68683 ]\n    },\n    'GATEWAY_EXCLUSIVE': {\n      d:'m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} ' +\n                    '{e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} ' +\n                    '{e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z',\n      height: 17.5,\n      width:  17.5,\n      heightElements: [ 8.5, 6.5312, -6.5312, -8.5 ],\n      widthElements:  [ 6.5, -6.5, 3, -3, 5, -5 ]\n    },\n    'GATEWAY_PARALLEL': {\n      d:'m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 ' +\n        '0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',\n      height: 30,\n      width:  30,\n      heightElements: [ 5, 12.5 ],\n      widthElements: [ 5, 12.5 ]\n    },\n    'GATEWAY_EVENT_BASED': {\n      d:'m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z',\n      height: 11,\n      width:  11,\n      heightElements: [ -6, 6, 12, -12 ],\n      widthElements: [ 9, -3, -12 ]\n    },\n    'GATEWAY_COMPLEX': {\n      d:'m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} ' +\n        '{e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} ' +\n        '{e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} ' +\n        '-{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z',\n      height: 17.125,\n      width:  17.125,\n      heightElements: [ 4.875, 3.4375, 2.125, 3 ],\n      widthElements: [ 3.4375, 2.125, 4.875, 3 ]\n    },\n    'DATA_OBJECT_PATH': {\n      d:'m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0',\n      height: 61,\n      width:  51,\n      heightElements: [ 10, 50, 60 ],\n      widthElements: [ 10, 40, 50, 60 ]\n    },\n    'DATA_OBJECT_COLLECTION_PATH': {\n      d: 'm{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'DATA_ARROW': {\n      d:'m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z',\n      height: 61,\n      width:  51,\n      heightElements: [],\n      widthElements: []\n    },\n    'DATA_STORE': {\n      d:'m  {mx},{my} ' +\n        'l  0,{e.y2} ' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 ' +\n        'l  0,-{e.y2} ' +\n        'c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 ' +\n        'm  -{e.x2},{e.y0}' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0' +\n        'm  -{e.x2},{e.y0}' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0',\n      height: 61,\n      width:  61,\n      heightElements: [ 7, 10, 45 ],\n      widthElements:  [ 2, 58, 60 ]\n    },\n    'TEXT_ANNOTATION': {\n      d: 'm {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0',\n      height: 30,\n      width: 10,\n      heightElements: [ 30 ],\n      widthElements: [ 10 ]\n    },\n    'MARKER_SUB_PROCESS': {\n      d: 'm{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_PARALLEL': {\n      d: 'm{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_SEQUENTIAL': {\n      d: 'm{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_COMPENSATION': {\n      d: 'm {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z',\n      height: 10,\n      width: 21,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_LOOP': {\n      d: 'm {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 ' +\n        '-6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 ' +\n        '0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 ' +\n        'l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902',\n      height: 13.9,\n      width: 13.7,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_ADHOC': {\n      d: 'm {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 ' +\n        '3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 ' +\n        '1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 ' +\n        '-3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 ' +\n        '-2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z',\n      height: 4,\n      width: 15,\n      heightElements: [],\n      widthElements: []\n    },\n    'TASK_TYPE_SEND': {\n      d: 'm {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',\n      height: 14,\n      width:  21,\n      heightElements: [ 6, 14 ],\n      widthElements: [ 10.5, 21 ]\n    },\n    'TASK_TYPE_SCRIPT': {\n      d: 'm {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 ' +\n        'c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z ' +\n        'm -7,-12 l 5,0 ' +\n        'm -4.5,3 l 4.5,0 ' +\n        'm -3,3 l 5,0' +\n        'm -4,3 l 5,0',\n      height: 15,\n      width:  12.6,\n      heightElements: [ 6, 14 ],\n      widthElements: [ 10.5, 21 ]\n    },\n    'TASK_TYPE_USER_1': {\n      d: 'm {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 ' +\n        '-4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 ' +\n        '0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 ' +\n        'h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 z' +\n        'm -8,6 l 0,5.5 m 11,0 l 0,-5'\n    },\n    'TASK_TYPE_USER_2': {\n      d: 'm {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 ' +\n        '-2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 '\n    },\n    'TASK_TYPE_USER_3': {\n      d: 'm {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 ' +\n        '4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 ' +\n        '-4.20799998,3.36699999 -4.20699998,4.34799999 z'\n    },\n    'TASK_TYPE_MANUAL': {\n      d: 'm {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 ' +\n        '-0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 ' +\n        '0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 ' +\n        '-1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 ' +\n        '0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 ' +\n        '-10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 ' +\n        '2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 ' +\n        '-0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 ' +\n        '-1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 ' +\n        '-0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 ' +\n        '0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 ' +\n        '-5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z'\n    },\n    'TASK_TYPE_INSTANTIATING_SEND': {\n      d: 'm {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6'\n    },\n    'TASK_TYPE_SERVICE': {\n      d: 'm {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 ' +\n        '0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 ' +\n        '-1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 ' +\n        'v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 ' +\n        '-0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 ' +\n        '-1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 ' +\n        'h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 ' +\n        '-0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 ' +\n        'c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 ' +\n        'l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 ' +\n        '0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 ' +\n        'c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z ' +\n        'm 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 ' +\n        '0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 ' +\n        '0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'\n    },\n    'TASK_TYPE_SERVICE_FILL': {\n      d: 'm {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 ' +\n        '0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 ' +\n        '0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'\n    },\n    'TASK_TYPE_BUSINESS_RULE_HEADER': {\n      d: 'm {mx},{my} 0,4 20,0 0,-4 z'\n    },\n    'TASK_TYPE_BUSINESS_RULE_MAIN': {\n      d: 'm {mx},{my} 0,12 20,0 0,-12 z' +\n        'm 0,8 l 20,0 ' +\n        'm -13,-4 l 0,8'\n    },\n    'MESSAGE_FLOW_MARKER': {\n      d: 'm {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6'\n    }\n  };\n\n  /**\n   * Return raw path for the given ID.\n   *\n   * @param {string} pathId\n   *\n   * @return {string} raw path\n   */\n  this.getRawPath = function getRawPath(pathId) {\n    return this.pathMap[pathId].d;\n  };\n\n  /**\n   * Scales the path to the given height and width.\n   * <h1>Use case</h1>\n   * <p>Use case is to scale the content of elements (event, gateways) based\n   * on the element bounding box's size.\n   * </p>\n   * <h1>Why not transform</h1>\n   * <p>Scaling a path with transform() will also scale the stroke and IE does not support\n   * the option 'non-scaling-stroke' to prevent this.\n   * Also there are use cases where only some parts of a path should be\n   * scaled.</p>\n   *\n   * @param {string} pathId The ID of the path.\n   * @param {Object} param <p>\n   *   Example param object scales the path to 60% size of the container (data.width, data.height).\n   *   <pre>\n   *   {\n   *     xScaleFactor: 0.6,\n   *     yScaleFactor:0.6,\n   *     containerWidth: data.width,\n   *     containerHeight: data.height,\n   *     position: {\n   *       mx: 0.46,\n   *       my: 0.2,\n   *     }\n   *   }\n   *   </pre>\n   *   <ul>\n   *    <li>targetpathwidth = xScaleFactor * containerWidth</li>\n   *    <li>targetpathheight = yScaleFactor * containerHeight</li>\n   *    <li>Position is used to set the starting coordinate of the path. M is computed:\n    *    <ul>\n    *      <li>position.x * containerWidth</li>\n    *      <li>position.y * containerHeight</li>\n    *    </ul>\n    *    Center of the container <pre> position: {\n   *       mx: 0.5,\n   *       my: 0.5,\n   *     }</pre>\n   *     Upper left corner of the container\n   *     <pre> position: {\n   *       mx: 0.0,\n   *       my: 0.0,\n   *     }</pre>\n   *    </li>\n   *   </ul>\n   * </p>\n   *\n   * @return {string} scaled path\n   */\n  this.getScaledPath = function getScaledPath(pathId, param) {\n    var rawPath = this.pathMap[pathId];\n\n    // positioning\n    // compute the start point of the path\n    var mx, my;\n\n    if (param.abspos) {\n      mx = param.abspos.x;\n      my = param.abspos.y;\n    } else {\n      mx = param.containerWidth * param.position.mx;\n      my = param.containerHeight * param.position.my;\n    }\n\n    var coordinates = {}; // map for the scaled coordinates\n    if (param.position) {\n\n      // path\n      var heightRatio = (param.containerHeight / rawPath.height) * param.yScaleFactor;\n      var widthRatio = (param.containerWidth / rawPath.width) * param.xScaleFactor;\n\n\n      // Apply height ratio\n      for (var heightIndex = 0; heightIndex < rawPath.heightElements.length; heightIndex++) {\n        coordinates['y' + heightIndex] = rawPath.heightElements[heightIndex] * heightRatio;\n      }\n\n      // Apply width ratio\n      for (var widthIndex = 0; widthIndex < rawPath.widthElements.length; widthIndex++) {\n        coordinates['x' + widthIndex] = rawPath.widthElements[widthIndex] * widthRatio;\n      }\n    }\n\n    // Apply value to raw path\n    var path = format(\n      rawPath.d, {\n        mx: mx,\n        my: my,\n        e: coordinates\n      }\n    );\n    return path;\n  };\n}\n\n// helpers //////////////////////\n\n// copied and adjusted from https://github.com/adobe-webplatform/Snap.svg/blob/master/src/svg.js\nvar tokenRegex = /\\{([^{}]+)\\}/g,\n    objNotationRegex = /(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[('|\")(.+?)\\2\\])(\\(\\))?/g; // matches .xxxxx or [\"xxxxx\"] to run over object properties\n\nfunction replacer(all, key, obj) {\n  var res = obj;\n  key.replace(objNotationRegex, function(all, name, quote, quotedName, isFunc) {\n    name = name || quotedName;\n    if (res) {\n      if (name in res) {\n        res = res[name];\n      }\n      typeof res == 'function' && isFunc && (res = res());\n    }\n  });\n  res = (res == null || res == obj ? all : res) + '';\n\n  return res;\n}\n\nfunction format(str, obj) {\n  return String(str).replace(tokenRegex, function(all, key) {\n    return replacer(all, key, obj);\n  });\n}\n","import BpmnRenderer from './BpmnRenderer';\nimport TextRenderer from './TextRenderer';\n\nimport PathMap from './PathMap';\n\nexport default {\n  __init__: [ 'bpmnRenderer' ],\n  bpmnRenderer: [ 'type', BpmnRenderer ],\n  textRenderer: [ 'type', TextRenderer ],\n  pathMap: [ 'type', PathMap ]\n};\n","/**\r\n * @typedef { {\r\n *   [key: string]: string;\r\n * } } TranslateReplacements\r\n */\r\n\r\n/**\r\n * A simple translation stub to be used for multi-language support\r\n * in diagrams. Can be easily replaced with a more sophisticated\r\n * solution.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * // use it inside any diagram component by injecting `translate`.\r\n *\r\n * function MyService(translate) {\r\n *   alert(translate('HELLO {you}', { you: 'You!' }));\r\n * }\r\n * ```\r\n *\r\n * @param {string} template to interpolate\r\n * @param {TranslateReplacements} [replacements] a map with substitutes\r\n *\r\n * @return {string} the translated string\r\n */\r\nexport default function translate(template, replacements) {\r\n\r\n  replacements = replacements || {};\r\n\r\n  return template.replace(/{([^}]+)}/g, function(_, key) {\r\n    return replacements[key] || '{' + key + '}';\r\n  });\r\n}","import translate from './translate';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  translate: [ 'value', translate ]\r\n};","import {\n  assign\n} from 'min-dash';\n\nimport { is } from '../util/ModelUtil';\n\nimport {\n  isLabelExternal,\n  getExternalLabelBounds,\n  getLabel\n} from '../util/LabelUtil';\n\nimport {\n  getMid\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  isExpanded\n} from '../util/DiUtil';\n\nimport {\n  elementToString\n} from './Util';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../features/modeling/ElementFactory').default} ElementFactory\n * @typedef {import('../draw/TextRenderer').default} TextRenderer\n *\n * @typedef {import('../model/Types').Element} Element\n * @typedef {import('../model/Types').Label} Label\n * @typedef {import('../model/Types').Shape} Shape\n * @typedef {import('../model/Types').Connection} Connection\n * @typedef {import('../model/Types').Root} Root\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * @param {ModdleElement} semantic\n * @param {ModdleElement} di\n * @param {Object} [attrs=null]\n *\n * @return {Object}\n */\nfunction elementData(semantic, di, attrs) {\n  return assign({\n    id: semantic.id,\n    type: semantic.$type,\n    businessObject: semantic,\n    di: di\n  }, attrs);\n}\n\nfunction getWaypoints(di, source, target) {\n\n  var waypoints = di.waypoint;\n\n  if (!waypoints || waypoints.length < 2) {\n    return [ getMid(source), getMid(target) ];\n  }\n\n  return waypoints.map(function(p) {\n    return { x: p.x, y: p.y };\n  });\n}\n\nfunction notYetDrawn(semantic, refSemantic, property) {\n  return new Error(\n    `element ${ elementToString(refSemantic) } referenced by ${ elementToString(semantic) }#${ property } not yet drawn`\n  );\n}\n\n\n/**\n * An importer that adds bpmn elements to the canvas\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {ElementFactory} elementFactory\n * @param {ElementRegistry} elementRegistry\n * @param {TextRenderer} textRenderer\n */\nexport default function BpmnImporter(\n    eventBus, canvas, elementFactory,\n    elementRegistry, textRenderer) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._elementFactory = elementFactory;\n  this._elementRegistry = elementRegistry;\n  this._textRenderer = textRenderer;\n}\n\nBpmnImporter.$inject = [\n  'eventBus',\n  'canvas',\n  'elementFactory',\n  'elementRegistry',\n  'textRenderer'\n];\n\n\n/**\n * Add a BPMN element (semantic) to the canvas making it a child of the\n * given parent.\n *\n * @param {ModdleElement} semantic\n * @param {ModdleElement} di\n * @param {Shape} parentElement\n *\n * @return {Shape | Root | Connection}\n */\nBpmnImporter.prototype.add = function(semantic, di, parentElement) {\n  var element,\n      hidden;\n\n  var parentIndex;\n\n  // ROOT ELEMENT\n  // handle the special case that we deal with a\n  // invisible root element (process, subprocess or collaboration)\n  if (is(di, 'bpmndi:BPMNPlane')) {\n\n    var attrs = is(semantic, 'bpmn:SubProcess')\n      ? { id: semantic.id + '_plane' }\n      : {};\n\n    // add a virtual element (not being drawn)\n    element = this._elementFactory.createRoot(elementData(semantic, di, attrs));\n\n    this._canvas.addRootElement(element);\n  }\n\n  // SHAPE\n  else if (is(di, 'bpmndi:BPMNShape')) {\n\n    var collapsed = !isExpanded(semantic, di),\n        isFrame = isFrameElement(semantic);\n\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\n\n    var bounds = di.bounds;\n\n    element = this._elementFactory.createShape(elementData(semantic, di, {\n      collapsed: collapsed,\n      hidden: hidden,\n      x: Math.round(bounds.x),\n      y: Math.round(bounds.y),\n      width: Math.round(bounds.width),\n      height: Math.round(bounds.height),\n      isFrame: isFrame\n    }));\n\n    if (is(semantic, 'bpmn:BoundaryEvent')) {\n      this._attachBoundary(semantic, element);\n    }\n\n    // insert lanes behind other flow nodes (cf. #727)\n    if (is(semantic, 'bpmn:Lane')) {\n      parentIndex = 0;\n    }\n\n    if (is(semantic, 'bpmn:DataStoreReference')) {\n\n      // check whether data store is inside our outside of its semantic parent\n      if (!isPointInsideBBox(parentElement, getMid(bounds))) {\n        parentElement = this._canvas.findRoot(parentElement);\n      }\n    }\n\n    this._canvas.addShape(element, parentElement, parentIndex);\n  }\n\n  // CONNECTION\n  else if (is(di, 'bpmndi:BPMNEdge')) {\n\n    var source = this._getSource(semantic),\n        target = this._getTarget(semantic);\n\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\n\n    element = this._elementFactory.createConnection(elementData(semantic, di, {\n      hidden: hidden,\n      source: source,\n      target: target,\n      waypoints: getWaypoints(di, source, target)\n    }));\n\n    if (is(semantic, 'bpmn:DataAssociation')) {\n\n      // render always on top; this ensures DataAssociations\n      // are rendered correctly across different \"hacks\" people\n      // love to model such as cross participant / sub process\n      // associations\n      parentElement = this._canvas.findRoot(parentElement);\n    }\n\n    this._canvas.addConnection(element, parentElement, parentIndex);\n  } else {\n    throw new Error(\n      `unknown di ${ elementToString(di) } for element ${ elementToString(semantic) }`\n    );\n  }\n\n  // (optional) LABEL\n  if (isLabelExternal(semantic) && getLabel(element)) {\n    this.addLabel(semantic, di, element);\n  }\n\n  this._eventBus.fire('bpmnElement.added', { element: element });\n\n  return element;\n};\n\n\n/**\n * Attach a boundary element to the given host.\n *\n * @param {ModdleElement} boundarySemantic\n * @param {Shape} boundaryElement\n */\nBpmnImporter.prototype._attachBoundary = function(boundarySemantic, boundaryElement) {\n  var hostSemantic = boundarySemantic.attachedToRef;\n\n  if (!hostSemantic) {\n    throw new Error(\n      `missing ${ elementToString(boundarySemantic) }#attachedToRef`\n    );\n  }\n\n  var host = this._elementRegistry.get(hostSemantic.id),\n      attachers = host && host.attachers;\n\n  if (!host) {\n    throw notYetDrawn(boundarySemantic, hostSemantic, 'attachedToRef');\n  }\n\n  // wire element.host <> host.attachers\n  boundaryElement.host = host;\n\n  if (!attachers) {\n    host.attachers = attachers = [];\n  }\n\n  if (attachers.indexOf(boundaryElement) === -1) {\n    attachers.push(boundaryElement);\n  }\n};\n\n\n/**\n * Add a label to a given element.\n *\n * @param {ModdleElement} semantic\n * @param {ModdleElement} di\n * @param {Element} element\n *\n * @return {Label}\n */\nBpmnImporter.prototype.addLabel = function(semantic, di, element) {\n  var bounds,\n      text,\n      label;\n\n  bounds = getExternalLabelBounds(di, element);\n\n  text = getLabel(element);\n\n  if (text) {\n\n    // get corrected bounds from actual layouted text\n    bounds = this._textRenderer.getExternalLabelBounds(bounds, text);\n  }\n\n  label = this._elementFactory.createLabel(elementData(semantic, di, {\n    id: semantic.id + '_label',\n    labelTarget: element,\n    type: 'label',\n    hidden: element.hidden || !getLabel(element),\n    x: Math.round(bounds.x),\n    y: Math.round(bounds.y),\n    width: Math.round(bounds.width),\n    height: Math.round(bounds.height)\n  }));\n\n  return this._canvas.addShape(label, element.parent);\n};\n\n/**\n * Get the source or target of the given connection.\n *\n * @param {ModdleElement} semantic\n * @param {'source' | 'target'} side\n *\n * @return {Element}\n */\nBpmnImporter.prototype._getConnectedElement = function(semantic, side) {\n\n  var element,\n      refSemantic,\n      type = semantic.$type;\n\n  refSemantic = semantic[side + 'Ref'];\n\n  // handle mysterious isMany DataAssociation#sourceRef\n  if (side === 'source' && type === 'bpmn:DataInputAssociation') {\n    refSemantic = refSemantic && refSemantic[0];\n  }\n\n  // fix source / target for DataInputAssociation / DataOutputAssociation\n  if (side === 'source' && type === 'bpmn:DataOutputAssociation' ||\n      side === 'target' && type === 'bpmn:DataInputAssociation') {\n\n    refSemantic = semantic.$parent;\n  }\n\n  element = refSemantic && this._getElement(refSemantic);\n\n  if (element) {\n    return element;\n  }\n\n  if (refSemantic) {\n    throw notYetDrawn(semantic, refSemantic, side + 'Ref');\n  } else {\n    throw new Error(\n      `${ elementToString(semantic) }#${ side } Ref not specified`\n    );\n  }\n};\n\nBpmnImporter.prototype._getSource = function(semantic) {\n  return this._getConnectedElement(semantic, 'source');\n};\n\nBpmnImporter.prototype._getTarget = function(semantic) {\n  return this._getConnectedElement(semantic, 'target');\n};\n\n\nBpmnImporter.prototype._getElement = function(semantic) {\n  return this._elementRegistry.get(semantic.id);\n};\n\n\n// helpers ////////////////////\n\nfunction isPointInsideBBox(bbox, point) {\n  var x = point.x,\n      y = point.y;\n\n  return x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height;\n}\n\nfunction isFrameElement(semantic) {\n  return is(semantic, 'bpmn:Group');\n}\n","import translate from 'diagram-js/lib/i18n/translate';\n\nimport BpmnImporter from './BpmnImporter';\n\nexport default {\n  __depends__: [\n    translate\n  ],\n  bpmnImporter: [ 'type', BpmnImporter ]\n};","import DrawModule from '../draw';\nimport ImportModule from '../import';\n\nexport default {\n  __depends__: [\n    DrawModule,\n    ImportModule\n  ]\n};","/**\r\n * Util that provides unique IDs.\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * The ids can be customized via a given prefix and contain a random value to avoid collisions.\r\n *\r\n * @param {string} [prefix] a prefix to prepend to generated ids (for better readability)\r\n */\r\nexport default function IdGenerator(prefix) {\r\n\r\n  this._counter = 0;\r\n  this._prefix = (prefix ? prefix + '-' : '') + Math.floor(Math.random() * 1000000000) + '-';\r\n}\r\n\r\n/**\r\n * Returns a next unique ID.\r\n *\r\n * @return {string} the id\r\n */\r\nIdGenerator.prototype.next = function() {\r\n  return this._prefix + (++this._counter);\r\n};\r\n","import {\r\n  isArray,\r\n  isString,\r\n  isObject,\r\n  assign,\r\n  forEach,\r\n  find,\r\n  filter,\r\n  matchPattern,\r\n  isDefined\r\n} from 'min-dash';\r\n\r\nimport {\r\n  assignStyle,\r\n  domify,\r\n  classes as domClasses,\r\n  attr as domAttr,\r\n  remove as domRemove,\r\n  clear as domClear\r\n} from 'min-dom';\r\n\r\nimport {\r\n  getBBox\r\n} from '../../util/Elements';\r\n\r\nimport Ids from '../../util/IdGenerator';\r\n\r\n// document wide unique overlay ids\r\nvar ids = new Ids('ov');\r\n\r\nvar LOW_PRIORITY = 500;\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef { {\r\n *   minZoom?: number,\r\n *   maxZoom?: number\r\n * } } OverlaysConfigShow\r\n *\r\n * @typedef { {\r\n *   min?: number,\r\n *   max?: number\r\n * } } OverlaysConfigScale\r\n *\r\n * @typedef { {\r\n*   id: string,\r\n*   type: string | null,\r\n*   element: Element | string\r\n* } & OverlayAttrs } Overlay\r\n*\r\n * @typedef { {\r\n *   html: HTMLElement | string,\r\n *   position: {\r\n *     top?: number,\r\n *     right?: number,\r\n *     bottom?: number,\r\n *     left?: number\r\n *   }\r\n * } & OverlaysConfigDefault } OverlayAttrs\r\n *\r\n * @typedef { {\r\n *   html: HTMLElement,\r\n *   element: Element,\r\n *   overlays: Overlay[]\r\n * } } OverlayContainer\r\n *\r\n * @typedef {{\r\n *   defaults?: OverlaysConfigDefault\r\n * }} OverlaysConfig\r\n *\r\n * @typedef { {\r\n *  show?: OverlaysConfigShow,\r\n *  scale?: OverlaysConfigScale | boolean\r\n * } } OverlaysConfigDefault\r\n *\r\n * @typedef { {\r\n *   id?: string;\r\n *   element?: Element | string;\r\n *   type?: string;\r\n * } | string } OverlaysFilter\r\n */\r\n\r\n/**\r\n * A service that allows users to attach overlays to diagram elements.\r\n *\r\n * The overlay service will take care of overlay positioning during updates.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * // add a pink badge on the top left of the shape\r\n *\r\n * overlays.add(someShape, {\r\n *   position: {\r\n *     top: -5,\r\n *     left: -5\r\n *   },\r\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\r\n * });\r\n *\r\n * // or add via shape id\r\n *\r\n * overlays.add('some-element-id', {\r\n *   position: {\r\n *     top: -5,\r\n *     left: -5\r\n *   }\r\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\r\n * });\r\n *\r\n * // or add with optional type\r\n *\r\n * overlays.add(someShape, 'badge', {\r\n *   position: {\r\n *     top: -5,\r\n *     left: -5\r\n *   }\r\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\r\n * });\r\n * ```\r\n *\r\n * ```javascript\r\n * // remove an overlay\r\n *\r\n * var id = overlays.add(...);\r\n * overlays.remove(id);\r\n *\r\n *\r\n * You may configure overlay defaults during tool by providing a `config` module\r\n * with `overlays.defaults` as an entry:\r\n *\r\n * {\r\n *   overlays: {\r\n *     defaults: {\r\n *       show: {\r\n *         minZoom: 0.7,\r\n *         maxZoom: 5.0\r\n *       },\r\n *       scale: {\r\n *         min: 1\r\n *       }\r\n *     }\r\n * }\r\n * ```\r\n *\r\n * @param {OverlaysConfig} config\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {ElementRegistry} elementRegistry\r\n */\r\nexport default function Overlays(config, eventBus, canvas, elementRegistry) {\r\n  this._eventBus = eventBus;\r\n  this._canvas = canvas;\r\n  this._elementRegistry = elementRegistry;\r\n\r\n  this._ids = ids;\r\n\r\n  /**\r\n   * @type {OverlaysConfigDefault}\r\n   */\r\n  this._overlayDefaults = assign({\r\n\r\n    // no show constraints\r\n    show: null,\r\n\r\n    // always scale\r\n    scale: true\r\n  }, config && config.defaults);\r\n\r\n  /**\r\n   * @type {Record<string, Overlay>}\r\n   */\r\n  this._overlays = {};\r\n\r\n  /**\r\n   * @type {OverlayContainer[]}\r\n   */\r\n  this._overlayContainers = [];\r\n\r\n  /**\r\n   * @type {HTMLElement}\r\n   */\r\n  this._overlayRoot = createRoot(canvas.getContainer());\r\n\r\n  this._init();\r\n}\r\n\r\n\r\nOverlays.$inject = [\r\n  'config.overlays',\r\n  'eventBus',\r\n  'canvas',\r\n  'elementRegistry'\r\n];\r\n\r\n\r\n/**\r\n * Returns the overlay with the specified ID or a list of overlays\r\n * for an element with a given type.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * // return the single overlay with the given ID\r\n * overlays.get('some-id');\r\n *\r\n * // return all overlays for the shape\r\n * overlays.get({ element: someShape });\r\n *\r\n * // return all overlays on shape with type 'badge'\r\n * overlays.get({ element: someShape, type: 'badge' });\r\n *\r\n * // shape can also be specified as ID\r\n * overlays.get({ element: 'element-id', type: 'badge' });\r\n * ```\r\n *\r\n * @param {OverlaysFilter} search The filter to be used to find the overlay(s).\r\n *\r\n * @return {Overlay|Overlay[]} The overlay(s).\r\n */\r\nOverlays.prototype.get = function(search) {\r\n\r\n  if (isString(search)) {\r\n    search = { id: search };\r\n  }\r\n\r\n  if (isString(search.element)) {\r\n    search.element = this._elementRegistry.get(search.element);\r\n  }\r\n\r\n  if (search.element) {\r\n    var container = this._getOverlayContainer(search.element, true);\r\n\r\n    // return a list of overlays when searching by element (+type)\r\n    if (container) {\r\n      return search.type ? filter(container.overlays, matchPattern({ type: search.type })) : container.overlays.slice();\r\n    } else {\r\n      return [];\r\n    }\r\n  } else if (search.type) {\r\n    return filter(this._overlays, matchPattern({ type: search.type }));\r\n  } else {\r\n\r\n    // return single element when searching by id\r\n    return search.id ? this._overlays[search.id] : null;\r\n  }\r\n};\r\n\r\n/**\r\n * Adds an HTML overlay to an element.\r\n *\r\n * @param {Element|string} element The element to add the overlay to.\r\n * @param {string} [type] An optional type that can be used to filter.\r\n * @param {OverlayAttrs} overlay The overlay.\r\n *\r\n * @return {string} The overlay's ID that can be used to get or remove it.\r\n */\r\nOverlays.prototype.add = function(element, type, overlay) {\r\n\r\n  if (isObject(type)) {\r\n    overlay = type;\r\n    type = null;\r\n  }\r\n\r\n  if (!element.id) {\r\n    element = this._elementRegistry.get(element);\r\n  }\r\n\r\n  if (!overlay.position) {\r\n    throw new Error('must specifiy overlay position');\r\n  }\r\n\r\n  if (!overlay.html) {\r\n    throw new Error('must specifiy overlay html');\r\n  }\r\n\r\n  if (!element) {\r\n    throw new Error('invalid element specified');\r\n  }\r\n\r\n  var id = this._ids.next();\r\n\r\n  overlay = assign({}, this._overlayDefaults, overlay, {\r\n    id: id,\r\n    type: type,\r\n    element: element,\r\n    html: overlay.html\r\n  });\r\n\r\n  this._addOverlay(overlay);\r\n\r\n  return id;\r\n};\r\n\r\n\r\n/**\r\n * Remove an overlay with the given ID or all overlays matching the given filter.\r\n *\r\n * @see Overlays#get for filter options.\r\n *\r\n * @param {OverlaysFilter} filter The filter to be used to find the overlay.\r\n */\r\nOverlays.prototype.remove = function(filter) {\r\n\r\n  var overlays = this.get(filter) || [];\r\n\r\n  if (!isArray(overlays)) {\r\n    overlays = [ overlays ];\r\n  }\r\n\r\n  var self = this;\r\n\r\n  forEach(overlays, function(overlay) {\r\n\r\n    var container = self._getOverlayContainer(overlay.element, true);\r\n\r\n    if (overlay) {\r\n      domRemove(overlay.html);\r\n      domRemove(overlay.htmlContainer);\r\n\r\n      delete overlay.htmlContainer;\r\n      delete overlay.element;\r\n\r\n      delete self._overlays[overlay.id];\r\n    }\r\n\r\n    if (container) {\r\n      var idx = container.overlays.indexOf(overlay);\r\n      if (idx !== -1) {\r\n        container.overlays.splice(idx, 1);\r\n      }\r\n    }\r\n  });\r\n\r\n};\r\n\r\n/**\r\n * Checks whether overlays are shown.\r\n *\r\n * @return {boolean} Whether overlays are shown.\r\n */\r\nOverlays.prototype.isShown = function() {\r\n  return this._overlayRoot.style.display !== 'none';\r\n};\r\n\r\n/**\r\n * Show all overlays.\r\n */\r\nOverlays.prototype.show = function() {\r\n  setVisible(this._overlayRoot);\r\n};\r\n\r\n/**\r\n * Hide all overlays.\r\n */\r\nOverlays.prototype.hide = function() {\r\n  setVisible(this._overlayRoot, false);\r\n};\r\n\r\n/**\r\n * Remove all overlays and their container.\r\n */\r\nOverlays.prototype.clear = function() {\r\n  this._overlays = {};\r\n\r\n  this._overlayContainers = [];\r\n\r\n  domClear(this._overlayRoot);\r\n};\r\n\r\nOverlays.prototype._updateOverlayContainer = function(container) {\r\n  var element = container.element,\r\n      html = container.html;\r\n\r\n  // update container left,top according to the elements x,y coordinates\r\n  // this ensures we can attach child elements relative to this container\r\n\r\n  var x = element.x,\r\n      y = element.y;\r\n\r\n  if (element.waypoints) {\r\n    var bbox = getBBox(element);\r\n    x = bbox.x;\r\n    y = bbox.y;\r\n  }\r\n\r\n  setPosition(html, x, y);\r\n\r\n  domAttr(container.html, 'data-container-id', element.id);\r\n};\r\n\r\n\r\nOverlays.prototype._updateOverlay = function(overlay) {\r\n\r\n  var position = overlay.position,\r\n      htmlContainer = overlay.htmlContainer,\r\n      element = overlay.element;\r\n\r\n  // update overlay html relative to shape because\r\n  // it is already positioned on the element\r\n\r\n  // update relative\r\n  var left = position.left,\r\n      top = position.top;\r\n\r\n  if (position.right !== undefined) {\r\n\r\n    var width;\r\n\r\n    if (element.waypoints) {\r\n      width = getBBox(element).width;\r\n    } else {\r\n      width = element.width;\r\n    }\r\n\r\n    left = position.right * -1 + width;\r\n  }\r\n\r\n  if (position.bottom !== undefined) {\r\n\r\n    var height;\r\n\r\n    if (element.waypoints) {\r\n      height = getBBox(element).height;\r\n    } else {\r\n      height = element.height;\r\n    }\r\n\r\n    top = position.bottom * -1 + height;\r\n  }\r\n\r\n  setPosition(htmlContainer, left || 0, top || 0);\r\n  this._updateOverlayVisibilty(overlay, this._canvas.viewbox());\r\n};\r\n\r\n\r\nOverlays.prototype._createOverlayContainer = function(element) {\r\n  var html = domify('<div class=\"djs-overlays\" />');\r\n  assignStyle(html, { position: 'absolute' });\r\n\r\n  this._overlayRoot.appendChild(html);\r\n\r\n  var container = {\r\n    html: html,\r\n    element: element,\r\n    overlays: []\r\n  };\r\n\r\n  this._updateOverlayContainer(container);\r\n\r\n  this._overlayContainers.push(container);\r\n\r\n  return container;\r\n};\r\n\r\n\r\nOverlays.prototype._updateRoot = function(viewbox) {\r\n  var scale = viewbox.scale || 1;\r\n\r\n  var matrix = 'matrix(' +\r\n  [\r\n    scale,\r\n    0,\r\n    0,\r\n    scale,\r\n    -1 * viewbox.x * scale,\r\n    -1 * viewbox.y * scale\r\n  ].join(',') +\r\n  ')';\r\n\r\n  setTransform(this._overlayRoot, matrix);\r\n};\r\n\r\n\r\nOverlays.prototype._getOverlayContainer = function(element, raw) {\r\n  var container = find(this._overlayContainers, function(c) {\r\n    return c.element === element;\r\n  });\r\n\r\n\r\n  if (!container && !raw) {\r\n    return this._createOverlayContainer(element);\r\n  }\r\n\r\n  return container;\r\n};\r\n\r\n\r\nOverlays.prototype._addOverlay = function(overlay) {\r\n\r\n  var id = overlay.id,\r\n      element = overlay.element,\r\n      html = overlay.html,\r\n      htmlContainer,\r\n      overlayContainer;\r\n\r\n  // unwrap jquery (for those who need it)\r\n  if (html.get && html.constructor.prototype.jquery) {\r\n    html = html.get(0);\r\n  }\r\n\r\n  // create proper html elements from\r\n  // overlay HTML strings\r\n  if (isString(html)) {\r\n    html = domify(html);\r\n  }\r\n\r\n  overlayContainer = this._getOverlayContainer(element);\r\n\r\n  htmlContainer = domify('<div class=\"djs-overlay\" data-overlay-id=\"' + id + '\">');\r\n  assignStyle(htmlContainer, { position: 'absolute' });\r\n\r\n  htmlContainer.appendChild(html);\r\n\r\n  if (overlay.type) {\r\n    domClasses(htmlContainer).add('djs-overlay-' + overlay.type);\r\n  }\r\n\r\n  var elementRoot = this._canvas.findRoot(element);\r\n  var activeRoot = this._canvas.getRootElement();\r\n\r\n  setVisible(htmlContainer, elementRoot === activeRoot);\r\n\r\n  overlay.htmlContainer = htmlContainer;\r\n\r\n  overlayContainer.overlays.push(overlay);\r\n  overlayContainer.html.appendChild(htmlContainer);\r\n\r\n  this._overlays[id] = overlay;\r\n\r\n  this._updateOverlay(overlay);\r\n  this._updateOverlayVisibilty(overlay, this._canvas.viewbox());\r\n};\r\n\r\n\r\nOverlays.prototype._updateOverlayVisibilty = function(overlay, viewbox) {\r\n  var show = overlay.show,\r\n      rootElement = this._canvas.findRoot(overlay.element),\r\n      minZoom = show && show.minZoom,\r\n      maxZoom = show && show.maxZoom,\r\n      htmlContainer = overlay.htmlContainer,\r\n      activeRootElement = this._canvas.getRootElement(),\r\n      visible = true;\r\n\r\n  if (rootElement !== activeRootElement) {\r\n    visible = false;\r\n  } else if (show) {\r\n    if (\r\n      (isDefined(minZoom) && minZoom > viewbox.scale) ||\r\n      (isDefined(maxZoom) && maxZoom < viewbox.scale)\r\n    ) {\r\n      visible = false;\r\n    }\r\n  }\r\n\r\n  setVisible(htmlContainer, visible);\r\n\r\n  this._updateOverlayScale(overlay, viewbox);\r\n};\r\n\r\n\r\nOverlays.prototype._updateOverlayScale = function(overlay, viewbox) {\r\n  var shouldScale = overlay.scale,\r\n      minScale,\r\n      maxScale,\r\n      htmlContainer = overlay.htmlContainer;\r\n\r\n  var scale, transform = '';\r\n\r\n  if (shouldScale !== true) {\r\n\r\n    if (shouldScale === false) {\r\n      minScale = 1;\r\n      maxScale = 1;\r\n    } else {\r\n      minScale = shouldScale.min;\r\n      maxScale = shouldScale.max;\r\n    }\r\n\r\n    if (isDefined(minScale) && viewbox.scale < minScale) {\r\n      scale = (1 / viewbox.scale || 1) * minScale;\r\n    }\r\n\r\n    if (isDefined(maxScale) && viewbox.scale > maxScale) {\r\n      scale = (1 / viewbox.scale || 1) * maxScale;\r\n    }\r\n  }\r\n\r\n  if (isDefined(scale)) {\r\n    transform = 'scale(' + scale + ',' + scale + ')';\r\n  }\r\n\r\n  setTransform(htmlContainer, transform);\r\n};\r\n\r\n\r\nOverlays.prototype._updateOverlaysVisibilty = function(viewbox) {\r\n\r\n  var self = this;\r\n\r\n  forEach(this._overlays, function(overlay) {\r\n    self._updateOverlayVisibilty(overlay, viewbox);\r\n  });\r\n};\r\n\r\n\r\nOverlays.prototype._init = function() {\r\n\r\n  var eventBus = this._eventBus;\r\n\r\n  var self = this;\r\n\r\n\r\n  // scroll/zoom integration\r\n\r\n  function updateViewbox(viewbox) {\r\n    self._updateRoot(viewbox);\r\n    self._updateOverlaysVisibilty(viewbox);\r\n\r\n    self.show();\r\n  }\r\n\r\n  eventBus.on('canvas.viewbox.changing', function(event) {\r\n    self.hide();\r\n  });\r\n\r\n  eventBus.on('canvas.viewbox.changed', function(event) {\r\n    updateViewbox(event.viewbox);\r\n  });\r\n\r\n\r\n  // remove integration\r\n\r\n  eventBus.on([ 'shape.remove', 'connection.remove' ], function(e) {\r\n    var element = e.element;\r\n    var overlays = self.get({ element: element });\r\n\r\n    forEach(overlays, function(o) {\r\n      self.remove(o.id);\r\n    });\r\n\r\n    var container = self._getOverlayContainer(element);\r\n\r\n    if (container) {\r\n      domRemove(container.html);\r\n      var i = self._overlayContainers.indexOf(container);\r\n      if (i !== -1) {\r\n        self._overlayContainers.splice(i, 1);\r\n      }\r\n    }\r\n  });\r\n\r\n\r\n  // move integration\r\n\r\n  eventBus.on('element.changed', LOW_PRIORITY, function(e) {\r\n    var element = e.element;\r\n\r\n    var container = self._getOverlayContainer(element, true);\r\n\r\n    if (container) {\r\n      forEach(container.overlays, function(overlay) {\r\n        self._updateOverlay(overlay);\r\n      });\r\n\r\n      self._updateOverlayContainer(container);\r\n    }\r\n  });\r\n\r\n\r\n  // marker integration, simply add them on the overlays as classes, too.\r\n\r\n  eventBus.on('element.marker.update', function(e) {\r\n    var container = self._getOverlayContainer(e.element, true);\r\n    if (container) {\r\n      domClasses(container.html)[e.add ? 'add' : 'remove'](e.marker);\r\n    }\r\n  });\r\n\r\n\r\n  eventBus.on('root.set', function() {\r\n    self._updateOverlaysVisibilty(self._canvas.viewbox());\r\n  });\r\n\r\n  // clear overlays with diagram\r\n\r\n  eventBus.on('diagram.clear', this.clear, this);\r\n};\r\n\r\n\r\n\r\n// helpers /////////////////////////////\r\n\r\nfunction createRoot(parentNode) {\r\n  var root = domify(\r\n    '<div class=\"djs-overlay-container\" />'\r\n  );\r\n\r\n  assignStyle(root, {\r\n    position: 'absolute',\r\n    width: 0,\r\n    height: 0\r\n  });\r\n\r\n  parentNode.insertBefore(root, parentNode.firstChild);\r\n\r\n  return root;\r\n}\r\n\r\nfunction setPosition(el, x, y) {\r\n  assignStyle(el, { left: x + 'px', top: y + 'px' });\r\n}\r\n\r\n/**\r\n * Set element visible\r\n *\r\n * @param {DOMElement} el\r\n * @param {boolean} [visible=true]\r\n */\r\nfunction setVisible(el, visible) {\r\n  el.style.display = visible === false ? 'none' : '';\r\n}\r\n\r\nfunction setTransform(el, transform) {\r\n\r\n  el.style['transform-origin'] = 'top left';\r\n\r\n  [ '', '-ms-', '-webkit-' ].forEach(function(prefix) {\r\n    el.style[prefix + 'transform'] = transform;\r\n  });\r\n}","import Overlays from './Overlays';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'overlays' ],\r\n  overlays: [ 'type', Overlays ]\r\n};","import {\r\n  getType as getElementType\r\n} from '../../util/Elements';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../core/GraphicsFactory').default} GraphicsFactory\r\n */\r\n\r\n/**\r\n * Adds change support to the diagram, including\r\n *\r\n * <ul>\r\n *   <li>redrawing shapes and connections on change</li>\r\n * </ul>\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {GraphicsFactory} graphicsFactory\r\n */\r\nexport default function ChangeSupport(\r\n    eventBus, canvas, elementRegistry,\r\n    graphicsFactory) {\r\n\r\n\r\n  // redraw shapes / connections on change\r\n\r\n  eventBus.on('element.changed', function(event) {\r\n\r\n    var element = event.element;\r\n\r\n    // element might have been deleted and replaced by new element with same ID\r\n    // thus check for parent of element except for root element\r\n    if (element.parent || element === canvas.getRootElement()) {\r\n      event.gfx = elementRegistry.getGraphics(element);\r\n    }\r\n\r\n    // shape + gfx may have been deleted\r\n    if (!event.gfx) {\r\n      return;\r\n    }\r\n\r\n    eventBus.fire(getElementType(element) + '.changed', event);\r\n  });\r\n\r\n  eventBus.on('elements.changed', function(event) {\r\n\r\n    var elements = event.elements;\r\n\r\n    elements.forEach(function(e) {\r\n      eventBus.fire('element.changed', { element: e });\r\n    });\r\n\r\n    graphicsFactory.updateContainments(elements);\r\n  });\r\n\r\n  eventBus.on('shape.changed', function(event) {\r\n    graphicsFactory.update('shape', event.element, event.gfx);\r\n  });\r\n\r\n  eventBus.on('connection.changed', function(event) {\r\n    graphicsFactory.update('connection', event.element, event.gfx);\r\n  });\r\n}\r\n\r\nChangeSupport.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'elementRegistry',\r\n  'graphicsFactory'\r\n];","import ChangeSupport from './ChangeSupport';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'changeSupport' ],\r\n  changeSupport: [ 'type', ChangeSupport ]\r\n};","import {\r\n  forEach,\r\n  isFunction,\r\n  isArray,\r\n  isNumber,\r\n  isObject\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../core/Types').ElementLike} ElementLike\r\n * @typedef {import('../core/EventBus').default} EventBus\r\n * @typedef {import('./CommandStack').CommandContext} CommandContext\r\n *\r\n * @typedef {string|string[]} Events\r\n * @typedef { (context: CommandContext) => ElementLike[] | void } HandlerFunction\r\n * @typedef { (context: CommandContext) => void } ComposeHandlerFunction\r\n */\r\n\r\nvar DEFAULT_PRIORITY = 1000;\r\n\r\n/**\r\n * A utility that can be used to plug into the command execution for\r\n * extension and/or validation.\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n *\r\n * class CommandLogger extends CommandInterceptor {\r\n *   constructor(eventBus) {\r\n *     super(eventBus);\r\n *\r\n *   this.preExecute('shape.create', (event) => {\r\n *     console.log('commandStack.shape-create.preExecute', event);\r\n *   });\r\n * }\r\n * ```\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function CommandInterceptor(eventBus) {\r\n\r\n  /**\r\n   * @type {EventBus}\r\n   */\r\n  this._eventBus = eventBus;\r\n}\r\n\r\nCommandInterceptor.$inject = [ 'eventBus' ];\r\n\r\nfunction unwrapEvent(fn, that) {\r\n  return function(event) {\r\n    return fn.call(that || null, event.context, event.command, event);\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Intercept a command during one of the phases.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {string} [hook] phase to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.on = function(events, hook, priority, handlerFn, unwrap, that) {\r\n\r\n  if (isFunction(hook) || isNumber(hook)) {\r\n    that = unwrap;\r\n    unwrap = handlerFn;\r\n    handlerFn = priority;\r\n    priority = hook;\r\n    hook = null;\r\n  }\r\n\r\n  if (isFunction(priority)) {\r\n    that = unwrap;\r\n    unwrap = handlerFn;\r\n    handlerFn = priority;\r\n    priority = DEFAULT_PRIORITY;\r\n  }\r\n\r\n  if (isObject(unwrap)) {\r\n    that = unwrap;\r\n    unwrap = false;\r\n  }\r\n\r\n  if (!isFunction(handlerFn)) {\r\n    throw new Error('handlerFn must be a function');\r\n  }\r\n\r\n  if (!isArray(events)) {\r\n    events = [ events ];\r\n  }\r\n\r\n  var eventBus = this._eventBus;\r\n\r\n  forEach(events, function(event) {\r\n\r\n    // concat commandStack(.event)?(.hook)?\r\n    var fullEvent = [ 'commandStack', event, hook ].filter(function(e) { return e; }).join('.');\r\n\r\n    eventBus.on(fullEvent, priority, unwrap ? unwrapEvent(handlerFn, that) : handlerFn, that);\r\n  });\r\n};\r\n\r\n/**\r\n * Add a <canExecute> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.canExecute = createHook('canExecute');\r\n\r\n/**\r\n * Add a <preExecute> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.preExecute = createHook('preExecute');\r\n\r\n/**\r\n * Add a <preExecuted> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.preExecuted = createHook('preExecuted');\r\n\r\n/**\r\n * Add a <execute> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.execute = createHook('execute');\r\n\r\n/**\r\n * Add a <executed> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.executed = createHook('executed');\r\n\r\n/**\r\n * Add a <postExecute> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.postExecute = createHook('postExecute');\r\n\r\n/**\r\n * Add a <postExecuted> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.postExecuted = createHook('postExecuted');\r\n\r\n/**\r\n * Add a <revert> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.revert = createHook('revert');\r\n\r\n/**\r\n * Add a <reverted> phase of command interceptor.\r\n *\r\n * @param {Events} [events] command(s) to intercept\r\n * @param {number} [priority]\r\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n * @param {boolean} [unwrap] whether the event should be unwrapped\r\n * @param {any} [that]\r\n */\r\nCommandInterceptor.prototype.reverted = createHook('reverted');\r\n\r\n/*\r\n * Add prototype methods for each phase of command execution (e.g. execute,\r\n * revert).\r\n *\r\n * @param {string} hook\r\n *\r\n * @return { (\r\n *   events?: Events,\r\n *   priority?: number,\r\n *   handlerFn: ComposeHandlerFunction|HandlerFunction,\r\n *   unwrap?: boolean\r\n * ) => any }\r\n */\r\nfunction createHook(hook) {\r\n\r\n  /**\r\n   * @this {CommandInterceptor}\r\n   *\r\n   * @param {Events} [events]\r\n   * @param {number} [priority]\r\n   * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\r\n   * @param {boolean} [unwrap]\r\n   * @param {any} [that]\r\n   */\r\n  const hookFn = function(events, priority, handlerFn, unwrap, that) {\r\n\r\n    if (isFunction(events) || isNumber(events)) {\r\n      that = unwrap;\r\n      unwrap = handlerFn;\r\n      handlerFn = priority;\r\n      priority = events;\r\n      events = null;\r\n    }\r\n\r\n    this.on(events, hook, priority, handlerFn, unwrap, that);\r\n  };\r\n\r\n  return hookFn;\r\n}\r\n","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from '../../command/CommandInterceptor';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n */\r\n\r\n/**\r\n * A modeling behavior that ensures we set the correct root element\r\n * as we undo and redo commands.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {Injector} injector\r\n */\r\nexport default function RootElementsBehavior(canvas, injector) {\r\n\r\n  injector.invoke(CommandInterceptor, this);\r\n\r\n  this.executed(function(event) {\r\n    var context = event.context;\r\n\r\n    if (context.rootElement) {\r\n      canvas.setRootElement(context.rootElement);\r\n    } else {\r\n      context.rootElement = canvas.getRootElement();\r\n    }\r\n  });\r\n\r\n  this.revert(function(event) {\r\n    var context = event.context;\r\n\r\n    if (context.rootElement) {\r\n      canvas.setRootElement(context.rootElement);\r\n    }\r\n  });\r\n}\r\n\r\ninherits(RootElementsBehavior, CommandInterceptor);\r\n\r\nRootElementsBehavior.$inject = [ 'canvas', 'injector' ];","import RootElementsBehavior from './RootElementsBehavior';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'rootElementsBehavior' ],\r\n  rootElementsBehavior: [ 'type', RootElementsBehavior ]\r\n};\r\n","/**\r\n * @param {string} str\r\n *\r\n * @return {string}\r\n */\r\nexport function escapeCSS(str) {\r\n  return CSS.escape(str);\r\n}\r\n\r\nvar HTML_ESCAPE_MAP = {\r\n  '&': '&amp;',\r\n  '<': '&lt;',\r\n  '>': '&gt;',\r\n  '\"': '&quot;',\r\n  '\\'': '&#39;'\r\n};\r\n\r\n/**\r\n * @param {string} str\r\n *\r\n * @return {string}\r\n */\r\nexport function escapeHTML(str) {\r\n  str = '' + str;\r\n\r\n  return str && str.replace(/[&<>\"']/g, function(match) {\r\n    return HTML_ESCAPE_MAP[match];\r\n  });\r\n}\r\n","import { getDi, is } from './ModelUtil';\n\n/**\n * @typedef {import('../model/Types').Element} Element\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\nexport var planeSuffix = '_plane';\n\n/**\n * Get primary shape ID for a plane.\n *\n * @param  {Element|ModdleElement} element\n *\n * @return {string}\n */\nexport function getShapeIdFromPlane(element) {\n  var id = element.id;\n\n  return removePlaneSuffix(id);\n}\n\n/**\n * Get plane ID for a primary shape.\n *\n * @param  {Element|ModdleElement} element\n *\n * @return {string}\n */\nexport function getPlaneIdFromShape(element) {\n  var id = element.id;\n\n  if (is(element, 'bpmn:SubProcess')) {\n    return addPlaneSuffix(id);\n  }\n\n  return id;\n}\n\n/**\n * Get plane ID for primary shape ID.\n *\n * @param {string} id\n *\n * @return {string}\n */\nexport function toPlaneId(id) {\n  return addPlaneSuffix(id);\n}\n\n/**\n * Check wether element is plane.\n *\n * @param  {Element|ModdleElement} element\n *\n * @return {boolean}\n */\nexport function isPlane(element) {\n  var di = getDi(element);\n\n  return is(di, 'bpmndi:BPMNPlane');\n}\n\nfunction addPlaneSuffix(id) {\n  return id + planeSuffix;\n}\n\nfunction removePlaneSuffix(id) {\n  return id.replace(new RegExp(planeSuffix + '$'), '');\n}","import { domify, classes } from 'min-dom';\nimport { find } from 'min-dash';\n\nimport { escapeHTML } from 'diagram-js/lib/util/EscapeUtil';\nimport { getBusinessObject, is } from '../../util/ModelUtil';\nimport {\n  getPlaneIdFromShape\n} from '../../util/DrilldownUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\nvar OPEN_CLASS = 'bjs-breadcrumbs-shown';\n\n\n/**\n * Adds overlays that allow switching planes on collapsed subprocesses.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Canvas} canvas\n */\nexport default function DrilldownBreadcrumbs(eventBus, elementRegistry, canvas) {\n  var breadcrumbs = domify('<ul class=\"bjs-breadcrumbs\"></ul>');\n  var container = canvas.getContainer();\n  var containerClasses = classes(container);\n  container.appendChild(breadcrumbs);\n\n  var businessObjectParents = [];\n\n  // update breadcrumbs if name or ID of the primary shape changes\n  eventBus.on('element.changed', function(event) {\n    var shape = event.element,\n        businessObject = getBusinessObject(shape);\n\n    var isPresent = find(businessObjectParents, function(element) {\n      return element === businessObject;\n    });\n\n    if (!isPresent) {\n      return;\n    }\n\n    updateBreadcrumbs();\n  });\n\n  /**\n   * Updates the displayed breadcrumbs. If no element is provided, only the\n   * labels are updated.\n   *\n   * @param {Element} [element]\n   */\n  function updateBreadcrumbs(element) {\n    if (element) {\n      businessObjectParents = getBusinessObjectParentChain(element);\n    }\n\n    var path = businessObjectParents.map(function(parent) {\n      var title = escapeHTML(parent.name || parent.id);\n      var link = domify('<li><span class=\"bjs-crumb\"><a title=\"' + title + '\">' + title + '</a></span></li>');\n\n      var parentPlane = canvas.findRoot(getPlaneIdFromShape(parent)) || canvas.findRoot(parent.id);\n\n      // when the root is a collaboration, the process does not have a corresponding\n      // element in the elementRegisty. Instead, we search for the corresponding participant\n      if (!parentPlane && is(parent, 'bpmn:Process')) {\n        var participant = elementRegistry.find(function(element) {\n          var businessObject = getBusinessObject(element);\n\n          return businessObject && businessObject.get('processRef') && businessObject.get('processRef') === parent;\n        });\n\n        parentPlane = canvas.findRoot(participant.id);\n      }\n\n      link.addEventListener('click', function() {\n        canvas.setRootElement(parentPlane);\n      });\n\n      return link;\n    });\n\n    breadcrumbs.innerHTML = '';\n\n    // show breadcrumbs and expose state to .djs-container\n    var visible = path.length > 1;\n\n    containerClasses.toggle(OPEN_CLASS, visible);\n\n    path.forEach(function(element) {\n      breadcrumbs.appendChild(element);\n    });\n  }\n\n  eventBus.on('root.set', function(event) {\n    updateBreadcrumbs(event.element);\n  });\n\n}\n\nDrilldownBreadcrumbs.$inject = [ 'eventBus', 'elementRegistry', 'canvas' ];\n\n\n// helpers //////////\n\n/**\n * Returns the parents for the element using the business object chain,\n * starting with the root element.\n *\n * @param {Shape} child\n *\n * @return {Shape}\n */\nfunction getBusinessObjectParentChain(child) {\n  var businessObject = getBusinessObject(child);\n\n  var parents = [];\n\n  for (var element = businessObject; element; element = element.$parent) {\n    if (is(element, 'bpmn:SubProcess') || is(element, 'bpmn:Process')) {\n      parents.push(element);\n    }\n  }\n\n  return parents.reverse();\n}","import { is } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * Move collapsed subprocesses into view when drilling down.\n *\n * Zoom and scroll are saved in a session.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function DrilldownCentering(eventBus, canvas) {\n\n  var currentRoot = null;\n  var positionMap = new Map();\n\n  eventBus.on('root.set', function(event) {\n    var newRoot = event.element;\n    var currentViewbox = canvas.viewbox();\n    var storedViewbox = positionMap.get(newRoot);\n\n    positionMap.set(currentRoot, {\n      x: currentViewbox.x,\n      y: currentViewbox.y,\n      zoom: currentViewbox.scale\n    });\n\n    currentRoot = newRoot;\n\n    // current root was replaced with a collaboration, we don't update the viewbox\n    if (is(newRoot, 'bpmn:Collaboration') && !storedViewbox) {\n      return;\n    }\n\n    storedViewbox = storedViewbox || { x: 0, y: 0, zoom: 1 };\n\n    var dx = (currentViewbox.x - storedViewbox.x) * currentViewbox.scale,\n        dy = (currentViewbox.y - storedViewbox.y) * currentViewbox.scale;\n\n    if (dx !== 0 || dy !== 0) {\n      canvas.scroll({\n        dx: dx,\n        dy: dy\n      });\n    }\n\n    if (storedViewbox.zoom !== currentViewbox.scale) {\n      canvas.zoom(storedViewbox.zoom, { x: 0, y: 0 });\n    }\n  });\n\n  eventBus.on('diagram.clear', function() {\n    positionMap.clear();\n    currentRoot = null;\n  });\n\n}\n\nDrilldownCentering.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * ES5 Map implementation. Works.\n */\nfunction Map() {\n\n  this._entries = [];\n\n  this.set = function(key, value) {\n\n    var found = false;\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        this._entries[k][1] = value;\n\n        found = true;\n\n        break;\n      }\n    }\n\n    if (!found) {\n      this._entries.push([ key, value ]);\n    }\n  };\n\n  this.get = function(key) {\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        return this._entries[k][1];\n      }\n    }\n\n    return null;\n  };\n\n  this.clear = function() {\n    this._entries.length = 0;\n  };\n\n  this.remove = function(key) {\n\n    var idx = -1;\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        idx = k;\n\n        break;\n      }\n    }\n\n    if (idx !== -1) {\n      this._entries.splice(idx, 1);\n    }\n  };\n}","\nimport { asBounds, asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\nimport { is, isAny } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../model/Types').Moddle} Moddle\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/core/Canvas').CanvasPlane} CanvasPlane\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\nvar DEFAULT_POSITION = {\n  x: 180,\n  y: 160\n};\n\n/**\n * Hook into `import.render.start` and create new planes for diagrams with\n * collapsed subprocesses and all DI elements on the same plane.\n *\n * @param {EventBus} eventBus\n * @param {Moddle} moddle\n */\nexport default function SubprocessCompatibility(eventBus, moddle) {\n  this._eventBus = eventBus;\n  this._moddle = moddle;\n\n  var self = this;\n\n  eventBus.on('import.render.start', 1500, function(e, context) {\n    self._handleImport(context.definitions);\n  });\n}\n\n/**\n * @param {ModdleElement} definitions\n */\nSubprocessCompatibility.prototype._handleImport = function(definitions) {\n  if (!definitions.diagrams) {\n    return;\n  }\n\n  var self = this;\n  this._definitions = definitions;\n  this._processToDiagramMap = {};\n\n  definitions.diagrams.forEach(function(diagram) {\n    if (!diagram.plane || !diagram.plane.bpmnElement) {\n      return;\n    }\n\n    self._processToDiagramMap[diagram.plane.bpmnElement.id] = diagram;\n  });\n\n  var newDiagrams = [];\n  definitions.diagrams.forEach(function(diagram) {\n    var createdDiagrams = self._createNewDiagrams(diagram.plane);\n    Array.prototype.push.apply(newDiagrams, createdDiagrams);\n  });\n\n  newDiagrams.forEach(function(diagram) {\n    self._movePlaneElementsToOrigin(diagram.plane);\n  });\n};\n\n\n/**\n * Moves all DI elements from collapsed subprocesses to a new plane.\n *\n * @param {CanvasPlane} plane\n *\n * @return {ModdleElement[]} new diagrams created for the collapsed subprocesses\n */\nSubprocessCompatibility.prototype._createNewDiagrams = function(plane) {\n  var self = this;\n\n  var collapsedElements = [];\n  var elementsToMove = [];\n\n  plane.get('planeElement').forEach(function(diElement) {\n    var businessObject = diElement.bpmnElement;\n\n    if (!businessObject) {\n      return;\n    }\n\n    var parent = businessObject.$parent;\n\n    if (is(businessObject, 'bpmn:SubProcess') && !diElement.isExpanded) {\n      collapsedElements.push(businessObject);\n    }\n\n    if (shouldMoveToPlane(businessObject, plane)) {\n\n      // don't change the array while we iterate over it\n      elementsToMove.push({ diElement: diElement, parent: parent });\n    }\n  });\n\n  var newDiagrams = [];\n\n  // create new planes for all collapsed subprocesses, even when they are empty\n  collapsedElements.forEach(function(element) {\n    if (!self._processToDiagramMap[ element.id ]) {\n      var diagram = self._createDiagram(element);\n\n      self._processToDiagramMap[element.id] = diagram;\n\n      newDiagrams.push(diagram);\n    }\n  });\n\n  elementsToMove.forEach(function(element) {\n    var diElement = element.diElement;\n    var parent = element.parent;\n\n    // parent is expanded, get nearest collapsed parent\n    while (parent && collapsedElements.indexOf(parent) === -1) {\n      parent = parent.$parent;\n    }\n\n    // false positive, all parents are expanded\n    if (!parent) {\n      return;\n    }\n\n    var diagram = self._processToDiagramMap[ parent.id ];\n\n    self._moveToDiPlane(diElement, diagram.plane);\n  });\n\n  return newDiagrams;\n};\n\n/**\n * @param {CanvasPlane} plane\n */\nSubprocessCompatibility.prototype._movePlaneElementsToOrigin = function(plane) {\n  var elements = plane.get('planeElement');\n\n  // get bounding box of all elements\n  var planeBounds = getPlaneBounds(plane);\n\n  var offset = {\n    x: planeBounds.x - DEFAULT_POSITION.x,\n    y: planeBounds.y - DEFAULT_POSITION.y\n  };\n\n  elements.forEach(function(diElement) {\n    if (diElement.waypoint) {\n      diElement.waypoint.forEach(function(waypoint) {\n        waypoint.x = waypoint.x - offset.x;\n        waypoint.y = waypoint.y - offset.y;\n      });\n    } else if (diElement.bounds) {\n      diElement.bounds.x = diElement.bounds.x - offset.x;\n      diElement.bounds.y = diElement.bounds.y - offset.y;\n    }\n  });\n};\n\n/**\n * @param {ModdleElement} diElement\n * @param {CanvasPlane} newPlane\n */\nSubprocessCompatibility.prototype._moveToDiPlane = function(diElement, newPlane) {\n  var containingDiagram = findRootDiagram(diElement);\n\n  // remove DI from old Plane and add it to the new one\n  var parentPlaneElement = containingDiagram.plane.get('planeElement');\n\n  parentPlaneElement.splice(parentPlaneElement.indexOf(diElement), 1);\n\n  newPlane.get('planeElement').push(diElement);\n};\n\n/**\n * @param {ModdleElement} businessObject\n *\n * @return {ModdleElement}\n */\nSubprocessCompatibility.prototype._createDiagram = function(businessObject) {\n  var plane = this._moddle.create('bpmndi:BPMNPlane', {\n    bpmnElement: businessObject\n  });\n\n  var diagram = this._moddle.create('bpmndi:BPMNDiagram', {\n    plane: plane\n  });\n\n  plane.$parent = diagram;\n\n  plane.bpmnElement = businessObject;\n\n  diagram.$parent = this._definitions;\n\n  this._definitions.diagrams.push(diagram);\n\n  return diagram;\n};\n\nSubprocessCompatibility.$inject = [ 'eventBus', 'moddle' ];\n\n\n// helpers //////////\n\nfunction findRootDiagram(element) {\n  if (is(element, 'bpmndi:BPMNDiagram')) {\n    return element;\n  } else {\n    return findRootDiagram(element.$parent);\n  }\n}\n\n/**\n * @param {CanvasPlane} plane\n *\n * @return {Rect}\n */\nfunction getPlaneBounds(plane) {\n  var planeTrbl = {\n    top: Infinity,\n    right: -Infinity,\n    bottom: -Infinity,\n    left: Infinity\n  };\n\n  plane.planeElement.forEach(function(element) {\n    if (!element.bounds) {\n      return;\n    }\n\n    var trbl = asTRBL(element.bounds);\n\n    planeTrbl.top = Math.min(trbl.top, planeTrbl.top);\n    planeTrbl.left = Math.min(trbl.left, planeTrbl.left);\n  });\n\n  return asBounds(planeTrbl);\n}\n\n/**\n * @param {ModdleElement} businessObject\n * @param {CanvasPlane} plane\n *\n * @return {boolean}\n */\nfunction shouldMoveToPlane(businessObject, plane) {\n  var parent = businessObject.$parent;\n\n  // don't move elements that are already on the plane\n  if (!is(parent, 'bpmn:SubProcess') || parent === plane.bpmnElement) {\n    return false;\n  }\n\n  // dataAssociations are children of the subprocess but rendered on process level\n  // cf. https://github.com/bpmn-io/bpmn-js/issues/1619\n  if (isAny(businessObject, [ 'bpmn:DataInputAssociation', 'bpmn:DataOutputAssociation' ])) {\n    return false;\n  }\n\n  return true;\n}\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { getBusinessObject, is } from '../../util/ModelUtil';\nimport { classes, domify } from 'min-dom';\nimport { getPlaneIdFromShape } from '../../util/DrilldownUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/overlays/Overlays').default} Overlays\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Parent} Parent\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\nvar LOW_PRIORITY = 250;\nvar ARROW_DOWN_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z\"/></svg>';\n\nvar EMPTY_MARKER = 'bjs-drilldown-empty';\n\n/**\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Overlays} overlays\n */\nexport default function DrilldownOverlayBehavior(\n    canvas, eventBus, elementRegistry, overlays\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._elementRegistry = elementRegistry;\n  this._overlays = overlays;\n\n  var self = this;\n\n  this.executed('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    // Add overlay to the collapsed shape\n    if (self._canDrillDown(shape)) {\n      self._addOverlay(shape);\n    } else {\n      self._removeOverlay(shape);\n    }\n  }, true);\n\n\n  this.reverted('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    // Add overlay to the collapsed shape\n    if (self._canDrillDown(shape)) {\n      self._addOverlay(shape);\n    } else {\n      self._removeOverlay(shape);\n    }\n  }, true);\n\n\n  this.executed([ 'shape.create', 'shape.move', 'shape.delete' ], LOW_PRIORITY,\n    function(context) {\n      var oldParent = context.oldParent,\n          newParent = context.newParent || context.parent,\n          shape = context.shape;\n\n      // Add overlay to the collapsed shape\n      if (self._canDrillDown(shape)) {\n        self._addOverlay(shape);\n      }\n\n      self._updateDrilldownOverlay(oldParent);\n      self._updateDrilldownOverlay(newParent);\n      self._updateDrilldownOverlay(shape);\n    }, true);\n\n\n  this.reverted([ 'shape.create', 'shape.move', 'shape.delete' ], LOW_PRIORITY,\n    function(context) {\n      var oldParent = context.oldParent,\n          newParent = context.newParent || context.parent,\n          shape = context.shape;\n\n      // Add overlay to the collapsed shape\n      if (self._canDrillDown(shape)) {\n        self._addOverlay(shape);\n      }\n\n      self._updateDrilldownOverlay(oldParent);\n      self._updateDrilldownOverlay(newParent);\n      self._updateDrilldownOverlay(shape);\n    }, true);\n\n\n  eventBus.on('import.render.complete', function() {\n    elementRegistry.filter(function(e) {\n      return self._canDrillDown(e);\n    }).map(function(el) {\n      self._addOverlay(el);\n    });\n  });\n\n}\n\ninherits(DrilldownOverlayBehavior, CommandInterceptor);\n\n/**\n * @param {Shape} shape\n */\nDrilldownOverlayBehavior.prototype._updateDrilldownOverlay = function(shape) {\n  var canvas = this._canvas;\n\n  if (!shape) {\n    return;\n  }\n\n  var root = canvas.findRoot(shape);\n\n  if (root) {\n    this._updateOverlayVisibility(root);\n  }\n};\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nDrilldownOverlayBehavior.prototype._canDrillDown = function(element) {\n  var canvas = this._canvas;\n\n  return is(element, 'bpmn:SubProcess') && canvas.findRoot(getPlaneIdFromShape(element));\n};\n\n/**\n * Update the visibility of the drilldown overlay. If the plane has no elements,\n * the drilldown will only be shown when the element is selected.\n *\n * @param {Parent} element The collapsed root or shape.\n */\nDrilldownOverlayBehavior.prototype._updateOverlayVisibility = function(element) {\n  var overlays = this._overlays;\n\n  var businessObject = getBusinessObject(element);\n\n  var overlay = overlays.get({ element: businessObject.id, type: 'drilldown' })[0];\n\n  if (!overlay) {\n    return;\n  }\n\n  var hasFlowElements = businessObject\n    && businessObject.get('flowElements')\n    && businessObject.get('flowElements').length;\n\n  classes(overlay.html).toggle(EMPTY_MARKER, !hasFlowElements);\n};\n\n/**\n * Add a drilldown button to the given element assuming the plane has the same\n * ID as the element.\n *\n * @param {Shape} element The collapsed shape.\n */\nDrilldownOverlayBehavior.prototype._addOverlay = function(element) {\n  var canvas = this._canvas,\n      overlays = this._overlays;\n\n  var existingOverlays = overlays.get({ element: element, type: 'drilldown' });\n\n  if (existingOverlays.length) {\n    this._removeOverlay(element);\n  }\n\n  var button = domify('<button class=\"bjs-drilldown\">' + ARROW_DOWN_SVG + '</button>');\n\n  button.addEventListener('click', function() {\n    canvas.setRootElement(canvas.findRoot(getPlaneIdFromShape(element)));\n  });\n\n  overlays.add(element, 'drilldown', {\n    position: {\n      bottom: -7,\n      right: -8\n    },\n    html: button\n  });\n\n  this._updateOverlayVisibility(element);\n};\n\nDrilldownOverlayBehavior.prototype._removeOverlay = function(element) {\n  var overlays = this._overlays;\n\n  overlays.remove({\n    element: element,\n    type: 'drilldown'\n  });\n};\n\nDrilldownOverlayBehavior.$inject = [\n  'canvas',\n  'eventBus',\n  'elementRegistry',\n  'overlays'\n];","import OverlaysModule from 'diagram-js/lib/features/overlays';\nimport ChangeSupportModule from 'diagram-js/lib/features/change-support';\nimport RootElementsModule from 'diagram-js/lib/features/root-elements';\n\nimport DrilldownBreadcrumbs from './DrilldownBreadcrumbs';\nimport DrilldownCentering from './DrilldownCentering';\nimport SubprocessCompatibility from './SubprocessCompatibility';\nimport DrilldownOverlayBehavior from './DrilldownOverlayBehavior';\n\nexport default {\n  __depends__: [ OverlaysModule, ChangeSupportModule, RootElementsModule ],\n  __init__: [ 'drilldownBreadcrumbs', 'drilldownOverlayBehavior', 'drilldownCentering', 'subprocessCompatibility' ],\n  drilldownBreadcrumbs: [ 'type', DrilldownBreadcrumbs ],\n  drilldownCentering: [ 'type', DrilldownCentering ],\n  drilldownOverlayBehavior: [ 'type', DrilldownOverlayBehavior ],\n  subprocessCompatibility: [ 'type', SubprocessCompatibility ]\n};","import { getBBox } from '../../util/Elements';\r\n\r\nvar LOW_PRIORITY = 500;\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  query as domQuery\r\n} from 'min-dom';\r\n\r\nimport {\r\n  assign,\r\n  forEach,\r\n  isFunction\r\n} from 'min-dash';\r\n\r\nvar DEFAULT_PRIORITY = 1000;\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('./OutlineProvider').default} OutlineProvider\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../draw/Styles').default} Styles\r\n */\r\n\r\n/**\r\n * @class\r\n *\r\n * A plugin that adds an outline to shapes and connections that may be activated and styled\r\n * via CSS classes.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Styles} styles\r\n */\r\nexport default function Outline(eventBus, styles) {\r\n\r\n  this._eventBus = eventBus;\r\n\r\n  this.offset = 5;\r\n\r\n  var OUTLINE_STYLE = styles.cls('djs-outline', [ 'no-fill' ]);\r\n\r\n  var self = this;\r\n\r\n  /**\r\n   * @param {SVGElement} gfx\r\n   *\r\n   * @return {SVGElement} outline\r\n   */\r\n  function createOutline(gfx) {\r\n    var outline = svgCreate('rect');\r\n\r\n    svgAttr(outline, assign({\r\n      x: 0,\r\n      y: 0,\r\n      rx: 4,\r\n      width: 100,\r\n      height: 100\r\n    }, OUTLINE_STYLE));\r\n\r\n    return outline;\r\n  }\r\n\r\n  // A low priortity is necessary, because outlines of labels have to be updated\r\n  // after the label bounds have been updated in the renderer.\r\n  eventBus.on([ 'shape.added', 'shape.changed' ], LOW_PRIORITY, function(event) {\r\n    var element = event.element,\r\n        gfx = event.gfx;\r\n\r\n    var outline = domQuery('.djs-outline', gfx);\r\n\r\n    if (!outline) {\r\n      outline = self.getOutline(element) || createOutline(gfx);\r\n      svgAppend(gfx, outline);\r\n    }\r\n\r\n    self.updateShapeOutline(outline, element);\r\n  });\r\n\r\n  eventBus.on([ 'connection.added', 'connection.changed' ], function(event) {\r\n    var element = event.element,\r\n        gfx = event.gfx;\r\n\r\n    var outline = domQuery('.djs-outline', gfx);\r\n\r\n    if (!outline) {\r\n      outline = createOutline(gfx);\r\n      svgAppend(gfx, outline);\r\n    }\r\n\r\n    self.updateConnectionOutline(outline, element);\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * Updates the outline of a shape respecting the dimension of the\r\n * element and an outline offset.\r\n *\r\n * @param {SVGElement} outline\r\n * @param {Element} element\r\n */\r\nOutline.prototype.updateShapeOutline = function(outline, element) {\r\n\r\n  var updated = false;\r\n  var providers = this._getProviders();\r\n\r\n  if (providers.length) {\r\n    forEach(providers, function(provider) {\r\n      updated = updated || provider.updateOutline(element, outline);\r\n    });\r\n  }\r\n\r\n  if (!updated) {\r\n    svgAttr(outline, {\r\n      x: -this.offset,\r\n      y: -this.offset,\r\n      width: element.width + this.offset * 2,\r\n      height: element.height + this.offset * 2\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Updates the outline of a connection respecting the bounding box of\r\n * the connection and an outline offset.\r\n * Register an outline provider with the given priority.\r\n *\r\n * @param {SVGElement} outline\r\n * @param {Element} connection\r\n */\r\nOutline.prototype.updateConnectionOutline = function(outline, connection) {\r\n  var bbox = getBBox(connection);\r\n\r\n  svgAttr(outline, {\r\n    x: bbox.x - this.offset,\r\n    y: bbox.y - this.offset,\r\n    width: bbox.width + this.offset * 2,\r\n    height: bbox.height + this.offset * 2\r\n  });\r\n};\r\n\r\n/**\r\n * Register an outline provider with the given priority.\r\n *\r\n * @param {number} priority\r\n * @param {OutlineProvider} provider\r\n */\r\nOutline.prototype.registerProvider = function(priority, provider) {\r\n  if (!provider) {\r\n    provider = priority;\r\n    priority = DEFAULT_PRIORITY;\r\n  }\r\n\r\n  this._eventBus.on('outline.getProviders', priority, function(event) {\r\n    event.providers.push(provider);\r\n  });\r\n};\r\n\r\n/**\r\n * Returns the registered outline providers.\r\n *\r\n * @returns {OutlineProvider[]}\r\n */\r\nOutline.prototype._getProviders = function() {\r\n  var event = this._eventBus.createEvent({\r\n    type: 'outline.getProviders',\r\n    providers: []\r\n  });\r\n\r\n  this._eventBus.fire(event);\r\n\r\n  return event.providers;\r\n};\r\n\r\n/**\r\n * Returns the outline for an element.\r\n *\r\n * @param {Element} element\r\n */\r\nOutline.prototype.getOutline = function(element) {\r\n  var outline;\r\n  var providers = this._getProviders();\r\n\r\n  forEach(providers, function(provider) {\r\n\r\n    if (!isFunction(provider.getOutline)) {\r\n      return;\r\n    }\r\n\r\n    outline = outline || provider.getOutline(element);\r\n  });\r\n\r\n  return outline;\r\n};\r\n\r\nOutline.$inject = [ 'eventBus', 'styles', 'elementRegistry' ];","import Outline from './Outline';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'outline' ],\r\n  outline: [ 'type', Outline ]\r\n};","import {\n  create as svgCreate\n} from 'tiny-svg';\n\nexport const DATA_OBJECT_REFERENCE_OUTLINE_PATH = 'M44.7648 11.3263L36.9892 2.64074C36.0451 1.58628 34.5651 0.988708 33.1904 0.988708H5.98667C3.22688 0.988708 0.989624 3.34892 0.989624 6.26039V55.0235C0.989624 57.9349 3.22688 60.2952 5.98667 60.2952H40.966C43.7257 60.2952 45.963 57.9349 45.963 55.0235V14.9459C45.963 13.5998 45.6407 12.3048 44.7648 11.3263Z';\nexport const DATA_STORE_REFERENCE_OUTLINE_PATH = 'M1.03845 48.1347C1.03845 49.3511 1.07295 50.758 1.38342 52.064C1.69949 53.3938 2.32428 54.7154 3.56383 55.6428C6.02533 57.4841 10.1161 58.7685 14.8212 59.6067C19.5772 60.4538 25.1388 60.8738 30.6831 60.8738C36.2276 60.8738 41.7891 60.4538 46.545 59.6067C51.2504 58.7687 55.3412 57.4842 57.8028 55.6429C59.0424 54.7156 59.6673 53.3938 59.9834 52.064C60.2938 50.7579 60.3285 49.351 60.3285 48.1344V13.8415C60.3285 12.6249 60.2938 11.218 59.9834 9.91171C59.6673 8.58194 59.0423 7.2602 57.8027 6.33294C55.341 4.49168 51.2503 3.20723 46.545 2.36914C41.7891 1.522 36.2276 1.10204 30.6831 1.10205C25.1388 1.10206 19.5772 1.52206 14.8213 2.36923C10.1162 3.20734 6.02543 4.49183 3.5639 6.33314C2.32433 7.26038 1.69951 8.58206 1.38343 9.91181C1.07295 11.2179 1.03845 12.6247 1.03845 13.8411V48.1347Z';\n\n/**\n * @type {Dimensions}\n */\nexport const DATA_OBJECT_REFERENCE_STANDARD_SIZE = { width: 36, height: 50 };\n\n/**\n * @type {Dimensions}\n */\nexport const DATA_STORE_REFERENCE_STANDARD_SIZE = { width: 50, height: 50 };\n\n/**\n * Create a path element with given attributes.\n * @param {string} path\n * @param {Object} attrs\n * @param {Object} OUTLINE_STYLE\n * @return {SVGElement}\n */\nexport function createPath(path, attrs, OUTLINE_STYLE) {\n  return svgCreate('path', {\n    d: path,\n    strokeWidth: 2,\n    transform: `translate(${attrs.x}, ${attrs.y})`,\n    ...OUTLINE_STYLE\n  });\n}","import { assign } from 'min-dash';\n\nimport {\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport {\n  is,\n  isAny\n} from '../../util/ModelUtil';\n\nimport { isLabel } from '../../util/LabelUtil';\n\nimport {\n  DATA_OBJECT_REFERENCE_OUTLINE_PATH,\n  DATA_STORE_REFERENCE_OUTLINE_PATH,\n  DATA_OBJECT_REFERENCE_STANDARD_SIZE,\n  DATA_STORE_REFERENCE_STANDARD_SIZE,\n  createPath\n} from './OutlineUtil';\n\nconst DEFAULT_OFFSET = 5;\n\n/**\n * BPMN-specific outline provider.\n *\n * @implements {BaseOutlineProvider}\n *\n * @param {Outline} outline\n * @param {Styles} styles\n */\nexport default function OutlineProvider(outline, styles) {\n\n  this._styles = styles;\n  outline.registerProvider(this);\n}\n\nOutlineProvider.$inject = [\n  'outline',\n  'styles'\n];\n\n/**\n * Returns outline for a given element.\n *\n * @param {Element} element\n *\n * @return {Outline}\n */\nOutlineProvider.prototype.getOutline = function(element) {\n\n  const OUTLINE_STYLE = this._styles.cls('djs-outline', [ 'no-fill' ]);\n\n  var outline;\n\n  if (isLabel(element)) {\n    return;\n  }\n\n  if (is(element, 'bpmn:Gateway')) {\n    outline = svgCreate('rect');\n\n    assign(outline.style, {\n      'transform-box': 'fill-box',\n      'transform': 'rotate(45deg)',\n      'transform-origin': 'center'\n    });\n\n    svgAttr(outline, assign({\n      x: 2,\n      y: 2,\n      rx: 4,\n      width: element.width - 4,\n      height: element.height - 4,\n    }, OUTLINE_STYLE));\n\n  } else if (isAny(element, [ 'bpmn:Task', 'bpmn:SubProcess', 'bpmn:Group' ])) {\n    outline = svgCreate('rect');\n\n    svgAttr(outline, assign({\n      x: -DEFAULT_OFFSET,\n      y: -DEFAULT_OFFSET,\n      rx: 14,\n      width: element.width + DEFAULT_OFFSET * 2,\n      height: element.height + DEFAULT_OFFSET * 2\n    }, OUTLINE_STYLE));\n\n  } else if (is(element, 'bpmn:EndEvent')) {\n\n    outline = svgCreate('circle');\n\n    // Extra 1px offset needed due to increased stroke-width of end event\n    // which makes it bigger than other events.\n\n    svgAttr(outline, assign({\n      cx: element.width / 2,\n      cy: element.height / 2,\n      r: element.width / 2 + DEFAULT_OFFSET + 1\n    }, OUTLINE_STYLE));\n\n  } else if (is(element, 'bpmn:Event')) {\n    outline = svgCreate('circle');\n\n    svgAttr(outline, assign({\n      cx: element.width / 2,\n      cy: element.height / 2,\n      r: element.width / 2 + DEFAULT_OFFSET\n    }, OUTLINE_STYLE));\n\n  } else if (is(element, 'bpmn:DataObjectReference') && isStandardSize(element, 'bpmn:DataObjectReference')) {\n\n    outline = createPath(\n      DATA_OBJECT_REFERENCE_OUTLINE_PATH,\n      { x: -6, y: -6 },\n      OUTLINE_STYLE\n    );\n\n  } else if (is(element, 'bpmn:DataStoreReference') && isStandardSize(element, 'bpmn:DataStoreReference')) {\n\n    outline = createPath(\n      DATA_STORE_REFERENCE_OUTLINE_PATH,\n      { x: -6, y: -6 },\n      OUTLINE_STYLE\n    );\n  }\n\n  return outline;\n};\n\n/**\n * Updates the outline for a given element.\n * Returns true if the update for the given element was handled by this provider.\n *\n * @param {Element} element\n * @param {Outline} outline\n * @returns {boolean}\n */\nOutlineProvider.prototype.updateOutline = function(element, outline) {\n\n  if (isLabel(element)) {\n    return;\n  }\n\n  if (isAny(element, [ 'bpmn:SubProcess', 'bpmn:Group' ])) {\n\n    svgAttr(outline, {\n      width: element.width + DEFAULT_OFFSET * 2,\n      height: element.height + DEFAULT_OFFSET * 2\n    });\n\n    return true;\n\n  } else if (isAny(element, [\n    'bpmn:Event',\n    'bpmn:Gateway',\n    'bpmn:DataStoreReference',\n    'bpmn:DataObjectReference'\n  ])) {\n    return true;\n  }\n\n  return false;\n};\n\n\n// helpers //////////\n\nfunction isStandardSize(element, type) {\n  var standardSize;\n\n  if (type === 'bpmn:DataObjectReference') {\n    standardSize = DATA_OBJECT_REFERENCE_STANDARD_SIZE;\n  } else if (type === 'bpmn:DataStoreReference') {\n    standardSize = DATA_STORE_REFERENCE_STANDARD_SIZE;\n  }\n\n  return element.width === standardSize.width\n          && element.height === standardSize.height;\n}","import Ouline from 'diagram-js/lib/features/outline';\nimport OulineProvider from './OutlineProvider';\n\nexport default {\n  __depends__: [\n    Ouline\n  ],\n  __init__: [ 'outlineProvider' ],\n  outlineProvider: [ 'type', OulineProvider ]\n};\n","/**\r\n * @typedef {import('../util/Types').Point} Point\r\n */\r\n\r\nfunction __stopPropagation(event) {\r\n  if (!event || typeof event.stopPropagation !== 'function') {\r\n    return;\r\n  }\r\n\r\n  event.stopPropagation();\r\n}\r\n\r\n/**\r\n * @param {import('../core/EventBus').Event} event\r\n *\r\n * @return {Event}\r\n */\r\nexport function getOriginal(event) {\r\n  return event.originalEvent || event.srcEvent;\r\n}\r\n\r\n/**\r\n * @param {Event|import('../core/EventBus').Event} event\r\n */\r\nexport function stopPropagation(event) {\r\n  __stopPropagation(event);\r\n  __stopPropagation(getOriginal(event));\r\n}\r\n\r\n/**\r\n * @param {Event} event\r\n *\r\n * @return {Point|null}\r\n */\r\nexport function toPoint(event) {\r\n\r\n  if (event.pointers && event.pointers.length) {\r\n    event = event.pointers[0];\r\n  }\r\n\r\n  if (event.touches && event.touches.length) {\r\n    event = event.touches[0];\r\n  }\r\n\r\n  return event ? {\r\n    x: event.clientX,\r\n    y: event.clientY\r\n  } : null;\r\n}","export function isMac() {\r\n  return (/mac/i).test(navigator.platform);\r\n}","import {\r\n  getOriginal as getOriginalEvent\r\n} from './Event';\r\n\r\nimport {\r\n  isMac\r\n} from './Platform';\r\n\r\nexport {\r\n  isMac\r\n} from './Platform';\r\n\r\n/**\r\n * @param {MouseEvent} event\r\n * @param {string} button\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isButton(event, button) {\r\n  return (getOriginalEvent(event) || event).button === button;\r\n}\r\n\r\n/**\r\n * @param {MouseEvent} event\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isPrimaryButton(event) {\r\n\r\n  // button === 0 -> left áka primary mouse button\r\n  return isButton(event, 0);\r\n}\r\n\r\n/**\r\n * @param {MouseEvent} event\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isAuxiliaryButton(event) {\r\n\r\n  // button === 1 -> auxiliary áka wheel button\r\n  return isButton(event, 1);\r\n}\r\n\r\n/**\r\n * @param {MouseEvent} event\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isSecondaryButton(event) {\r\n\r\n  // button === 2 -> right áka secondary button\r\n  return isButton(event, 2);\r\n}\r\n\r\n/**\r\n * @param {MouseEvent} event\r\n *\r\n * @return {boolean}\r\n */\r\nexport function hasPrimaryModifier(event) {\r\n  var originalEvent = getOriginalEvent(event) || event;\r\n\r\n  if (!isPrimaryButton(event)) {\r\n    return false;\r\n  }\r\n\r\n  // Use cmd as primary modifier key for mac OS\r\n  if (isMac()) {\r\n    return originalEvent.metaKey;\r\n  } else {\r\n    return originalEvent.ctrlKey;\r\n  }\r\n}\r\n\r\n/**\r\n * @param {MouseEvent} event\r\n *\r\n * @return {boolean}\r\n */\r\nexport function hasSecondaryModifier(event) {\r\n  var originalEvent = getOriginalEvent(event) || event;\r\n\r\n  return isPrimaryButton(event) && originalEvent.shiftKey;\r\n}\r\n","import {\r\n  forEach,\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport {\r\n  delegate as domDelegate,\r\n  query as domQuery,\r\n  queryAll as domQueryAll\r\n} from 'min-dom';\r\n\r\nimport {\r\n  isPrimaryButton,\r\n  isAuxiliaryButton\r\n} from '../../util/Mouse';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  createLine,\r\n  updateLine\r\n} from '../../util/RenderUtil';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../draw/Styles').default} Styles\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n */\r\n\r\nfunction allowAll(event) { return true; }\r\n\r\nfunction allowPrimaryAndAuxiliary(event) {\r\n  return isPrimaryButton(event) || isAuxiliaryButton(event);\r\n}\r\n\r\nvar LOW_PRIORITY = 500;\r\n\r\n\r\n/**\r\n * A plugin that provides interaction events for diagram elements.\r\n *\r\n * It emits the following events:\r\n *\r\n *   * element.click\r\n *   * element.contextmenu\r\n *   * element.dblclick\r\n *   * element.hover\r\n *   * element.mousedown\r\n *   * element.mousemove\r\n *   * element.mouseup\r\n *   * element.out\r\n *\r\n * Each event is a tuple { element, gfx, originalEvent }.\r\n *\r\n * Canceling the event via Event#preventDefault()\r\n * prevents the original DOM operation.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {Styles} styles\r\n */\r\nexport default function InteractionEvents(eventBus, elementRegistry, styles) {\r\n\r\n  var self = this;\r\n\r\n  /**\r\n   * Fire an interaction event.\r\n   *\r\n   * @param {string} type local event name, e.g. element.click.\r\n   * @param {MouseEvent|TouchEvent} event native event\r\n   * @param {Element} [element] the diagram element to emit the event on;\r\n   *                                   defaults to the event target\r\n   */\r\n  function fire(type, event, element) {\r\n\r\n    if (isIgnored(type, event)) {\r\n      return;\r\n    }\r\n\r\n    var target, gfx, returnValue;\r\n\r\n    if (!element) {\r\n      target = event.delegateTarget || event.target;\r\n\r\n      if (target) {\r\n        gfx = target;\r\n        element = elementRegistry.get(gfx);\r\n      }\r\n    } else {\r\n      gfx = elementRegistry.getGraphics(element);\r\n    }\r\n\r\n    if (!gfx || !element) {\r\n      return;\r\n    }\r\n\r\n    returnValue = eventBus.fire(type, {\r\n      element: element,\r\n      gfx: gfx,\r\n      originalEvent: event\r\n    });\r\n\r\n    if (returnValue === false) {\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n    }\r\n  }\r\n\r\n  // TODO(nikku): document this\r\n  var handlers = {};\r\n\r\n  function mouseHandler(localEventName) {\r\n    return handlers[localEventName];\r\n  }\r\n\r\n  function isIgnored(localEventName, event) {\r\n\r\n    var filter = ignoredFilters[localEventName] || isPrimaryButton;\r\n\r\n    // only react on left mouse button interactions\r\n    // except for interaction events that are enabled\r\n    // for secundary mouse button\r\n    return !filter(event);\r\n  }\r\n\r\n  var bindings = {\r\n    click: 'element.click',\r\n    contextmenu: 'element.contextmenu',\r\n    dblclick: 'element.dblclick',\r\n    mousedown: 'element.mousedown',\r\n    mousemove: 'element.mousemove',\r\n    mouseover: 'element.hover',\r\n    mouseout: 'element.out',\r\n    mouseup: 'element.mouseup',\r\n  };\r\n\r\n  var ignoredFilters = {\r\n    'element.contextmenu': allowAll,\r\n    'element.mousedown': allowPrimaryAndAuxiliary,\r\n    'element.mouseup': allowPrimaryAndAuxiliary,\r\n    'element.click': allowPrimaryAndAuxiliary,\r\n    'element.dblclick': allowPrimaryAndAuxiliary\r\n  };\r\n\r\n\r\n  // manual event trigger //////////\r\n\r\n  /**\r\n   * Trigger an interaction event (based on a native dom event)\r\n   * on the target shape or connection.\r\n   *\r\n   * @param {string} eventName the name of the triggered DOM event\r\n   * @param {MouseEvent|TouchEvent} event\r\n   * @param {Element} targetElement\r\n   */\r\n  function triggerMouseEvent(eventName, event, targetElement) {\r\n\r\n    // i.e. element.mousedown...\r\n    var localEventName = bindings[eventName];\r\n\r\n    if (!localEventName) {\r\n      throw new Error('unmapped DOM event name <' + eventName + '>');\r\n    }\r\n\r\n    return fire(localEventName, event, targetElement);\r\n  }\r\n\r\n\r\n  var ELEMENT_SELECTOR = 'svg, .djs-element';\r\n\r\n  // event handling ///////\r\n\r\n  function registerEvent(node, event, localEvent, ignoredFilter) {\r\n\r\n    var handler = handlers[localEvent] = function(event) {\r\n      fire(localEvent, event);\r\n    };\r\n\r\n    if (ignoredFilter) {\r\n      ignoredFilters[localEvent] = ignoredFilter;\r\n    }\r\n\r\n    handler.$delegate = domDelegate.bind(node, ELEMENT_SELECTOR, event, handler);\r\n  }\r\n\r\n  function unregisterEvent(node, event, localEvent) {\r\n\r\n    var handler = mouseHandler(localEvent);\r\n\r\n    if (!handler) {\r\n      return;\r\n    }\r\n\r\n    domDelegate.unbind(node, event, handler.$delegate);\r\n  }\r\n\r\n  function registerEvents(svg) {\r\n    forEach(bindings, function(val, key) {\r\n      registerEvent(svg, key, val);\r\n    });\r\n  }\r\n\r\n  function unregisterEvents(svg) {\r\n    forEach(bindings, function(val, key) {\r\n      unregisterEvent(svg, key, val);\r\n    });\r\n  }\r\n\r\n  eventBus.on('canvas.destroy', function(event) {\r\n    unregisterEvents(event.svg);\r\n  });\r\n\r\n  eventBus.on('canvas.init', function(event) {\r\n    registerEvents(event.svg);\r\n  });\r\n\r\n\r\n  // hit box updating ////////////////\r\n\r\n  eventBus.on([ 'shape.added', 'connection.added' ], function(event) {\r\n    var element = event.element,\r\n        gfx = event.gfx;\r\n\r\n    eventBus.fire('interactionEvents.createHit', { element: element, gfx: gfx });\r\n  });\r\n\r\n  // Update djs-hit on change.\r\n  // A low priortity is necessary, because djs-hit of labels has to be updated\r\n  // after the label bounds have been updated in the renderer.\r\n  eventBus.on([\r\n    'shape.changed',\r\n    'connection.changed'\r\n  ], LOW_PRIORITY, function(event) {\r\n\r\n    var element = event.element,\r\n        gfx = event.gfx;\r\n\r\n    eventBus.fire('interactionEvents.updateHit', { element: element, gfx: gfx });\r\n  });\r\n\r\n  eventBus.on('interactionEvents.createHit', LOW_PRIORITY, function(event) {\r\n    var element = event.element,\r\n        gfx = event.gfx;\r\n\r\n    self.createDefaultHit(element, gfx);\r\n  });\r\n\r\n  eventBus.on('interactionEvents.updateHit', function(event) {\r\n    var element = event.element,\r\n        gfx = event.gfx;\r\n\r\n    self.updateDefaultHit(element, gfx);\r\n  });\r\n\r\n\r\n  // hit styles ////////////\r\n\r\n  var STROKE_HIT_STYLE = createHitStyle('djs-hit djs-hit-stroke');\r\n\r\n  var CLICK_STROKE_HIT_STYLE = createHitStyle('djs-hit djs-hit-click-stroke');\r\n\r\n  var ALL_HIT_STYLE = createHitStyle('djs-hit djs-hit-all');\r\n\r\n  var NO_MOVE_HIT_STYLE = createHitStyle('djs-hit djs-hit-no-move');\r\n\r\n  var HIT_TYPES = {\r\n    'all': ALL_HIT_STYLE,\r\n    'click-stroke': CLICK_STROKE_HIT_STYLE,\r\n    'stroke': STROKE_HIT_STYLE,\r\n    'no-move': NO_MOVE_HIT_STYLE\r\n  };\r\n\r\n  function createHitStyle(classNames, attrs) {\r\n\r\n    attrs = assign({\r\n      stroke: 'white',\r\n      strokeWidth: 15\r\n    }, attrs || {});\r\n\r\n    return styles.cls(classNames, [ 'no-fill', 'no-border' ], attrs);\r\n  }\r\n\r\n\r\n  // style helpers ///////////////\r\n\r\n  function applyStyle(hit, type) {\r\n\r\n    var attrs = HIT_TYPES[type];\r\n\r\n    if (!attrs) {\r\n      throw new Error('invalid hit type <' + type + '>');\r\n    }\r\n\r\n    svgAttr(hit, attrs);\r\n\r\n    return hit;\r\n  }\r\n\r\n  function appendHit(gfx, hit) {\r\n    svgAppend(gfx, hit);\r\n  }\r\n\r\n\r\n  // API\r\n\r\n  /**\r\n   * Remove hints on the given graphics.\r\n   *\r\n   * @param {SVGElement} gfx\r\n   */\r\n  this.removeHits = function(gfx) {\r\n    var hits = domQueryAll('.djs-hit', gfx);\r\n\r\n    forEach(hits, svgRemove);\r\n  };\r\n\r\n  /**\r\n   * Create default hit for the given element.\r\n   *\r\n   * @param {Element} element\r\n   * @param {SVGElement} gfx\r\n   *\r\n   * @return {SVGElement} created hit\r\n   */\r\n  this.createDefaultHit = function(element, gfx) {\r\n    var waypoints = element.waypoints,\r\n        isFrame = element.isFrame,\r\n        boxType;\r\n\r\n    if (waypoints) {\r\n      return this.createWaypointsHit(gfx, waypoints);\r\n    } else {\r\n\r\n      boxType = isFrame ? 'stroke' : 'all';\r\n\r\n      return this.createBoxHit(gfx, boxType, {\r\n        width: element.width,\r\n        height: element.height\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Create hits for the given waypoints.\r\n   *\r\n   * @param {SVGElement} gfx\r\n   * @param {Point[]} waypoints\r\n   *\r\n   * @return {SVGElement}\r\n   */\r\n  this.createWaypointsHit = function(gfx, waypoints) {\r\n\r\n    var hit = createLine(waypoints);\r\n\r\n    applyStyle(hit, 'stroke');\r\n\r\n    appendHit(gfx, hit);\r\n\r\n    return hit;\r\n  };\r\n\r\n  /**\r\n   * Create hits for a box.\r\n   *\r\n   * @param {SVGElement} gfx\r\n   * @param {string} type\r\n   * @param {Object} attrs\r\n   *\r\n   * @return {SVGElement}\r\n   */\r\n  this.createBoxHit = function(gfx, type, attrs) {\r\n\r\n    attrs = assign({\r\n      x: 0,\r\n      y: 0\r\n    }, attrs);\r\n\r\n    var hit = svgCreate('rect');\r\n\r\n    applyStyle(hit, type);\r\n\r\n    svgAttr(hit, attrs);\r\n\r\n    appendHit(gfx, hit);\r\n\r\n    return hit;\r\n  };\r\n\r\n  /**\r\n   * Update default hit of the element.\r\n   *\r\n   * @param {Element} element\r\n   * @param {SVGElement} gfx\r\n   *\r\n   * @return {SVGElement} updated hit\r\n   */\r\n  this.updateDefaultHit = function(element, gfx) {\r\n\r\n    var hit = domQuery('.djs-hit', gfx);\r\n\r\n    if (!hit) {\r\n      return;\r\n    }\r\n\r\n    if (element.waypoints) {\r\n      updateLine(hit, element.waypoints);\r\n    } else {\r\n      svgAttr(hit, {\r\n        width: element.width,\r\n        height: element.height\r\n      });\r\n    }\r\n\r\n    return hit;\r\n  };\r\n\r\n  this.fire = fire;\r\n\r\n  this.triggerMouseEvent = triggerMouseEvent;\r\n\r\n  this.mouseHandler = mouseHandler;\r\n\r\n  this.registerEvent = registerEvent;\r\n  this.unregisterEvent = unregisterEvent;\r\n}\r\n\r\n\r\nInteractionEvents.$inject = [\r\n  'eventBus',\r\n  'elementRegistry',\r\n  'styles'\r\n];\r\n\r\n\r\n/**\r\n * An event indicating that the mouse hovered over an element\r\n *\r\n * @event element.hover\r\n *\r\n * @type {Object}\r\n * @property {Element} element\r\n * @property {SVGElement} gfx\r\n * @property {Event} originalEvent\r\n */\r\n\r\n/**\r\n * An event indicating that the mouse has left an element\r\n *\r\n * @event element.out\r\n *\r\n * @type {Object}\r\n * @property {Element} element\r\n * @property {SVGElement} gfx\r\n * @property {Event} originalEvent\r\n */\r\n\r\n/**\r\n * An event indicating that the mouse has clicked an element\r\n *\r\n * @event element.click\r\n *\r\n * @type {Object}\r\n * @property {Element} element\r\n * @property {SVGElement} gfx\r\n * @property {Event} originalEvent\r\n */\r\n\r\n/**\r\n * An event indicating that the mouse has double clicked an element\r\n *\r\n * @event element.dblclick\r\n *\r\n * @type {Object}\r\n * @property {Element} element\r\n * @property {SVGElement} gfx\r\n * @property {Event} originalEvent\r\n */\r\n\r\n/**\r\n * An event indicating that the mouse has gone down on an element.\r\n *\r\n * @event element.mousedown\r\n *\r\n * @type {Object}\r\n * @property {Element} element\r\n * @property {SVGElement} gfx\r\n * @property {Event} originalEvent\r\n */\r\n\r\n/**\r\n * An event indicating that the mouse has gone up on an element.\r\n *\r\n * @event element.mouseup\r\n *\r\n * @type {Object}\r\n * @property {Element} element\r\n * @property {SVGElement} gfx\r\n * @property {Event} originalEvent\r\n */\r\n\r\n/**\r\n * An event indicating that the context menu action is triggered\r\n * via mouse or touch controls.\r\n *\r\n * @event element.contextmenu\r\n *\r\n * @type {Object}\r\n * @property {Element} element\r\n * @property {SVGElement} gfx\r\n * @property {Event} originalEvent\r\n */","import InteractionEvents from './InteractionEvents';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'interactionEvents' ],\r\n  interactionEvents: [ 'type', InteractionEvents ]\r\n};","import {\r\n  isArray,\r\n  forEach\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * A service that offers the current selection in a diagram.\r\n * Offers the api to control the selection, too.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function Selection(eventBus, canvas) {\r\n\r\n  this._eventBus = eventBus;\r\n  this._canvas = canvas;\r\n\r\n  /**\r\n   * @type {Object[]}\r\n   */\r\n  this._selectedElements = [];\r\n\r\n  var self = this;\r\n\r\n  eventBus.on([ 'shape.remove', 'connection.remove' ], function(e) {\r\n    var element = e.element;\r\n    self.deselect(element);\r\n  });\r\n\r\n  eventBus.on([ 'diagram.clear', 'root.set' ], function(e) {\r\n    self.select(null);\r\n  });\r\n}\r\n\r\nSelection.$inject = [ 'eventBus', 'canvas' ];\r\n\r\n/**\r\n * Deselect an element.\r\n *\r\n * @param {Object} element The element to deselect.\r\n */\r\nSelection.prototype.deselect = function(element) {\r\n  var selectedElements = this._selectedElements;\r\n\r\n  var idx = selectedElements.indexOf(element);\r\n\r\n  if (idx !== -1) {\r\n    var oldSelection = selectedElements.slice();\r\n\r\n    selectedElements.splice(idx, 1);\r\n\r\n    this._eventBus.fire('selection.changed', { oldSelection: oldSelection, newSelection: selectedElements });\r\n  }\r\n};\r\n\r\n/**\r\n * Get the selected elements.\r\n *\r\n * @return {Object[]} The selected elements.\r\n */\r\nSelection.prototype.get = function() {\r\n  return this._selectedElements;\r\n};\r\n\r\n/**\r\n * Check whether an element is selected.\r\n *\r\n * @param {Object} element The element.\r\n *\r\n * @return {boolean} Whether the element is selected.\r\n */\r\nSelection.prototype.isSelected = function(element) {\r\n  return this._selectedElements.indexOf(element) !== -1;\r\n};\r\n\r\n\r\n/**\r\n * Select one or many elements.\r\n *\r\n * @param {Object|Object[]} elements The element(s) to select.\r\n * @param {boolean} [add] Whether to add the element(s) to the selected elements.\r\n * Defaults to `false`.\r\n */\r\nSelection.prototype.select = function(elements, add) {\r\n  var selectedElements = this._selectedElements,\r\n      oldSelection = selectedElements.slice();\r\n\r\n  if (!isArray(elements)) {\r\n    elements = elements ? [ elements ] : [];\r\n  }\r\n\r\n  var canvas = this._canvas;\r\n\r\n  var rootElement = canvas.getRootElement();\r\n\r\n  elements = elements.filter(function(element) {\r\n    var elementRoot = canvas.findRoot(element);\r\n\r\n    return rootElement === elementRoot;\r\n  });\r\n\r\n  // selection may be cleared by passing an empty array or null\r\n  // to the method\r\n  if (add) {\r\n    forEach(elements, function(element) {\r\n      if (selectedElements.indexOf(element) !== -1) {\r\n\r\n        // already selected\r\n        return;\r\n      } else {\r\n        selectedElements.push(element);\r\n      }\r\n    });\r\n  } else {\r\n    this._selectedElements = selectedElements = elements.slice();\r\n  }\r\n\r\n  this._eventBus.fire('selection.changed', { oldSelection: oldSelection, newSelection: selectedElements });\r\n};\r\n","import {\r\n  assign,\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  clear as svgClear,\r\n  create as svgCreate\r\n} from 'tiny-svg';\r\n\r\nimport { getBBox } from '../../util/Elements';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('./Selection').default} Selection\r\n */\r\n\r\nvar MARKER_HOVER = 'hover',\r\n    MARKER_SELECTED = 'selected';\r\n\r\nvar SELECTION_OUTLINE_PADDING = 6;\r\n\r\n\r\n/**\r\n * A plugin that adds a visible selection UI to shapes and connections\r\n * by appending the <code>hover</code> and <code>selected</code> classes to them.\r\n *\r\n * @class\r\n *\r\n * Makes elements selectable, too.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n * @param {Selection} selection\r\n */\r\nexport default function SelectionVisuals(canvas, eventBus, selection) {\r\n  this._canvas = canvas;\r\n\r\n  var self = this;\r\n\r\n  this._multiSelectionBox = null;\r\n\r\n  function addMarker(e, cls) {\r\n    canvas.addMarker(e, cls);\r\n  }\r\n\r\n  function removeMarker(e, cls) {\r\n    canvas.removeMarker(e, cls);\r\n  }\r\n\r\n  eventBus.on('element.hover', function(event) {\r\n    addMarker(event.element, MARKER_HOVER);\r\n  });\r\n\r\n  eventBus.on('element.out', function(event) {\r\n    removeMarker(event.element, MARKER_HOVER);\r\n  });\r\n\r\n  eventBus.on('selection.changed', function(event) {\r\n\r\n    function deselect(s) {\r\n      removeMarker(s, MARKER_SELECTED);\r\n    }\r\n\r\n    function select(s) {\r\n      addMarker(s, MARKER_SELECTED);\r\n    }\r\n\r\n    var oldSelection = event.oldSelection,\r\n        newSelection = event.newSelection;\r\n\r\n    forEach(oldSelection, function(e) {\r\n      if (newSelection.indexOf(e) === -1) {\r\n        deselect(e);\r\n      }\r\n    });\r\n\r\n    forEach(newSelection, function(e) {\r\n      if (oldSelection.indexOf(e) === -1) {\r\n        select(e);\r\n      }\r\n    });\r\n\r\n    self._updateSelectionOutline(newSelection);\r\n  });\r\n\r\n\r\n  eventBus.on('element.changed', function(event) {\r\n    if (selection.isSelected(event.element)) {\r\n      self._updateSelectionOutline(selection.get());\r\n    }\r\n  });\r\n}\r\n\r\nSelectionVisuals.$inject = [\r\n  'canvas',\r\n  'eventBus',\r\n  'selection'\r\n];\r\n\r\nSelectionVisuals.prototype._updateSelectionOutline = function(selection) {\r\n  var layer = this._canvas.getLayer('selectionOutline');\r\n\r\n  svgClear(layer);\r\n\r\n  var enabled = selection.length > 1;\r\n\r\n  var container = this._canvas.getContainer();\r\n\r\n  svgClasses(container)[enabled ? 'add' : 'remove']('djs-multi-select');\r\n\r\n  if (!enabled) {\r\n    return;\r\n  }\r\n\r\n  var bBox = addSelectionOutlinePadding(getBBox(selection));\r\n\r\n  var rect = svgCreate('rect');\r\n\r\n  svgAttr(rect, assign({\r\n    rx: 3\r\n  }, bBox));\r\n\r\n  svgClasses(rect).add('djs-selection-outline');\r\n\r\n  svgAppend(layer, rect);\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction addSelectionOutlinePadding(bBox) {\r\n  return {\r\n    x: bBox.x - SELECTION_OUTLINE_PADDING,\r\n    y: bBox.y - SELECTION_OUTLINE_PADDING,\r\n    width: bBox.width + SELECTION_OUTLINE_PADDING * 2,\r\n    height: bBox.height + SELECTION_OUTLINE_PADDING * 2\r\n  };\r\n}","import {\r\n  hasSecondaryModifier,\r\n  isPrimaryButton\r\n} from '../../util/Mouse';\r\n\r\nimport {\r\n  find,\r\n  isArray\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('./Selection').default} Selection\r\n */\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n * @param {Selection} selection\r\n * @param {Canvas} canvas\r\n * @param {ElementRegistry} elementRegistry\r\n */\r\nexport default function SelectionBehavior(eventBus, selection, canvas, elementRegistry) {\r\n\r\n  // Select elements on create\r\n  eventBus.on('create.end', 500, function(event) {\r\n    var context = event.context,\r\n        canExecute = context.canExecute,\r\n        elements = context.elements,\r\n        hints = context.hints || {},\r\n        autoSelect = hints.autoSelect;\r\n\r\n    if (canExecute) {\r\n      if (autoSelect === false) {\r\n\r\n        // Select no elements\r\n        return;\r\n      }\r\n\r\n      if (isArray(autoSelect)) {\r\n        selection.select(autoSelect);\r\n      } else {\r\n\r\n        // Select all elements by default\r\n        selection.select(elements.filter(isShown));\r\n      }\r\n    }\r\n  });\r\n\r\n  // Select connection targets on connect\r\n  eventBus.on('connect.end', 500, function(event) {\r\n    var context = event.context,\r\n        connection = context.connection;\r\n\r\n    if (connection) {\r\n      selection.select(connection);\r\n    }\r\n  });\r\n\r\n  // Select shapes on move\r\n  eventBus.on('shape.move.end', 500, function(event) {\r\n    var previousSelection = event.previousSelection || [];\r\n\r\n    var shape = elementRegistry.get(event.context.shape.id);\r\n\r\n    // Always select main shape on move\r\n    var isSelected = find(previousSelection, function(selectedShape) {\r\n      return shape.id === selectedShape.id;\r\n    });\r\n\r\n    if (!isSelected) {\r\n      selection.select(shape);\r\n    }\r\n  });\r\n\r\n  // Select elements on click\r\n  eventBus.on('element.click', function(event) {\r\n\r\n    if (!isPrimaryButton(event)) {\r\n      return;\r\n    }\r\n\r\n    var element = event.element;\r\n\r\n    if (element === canvas.getRootElement()) {\r\n      element = null;\r\n    }\r\n\r\n    var isSelected = selection.isSelected(element),\r\n        isMultiSelect = selection.get().length > 1;\r\n\r\n    // Add to selection if SHIFT pressed\r\n    var add = hasSecondaryModifier(event);\r\n\r\n    if (isSelected && isMultiSelect) {\r\n      if (add) {\r\n\r\n        // Deselect element\r\n        return selection.deselect(element);\r\n      } else {\r\n\r\n        // Select element only\r\n        return selection.select(element);\r\n      }\r\n    } else if (!isSelected) {\r\n\r\n      // Select element\r\n      selection.select(element, add);\r\n    } else {\r\n\r\n      // Deselect element\r\n      selection.deselect(element);\r\n    }\r\n  });\r\n}\r\n\r\nSelectionBehavior.$inject = [\r\n  'eventBus',\r\n  'selection',\r\n  'canvas',\r\n  'elementRegistry'\r\n];\r\n\r\n\r\nfunction isShown(element) {\r\n  return !element.hidden;\r\n}\r\n","import InteractionEventsModule from '../interaction-events';\r\nimport OutlineModule from '../outline';\r\n\r\nimport Selection from './Selection';\r\nimport SelectionVisuals from './SelectionVisuals';\r\nimport SelectionBehavior from './SelectionBehavior';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'selectionVisuals', 'selectionBehavior' ],\r\n  __depends__: [\r\n    InteractionEventsModule,\r\n    OutlineModule\r\n  ],\r\n  selection: [ 'type', Selection ],\r\n  selectionVisuals: [ 'type', SelectionVisuals ],\r\n  selectionBehavior: [ 'type', SelectionBehavior ]\r\n};\r\n","import inherits from 'inherits-browser';\n\nimport CoreModule from './core';\nimport DrilldownModdule from './features/drilldown';\nimport OutlineModule from './features/outline';\nimport OverlaysModule from 'diagram-js/lib/features/overlays';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\n\nimport BaseViewer from './BaseViewer';\n\n\n/**\n * @typedef { import('./BaseViewer').BaseViewerOptions } BaseViewerOptions\n */\n\n/**\n * A viewer for BPMN 2.0 diagrams.\n *\n * Have a look at {@link bpmn-js/lib/NavigatedViewer} or {@link bpmn-js/lib/Modeler} for bundles that include\n * additional features.\n *\n *\n * ## Extending the Viewer\n *\n * In order to extend the viewer pass extension modules to bootstrap via the\n * `additionalModules` option. An extension module is an object that exposes\n * named services.\n *\n * The following example depicts the integration of a simple\n * logging component that integrates with interaction events:\n *\n *\n * ```javascript\n *\n * // logging component\n * function InteractionLogger(eventBus) {\n *   eventBus.on('element.hover', function(event) {\n *     console.log()\n *   })\n * }\n *\n * InteractionLogger.$inject = [ 'eventBus' ]; // minification save\n *\n * // extension module\n * var extensionModule = {\n *   __init__: [ 'interactionLogger' ],\n *   interactionLogger: [ 'type', InteractionLogger ]\n * };\n *\n * // extend the viewer\n * var bpmnViewer = new Viewer({ additionalModules: [ extensionModule ] });\n * bpmnViewer.importXML(...);\n * ```\n *\n * @template [ServiceMap=null]\n *\n * @extends BaseViewer<ServiceMap>\n *\n * @param {BaseViewerOptions} [options] The options to configure the viewer.\n */\nexport default function Viewer(options) {\n  BaseViewer.call(this, options);\n}\n\ninherits(Viewer, BaseViewer);\n\n// modules the viewer is composed of\nViewer.prototype._modules = [\n  CoreModule,\n  DrilldownModdule,\n  OutlineModule,\n  OverlaysModule,\n  SelectionModule,\n  TranslateModule\n];\n\n// default moddle extensions the viewer is composed of\nViewer.prototype._moddleExtensions = {};","import { isArray } from 'min-dash';\r\n\r\nexport var KEYS_COPY = [ 'c', 'C' ];\r\nexport var KEYS_PASTE = [ 'v', 'V' ];\r\nexport var KEYS_REDO = [ 'y', 'Y' ];\r\nexport var KEYS_UNDO = [ 'z', 'Z' ];\r\n\r\n/**\r\n * Returns true if event was triggered with any modifier\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function hasModifier(event) {\r\n  return (event.ctrlKey || event.metaKey || event.shiftKey || event.altKey);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n * @return {boolean}\r\n */\r\nexport function isCmd(event) {\r\n\r\n  // ensure we don't react to AltGr\r\n  // (mapped to CTRL + ALT)\r\n  if (event.altKey) {\r\n    return false;\r\n  }\r\n\r\n  return event.ctrlKey || event.metaKey;\r\n}\r\n\r\n/**\r\n * Checks if key pressed is one of provided keys.\r\n *\r\n * @param {string|string[]} keys\r\n * @param {KeyboardEvent} event\r\n * @return {boolean}\r\n */\r\nexport function isKey(keys, event) {\r\n  keys = isArray(keys) ? keys : [ keys ];\r\n\r\n  return keys.indexOf(event.key) !== -1 || keys.indexOf(event.code) !== -1;\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isShift(event) {\r\n  return event.shiftKey;\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isCopy(event) {\r\n  return isCmd(event) && isKey(KEYS_COPY, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isPaste(event) {\r\n  return isCmd(event) && isKey(KEYS_PASTE, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isUndo(event) {\r\n  return isCmd(event) && !isShift(event) && isKey(KEYS_UNDO, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isRedo(event) {\r\n  return isCmd(event) && (\r\n    isKey(KEYS_REDO, event) || (\r\n      isKey(KEYS_UNDO, event) && isShift(event)\r\n    )\r\n  );\r\n}\r\n","import {\r\n  isFunction\r\n} from 'min-dash';\r\n\r\nimport {\r\n  closest as domClosest,\r\n  event as domEvent,\r\n  matches as domMatches\r\n} from 'min-dom';\r\n\r\nimport {\r\n  hasModifier,\r\n  isCmd,\r\n  isKey,\r\n  isShift\r\n} from './KeyboardUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {({ keyEvent: KeyboardEvent }) => any} Listener\r\n */\r\n\r\nvar KEYDOWN_EVENT = 'keyboard.keydown',\r\n    KEYUP_EVENT = 'keyboard.keyup';\r\n\r\nvar HANDLE_MODIFIER_ATTRIBUTE = 'input-handle-modified-keys';\r\n\r\nvar DEFAULT_PRIORITY = 1000;\r\n\r\n/**\r\n * A keyboard abstraction that may be activated and\r\n * deactivated by users at will, consuming global key events\r\n * and triggering diagram actions.\r\n *\r\n * For keys pressed down, keyboard fires `keyboard.keydown` event.\r\n * The event context contains one field which is `KeyboardEvent` event.\r\n *\r\n * The implementation fires the following key events that allow\r\n * other components to hook into key handling:\r\n *\r\n *  - keyboard.bind\r\n *  - keyboard.unbind\r\n *  - keyboard.init\r\n *  - keyboard.destroy\r\n *\r\n * All events contain one field which is node.\r\n *\r\n * A default binding for the keyboard may be specified via the\r\n * `keyboard.bindTo` configuration option.\r\n *\r\n * @param {Object} config\r\n * @param {EventTarget} [config.bindTo]\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function Keyboard(config, eventBus) {\r\n  var self = this;\r\n\r\n  this._config = config || {};\r\n  this._eventBus = eventBus;\r\n\r\n  this._keydownHandler = this._keydownHandler.bind(this);\r\n  this._keyupHandler = this._keyupHandler.bind(this);\r\n\r\n  // properly clean dom registrations\r\n  eventBus.on('diagram.destroy', function() {\r\n    self._fire('destroy');\r\n\r\n    self.unbind();\r\n  });\r\n\r\n  eventBus.on('diagram.init', function() {\r\n    self._fire('init');\r\n  });\r\n\r\n  eventBus.on('attach', function() {\r\n    if (config && config.bindTo) {\r\n      self.bind(config.bindTo);\r\n    }\r\n  });\r\n\r\n  eventBus.on('detach', function() {\r\n    self.unbind();\r\n  });\r\n}\r\n\r\nKeyboard.$inject = [\r\n  'config.keyboard',\r\n  'eventBus'\r\n];\r\n\r\nKeyboard.prototype._keydownHandler = function(event) {\r\n  this._keyHandler(event, KEYDOWN_EVENT);\r\n};\r\n\r\nKeyboard.prototype._keyupHandler = function(event) {\r\n  this._keyHandler(event, KEYUP_EVENT);\r\n};\r\n\r\nKeyboard.prototype._keyHandler = function(event, type) {\r\n  var eventBusResult;\r\n\r\n  if (this._isEventIgnored(event)) {\r\n    return;\r\n  }\r\n\r\n  var context = {\r\n    keyEvent: event\r\n  };\r\n\r\n  eventBusResult = this._eventBus.fire(type || KEYDOWN_EVENT, context);\r\n\r\n  if (eventBusResult) {\r\n    event.preventDefault();\r\n  }\r\n};\r\n\r\nKeyboard.prototype._isEventIgnored = function(event) {\r\n  if (event.defaultPrevented) {\r\n    return true;\r\n  }\r\n\r\n  return (\r\n    isInput(event.target) || (\r\n      isButton(event.target) && isKey([ ' ', 'Enter' ], event)\r\n    )\r\n  ) && this._isModifiedKeyIgnored(event);\r\n};\r\n\r\nKeyboard.prototype._isModifiedKeyIgnored = function(event) {\r\n  if (!isCmd(event)) {\r\n    return true;\r\n  }\r\n\r\n  var allowedModifiers = this._getAllowedModifiers(event.target);\r\n  return allowedModifiers.indexOf(event.key) === -1;\r\n};\r\n\r\nKeyboard.prototype._getAllowedModifiers = function(element) {\r\n  var modifierContainer = domClosest(element, '[' + HANDLE_MODIFIER_ATTRIBUTE + ']', true);\r\n\r\n  if (!modifierContainer || (this._node && !this._node.contains(modifierContainer))) {\r\n    return [];\r\n  }\r\n\r\n  return modifierContainer.getAttribute(HANDLE_MODIFIER_ATTRIBUTE).split(',');\r\n};\r\n\r\n/**\r\n * Bind keyboard events to the given DOM node.\r\n *\r\n * @param {EventTarget} node\r\n */\r\nKeyboard.prototype.bind = function(node) {\r\n\r\n  // make sure that the keyboard is only bound once to the DOM\r\n  this.unbind();\r\n\r\n  this._node = node;\r\n\r\n  // bind key events\r\n  domEvent.bind(node, 'keydown', this._keydownHandler);\r\n  domEvent.bind(node, 'keyup', this._keyupHandler);\r\n\r\n  this._fire('bind');\r\n};\r\n\r\n/**\r\n * @return {EventTarget}\r\n */\r\nKeyboard.prototype.getBinding = function() {\r\n  return this._node;\r\n};\r\n\r\nKeyboard.prototype.unbind = function() {\r\n  var node = this._node;\r\n\r\n  if (node) {\r\n    this._fire('unbind');\r\n\r\n    // unbind key events\r\n    domEvent.unbind(node, 'keydown', this._keydownHandler);\r\n    domEvent.unbind(node, 'keyup', this._keyupHandler);\r\n  }\r\n\r\n  this._node = null;\r\n};\r\n\r\n/**\r\n * @param {string} event\r\n */\r\nKeyboard.prototype._fire = function(event) {\r\n  this._eventBus.fire('keyboard.' + event, { node: this._node });\r\n};\r\n\r\n/**\r\n * Add a listener function that is notified with `KeyboardEvent` whenever\r\n * the keyboard is bound and the user presses a key. If no priority is\r\n * provided, the default value of 1000 is used.\r\n *\r\n * @param {number} [priority]\r\n * @param {Listener} listener\r\n * @param {string} [type='keyboard.keydown']\r\n */\r\nKeyboard.prototype.addListener = function(priority, listener, type) {\r\n  if (isFunction(priority)) {\r\n    type = listener;\r\n    listener = priority;\r\n    priority = DEFAULT_PRIORITY;\r\n  }\r\n\r\n  this._eventBus.on(type || KEYDOWN_EVENT, priority, listener);\r\n};\r\n\r\n/**\r\n * Remove a listener function.\r\n *\r\n * @param {Listener} listener\r\n * @param {string} [type='keyboard.keydown']\r\n */\r\nKeyboard.prototype.removeListener = function(listener, type) {\r\n  this._eventBus.off(type || KEYDOWN_EVENT, listener);\r\n};\r\n\r\nKeyboard.prototype.hasModifier = hasModifier;\r\nKeyboard.prototype.isCmd = isCmd;\r\nKeyboard.prototype.isShift = isShift;\r\nKeyboard.prototype.isKey = isKey;\r\n\r\n\r\n\r\n// helpers ///////\r\n\r\nfunction isInput(target) {\r\n  return target && (domMatches(target, 'input, textarea') || target.contentEditable === 'true');\r\n}\r\n\r\nfunction isButton(target) {\r\n  return target && domMatches(target, 'button, input[type=submit], input[type=button], a[href], [aria-role=button]');\r\n}","import {\r\n  isCmd,\r\n  isKey,\r\n  isCopy,\r\n  isPaste,\r\n  isUndo,\r\n  isRedo,\r\n  KEYS_COPY,\r\n  KEYS_PASTE,\r\n  KEYS_UNDO,\r\n  KEYS_REDO\r\n} from './KeyboardUtil';\r\n\r\n/**\r\n * @typedef {import('../editor-actions/EditorActions').default} EditorActions\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('./Keyboard').default} Keyboard\r\n */\r\n\r\nexport {\r\n  KEYS_COPY,\r\n  KEYS_PASTE,\r\n  KEYS_UNDO,\r\n  KEYS_REDO\r\n};\r\n\r\n\r\nvar LOW_PRIORITY = 500;\r\n\r\n\r\n/**\r\n * Adds default keyboard bindings.\r\n *\r\n * This does not pull in any features will bind only actions that\r\n * have previously been registered against the editorActions component.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Keyboard} keyboard\r\n */\r\nexport default function KeyboardBindings(eventBus, keyboard) {\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('editorActions.init', LOW_PRIORITY, function(event) {\r\n\r\n    var editorActions = event.editorActions;\r\n\r\n    self.registerBindings(keyboard, editorActions);\r\n  });\r\n}\r\n\r\nKeyboardBindings.$inject = [\r\n  'eventBus',\r\n  'keyboard'\r\n];\r\n\r\n\r\n/**\r\n * Register available keyboard bindings.\r\n *\r\n * @param {Keyboard} keyboard\r\n * @param {EditorActions} editorActions\r\n */\r\nKeyboardBindings.prototype.registerBindings = function(keyboard, editorActions) {\r\n\r\n  /**\r\n   * Add keyboard binding if respective editor action\r\n   * is registered.\r\n   *\r\n   * @param {string} action name\r\n   * @param {Function} fn that implements the key binding\r\n   */\r\n  function addListener(action, fn) {\r\n\r\n    if (editorActions.isRegistered(action)) {\r\n      keyboard.addListener(fn);\r\n    }\r\n  }\r\n\r\n\r\n  // undo\r\n  // (CTRL|CMD) + Z\r\n  addListener('undo', function(context) {\r\n\r\n    var event = context.keyEvent;\r\n\r\n    if (isUndo(event)) {\r\n      editorActions.trigger('undo');\r\n\r\n      return true;\r\n    }\r\n  });\r\n\r\n  // redo\r\n  // CTRL + Y\r\n  // CMD + SHIFT + Z\r\n  addListener('redo', function(context) {\r\n\r\n    var event = context.keyEvent;\r\n\r\n    if (isRedo(event)) {\r\n      editorActions.trigger('redo');\r\n\r\n      return true;\r\n    }\r\n  });\r\n\r\n  // copy\r\n  // CTRL/CMD + C\r\n  addListener('copy', function(context) {\r\n\r\n    var event = context.keyEvent;\r\n\r\n    if (isCopy(event)) {\r\n      editorActions.trigger('copy');\r\n\r\n      return true;\r\n    }\r\n  });\r\n\r\n  // paste\r\n  // CTRL/CMD + V\r\n  addListener('paste', function(context) {\r\n\r\n    var event = context.keyEvent;\r\n\r\n    if (isPaste(event)) {\r\n      editorActions.trigger('paste');\r\n\r\n      return true;\r\n    }\r\n  });\r\n\r\n  // zoom in one step\r\n  // CTRL/CMD + +\r\n  addListener('stepZoom', function(context) {\r\n\r\n    var event = context.keyEvent;\r\n\r\n    // quirk: it has to be triggered by `=` as well to work on international keyboard layout\r\n    // cf: https://github.com/bpmn-io/bpmn-js/issues/1362#issuecomment-722989754\r\n    if (isKey([ '+', 'Add', '=' ], event) && isCmd(event)) {\r\n      editorActions.trigger('stepZoom', { value: 1 });\r\n\r\n      return true;\r\n    }\r\n  });\r\n\r\n  // zoom out one step\r\n  // CTRL + -\r\n  addListener('stepZoom', function(context) {\r\n\r\n    var event = context.keyEvent;\r\n\r\n    if (isKey([ '-', 'Subtract' ], event) && isCmd(event)) {\r\n      editorActions.trigger('stepZoom', { value: -1 });\r\n\r\n      return true;\r\n    }\r\n  });\r\n\r\n  // zoom to the default level\r\n  // CTRL + 0\r\n  addListener('zoom', function(context) {\r\n\r\n    var event = context.keyEvent;\r\n\r\n    if (isKey('0', event) && isCmd(event)) {\r\n      editorActions.trigger('zoom', { value: 1 });\r\n\r\n      return true;\r\n    }\r\n  });\r\n\r\n  // delete selected element\r\n  // DEL\r\n  addListener('removeSelection', function(context) {\r\n\r\n    var event = context.keyEvent;\r\n\r\n    if (isKey([ 'Backspace', 'Delete', 'Del' ], event)) {\r\n      editorActions.trigger('removeSelection');\r\n\r\n      return true;\r\n    }\r\n  });\r\n};","import Keyboard from './Keyboard';\r\nimport KeyboardBindings from './KeyboardBindings';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'keyboard', 'keyboardBindings' ],\r\n  keyboard: [ 'type', Keyboard ],\r\n  keyboardBindings: [ 'type', KeyboardBindings ]\r\n};\r\n","import { assign } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../features/keyboard/Keyboard').default} Keyboard\r\n */\r\n\r\nvar DEFAULT_CONFIG = {\r\n  moveSpeed: 50,\r\n  moveSpeedAccelerated: 200\r\n};\r\n\r\n\r\n/**\r\n * A feature that allows users to move the canvas using the keyboard.\r\n *\r\n * @param {Object} config\r\n * @param {number} [config.moveSpeed=50]\r\n * @param {number} [config.moveSpeedAccelerated=200]\r\n * @param {Keyboard} keyboard\r\n * @param {Canvas} canvas\r\n */\r\nexport default function KeyboardMove(\r\n    config,\r\n    keyboard,\r\n    canvas\r\n) {\r\n\r\n  var self = this;\r\n\r\n  this._config = assign({}, DEFAULT_CONFIG, config || {});\r\n\r\n  keyboard.addListener(arrowsListener);\r\n\r\n\r\n  function arrowsListener(context) {\r\n\r\n    var event = context.keyEvent,\r\n        config = self._config;\r\n\r\n    if (!keyboard.isCmd(event)) {\r\n      return;\r\n    }\r\n\r\n    if (keyboard.isKey([\r\n      'ArrowLeft', 'Left',\r\n      'ArrowUp', 'Up',\r\n      'ArrowDown', 'Down',\r\n      'ArrowRight', 'Right'\r\n    ], event)) {\r\n\r\n      var speed = (\r\n        keyboard.isShift(event) ?\r\n          config.moveSpeedAccelerated :\r\n          config.moveSpeed\r\n      );\r\n\r\n      var direction;\r\n\r\n      switch (event.key) {\r\n      case 'ArrowLeft':\r\n      case 'Left':\r\n        direction = 'left';\r\n        break;\r\n      case 'ArrowUp':\r\n      case 'Up':\r\n        direction = 'up';\r\n        break;\r\n      case 'ArrowRight':\r\n      case 'Right':\r\n        direction = 'right';\r\n        break;\r\n      case 'ArrowDown':\r\n      case 'Down':\r\n        direction = 'down';\r\n        break;\r\n      }\r\n\r\n      self.moveCanvas({\r\n        speed: speed,\r\n        direction: direction\r\n      });\r\n\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {{\r\n   *   direction: 'up' | 'down' | 'left' | 'right';\r\n   *   speed: number;\r\n   * }} options\r\n   */\r\n  this.moveCanvas = function(options) {\r\n\r\n    var dx = 0,\r\n        dy = 0,\r\n        speed = options.speed;\r\n\r\n    var actualSpeed = speed / Math.min(Math.sqrt(canvas.viewbox().scale), 1);\r\n\r\n    switch (options.direction) {\r\n    case 'left': // Left\r\n      dx = actualSpeed;\r\n      break;\r\n    case 'up': // Up\r\n      dy = actualSpeed;\r\n      break;\r\n    case 'right': // Right\r\n      dx = -actualSpeed;\r\n      break;\r\n    case 'down': // Down\r\n      dy = -actualSpeed;\r\n      break;\r\n    }\r\n\r\n    canvas.scroll({\r\n      dx: dx,\r\n      dy: dy\r\n    });\r\n  };\r\n\r\n}\r\n\r\n\r\nKeyboardMove.$inject = [\r\n  'config.keyboardMove',\r\n  'keyboard',\r\n  'canvas'\r\n];\r\n","import KeyboardModule from '../../features/keyboard';\r\n\r\nimport KeyboardMove from './KeyboardMove';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    KeyboardModule\r\n  ],\r\n  __init__: [ 'keyboardMove' ],\r\n  keyboardMove: [ 'type', KeyboardMove ]\r\n};","import {\r\n  classes as domClasses\r\n} from 'min-dom';\r\n\r\nvar CURSOR_CLS_PATTERN = /^djs-cursor-.*$/;\r\n\r\n/**\r\n * @param {string} mode\r\n */\r\nexport function set(mode) {\r\n  var classes = domClasses(document.body);\r\n\r\n  classes.removeMatching(CURSOR_CLS_PATTERN);\r\n\r\n  if (mode) {\r\n    classes.add('djs-cursor-' + mode);\r\n  }\r\n}\r\n\r\nexport function unset() {\r\n  set(null);\r\n}\r\n\r\n/**\r\n * @param {string} mode\r\n *\r\n * @return {boolean}\r\n */\r\nexport function has(mode) {\r\n  var classes = domClasses(document.body);\r\n\r\n  return classes.has('djs-cursor-' + mode);\r\n}\r\n","/**\r\n * @typedef {import('../core/EventBus').default} EventBus\r\n */\r\n\r\nvar TRAP_PRIORITY = 5000;\r\n\r\n/**\r\n * Installs a click trap that prevents a ghost click following a dragging operation.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {string} [eventName='element.click']\r\n *\r\n * @return {() => void} a function to immediately remove the installed trap.\r\n */\r\nexport function install(eventBus, eventName) {\r\n\r\n  eventName = eventName || 'element.click';\r\n\r\n  function trap() {\r\n    return false;\r\n  }\r\n\r\n  eventBus.once(eventName, TRAP_PRIORITY, trap);\r\n\r\n  return function() {\r\n    eventBus.off(eventName, trap);\r\n  };\r\n}","/**\r\n * @typedef {import('../util/Types').Point} Point\r\n * @typedef {import('../util/Types').Rect} Rect\r\n */\r\n\r\n/**\r\n * @param {Rect} bounds\r\n * @return {Point}\r\n */\r\nexport function center(bounds) {\r\n  return {\r\n    x: bounds.x + (bounds.width / 2),\r\n    y: bounds.y + (bounds.height / 2)\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * @param {Point} a\r\n * @param {Point} b\r\n * @return {Point}\r\n */\r\nexport function delta(a, b) {\r\n  return {\r\n    x: a.x - b.x,\r\n    y: a.y - b.y\r\n  };\r\n}\r\n","import {\r\n  set as cursorSet,\r\n  unset as cursorUnset\r\n} from '../../util/Cursor';\r\n\r\nimport {\r\n  install as installClickTrap\r\n} from '../../util/ClickTrap';\r\n\r\nimport {\r\n  delta as deltaPos\r\n} from '../../util/PositionUtil';\r\n\r\nimport {\r\n  event as domEvent,\r\n  closest as domClosest\r\n} from 'min-dom';\r\n\r\nimport {\r\n  toPoint\r\n} from '../../util/Event';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\nvar THRESHOLD = 15;\r\n\r\n\r\n/**\r\n * Move the canvas via mouse.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function MoveCanvas(eventBus, canvas) {\r\n\r\n  var context;\r\n\r\n\r\n  // listen for move on element mouse down;\r\n  // allow others to hook into the event before us though\r\n  // (dragging / element moving will do this)\r\n  eventBus.on('element.mousedown', 500, function(e) {\r\n    return handleStart(e.originalEvent);\r\n  });\r\n\r\n\r\n  function handleMove(event) {\r\n\r\n    var start = context.start,\r\n        button = context.button,\r\n        position = toPoint(event),\r\n        delta = deltaPos(position, start);\r\n\r\n    if (!context.dragging && length(delta) > THRESHOLD) {\r\n      context.dragging = true;\r\n\r\n      if (button === 0) {\r\n        installClickTrap(eventBus);\r\n      }\r\n\r\n      cursorSet('grab');\r\n    }\r\n\r\n    if (context.dragging) {\r\n\r\n      var lastPosition = context.last || context.start;\r\n\r\n      delta = deltaPos(position, lastPosition);\r\n\r\n      canvas.scroll({\r\n        dx: delta.x,\r\n        dy: delta.y\r\n      });\r\n\r\n      context.last = position;\r\n    }\r\n\r\n    // prevent select\r\n    event.preventDefault();\r\n  }\r\n\r\n\r\n  function handleEnd(event) {\r\n    domEvent.unbind(document, 'mousemove', handleMove);\r\n    domEvent.unbind(document, 'mouseup', handleEnd);\r\n\r\n    context = null;\r\n\r\n    cursorUnset();\r\n  }\r\n\r\n  function handleStart(event) {\r\n\r\n    // event is already handled by '.djs-draggable'\r\n    if (domClosest(event.target, '.djs-draggable')) {\r\n      return;\r\n    }\r\n\r\n    var button = event.button;\r\n\r\n    // reject right mouse button or modifier key\r\n    if (button >= 2 || event.ctrlKey || event.shiftKey || event.altKey) {\r\n      return;\r\n    }\r\n\r\n    context = {\r\n      button: button,\r\n      start: toPoint(event)\r\n    };\r\n\r\n    domEvent.bind(document, 'mousemove', handleMove);\r\n    domEvent.bind(document, 'mouseup', handleEnd);\r\n\r\n    // we've handled the event\r\n    return true;\r\n  }\r\n\r\n  this.isActive = function() {\r\n    return !!context;\r\n  };\r\n\r\n}\r\n\r\n\r\nMoveCanvas.$inject = [\r\n  'eventBus',\r\n  'canvas'\r\n];\r\n\r\n\r\n\r\n// helpers ///////\r\n\r\nfunction length(point) {\r\n  return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\r\n}\r\n","import MoveCanvas from './MoveCanvas';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'moveCanvas' ],\r\n  moveCanvas: [ 'type', MoveCanvas ]\r\n};","/**\r\n * Get the logarithm of x with base 10.\r\n *\r\n * @param {number} x\r\n */\r\nexport function log10(x) {\r\n  return Math.log(x) / Math.log(10);\r\n}\r\n\r\nexport { delta as substract } from './PositionUtil';\r\n","import {\r\n  log10\r\n} from '../../util/Math';\r\n\r\n/**\r\n * Get step size for given range and number of steps.\r\n *\r\n * @param {Object} range\r\n * @param {number} range.min\r\n * @param {number} range.max\r\n * @param {number} steps\r\n */\r\nexport function getStepSize(range, steps) {\r\n\r\n  var minLinearRange = log10(range.min),\r\n      maxLinearRange = log10(range.max);\r\n\r\n  var absoluteLinearRange = Math.abs(minLinearRange) + Math.abs(maxLinearRange);\r\n\r\n  return absoluteLinearRange / steps;\r\n}\r\n\r\n/**\r\n * @param {Object} range\r\n * @param {number} range.min\r\n * @param {number} range.max\r\n * @param {number} scale\r\n */\r\nexport function cap(range, scale) {\r\n  return Math.max(range.min, Math.min(range.max, scale));\r\n}\r\n","import {\r\n  event as domEvent,\r\n  closest as domClosest\r\n} from 'min-dom';\r\n\r\nimport {\r\n  getStepSize,\r\n  cap\r\n} from './ZoomUtil';\r\n\r\nimport {\r\n  log10\r\n} from '../../util/Math';\r\n\r\nimport {\r\n  isMac\r\n} from '../../util/Platform';\r\n\r\nimport {\r\n  bind\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n * @typedef {import('../../util/Types').ScrollDelta} ScrollDelta\r\n */\r\n\r\nvar sign = Math.sign || function(n) {\r\n  return n >= 0 ? 1 : -1;\r\n};\r\n\r\nvar RANGE = { min: 0.2, max: 4 },\r\n    NUM_STEPS = 10;\r\n\r\nvar DELTA_THRESHOLD = 0.1;\r\n\r\nvar DEFAULT_SCALE = 0.75;\r\n\r\n/**\r\n * An implementation of zooming and scrolling within the\r\n * {@link Canvas} via the mouse wheel.\r\n *\r\n * Mouse wheel zooming / scrolling may be disabled using\r\n * the {@link toggle(enabled)} method.\r\n *\r\n * @param {Object} [config]\r\n * @param {boolean} [config.enabled=true] default enabled state\r\n * @param {number} [config.scale=.75] scroll sensivity\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function ZoomScroll(config, eventBus, canvas) {\r\n\r\n  config = config || {};\r\n\r\n  this._enabled = false;\r\n\r\n  this._canvas = canvas;\r\n  this._container = canvas._container;\r\n\r\n  this._handleWheel = bind(this._handleWheel, this);\r\n\r\n  this._totalDelta = 0;\r\n  this._scale = config.scale || DEFAULT_SCALE;\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('canvas.init', function(e) {\r\n    self._init(config.enabled !== false);\r\n  });\r\n}\r\n\r\nZoomScroll.$inject = [\r\n  'config.zoomScroll',\r\n  'eventBus',\r\n  'canvas'\r\n];\r\n\r\n/**\r\n * @param {ScrollDelta} delta\r\n */\r\nZoomScroll.prototype.scroll = function scroll(delta) {\r\n  this._canvas.scroll(delta);\r\n};\r\n\r\n\r\nZoomScroll.prototype.reset = function reset() {\r\n  this._canvas.zoom('fit-viewport');\r\n};\r\n\r\n/**\r\n * Zoom depending on delta.\r\n *\r\n * @param {number} delta\r\n * @param {Point} position\r\n */\r\nZoomScroll.prototype.zoom = function zoom(delta, position) {\r\n\r\n  // zoom with half the step size of stepZoom\r\n  var stepSize = getStepSize(RANGE, NUM_STEPS * 2);\r\n\r\n  // add until threshold reached\r\n  this._totalDelta += delta;\r\n\r\n  if (Math.abs(this._totalDelta) > DELTA_THRESHOLD) {\r\n    this._zoom(delta, position, stepSize);\r\n\r\n    // reset\r\n    this._totalDelta = 0;\r\n  }\r\n};\r\n\r\n\r\nZoomScroll.prototype._handleWheel = function handleWheel(event) {\r\n\r\n  // event is already handled by '.djs-scrollable'\r\n  if (domClosest(event.target, '.djs-scrollable', true)) {\r\n    return;\r\n  }\r\n\r\n  var element = this._container;\r\n\r\n  event.preventDefault();\r\n\r\n  // pinch to zoom is mapped to wheel + ctrlKey = true\r\n  // in modern browsers (!)\r\n\r\n  var isZoom = event.ctrlKey || (isMac() && event.metaKey);\r\n\r\n  var isHorizontalScroll = event.shiftKey;\r\n\r\n  var factor = -1 * this._scale,\r\n      delta;\r\n\r\n  if (isZoom) {\r\n    factor *= event.deltaMode === 0 ? 0.020 : 0.32;\r\n  } else {\r\n    factor *= event.deltaMode === 0 ? 1.0 : 16.0;\r\n  }\r\n\r\n  if (isZoom) {\r\n    var elementRect = element.getBoundingClientRect();\r\n\r\n    var offset = {\r\n      x: event.clientX - elementRect.left,\r\n      y: event.clientY - elementRect.top\r\n    };\r\n\r\n    delta = (\r\n      Math.sqrt(\r\n        Math.pow(event.deltaY, 2) +\r\n        Math.pow(event.deltaX, 2)\r\n      ) * sign(event.deltaY) * factor\r\n    );\r\n\r\n    // zoom in relative to diagram {x,y} coordinates\r\n    this.zoom(delta, offset);\r\n  } else {\r\n\r\n    if (isHorizontalScroll) {\r\n      delta = {\r\n        dx: factor * event.deltaY,\r\n        dy: 0\r\n      };\r\n    } else {\r\n      delta = {\r\n        dx: factor * event.deltaX,\r\n        dy: factor * event.deltaY\r\n      };\r\n    }\r\n\r\n    this.scroll(delta);\r\n  }\r\n};\r\n\r\n/**\r\n * Zoom with fixed step size.\r\n *\r\n * @param {number} delta Zoom delta (1 for zooming in, -1 for zooming out).\r\n * @param {Point} [position]\r\n */\r\nZoomScroll.prototype.stepZoom = function stepZoom(delta, position) {\r\n\r\n  var stepSize = getStepSize(RANGE, NUM_STEPS);\r\n\r\n  this._zoom(delta, position, stepSize);\r\n};\r\n\r\n\r\n/**\r\n * Zoom in/out given a step size.\r\n *\r\n * @param {number} delta\r\n * @param {Point} [position]\r\n * @param {number} stepSize\r\n */\r\nZoomScroll.prototype._zoom = function(delta, position, stepSize) {\r\n  var canvas = this._canvas;\r\n\r\n  var direction = delta > 0 ? 1 : -1;\r\n\r\n  var currentLinearZoomLevel = log10(canvas.zoom());\r\n\r\n  // snap to a proximate zoom step\r\n  var newLinearZoomLevel = Math.round(currentLinearZoomLevel / stepSize) * stepSize;\r\n\r\n  // increase or decrease one zoom step in the given direction\r\n  newLinearZoomLevel += stepSize * direction;\r\n\r\n  // calculate the absolute logarithmic zoom level based on the linear zoom level\r\n  // (e.g. 2 for an absolute x2 zoom)\r\n  var newLogZoomLevel = Math.pow(10, newLinearZoomLevel);\r\n\r\n  canvas.zoom(cap(RANGE, newLogZoomLevel), position);\r\n};\r\n\r\n\r\n/**\r\n * Toggle the zoom scroll ability via mouse wheel.\r\n *\r\n * @param {boolean} [newEnabled] new enabled state\r\n */\r\nZoomScroll.prototype.toggle = function toggle(newEnabled) {\r\n\r\n  var element = this._container;\r\n  var handleWheel = this._handleWheel;\r\n\r\n  var oldEnabled = this._enabled;\r\n\r\n  if (typeof newEnabled === 'undefined') {\r\n    newEnabled = !oldEnabled;\r\n  }\r\n\r\n  // only react on actual changes\r\n  if (oldEnabled !== newEnabled) {\r\n\r\n    // add or remove wheel listener based on\r\n    // changed enabled state\r\n    domEvent[newEnabled ? 'bind' : 'unbind'](element, 'wheel', handleWheel, false);\r\n  }\r\n\r\n  this._enabled = newEnabled;\r\n\r\n  return newEnabled;\r\n};\r\n\r\n\r\nZoomScroll.prototype._init = function(newEnabled) {\r\n  this.toggle(newEnabled);\r\n};\r\n","import ZoomScroll from './ZoomScroll';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'zoomScroll' ],\r\n  zoomScroll: [ 'type', ZoomScroll ]\r\n};","import inherits from 'inherits-browser';\n\nimport Viewer from './Viewer';\n\nimport KeyboardMoveModule from 'diagram-js/lib/navigation/keyboard-move';\nimport MoveCanvasModule from 'diagram-js/lib/navigation/movecanvas';\nimport ZoomScrollModule from 'diagram-js/lib/navigation/zoomscroll';\n\n/**\n * @typedef { import('./BaseViewer').BaseViewerOptions } BaseViewerOptions\n */\n\n/**\n * A viewer with mouse and keyboard navigation features.\n *\n * @template [ServiceMap=null]\n *\n * @extends Viewer<ServiceMap>\n *\n * @param {BaseViewerOptions} [options]\n */\nexport default function NavigatedViewer(options) {\n  Viewer.call(this, options);\n}\n\ninherits(NavigatedViewer, Viewer);\n\n\nNavigatedViewer.prototype._navigationModules = [\n  KeyboardMoveModule,\n  MoveCanvasModule,\n  ZoomScrollModule\n];\n\nNavigatedViewer.prototype._modules = [].concat(\n  Viewer.prototype._modules,\n  NavigatedViewer.prototype._navigationModules\n);","import {\r\n  filter,\r\n  forEach,\r\n  isArray,\r\n  sortBy\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n *\r\n * @typedef {import('../../util/Types').Axis} Axis\r\n * @typedef {import('../../util/Types').Dimension} Dimension\r\n *\r\n * @typedef { 'top' | 'right' | 'bottom' | 'left' | 'center' | 'middle' } Alignment\r\n */\r\n\r\nfunction last(arr) {\r\n  return arr && arr[arr.length - 1];\r\n}\r\n\r\nfunction sortTopOrMiddle(element) {\r\n  return element.y;\r\n}\r\n\r\nfunction sortLeftOrCenter(element) {\r\n  return element.x;\r\n}\r\n\r\n/**\r\n * Sorting functions for different alignments.\r\n *\r\n * @type {Record<string, Function>}\r\n */\r\nvar ALIGNMENT_SORTING = {\r\n  left: sortLeftOrCenter,\r\n  center: sortLeftOrCenter,\r\n  right: function(element) {\r\n    return element.x + element.width;\r\n  },\r\n  top: sortTopOrMiddle,\r\n  middle: sortTopOrMiddle,\r\n  bottom: function(element) {\r\n    return element.y + element.height;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {Modeling} modeling\r\n * @param {Rules} rules\r\n */\r\nexport default function AlignElements(modeling, rules) {\r\n  this._modeling = modeling;\r\n  this._rules = rules;\r\n}\r\n\r\nAlignElements.$inject = [ 'modeling', 'rules' ];\r\n\r\n\r\n/**\r\n * Get relevant axis and dimension for given alignment.\r\n *\r\n * @param {Alignment} type\r\n *\r\n * @return { {\r\n *   axis: Axis;\r\n *   dimension: Dimension;\r\n * } }\r\n */\r\nAlignElements.prototype._getOrientationDetails = function(type) {\r\n  var vertical = [ 'top', 'bottom', 'middle' ],\r\n      axis = 'x',\r\n      dimension = 'width';\r\n\r\n  if (vertical.indexOf(type) !== -1) {\r\n    axis = 'y';\r\n    dimension = 'height';\r\n  }\r\n\r\n  return {\r\n    axis: axis,\r\n    dimension: dimension\r\n  };\r\n};\r\n\r\nAlignElements.prototype._isType = function(type, types) {\r\n  return types.indexOf(type) !== -1;\r\n};\r\n\r\n/**\r\n * Get point on relevant axis for given alignment.\r\n *\r\n * @param {Alignment} type\r\n * @param {Element[]} sortedElements\r\n *\r\n * @return {Partial<Record<Alignment, number>>}\r\n */\r\nAlignElements.prototype._alignmentPosition = function(type, sortedElements) {\r\n  var orientation = this._getOrientationDetails(type),\r\n      axis = orientation.axis,\r\n      dimension = orientation.dimension,\r\n      alignment = {},\r\n      centers = {},\r\n      hasSharedCenters = false,\r\n      centeredElements,\r\n      firstElement,\r\n      lastElement;\r\n\r\n  function getMiddleOrTop(first, last) {\r\n    return Math.round((first[axis] + last[axis] + last[dimension]) / 2);\r\n  }\r\n\r\n  if (this._isType(type, [ 'left', 'top' ])) {\r\n    alignment[type] = sortedElements[0][axis];\r\n\r\n  } else if (this._isType(type, [ 'right', 'bottom' ])) {\r\n    lastElement = last(sortedElements);\r\n\r\n    alignment[type] = lastElement[axis] + lastElement[dimension];\r\n\r\n  } else if (this._isType(type, [ 'center', 'middle' ])) {\r\n\r\n    // check if there is a center shared by more than one shape\r\n    // if not, just take the middle of the range\r\n    forEach(sortedElements, function(element) {\r\n      var center = element[axis] + Math.round(element[dimension] / 2);\r\n\r\n      if (centers[center]) {\r\n        centers[center].elements.push(element);\r\n      } else {\r\n        centers[center] = {\r\n          elements: [ element ],\r\n          center: center\r\n        };\r\n      }\r\n    });\r\n\r\n    centeredElements = sortBy(centers, function(center) {\r\n      if (center.elements.length > 1) {\r\n        hasSharedCenters = true;\r\n      }\r\n\r\n      return center.elements.length;\r\n    });\r\n\r\n    if (hasSharedCenters) {\r\n      alignment[type] = last(centeredElements).center;\r\n\r\n      return alignment;\r\n    }\r\n\r\n    firstElement = sortedElements[0];\r\n\r\n    sortedElements = sortBy(sortedElements, function(element) {\r\n      return element[axis] + element[dimension];\r\n    });\r\n\r\n    lastElement = last(sortedElements);\r\n\r\n    alignment[type] = getMiddleOrTop(firstElement, lastElement);\r\n  }\r\n\r\n  return alignment;\r\n};\r\n\r\n/**\r\n * Align elements on relevant axis for given alignment.\r\n *\r\n * @param {Element[]} elements\r\n * @param {Alignment} type\r\n */\r\nAlignElements.prototype.trigger = function(elements, type) {\r\n  var modeling = this._modeling,\r\n      allowed;\r\n\r\n  // filter out elements which cannot be aligned\r\n  var filteredElements = filter(elements, function(element) {\r\n    return !(element.waypoints || element.host || element.labelTarget);\r\n  });\r\n\r\n  // filter out elements via rules\r\n  allowed = this._rules.allowed('elements.align', { elements: filteredElements });\r\n  if (isArray(allowed)) {\r\n    filteredElements = allowed;\r\n  }\r\n\r\n  if (filteredElements.length < 2 || !allowed) {\r\n    return;\r\n  }\r\n\r\n  var sortFn = ALIGNMENT_SORTING[type];\r\n\r\n  var sortedElements = sortBy(filteredElements, sortFn);\r\n\r\n  var alignment = this._alignmentPosition(type, sortedElements);\r\n\r\n  modeling.alignElements(sortedElements, alignment);\r\n};\r\n","import AlignElements from './AlignElements';\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'alignElements' ],\r\n  alignElements: [ 'type', AlignElements ]\r\n};\r\n","import {\r\n  every,\r\n  forEach,\r\n  isArray,\r\n  isFunction\r\n} from 'min-dash';\r\n\r\nimport {\r\n  delegate as domDelegate,\r\n  event as domEvent,\r\n  attr as domAttr,\r\n  query as domQuery,\r\n  classes as domClasses,\r\n  domify as domify\r\n} from 'min-dom';\r\n\r\nimport {\r\n  escapeCSS\r\n} from '../../util/EscapeUtil';\r\n\r\nimport { isConnection } from '../../util/ModelUtil';\r\n\r\nvar MARKERS_HIDDEN = [\r\n  'djs-element-hidden',\r\n  'djs-label-hidden'\r\n];\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../../util/Types').Rect} Rect\r\n * @typedef {import('../../util/Types').RectTRBL} RectTRBL\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('./ContextPadProvider').default} ContextPadProvider\r\n * @typedef {import('./ContextPadProvider').ContextPadEntries} ContextPadEntries\r\n *\r\n */\r\n\r\n/**\r\n * @template {Element} [ElementType=Element]\r\n *\r\n * @typedef {ElementType|ElementType[]} ContextPadTarget\r\n */\r\n\r\nvar entrySelector = '.entry';\r\n\r\nvar DEFAULT_PRIORITY = 1000;\r\nvar CONTEXT_PAD_MARGIN = 8;\r\nvar HOVER_DELAY = 300;\r\n\r\n/**\r\n * A context pad that displays element specific, contextual actions next\r\n * to a diagram element.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function ContextPad(canvas, elementRegistry, eventBus) {\r\n\r\n  this._canvas = canvas;\r\n  this._elementRegistry = elementRegistry;\r\n  this._eventBus = eventBus;\r\n\r\n  this._current = null;\r\n\r\n  this._init();\r\n}\r\n\r\nContextPad.$inject = [\r\n  'canvas',\r\n  'elementRegistry',\r\n  'eventBus'\r\n];\r\n\r\n\r\n/**\r\n * Registers events needed for interaction with other components.\r\n */\r\nContextPad.prototype._init = function() {\r\n  var self = this;\r\n\r\n  this._eventBus.on('selection.changed', function(event) {\r\n\r\n    var selection = event.newSelection;\r\n\r\n    var target = selection.length\r\n      ? selection.length === 1\r\n        ? selection[0]\r\n        : selection\r\n      : null;\r\n\r\n    if (target) {\r\n      self.open(target, true);\r\n    } else {\r\n      self.close();\r\n    }\r\n  });\r\n\r\n  this._eventBus.on('elements.changed', function(event) {\r\n    var elements = event.elements,\r\n        current = self._current;\r\n\r\n    if (!current) {\r\n      return;\r\n    }\r\n\r\n    var { target } = current;\r\n\r\n    var targets = isArray(target) ? target : [ target ];\r\n\r\n    var targetsChanged = targets.filter(function(element) {\r\n      return includes(elements, element);\r\n    });\r\n\r\n    if (targetsChanged.length) {\r\n\r\n      // (1) close\r\n      self.close();\r\n\r\n      var targetsNew = targets.filter(function(element) {\r\n        return self._elementRegistry.get(element.id);\r\n      });\r\n\r\n      if (targetsNew.length) {\r\n\r\n        // (2) re-open with new targets being all previous targets that still\r\n        // exist\r\n        self._updateAndOpen(targetsNew.length > 1 ? targetsNew : targetsNew[ 0 ]);\r\n      }\r\n    }\r\n  });\r\n\r\n  this._eventBus.on('canvas.viewbox.changed', () => {\r\n    this._updatePosition();\r\n  });\r\n\r\n  this._eventBus.on('element.marker.update', function(event) {\r\n    self._updateVisibility();\r\n  });\r\n\r\n  this._container = this._createContainer();\r\n};\r\n\r\nContextPad.prototype._createContainer = function() {\r\n  const container = domify('<div class=\"djs-context-pad-parent\"></div>');\r\n\r\n  this._canvas.getContainer().appendChild(container);\r\n\r\n  return container;\r\n};\r\n\r\n/**\r\n * @overlord\r\n *\r\n * Register a context pad provider with the default priority. See\r\n * {@link ContextPadProvider} for examples.\r\n *\r\n * @param {ContextPadProvider} provider\r\n */\r\n\r\n/**\r\n * Register a context pad provider with the given priority. See\r\n * {@link ContextPadProvider} for examples.\r\n *\r\n * @param {number} priority\r\n * @param {ContextPadProvider} provider\r\n */\r\nContextPad.prototype.registerProvider = function(priority, provider) {\r\n  if (!provider) {\r\n    provider = priority;\r\n    priority = DEFAULT_PRIORITY;\r\n  }\r\n\r\n  this._eventBus.on('contextPad.getProviders', priority, function(event) {\r\n    event.providers.push(provider);\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Get context pad entries for given elements.\r\n *\r\n * @param {ContextPadTarget} target\r\n *\r\n * @return {ContextPadEntries} list of entries\r\n */\r\nContextPad.prototype.getEntries = function(target) {\r\n  var providers = this._getProviders();\r\n\r\n  var provideFn = isArray(target)\r\n    ? 'getMultiElementContextPadEntries'\r\n    : 'getContextPadEntries';\r\n\r\n  var entries = {};\r\n\r\n  // loop through all providers and their entries.\r\n  // group entries by id so that overriding an entry is possible\r\n  forEach(providers, function(provider) {\r\n\r\n    if (!isFunction(provider[provideFn])) {\r\n      return;\r\n    }\r\n\r\n    var entriesOrUpdater = provider[provideFn](target);\r\n\r\n    if (isFunction(entriesOrUpdater)) {\r\n      entries = entriesOrUpdater(entries);\r\n    } else {\r\n      forEach(entriesOrUpdater, function(entry, id) {\r\n        entries[id] = entry;\r\n      });\r\n    }\r\n  });\r\n\r\n  return entries;\r\n};\r\n\r\n\r\n/**\r\n * Trigger context pad via DOM event.\r\n *\r\n * The entry to trigger is determined by the target element.\r\n *\r\n * @param {string} action\r\n * @param {Event} event\r\n * @param {boolean} [autoActivate=false]\r\n */\r\nContextPad.prototype.trigger = function(action, event, autoActivate) {\r\n\r\n  var entry,\r\n      originalEvent,\r\n      button = event.delegateTarget || event.target;\r\n\r\n  if (!button) {\r\n    return event.preventDefault();\r\n  }\r\n\r\n  entry = domAttr(button, 'data-action');\r\n  originalEvent = event.originalEvent || event;\r\n\r\n  if (action === 'mouseover') {\r\n    this._timeout = setTimeout(() => {\r\n      this._mouseout = this.triggerEntry(entry, 'hover', originalEvent, autoActivate);\r\n    }, HOVER_DELAY);\r\n\r\n    return;\r\n  } else if (action === 'mouseout') {\r\n    clearTimeout(this._timeout);\r\n\r\n    if (this._mouseout) {\r\n      this._mouseout();\r\n\r\n      this._mouseout = null;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  return this.triggerEntry(entry, action, originalEvent, autoActivate);\r\n};\r\n\r\n/**\r\n * Trigger action on context pad entry entry, e.g. click, mouseover or mouseout.\r\n *\r\n * @param {string} entryId\r\n * @param {string} action\r\n * @param {Event} event\r\n * @param {boolean} [autoActivate=false]\r\n */\r\nContextPad.prototype.triggerEntry = function(entryId, action, event, autoActivate) {\r\n\r\n  if (!this.isShown()) {\r\n    return;\r\n  }\r\n\r\n  var target = this._current.target,\r\n      entries = this._current.entries;\r\n\r\n  var entry = entries[entryId];\r\n\r\n  if (!entry) {\r\n    return;\r\n  }\r\n\r\n  var handler = entry.action;\r\n\r\n  if (this._eventBus.fire('contextPad.trigger', { entry, event }) === false) {\r\n    return;\r\n  }\r\n\r\n  // simple action (via callback function)\r\n  if (isFunction(handler)) {\r\n    if (action === 'click') {\r\n      return handler(event, target, autoActivate);\r\n    }\r\n  } else {\r\n    if (handler[action]) {\r\n      return handler[action](event, target, autoActivate);\r\n    }\r\n  }\r\n\r\n  // silence other actions\r\n  event.preventDefault();\r\n};\r\n\r\n\r\n/**\r\n * Open the context pad for given elements.\r\n *\r\n * @param {ContextPadTarget} target\r\n * @param {boolean} [force=false] - Force re-opening context pad.\r\n */\r\nContextPad.prototype.open = function(target, force) {\r\n  if (!force && this.isOpen(target)) {\r\n    return;\r\n  }\r\n\r\n  this.close();\r\n\r\n  this._updateAndOpen(target);\r\n};\r\n\r\nContextPad.prototype._getProviders = function() {\r\n\r\n  var event = this._eventBus.createEvent({\r\n    type: 'contextPad.getProviders',\r\n    providers: []\r\n  });\r\n\r\n  this._eventBus.fire(event);\r\n\r\n  return event.providers;\r\n};\r\n\r\n\r\n/**\r\n * @param {ContextPadTarget} target\r\n */\r\nContextPad.prototype._updateAndOpen = function(target) {\r\n  var entries = this.getEntries(target),\r\n      html = this._createHtml(target),\r\n      image;\r\n\r\n  forEach(entries, function(entry, id) {\r\n    var grouping = entry.group || 'default',\r\n        control = domify(entry.html || '<div class=\"entry\" draggable=\"true\"></div>'),\r\n        container;\r\n\r\n    domAttr(control, 'data-action', id);\r\n\r\n    container = domQuery('[data-group=' + escapeCSS(grouping) + ']', html);\r\n    if (!container) {\r\n      container = domify('<div class=\"group\"></div>');\r\n      domAttr(container, 'data-group', grouping);\r\n\r\n      html.appendChild(container);\r\n    }\r\n\r\n    container.appendChild(control);\r\n\r\n    if (entry.className) {\r\n      addClasses(control, entry.className);\r\n    }\r\n\r\n    if (entry.title) {\r\n      domAttr(control, 'title', entry.title);\r\n    }\r\n\r\n    if (entry.imageUrl) {\r\n      image = domify('<img>');\r\n      domAttr(image, 'src', entry.imageUrl);\r\n      image.style.width = '100%';\r\n      image.style.height = '100%';\r\n\r\n      control.appendChild(image);\r\n    }\r\n  });\r\n\r\n  domClasses(html).add('open');\r\n\r\n  this._current = {\r\n    entries,\r\n    html,\r\n    target,\r\n  };\r\n\r\n  this._updatePosition();\r\n\r\n  this._updateVisibility();\r\n\r\n  this._eventBus.fire('contextPad.open', { current: this._current });\r\n};\r\n\r\n/**\r\n * @param {ContextPadTarget} target\r\n *\r\n * @return {HTMLElement}\r\n */\r\nContextPad.prototype._createHtml = function(target) {\r\n  var self = this;\r\n\r\n  var html = domify('<div class=\"djs-context-pad\"></div>');\r\n\r\n  domDelegate.bind(html, entrySelector, 'click', function(event) {\r\n    self.trigger('click', event);\r\n  });\r\n\r\n  domDelegate.bind(html, entrySelector, 'dragstart', function(event) {\r\n    self.trigger('dragstart', event);\r\n  });\r\n\r\n  domDelegate.bind(html, entrySelector, 'mouseover', function(event) {\r\n    self.trigger('mouseover', event);\r\n  });\r\n\r\n  domDelegate.bind(html, entrySelector, 'mouseout', function(event) {\r\n    self.trigger('mouseout', event);\r\n  });\r\n\r\n  // stop propagation of mouse events\r\n  domEvent.bind(html, 'mousedown', function(event) {\r\n    event.stopPropagation();\r\n  });\r\n\r\n  this._container.appendChild(html);\r\n\r\n  this._eventBus.fire('contextPad.create', {\r\n    target: target,\r\n    pad: html\r\n  });\r\n\r\n  return html;\r\n};\r\n\r\n/**\r\n * @param {ContextPadTarget} target\r\n *\r\n * @return { { html: HTMLElement } }\r\n */\r\nContextPad.prototype.getPad = function(target) {\r\n  console.warn(new Error('ContextPad#getPad is deprecated and will be removed in future library versions, cf. https://github.com/bpmn-io/diagram-js/pull/888'));\r\n\r\n  let html;\r\n\r\n  if (this.isOpen() && targetsEqual(this._current.target, target)) {\r\n    html = this._current.html;\r\n  } else {\r\n    html = this._createHtml(target);\r\n  }\r\n\r\n  return { html };\r\n};\r\n\r\n\r\n/**\r\n * Close the context pad\r\n */\r\nContextPad.prototype.close = function() {\r\n  if (!this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  clearTimeout(this._timeout);\r\n\r\n  this._container.innerHTML = '';\r\n\r\n  this._eventBus.fire('contextPad.close', { current: this._current });\r\n\r\n  this._current = null;\r\n};\r\n\r\n/**\r\n * Check if pad is open.\r\n *\r\n * If target is provided, check if it is opened\r\n * for the given target (single or multiple elements).\r\n *\r\n * @param {ContextPadTarget} [target]\r\n * @return {boolean}\r\n */\r\nContextPad.prototype.isOpen = function(target) {\r\n  var current = this._current;\r\n\r\n  if (!current) {\r\n    return false;\r\n  }\r\n\r\n  // basic no-args is open check\r\n  if (!target) {\r\n    return true;\r\n  }\r\n\r\n  var currentTarget = current.target;\r\n\r\n  // strict handling of single vs. multi-selection\r\n  if (isArray(target) !== isArray(currentTarget)) {\r\n    return false;\r\n  }\r\n\r\n  if (isArray(target)) {\r\n    return (\r\n      target.length === currentTarget.length &&\r\n      every(target, function(element) {\r\n        return includes(currentTarget, element);\r\n      })\r\n    );\r\n  } else {\r\n    return currentTarget === target;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Check if pad is open and not hidden.\r\n *\r\n * @return {boolean}\r\n */\r\nContextPad.prototype.isShown = function() {\r\n  return this.isOpen() && domClasses(this._current.html).has('open');\r\n};\r\n\r\n/**\r\n * Show context pad.\r\n */\r\nContextPad.prototype.show = function() {\r\n  if (!this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  domClasses(this._current.html).add('open');\r\n\r\n  this._updatePosition();\r\n\r\n  this._eventBus.fire('contextPad.show', { current: this._current });\r\n};\r\n\r\n/**\r\n * Hide context pad.\r\n */\r\nContextPad.prototype.hide = function() {\r\n  if (!this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  domClasses(this._current.html).remove('open');\r\n\r\n  this._eventBus.fire('contextPad.hide', { current: this._current });\r\n};\r\n\r\n/**\r\n * Get context pad position.\r\n *\r\n * If target is connection context pad will be positioned at connection end.\r\n *\r\n * If multiple targets context pad will be placed at top right corner bounding\r\n * box.\r\n *\r\n * @param {ContextPadTarget} target\r\n *\r\n * @return {RectTRBL & { x: number, y: number }}\r\n */\r\nContextPad.prototype._getPosition = function(target) {\r\n  if (!isArray(target) && isConnection(target)) {\r\n    const viewbox = this._canvas.viewbox();\r\n\r\n    const lastWaypoint = getLastWaypoint(target);\r\n\r\n    const x = lastWaypoint.x * viewbox.scale - viewbox.x * viewbox.scale,\r\n          y = lastWaypoint.y * viewbox.scale - viewbox.y * viewbox.scale;\r\n\r\n    return {\r\n      left: x + CONTEXT_PAD_MARGIN * this._canvas.zoom(),\r\n      top: y\r\n    };\r\n  }\r\n\r\n  var container = this._canvas.getContainer();\r\n\r\n  var containerBounds = container.getBoundingClientRect();\r\n\r\n  var targetBounds = this._getTargetBounds(target);\r\n\r\n  return {\r\n    left: targetBounds.right - containerBounds.left + CONTEXT_PAD_MARGIN * this._canvas.zoom(),\r\n    top: targetBounds.top - containerBounds.top\r\n  };\r\n};\r\n\r\n/**\r\n * Update context pad position.\r\n */\r\nContextPad.prototype._updatePosition = function() {\r\n  if (!this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  var html = this._current.html;\r\n\r\n  var position = this._getPosition(this._current.target);\r\n\r\n  if ('x' in position && 'y' in position) {\r\n    html.style.left = position.x + 'px';\r\n    html.style.top = position.y + 'px';\r\n  } else {\r\n    [\r\n      'top',\r\n      'right',\r\n      'bottom',\r\n      'left'\r\n    ].forEach(function(key) {\r\n      if (key in position) {\r\n        html.style[ key ] = position[ key ] + 'px';\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Update context pad visibility. Hide if any of the target elements is hidden\r\n * using the `djs-element-hidden` or `djs-label-hidden` markers.\r\n */\r\nContextPad.prototype._updateVisibility = function() {\r\n  if (!this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  var self = this;\r\n\r\n  var target = this._current.target;\r\n\r\n  var targets = isArray(target) ? target : [ target ];\r\n\r\n  var isHidden = targets.some(function(target) {\r\n    return MARKERS_HIDDEN.some(function(marker) {\r\n      return self._canvas.hasMarker(target, marker);\r\n    });\r\n  });\r\n\r\n  if (isHidden) {\r\n    self.hide();\r\n  } else {\r\n    self.show();\r\n  }\r\n};\r\n\r\n/**\r\n * Get bounding client rect of target element(s).\r\n *\r\n * @param {ContextPadTarget} target\r\n *\r\n * @returns {Rect & RectTRBL}\r\n */\r\nContextPad.prototype._getTargetBounds = function(target) {\r\n  var elements = isArray(target) ? target : [ target ];\r\n\r\n  var elementsGfx = elements.map((element) => {\r\n    return this._canvas.getGraphics(element);\r\n  });\r\n\r\n  return elementsGfx.reduce((bounds, elementGfx) => {\r\n    const elementBounds = elementGfx.getBoundingClientRect();\r\n\r\n    bounds.top = Math.min(bounds.top, elementBounds.top);\r\n    bounds.right = Math.max(bounds.right, elementBounds.right);\r\n    bounds.bottom = Math.max(bounds.bottom, elementBounds.bottom);\r\n    bounds.left = Math.min(bounds.left, elementBounds.left);\r\n\r\n    bounds.x = bounds.left;\r\n    bounds.y = bounds.top;\r\n\r\n    bounds.width = bounds.right - bounds.left;\r\n    bounds.height = bounds.bottom - bounds.top;\r\n\r\n    return bounds;\r\n  }, {\r\n    top: Infinity,\r\n    right: -Infinity,\r\n    bottom: -Infinity,\r\n    left: Infinity\r\n  });\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction addClasses(element, classNames) {\r\n  var classes = domClasses(element);\r\n\r\n  classNames = isArray(classNames) ? classNames : classNames.split(/\\s+/g);\r\n\r\n  classNames.forEach(function(cls) {\r\n    classes.add(cls);\r\n  });\r\n}\r\n\r\n/**\r\n * @param {any[]} array\r\n * @param {any} item\r\n *\r\n * @return {boolean}\r\n */\r\nfunction includes(array, item) {\r\n  return array.indexOf(item) !== -1;\r\n}\r\n\r\nfunction getLastWaypoint(connection) {\r\n  return connection.waypoints[connection.waypoints.length - 1];\r\n}\r\n\r\n/**\r\n * @param {ContextPadTarget} target\r\n * @param {ContextPadTarget} otherTarget\r\n *\r\n * @return {boolean}\r\n */\r\nfunction targetsEqual(target, otherTarget) {\r\n  target = isArray(target) ? target : [ target ];\r\n  otherTarget = isArray(otherTarget) ? otherTarget : [ otherTarget ];\r\n\r\n  return target.length === otherTarget.length\r\n    && every(target, function(element) {\r\n      return otherTarget.includes(element);\r\n    });\r\n}","import InteractionEventsModule from '../interaction-events';\r\nimport OverlaysModule from '../overlays';\r\n\r\nimport ContextPad from './ContextPad';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    InteractionEventsModule,\r\n    OverlaysModule\r\n  ],\r\n  contextPad: [ 'type', ContextPad ]\r\n};","var n,l,u,t,i,o,r,f,e,c,s,a,h={},v=[],p=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,y=Array.isArray;function d(n,l){for(var u in l)n[u]=l[u];return n}function _(n){var l=n.parentNode;l&&l.removeChild(n)}function g(l,u,t){var i,o,r,f={};for(r in u)\"key\"==r?i=u[r]:\"ref\"==r?o=u[r]:f[r]=u[r];if(arguments.length>2&&(f.children=arguments.length>3?n.call(arguments,2):t),\"function\"==typeof l&&null!=l.defaultProps)for(r in l.defaultProps)void 0===f[r]&&(f[r]=l.defaultProps[r]);return k(l,f,i,o,null)}function k(n,t,i,o,r){var f={type:n,props:t,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==r?++u:r,__i:-1,__u:0};return null==r&&null!=l.vnode&&l.vnode(f),f}function b(){return{current:null}}function m(n){return n.children}function w(n,l){this.props=n,this.context=l}function C(n,l){if(null==l)return n.__?C(n.__,n.__i+1):null;for(var u;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e)return u.__e;return\"function\"==typeof n.type?C(n):null}function x(n){var l,u;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e){n.__e=n.__c.base=u.__e;break}return x(n)}}function P(n){(!n.__d&&(n.__d=!0)&&i.push(n)&&!S.__r++||o!==l.debounceRendering)&&((o=l.debounceRendering)||r)(S)}function S(){var n,u,t,o,r,e,c,s;for(i.sort(f);n=i.shift();)n.__d&&(u=i.length,o=void 0,e=(r=(t=n).__v).__e,c=[],s=[],t.__P&&((o=d({},r)).__v=r.__v+1,l.vnode&&l.vnode(o),O(t.__P,o,r,t.__n,void 0!==t.__P.ownerSVGElement,32&r.__u?[e]:null,c,null==e?C(r):e,!!(32&r.__u),s),o.__v=r.__v,o.__.__k[o.__i]=o,j(c,o,s),o.__e!=e&&x(o)),i.length>u&&i.sort(f));S.__r=0}function $(n,l,u,t,i,o,r,f,e,c,s){var a,p,y,d,_,g=t&&t.__k||v,k=l.length;for(u.__d=e,I(u,l,g),e=u.__d,a=0;a<k;a++)null!=(y=u.__k[a])&&\"boolean\"!=typeof y&&\"function\"!=typeof y&&(p=-1===y.__i?h:g[y.__i]||h,y.__i=a,O(n,y,p,i,o,r,f,e,c,s),d=y.__e,y.ref&&p.ref!=y.ref&&(p.ref&&N(p.ref,null,y),s.push(y.ref,y.__c||d,y)),null==_&&null!=d&&(_=d),65536&y.__u||p.__k===y.__k?(e&&!e.isConnected&&(e=C(p)),e=H(y,e,n)):\"function\"==typeof y.type&&void 0!==y.__d?e=y.__d:d&&(e=d.nextSibling),y.__d=void 0,y.__u&=-196609);u.__d=e,u.__e=_}function I(n,l,u){var t,i,o,r,f,e=l.length,c=u.length,s=c,a=0;for(n.__k=[],t=0;t<e;t++)r=t+a,null!=(i=n.__k[t]=null==(i=l[t])||\"boolean\"==typeof i||\"function\"==typeof i?null:\"string\"==typeof i||\"number\"==typeof i||\"bigint\"==typeof i||i.constructor==String?k(null,i,null,null,null):y(i)?k(m,{children:i},null,null,null):void 0===i.constructor&&i.__b>0?k(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i)?(i.__=n,i.__b=n.__b+1,f=A(i,u,r,s),i.__i=f,o=null,-1!==f&&(s--,(o=u[f])&&(o.__u|=131072)),null==o||null===o.__v?(-1==f&&a--,\"function\"!=typeof i.type&&(i.__u|=65536)):f!==r&&(f===r+1?a++:f>r?s>e-r?a+=f-r:a--:f<r?f==r-1&&(a=f-r):a=0,f!==t+a&&(i.__u|=65536))):(o=u[r])&&null==o.key&&o.__e&&0==(131072&o.__u)&&(o.__e==n.__d&&(n.__d=C(o)),V(o,o,!1),u[r]=null,s--);if(s)for(t=0;t<c;t++)null!=(o=u[t])&&0==(131072&o.__u)&&(o.__e==n.__d&&(n.__d=C(o)),V(o,o))}function H(n,l,u){var t,i;if(\"function\"==typeof n.type){for(t=n.__k,i=0;t&&i<t.length;i++)t[i]&&(t[i].__=n,l=H(t[i],l,u));return l}n.__e!=l&&(u.insertBefore(n.__e,l||null),l=n.__e);do{l=l&&l.nextSibling}while(null!=l&&8===l.nodeType);return l}function T(n,l){return l=l||[],null==n||\"boolean\"==typeof n||(y(n)?n.some(function(n){T(n,l)}):l.push(n)),l}function A(n,l,u,t){var i=n.key,o=n.type,r=u-1,f=u+1,e=l[u];if(null===e||e&&i==e.key&&o===e.type&&0==(131072&e.__u))return u;if(t>(null!=e&&0==(131072&e.__u)?1:0))for(;r>=0||f<l.length;){if(r>=0){if((e=l[r])&&0==(131072&e.__u)&&i==e.key&&o===e.type)return r;r--}if(f<l.length){if((e=l[f])&&0==(131072&e.__u)&&i==e.key&&o===e.type)return f;f++}}return-1}function F(n,l,u){\"-\"===l[0]?n.setProperty(l,null==u?\"\":u):n[l]=null==u?\"\":\"number\"!=typeof u||p.test(l)?u:u+\"px\"}function L(n,l,u,t,i){var o;n:if(\"style\"===l)if(\"string\"==typeof u)n.style.cssText=u;else{if(\"string\"==typeof t&&(n.style.cssText=t=\"\"),t)for(l in t)u&&l in u||F(n.style,l,\"\");if(u)for(l in u)t&&u[l]===t[l]||F(n.style,l,u[l])}else if(\"o\"===l[0]&&\"n\"===l[1])o=l!==(l=l.replace(/(PointerCapture)$|Capture$/i,\"$1\")),l=l.toLowerCase()in n||\"onFocusOut\"===l||\"onFocusIn\"===l?l.toLowerCase().slice(2):l.slice(2),n.l||(n.l={}),n.l[l+o]=u,u?t?u.u=t.u:(u.u=e,n.addEventListener(l,o?s:c,o)):n.removeEventListener(l,o?s:c,o);else{if(i)l=l.replace(/xlink(H|:h)/,\"h\").replace(/sName$/,\"s\");else if(\"width\"!=l&&\"height\"!=l&&\"href\"!=l&&\"list\"!=l&&\"form\"!=l&&\"tabIndex\"!=l&&\"download\"!=l&&\"rowSpan\"!=l&&\"colSpan\"!=l&&\"role\"!=l&&l in n)try{n[l]=null==u?\"\":u;break n}catch(n){}\"function\"==typeof u||(null==u||!1===u&&\"-\"!==l[4]?n.removeAttribute(l):n.setAttribute(l,u))}}function M(n){return function(u){if(this.l){var t=this.l[u.type+n];if(null==u.t)u.t=e++;else if(u.t<t.u)return;return t(l.event?l.event(u):u)}}}function O(n,u,t,i,o,r,f,e,c,s){var a,h,v,p,_,g,k,b,C,x,P,S,I,H,T,A=u.type;if(void 0!==u.constructor)return null;128&t.__u&&(c=!!(32&t.__u),r=[e=u.__e=t.__e]),(a=l.__b)&&a(u);n:if(\"function\"==typeof A)try{if(b=u.props,C=(a=A.contextType)&&i[a.__c],x=a?C?C.props.value:a.__:i,t.__c?k=(h=u.__c=t.__c).__=h.__E:(\"prototype\"in A&&A.prototype.render?u.__c=h=new A(b,x):(u.__c=h=new w(b,x),h.constructor=A,h.render=q),C&&C.sub(h),h.props=b,h.state||(h.state={}),h.context=x,h.__n=i,v=h.__d=!0,h.__h=[],h._sb=[]),null==h.__s&&(h.__s=h.state),null!=A.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=d({},h.__s)),d(h.__s,A.getDerivedStateFromProps(b,h.__s))),p=h.props,_=h.state,h.__v=u,v)null==A.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==A.getDerivedStateFromProps&&b!==p&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(b,x),!h.__e&&(null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(b,h.__s,x)||u.__v===t.__v)){for(u.__v!==t.__v&&(h.props=b,h.state=h.__s,h.__d=!1),u.__e=t.__e,u.__k=t.__k,u.__k.forEach(function(n){n&&(n.__=u)}),P=0;P<h._sb.length;P++)h.__h.push(h._sb[P]);h._sb=[],h.__h.length&&f.push(h);break n}null!=h.componentWillUpdate&&h.componentWillUpdate(b,h.__s,x),null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(p,_,g)})}if(h.context=x,h.props=b,h.__P=n,h.__e=!1,S=l.__r,I=0,\"prototype\"in A&&A.prototype.render){for(h.state=h.__s,h.__d=!1,S&&S(u),a=h.render(h.props,h.state,h.context),H=0;H<h._sb.length;H++)h.__h.push(h._sb[H]);h._sb=[]}else do{h.__d=!1,S&&S(u),a=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++I<25);h.state=h.__s,null!=h.getChildContext&&(i=d(d({},i),h.getChildContext())),v||null==h.getSnapshotBeforeUpdate||(g=h.getSnapshotBeforeUpdate(p,_)),$(n,y(T=null!=a&&a.type===m&&null==a.key?a.props.children:a)?T:[T],u,t,i,o,r,f,e,c,s),h.base=u.__e,u.__u&=-161,h.__h.length&&f.push(h),k&&(h.__E=h.__=null)}catch(n){u.__v=null,c||null!=r?(u.__e=e,u.__u|=c?160:32,r[r.indexOf(e)]=null):(u.__e=t.__e,u.__k=t.__k),l.__e(n,u,t)}else null==r&&u.__v===t.__v?(u.__k=t.__k,u.__e=t.__e):u.__e=z(t.__e,u,t,i,o,r,f,c,s);(a=l.diffed)&&a(u)}function j(n,u,t){u.__d=void 0;for(var i=0;i<t.length;i++)N(t[i],t[++i],t[++i]);l.__c&&l.__c(u,n),n.some(function(u){try{n=u.__h,u.__h=[],n.some(function(n){n.call(u)})}catch(n){l.__e(n,u.__v)}})}function z(l,u,t,i,o,r,f,e,c){var s,a,v,p,d,g,k,b=t.props,m=u.props,w=u.type;if(\"svg\"===w&&(o=!0),null!=r)for(s=0;s<r.length;s++)if((d=r[s])&&\"setAttribute\"in d==!!w&&(w?d.localName===w:3===d.nodeType)){l=d,r[s]=null;break}if(null==l){if(null===w)return document.createTextNode(m);l=o?document.createElementNS(\"http://www.w3.org/2000/svg\",w):document.createElement(w,m.is&&m),r=null,e=!1}if(null===w)b===m||e&&l.data===m||(l.data=m);else{if(r=r&&n.call(l.childNodes),b=t.props||h,!e&&null!=r)for(b={},s=0;s<l.attributes.length;s++)b[(d=l.attributes[s]).name]=d.value;for(s in b)if(d=b[s],\"children\"==s);else if(\"dangerouslySetInnerHTML\"==s)v=d;else if(\"key\"!==s&&!(s in m)){if(\"value\"==s&&\"defaultValue\"in m||\"checked\"==s&&\"defaultChecked\"in m)continue;L(l,s,null,d,o)}for(s in m)d=m[s],\"children\"==s?p=d:\"dangerouslySetInnerHTML\"==s?a=d:\"value\"==s?g=d:\"checked\"==s?k=d:\"key\"===s||e&&\"function\"!=typeof d||b[s]===d||L(l,s,d,b[s],o);if(a)e||v&&(a.__html===v.__html||a.__html===l.innerHTML)||(l.innerHTML=a.__html),u.__k=[];else if(v&&(l.innerHTML=\"\"),$(l,y(p)?p:[p],u,t,i,o&&\"foreignObject\"!==w,r,f,r?r[0]:t.__k&&C(t,0),e,c),null!=r)for(s=r.length;s--;)null!=r[s]&&_(r[s]);e||(s=\"value\",void 0!==g&&(g!==l[s]||\"progress\"===w&&!g||\"option\"===w&&g!==b[s])&&L(l,s,g,b[s],!1),s=\"checked\",void 0!==k&&k!==l[s]&&L(l,s,k,b[s],!1))}return l}function N(n,u,t){try{\"function\"==typeof n?n(u):n.current=u}catch(n){l.__e(n,t)}}function V(n,u,t){var i,o;if(l.unmount&&l.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||N(i,null,u)),null!=(i=n.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(n){l.__e(n,u)}i.base=i.__P=null}if(i=n.__k)for(o=0;o<i.length;o++)i[o]&&V(i[o],u,t||\"function\"!=typeof n.type);t||null==n.__e||_(n.__e),n.__c=n.__=n.__e=n.__d=void 0}function q(n,l,u){return this.constructor(n,u)}function B(u,t,i){var o,r,f,e;l.__&&l.__(u,t),r=(o=\"function\"==typeof i)?null:i&&i.__k||t.__k,f=[],e=[],O(t,u=(!o&&i||t).__k=g(m,null,[u]),r||h,h,void 0!==t.ownerSVGElement,!o&&i?[i]:r?null:t.firstChild?n.call(t.childNodes):null,f,!o&&i?i:r?r.__e:t.firstChild,o,e),j(f,u,e)}function D(n,l){B(n,l,D)}function E(l,u,t){var i,o,r,f,e=d({},l.props);for(r in l.type&&l.type.defaultProps&&(f=l.type.defaultProps),u)\"key\"==r?i=u[r]:\"ref\"==r?o=u[r]:e[r]=void 0===u[r]&&void 0!==f?f[r]:u[r];return arguments.length>2&&(e.children=arguments.length>3?n.call(arguments,2):t),k(l.type,e,i||l.key,o||l.ref,null)}function G(n,l){var u={__c:l=\"__cC\"+a++,__:n,Consumer:function(n,l){return n.children(l)},Provider:function(n){var u,t;return this.getChildContext||(u=[],(t={})[l]=this,this.getChildContext=function(){return t},this.shouldComponentUpdate=function(n){this.props.value!==n.value&&u.some(function(n){n.__e=!0,P(n)})},this.sub=function(n){u.push(n);var l=n.componentWillUnmount;n.componentWillUnmount=function(){u.splice(u.indexOf(n),1),l&&l.call(n)}}),n.children}};return u.Provider.__=u.Consumer.contextType=u}n=v.slice,l={__e:function(n,l,u,t){for(var i,o,r;l=l.__;)if((i=l.__c)&&!i.__)try{if((o=i.constructor)&&null!=o.getDerivedStateFromError&&(i.setState(o.getDerivedStateFromError(n)),r=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(n,t||{}),r=i.__d),r)return i.__E=i}catch(l){n=l}throw n}},u=0,t=function(n){return null!=n&&null==n.constructor},w.prototype.setState=function(n,l){var u;u=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=d({},this.state),\"function\"==typeof n&&(n=n(d({},u),this.props)),n&&d(u,n),null!=n&&this.__v&&(l&&this._sb.push(l),P(this))},w.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),P(this))},w.prototype.render=m,i=[],r=\"function\"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,f=function(n,l){return n.__v.__b-l.__v.__b},S.__r=0,e=0,c=M(!1),s=M(!0),a=0;export{w as Component,m as Fragment,E as cloneElement,G as createContext,g as createElement,b as createRef,g as h,D as hydrate,t as isValidElement,l as options,B as render,T as toChildArray};\n//# sourceMappingURL=preact.module.js.map\n","var n=function(t,s,r,e){var u;s[0]=0;for(var h=1;h<s.length;h++){var p=s[h++],a=s[h]?(s[0]|=p?1:2,r[s[h++]]):s[++h];3===p?e[0]=a:4===p?e[1]=Object.assign(e[1]||{},a):5===p?(e[1]=e[1]||{})[s[++h]]=a:6===p?e[1][s[++h]]+=a+\"\":p?(u=t.apply(a,n(t,a,r,[\"\",null])),e.push(u),a[0]?s[0]|=2:(s[h-2]=0,s[h]=u)):e.push(a)}return e},t=new Map;export default function(s){var r=t.get(this);return r||(r=new Map,t.set(this,r)),(r=n(this,r.get(s)||(r.set(s,r=function(n){for(var t,s,r=1,e=\"\",u=\"\",h=[0],p=function(n){1===r&&(n||(e=e.replace(/^\\s*\\n\\s*|\\s*\\n\\s*$/g,\"\")))?h.push(0,n,e):3===r&&(n||e)?(h.push(3,n,e),r=2):2===r&&\"...\"===e&&n?h.push(4,n,0):2===r&&e&&!n?h.push(5,0,!0,e):r>=5&&((e||!n&&5===r)&&(h.push(r,0,e,s),r=6),n&&(h.push(r,n,0,s),r=6)),e=\"\"},a=0;a<n.length;a++){a&&(1===r&&p(),p(a));for(var l=0;l<n[a].length;l++)t=n[a][l],1===r?\"<\"===t?(p(),h=[h],r=3):e+=t:4===r?\"--\"===e&&\">\"===t?(r=1,e=\"\"):e=t+e[0]:u?t===u?u=\"\":e+=t:'\"'===t||\"'\"===t?u=t:\">\"===t?(p(),r=1):r&&(\"=\"===t?(r=5,s=e,e=\"\"):\"/\"===t&&(r<5||\">\"===n[a][l+1])?(p(),3===r&&(h=h[0]),r=h,(h=h[0]).push(2,0,r),r=0):\" \"===t||\"\\t\"===t||\"\\n\"===t||\"\\r\"===t?(p(),r=2):e+=t),3===r&&\"!--\"===e&&(r=4,h=h[0])}return p(),h}(s)),r),arguments,[])).length>1?r:r[0]}\n","import{h as r,Component as o,render as t}from\"preact\";export{h,render,Component}from\"preact\";import e from\"htm\";var m=e.bind(r);export{m as html};\n","import{options as n}from\"preact\";var t,r,u,i,o=0,f=[],c=[],e=n,a=e.__b,v=e.__r,l=e.diffed,m=e.__c,s=e.unmount,d=e.__;function h(n,t){e.__h&&e.__h(r,n,o||t),o=0;var u=r.__H||(r.__H={__:[],__h:[]});return n>=u.__.length&&u.__.push({__V:c}),u.__[n]}function p(n){return o=1,y(D,n)}function y(n,u,i){var o=h(t++,2);if(o.t=n,!o.__c&&(o.__=[i?i(u):D(void 0,u),function(n){var t=o.__N?o.__N[0]:o.__[0],r=o.t(t,n);t!==r&&(o.__N=[r,o.__[1]],o.__c.setState({}))}],o.__c=r,!r.u)){var f=function(n,t,r){if(!o.__c.__H)return!0;var u=o.__c.__H.__.filter(function(n){return!!n.__c});if(u.every(function(n){return!n.__N}))return!c||c.call(this,n,t,r);var i=!1;return u.forEach(function(n){if(n.__N){var t=n.__[0];n.__=n.__N,n.__N=void 0,t!==n.__[0]&&(i=!0)}}),!(!i&&o.__c.props===n)&&(!c||c.call(this,n,t,r))};r.u=!0;var c=r.shouldComponentUpdate,e=r.componentWillUpdate;r.componentWillUpdate=function(n,t,r){if(this.__e){var u=c;c=void 0,f(n,t,r),c=u}e&&e.call(this,n,t,r)},r.shouldComponentUpdate=f}return o.__N||o.__}function _(n,u){var i=h(t++,3);!e.__s&&C(i.__H,u)&&(i.__=n,i.i=u,r.__H.__h.push(i))}function A(n,u){var i=h(t++,4);!e.__s&&C(i.__H,u)&&(i.__=n,i.i=u,r.__h.push(i))}function F(n){return o=5,q(function(){return{current:n}},[])}function T(n,t,r){o=6,A(function(){return\"function\"==typeof n?(n(t()),function(){return n(null)}):n?(n.current=t(),function(){return n.current=null}):void 0},null==r?r:r.concat(n))}function q(n,r){var u=h(t++,7);return C(u.__H,r)?(u.__V=n(),u.i=r,u.__h=n,u.__V):u.__}function x(n,t){return o=8,q(function(){return n},t)}function P(n){var u=r.context[n.__c],i=h(t++,9);return i.c=n,u?(null==i.__&&(i.__=!0,u.sub(r)),u.props.value):n.__}function V(n,t){e.useDebugValue&&e.useDebugValue(t?t(n):n)}function b(n){var u=h(t++,10),i=p();return u.__=n,r.componentDidCatch||(r.componentDidCatch=function(n,t){u.__&&u.__(n,t),i[1](n)}),[i[0],function(){i[1](void 0)}]}function g(){var n=h(t++,11);if(!n.__){for(var u=r.__v;null!==u&&!u.__m&&null!==u.__;)u=u.__;var i=u.__m||(u.__m=[0,0]);n.__=\"P\"+i[0]+\"-\"+i[1]++}return n.__}function j(){for(var n;n=f.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(z),n.__H.__h.forEach(B),n.__H.__h=[]}catch(t){n.__H.__h=[],e.__e(t,n.__v)}}e.__b=function(n){r=null,a&&a(n)},e.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),d&&d(n,t)},e.__r=function(n){v&&v(n),t=0;var i=(r=n.__c).__H;i&&(u===r?(i.__h=[],r.__h=[],i.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=c,n.__N=n.i=void 0})):(i.__h.forEach(z),i.__h.forEach(B),i.__h=[],t=0)),u=r},e.diffed=function(n){l&&l(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(1!==f.push(t)&&i===e.requestAnimationFrame||((i=e.requestAnimationFrame)||w)(j)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==c&&(n.__=n.__V),n.i=void 0,n.__V=c})),u=r=null},e.__c=function(n,t){t.some(function(n){try{n.__h.forEach(z),n.__h=n.__h.filter(function(n){return!n.__||B(n)})}catch(r){t.some(function(n){n.__h&&(n.__h=[])}),t=[],e.__e(r,n.__v)}}),m&&m(n,t)},e.unmount=function(n){s&&s(n);var t,r=n.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{z(n)}catch(n){t=n}}),r.__H=void 0,t&&e.__e(t,r.__v))};var k=\"function\"==typeof requestAnimationFrame;function w(n){var t,r=function(){clearTimeout(u),k&&cancelAnimationFrame(t),setTimeout(n)},u=setTimeout(r,100);k&&(t=requestAnimationFrame(r))}function z(n){var t=r,u=n.__c;\"function\"==typeof u&&(n.__c=void 0,u()),r=t}function B(n){var t=r;n.__c=n.__(),r=t}function C(n,t){return!n||n.length!==t.length||t.some(function(t,r){return t!==n[r]})}function D(n,t){return\"function\"==typeof t?t(n):t}export{x as useCallback,P as useContext,V as useDebugValue,_ as useEffect,b as useErrorBoundary,g as useId,T as useImperativeHandle,A as useLayoutEffect,q as useMemo,y as useReducer,F as useRef,p as useState};\n//# sourceMappingURL=hooks.module.js.map\n","function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f)}else for(f in e)e[f]&&(n&&(n+=\" \"),n+=f);return n}export function clsx(){for(var e,t,f=0,n=\"\",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;","import classNames from 'clsx';\r\n\r\nimport {\r\n  html\r\n} from '../../ui';\r\n\r\n/**\r\n * @typedef {import('./PopupMenuProvider').PopupMenuEntry} PopupMenuEntry\r\n */\r\n\r\n/**\r\n * Component that renders a popup menu entry.\r\n *\r\n * @param {Object} props\r\n * @param {string} props.key\r\n * @param {PopupMenuEntry} props.entry\r\n * @param {boolean} props.selected\r\n * @param {(event: MouseEvent) => void} props.onMouseEnter\r\n * @param {(event: MouseEvent) => void} props.onMouseLeave\r\n * @param {(event: MouseEvent, entry?: PopupMenuEntry, action?: string) => void} props.onAction\r\n */\r\nexport default function PopupMenuItem(props) {\r\n  const {\r\n    entry,\r\n    selected,\r\n    onMouseEnter,\r\n    onMouseLeave,\r\n    onAction\r\n  } = props;\r\n\r\n  return html`\r\n    <li\r\n      class=${ classNames('entry', { selected }) }\r\n      data-id=${ entry.id }\r\n      title=${ entry.title || entry.label }\r\n      tabIndex=\"0\"\r\n      onClick=${ onAction }\r\n      onFocus=${ onMouseEnter }\r\n      onBlur=${ onMouseLeave }\r\n      onMouseEnter=${ onMouseEnter }\r\n      onMouseLeave=${ onMouseLeave }\r\n      onDragStart=${ (event) => onAction(event, entry, 'dragstart') }\r\n      aria-role=\"button\"\r\n      draggable=${ true }\r\n    >\r\n      <div class=\"djs-popup-entry-content\">\r\n        <span\r\n          class=${ classNames('djs-popup-entry-name', entry.className) }\r\n        >\r\n          ${(entry.imageUrl && html`<img class=\"djs-popup-entry-icon\" src=${ entry.imageUrl } alt=\"\" />`) ||\r\n            (entry.imageHtml && html`<div class=\"djs-popup-entry-icon\" dangerouslySetInnerHTML=${ { __html: entry.imageHtml } } />`)}\r\n\r\n          ${ entry.label ? html`\r\n            <span class=\"djs-popup-label\">\r\n              ${ entry.label }\r\n            </span>\r\n          ` : null }\r\n        </span>\r\n        ${ entry.description && html`\r\n          <span\r\n            class=\"djs-popup-entry-description\"\r\n            title=${ entry.description }\r\n          >\r\n            ${ entry.description }\r\n          </span>\r\n        ` }\r\n      </div>\r\n      ${ entry.documentationRef && html`\r\n        <div class=\"djs-popup-entry-docs\">\r\n          <a\r\n            href=\"${ entry.documentationRef }\"\r\n            onClick=${ (event) => event.stopPropagation() }\r\n            title=\"Open element documentation\"\r\n            target=\"_blank\"\r\n            rel=\"noopener\"\r\n          >\r\n            <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z\" fill=\"#818798\"/>\r\n            </svg>\r\n          </a>\r\n        </div>\r\n      ` }\r\n    </li>\r\n  `;\r\n}\r\n","import {\r\n  html,\r\n  useMemo,\r\n  useLayoutEffect,\r\n  useRef\r\n} from '../../ui';\r\n\r\nimport PopupMenuItem from './PopupMenuItem';\r\n\r\n/**\r\n * @typedef {import('./PopupMenuProvider').PopupMenuEntry} PopupMenuEntry\r\n */\r\n\r\n/**\r\n * Component that renders a popup menu entry list.\r\n *\r\n * @param {Object} props\r\n * @param {PopupMenuEntry[]} props.entries\r\n * @param {PopupMenuEntry} props.selectedEntry\r\n * @param {(entry: PopupMenuEntry | null) => void} props.setSelectedEntry\r\n */\r\nexport default function PopupMenuList(props) {\r\n  const {\r\n    selectedEntry,\r\n    setSelectedEntry,\r\n    entries,\r\n    ...restProps\r\n  } = props;\r\n\r\n  const resultsRef = useRef();\r\n\r\n  const groups = useMemo(() => groupEntries(entries), [ entries ]);\r\n\r\n  // scroll to selected result\r\n  useLayoutEffect(() => {\r\n    const containerEl = resultsRef.current;\r\n\r\n    if (!containerEl)\r\n      return;\r\n\r\n    const selectedEl = containerEl.querySelector('.selected');\r\n\r\n    if (selectedEl) {\r\n      scrollIntoView(selectedEl);\r\n    }\r\n  }, [ selectedEntry ]);\r\n\r\n  return html`\r\n    <div class=\"djs-popup-results\" ref=${ resultsRef }>\r\n      ${ groups.map(group => html`\r\n        ${ group.name && html`\r\n          <div key=${ group.id } class=\"entry-header\" title=${ group.name }>\r\n            ${ group.name }\r\n          </div>\r\n        ` }\r\n        <ul class=\"djs-popup-group\" data-group=${ group.id }>\r\n          ${ group.entries.map(entry => html`\r\n            <${PopupMenuItem}\r\n              key=${ entry.id }\r\n              entry=${ entry }\r\n              selected=${ entry === selectedEntry }\r\n              onMouseEnter=${ () => setSelectedEntry(entry) }\r\n              onMouseLeave=${ () => setSelectedEntry(null) }\r\n              ...${ restProps }\r\n            />\r\n          `) }\r\n        </ul>\r\n      `) }\r\n    </div>\r\n  `;\r\n}\r\n\r\n\r\n// helpers\r\nfunction groupEntries(entries) {\r\n  const groups = [];\r\n\r\n  const getGroup = group => groups.find(elem => group.id === elem.id);\r\n\r\n  const containsGroup = group => !!getGroup(group);\r\n\r\n  // legacy support for provider built for the old popUp menu\r\n  const formatGroup = group =>\r\n    typeof group === 'string' ? { id: group } : group;\r\n\r\n  entries.forEach(entry => {\r\n\r\n    // assume a default group when none is provided\r\n    const group = entry.group ? formatGroup(entry.group) : { id: 'default' };\r\n\r\n    if (!containsGroup(group)) {\r\n      groups.push({ ...group, entries: [ entry ] });\r\n    } else {\r\n      getGroup(group).entries.push(entry);\r\n    }\r\n  });\r\n\r\n  return groups;\r\n}\r\n\r\n// helpers ////////////////\r\n\r\nfunction scrollIntoView(el) {\r\n  if (typeof el.scrollIntoViewIfNeeded === 'function') {\r\n    el.scrollIntoViewIfNeeded();\r\n  } else {\r\n    el.scrollIntoView({\r\n      scrollMode: 'if-needed',\r\n      block: 'nearest'\r\n    });\r\n  }\r\n}","import {\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n  useLayoutEffect,\r\n  html,\r\n  useMemo,\r\n  useCallback\r\n} from '../../ui';\r\n\r\nimport {\r\n  closest as domClosest,\r\n  matches as domMatches\r\n} from 'min-dom';\r\n\r\nimport PopupMenuList from './PopupMenuList';\r\nimport classNames from 'clsx';\r\nimport { isDefined, isFunction } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('./PopupMenuProvider').PopupMenuEntry} PopupMenuEntry\r\n * @typedef {import('./PopupMenuProvider').PopupMenuHeaderEntry} PopupMenuHeaderEntry\r\n * @typedef {import('./PopupMenuProvider').PopupMenuEmptyPlaceholderProvider | import('./PopupMenuProvider').PopupMenuEmptyPlaceholder} PopupMenuEmptyPlaceholder\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n */\r\n\r\n/**\r\n * A component that renders the popup menus.\r\n *\r\n * @param {Object} props\r\n * @param {() => void} props.onClose\r\n * @param {(element: HTMLElement) => Point} props.position\r\n * @param {string} props.className\r\n * @param {PopupMenuEntry[]} props.entries\r\n * @param {PopupMenuHeaderEntry[]} props.headerEntries\r\n * @param {number} props.scale\r\n * @param {string} [props.title]\r\n * @param {boolean} [props.search]\r\n * @param {PopupMenuEmptyPlaceholder} [props.emptyPlaceholder]\r\n * @param {number} [props.width]\r\n */\r\nexport default function PopupMenuComponent(props) {\r\n  const {\r\n    onClose,\r\n    onSelect,\r\n    className,\r\n    headerEntries,\r\n    position,\r\n    title,\r\n    width,\r\n    scale,\r\n    search,\r\n    emptyPlaceholder,\r\n    entries: originalEntries,\r\n    onOpened,\r\n    onClosed\r\n  } = props;\r\n\r\n  const searchable = useMemo(() => {\r\n    if (!isDefined(search)) {\r\n      return false;\r\n    }\r\n\r\n    return originalEntries.length > 5;\r\n  }, [ search, originalEntries ]);\r\n\r\n  const [ value, setValue ] = useState('');\r\n\r\n  const filterEntries = useCallback((originalEntries, value) => {\r\n\r\n    if (!searchable) {\r\n      return originalEntries;\r\n    }\r\n\r\n    const filter = entry => {\r\n      if (!value) {\r\n        return (entry.rank || 0) >= 0;\r\n      }\r\n\r\n      if (entry.searchable === false) {\r\n        return false;\r\n      }\r\n\r\n      const searchableFields = [\r\n        entry.description || '',\r\n        entry.label || '',\r\n        entry.search || ''\r\n      ].map(string => string.toLowerCase());\r\n\r\n      // every word of `value` should be included in one of the searchable fields\r\n      return value\r\n        .toLowerCase()\r\n        .split(/\\s/g)\r\n        .every(word => searchableFields.some(field => field.includes(word)));\r\n    };\r\n\r\n    return originalEntries.filter(filter);\r\n  }, [ searchable ]);\r\n\r\n  const [ entries, setEntries ] = useState(filterEntries(originalEntries, value));\r\n  const [ selectedEntry, setSelectedEntry ] = useState(entries[0]);\r\n\r\n  const updateEntries = useCallback((newEntries) => {\r\n\r\n    // select first entry if non is selected\r\n    if (!selectedEntry || !newEntries.includes(selectedEntry)) {\r\n      setSelectedEntry(newEntries[0]);\r\n    }\r\n\r\n    setEntries(newEntries);\r\n  }, [ selectedEntry, setEntries, setSelectedEntry ]);\r\n\r\n  // filter entries on value change\r\n  useEffect(() => {\r\n    updateEntries(filterEntries(originalEntries, value));\r\n  }, [ value, originalEntries ]);\r\n\r\n  // handle keyboard seleciton\r\n  const keyboardSelect = useCallback(direction => {\r\n    const idx = entries.indexOf(selectedEntry);\r\n\r\n    let nextIdx = idx + direction;\r\n\r\n    if (nextIdx < 0) {\r\n      nextIdx = entries.length - 1;\r\n    }\r\n\r\n    if (nextIdx >= entries.length) {\r\n      nextIdx = 0;\r\n    }\r\n\r\n    setSelectedEntry(entries[nextIdx]);\r\n  }, [ entries, selectedEntry, setSelectedEntry ]);\r\n\r\n  const handleKeyDown = useCallback(event => {\r\n    if (event.key === 'Enter' && selectedEntry) {\r\n      return onSelect(event, selectedEntry);\r\n    }\r\n\r\n    // ARROW_UP\r\n    if (event.key === 'ArrowUp') {\r\n      keyboardSelect(-1);\r\n\r\n      return event.preventDefault();\r\n    }\r\n\r\n    // ARROW_DOWN\r\n    if (event.key === 'ArrowDown') {\r\n      keyboardSelect(1);\r\n\r\n      return event.preventDefault();\r\n    }\r\n  }, [ onSelect, selectedEntry, keyboardSelect ]);\r\n\r\n  const handleKey = useCallback(event => {\r\n    if (domMatches(event.target, 'input')) {\r\n      setValue(() => event.target.value);\r\n    }\r\n  }, [ setValue ]);\r\n\r\n  useEffect(() => {\r\n    onOpened();\r\n\r\n    return () => {\r\n      onClosed();\r\n    };\r\n  }, []);\r\n\r\n  const displayHeader = useMemo(() => title || headerEntries.length > 0, [ title, headerEntries ]);\r\n\r\n  return html`\r\n    <${PopupMenuWrapper}\r\n      onClose=${ onClose }\r\n      onKeyup=${ handleKey }\r\n      onKeydown=${ handleKeyDown }\r\n      className=${ className }\r\n      position=${ position }\r\n      width=${ width }\r\n      scale=${ scale }\r\n    >\r\n      ${ displayHeader && html`\r\n        <div class=\"djs-popup-header\">\r\n          <h3 class=\"djs-popup-title\" title=${ title }>${ title }</h3>\r\n          ${ headerEntries.map(entry => html`\r\n            <${ entry.action ? 'button' : 'span' }\r\n              class=${ getHeaderClasses(entry, entry === selectedEntry) }\r\n              onClick=${ event => onSelect(event, entry) }\r\n              title=${ entry.title || entry.label }\r\n              data-id=${ entry.id }\r\n              onMouseEnter=${ () => setSelectedEntry(entry) }\r\n              onMouseLeave=${ () => setSelectedEntry(null) }\r\n              onFocus=${ () => setSelectedEntry(entry) }\r\n              onBlur=${ () => setSelectedEntry(null) }\r\n            >\r\n            ${(entry.imageUrl && html`<img class=\"djs-popup-entry-icon\" src=${ entry.imageUrl } alt=\"\" />`) ||\r\n            (entry.imageHtml && html`<div class=\"djs-popup-entry-icon\" dangerouslySetInnerHTML=${ { __html: entry.imageHtml } } />`)}\r\n\r\n              ${ entry.label ? html`\r\n                <span class=\"djs-popup-label\">${ entry.label }</span>\r\n              ` : null }\r\n            </${ entry.action ? 'button' : 'span' }>\r\n          `) }\r\n        </div>\r\n      ` }\r\n      ${ originalEntries.length > 0 && html`\r\n        <div class=\"djs-popup-body\">\r\n\r\n          ${ searchable && html`\r\n          <div class=\"djs-popup-search\">\r\n            <svg class=\"djs-popup-search-icon\" width=\"14\" height=\"14\" viewBox=\"0 0 14 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z\" fill=\"#22242A\"/>\r\n            </svg>\r\n            <input type=\"text\" aria-label=\"${ title }\" />\r\n          </div>\r\n          ` }\r\n\r\n          <${PopupMenuList}\r\n            entries=${ entries }\r\n            selectedEntry=${ selectedEntry }\r\n            setSelectedEntry=${ setSelectedEntry }\r\n            onAction=${ onSelect }\r\n          />\r\n        </div>\r\n      ` }\r\n    ${ emptyPlaceholder && entries.length === 0 && html`\r\n      <div class=\"djs-popup-no-results\">${ isFunction(emptyPlaceholder) ? emptyPlaceholder(value) : emptyPlaceholder }</div>\r\n    ` }\r\n    </${PopupMenuWrapper}>\r\n  `;\r\n}\r\n\r\n/**\r\n * A component that wraps the popup menu.\r\n *\r\n * @param {*} props\r\n */\r\nfunction PopupMenuWrapper(props) {\r\n  const {\r\n    onClose,\r\n    onKeydown,\r\n    onKeyup,\r\n    className,\r\n    children,\r\n    position: positionGetter\r\n  } = props;\r\n\r\n  const popupRef = useRef();\r\n\r\n  // initial position\r\n  useLayoutEffect(() => {\r\n    if (typeof positionGetter !== 'function') {\r\n      return;\r\n    }\r\n\r\n    const popupEl = popupRef.current;\r\n    const position = positionGetter(popupEl);\r\n\r\n    popupEl.style.left = `${position.x}px`;\r\n    popupEl.style.top = `${position.y}px`;\r\n  }, [ popupRef.current, positionGetter ]);\r\n\r\n  // initial focus\r\n  useLayoutEffect(() => {\r\n    const popupEl = popupRef.current;\r\n\r\n    if (!popupEl) {\r\n      return;\r\n    }\r\n\r\n    const inputEl = popupEl.querySelector('input');\r\n\r\n    (inputEl || popupEl).focus();\r\n  }, []);\r\n\r\n  // global <Escape> / blur handlers\r\n  useEffect(() => {\r\n    const handleKeyDown = event => {\r\n      if (event.key === 'Escape') {\r\n        event.preventDefault();\r\n\r\n        return onClose();\r\n      }\r\n    };\r\n\r\n    const handleClick = event => {\r\n      const popup = domClosest(event.target, '.djs-popup', true);\r\n\r\n      if (popup) {\r\n        return;\r\n      }\r\n\r\n      return onClose();\r\n    };\r\n\r\n    document.documentElement.addEventListener('keydown', handleKeyDown);\r\n    document.body.addEventListener('click', handleClick);\r\n\r\n    return () => {\r\n      document.documentElement.removeEventListener('keydown', handleKeyDown);\r\n      document.body.removeEventListener('click', handleClick);\r\n    };\r\n  }, []);\r\n\r\n  return html`\r\n    <div\r\n      class=${ classNames('djs-popup', className) }\r\n      style=${ getPopupStyle(props) }\r\n      onKeydown=${ onKeydown }\r\n      onKeyup=${ onKeyup }\r\n      ref=${ popupRef }\r\n      tabIndex=\"-1\"\r\n    >\r\n      ${ children }\r\n    </div>\r\n  `;\r\n}\r\n\r\n// helpers //////////////////////\r\n\r\nfunction getPopupStyle(props) {\r\n  return {\r\n    transform: `scale(${props.scale})`,\r\n    width: `${props.width}px`,\r\n    'transform-origin': 'top left'\r\n  };\r\n}\r\n\r\nfunction getHeaderClasses(entry, selected) {\r\n  return classNames(\r\n    'entry',\r\n    entry.className,\r\n    entry.active ? 'active' : '',\r\n    entry.disabled ? 'disabled' : '',\r\n    selected ? 'selected' : ''\r\n  );\r\n}","import {\r\n  render,\r\n  html\r\n} from '../../ui';\r\n\r\nimport {\r\n  domify,\r\n  remove as domRemove,\r\n  closest as domClosest,\r\n  attr as domAttr\r\n} from 'min-dom';\r\n\r\nimport {\r\n  forEach,\r\n  isFunction,\r\n  omit,\r\n  isDefined\r\n} from 'min-dash';\r\n\r\nimport PopupMenuComponent from './PopupMenuComponent';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('./PopupMenuProvider').PopupMenuEntries} PopupMenuEntries\r\n * @typedef {import('./PopupMenuProvider').PopupMenuEntry} PopupMenuEntry\r\n * @typedef {import('./PopupMenuProvider').PopupMenuHeaderEntries} PopupMenuHeaderEntries\r\n * @typedef {import('./PopupMenuProvider').PopupMenuHeaderEntry} PopupMenuHeaderEntry\r\n * @typedef {import('./PopupMenuProvider').default} PopupMenuProvider\r\n *\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef { {\r\n *   scale?: {\r\n *     min?: number;\r\n *     max?: number;\r\n *   } | boolean;\r\n * } } PopupMenuConfig\r\n *\r\n * @typedef {Element|Element[]} PopupMenuTarget;\r\n */\r\n\r\nvar DATA_REF = 'data-id';\r\n\r\nvar CLOSE_EVENTS = [\r\n  'contextPad.close',\r\n  'canvas.viewbox.changing',\r\n  'commandStack.changed'\r\n];\r\n\r\nvar DEFAULT_PRIORITY = 1000;\r\n\r\n/**\r\n * A popup menu to show a number of actions on the canvas.\r\n *\r\n * @param {PopupMenuConfig} config\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function PopupMenu(config, eventBus, canvas) {\r\n  this._eventBus = eventBus;\r\n  this._canvas = canvas;\r\n\r\n  this._current = null;\r\n\r\n  var scale = isDefined(config && config.scale) ? config.scale : {\r\n    min: 1,\r\n    max: 1\r\n  };\r\n\r\n  this._config = {\r\n    scale: scale\r\n  };\r\n\r\n\r\n  eventBus.on('diagram.destroy', () => {\r\n    this.close();\r\n  });\r\n\r\n  eventBus.on('element.changed', event => {\r\n\r\n    const element = this.isOpen() && this._current.target;\r\n\r\n    if (event.element === element) {\r\n      this.refresh();\r\n    }\r\n  });\r\n\r\n}\r\n\r\nPopupMenu.$inject = [\r\n  'config.popupMenu',\r\n  'eventBus',\r\n  'canvas'\r\n];\r\n\r\nPopupMenu.prototype._render = function() {\r\n\r\n  const {\r\n    position: _position,\r\n    providerId: className,\r\n    entries,\r\n    headerEntries,\r\n    emptyPlaceholder,\r\n    options\r\n  } = this._current;\r\n\r\n  const entriesArray = Object.entries(entries).map(\r\n    ([ key, value ]) => ({ id: key, ...value })\r\n  );\r\n\r\n  const headerEntriesArray = Object.entries(headerEntries).map(\r\n    ([ key, value ]) => ({ id: key, ...value })\r\n  );\r\n\r\n  const position = _position && (\r\n    (container) => this._ensureVisible(container, _position)\r\n  );\r\n\r\n  const scale = this._updateScale(this._current.container);\r\n\r\n  const onClose = result => this.close(result);\r\n  const onSelect = (event, entry, action) => this.trigger(event, entry, action);\r\n\r\n  render(\r\n    html`\r\n      <${PopupMenuComponent}\r\n        onClose=${ onClose }\r\n        onSelect=${ onSelect }\r\n        position=${ position }\r\n        className=${ className }\r\n        entries=${ entriesArray }\r\n        headerEntries=${ headerEntriesArray }\r\n        emptyPlaceholder=${ emptyPlaceholder }\r\n        scale=${ scale }\r\n        onOpened=${ this._onOpened.bind(this) }\r\n        onClosed=${ this._onClosed.bind(this) }\r\n        ...${{ ...options }}\r\n      />\r\n    `,\r\n    this._current.container\r\n  );\r\n};\r\n\r\n\r\n/**\r\n * Open the popup menu at the given position.\r\n *\r\n * @param {PopupMenuTarget} target\r\n * @param {string} providerId\r\n * @param {Point} position\r\n * @param {Object} [options]\r\n */\r\nPopupMenu.prototype.open = function(target, providerId, position, options) {\r\n  if (!target) {\r\n    throw new Error('target is missing');\r\n  }\r\n\r\n  if (!providerId) {\r\n    throw new Error('providers for <' + providerId + '> not found');\r\n  }\r\n\r\n  if (!position) {\r\n    throw new Error('position is missing');\r\n  }\r\n\r\n  if (this.isOpen()) {\r\n    this.close();\r\n  }\r\n\r\n  const {\r\n    entries,\r\n    headerEntries,\r\n    emptyPlaceholder\r\n  } = this._getContext(target, providerId);\r\n\r\n  this._current = {\r\n    position,\r\n    providerId,\r\n    target,\r\n    entries,\r\n    headerEntries,\r\n    emptyPlaceholder,\r\n    container: this._createContainer({ provider: providerId }),\r\n    options\r\n  };\r\n\r\n  this._emit('open');\r\n\r\n  this._bindAutoClose();\r\n\r\n  this._render();\r\n};\r\n\r\n/**\r\n * Refresh the popup menu entries without changing the target or position.\r\n */\r\nPopupMenu.prototype.refresh = function() {\r\n  if (!this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  const {\r\n    target,\r\n    providerId\r\n  } = this._current;\r\n\r\n  const {\r\n    entries,\r\n    headerEntries,\r\n    emptyPlaceholder\r\n  } = this._getContext(target, providerId);\r\n\r\n  this._current = {\r\n    ...this._current,\r\n    entries,\r\n    headerEntries,\r\n    emptyPlaceholder\r\n  };\r\n\r\n  this._emit('refresh');\r\n\r\n  this._render();\r\n};\r\n\r\n\r\nPopupMenu.prototype._getContext = function(target, provider) {\r\n\r\n  const providers = this._getProviders(provider);\r\n\r\n  if (!providers || !providers.length) {\r\n    throw new Error('provider for <' + provider + '> not found');\r\n  }\r\n\r\n  const entries = this._getEntries(target, providers);\r\n\r\n  const headerEntries = this._getHeaderEntries(target, providers);\r\n\r\n  const emptyPlaceholder = this._getEmptyPlaceholder(providers);\r\n\r\n  return {\r\n    entries,\r\n    headerEntries,\r\n    emptyPlaceholder,\r\n    empty: !(\r\n      Object.keys(entries).length ||\r\n          Object.keys(headerEntries).length\r\n    )\r\n  };\r\n};\r\n\r\nPopupMenu.prototype.close = function() {\r\n\r\n  if (!this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  this._emit('close');\r\n\r\n  this.reset();\r\n\r\n  this._current = null;\r\n};\r\n\r\nPopupMenu.prototype.reset = function() {\r\n  const container = this._current.container;\r\n\r\n  render(null, container);\r\n\r\n  domRemove(container);\r\n};\r\n\r\nPopupMenu.prototype._emit = function(event, payload) {\r\n  this._eventBus.fire(`popupMenu.${ event }`, payload);\r\n};\r\n\r\nPopupMenu.prototype._onOpened = function() {\r\n  this._emit('opened');\r\n};\r\n\r\nPopupMenu.prototype._onClosed = function() {\r\n  this._emit('closed');\r\n};\r\n\r\nPopupMenu.prototype._createContainer = function(config) {\r\n\r\n  var canvas = this._canvas,\r\n      parent = canvas.getContainer();\r\n\r\n  const container = domify(`<div class=\"djs-popup-parent djs-scrollable\" data-popup=${config.provider}></div>`);\r\n\r\n  parent.appendChild(container);\r\n\r\n  return container;\r\n};\r\n\r\n/**\r\n * Set up listener to close popup automatically on certain events.\r\n */\r\nPopupMenu.prototype._bindAutoClose = function() {\r\n  this._eventBus.once(CLOSE_EVENTS, this.close, this);\r\n};\r\n\r\n\r\n/**\r\n * Remove the auto-closing listener.\r\n*/\r\nPopupMenu.prototype._unbindAutoClose = function() {\r\n  this._eventBus.off(CLOSE_EVENTS, this.close, this);\r\n};\r\n\r\n\r\n/**\r\n * Updates popup style.transform with respect to the config and zoom level.\r\n *\r\n * @return {number}\r\n */\r\nPopupMenu.prototype._updateScale = function() {\r\n  var zoom = this._canvas.zoom();\r\n\r\n  var scaleConfig = this._config.scale,\r\n      minScale,\r\n      maxScale,\r\n      scale = zoom;\r\n\r\n  if (scaleConfig !== true) {\r\n\r\n    if (scaleConfig === false) {\r\n      minScale = 1;\r\n      maxScale = 1;\r\n    } else {\r\n      minScale = scaleConfig.min;\r\n      maxScale = scaleConfig.max;\r\n    }\r\n\r\n    if (isDefined(minScale) && zoom < minScale) {\r\n      scale = minScale;\r\n    }\r\n\r\n    if (isDefined(maxScale) && zoom > maxScale) {\r\n      scale = maxScale;\r\n    }\r\n\r\n  }\r\n\r\n  return scale;\r\n};\r\n\r\nPopupMenu.prototype._ensureVisible = function(container, position) {\r\n  var documentBounds = document.documentElement.getBoundingClientRect();\r\n  var containerBounds = container.getBoundingClientRect();\r\n\r\n  var overAxis = {},\r\n      left = position.x,\r\n      top = position.y;\r\n\r\n  if (position.x + containerBounds.width > documentBounds.width) {\r\n    overAxis.x = true;\r\n  }\r\n\r\n  if (position.y + containerBounds.height > documentBounds.height) {\r\n    overAxis.y = true;\r\n  }\r\n\r\n  if (overAxis.x && overAxis.y) {\r\n    left = position.x - containerBounds.width;\r\n    top = position.y - containerBounds.height;\r\n  } else if (overAxis.x) {\r\n    left = position.x - containerBounds.width;\r\n    top = position.y;\r\n  } else if (overAxis.y && position.y < containerBounds.height) {\r\n    left = position.x;\r\n    top = 10;\r\n  } else if (overAxis.y) {\r\n    left = position.x;\r\n    top = position.y - containerBounds.height;\r\n  }\r\n\r\n  // underAxis\r\n  if (position.y < documentBounds.top) {\r\n    top = position.y + containerBounds.height;\r\n  }\r\n\r\n  return {\r\n    x: left,\r\n    y: top\r\n  };\r\n};\r\n\r\n/**\r\n * Check whether there are no popup menu providers or provided entries for the\r\n * given target.\r\n *\r\n * @param {PopupMenuTarget} target\r\n * @param {string} providerId\r\n *\r\n * @return {boolean}\r\n */\r\nPopupMenu.prototype.isEmpty = function(target, providerId) {\r\n  if (!target) {\r\n    throw new Error('target is missing');\r\n  }\r\n\r\n  if (!providerId) {\r\n    throw new Error('provider ID is missing');\r\n  }\r\n\r\n  const providers = this._getProviders(providerId);\r\n\r\n  if (!providers || !providers.length) {\r\n    return true;\r\n  }\r\n\r\n  return this._getContext(target, providerId).empty;\r\n};\r\n\r\n/**\r\n * @overlord\r\n *\r\n * Register a popup menu provider with default priority. See\r\n * {@link PopupMenuProvider} for examples.\r\n *\r\n * @param {string} id\r\n * @param {PopupMenuProvider} provider\r\n */\r\n\r\n/**\r\n * Register a popup menu provider with the given priority. See\r\n * {@link PopupMenuProvider} for examples.\r\n *\r\n * @param {string} id\r\n * @param {number} priority\r\n * @param {PopupMenuProvider} provider\r\n */\r\nPopupMenu.prototype.registerProvider = function(id, priority, provider) {\r\n  if (!provider) {\r\n    provider = priority;\r\n    priority = DEFAULT_PRIORITY;\r\n  }\r\n\r\n  this._eventBus.on('popupMenu.getProviders.' + id, priority, function(event) {\r\n    event.providers.push(provider);\r\n  });\r\n};\r\n\r\n/**\r\n * @param {string} id\r\n *\r\n * @return {PopupMenuProvider[]}\r\n */\r\nPopupMenu.prototype._getProviders = function(id) {\r\n  var event = this._eventBus.createEvent({\r\n    type: 'popupMenu.getProviders.' + id,\r\n    providers: []\r\n  });\r\n\r\n  this._eventBus.fire(event);\r\n\r\n  return event.providers;\r\n};\r\n\r\n/**\r\n * @param {PopupMenuTarget} target\r\n * @param {PopupMenuProvider[]} providers\r\n *\r\n * @return {PopupMenuEntries}\r\n */\r\nPopupMenu.prototype._getEntries = function(target, providers) {\r\n  var entries = {};\r\n\r\n  forEach(providers, function(provider) {\r\n\r\n    // handle legacy method\r\n    if (!provider.getPopupMenuEntries) {\r\n      forEach(provider.getEntries(target), function(entry) {\r\n        var id = entry.id;\r\n\r\n        if (!id) {\r\n          throw new Error('entry ID is missing');\r\n        }\r\n\r\n        entries[id] = omit(entry, [ 'id' ]);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    var entriesOrUpdater = provider.getPopupMenuEntries(target);\r\n\r\n    if (isFunction(entriesOrUpdater)) {\r\n      entries = entriesOrUpdater(entries);\r\n    } else {\r\n      forEach(entriesOrUpdater, function(entry, id) {\r\n        entries[id] = entry;\r\n      });\r\n    }\r\n  });\r\n\r\n  return entries;\r\n};\r\n\r\n/**\r\n * @param {PopupMenuTarget} target\r\n * @param {PopupMenuProvider[]} providers\r\n *\r\n * @return {PopupMenuHeaderEntries}\r\n */\r\nPopupMenu.prototype._getHeaderEntries = function(target, providers) {\r\n  var entries = {};\r\n\r\n  forEach(providers, function(provider) {\r\n\r\n    // handle legacy method\r\n    if (!provider.getPopupMenuHeaderEntries) {\r\n      if (!provider.getHeaderEntries) {\r\n        return;\r\n      }\r\n\r\n      forEach(provider.getHeaderEntries(target), function(entry) {\r\n        var id = entry.id;\r\n\r\n        if (!id) {\r\n          throw new Error('entry ID is missing');\r\n        }\r\n\r\n        entries[id] = omit(entry, [ 'id' ]);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    var entriesOrUpdater = provider.getPopupMenuHeaderEntries(target);\r\n\r\n    if (isFunction(entriesOrUpdater)) {\r\n      entries = entriesOrUpdater(entries);\r\n    } else {\r\n      forEach(entriesOrUpdater, function(entry, id) {\r\n        entries[id] = entry;\r\n      });\r\n    }\r\n  });\r\n\r\n  return entries;\r\n};\r\n\r\n\r\nPopupMenu.prototype._getEmptyPlaceholder = function(providers) {\r\n\r\n  const provider = providers.find(\r\n    provider => isFunction(provider.getEmptyPlaceholder)\r\n  );\r\n\r\n  return provider && provider.getEmptyPlaceholder();\r\n};\r\n\r\n\r\n/**\r\n * Check if the popup menu is open.\r\n *\r\n * @return {boolean}\r\n */\r\nPopupMenu.prototype.isOpen = function() {\r\n  return !!this._current;\r\n};\r\n\r\n\r\n/**\r\n * Trigger an action associated with an entry.\r\n *\r\n * @param {Event} event\r\n * @param {PopupMenuEntry} entry\r\n * @param {string} [action='click']\r\n *\r\n * @return {any}\r\n */\r\nPopupMenu.prototype.trigger = function(event, entry, action = 'click') {\r\n\r\n  // silence other actions\r\n  event.preventDefault();\r\n\r\n  if (!entry) {\r\n    let element = domClosest(event.delegateTarget || event.target, '.entry', true);\r\n    let entryId = domAttr(element, DATA_REF);\r\n\r\n    entry = { id: entryId, ...this._getEntry(entryId) };\r\n  }\r\n\r\n  const handler = entry.action;\r\n\r\n  if (this._emit('trigger', { entry, event }) === false) {\r\n    return;\r\n  }\r\n\r\n  if (isFunction(handler)) {\r\n    if (action === 'click') {\r\n      return handler(event, entry);\r\n    }\r\n  } else {\r\n    if (handler[action]) {\r\n      return handler[action](event, entry);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Get the entry (entry or header entry) with the given ID.\r\n *\r\n * @param {string} entryId\r\n *\r\n * @return {PopupMenuEntry|PopupMenuHeaderEntry}\r\n */\r\nPopupMenu.prototype._getEntry = function(entryId) {\r\n\r\n  var entry = this._current.entries[ entryId ] || this._current.headerEntries[ entryId ];\r\n\r\n\r\n  if (!entry) {\r\n    throw new Error('entry not found');\r\n  }\r\n\r\n  return entry;\r\n};","import PopupMenu from './PopupMenu';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'popupMenu' ],\r\n  popupMenu: [ 'type', PopupMenu ]\r\n};\r\n","/**\n * To change the icons, modify the SVGs in `./resources`, execute `npx svgo -f resources --datauri enc -o dist`,\n * and then replace respective icons with the optimized data URIs in `./dist`.\n */\nvar icons = {\n  align:  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2000 2000\">\n              <line x1=\"200\" y1=\"150\" x2=\"200\" y2=\"1850\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n              <rect x=\"500\" y=\"150\" width=\"1300\" height=\"700\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n              <rect x=\"500\" y=\"1150\" width=\"700\" height=\"700\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  bottom: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"150\" y1=\"1650\" x2=\"1650\" y2=\"1650\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"150\" y=\"350\" width=\"600\" height=\"1300\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"1050\" y=\"850\" width=\"600\" height=\"800\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  center: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"900\" y1=\"150\" x2=\"900\" y2=\"1650\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"250\" y=\"150\" width=\"1300\" height=\"600\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"500\" y=\"1050\" width=\"800\" height=\"600\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  left:   `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"100\" y1=\"150\" x2=\"100\" y2=\"1650\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"100\" y=\"150\" width=\"1300\" height=\"600\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"100\" y=\"1050\" width=\"800\" height=\"600\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  right:  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"1650\" y1=\"150\" x2=\"1650\" y2=\"1650\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"350\" y=\"150\" width=\"1300\" height=\"600\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"850\" y=\"1050\" width=\"800\" height=\"600\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  top:    `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"150\" y1=\"150\" x2=\"1650\" y2=\"150\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"150\" y=\"150\" width=\"600\" height=\"1300\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"1050\" y=\"150\" width=\"600\" height=\"800\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  middle: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"150\" y1=\"900\" x2=\"1650\" y2=\"900\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"150\" y=\"250\" width=\"600\" height=\"1300\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"1050\" y=\"500\" width=\"600\" height=\"800\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`\n};\n\nexport default icons;\n","import {\n  assign\n} from 'min-dash';\n\nimport ICONS from './AlignElementsIcons';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPad').default} ContextPad\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPad').ContextPadEntries} ContextPadEntries\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPadProvider').default} ContextPadProvider\n */\n\nvar LOW_PRIORITY = 900;\n\n/**\n * A provider for the `Align elements` context pad entry.\n *\n * @implements {ContextPadProvider}\n *\n * @param {ContextPad} contextPad\n * @param {PopupMenu} popupMenu\n * @param {Translate} translate\n * @param {Canvas} canvas\n */\nexport default function AlignElementsContextPadProvider(contextPad, popupMenu, translate, canvas) {\n\n  contextPad.registerProvider(LOW_PRIORITY, this);\n\n  this._contextPad = contextPad;\n  this._popupMenu = popupMenu;\n  this._translate = translate;\n  this._canvas = canvas;\n}\n\nAlignElementsContextPadProvider.$inject = [\n  'contextPad',\n  'popupMenu',\n  'translate',\n  'canvas'\n];\n\n/**\n * @param {Element[]} elements\n *\n * @return {ContextPadEntries}\n */\nAlignElementsContextPadProvider.prototype.getMultiElementContextPadEntries = function(elements) {\n  var actions = {};\n\n  if (this._isAllowed(elements)) {\n    assign(actions, this._getEntries(elements));\n  }\n\n  return actions;\n};\n\nAlignElementsContextPadProvider.prototype._isAllowed = function(elements) {\n  return !this._popupMenu.isEmpty(elements, 'align-elements');\n};\n\nAlignElementsContextPadProvider.prototype._getEntries = function() {\n  var self = this;\n\n  return {\n    'align-elements': {\n      group: 'align-elements',\n      title: self._translate('Align elements'),\n      html: `<div class=\"entry\">${ICONS['align']}</div>`,\n      action: {\n        click: function(event, target) {\n          var position = self._getMenuPosition(target);\n\n          assign(position, {\n            cursor: {\n              x: event.x,\n              y: event.y\n            }\n          });\n\n          self._popupMenu.open(target, 'align-elements', position);\n        }\n      }\n    }\n  };\n};\n\nAlignElementsContextPadProvider.prototype._getMenuPosition = function(elements) {\n  var Y_OFFSET = 5;\n\n  var pad = this._contextPad.getPad(elements).html;\n\n  var padRect = pad.getBoundingClientRect();\n\n  var pos = {\n    x: padRect.left,\n    y: padRect.bottom + Y_OFFSET\n  };\n\n  return pos;\n};\n","import ICONS from './AlignElementsIcons';\n\nimport {\n  assign,\n  forEach,\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/features/align-elements/AlignElements').default} AlignElements\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuEntries} PopupMenuEntries\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').default} PopupMenuProvider\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n */\n\nvar ALIGNMENT_OPTIONS = [\n  'left',\n  'center',\n  'right',\n  'top',\n  'middle',\n  'bottom'\n];\n\n/**\n * A provider for the `Align elements` popup menu.\n *\n * @implements {PopupMenuProvider}\n *\n * @param {PopupMenu} popupMenu\n * @param {AlignElements} alignElements\n * @param {Translate} translate\n * @param {Rules} rules\n */\nexport default function AlignElementsMenuProvider(popupMenu, alignElements, translate, rules) {\n\n  this._alignElements = alignElements;\n  this._translate = translate;\n  this._popupMenu = popupMenu;\n  this._rules = rules;\n\n  popupMenu.registerProvider('align-elements', this);\n}\n\nAlignElementsMenuProvider.$inject = [\n  'popupMenu',\n  'alignElements',\n  'translate',\n  'rules'\n];\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuEntries}\n */\nAlignElementsMenuProvider.prototype.getPopupMenuEntries = function(target) {\n  var entries = {};\n\n  if (this._isAllowed(target)) {\n    assign(entries, this._getEntries(target));\n  }\n\n  return entries;\n};\n\nAlignElementsMenuProvider.prototype._isAllowed = function(target) {\n  return this._rules.allowed('elements.align', { elements: target });\n};\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuEntries}\n */\nAlignElementsMenuProvider.prototype._getEntries = function(target) {\n  var alignElements = this._alignElements,\n      translate = this._translate,\n      popupMenu = this._popupMenu;\n\n  var entries = {};\n\n  forEach(ALIGNMENT_OPTIONS, function(alignment) {\n    entries[ 'align-elements-' + alignment ] = {\n      group: 'align',\n      title: translate('Align elements ' + alignment),\n      className: 'bjs-align-elements-menu-entry',\n      imageHtml: ICONS[ alignment ],\n      action: function() {\n        alignElements.trigger(target, alignment);\n        popupMenu.close();\n      }\n    };\n  });\n\n  return entries;\n};\n","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from '../../command/CommandInterceptor';\r\n\r\n/**\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * A basic provider that may be extended to implement modeling rules.\r\n *\r\n * Extensions should implement the init method to actually add their custom\r\n * modeling checks. Checks may be added via the #addRule(action, fn) method.\r\n *\r\n * @class\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function RuleProvider(eventBus) {\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  this.init();\r\n}\r\n\r\nRuleProvider.$inject = [ 'eventBus' ];\r\n\r\ninherits(RuleProvider, CommandInterceptor);\r\n\r\n\r\n/**\r\n * Adds a modeling rule for the given action, implemented through\r\n * a callback function.\r\n *\r\n * The callback receives a modeling specific action context\r\n * to perform its check. It must return `false` to disallow the\r\n * action from happening or `true` to allow the action. Usually returing\r\n * `null` denotes that a particular interaction shall be ignored.\r\n * By returning nothing or `undefined` you pass evaluation to lower\r\n * priority rules.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * ResizableRules.prototype.init = function() {\r\n *\r\n *   \\/**\r\n *    * Return `true`, `false` or nothing to denote\r\n *    * _allowed_, _not allowed_ and _continue evaluating_.\r\n *    *\\/\r\n *   this.addRule('shape.resize', function(context) {\r\n *\r\n *     var shape = context.shape;\r\n *\r\n *     if (!context.newBounds) {\r\n *       // check general resizability\r\n *       if (!shape.resizable) {\r\n *         return false;\r\n *       }\r\n *\r\n *       // not returning anything (read: undefined)\r\n *       // will continue the evaluation of other rules\r\n *       // (with lower priority)\r\n *       return;\r\n *     } else {\r\n *       // element must have minimum size of 10*10 points\r\n *       return context.newBounds.width > 10 && context.newBounds.height > 10;\r\n *     }\r\n *   });\r\n * };\r\n * ```\r\n *\r\n * @param {string|string[]} actions the identifier for the modeling action to check\r\n * @param {number} [priority] the priority at which this rule is being applied\r\n * @param {(any) => any} fn the callback function that performs the actual check\r\n */\r\nRuleProvider.prototype.addRule = function(actions, priority, fn) {\r\n\r\n  var self = this;\r\n\r\n  if (typeof actions === 'string') {\r\n    actions = [ actions ];\r\n  }\r\n\r\n  actions.forEach(function(action) {\r\n\r\n    self.canExecute(action, priority, function(context, action, event) {\r\n      return fn(context);\r\n    }, true);\r\n  });\r\n};\r\n\r\n/**\r\n * Implement this method to add new rules during provider initialization.\r\n */\r\nRuleProvider.prototype.init = function() {};","import inherits from 'inherits-browser';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\nimport { getParents } from 'diagram-js/lib/util/Elements';\n\nimport {\n  filter\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * Rule provider for aligning BPMN elements.\n *\n * @param {EventBus} eventBus\n */\nexport default function BpmnAlignElements(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\nBpmnAlignElements.$inject = [ 'eventBus' ];\n\ninherits(BpmnAlignElements, RuleProvider);\n\nBpmnAlignElements.prototype.init = function() {\n  this.addRule('elements.align', function(context) {\n    var elements = context.elements;\n\n    // filter out elements which cannot be aligned\n    var filteredElements = filter(elements, function(element) {\n      return !(element.waypoints || element.host || element.labelTarget);\n    });\n\n    // filter out elements which are children of any of the selected elements\n    filteredElements = getParents(filteredElements);\n\n    if (filteredElements.length < 2) {\n      return false;\n    }\n\n    return filteredElements;\n  });\n};\n","import AlignElementsModule from 'diagram-js/lib/features/align-elements';\nimport ContextPadModule from 'diagram-js/lib/features/context-pad';\nimport PopupMenuModule from 'diagram-js/lib/features/popup-menu';\n\nimport AlignElementsContextPadProvider from './AlignElementsContextPadProvider';\nimport AlignElementsMenuProvider from './AlignElementsMenuProvider';\nimport BpmnAlignElements from './BpmnAlignElements';\n\nexport default {\n  __depends__: [\n    AlignElementsModule,\n    ContextPadModule,\n    PopupMenuModule\n  ],\n  __init__: [\n    'alignElementsContextPadProvider',\n    'alignElementsMenuProvider',\n    'bpmnAlignElements'\n  ],\n  alignElementsContextPadProvider: [ 'type', AlignElementsContextPadProvider ],\n  alignElementsMenuProvider: [ 'type', AlignElementsMenuProvider ],\n  bpmnAlignElements: [ 'type', BpmnAlignElements ]\n};\n","import {\r\n  asTRBL,\r\n  getOrientation,\r\n  getMid\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport {\r\n  find,\r\n  reduce\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Connection} Connection\r\n * @typedef {import('../../model/Types').Element} Element\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n */\r\n\r\n// padding to detect element placement\r\nvar PLACEMENT_DETECTION_PAD = 10;\r\n\r\nexport var DEFAULT_DISTANCE = 50;\r\n\r\nvar DEFAULT_MAX_DISTANCE = 250;\r\n\r\n\r\n/**\r\n * Get free position starting from given position.\r\n *\r\n * @param {Shape} source\r\n * @param {Shape} element\r\n * @param {Point} position\r\n * @param {(element: Element, position: Point, connectedAtPosition: Element) => Point} getNextPosition\r\n *\r\n * @return {Point}\r\n */\r\nexport function findFreePosition(source, element, position, getNextPosition) {\r\n  var connectedAtPosition;\r\n\r\n  while ((connectedAtPosition = getConnectedAtPosition(source, position, element))) {\r\n    position = getNextPosition(element, position, connectedAtPosition);\r\n  }\r\n\r\n  return position;\r\n}\r\n\r\n/**\r\n * Returns function that returns next position.\r\n *\r\n * @param {Object} nextPositionDirection\r\n * @param {Object} [nextPositionDirection.x]\r\n * @param {Object} [nextPositionDirection.y]\r\n *\r\n * @return {(element: Element, previousPosition: Point, connectedAtPosition: Element) => Point}\r\n */\r\nexport function generateGetNextPosition(nextPositionDirection) {\r\n  return function(element, previousPosition, connectedAtPosition) {\r\n    var nextPosition = {\r\n      x: previousPosition.x,\r\n      y: previousPosition.y\r\n    };\r\n\r\n    [ 'x', 'y' ].forEach(function(axis) {\r\n\r\n      var nextPositionDirectionForAxis = nextPositionDirection[ axis ];\r\n\r\n      if (!nextPositionDirectionForAxis) {\r\n        return;\r\n      }\r\n\r\n      var dimension = axis === 'x' ? 'width' : 'height';\r\n\r\n      var margin = nextPositionDirectionForAxis.margin,\r\n          minDistance = nextPositionDirectionForAxis.minDistance;\r\n\r\n      if (margin < 0) {\r\n        nextPosition[ axis ] = Math.min(\r\n          connectedAtPosition[ axis ] + margin - element[ dimension ] / 2,\r\n          previousPosition[ axis ] - minDistance + margin\r\n        );\r\n      } else {\r\n        nextPosition[ axis ] = Math.max(\r\n          connectedAtPosition[ axis ] + connectedAtPosition[ dimension ] + margin + element[ dimension ] / 2,\r\n          previousPosition[ axis ] + minDistance + margin\r\n        );\r\n      }\r\n    });\r\n\r\n    return nextPosition;\r\n  };\r\n}\r\n\r\n/**\r\n * Return connected element at given position and within given bounds. Takes\r\n * connected elements from host and attachers into account, too.\r\n *\r\n * @param {Shape} source\r\n * @param {Point} position\r\n * @param {Shape} element\r\n *\r\n * @return {Shape|undefined}\r\n */\r\nexport function getConnectedAtPosition(source, position, element) {\r\n\r\n  var bounds = {\r\n    x: position.x - (element.width / 2),\r\n    y: position.y - (element.height / 2),\r\n    width: element.width,\r\n    height: element.height\r\n  };\r\n\r\n  var closure = getAutoPlaceClosure(source);\r\n\r\n  return find(closure, function(target) {\r\n\r\n    if (target === element) {\r\n      return false;\r\n    }\r\n\r\n    var orientation = getOrientation(target, bounds, PLACEMENT_DETECTION_PAD);\r\n\r\n    return orientation === 'intersect';\r\n  });\r\n}\r\n\r\n/**\r\n* Compute optimal distance between source and target based on existing connections to and from source.\r\n* Assumes left-to-right and top-to-down modeling.\r\n*\r\n* @param {Shape} source\r\n* @param {Object} [hints]\r\n* @param {number} [hints.defaultDistance]\r\n* @param {string} [hints.direction]\r\n* @param {(connection: Connection) => boolean} [hints.filter]\r\n* @param {(connection: Connection) => number} [hints.getWeight]\r\n* @param {number} [hints.maxDistance]\r\n* @param {'start'|'center'|'end'} [hints.reference]\r\n*\r\n* @return {number}\r\n*/\r\nexport function getConnectedDistance(source, hints) {\r\n  if (!hints) {\r\n    hints = {};\r\n  }\r\n\r\n  // targets > sources by default\r\n  function getDefaultWeight(connection) {\r\n    return connection.source === source ? 1 : -1;\r\n  }\r\n\r\n  var defaultDistance = hints.defaultDistance || DEFAULT_DISTANCE,\r\n      direction = hints.direction || 'e',\r\n      filter = hints.filter,\r\n      getWeight = hints.getWeight || getDefaultWeight,\r\n      maxDistance = hints.maxDistance || DEFAULT_MAX_DISTANCE,\r\n      reference = hints.reference || 'start';\r\n\r\n  if (!filter) {\r\n    filter = noneFilter;\r\n  }\r\n\r\n  function getDistance(a, b) {\r\n    if (direction === 'n') {\r\n      if (reference === 'start') {\r\n        return asTRBL(a).top - asTRBL(b).bottom;\r\n      } else if (reference === 'center') {\r\n        return asTRBL(a).top - getMid(b).y;\r\n      } else {\r\n        return asTRBL(a).top - asTRBL(b).top;\r\n      }\r\n    } else if (direction === 'w') {\r\n      if (reference === 'start') {\r\n        return asTRBL(a).left - asTRBL(b).right;\r\n      } else if (reference === 'center') {\r\n        return asTRBL(a).left - getMid(b).x;\r\n      } else {\r\n        return asTRBL(a).left - asTRBL(b).left;\r\n      }\r\n    } else if (direction === 's') {\r\n      if (reference === 'start') {\r\n        return asTRBL(b).top - asTRBL(a).bottom;\r\n      } else if (reference === 'center') {\r\n        return getMid(b).y - asTRBL(a).bottom;\r\n      } else {\r\n        return asTRBL(b).bottom - asTRBL(a).bottom;\r\n      }\r\n    } else {\r\n      if (reference === 'start') {\r\n        return asTRBL(b).left - asTRBL(a).right;\r\n      } else if (reference === 'center') {\r\n        return getMid(b).x - asTRBL(a).right;\r\n      } else {\r\n        return asTRBL(b).right - asTRBL(a).right;\r\n      }\r\n    }\r\n  }\r\n\r\n  var sourcesDistances = source.incoming\r\n    .filter(filter)\r\n    .map(function(connection) {\r\n      var weight = getWeight(connection);\r\n\r\n      var distance = weight < 0\r\n        ? getDistance(connection.source, source)\r\n        : getDistance(source, connection.source);\r\n\r\n      return {\r\n        id: connection.source.id,\r\n        distance: distance,\r\n        weight: weight\r\n      };\r\n    });\r\n\r\n  var targetsDistances = source.outgoing\r\n    .filter(filter)\r\n    .map(function(connection) {\r\n      var weight = getWeight(connection);\r\n\r\n      var distance = weight > 0\r\n        ? getDistance(source, connection.target)\r\n        : getDistance(connection.target, source);\r\n\r\n      return {\r\n        id: connection.target.id,\r\n        distance: distance,\r\n        weight: weight\r\n      };\r\n    });\r\n\r\n  var distances = sourcesDistances.concat(targetsDistances).reduce(function(accumulator, currentValue) {\r\n    accumulator[ currentValue.id + '__weight_' + currentValue.weight ] = currentValue;\r\n\r\n    return accumulator;\r\n  }, {});\r\n\r\n  var distancesGrouped = reduce(distances, function(accumulator, currentValue) {\r\n    var distance = currentValue.distance,\r\n        weight = currentValue.weight;\r\n\r\n    if (distance < 0 || distance > maxDistance) {\r\n      return accumulator;\r\n    }\r\n\r\n    if (!accumulator[ String(distance) ]) {\r\n      accumulator[ String(distance) ] = 0;\r\n    }\r\n\r\n    accumulator[ String(distance) ] += 1 * weight;\r\n\r\n    if (!accumulator.distance || accumulator[ accumulator.distance ] < accumulator[ String(distance) ]) {\r\n      accumulator.distance = distance;\r\n    }\r\n\r\n    return accumulator;\r\n  }, {});\r\n\r\n  return distancesGrouped.distance || defaultDistance;\r\n}\r\n\r\n/**\r\n * Returns all elements connected to given source.\r\n *\r\n * This includes:\r\n *\r\n *   - elements connected to source\r\n *   - elements connected to host if source is an attacher\r\n *   - elements connected to attachers if source is a host\r\n *\r\n * @param {Shape} source\r\n *\r\n * @return {Shape[]}\r\n */\r\nfunction getAutoPlaceClosure(source) {\r\n\r\n  var allConnected = getConnected(source);\r\n\r\n  if (source.host) {\r\n    allConnected = allConnected.concat(getConnected(source.host));\r\n  }\r\n\r\n  if (source.attachers) {\r\n    allConnected = allConnected.concat(source.attachers.reduce(function(shapes, attacher) {\r\n      return shapes.concat(getConnected(attacher));\r\n    }, []));\r\n  }\r\n\r\n  return allConnected;\r\n}\r\n\r\n/**\r\n * Get all connected elements.\r\n *\r\n * @param {Shape} element\r\n *\r\n * @returns {Shape[]}\r\n */\r\nfunction getConnected(element) {\r\n  return getTargets(element).concat(getSources(element));\r\n}\r\n\r\nfunction getSources(shape) {\r\n  return shape.incoming.map(function(connection) {\r\n    return connection.source;\r\n  });\r\n}\r\n\r\nfunction getTargets(shape) {\r\n  return shape.outgoing.map(function(connection) {\r\n    return connection.target;\r\n  });\r\n}\r\n\r\nfunction noneFilter() {\r\n  return true;\r\n}\r\n","import {\r\n  asTRBL,\r\n  getMid\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport { DEFAULT_DISTANCE } from './AutoPlaceUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n */\r\n\r\nvar LOW_PRIORITY = 100;\r\n\r\n\r\n/**\r\n * A service that places elements connected to existing ones\r\n * to an appropriate position in an _automated_ fashion.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n * @param {Canvas} canvas\r\n */\r\nexport default function AutoPlace(eventBus, modeling, canvas) {\r\n\r\n  eventBus.on('autoPlace', LOW_PRIORITY, function(context) {\r\n    var shape = context.shape,\r\n        source = context.source;\r\n\r\n    return getNewShapePosition(source, shape);\r\n  });\r\n\r\n  eventBus.on('autoPlace.end', function(event) {\r\n    canvas.scrollToElement(event.shape);\r\n  });\r\n\r\n  /**\r\n   * Append shape to source at appropriate position.\r\n   *\r\n   * @param {Shape} source\r\n   * @param {Shape} shape\r\n   * @param {any} [hints={}]\r\n   *\r\n   * @return {Shape} appended shape\r\n   */\r\n  this.append = function(source, shape, hints) {\r\n\r\n    eventBus.fire('autoPlace.start', {\r\n      source: source,\r\n      shape: shape\r\n    });\r\n\r\n    // allow others to provide the position\r\n    var position = eventBus.fire('autoPlace', {\r\n      source: source,\r\n      shape: shape\r\n    });\r\n\r\n    var newShape = modeling.appendShape(source, shape, position, source.parent, hints);\r\n\r\n    eventBus.fire('autoPlace.end', {\r\n      source: source,\r\n      shape: newShape\r\n    });\r\n\r\n    return newShape;\r\n  };\r\n\r\n}\r\n\r\nAutoPlace.$inject = [\r\n  'eventBus',\r\n  'modeling',\r\n  'canvas'\r\n];\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * Find the new position for the target element to\r\n * connect to source.\r\n *\r\n * @param {Shape} source\r\n * @param {Shape} element\r\n * @param {Object} [hints]\r\n * @param {Object} [hints.defaultDistance]\r\n *\r\n * @return {Point}\r\n */\r\nfunction getNewShapePosition(source, element, hints) {\r\n  if (!hints) {\r\n    hints = {};\r\n  }\r\n\r\n  var distance = hints.defaultDistance || DEFAULT_DISTANCE;\r\n\r\n  var sourceMid = getMid(source),\r\n      sourceTrbl = asTRBL(source);\r\n\r\n  // simply put element right next to source\r\n  return {\r\n    x: sourceTrbl.right + distance + element.width / 2,\r\n    y: sourceMid.y\r\n  };\r\n}","/**\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../selection/Selection').default} Selection\r\n */\r\n\r\n/**\r\n * Select element after auto placement.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Selection} selection\r\n */\r\nexport default function AutoPlaceSelectionBehavior(eventBus, selection) {\r\n\r\n  eventBus.on('autoPlace.end', 500, function(e) {\r\n    selection.select(e.shape);\r\n  });\r\n\r\n}\r\n\r\nAutoPlaceSelectionBehavior.$inject = [\r\n  'eventBus',\r\n  'selection'\r\n];","import AutoPlace from './AutoPlace';\r\nimport AutoPlaceSelectionBehavior from './AutoPlaceSelectionBehavior';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'autoPlaceSelectionBehavior' ],\r\n  autoPlace: [ 'type', AutoPlace ],\r\n  autoPlaceSelectionBehavior: [ 'type', AutoPlaceSelectionBehavior ]\r\n};","import { isString } from 'min-dash';\n\nexport { is, isAny } from '../../../util/ModelUtil';\n\nimport { isAny } from '../../../util/ModelUtil';\n\nimport { isHorizontal } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('../../../model/Types').Element} Element\n */\n\n/**\n * Return the parent of the element with any of the given types.\n *\n * @param {Element} element\n * @param {string|string[]} anyType\n *\n * @return {Element|null}\n */\nexport function getParent(element, anyType) {\n\n  if (isString(anyType)) {\n    anyType = [ anyType ];\n  }\n\n  while ((element = element.parent)) {\n    if (isAny(element, anyType)) {\n      return element;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Determines if the local modeling direction is vertical or horizontal.\n *\n * @param {Element} element\n *\n * @return {boolean} false for vertical pools, lanes and their children. true otherwise\n */\nexport function isDirectionHorizontal(element) {\n\n  var types = [ 'bpmn:Participant', 'bpmn:Lane' ];\n\n  var parent = getParent(element, types);\n  if (parent) {\n    return isHorizontal(parent);\n  } else if (isAny(element, types)) {\n    return isHorizontal(element);\n  }\n\n  return true;\n}","import { is } from '../../util/ModelUtil';\n\nimport {\n  isAny,\n  isDirectionHorizontal\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  getMid,\n  asTRBL,\n  getOrientation\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  findFreePosition,\n  generateGetNextPosition,\n  getConnectedDistance\n} from 'diagram-js/lib/features/auto-place/AutoPlaceUtil';\n\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\n\n/**\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\n */\n\n/**\n * Get the position for given new target relative to the source it will be\n * connected to.\n *\n * @param  {Shape} source\n * @param  {Shape} element\n *\n * @return {Point}\n */\nexport function getNewShapePosition(source, element) {\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n    return getTextAnnotationPosition(source, element);\n  }\n\n  if (isAny(element, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ])) {\n    return getDataElementPosition(source, element);\n  }\n\n  if (is(element, 'bpmn:FlowNode')) {\n    return getFlowNodePosition(source, element);\n  }\n}\n\n/**\n * Get the position for given new flow node. Try placing the flow node right/bottom of\n * the source.\n *\n * @param {Shape} source\n * @param {Shape} element\n *\n * @return {Point}\n */\nexport function getFlowNodePosition(source, element) {\n\n  var sourceTrbl = asTRBL(source);\n  var sourceMid = getMid(source);\n\n  var placeHorizontally = isDirectionHorizontal(source);\n\n  var placement = placeHorizontally ? {\n    directionHint: 'e',\n    minDistance: 80,\n    baseOrientation: 'left',\n    boundaryOrientation: 'top',\n    start: 'top',\n    end: 'bottom'\n  } : {\n    directionHint: 's',\n    minDistance: 90,\n    baseOrientation: 'top',\n    boundaryOrientation: 'left',\n    start: 'left',\n    end: 'right'\n  };\n\n  var connectedDistance = getConnectedDistance(source, {\n    filter: function(connection) {\n      return is(connection, 'bpmn:SequenceFlow');\n    },\n    direction: placement.directionHint\n  });\n\n  var margin = 30,\n      minDistance = placement.minDistance,\n      orientation = placement.baseOrientation;\n\n  if (is(source, 'bpmn:BoundaryEvent')) {\n    orientation = getOrientation(source, source.host, -25);\n\n    if (orientation.indexOf(placement.boundaryOrientation) !== -1) {\n      margin *= -1;\n    }\n  }\n\n  var position = placeHorizontally ? {\n    x: sourceTrbl.right + connectedDistance + element.width / 2,\n    y: sourceMid.y + getDistance(orientation, minDistance, placement)\n  } : {\n    x: sourceMid.x + getDistance(orientation, minDistance, placement),\n    y: sourceTrbl.bottom + connectedDistance + element.height / 2\n  };\n\n  var nextPosition = {\n    margin: margin,\n    minDistance: minDistance\n  };\n\n  var nextPositionDirection = placeHorizontally ? {\n    y: nextPosition\n  } : {\n    x: nextPosition\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\n/**\n * @param {DirectionTRBL} orientation\n * @param {number} minDistance\n * @param {{ start: DirectionTRBL, end: DirectionTRBL }} placement\n *\n * @return {number}\n */\nfunction getDistance(orientation, minDistance, placement) {\n  if (orientation.includes(placement.start)) {\n    return -1 * minDistance;\n  } else if (orientation.includes(placement.end)) {\n    return minDistance;\n  } else {\n    return 0;\n  }\n}\n\n\n/**\n * Get the position for given text annotation. Try placing the text annotation\n * top-right of the source (bottom-right in vertical layouts).\n *\n * @param {Shape} source\n * @param {Shape} element\n *\n * @return {Point}\n */\nexport function getTextAnnotationPosition(source, element) {\n\n  var sourceTrbl = asTRBL(source);\n\n  var placeHorizontally = isDirectionHorizontal(source);\n\n  var position = placeHorizontally ? {\n    x: sourceTrbl.right + element.width / 2,\n    y: sourceTrbl.top - 50 - element.height / 2\n  } : {\n    x: sourceTrbl.right + 50 + element.width / 2,\n    y: sourceTrbl.bottom + element.height / 2\n  };\n\n  if (isConnection(source)) {\n    position = getMid(source);\n    if (placeHorizontally) {\n      position.x += 100;\n      position.y -= 50;\n    } else {\n      position.x += 100;\n      position.y += 50;\n    }\n  }\n\n  var nextPosition = {\n    margin: placeHorizontally ? -30 : 30,\n    minDistance: 20\n  };\n  var nextPositionDirection = placeHorizontally ? {\n    y: nextPosition\n  } : {\n    x: nextPosition\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\n\n/**\n * Get the position for given new data element. Try placing the data element\n * bottom-right of the source (bottom-left in vertical layouts).\n *\n * @param {Shape} source\n * @param {Shape} element\n *\n * @return {Point}\n */\nexport function getDataElementPosition(source, element) {\n\n  var sourceTrbl = asTRBL(source);\n\n  var placeHorizontally = isDirectionHorizontal(source);\n\n  var position = placeHorizontally ? {\n    x: sourceTrbl.right - 10 + element.width / 2,\n    y: sourceTrbl.bottom + 40 + element.width / 2\n  } : {\n    x: sourceTrbl.left - 40 - element.width / 2,\n    y: sourceTrbl.bottom - 10 + element.height / 2\n  };\n\n  var nextPosition = {\n    margin: 30,\n    minDistance: 30\n  };\n  var nextPositionDirection = placeHorizontally ? {\n    x: nextPosition\n  } : {\n    y: nextPosition\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}","import { getNewShapePosition } from './BpmnAutoPlaceUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * BPMN auto-place behavior.\n *\n * @param {EventBus} eventBus\n */\nexport default function AutoPlace(eventBus) {\n  eventBus.on('autoPlace', function(context) {\n    var shape = context.shape,\n        source = context.source;\n\n    return getNewShapePosition(source, shape);\n  });\n}\n\nAutoPlace.$inject = [ 'eventBus' ];","import AutoPlaceModule from 'diagram-js/lib/features/auto-place';\n\nimport BpmnAutoPlace from './BpmnAutoPlace';\n\nexport default {\n  __depends__: [ AutoPlaceModule ],\n  __init__: [ 'bpmnAutoPlace' ],\n  bpmnAutoPlace: [ 'type', BpmnAutoPlace ]\n};","import inherits from 'inherits-browser';\r\n\r\nimport { getBBox as getBoundingBox } from '../../util/Elements';\r\n\r\nimport {\r\n  asTRBL,\r\n  asBounds\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport {\r\n  assign,\r\n  flatten,\r\n  find,\r\n  forEach,\r\n  groupBy,\r\n  isArray,\r\n  matchPattern,\r\n  pick,\r\n  values\r\n} from 'min-dash';\r\n\r\nimport CommandInterceptor from '../../command/CommandInterceptor';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../../util/Types').Direction} Direction\r\n * @typedef {import('../../util/Types').Rect} Rect\r\n * @typedef {import('../../util/Types').RectTRBL} RectTRBL\r\n *\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n */\r\n\r\n/**\r\n * An auto resize component that takes care of expanding a parent element\r\n * if child elements are created or moved close the parents edge.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {Modeling} modeling\r\n * @param {Rules} rules\r\n */\r\nexport default function AutoResize(eventBus, elementRegistry, modeling, rules) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  this._elementRegistry = elementRegistry;\r\n  this._modeling = modeling;\r\n  this._rules = rules;\r\n\r\n  var self = this;\r\n\r\n  this.postExecuted([ 'shape.create' ], function(event) {\r\n    var context = event.context,\r\n        hints = context.hints || {},\r\n        shape = context.shape,\r\n        parent = context.parent || context.newParent;\r\n\r\n    if (hints.autoResize === false) {\r\n      return;\r\n    }\r\n\r\n    self._expand([ shape ], parent);\r\n  });\r\n\r\n  this.postExecuted([ 'elements.move' ], function(event) {\r\n    var context = event.context,\r\n        elements = flatten(values(context.closure.topLevel)),\r\n        hints = context.hints;\r\n\r\n    var autoResize = hints ? hints.autoResize : true;\r\n\r\n    if (autoResize === false) {\r\n      return;\r\n    }\r\n\r\n    var expandings = groupBy(elements, function(element) {\r\n      return element.parent.id;\r\n    });\r\n\r\n    forEach(expandings, function(elements, parentId) {\r\n\r\n      // optionally filter elements to be considered when resizing\r\n      if (isArray(autoResize)) {\r\n        elements = elements.filter(function(element) {\r\n          return find(autoResize, matchPattern({ id: element.id }));\r\n        });\r\n      }\r\n\r\n      self._expand(elements, parentId);\r\n    });\r\n  });\r\n\r\n  this.postExecuted([ 'shape.toggleCollapse' ], function(event) {\r\n    var context = event.context,\r\n        hints = context.hints,\r\n        shape = context.shape;\r\n\r\n    if (hints && hints.autoResize === false) {\r\n      return;\r\n    }\r\n\r\n    if (shape.collapsed) {\r\n      return;\r\n    }\r\n\r\n    self._expand(shape.children || [], shape);\r\n  });\r\n\r\n  this.postExecuted([ 'shape.resize' ], function(event) {\r\n    var context = event.context,\r\n        hints = context.hints,\r\n        shape = context.shape,\r\n        parent = shape.parent;\r\n\r\n    if (hints && hints.autoResize === false) {\r\n      return;\r\n    }\r\n\r\n    if (parent) {\r\n      self._expand([ shape ], parent);\r\n    }\r\n  });\r\n\r\n}\r\n\r\nAutoResize.$inject = [\r\n  'eventBus',\r\n  'elementRegistry',\r\n  'modeling',\r\n  'rules'\r\n];\r\n\r\ninherits(AutoResize, CommandInterceptor);\r\n\r\n\r\n/**\r\n * Calculate the new bounds of the target shape, given\r\n * a number of elements have been moved or added into the parent.\r\n *\r\n * This method considers the current size, the added elements as well as\r\n * the provided padding for the new bounds.\r\n *\r\n * @param {Shape[]} elements\r\n * @param {Shape} target\r\n */\r\nAutoResize.prototype._getOptimalBounds = function(elements, target) {\r\n\r\n  var offset = this.getOffset(target),\r\n      padding = this.getPadding(target);\r\n\r\n  var elementsTrbl = asTRBL(getBoundingBox(elements)),\r\n      targetTrbl = asTRBL(target);\r\n\r\n  var newTrbl = {};\r\n\r\n  if (elementsTrbl.top - targetTrbl.top < padding.top) {\r\n    newTrbl.top = elementsTrbl.top - offset.top;\r\n  }\r\n\r\n  if (elementsTrbl.left - targetTrbl.left < padding.left) {\r\n    newTrbl.left = elementsTrbl.left - offset.left;\r\n  }\r\n\r\n  if (targetTrbl.right - elementsTrbl.right < padding.right) {\r\n    newTrbl.right = elementsTrbl.right + offset.right;\r\n  }\r\n\r\n  if (targetTrbl.bottom - elementsTrbl.bottom < padding.bottom) {\r\n    newTrbl.bottom = elementsTrbl.bottom + offset.bottom;\r\n  }\r\n\r\n  return asBounds(assign({}, targetTrbl, newTrbl));\r\n};\r\n\r\n\r\n/**\r\n * Expand the target shape respecting rules, offset and padding\r\n *\r\n * @param {Shape[]} elements\r\n * @param {Shape|string} target The target or its ID.\r\n */\r\nAutoResize.prototype._expand = function(elements, target) {\r\n\r\n  if (typeof target === 'string') {\r\n    target = this._elementRegistry.get(target);\r\n  }\r\n\r\n  var allowed = this._rules.allowed('element.autoResize', {\r\n    elements: elements,\r\n    target: target\r\n  });\r\n\r\n  if (!allowed) {\r\n    return;\r\n  }\r\n\r\n  // calculate the new bounds\r\n  var newBounds = this._getOptimalBounds(elements, target);\r\n\r\n  if (!boundsChanged(newBounds, target)) {\r\n    return;\r\n  }\r\n\r\n  var resizeDirections = getResizeDirections(pick(target, [ 'x', 'y', 'width', 'height' ]), newBounds);\r\n\r\n  // resize the parent shape\r\n  this.resize(target, newBounds, {\r\n    autoResize: resizeDirections\r\n  });\r\n\r\n  var parent = target.parent;\r\n\r\n  // recursively expand parent elements\r\n  if (parent) {\r\n    this._expand([ target ], parent);\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Get the amount to expand the given shape in each direction.\r\n *\r\n * @param {Shape} shape\r\n *\r\n * @return {RectTRBL}\r\n */\r\nAutoResize.prototype.getOffset = function(shape) {\r\n  return { top: 60, bottom: 60, left: 100, right: 100 };\r\n};\r\n\r\n\r\n/**\r\n * Get the activation threshold for each side for which\r\n * resize triggers.\r\n *\r\n * @param {Shape} shape\r\n *\r\n * @return {RectTRBL}\r\n */\r\nAutoResize.prototype.getPadding = function(shape) {\r\n  return { top: 2, bottom: 2, left: 15, right: 15 };\r\n};\r\n\r\n\r\n/**\r\n * Perform the actual resize operation.\r\n *\r\n * @param {Shape} shape\r\n * @param {Rect} newBounds\r\n * @param {Object} [hints]\r\n * @param {string} [hints.autoResize]\r\n */\r\nAutoResize.prototype.resize = function(shape, newBounds, hints) {\r\n  this._modeling.resizeShape(shape, newBounds, null, hints);\r\n};\r\n\r\n\r\nfunction boundsChanged(newBounds, oldBounds) {\r\n  return (\r\n    newBounds.x !== oldBounds.x ||\r\n    newBounds.y !== oldBounds.y ||\r\n    newBounds.width !== oldBounds.width ||\r\n    newBounds.height !== oldBounds.height\r\n  );\r\n}\r\n\r\n/**\r\n * Get directions of resize as {n|w|s|e} e.g. \"nw\".\r\n *\r\n * @param {Rect} oldBounds\r\n * @param {Rect} newBounds\r\n *\r\n * @return {Direction} Resize directions as {n|w|s|e}.\r\n */\r\nfunction getResizeDirections(oldBounds, newBounds) {\r\n  var directions = '';\r\n\r\n  oldBounds = asTRBL(oldBounds);\r\n  newBounds = asTRBL(newBounds);\r\n\r\n  if (oldBounds.top > newBounds.top) {\r\n    directions = directions.concat('n');\r\n  }\r\n\r\n  if (oldBounds.right < newBounds.right) {\r\n    directions = directions.concat('w');\r\n  }\r\n\r\n  if (oldBounds.bottom < newBounds.bottom) {\r\n    directions = directions.concat('s');\r\n  }\r\n\r\n  if (oldBounds.left > newBounds.left) {\r\n    directions = directions.concat('e');\r\n  }\r\n\r\n  return directions;\r\n}","import AutoResize from 'diagram-js/lib/features/auto-resize/AutoResize';\n\nimport inherits from 'inherits-browser';\n\nimport { is } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\n/**\n * BPMN-specific resize behavior.\n *\n * @param {Injector} injector\n */\nexport default function BpmnAutoResize(injector) {\n\n  injector.invoke(AutoResize, this);\n}\n\nBpmnAutoResize.$inject = [\n  'injector'\n];\n\ninherits(BpmnAutoResize, AutoResize);\n\n/**\n * Perform BPMN-specific resizing of participants.\n *\n * @param {Shape} target\n * @param {Rect} newBounds\n * @param {Object} [hints]\n * @param {string} [hints.autoResize]\n */\nBpmnAutoResize.prototype.resize = function(target, newBounds, hints) {\n\n  if (is(target, 'bpmn:Participant')) {\n    this._modeling.resizeLane(target, newBounds, null, hints);\n  } else {\n    this._modeling.resizeShape(target, newBounds, null, hints);\n  }\n};","import RuleProvider from '../rules/RuleProvider';\r\n\r\nimport inherits from 'inherits-browser';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * This is a base rule provider for the element.autoResize rule.\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function AutoResizeProvider(eventBus) {\r\n\r\n  RuleProvider.call(this, eventBus);\r\n\r\n  var self = this;\r\n\r\n  this.addRule('element.autoResize', function(context) {\r\n    return self.canResize(context.elements, context.target);\r\n  });\r\n}\r\n\r\nAutoResizeProvider.$inject = [ 'eventBus' ];\r\n\r\ninherits(AutoResizeProvider, RuleProvider);\r\n\r\n/**\r\n * Needs to be implemented by sub classes to allow actual auto resize\r\n *\r\n * @param {Shape[]} elements\r\n * @param {Shape} target\r\n *\r\n * @return {boolean}\r\n */\r\nAutoResizeProvider.prototype.canResize = function(elements, target) {\r\n  return false;\r\n};","import { is } from '../../util/ModelUtil';\n\nimport { isLabel } from '../../util/LabelUtil';\n\nimport inherits from 'inherits-browser';\n\nimport { forEach } from 'min-dash';\n\nimport AutoResizeProvider from 'diagram-js/lib/features/auto-resize/AutoResizeProvider';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../modeling/Modeling').default} Modeling\n *\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\n/**\n * BPMN-specific provider for automatic resizung.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function BpmnAutoResizeProvider(eventBus, modeling) {\n  AutoResizeProvider.call(this, eventBus);\n\n  this._modeling = modeling;\n}\n\ninherits(BpmnAutoResizeProvider, AutoResizeProvider);\n\nBpmnAutoResizeProvider.$inject = [\n  'eventBus',\n  'modeling'\n];\n\n\n/**\n * BPMN-specific check whether given elements can be resized.\n *\n * @param {Shape[]} elements\n * @param {Shape} target\n *\n * @return {boolean}\n */\nBpmnAutoResizeProvider.prototype.canResize = function(elements, target) {\n\n  // do not resize plane elements:\n  // root elements, collapsed sub-processes\n  if (is(target.di, 'bpmndi:BPMNPlane')) {\n    return false;\n  }\n\n  if (!is(target, 'bpmn:Participant') && !is(target, 'bpmn:Lane') && !(is(target, 'bpmn:SubProcess'))) {\n    return false;\n  }\n\n  var canResize = true;\n\n  forEach(elements, function(element) {\n\n    if (is(element, 'bpmn:Lane') || isLabel(element)) {\n      canResize = false;\n      return;\n    }\n  });\n\n  return canResize;\n};\n","import BpmnAutoResize from './BpmnAutoResize';\nimport BpmnAutoResizeProvider from './BpmnAutoResizeProvider';\n\n\nexport default {\n  __init__: [\n    'bpmnAutoResize',\n    'bpmnAutoResizeProvider'\n  ],\n  bpmnAutoResize: [ 'type', BpmnAutoResize ],\n  bpmnAutoResizeProvider: [ 'type', BpmnAutoResizeProvider ]\n};\n","import {\r\n  closest as domClosest\r\n} from 'min-dom';\r\n\r\nimport {\r\n  toPoint\r\n} from '../../util/Event';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\nvar HIGH_PRIORITY = 1500;\r\n\r\n\r\n/**\r\n * Browsers may swallow certain events (hover, out ...) if users are to\r\n * fast with the mouse.\r\n *\r\n * @see http://stackoverflow.com/questions/7448468/why-cant-i-reliably-capture-a-mouseout-event\r\n *\r\n * The fix implemented in this component ensure that we\r\n *\r\n * 1) have a hover state after a successful drag.move event\r\n * 2) have an out event when dragging leaves an element\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Injector} injector\r\n */\r\nexport default function HoverFix(elementRegistry, eventBus, injector) {\r\n\r\n  var self = this;\r\n\r\n  var dragging = injector.get('dragging', false);\r\n\r\n  /**\r\n   * Make sure we are god damn hovering!\r\n   *\r\n   * @param {Event} dragging event\r\n   */\r\n  function ensureHover(event) {\r\n\r\n    if (event.hover) {\r\n      return;\r\n    }\r\n\r\n    var originalEvent = event.originalEvent;\r\n\r\n    var gfx = self._findTargetGfx(originalEvent);\r\n\r\n    var element = gfx && elementRegistry.get(gfx);\r\n\r\n    if (gfx && element) {\r\n\r\n      // 1) cancel current mousemove\r\n      event.stopPropagation();\r\n\r\n      // 2) emit fake hover for new target\r\n      dragging.hover({ element: element, gfx: gfx });\r\n\r\n      // 3) re-trigger move event\r\n      dragging.move(originalEvent);\r\n    }\r\n  }\r\n\r\n\r\n  if (dragging) {\r\n\r\n    /**\r\n     * We wait for a specific sequence of events before\r\n     * emitting a fake drag.hover event.\r\n     *\r\n     * Event Sequence:\r\n     *\r\n     * drag.start\r\n     * drag.move >> ensure we are hovering\r\n     */\r\n    eventBus.on('drag.start', function(event) {\r\n\r\n      eventBus.once('drag.move', HIGH_PRIORITY, function(event) {\r\n\r\n        ensureHover(event);\r\n\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * We make sure that element.out is always fired, even if the\r\n   * browser swallows an element.out event.\r\n   *\r\n   * Event sequence:\r\n   *\r\n   * element.hover\r\n   * (element.out >> sometimes swallowed)\r\n   * element.hover >> ensure we fired element.out\r\n   */\r\n  (function() {\r\n    var hoverGfx;\r\n    var hover;\r\n\r\n    eventBus.on('element.hover', function(event) {\r\n\r\n      // (1) remember current hover element\r\n      hoverGfx = event.gfx;\r\n      hover = event.element;\r\n    });\r\n\r\n    eventBus.on('element.hover', HIGH_PRIORITY, function(event) {\r\n\r\n      // (3) am I on an element still?\r\n      if (hover) {\r\n\r\n        // (4) that is a problem, gotta \"simulate the out\"\r\n        eventBus.fire('element.out', {\r\n          element: hover,\r\n          gfx: hoverGfx\r\n        });\r\n      }\r\n\r\n    });\r\n\r\n    eventBus.on('element.out', function() {\r\n\r\n      // (2) unset hover state if we correctly outed us *GG*\r\n      hoverGfx = null;\r\n      hover = null;\r\n    });\r\n\r\n  })();\r\n\r\n  this._findTargetGfx = function(event) {\r\n    var position,\r\n        target;\r\n\r\n    if (!(event instanceof MouseEvent)) {\r\n      return;\r\n    }\r\n\r\n    position = toPoint(event);\r\n\r\n    // damn expensive operation, ouch!\r\n    target = document.elementFromPoint(position.x, position.y);\r\n\r\n    return getGfx(target);\r\n  };\r\n\r\n}\r\n\r\nHoverFix.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'injector'\r\n];\r\n\r\n\r\n// helpers /////////////////////\r\n\r\nfunction getGfx(target) {\r\n  return domClosest(target, 'svg, .djs-element', true);\r\n}","import HoverFix from './HoverFix';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [\r\n    'hoverFix'\r\n  ],\r\n  hoverFix: [ 'type', HoverFix ],\r\n};","var round = Math.round;\r\n\r\nimport { assign } from 'min-dash';\r\n\r\nimport {\r\n  event as domEvent\r\n} from 'min-dom';\r\n\r\nimport {\r\n  getOriginal,\r\n  toPoint,\r\n  stopPropagation\r\n} from '../../util/Event';\r\n\r\nimport {\r\n  set as cursorSet,\r\n  unset as cursorUnset\r\n} from '../../util/Cursor';\r\n\r\nimport {\r\n  install as installClickTrap\r\n} from '../../util/ClickTrap';\r\n\r\nimport {\r\n  delta as deltaPos\r\n} from '../../util/PositionUtil';\r\n\r\nimport { isKey } from '../keyboard/KeyboardUtil';\r\n\r\n/**\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../selection/Selection').default} Selection\r\n */\r\n\r\nvar DRAG_ACTIVE_CLS = 'djs-drag-active';\r\n\r\n\r\nfunction preventDefault(event) {\r\n  event.preventDefault();\r\n}\r\n\r\nfunction isTouchEvent(event) {\r\n\r\n  // check for TouchEvent being available first\r\n  // (i.e. not available on desktop Firefox)\r\n  return typeof TouchEvent !== 'undefined' && event instanceof TouchEvent;\r\n}\r\n\r\nfunction getLength(point) {\r\n  return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\r\n}\r\n\r\n/**\r\n * A helper that fires canvas localized drag events and realizes\r\n * the general \"drag-and-drop\" look and feel.\r\n *\r\n * Calling {@link Dragging#activate} activates dragging on a canvas.\r\n *\r\n * It provides the following:\r\n *\r\n *   * emits life cycle events, namespaced with a prefix assigned\r\n *     during dragging activation\r\n *   * sets and restores the cursor\r\n *   * sets and restores the selection if elements still exist\r\n *   * ensures there can be only one drag operation active at a time\r\n *\r\n * Dragging may be canceled manually by calling {@link Dragging#cancel}\r\n * or by pressing ESC.\r\n *\r\n *\r\n * ## Life-cycle events\r\n *\r\n * Dragging can be in three different states, off, initialized\r\n * and active.\r\n *\r\n * (1) off: no dragging operation is in progress\r\n * (2) initialized: a new drag operation got initialized but not yet\r\n *                  started (i.e. because of no initial move)\r\n * (3) started: dragging is in progress\r\n *\r\n * Eventually dragging will be off again after a drag operation has\r\n * been ended or canceled via user click or ESC key press.\r\n *\r\n * To indicate transitions between these states dragging emits generic\r\n * life-cycle events with the `drag.` prefix _and_ events namespaced\r\n * to a prefix choosen by a user during drag initialization.\r\n *\r\n * The following events are emitted (appropriately prefixed) via\r\n * the {@link EventBus}.\r\n *\r\n * * `init`\r\n * * `start`\r\n * * `move`\r\n * * `end`\r\n * * `ended` (dragging already in off state)\r\n * * `cancel` (only if previously started)\r\n * * `canceled` (dragging already in off state, only if previously started)\r\n * * `cleanup`\r\n *\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * function MyDragComponent(eventBus, dragging) {\r\n *\r\n *   eventBus.on('mydrag.start', function(event) {\r\n *     console.log('yes, we start dragging');\r\n *   });\r\n *\r\n *   eventBus.on('mydrag.move', function(event) {\r\n *     console.log('canvas local coordinates', event.x, event.y, event.dx, event.dy);\r\n *\r\n *     // local drag data is passed with the event\r\n *     event.context.foo; // \"BAR\"\r\n *\r\n *     // the original mouse event, too\r\n *     event.originalEvent; // MouseEvent(...)\r\n *   });\r\n *\r\n *   eventBus.on('element.click', function(event) {\r\n *     dragging.init(event, 'mydrag', {\r\n *       cursor: 'grabbing',\r\n *       data: {\r\n *         context: {\r\n *           foo: \"BAR\"\r\n *         }\r\n *       }\r\n *     });\r\n *   });\r\n * }\r\n * ```\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Selection} selection\r\n * @param {ElementRegistry} elementRegistry\r\n */\r\nexport default function Dragging(eventBus, canvas, selection, elementRegistry) {\r\n\r\n  var defaultOptions = {\r\n    threshold: 5,\r\n    trapClick: true\r\n  };\r\n\r\n  // the currently active drag operation\r\n  // dragging is active as soon as this context exists.\r\n  //\r\n  // it is visually _active_ only when a context.active flag is set to true.\r\n  var context;\r\n\r\n  /* convert a global event into local coordinates */\r\n  function toLocalPoint(globalPosition) {\r\n\r\n    var viewbox = canvas.viewbox();\r\n\r\n    var clientRect = canvas._container.getBoundingClientRect();\r\n\r\n    return {\r\n      x: viewbox.x + (globalPosition.x - clientRect.left) / viewbox.scale,\r\n      y: viewbox.y + (globalPosition.y - clientRect.top) / viewbox.scale\r\n    };\r\n  }\r\n\r\n  // helpers\r\n\r\n  function fire(type, dragContext) {\r\n    dragContext = dragContext || context;\r\n\r\n    var event = eventBus.createEvent(\r\n      assign(\r\n        {},\r\n        dragContext.payload,\r\n        dragContext.data,\r\n        { isTouch: dragContext.isTouch }\r\n      )\r\n    );\r\n\r\n    // default integration\r\n    if (eventBus.fire('drag.' + type, event) === false) {\r\n      return false;\r\n    }\r\n\r\n    return eventBus.fire(dragContext.prefix + '.' + type, event);\r\n  }\r\n\r\n  function restoreSelection(previousSelection) {\r\n    var existingSelection = previousSelection.filter(function(element) {\r\n      return elementRegistry.get(element.id);\r\n    });\r\n\r\n    existingSelection.length && selection.select(existingSelection);\r\n  }\r\n\r\n  // event listeners\r\n\r\n  function move(event, activate) {\r\n    var payload = context.payload,\r\n        displacement = context.displacement;\r\n\r\n    var globalStart = context.globalStart,\r\n        globalCurrent = toPoint(event),\r\n        globalDelta = deltaPos(globalCurrent, globalStart);\r\n\r\n    var localStart = context.localStart,\r\n        localCurrent = toLocalPoint(globalCurrent),\r\n        localDelta = deltaPos(localCurrent, localStart);\r\n\r\n\r\n    // activate context explicitly or once threshold is reached\r\n    if (!context.active && (activate || getLength(globalDelta) > context.threshold)) {\r\n\r\n      // fire start event with original\r\n      // starting coordinates\r\n\r\n      assign(payload, {\r\n        x: round(localStart.x + displacement.x),\r\n        y: round(localStart.y + displacement.y),\r\n        dx: 0,\r\n        dy: 0\r\n      }, { originalEvent: event });\r\n\r\n      if (false === fire('start')) {\r\n        return cancel();\r\n      }\r\n\r\n      context.active = true;\r\n\r\n      // unset selection and remember old selection\r\n      // the previous (old) selection will always passed\r\n      // with the event via the event.previousSelection property\r\n      if (!context.keepSelection) {\r\n        payload.previousSelection = selection.get();\r\n        selection.select(null);\r\n      }\r\n\r\n      // allow custom cursor\r\n      if (context.cursor) {\r\n        cursorSet(context.cursor);\r\n      }\r\n\r\n      // indicate dragging via marker on root element\r\n      canvas.addMarker(canvas.getRootElement(), DRAG_ACTIVE_CLS);\r\n    }\r\n\r\n    stopPropagation(event);\r\n\r\n    if (context.active) {\r\n\r\n      // update payload with actual coordinates\r\n      assign(payload, {\r\n        x: round(localCurrent.x + displacement.x),\r\n        y: round(localCurrent.y + displacement.y),\r\n        dx: round(localDelta.x),\r\n        dy: round(localDelta.y)\r\n      }, { originalEvent: event });\r\n\r\n      // emit move event\r\n      fire('move');\r\n    }\r\n  }\r\n\r\n  function end(event) {\r\n    var previousContext,\r\n        returnValue = true;\r\n\r\n    if (context.active) {\r\n\r\n      if (event) {\r\n        context.payload.originalEvent = event;\r\n\r\n        // suppress original event (click, ...)\r\n        // because we just ended a drag operation\r\n        stopPropagation(event);\r\n      }\r\n\r\n      // implementations may stop restoring the\r\n      // original state (selections, ...) by preventing the\r\n      // end events default action\r\n      returnValue = fire('end');\r\n    }\r\n\r\n    if (returnValue === false) {\r\n      fire('rejected');\r\n    }\r\n\r\n    previousContext = cleanup(returnValue !== true);\r\n\r\n    // last event to be fired when all drag operations are done\r\n    // at this point in time no drag operation is in progress anymore\r\n    fire('ended', previousContext);\r\n  }\r\n\r\n\r\n  // cancel active drag operation if the user presses\r\n  // the ESC key on the keyboard\r\n\r\n  function checkCancel(event) {\r\n\r\n    if (isKey('Escape', event)) {\r\n      preventDefault(event);\r\n\r\n      cancel();\r\n    }\r\n  }\r\n\r\n\r\n  // prevent ghost click that might occur after a finished\r\n  // drag and drop session\r\n\r\n  function trapClickAndEnd(event) {\r\n\r\n    var untrap;\r\n\r\n    // trap the click in case we are part of an active\r\n    // drag operation. This will effectively prevent\r\n    // the ghost click that cannot be canceled otherwise.\r\n    if (context.active) {\r\n\r\n      untrap = installClickTrap(eventBus);\r\n\r\n      // remove trap after minimal delay\r\n      setTimeout(untrap, 400);\r\n\r\n      // prevent default action (click)\r\n      preventDefault(event);\r\n    }\r\n\r\n    end(event);\r\n  }\r\n\r\n  function trapTouch(event) {\r\n    move(event);\r\n  }\r\n\r\n  // update the drag events model element (`hover`) and graphical element (`hoverGfx`)\r\n  // properties during hover and out and fire {prefix}.hover and {prefix}.out properties\r\n  // respectively\r\n\r\n  function hover(event) {\r\n    var payload = context.payload;\r\n\r\n    payload.hoverGfx = event.gfx;\r\n    payload.hover = event.element;\r\n\r\n    fire('hover');\r\n  }\r\n\r\n  function out(event) {\r\n    fire('out');\r\n\r\n    var payload = context.payload;\r\n\r\n    payload.hoverGfx = null;\r\n    payload.hover = null;\r\n  }\r\n\r\n\r\n  // life-cycle methods\r\n\r\n  function cancel(restore) {\r\n    var previousContext;\r\n\r\n    if (!context) {\r\n      return;\r\n    }\r\n\r\n    var wasActive = context.active;\r\n\r\n    if (wasActive) {\r\n      fire('cancel');\r\n    }\r\n\r\n    previousContext = cleanup(restore);\r\n\r\n    if (wasActive) {\r\n\r\n      // last event to be fired when all drag operations are done\r\n      // at this point in time no drag operation is in progress anymore\r\n      fire('canceled', previousContext);\r\n    }\r\n  }\r\n\r\n  function cleanup(restore) {\r\n    var previousContext,\r\n        endDrag;\r\n\r\n    fire('cleanup');\r\n\r\n    // reset cursor\r\n    cursorUnset();\r\n\r\n    if (context.trapClick) {\r\n      endDrag = trapClickAndEnd;\r\n    } else {\r\n      endDrag = end;\r\n    }\r\n\r\n    // reset dom listeners\r\n    domEvent.unbind(document, 'mousemove', move);\r\n\r\n    domEvent.unbind(document, 'dragstart', preventDefault);\r\n    domEvent.unbind(document, 'selectstart', preventDefault);\r\n\r\n    domEvent.unbind(document, 'mousedown', endDrag, true);\r\n    domEvent.unbind(document, 'mouseup', endDrag, true);\r\n\r\n    domEvent.unbind(document, 'keyup', checkCancel);\r\n\r\n    domEvent.unbind(document, 'touchstart', trapTouch, true);\r\n    domEvent.unbind(document, 'touchcancel', cancel, true);\r\n    domEvent.unbind(document, 'touchmove', move, true);\r\n    domEvent.unbind(document, 'touchend', end, true);\r\n\r\n    eventBus.off('element.hover', hover);\r\n    eventBus.off('element.out', out);\r\n\r\n    // remove drag marker on root element\r\n    canvas.removeMarker(canvas.getRootElement(), DRAG_ACTIVE_CLS);\r\n\r\n    // restore selection, unless it has changed\r\n    var previousSelection = context.payload.previousSelection;\r\n\r\n    if (restore !== false && previousSelection && !selection.get().length) {\r\n      restoreSelection(previousSelection);\r\n    }\r\n\r\n    previousContext = context;\r\n\r\n    context = null;\r\n\r\n    return previousContext;\r\n  }\r\n\r\n  /**\r\n   * Initialize a drag operation.\r\n   *\r\n   * If `localPosition` is given, drag events will be emitted\r\n   * relative to it.\r\n   *\r\n   * @param {MouseEvent|TouchEvent} [event]\r\n   * @param {Point} [relativeTo] actual diagram local position this drag operation should start at\r\n   * @param {string} prefix\r\n   * @param {Object} [options]\r\n   */\r\n  function init(event, relativeTo, prefix, options) {\r\n\r\n    // only one drag operation may be active, at a time\r\n    if (context) {\r\n      cancel(false);\r\n    }\r\n\r\n    if (typeof relativeTo === 'string') {\r\n      options = prefix;\r\n      prefix = relativeTo;\r\n      relativeTo = null;\r\n    }\r\n\r\n    options = assign({}, defaultOptions, options || {});\r\n\r\n    var data = options.data || {},\r\n        originalEvent,\r\n        globalStart,\r\n        localStart,\r\n        endDrag,\r\n        isTouch;\r\n\r\n    if (options.trapClick) {\r\n      endDrag = trapClickAndEnd;\r\n    } else {\r\n      endDrag = end;\r\n    }\r\n\r\n    if (event) {\r\n      originalEvent = getOriginal(event) || event;\r\n      globalStart = toPoint(event);\r\n\r\n      stopPropagation(event);\r\n\r\n      // prevent default browser dragging behavior\r\n      if (originalEvent.type === 'dragstart') {\r\n        preventDefault(originalEvent);\r\n      }\r\n    } else {\r\n      originalEvent = null;\r\n      globalStart = { x: 0, y: 0 };\r\n    }\r\n\r\n    localStart = toLocalPoint(globalStart);\r\n\r\n    if (!relativeTo) {\r\n      relativeTo = localStart;\r\n    }\r\n\r\n    isTouch = isTouchEvent(originalEvent);\r\n\r\n    context = assign({\r\n      prefix: prefix,\r\n      data: data,\r\n      payload: {},\r\n      globalStart: globalStart,\r\n      displacement: deltaPos(relativeTo, localStart),\r\n      localStart: localStart,\r\n      isTouch: isTouch\r\n    }, options);\r\n\r\n    // skip dom registration if trigger\r\n    // is set to manual (during testing)\r\n    if (!options.manual) {\r\n\r\n      // add dom listeners\r\n\r\n      if (isTouch) {\r\n        domEvent.bind(document, 'touchstart', trapTouch, true);\r\n        domEvent.bind(document, 'touchcancel', cancel, true);\r\n        domEvent.bind(document, 'touchmove', move, true);\r\n        domEvent.bind(document, 'touchend', end, true);\r\n      } else {\r\n\r\n        // assume we use the mouse to interact per default\r\n        domEvent.bind(document, 'mousemove', move);\r\n\r\n        // prevent default browser drag and text selection behavior\r\n        domEvent.bind(document, 'dragstart', preventDefault);\r\n        domEvent.bind(document, 'selectstart', preventDefault);\r\n\r\n        domEvent.bind(document, 'mousedown', endDrag, true);\r\n        domEvent.bind(document, 'mouseup', endDrag, true);\r\n      }\r\n\r\n      domEvent.bind(document, 'keyup', checkCancel);\r\n\r\n      eventBus.on('element.hover', hover);\r\n      eventBus.on('element.out', out);\r\n    }\r\n\r\n    fire('init');\r\n\r\n    if (options.autoActivate) {\r\n      move(event, true);\r\n    }\r\n  }\r\n\r\n  // cancel on diagram destruction\r\n  eventBus.on('diagram.destroy', cancel);\r\n\r\n\r\n  // API\r\n\r\n  this.init = init;\r\n  this.move = move;\r\n  this.hover = hover;\r\n  this.out = out;\r\n  this.end = end;\r\n\r\n  this.cancel = cancel;\r\n\r\n  // for introspection\r\n\r\n  this.context = function() {\r\n    return context;\r\n  };\r\n\r\n  this.setOptions = function(options) {\r\n    assign(defaultOptions, options);\r\n  };\r\n}\r\n\r\nDragging.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'selection',\r\n  'elementRegistry'\r\n];\r\n","import HoverFixModule from '../hover-fix';\r\nimport SelectionModule from '../selection';\r\n\r\nimport Dragging from './Dragging';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    HoverFixModule,\r\n    SelectionModule,\r\n  ],\r\n  dragging: [ 'type', Dragging ],\r\n};","import { assign } from 'min-dash';\r\n\r\nimport {\r\n  toPoint\r\n} from '../../util/Event';\r\n\r\n/**\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n */\r\n\r\n/**\r\n * Initiates canvas scrolling if current cursor point is close to a border.\r\n * Cancelled when current point moves back inside the scrolling borders\r\n * or cancelled manually.\r\n *\r\n * Default options :\r\n *   scrollThresholdIn: [ 20, 20, 20, 20 ],\r\n *   scrollThresholdOut: [ 0, 0, 0, 0 ],\r\n *   scrollRepeatTimeout: 15,\r\n *   scrollStep: 10\r\n *\r\n * Threshold order:\r\n *   [ left, top, right, bottom ]\r\n *\r\n * @param {Object} config\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function AutoScroll(config, eventBus, canvas) {\r\n\r\n  this._canvas = canvas;\r\n\r\n  this._opts = assign({\r\n    scrollThresholdIn: [ 20, 20, 20, 20 ],\r\n    scrollThresholdOut: [ 0, 0, 0, 0 ],\r\n    scrollRepeatTimeout: 15,\r\n    scrollStep: 10\r\n  }, config);\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('drag.move', function(e) {\r\n    var point = self._toBorderPoint(e);\r\n\r\n    self.startScroll(point);\r\n  });\r\n\r\n  eventBus.on([ 'drag.cleanup' ], function() {\r\n    self.stopScroll();\r\n  });\r\n}\r\n\r\nAutoScroll.$inject = [\r\n  'config.autoScroll',\r\n  'eventBus',\r\n  'canvas'\r\n];\r\n\r\n\r\n/**\r\n * Starts scrolling loop.\r\n * Point is given in global scale in canvas container box plane.\r\n *\r\n * @param {Point} point\r\n */\r\nAutoScroll.prototype.startScroll = function(point) {\r\n\r\n  var canvas = this._canvas;\r\n  var opts = this._opts;\r\n  var self = this;\r\n\r\n  var clientRect = canvas.getContainer().getBoundingClientRect();\r\n\r\n  var diff = [\r\n    point.x,\r\n    point.y,\r\n    clientRect.width - point.x,\r\n    clientRect.height - point.y\r\n  ];\r\n\r\n  this.stopScroll();\r\n\r\n  var dx = 0,\r\n      dy = 0;\r\n\r\n  for (var i = 0; i < 4; i++) {\r\n    if (between(diff[i], opts.scrollThresholdOut[i], opts.scrollThresholdIn[i])) {\r\n      if (i === 0) {\r\n        dx = opts.scrollStep;\r\n      } else if (i == 1) {\r\n        dy = opts.scrollStep;\r\n      } else if (i == 2) {\r\n        dx = -opts.scrollStep;\r\n      } else if (i == 3) {\r\n        dy = -opts.scrollStep;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (dx !== 0 || dy !== 0) {\r\n    canvas.scroll({ dx: dx, dy: dy });\r\n\r\n    this._scrolling = setTimeout(function() {\r\n      self.startScroll(point);\r\n    }, opts.scrollRepeatTimeout);\r\n  }\r\n};\r\n\r\nfunction between(val, start, end) {\r\n  if (start < val && val < end) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n\r\n/**\r\n * Stops scrolling loop.\r\n */\r\nAutoScroll.prototype.stopScroll = function() {\r\n  clearTimeout(this._scrolling);\r\n};\r\n\r\n\r\n/**\r\n * Overrides defaults options.\r\n *\r\n * @param {Object} options\r\n */\r\nAutoScroll.prototype.setOptions = function(options) {\r\n  this._opts = assign({}, this._opts, options);\r\n};\r\n\r\n\r\n/**\r\n * Converts event to a point in canvas container plane in global scale.\r\n *\r\n * @param {Event} event\r\n * @return {Point}\r\n */\r\nAutoScroll.prototype._toBorderPoint = function(event) {\r\n  var clientRect = this._canvas._container.getBoundingClientRect();\r\n\r\n  var globalPosition = toPoint(event.originalEvent);\r\n\r\n  return {\r\n    x: globalPosition.x - clientRect.left,\r\n    y: globalPosition.y - clientRect.top\r\n  };\r\n};","import DraggingModule from '../dragging';\r\n\r\nimport AutoScroll from './AutoScroll';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    DraggingModule,\r\n  ],\r\n  __init__: [ 'autoScroll' ],\r\n  autoScroll: [ 'type', AutoScroll ]\r\n};","/**\r\n * @typedef {import('didi').Injector} Injector\r\n */\r\n\r\n/**\r\n * A service that provides rules for certain diagram actions.\r\n *\r\n * The default implementation will hook into the {@link CommandStack}\r\n * to perform the actual rule evaluation. Make sure to provide the\r\n * `commandStack` service with this module if you plan to use it.\r\n *\r\n * Together with this implementation you may use the {@link import('./RuleProvider').default}\r\n * to implement your own rule checkers.\r\n *\r\n * This module is ment to be easily replaced, thus the tiny foot print.\r\n *\r\n * @param {Injector} injector\r\n */\r\nexport default function Rules(injector) {\r\n  this._commandStack = injector.get('commandStack', false);\r\n}\r\n\r\nRules.$inject = [ 'injector' ];\r\n\r\n\r\n/**\r\n * Returns whether or not a given modeling action can be executed\r\n * in the specified context.\r\n *\r\n * This implementation will respond with allow unless anyone\r\n * objects.\r\n *\r\n * @param {string} action The action to be allowed or disallowed.\r\n * @param {Object} [context] The context for allowing or disallowing the action.\r\n *\r\n * @return {boolean|null} Wether the action is allowed. Returns `null` if the action\r\n * is to be ignored.\r\n */\r\nRules.prototype.allowed = function(action, context) {\r\n  var allowed = true;\r\n\r\n  var commandStack = this._commandStack;\r\n\r\n  if (commandStack) {\r\n    allowed = commandStack.canExecute(action, context);\r\n  }\r\n\r\n  // map undefined to true, i.e. no rules\r\n  return allowed === undefined ? true : allowed;\r\n};","import Rules from './Rules';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'rules' ],\r\n  rules: [ 'type', Rules ]\r\n};\r\n","import {\r\n  pointDistance\r\n} from './Geometry';\r\n\r\nimport intersectPaths from 'path-intersection';\r\n\r\n/**\r\n * @typedef {import('../util/Types').Point} Point\r\n *\r\n * @typedef { {\r\n *   bendpoint?: boolean;\r\n *   index: number;\r\n *   point: Point;\r\n * } } Intersection\r\n */\r\n\r\nvar round = Math.round,\r\n    max = Math.max;\r\n\r\n\r\nfunction circlePath(center, r) {\r\n  var x = center.x,\r\n      y = center.y;\r\n\r\n  return [\r\n    [ 'M', x, y ],\r\n    [ 'm', 0, -r ],\r\n    [ 'a', r, r, 0, 1, 1, 0, 2 * r ],\r\n    [ 'a', r, r, 0, 1, 1, 0, -2 * r ],\r\n    [ 'z' ]\r\n  ];\r\n}\r\n\r\nfunction linePath(points) {\r\n  var segments = [];\r\n\r\n  points.forEach(function(p, idx) {\r\n    segments.push([ idx === 0 ? 'M' : 'L', p.x, p.y ]);\r\n  });\r\n\r\n  return segments;\r\n}\r\n\r\n\r\nvar INTERSECTION_THRESHOLD = 10;\r\n\r\n/**\r\n * @param {Point[]} waypoints\r\n * @param {Point} reference\r\n *\r\n * @return {Intersection|null}\r\n */\r\nfunction getBendpointIntersection(waypoints, reference) {\r\n\r\n  var i, w;\r\n\r\n  for (i = 0; (w = waypoints[i]); i++) {\r\n\r\n    if (pointDistance(w, reference) <= INTERSECTION_THRESHOLD) {\r\n      return {\r\n        point: waypoints[i],\r\n        bendpoint: true,\r\n        index: i\r\n      };\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * @param {Point[]} waypoints\r\n * @param {Point} reference\r\n *\r\n * @return {Intersection|null}\r\n */\r\nfunction getPathIntersection(waypoints, reference) {\r\n\r\n  var intersections = intersectPaths(circlePath(reference, INTERSECTION_THRESHOLD), linePath(waypoints));\r\n\r\n  var a = intersections[0],\r\n      b = intersections[intersections.length - 1],\r\n      idx;\r\n\r\n  if (!a) {\r\n\r\n    // no intersection\r\n    return null;\r\n  }\r\n\r\n  if (a !== b) {\r\n\r\n    if (a.segment2 !== b.segment2) {\r\n\r\n      // we use the bendpoint in between both segments\r\n      // as the intersection point\r\n\r\n      idx = max(a.segment2, b.segment2) - 1;\r\n\r\n      return {\r\n        point: waypoints[idx],\r\n        bendpoint: true,\r\n        index: idx\r\n      };\r\n    }\r\n\r\n    return {\r\n      point: {\r\n        x: (round(a.x + b.x) / 2),\r\n        y: (round(a.y + b.y) / 2)\r\n      },\r\n      index: a.segment2\r\n    };\r\n  }\r\n\r\n  return {\r\n    point: {\r\n      x: round(a.x),\r\n      y: round(a.y)\r\n    },\r\n    index: a.segment2\r\n  };\r\n}\r\n\r\n/**\r\n * Returns the closest point on the connection towards a given reference point.\r\n *\r\n * @param {Point[]} waypoints\r\n * @param {Point} reference\r\n *\r\n * @return {Intersection|null}\r\n */\r\nexport function getApproxIntersection(waypoints, reference) {\r\n  return getBendpointIntersection(waypoints, reference) || getPathIntersection(waypoints, reference);\r\n}\r\n","/**\r\n * @typedef {import('../../util/Types').Point} Point\r\n * @typedef {import('../../util/Types').Vector} Vector\r\n */\r\n\r\n/**\r\n * Returns the length of a vector.\r\n *\r\n * @param {Vector} vector\r\n *\r\n * @return {number}\r\n */\r\nexport function vectorLength(vector) {\r\n  return Math.sqrt(Math.pow(vector.x, 2) + Math.pow(vector.y, 2));\r\n}\r\n\r\n\r\n/**\r\n * Calculates the angle between a line a the Y axis.\r\n *\r\n * @param {Point[]} line\r\n *\r\n * @return {number}\r\n */\r\nexport function getAngle(line) {\r\n\r\n  // return value is between 0, 180 and -180, -0\r\n  // @janstuemmel: maybe replace return a/b with b/a\r\n  return Math.atan((line[1].y - line[0].y) / (line[1].x - line[0].x));\r\n}\r\n\r\n\r\n/**\r\n * Rotates a vector by a given angle.\r\n *\r\n * @param {Vector} vector\r\n * @param {number} angle The angle in radians.\r\n *\r\n * @return {Vector}\r\n */\r\nexport function rotateVector(vector, angle) {\r\n  return (!angle) ? vector : {\r\n    x: Math.cos(angle) * vector.x - Math.sin(angle) * vector.y,\r\n    y: Math.sin(angle) * vector.x + Math.cos(angle) * vector.y\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Solves a 2D equation system\r\n * a + r*b = c, where a,b,c are 2D vectors\r\n *\r\n * @param {Vector} a\r\n * @param {Vector} b\r\n * @param {Vector} c\r\n *\r\n * @return {number}\r\n */\r\nfunction solveLambaSystem(a, b, c) {\r\n\r\n  // the 2d system\r\n  var system = [\r\n    { n: a[0] - c[0], lambda: b[0] },\r\n    { n: a[1] - c[1], lambda: b[1] }\r\n  ];\r\n\r\n  // solve\r\n  var n = system[0].n * b[0] + system[1].n * b[1],\r\n      l = system[0].lambda * b[0] + system[1].lambda * b[1];\r\n\r\n  return -n / l;\r\n}\r\n\r\n\r\n/**\r\n * Calculates the position of the perpendicular foot.\r\n *\r\n * @param {Point} point\r\n * @param {Point[]} line\r\n *\r\n * @return {Point}\r\n */\r\nexport function perpendicularFoot(point, line) {\r\n\r\n  var a = line[0], b = line[1];\r\n\r\n  // relative position of b from a\r\n  var bd = { x: b.x - a.x, y: b.y - a.y };\r\n\r\n  // solve equation system to the parametrized vectors param real value\r\n  var r = solveLambaSystem([ a.x, a.y ], [ bd.x, bd.y ], [ point.x, point.y ]);\r\n\r\n  return { x: a.x + r * bd.x, y: a.y + r * bd.y };\r\n}\r\n\r\n\r\n/**\r\n * Calculates the distance between a point and a line.\r\n *\r\n * @param {Point} point\r\n * @param {Point[]} line\r\n *\r\n * @return {number}\r\n */\r\nexport function getDistancePointLine(point, line) {\r\n\r\n  var pfPoint = perpendicularFoot(point, line);\r\n\r\n  // distance vector\r\n  var connectionVector = {\r\n    x: pfPoint.x - point.x,\r\n    y: pfPoint.y - point.y\r\n  };\r\n\r\n  return vectorLength(connectionVector);\r\n}\r\n\r\n\r\n/**\r\n * Calculates the distance between two points.\r\n *\r\n * @param {Point} point1\r\n * @param {Point} point2\r\n *\r\n * @return {number}\r\n */\r\nexport function getDistancePointPoint(point1, point2) {\r\n\r\n  return vectorLength({\r\n    x: point1.x - point2.x,\r\n    y: point1.y - point2.y\r\n  });\r\n}","import {\r\n  toPoint\r\n} from '../../util/Event';\r\n\r\nimport {\r\n  getMidPoint,\r\n  pointsAligned\r\n} from '../../util/Geometry';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  create as svgCreate\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  rotate,\r\n  translate\r\n} from '../../util/SvgTransformUtil';\r\n\r\nimport {\r\n  getApproxIntersection\r\n} from '../../util/LineIntersection';\r\n\r\nimport { getDistancePointLine, perpendicularFoot } from './GeometricUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ConnectionLike} Connection\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n */\r\n\r\nexport var BENDPOINT_CLS = 'djs-bendpoint';\r\nexport var SEGMENT_DRAGGER_CLS = 'djs-segment-dragger';\r\n\r\nexport function toCanvasCoordinates(canvas, event) {\r\n\r\n  var position = toPoint(event),\r\n      clientRect = canvas._container.getBoundingClientRect(),\r\n      offset;\r\n\r\n  // canvas relative position\r\n\r\n  offset = {\r\n    x: clientRect.left,\r\n    y: clientRect.top\r\n  };\r\n\r\n  // update actual event payload with canvas relative measures\r\n\r\n  var viewbox = canvas.viewbox();\r\n\r\n  return {\r\n    x: viewbox.x + (position.x - offset.x) / viewbox.scale,\r\n    y: viewbox.y + (position.y - offset.y) / viewbox.scale\r\n  };\r\n}\r\n\r\nexport function getConnectionIntersection(canvas, waypoints, event) {\r\n  var localPosition = toCanvasCoordinates(canvas, event),\r\n      intersection = getApproxIntersection(waypoints, localPosition);\r\n\r\n  return intersection;\r\n}\r\n\r\nexport function addBendpoint(parentGfx, cls) {\r\n  var groupGfx = svgCreate('g');\r\n  svgClasses(groupGfx).add(BENDPOINT_CLS);\r\n\r\n  svgAppend(parentGfx, groupGfx);\r\n\r\n  var visual = svgCreate('circle');\r\n  svgAttr(visual, {\r\n    cx: 0,\r\n    cy: 0,\r\n    r: 4\r\n  });\r\n  svgClasses(visual).add('djs-visual');\r\n\r\n  svgAppend(groupGfx, visual);\r\n\r\n  var hit = svgCreate('circle');\r\n  svgAttr(hit, {\r\n    cx: 0,\r\n    cy: 0,\r\n    r: 10\r\n  });\r\n  svgClasses(hit).add('djs-hit');\r\n\r\n  svgAppend(groupGfx, hit);\r\n\r\n  if (cls) {\r\n    svgClasses(groupGfx).add(cls);\r\n  }\r\n\r\n  return groupGfx;\r\n}\r\n\r\nfunction createParallelDragger(parentGfx, segmentStart, segmentEnd, alignment) {\r\n  var draggerGfx = svgCreate('g');\r\n\r\n  svgAppend(parentGfx, draggerGfx);\r\n\r\n  var width = 18,\r\n      height = 6,\r\n      padding = 11,\r\n      hitWidth = calculateHitWidth(segmentStart, segmentEnd, alignment),\r\n      hitHeight = height + padding;\r\n\r\n  var visual = svgCreate('rect');\r\n  svgAttr(visual, {\r\n    x: -width / 2,\r\n    y: -height / 2,\r\n    width: width,\r\n    height: height\r\n  });\r\n  svgClasses(visual).add('djs-visual');\r\n\r\n  svgAppend(draggerGfx, visual);\r\n\r\n  var hit = svgCreate('rect');\r\n  svgAttr(hit, {\r\n    x: -hitWidth / 2,\r\n    y: -hitHeight / 2,\r\n    width: hitWidth,\r\n    height: hitHeight\r\n  });\r\n  svgClasses(hit).add('djs-hit');\r\n\r\n  svgAppend(draggerGfx, hit);\r\n\r\n  rotate(draggerGfx, alignment === 'v' ? 90 : 0, 0, 0);\r\n\r\n  return draggerGfx;\r\n}\r\n\r\n\r\nexport function addSegmentDragger(parentGfx, segmentStart, segmentEnd) {\r\n\r\n  var groupGfx = svgCreate('g'),\r\n      mid = getMidPoint(segmentStart, segmentEnd),\r\n      alignment = pointsAligned(segmentStart, segmentEnd);\r\n\r\n  svgAppend(parentGfx, groupGfx);\r\n\r\n  createParallelDragger(groupGfx, segmentStart, segmentEnd, alignment);\r\n\r\n  svgClasses(groupGfx).add(SEGMENT_DRAGGER_CLS);\r\n  svgClasses(groupGfx).add(alignment === 'h' ? 'horizontal' : 'vertical');\r\n\r\n  translate(groupGfx, mid.x, mid.y);\r\n\r\n  return groupGfx;\r\n}\r\n\r\n/**\r\n * Calculates region for segment move which is 2/3 of the full segment length\r\n * @param {number} segmentLength\r\n *\r\n * @return {number}\r\n */\r\nexport function calculateSegmentMoveRegion(segmentLength) {\r\n  return Math.abs(Math.round(segmentLength * 2 / 3));\r\n}\r\n\r\n/**\r\n * Returns the point with the closest distance that is on the connection path.\r\n *\r\n * @param {Point} position\r\n * @param {Connection} connection\r\n * @return {Point}\r\n */\r\nexport function getClosestPointOnConnection(position, connection) {\r\n  var segment = getClosestSegment(position, connection);\r\n\r\n  return perpendicularFoot(position, segment);\r\n}\r\n\r\n\r\n// helper //////////\r\n\r\nfunction calculateHitWidth(segmentStart, segmentEnd, alignment) {\r\n  var segmentLengthXAxis = segmentEnd.x - segmentStart.x,\r\n      segmentLengthYAxis = segmentEnd.y - segmentStart.y;\r\n\r\n  return alignment === 'h' ?\r\n    calculateSegmentMoveRegion(segmentLengthXAxis) :\r\n    calculateSegmentMoveRegion(segmentLengthYAxis);\r\n}\r\n\r\nfunction getClosestSegment(position, connection) {\r\n  var waypoints = connection.waypoints;\r\n\r\n  var minDistance = Infinity,\r\n      segmentIndex;\r\n\r\n  for (var i = 0; i < waypoints.length - 1; i++) {\r\n    var start = waypoints[i],\r\n        end = waypoints[i + 1],\r\n        distance = getDistancePointLine(position, [ start, end ]);\r\n\r\n    if (distance < minDistance) {\r\n      minDistance = distance;\r\n      segmentIndex = i;\r\n    }\r\n  }\r\n\r\n  return [ waypoints[segmentIndex], waypoints[segmentIndex + 1] ];\r\n}","import { forEach } from 'min-dash';\r\n\r\nimport {\r\n  event as domEvent,\r\n  query as domQuery,\r\n  queryAll as domQueryAll\r\n} from 'min-dom';\r\n\r\nimport {\r\n  BENDPOINT_CLS,\r\n  SEGMENT_DRAGGER_CLS,\r\n  addBendpoint,\r\n  addSegmentDragger,\r\n  calculateSegmentMoveRegion,\r\n  getConnectionIntersection\r\n} from './BendpointUtil';\r\n\r\nimport {\r\n  escapeCSS\r\n} from '../../util/EscapeUtil';\r\n\r\nimport {\r\n  pointsAligned,\r\n  getMidPoint\r\n} from '../../util/Geometry';\r\n\r\nimport {\r\n  isPrimaryButton\r\n} from '../../util/Mouse';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  translate\r\n} from '../../util/SvgTransformUtil';\r\n\r\n/**\r\n * @typedef {import('../bendpoints/BendpointMove').default} BendpointMove\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../bendpoints/ConnectionSegmentMove').default} ConnectionSegmentMove\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../interaction-events/InteractionEvents').default} InteractionEvents\r\n */\r\n\r\n/**\r\n * A service that adds editable bendpoints to connections.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {InteractionEvents} interactionEvents\r\n * @param {BendpointMove} bendpointMove\r\n * @param {ConnectionSegmentMove} connectionSegmentMove\r\n */\r\nexport default function Bendpoints(\r\n    eventBus, canvas, interactionEvents,\r\n    bendpointMove, connectionSegmentMove) {\r\n\r\n  /**\r\n   * Returns true if intersection point is inside middle region of segment, adjusted by\r\n   * optional threshold\r\n   */\r\n  function isIntersectionMiddle(intersection, waypoints, treshold) {\r\n    var idx = intersection.index,\r\n        p = intersection.point,\r\n        p0, p1, mid, aligned, xDelta, yDelta;\r\n\r\n    if (idx <= 0 || intersection.bendpoint) {\r\n      return false;\r\n    }\r\n\r\n    p0 = waypoints[idx - 1];\r\n    p1 = waypoints[idx];\r\n    mid = getMidPoint(p0, p1),\r\n    aligned = pointsAligned(p0, p1);\r\n    xDelta = Math.abs(p.x - mid.x);\r\n    yDelta = Math.abs(p.y - mid.y);\r\n\r\n    return aligned && xDelta <= treshold && yDelta <= treshold;\r\n  }\r\n\r\n  /**\r\n   * Calculates the threshold from a connection's middle which fits the two-third-region\r\n   */\r\n  function calculateIntersectionThreshold(connection, intersection) {\r\n    var waypoints = connection.waypoints,\r\n        relevantSegment, alignment, segmentLength, threshold;\r\n\r\n    if (intersection.index <= 0 || intersection.bendpoint) {\r\n      return null;\r\n    }\r\n\r\n    // segment relative to connection intersection\r\n    relevantSegment = {\r\n      start: waypoints[intersection.index - 1],\r\n      end: waypoints[intersection.index]\r\n    };\r\n\r\n    alignment = pointsAligned(relevantSegment.start, relevantSegment.end);\r\n\r\n    if (!alignment) {\r\n      return null;\r\n    }\r\n\r\n    if (alignment === 'h') {\r\n      segmentLength = relevantSegment.end.x - relevantSegment.start.x;\r\n    } else {\r\n      segmentLength = relevantSegment.end.y - relevantSegment.start.y;\r\n    }\r\n\r\n    // calculate threshold relative to 2/3 of segment length\r\n    threshold = calculateSegmentMoveRegion(segmentLength) / 2;\r\n\r\n    return threshold;\r\n  }\r\n\r\n  function activateBendpointMove(event, connection) {\r\n    var waypoints = connection.waypoints,\r\n        intersection = getConnectionIntersection(canvas, waypoints, event),\r\n        threshold;\r\n\r\n    if (!intersection) {\r\n      return;\r\n    }\r\n\r\n    threshold = calculateIntersectionThreshold(connection, intersection);\r\n\r\n    if (isIntersectionMiddle(intersection, waypoints, threshold)) {\r\n      connectionSegmentMove.start(event, connection, intersection.index);\r\n    } else {\r\n      bendpointMove.start(event, connection, intersection.index, !intersection.bendpoint);\r\n    }\r\n\r\n    // we've handled the event\r\n    return true;\r\n  }\r\n\r\n  function bindInteractionEvents(node, eventName, element) {\r\n\r\n    domEvent.bind(node, eventName, function(event) {\r\n      interactionEvents.triggerMouseEvent(eventName, event, element);\r\n      event.stopPropagation();\r\n    });\r\n  }\r\n\r\n  function getBendpointsContainer(element, create) {\r\n\r\n    var layer = canvas.getLayer('overlays'),\r\n        gfx = domQuery('.djs-bendpoints[data-element-id=\"' + escapeCSS(element.id) + '\"]', layer);\r\n\r\n    if (!gfx && create) {\r\n      gfx = svgCreate('g');\r\n      svgAttr(gfx, { 'data-element-id': element.id });\r\n      svgClasses(gfx).add('djs-bendpoints');\r\n\r\n      svgAppend(layer, gfx);\r\n\r\n      bindInteractionEvents(gfx, 'mousedown', element);\r\n      bindInteractionEvents(gfx, 'click', element);\r\n      bindInteractionEvents(gfx, 'dblclick', element);\r\n    }\r\n\r\n    return gfx;\r\n  }\r\n\r\n  function getSegmentDragger(idx, parentGfx) {\r\n    return domQuery(\r\n      '.djs-segment-dragger[data-segment-idx=\"' + idx + '\"]',\r\n      parentGfx\r\n    );\r\n  }\r\n\r\n  function createBendpoints(gfx, connection) {\r\n    connection.waypoints.forEach(function(p, idx) {\r\n      var bendpoint = addBendpoint(gfx);\r\n\r\n      svgAppend(gfx, bendpoint);\r\n\r\n      translate(bendpoint, p.x, p.y);\r\n    });\r\n\r\n    // add floating bendpoint\r\n    addBendpoint(gfx, 'floating');\r\n  }\r\n\r\n  function createSegmentDraggers(gfx, connection) {\r\n\r\n    var waypoints = connection.waypoints;\r\n\r\n    var segmentStart,\r\n        segmentEnd,\r\n        segmentDraggerGfx;\r\n\r\n    for (var i = 1; i < waypoints.length; i++) {\r\n\r\n      segmentStart = waypoints[i - 1];\r\n      segmentEnd = waypoints[i];\r\n\r\n      if (pointsAligned(segmentStart, segmentEnd)) {\r\n        segmentDraggerGfx = addSegmentDragger(gfx, segmentStart, segmentEnd);\r\n\r\n        svgAttr(segmentDraggerGfx, { 'data-segment-idx': i });\r\n\r\n        bindInteractionEvents(segmentDraggerGfx, 'mousemove', connection);\r\n      }\r\n    }\r\n  }\r\n\r\n  function clearBendpoints(gfx) {\r\n    forEach(domQueryAll('.' + BENDPOINT_CLS, gfx), function(node) {\r\n      svgRemove(node);\r\n    });\r\n  }\r\n\r\n  function clearSegmentDraggers(gfx) {\r\n    forEach(domQueryAll('.' + SEGMENT_DRAGGER_CLS, gfx), function(node) {\r\n      svgRemove(node);\r\n    });\r\n  }\r\n\r\n  function addHandles(connection) {\r\n\r\n    var gfx = getBendpointsContainer(connection);\r\n\r\n    if (!gfx) {\r\n      gfx = getBendpointsContainer(connection, true);\r\n\r\n      createBendpoints(gfx, connection);\r\n      createSegmentDraggers(gfx, connection);\r\n    }\r\n\r\n    return gfx;\r\n  }\r\n\r\n  function updateHandles(connection) {\r\n\r\n    var gfx = getBendpointsContainer(connection);\r\n\r\n    if (gfx) {\r\n      clearSegmentDraggers(gfx);\r\n      clearBendpoints(gfx);\r\n      createSegmentDraggers(gfx, connection);\r\n      createBendpoints(gfx, connection);\r\n    }\r\n  }\r\n\r\n  function updateFloatingBendpointPosition(parentGfx, intersection) {\r\n    var floating = domQuery('.floating', parentGfx),\r\n        point = intersection.point;\r\n\r\n    if (!floating) {\r\n      return;\r\n    }\r\n\r\n    translate(floating, point.x, point.y);\r\n\r\n  }\r\n\r\n  function updateSegmentDraggerPosition(parentGfx, intersection, waypoints) {\r\n\r\n    var draggerGfx = getSegmentDragger(intersection.index, parentGfx),\r\n        segmentStart = waypoints[intersection.index - 1],\r\n        segmentEnd = waypoints[intersection.index],\r\n        point = intersection.point,\r\n        mid = getMidPoint(segmentStart, segmentEnd),\r\n        alignment = pointsAligned(segmentStart, segmentEnd),\r\n        draggerVisual, relativePosition;\r\n\r\n    if (!draggerGfx) {\r\n      return;\r\n    }\r\n\r\n    draggerVisual = getDraggerVisual(draggerGfx);\r\n\r\n    relativePosition = {\r\n      x: point.x - mid.x,\r\n      y: point.y - mid.y\r\n    };\r\n\r\n    if (alignment === 'v') {\r\n\r\n      // rotate position\r\n      relativePosition = {\r\n        x: relativePosition.y,\r\n        y: relativePosition.x\r\n      };\r\n    }\r\n\r\n    translate(draggerVisual, relativePosition.x, relativePosition.y);\r\n  }\r\n\r\n  eventBus.on('connection.changed', function(event) {\r\n    updateHandles(event.element);\r\n  });\r\n\r\n  eventBus.on('connection.remove', function(event) {\r\n    var gfx = getBendpointsContainer(event.element);\r\n\r\n    if (gfx) {\r\n      svgRemove(gfx);\r\n    }\r\n  });\r\n\r\n  eventBus.on('element.marker.update', function(event) {\r\n\r\n    var element = event.element,\r\n        bendpointsGfx;\r\n\r\n    if (!element.waypoints) {\r\n      return;\r\n    }\r\n\r\n    bendpointsGfx = addHandles(element);\r\n\r\n    if (event.add) {\r\n      svgClasses(bendpointsGfx).add(event.marker);\r\n    } else {\r\n      svgClasses(bendpointsGfx).remove(event.marker);\r\n    }\r\n  });\r\n\r\n  eventBus.on('element.mousemove', function(event) {\r\n\r\n    var element = event.element,\r\n        waypoints = element.waypoints,\r\n        bendpointsGfx,\r\n        intersection;\r\n\r\n    if (waypoints) {\r\n      bendpointsGfx = getBendpointsContainer(element, true);\r\n\r\n      intersection = getConnectionIntersection(canvas, waypoints, event.originalEvent);\r\n\r\n      if (!intersection) {\r\n        return;\r\n      }\r\n\r\n      updateFloatingBendpointPosition(bendpointsGfx, intersection);\r\n\r\n      if (!intersection.bendpoint) {\r\n        updateSegmentDraggerPosition(bendpointsGfx, intersection, waypoints);\r\n      }\r\n\r\n    }\r\n  });\r\n\r\n  eventBus.on('element.mousedown', function(event) {\r\n\r\n    if (!isPrimaryButton(event)) {\r\n      return;\r\n    }\r\n\r\n    var originalEvent = event.originalEvent,\r\n        element = event.element;\r\n\r\n    if (!element.waypoints) {\r\n      return;\r\n    }\r\n\r\n    return activateBendpointMove(originalEvent, element);\r\n  });\r\n\r\n  eventBus.on('selection.changed', function(event) {\r\n    var newSelection = event.newSelection,\r\n        primary = newSelection[0];\r\n\r\n    if (primary && primary.waypoints) {\r\n      addHandles(primary);\r\n    }\r\n  });\r\n\r\n  eventBus.on('element.hover', function(event) {\r\n    var element = event.element;\r\n\r\n    if (element.waypoints) {\r\n      addHandles(element);\r\n      interactionEvents.registerEvent(event.gfx, 'mousemove', 'element.mousemove');\r\n    }\r\n  });\r\n\r\n  eventBus.on('element.out', function(event) {\r\n    interactionEvents.unregisterEvent(event.gfx, 'mousemove', 'element.mousemove');\r\n  });\r\n\r\n  // update bendpoint container data attribute on element ID change\r\n  eventBus.on('element.updateId', function(context) {\r\n    var element = context.element,\r\n        newId = context.newId;\r\n\r\n    if (element.waypoints) {\r\n      var bendpointContainer = getBendpointsContainer(element);\r\n\r\n      if (bendpointContainer) {\r\n        svgAttr(bendpointContainer, { 'data-element-id': newId });\r\n      }\r\n    }\r\n  });\r\n\r\n  // API\r\n\r\n  this.addHandles = addHandles;\r\n  this.updateHandles = updateHandles;\r\n  this.getBendpointsContainer = getBendpointsContainer;\r\n  this.getSegmentDragger = getSegmentDragger;\r\n}\r\n\r\nBendpoints.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'interactionEvents',\r\n  'bendpointMove',\r\n  'connectionSegmentMove'\r\n];\r\n\r\n\r\n\r\n// helper /////////////\r\n\r\nfunction getDraggerVisual(draggerGfx) {\r\n  return domQuery('.djs-visual', draggerGfx);\r\n}","import { filterRedundantWaypoints } from '../../layout/LayoutUtil';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n */\r\n\r\nvar round = Math.round;\r\n\r\nvar RECONNECT_START = 'reconnectStart',\r\n    RECONNECT_END = 'reconnectEnd',\r\n    UPDATE_WAYPOINTS = 'updateWaypoints';\r\n\r\n\r\n/**\r\n * Move bendpoints through drag and drop to add/remove bendpoints or reconnect connection.\r\n *\r\n * @param {Injector} injector\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Dragging} dragging\r\n * @param {Rules} rules\r\n * @param {Modeling} modeling\r\n */\r\nexport default function BendpointMove(injector, eventBus, canvas, dragging, rules, modeling) {\r\n  this._injector = injector;\r\n\r\n  this.start = function(event, connection, bendpointIndex, insert) {\r\n    var gfx = canvas.getGraphics(connection),\r\n        source = connection.source,\r\n        target = connection.target,\r\n        waypoints = connection.waypoints,\r\n        type;\r\n\r\n    if (!insert && bendpointIndex === 0) {\r\n      type = RECONNECT_START;\r\n    } else if (!insert && bendpointIndex === waypoints.length - 1) {\r\n      type = RECONNECT_END;\r\n    } else {\r\n      type = UPDATE_WAYPOINTS;\r\n    }\r\n\r\n    var command = type === UPDATE_WAYPOINTS ? 'connection.updateWaypoints' : 'connection.reconnect';\r\n\r\n    var allowed = rules.allowed(command, {\r\n      connection: connection,\r\n      source: source,\r\n      target: target\r\n    });\r\n\r\n    if (allowed === false) {\r\n      allowed = rules.allowed(command, {\r\n        connection: connection,\r\n        source: target,\r\n        target: source\r\n      });\r\n    }\r\n\r\n    if (allowed === false) {\r\n      return;\r\n    }\r\n\r\n    dragging.init(event, 'bendpoint.move', {\r\n      data: {\r\n        connection: connection,\r\n        connectionGfx: gfx,\r\n        context: {\r\n          allowed: allowed,\r\n          bendpointIndex: bendpointIndex,\r\n          connection: connection,\r\n          source: source,\r\n          target: target,\r\n          insert: insert,\r\n          type: type\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  eventBus.on('bendpoint.move.hover', function(event) {\r\n    var context = event.context,\r\n        connection = context.connection,\r\n        source = connection.source,\r\n        target = connection.target,\r\n        hover = event.hover,\r\n        type = context.type;\r\n\r\n    // cache hover state\r\n    context.hover = hover;\r\n\r\n    var allowed;\r\n\r\n    if (!hover) {\r\n      return;\r\n    }\r\n\r\n    var command = type === UPDATE_WAYPOINTS ? 'connection.updateWaypoints' : 'connection.reconnect';\r\n\r\n    allowed = context.allowed = rules.allowed(command, {\r\n      connection: connection,\r\n      source: type === RECONNECT_START ? hover : source,\r\n      target: type === RECONNECT_END ? hover : target\r\n    });\r\n\r\n    if (allowed) {\r\n      context.source = type === RECONNECT_START ? hover : source;\r\n      context.target = type === RECONNECT_END ? hover : target;\r\n\r\n      return;\r\n    }\r\n\r\n    if (allowed === false) {\r\n      allowed = context.allowed = rules.allowed(command, {\r\n        connection: connection,\r\n        source: type === RECONNECT_END ? hover : target,\r\n        target: type === RECONNECT_START ? hover : source\r\n      });\r\n    }\r\n\r\n    if (allowed) {\r\n      context.source = type === RECONNECT_END ? hover : target;\r\n      context.target = type === RECONNECT_START ? hover : source;\r\n    }\r\n  });\r\n\r\n  eventBus.on([ 'bendpoint.move.out', 'bendpoint.move.cleanup' ], function(event) {\r\n    var context = event.context,\r\n        type = context.type;\r\n\r\n    context.hover = null;\r\n    context.source = null;\r\n    context.target = null;\r\n\r\n    if (type !== UPDATE_WAYPOINTS) {\r\n      context.allowed = false;\r\n    }\r\n  });\r\n\r\n  eventBus.on('bendpoint.move.end', function(event) {\r\n    var context = event.context,\r\n        allowed = context.allowed,\r\n        bendpointIndex = context.bendpointIndex,\r\n        connection = context.connection,\r\n        insert = context.insert,\r\n        newWaypoints = connection.waypoints.slice(),\r\n        source = context.source,\r\n        target = context.target,\r\n        type = context.type,\r\n        hints = context.hints || {};\r\n\r\n    // ensure integer values (important if zoom level was > 1 during move)\r\n    var docking = {\r\n      x: round(event.x),\r\n      y: round(event.y)\r\n    };\r\n\r\n    if (!allowed) {\r\n      return false;\r\n    }\r\n\r\n    if (type === UPDATE_WAYPOINTS) {\r\n      if (insert) {\r\n\r\n        // insert new bendpoint\r\n        newWaypoints.splice(bendpointIndex, 0, docking);\r\n      } else {\r\n\r\n        // swap previous waypoint with moved one\r\n        newWaypoints[bendpointIndex] = docking;\r\n      }\r\n\r\n      // pass hints about actual moved bendpoint\r\n      // useful for connection/label layout\r\n      hints.bendpointMove = {\r\n        insert: insert,\r\n        bendpointIndex: bendpointIndex\r\n      };\r\n\r\n      newWaypoints = this.cropWaypoints(connection, newWaypoints);\r\n\r\n      modeling.updateWaypoints(connection, filterRedundantWaypoints(newWaypoints), hints);\r\n    } else {\r\n      if (type === RECONNECT_START) {\r\n        hints.docking = 'source';\r\n\r\n        if (isReverse(context)) {\r\n          hints.docking = 'target';\r\n\r\n          hints.newWaypoints = newWaypoints.reverse();\r\n        }\r\n      } else if (type === RECONNECT_END) {\r\n        hints.docking = 'target';\r\n\r\n        if (isReverse(context)) {\r\n          hints.docking = 'source';\r\n\r\n          hints.newWaypoints = newWaypoints.reverse();\r\n        }\r\n      }\r\n\r\n      modeling.reconnect(connection, source, target, docking, hints);\r\n    }\r\n  }, this);\r\n}\r\n\r\nBendpointMove.$inject = [\r\n  'injector',\r\n  'eventBus',\r\n  'canvas',\r\n  'dragging',\r\n  'rules',\r\n  'modeling'\r\n];\r\n\r\nBendpointMove.prototype.cropWaypoints = function(connection, newWaypoints) {\r\n  var connectionDocking = this._injector.get('connectionDocking', false);\r\n\r\n  if (!connectionDocking) {\r\n    return newWaypoints;\r\n  }\r\n\r\n  var waypoints = connection.waypoints;\r\n\r\n  connection.waypoints = newWaypoints;\r\n\r\n  connection.waypoints = connectionDocking.getCroppedWaypoints(connection);\r\n\r\n  newWaypoints = connection.waypoints;\r\n\r\n  connection.waypoints = waypoints;\r\n\r\n  return newWaypoints;\r\n};\r\n\r\n\r\n// helpers //////////\r\n\r\nexport function isReverse(context) {\r\n  var hover = context.hover,\r\n      source = context.source,\r\n      target = context.target,\r\n      type = context.type;\r\n\r\n  if (type === RECONNECT_START) {\r\n    return hover && target && hover === target && source !== target;\r\n  }\r\n\r\n  if (type === RECONNECT_END) {\r\n    return hover && source && hover === source && source !== target;\r\n  }\r\n}","import {\r\n  classes as svgClasses,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport { addBendpoint } from './BendpointUtil';\r\n\r\nimport { translate } from '../../util/SvgTransformUtil';\r\n\r\nimport { isReverse } from './BendpointMove';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../bendpoints/BendpointMove').default} BendpointMove\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\nvar RECONNECT_START = 'reconnectStart',\r\n    RECONNECT_END = 'reconnectEnd',\r\n    UPDATE_WAYPOINTS = 'updateWaypoints';\r\n\r\nvar MARKER_OK = 'connect-ok',\r\n    MARKER_NOT_OK = 'connect-not-ok',\r\n    MARKER_CONNECT_HOVER = 'connect-hover',\r\n    MARKER_CONNECT_UPDATING = 'djs-updating',\r\n    MARKER_DRAGGER = 'djs-dragging';\r\n\r\nvar HIGH_PRIORITY = 1100;\r\n\r\n/**\r\n * Preview connection while moving bendpoints.\r\n *\r\n * @param {BendpointMove} bendpointMove\r\n * @param {Injector} injector\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function BendpointMovePreview(bendpointMove, injector, eventBus, canvas) {\r\n  this._injector = injector;\r\n\r\n  var connectionPreview = injector.get('connectionPreview', false);\r\n\r\n  eventBus.on('bendpoint.move.start', function(event) {\r\n    var context = event.context,\r\n        bendpointIndex = context.bendpointIndex,\r\n        connection = context.connection,\r\n        insert = context.insert,\r\n        waypoints = connection.waypoints,\r\n        newWaypoints = waypoints.slice();\r\n\r\n    context.waypoints = waypoints;\r\n\r\n    if (insert) {\r\n\r\n      // insert placeholder for new bendpoint\r\n      newWaypoints.splice(bendpointIndex, 0, { x: event.x, y: event.y });\r\n    }\r\n\r\n    connection.waypoints = newWaypoints;\r\n\r\n    // add dragger gfx\r\n    var draggerGfx = context.draggerGfx = addBendpoint(canvas.getLayer('overlays'));\r\n\r\n    svgClasses(draggerGfx).add('djs-dragging');\r\n\r\n    canvas.addMarker(connection, MARKER_DRAGGER);\r\n    canvas.addMarker(connection, MARKER_CONNECT_UPDATING);\r\n  });\r\n\r\n  eventBus.on('bendpoint.move.hover', function(event) {\r\n    var context = event.context,\r\n        allowed = context.allowed,\r\n        hover = context.hover,\r\n        type = context.type;\r\n\r\n    if (hover) {\r\n      canvas.addMarker(hover, MARKER_CONNECT_HOVER);\r\n\r\n      if (type === UPDATE_WAYPOINTS) {\r\n        return;\r\n      }\r\n\r\n      if (allowed) {\r\n        canvas.removeMarker(hover, MARKER_NOT_OK);\r\n        canvas.addMarker(hover, MARKER_OK);\r\n      } else if (allowed === false) {\r\n        canvas.removeMarker(hover, MARKER_OK);\r\n        canvas.addMarker(hover, MARKER_NOT_OK);\r\n      }\r\n    }\r\n  });\r\n\r\n  eventBus.on([\r\n    'bendpoint.move.out',\r\n    'bendpoint.move.cleanup'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        hover = context.hover,\r\n        target = context.target;\r\n\r\n    if (hover) {\r\n      canvas.removeMarker(hover, MARKER_CONNECT_HOVER);\r\n      canvas.removeMarker(hover, target ? MARKER_OK : MARKER_NOT_OK);\r\n    }\r\n  });\r\n\r\n  eventBus.on('bendpoint.move.move', function(event) {\r\n    var context = event.context,\r\n        allowed = context.allowed,\r\n        bendpointIndex = context.bendpointIndex,\r\n        draggerGfx = context.draggerGfx,\r\n        hover = context.hover,\r\n        type = context.type,\r\n        connection = context.connection,\r\n        source = connection.source,\r\n        target = connection.target,\r\n        newWaypoints = connection.waypoints.slice(),\r\n        bendpoint = { x: event.x, y: event.y },\r\n        hints = context.hints || {},\r\n        drawPreviewHints = {};\r\n\r\n    if (connectionPreview) {\r\n      if (hints.connectionStart) {\r\n        drawPreviewHints.connectionStart = hints.connectionStart;\r\n      }\r\n\r\n      if (hints.connectionEnd) {\r\n        drawPreviewHints.connectionEnd = hints.connectionEnd;\r\n      }\r\n\r\n\r\n      if (type === RECONNECT_START) {\r\n        if (isReverse(context)) {\r\n          drawPreviewHints.connectionEnd = drawPreviewHints.connectionEnd || bendpoint;\r\n\r\n          drawPreviewHints.source = target;\r\n          drawPreviewHints.target = hover || source;\r\n\r\n          newWaypoints = newWaypoints.reverse();\r\n        } else {\r\n          drawPreviewHints.connectionStart = drawPreviewHints.connectionStart || bendpoint;\r\n\r\n          drawPreviewHints.source = hover || source;\r\n          drawPreviewHints.target = target;\r\n        }\r\n      } else if (type === RECONNECT_END) {\r\n        if (isReverse(context)) {\r\n          drawPreviewHints.connectionStart = drawPreviewHints.connectionStart || bendpoint;\r\n\r\n          drawPreviewHints.source = hover || target;\r\n          drawPreviewHints.target = source;\r\n\r\n          newWaypoints = newWaypoints.reverse();\r\n        } else {\r\n          drawPreviewHints.connectionEnd = drawPreviewHints.connectionEnd || bendpoint;\r\n\r\n          drawPreviewHints.source = source;\r\n          drawPreviewHints.target = hover || target;\r\n        }\r\n\r\n      } else {\r\n        drawPreviewHints.noCropping = true;\r\n        drawPreviewHints.noLayout = true;\r\n        newWaypoints[ bendpointIndex ] = bendpoint;\r\n      }\r\n\r\n      if (type === UPDATE_WAYPOINTS) {\r\n        newWaypoints = bendpointMove.cropWaypoints(connection, newWaypoints);\r\n      }\r\n\r\n      drawPreviewHints.waypoints = newWaypoints;\r\n\r\n      connectionPreview.drawPreview(context, allowed, drawPreviewHints);\r\n    }\r\n\r\n    translate(draggerGfx, event.x, event.y);\r\n  }, this);\r\n\r\n  eventBus.on([\r\n    'bendpoint.move.end',\r\n    'bendpoint.move.cancel'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        connection = context.connection,\r\n        draggerGfx = context.draggerGfx,\r\n        hover = context.hover,\r\n        target = context.target,\r\n        waypoints = context.waypoints;\r\n\r\n    connection.waypoints = waypoints;\r\n\r\n    // remove dragger gfx\r\n    svgRemove(draggerGfx);\r\n\r\n    canvas.removeMarker(connection, MARKER_CONNECT_UPDATING);\r\n    canvas.removeMarker(connection, MARKER_DRAGGER);\r\n\r\n    if (hover) {\r\n      canvas.removeMarker(hover, MARKER_OK);\r\n      canvas.removeMarker(hover, target ? MARKER_OK : MARKER_NOT_OK);\r\n    }\r\n\r\n    if (connectionPreview) {\r\n      connectionPreview.cleanUp(context);\r\n    }\r\n  });\r\n}\r\n\r\nBendpointMovePreview.$inject = [\r\n  'bendpointMove',\r\n  'injector',\r\n  'eventBus',\r\n  'canvas'\r\n];","import {\r\n  pointsAligned,\r\n  pointsOnLine\r\n} from '../../util/Geometry';\r\n\r\nimport {\r\n  addSegmentDragger,\r\n  getConnectionIntersection\r\n} from './BendpointUtil';\r\n\r\nimport {\r\n  getMid,\r\n  getOrientation\r\n} from '../../layout/LayoutUtil';\r\n\r\nvar MARKER_CONNECT_HOVER = 'connect-hover',\r\n    MARKER_CONNECT_UPDATING = 'djs-updating';\r\n\r\nimport {\r\n  classes as svgClasses,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  translate\r\n} from '../../util/SvgTransformUtil';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../../util/Types').Axis} Axis\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../core/GraphicsFactory').default} GraphicsFactory\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n */\r\n\r\nfunction axisAdd(point, axis, delta) {\r\n  return axisSet(point, axis, point[axis] + delta);\r\n}\r\n\r\nfunction axisSet(point, axis, value) {\r\n  return {\r\n    x: (axis === 'x' ? value : point.x),\r\n    y: (axis === 'y' ? value : point.y)\r\n  };\r\n}\r\n\r\nfunction axisFenced(position, segmentStart, segmentEnd, axis) {\r\n\r\n  var maxValue = Math.max(segmentStart[axis], segmentEnd[axis]),\r\n      minValue = Math.min(segmentStart[axis], segmentEnd[axis]);\r\n\r\n  var padding = 20;\r\n\r\n  var fencedValue = Math.min(Math.max(minValue + padding, position[axis]), maxValue - padding);\r\n\r\n  return axisSet(segmentStart, axis, fencedValue);\r\n}\r\n\r\nfunction flipAxis(axis) {\r\n  return axis === 'x' ? 'y' : 'x';\r\n}\r\n\r\n/**\r\n * Get the docking point on the given element.\r\n *\r\n * Compute a reasonable docking, if non exists.\r\n *\r\n * @param {Point} point\r\n * @param {Shape} referenceElement\r\n * @param {Axis} moveAxis\r\n *\r\n * @return {Point}\r\n */\r\nfunction getDocking(point, referenceElement, moveAxis) {\r\n\r\n  var referenceMid,\r\n      inverseAxis;\r\n\r\n  if (point.original) {\r\n    return point.original;\r\n  } else {\r\n    referenceMid = getMid(referenceElement);\r\n    inverseAxis = flipAxis(moveAxis);\r\n\r\n    return axisSet(point, inverseAxis, referenceMid[inverseAxis]);\r\n  }\r\n}\r\n\r\n/**\r\n * A component that implements moving of bendpoints.\r\n *\r\n * @param {Injector} injector\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Canvas} dragging\r\n * @param {GraphicsFactory} graphicsFactory\r\n * @param {Modeling} modeling\r\n */\r\nexport default function ConnectionSegmentMove(\r\n    injector, eventBus, canvas,\r\n    dragging, graphicsFactory, modeling) {\r\n\r\n  // optional connection docking integration\r\n  var connectionDocking = injector.get('connectionDocking', false);\r\n\r\n\r\n  // API\r\n\r\n  this.start = function(event, connection, idx) {\r\n\r\n    var context,\r\n        gfx = canvas.getGraphics(connection),\r\n        segmentStartIndex = idx - 1,\r\n        segmentEndIndex = idx,\r\n        waypoints = connection.waypoints,\r\n        segmentStart = waypoints[segmentStartIndex],\r\n        segmentEnd = waypoints[segmentEndIndex],\r\n        intersection = getConnectionIntersection(canvas, waypoints, event),\r\n        direction, axis, dragPosition;\r\n\r\n    direction = pointsAligned(segmentStart, segmentEnd);\r\n\r\n    // do not move diagonal connection\r\n    if (!direction) {\r\n      return;\r\n    }\r\n\r\n    // the axis where we are going to move things\r\n    axis = direction === 'v' ? 'x' : 'y';\r\n\r\n    if (segmentStartIndex === 0) {\r\n      segmentStart = getDocking(segmentStart, connection.source, axis);\r\n    }\r\n\r\n    if (segmentEndIndex === waypoints.length - 1) {\r\n      segmentEnd = getDocking(segmentEnd, connection.target, axis);\r\n    }\r\n\r\n    if (intersection) {\r\n      dragPosition = intersection.point;\r\n    } else {\r\n\r\n      // set to segment center as default\r\n      dragPosition = {\r\n        x: (segmentStart.x + segmentEnd.x) / 2,\r\n        y: (segmentStart.y + segmentEnd.y) / 2\r\n      };\r\n    }\r\n\r\n    context = {\r\n      connection: connection,\r\n      segmentStartIndex: segmentStartIndex,\r\n      segmentEndIndex: segmentEndIndex,\r\n      segmentStart: segmentStart,\r\n      segmentEnd: segmentEnd,\r\n      axis: axis,\r\n      dragPosition: dragPosition\r\n    };\r\n\r\n    dragging.init(event, dragPosition, 'connectionSegment.move', {\r\n      cursor: axis === 'x' ? 'resize-ew' : 'resize-ns',\r\n      data: {\r\n        connection: connection,\r\n        connectionGfx: gfx,\r\n        context: context\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Crop connection if connection cropping is provided.\r\n   *\r\n   * @param {Connection} connection\r\n   * @param {Point[]} newWaypoints\r\n   *\r\n   * @return {Point[]} cropped connection waypoints\r\n   */\r\n  function cropConnection(connection, newWaypoints) {\r\n\r\n    // crop connection, if docking service is provided only\r\n    if (!connectionDocking) {\r\n      return newWaypoints;\r\n    }\r\n\r\n    var oldWaypoints = connection.waypoints,\r\n        croppedWaypoints;\r\n\r\n    // temporary set new waypoints\r\n    connection.waypoints = newWaypoints;\r\n\r\n    croppedWaypoints = connectionDocking.getCroppedWaypoints(connection);\r\n\r\n    // restore old waypoints\r\n    connection.waypoints = oldWaypoints;\r\n\r\n    return croppedWaypoints;\r\n  }\r\n\r\n  // DRAGGING IMPLEMENTATION\r\n\r\n  function redrawConnection(data) {\r\n    graphicsFactory.update('connection', data.connection, data.connectionGfx);\r\n  }\r\n\r\n  function updateDragger(context, segmentOffset, event) {\r\n\r\n    var newWaypoints = context.newWaypoints,\r\n        segmentStartIndex = context.segmentStartIndex + segmentOffset,\r\n        segmentStart = newWaypoints[segmentStartIndex],\r\n        segmentEndIndex = context.segmentEndIndex + segmentOffset,\r\n        segmentEnd = newWaypoints[segmentEndIndex],\r\n        axis = flipAxis(context.axis);\r\n\r\n    // make sure the dragger does not move\r\n    // outside the connection\r\n    var draggerPosition = axisFenced(event, segmentStart, segmentEnd, axis);\r\n\r\n    // update dragger\r\n    translate(context.draggerGfx, draggerPosition.x, draggerPosition.y);\r\n  }\r\n\r\n  /**\r\n   * Filter waypoints for redundant ones (i.e. on the same axis).\r\n   * Returns the filtered waypoints and the offset related to the segment move.\r\n   *\r\n   * @param {Point[]} waypoints\r\n   * @param {Integer} segmentStartIndex of moved segment start\r\n   *\r\n   * @return {Object} { filteredWaypoints, segmentOffset }\r\n   */\r\n  function filterRedundantWaypoints(waypoints, segmentStartIndex) {\r\n\r\n    var segmentOffset = 0;\r\n\r\n    var filteredWaypoints = waypoints.filter(function(r, idx) {\r\n      if (pointsOnLine(waypoints[idx - 1], waypoints[idx + 1], r)) {\r\n\r\n        // remove point and increment offset\r\n        segmentOffset = idx <= segmentStartIndex ? segmentOffset - 1 : segmentOffset;\r\n        return false;\r\n      }\r\n\r\n      // dont remove point\r\n      return true;\r\n    });\r\n\r\n    return {\r\n      waypoints: filteredWaypoints,\r\n      segmentOffset: segmentOffset\r\n    };\r\n  }\r\n\r\n  eventBus.on('connectionSegment.move.start', function(event) {\r\n\r\n    var context = event.context,\r\n        connection = event.connection,\r\n        layer = canvas.getLayer('overlays');\r\n\r\n    context.originalWaypoints = connection.waypoints.slice();\r\n\r\n    // add dragger gfx\r\n    context.draggerGfx = addSegmentDragger(layer, context.segmentStart, context.segmentEnd);\r\n    svgClasses(context.draggerGfx).add('djs-dragging');\r\n\r\n    canvas.addMarker(connection, MARKER_CONNECT_UPDATING);\r\n  });\r\n\r\n  eventBus.on('connectionSegment.move.move', function(event) {\r\n\r\n    var context = event.context,\r\n        connection = context.connection,\r\n        segmentStartIndex = context.segmentStartIndex,\r\n        segmentEndIndex = context.segmentEndIndex,\r\n        segmentStart = context.segmentStart,\r\n        segmentEnd = context.segmentEnd,\r\n        axis = context.axis;\r\n\r\n    var newWaypoints = context.originalWaypoints.slice(),\r\n        newSegmentStart = axisAdd(segmentStart, axis, event['d' + axis]),\r\n        newSegmentEnd = axisAdd(segmentEnd, axis, event['d' + axis]);\r\n\r\n    // original waypoint count and added / removed\r\n    // from start waypoint delta. We use the later\r\n    // to retrieve the updated segmentStartIndex / segmentEndIndex\r\n    var waypointCount = newWaypoints.length,\r\n        segmentOffset = 0;\r\n\r\n    // move segment start / end by axis delta\r\n    newWaypoints[segmentStartIndex] = newSegmentStart;\r\n    newWaypoints[segmentEndIndex] = newSegmentEnd;\r\n\r\n    var sourceToSegmentOrientation,\r\n        targetToSegmentOrientation;\r\n\r\n    // handle first segment\r\n    if (segmentStartIndex < 2) {\r\n      sourceToSegmentOrientation = getOrientation(connection.source, newSegmentStart);\r\n\r\n      // first bendpoint, remove first segment if intersecting\r\n      if (segmentStartIndex === 1) {\r\n\r\n        if (sourceToSegmentOrientation === 'intersect') {\r\n          newWaypoints.shift();\r\n          newWaypoints[0] = newSegmentStart;\r\n          segmentOffset--;\r\n        }\r\n      }\r\n\r\n      // docking point, add segment if not intersecting anymore\r\n      else {\r\n        if (sourceToSegmentOrientation !== 'intersect') {\r\n          newWaypoints.unshift(segmentStart);\r\n          segmentOffset++;\r\n        }\r\n      }\r\n    }\r\n\r\n    // handle last segment\r\n    if (segmentEndIndex > waypointCount - 3) {\r\n      targetToSegmentOrientation = getOrientation(connection.target, newSegmentEnd);\r\n\r\n      // last bendpoint, remove last segment if intersecting\r\n      if (segmentEndIndex === waypointCount - 2) {\r\n\r\n        if (targetToSegmentOrientation === 'intersect') {\r\n          newWaypoints.pop();\r\n          newWaypoints[newWaypoints.length - 1] = newSegmentEnd;\r\n        }\r\n      }\r\n\r\n      // last bendpoint, remove last segment if intersecting\r\n      else {\r\n        if (targetToSegmentOrientation !== 'intersect') {\r\n          newWaypoints.push(segmentEnd);\r\n        }\r\n      }\r\n    }\r\n\r\n    // update connection waypoints\r\n    context.newWaypoints = connection.waypoints = cropConnection(connection, newWaypoints);\r\n\r\n    // update dragger position\r\n    updateDragger(context, segmentOffset, event);\r\n\r\n    // save segmentOffset in context\r\n    context.newSegmentStartIndex = segmentStartIndex + segmentOffset;\r\n\r\n    // redraw connection\r\n    redrawConnection(event);\r\n  });\r\n\r\n  eventBus.on('connectionSegment.move.hover', function(event) {\r\n\r\n    event.context.hover = event.hover;\r\n    canvas.addMarker(event.hover, MARKER_CONNECT_HOVER);\r\n  });\r\n\r\n  eventBus.on([\r\n    'connectionSegment.move.out',\r\n    'connectionSegment.move.cleanup'\r\n  ], function(event) {\r\n\r\n    // remove connect marker\r\n    // if it was added\r\n    var hover = event.context.hover;\r\n\r\n    if (hover) {\r\n      canvas.removeMarker(hover, MARKER_CONNECT_HOVER);\r\n    }\r\n  });\r\n\r\n  eventBus.on('connectionSegment.move.cleanup', function(event) {\r\n\r\n    var context = event.context,\r\n        connection = context.connection;\r\n\r\n    // remove dragger gfx\r\n    if (context.draggerGfx) {\r\n      svgRemove(context.draggerGfx);\r\n    }\r\n\r\n    canvas.removeMarker(connection, MARKER_CONNECT_UPDATING);\r\n  });\r\n\r\n  eventBus.on([\r\n    'connectionSegment.move.cancel',\r\n    'connectionSegment.move.end'\r\n  ], function(event) {\r\n    var context = event.context,\r\n        connection = context.connection;\r\n\r\n    connection.waypoints = context.originalWaypoints;\r\n\r\n    redrawConnection(event);\r\n  });\r\n\r\n  eventBus.on('connectionSegment.move.end', function(event) {\r\n\r\n    var context = event.context,\r\n        connection = context.connection,\r\n        newWaypoints = context.newWaypoints,\r\n        newSegmentStartIndex = context.newSegmentStartIndex;\r\n\r\n    // ensure we have actual pixel values bendpoint\r\n    // coordinates (important when zoom level was > 1 during move)\r\n    newWaypoints = newWaypoints.map(function(p) {\r\n      return {\r\n        original: p.original,\r\n        x: Math.round(p.x),\r\n        y: Math.round(p.y)\r\n      };\r\n    });\r\n\r\n    // apply filter redunant waypoints\r\n    var filtered = filterRedundantWaypoints(newWaypoints, newSegmentStartIndex);\r\n\r\n    // get filtered waypoints\r\n    var filteredWaypoints = filtered.waypoints,\r\n        croppedWaypoints = cropConnection(connection, filteredWaypoints),\r\n        segmentOffset = filtered.segmentOffset;\r\n\r\n    var hints = {\r\n      segmentMove: {\r\n        segmentStartIndex: context.segmentStartIndex,\r\n        newSegmentStartIndex: newSegmentStartIndex + segmentOffset\r\n      }\r\n    };\r\n\r\n    modeling.updateWaypoints(connection, croppedWaypoints, hints);\r\n  });\r\n}\r\n\r\nConnectionSegmentMove.$inject = [\r\n  'injector',\r\n  'eventBus',\r\n  'canvas',\r\n  'dragging',\r\n  'graphicsFactory',\r\n  'modeling'\r\n];\r\n","/**\r\n * @typedef {import('../../core/Types').ConnectionLike} Connection\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../core/EventBus').Event} Event\r\n *\r\n * @typedef {import('../../util/Types').Axis} Axis\r\n */\r\n\r\nvar abs = Math.abs,\r\n    round = Math.round;\r\n\r\n\r\n/**\r\n * Snap value to a collection of reference values.\r\n *\r\n * @param {number} value\r\n * @param {Array<number>} values\r\n * @param {number} [tolerance=10]\r\n *\r\n * @return {number} the value we snapped to or null, if none snapped\r\n */\r\nexport function snapTo(value, values, tolerance) {\r\n  tolerance = tolerance === undefined ? 10 : tolerance;\r\n\r\n  var idx, snapValue;\r\n\r\n  for (idx = 0; idx < values.length; idx++) {\r\n    snapValue = values[idx];\r\n\r\n    if (abs(snapValue - value) <= tolerance) {\r\n      return snapValue;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport function topLeft(bounds) {\r\n  return {\r\n    x: bounds.x,\r\n    y: bounds.y\r\n  };\r\n}\r\n\r\nexport function topRight(bounds) {\r\n  return {\r\n    x: bounds.x + bounds.width,\r\n    y: bounds.y\r\n  };\r\n}\r\n\r\nexport function bottomLeft(bounds) {\r\n  return {\r\n    x: bounds.x,\r\n    y: bounds.y + bounds.height\r\n  };\r\n}\r\n\r\nexport function bottomRight(bounds) {\r\n  return {\r\n    x: bounds.x + bounds.width,\r\n    y: bounds.y + bounds.height\r\n  };\r\n}\r\n\r\nexport function mid(bounds, defaultValue) {\r\n\r\n  if (!bounds || isNaN(bounds.x) || isNaN(bounds.y)) {\r\n    return defaultValue;\r\n  }\r\n\r\n  return {\r\n    x: round(bounds.x + bounds.width / 2),\r\n    y: round(bounds.y + bounds.height / 2)\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Retrieve the snap state of the given event.\r\n *\r\n * @param {Event} event\r\n * @param {Axis} axis\r\n *\r\n * @return {boolean} the snapped state\r\n *\r\n */\r\nexport function isSnapped(event, axis) {\r\n  var snapped = event.snapped;\r\n\r\n  if (!snapped) {\r\n    return false;\r\n  }\r\n\r\n  if (typeof axis === 'string') {\r\n    return snapped[axis];\r\n  }\r\n\r\n  return snapped.x && snapped.y;\r\n}\r\n\r\n\r\n/**\r\n * Set the given event as snapped.\r\n *\r\n * This method may change the x and/or y position of the shape\r\n * from the given event!\r\n *\r\n * @param {Event} event\r\n * @param {Axis} axis\r\n * @param {number|boolean} value\r\n *\r\n * @return {number} old value\r\n */\r\nexport function setSnapped(event, axis, value) {\r\n  if (typeof axis !== 'string') {\r\n    throw new Error('axis must be in [x, y]');\r\n  }\r\n\r\n  if (typeof value !== 'number' && value !== false) {\r\n    throw new Error('value must be Number or false');\r\n  }\r\n\r\n  var delta,\r\n      previousValue = event[axis];\r\n\r\n  var snapped = event.snapped = (event.snapped || {});\r\n\r\n\r\n  if (value === false) {\r\n    snapped[axis] = false;\r\n  } else {\r\n    snapped[axis] = true;\r\n\r\n    delta = value - previousValue;\r\n\r\n    event[axis] += delta;\r\n    event['d' + axis] += delta;\r\n  }\r\n\r\n  return previousValue;\r\n}\r\n\r\n/**\r\n * Get children of a shape.\r\n *\r\n * @param {Shape} parent\r\n *\r\n * @return {Array<Shape|Connection>}\r\n */\r\nexport function getChildren(parent) {\r\n  return parent.children || [];\r\n}","import {\r\n  assign,\r\n  forEach,\r\n  isArray\r\n} from 'min-dash';\r\n\r\nimport { setSnapped } from '../snapping/SnapUtil';\r\n\r\nimport { getClosestPointOnConnection } from './BendpointUtil';\r\n\r\nimport { isConnection } from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\nvar abs = Math.abs,\r\n    round = Math.round;\r\n\r\nvar TOLERANCE = 10;\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function BendpointSnapping(eventBus) {\r\n\r\n  function snapTo(values, value) {\r\n\r\n    if (isArray(values)) {\r\n      var i = values.length;\r\n\r\n      while (i--) if (abs(values[i] - value) <= TOLERANCE) {\r\n        return values[i];\r\n      }\r\n    } else {\r\n      values = +values;\r\n      var rem = value % values;\r\n\r\n      if (rem < TOLERANCE) {\r\n        return value - rem;\r\n      }\r\n\r\n      if (rem > values - TOLERANCE) {\r\n        return value - rem + values;\r\n      }\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  function getSnapPoint(element, event) {\r\n\r\n    if (element.waypoints) {\r\n      return getClosestPointOnConnection(event, element);\r\n    }\r\n\r\n    if (element.width) {\r\n      return {\r\n        x: round(element.width / 2 + element.x),\r\n        y: round(element.height / 2 + element.y)\r\n      };\r\n    }\r\n  }\r\n\r\n  // connection segment snapping //////////////////////\r\n\r\n  function getConnectionSegmentSnaps(event) {\r\n\r\n    var context = event.context,\r\n        snapPoints = context.snapPoints,\r\n        connection = context.connection,\r\n        waypoints = connection.waypoints,\r\n        segmentStart = context.segmentStart,\r\n        segmentStartIndex = context.segmentStartIndex,\r\n        segmentEnd = context.segmentEnd,\r\n        segmentEndIndex = context.segmentEndIndex,\r\n        axis = context.axis;\r\n\r\n    if (snapPoints) {\r\n      return snapPoints;\r\n    }\r\n\r\n    var referenceWaypoints = [\r\n      waypoints[segmentStartIndex - 1],\r\n      segmentStart,\r\n      segmentEnd,\r\n      waypoints[segmentEndIndex + 1]\r\n    ];\r\n\r\n    if (segmentStartIndex < 2) {\r\n      referenceWaypoints.unshift(getSnapPoint(connection.source, event));\r\n    }\r\n\r\n    if (segmentEndIndex > waypoints.length - 3) {\r\n      referenceWaypoints.unshift(getSnapPoint(connection.target, event));\r\n    }\r\n\r\n    context.snapPoints = snapPoints = { horizontal: [] , vertical: [] };\r\n\r\n    forEach(referenceWaypoints, function(p) {\r\n\r\n      // we snap on existing bendpoints only,\r\n      // not placeholders that are inserted during add\r\n      if (p) {\r\n        p = p.original || p;\r\n\r\n        if (axis === 'y') {\r\n          snapPoints.horizontal.push(p.y);\r\n        }\r\n\r\n        if (axis === 'x') {\r\n          snapPoints.vertical.push(p.x);\r\n        }\r\n      }\r\n    });\r\n\r\n    return snapPoints;\r\n  }\r\n\r\n  eventBus.on('connectionSegment.move.move', 1500, function(event) {\r\n    var snapPoints = getConnectionSegmentSnaps(event),\r\n        x = event.x,\r\n        y = event.y,\r\n        sx, sy;\r\n\r\n    if (!snapPoints) {\r\n      return;\r\n    }\r\n\r\n    // snap\r\n    sx = snapTo(snapPoints.vertical, x);\r\n    sy = snapTo(snapPoints.horizontal, y);\r\n\r\n\r\n    // correction x/y\r\n    var cx = (x - sx),\r\n        cy = (y - sy);\r\n\r\n    // update delta\r\n    assign(event, {\r\n      dx: event.dx - cx,\r\n      dy: event.dy - cy,\r\n      x: sx,\r\n      y: sy\r\n    });\r\n\r\n    // only set snapped if actually snapped\r\n    if (cx || snapPoints.vertical.indexOf(x) !== -1) {\r\n      setSnapped(event, 'x', sx);\r\n    }\r\n\r\n    if (cy || snapPoints.horizontal.indexOf(y) !== -1) {\r\n      setSnapped(event, 'y', sy);\r\n    }\r\n  });\r\n\r\n\r\n  // bendpoint snapping //////////////////////\r\n\r\n  function getBendpointSnaps(context) {\r\n\r\n    var snapPoints = context.snapPoints,\r\n        waypoints = context.connection.waypoints,\r\n        bendpointIndex = context.bendpointIndex;\r\n\r\n    if (snapPoints) {\r\n      return snapPoints;\r\n    }\r\n\r\n    var referenceWaypoints = [ waypoints[bendpointIndex - 1], waypoints[bendpointIndex + 1] ];\r\n\r\n    context.snapPoints = snapPoints = { horizontal: [] , vertical: [] };\r\n\r\n    forEach(referenceWaypoints, function(p) {\r\n\r\n      // we snap on existing bendpoints only,\r\n      // not placeholders that are inserted during add\r\n      if (p) {\r\n        p = p.original || p;\r\n\r\n        snapPoints.horizontal.push(p.y);\r\n        snapPoints.vertical.push(p.x);\r\n      }\r\n    });\r\n\r\n    return snapPoints;\r\n  }\r\n\r\n  // Snap Endpoint of new connection\r\n  eventBus.on([\r\n    'connect.hover',\r\n    'connect.move',\r\n    'connect.end'\r\n  ], 1500, function(event) {\r\n    var context = event.context,\r\n        hover = context.hover,\r\n        hoverMid = hover && getSnapPoint(hover, event);\r\n\r\n    // only snap on connections, elements can have multiple connect endpoints\r\n    if (!isConnection(hover) || !hoverMid || !hoverMid.x || !hoverMid.y) {\r\n      return;\r\n    }\r\n\r\n    setSnapped(event, 'x', hoverMid.x);\r\n    setSnapped(event, 'y', hoverMid.y);\r\n  });\r\n\r\n  eventBus.on([ 'bendpoint.move.move', 'bendpoint.move.end' ], 1500, function(event) {\r\n\r\n    var context = event.context,\r\n        snapPoints = getBendpointSnaps(context),\r\n        hover = context.hover,\r\n        hoverMid = hover && getSnapPoint(hover, event),\r\n        x = event.x,\r\n        y = event.y,\r\n        sx, sy;\r\n\r\n    if (!snapPoints) {\r\n      return;\r\n    }\r\n\r\n    // snap to hover mid\r\n    sx = snapTo(hoverMid ? snapPoints.vertical.concat([ hoverMid.x ]) : snapPoints.vertical, x);\r\n    sy = snapTo(hoverMid ? snapPoints.horizontal.concat([ hoverMid.y ]) : snapPoints.horizontal, y);\r\n\r\n    // correction x/y\r\n    var cx = (x - sx),\r\n        cy = (y - sy);\r\n\r\n    // update delta\r\n    assign(event, {\r\n      dx: event.dx - cx,\r\n      dy: event.dy - cy,\r\n      x: event.x - cx,\r\n      y: event.y - cy\r\n    });\r\n\r\n    // only set snapped if actually snapped\r\n    if (cx || snapPoints.vertical.indexOf(x) !== -1) {\r\n      setSnapped(event, 'x', sx);\r\n    }\r\n\r\n    if (cy || snapPoints.horizontal.indexOf(y) !== -1) {\r\n      setSnapped(event, 'y', sy);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nBendpointSnapping.$inject = [ 'eventBus' ];\r\n","import DraggingModule from '../dragging';\r\nimport RulesModule from '../rules';\r\n\r\nimport Bendpoints from './Bendpoints';\r\nimport BendpointMove from './BendpointMove';\r\nimport BendpointMovePreview from './BendpointMovePreview';\r\nimport ConnectionSegmentMove from './ConnectionSegmentMove';\r\nimport BendpointSnapping from './BendpointSnapping';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    DraggingModule,\r\n    RulesModule\r\n  ],\r\n  __init__: [ 'bendpoints', 'bendpointSnapping', 'bendpointMovePreview' ],\r\n  bendpoints: [ 'type', Bendpoints ],\r\n  bendpointMove: [ 'type', BendpointMove ],\r\n  bendpointMovePreview: [ 'type', BendpointMovePreview ],\r\n  connectionSegmentMove: [ 'type', ConnectionSegmentMove ],\r\n  bendpointSnapping: [ 'type', BendpointSnapping ]\r\n};\r\n","import {\r\n  getMid\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport {\r\n  isNil,\r\n  isObject\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n */\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n * @param {Dragging} dragging\r\n * @param {Modeling} modeling\r\n * @param {Rules} rules\r\n */\r\nexport default function Connect(eventBus, dragging, modeling, rules) {\r\n\r\n  // rules\r\n\r\n  function canConnect(source, target) {\r\n    return rules.allowed('connection.create', {\r\n      source: source,\r\n      target: target\r\n    });\r\n  }\r\n\r\n  function canConnectReverse(source, target) {\r\n    return canConnect(target, source);\r\n  }\r\n\r\n\r\n  // event handlers\r\n\r\n  eventBus.on('connect.hover', function(event) {\r\n    var context = event.context,\r\n        start = context.start,\r\n        hover = event.hover,\r\n        canExecute;\r\n\r\n    // cache hover state\r\n    context.hover = hover;\r\n\r\n    canExecute = context.canExecute = canConnect(start, hover);\r\n\r\n    // ignore hover\r\n    if (isNil(canExecute)) {\r\n      return;\r\n    }\r\n\r\n    if (canExecute !== false) {\r\n      context.source = start;\r\n      context.target = hover;\r\n\r\n      return;\r\n    }\r\n\r\n    canExecute = context.canExecute = canConnectReverse(start, hover);\r\n\r\n    // ignore hover\r\n    if (isNil(canExecute)) {\r\n      return;\r\n    }\r\n\r\n    if (canExecute !== false) {\r\n      context.source = hover;\r\n      context.target = start;\r\n    }\r\n  });\r\n\r\n  eventBus.on([ 'connect.out', 'connect.cleanup' ], function(event) {\r\n    var context = event.context;\r\n\r\n    context.hover = null;\r\n    context.source = null;\r\n    context.target = null;\r\n\r\n    context.canExecute = false;\r\n  });\r\n\r\n  eventBus.on('connect.end', function(event) {\r\n    var context = event.context,\r\n        canExecute = context.canExecute,\r\n        connectionStart = context.connectionStart,\r\n        connectionEnd = {\r\n          x: event.x,\r\n          y: event.y\r\n        },\r\n        source = context.source,\r\n        target = context.target;\r\n\r\n    if (!canExecute) {\r\n      return false;\r\n    }\r\n\r\n    var attrs = null,\r\n        hints = {\r\n          connectionStart: isReverse(context) ? connectionEnd : connectionStart,\r\n          connectionEnd: isReverse(context) ? connectionStart : connectionEnd\r\n        };\r\n\r\n    if (isObject(canExecute)) {\r\n      attrs = canExecute;\r\n    }\r\n\r\n    context.connection = modeling.connect(source, target, attrs, hints);\r\n  });\r\n\r\n\r\n  // API\r\n\r\n  /**\r\n   * Start connect operation.\r\n   *\r\n   * @param {MouseEvent|TouchEvent} event\r\n   * @param {Element} start\r\n   * @param {Point} [connectionStart]\r\n   * @param {boolean} [autoActivate=false]\r\n   */\r\n  this.start = function(event, start, connectionStart, autoActivate) {\r\n    if (!isObject(connectionStart)) {\r\n      autoActivate = connectionStart;\r\n      connectionStart = getMid(start);\r\n    }\r\n\r\n    dragging.init(event, 'connect', {\r\n      autoActivate: autoActivate,\r\n      data: {\r\n        shape: start,\r\n        context: {\r\n          start: start,\r\n          connectionStart: connectionStart\r\n        }\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nConnect.$inject = [\r\n  'eventBus',\r\n  'dragging',\r\n  'modeling',\r\n  'rules'\r\n];\r\n\r\n\r\n// helpers //////////\r\n\r\nexport function isReverse(context) {\r\n  var hover = context.hover,\r\n      source = context.source,\r\n      target = context.target;\r\n\r\n  return hover && source && hover === source && source !== target;\r\n}","import { isReverse } from './Connect';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\nvar HIGH_PRIORITY = 1100,\r\n    LOW_PRIORITY = 900;\r\n\r\nvar MARKER_OK = 'connect-ok',\r\n    MARKER_NOT_OK = 'connect-not-ok';\r\n\r\n/**\r\n * Shows connection preview during connect.\r\n *\r\n * @param {Injector} injector\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function ConnectPreview(injector, eventBus, canvas) {\r\n  var connectionPreview = injector.get('connectionPreview', false);\r\n\r\n  connectionPreview && eventBus.on('connect.move', function(event) {\r\n    var context = event.context,\r\n        canConnect = context.canExecute,\r\n        hover = context.hover,\r\n        source = context.source,\r\n        start = context.start,\r\n        startPosition = context.startPosition,\r\n        target = context.target,\r\n        connectionStart = context.connectionStart || startPosition,\r\n        connectionEnd = context.connectionEnd || {\r\n          x: event.x,\r\n          y: event.y\r\n        },\r\n        previewStart = connectionStart,\r\n        previewEnd = connectionEnd;\r\n\r\n    if (isReverse(context)) {\r\n      previewStart = connectionEnd;\r\n      previewEnd = connectionStart;\r\n    }\r\n\r\n    connectionPreview.drawPreview(context, canConnect, {\r\n      source: source || start,\r\n      target: target || hover,\r\n      connectionStart: previewStart,\r\n      connectionEnd: previewEnd\r\n    });\r\n  });\r\n\r\n  eventBus.on('connect.hover', LOW_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        hover = event.hover,\r\n        canExecute = context.canExecute;\r\n\r\n    // ignore hover\r\n    if (canExecute === null) {\r\n      return;\r\n    }\r\n\r\n    canvas.addMarker(hover, canExecute ? MARKER_OK : MARKER_NOT_OK);\r\n  });\r\n\r\n  eventBus.on([\r\n    'connect.out',\r\n    'connect.cleanup'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var hover = event.hover;\r\n\r\n    if (hover) {\r\n      canvas.removeMarker(hover, MARKER_OK);\r\n      canvas.removeMarker(hover, MARKER_NOT_OK);\r\n    }\r\n  });\r\n\r\n  connectionPreview && eventBus.on('connect.cleanup', function(event) {\r\n    connectionPreview.cleanUp(event.context);\r\n  });\r\n}\r\n\r\nConnectPreview.$inject = [\r\n  'injector',\r\n  'eventBus',\r\n  'canvas'\r\n];\r\n","import SelectionModule from '../selection';\r\nimport RulesModule from '../rules';\r\nimport DraggingModule from '../dragging';\r\n\r\nimport Connect from './Connect';\r\nimport ConnectPreview from './ConnectPreview';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    SelectionModule,\r\n    RulesModule,\r\n    DraggingModule\r\n  ],\r\n  __init__: [\r\n    'connectPreview'\r\n  ],\r\n  connect: [ 'type', Connect ],\r\n  connectPreview: [ 'type', ConnectPreview ]\r\n};\r\n","import {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  create as svgCreate,\r\n  remove as svgRemove,\r\n  clear as svgClear\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  isObject\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getElementLineIntersection,\r\n  getMid\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport {\r\n  createLine\r\n} from '../../util/RenderUtil';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n * @typedef {import('../../model/Types').Connection} Connection\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/ElementFactory').default} ElementFactory\r\n * @typedef {import('../../core/GraphicsFactory').default} GraphicsFactory\r\n */\r\n\r\nvar MARKER_CONNECTION_PREVIEW = 'djs-dragger';\r\n\r\n/**\r\n * Draws connection preview. Optionally, this can use layouter and connection docking to draw\r\n * better looking previews.\r\n *\r\n * @param {Injector} injector\r\n * @param {Canvas} canvas\r\n * @param {GraphicsFactory} graphicsFactory\r\n * @param {ElementFactory} elementFactory\r\n */\r\nexport default function ConnectionPreview(\r\n    injector,\r\n    canvas,\r\n    graphicsFactory,\r\n    elementFactory\r\n) {\r\n  this._canvas = canvas;\r\n  this._graphicsFactory = graphicsFactory;\r\n  this._elementFactory = elementFactory;\r\n\r\n  // optional components\r\n  this._connectionDocking = injector.get('connectionDocking', false);\r\n  this._layouter = injector.get('layouter', false);\r\n}\r\n\r\nConnectionPreview.$inject = [\r\n  'injector',\r\n  'canvas',\r\n  'graphicsFactory',\r\n  'elementFactory'\r\n];\r\n\r\n/**\r\n * Draw connection preview.\r\n *\r\n * Provide at least one of <source, connectionStart> and <target, connectionEnd> to create a preview.\r\n * In the clean up stage, call `connectionPreview#cleanUp` with the context to remove preview.\r\n *\r\n * @param {Object} context\r\n * @param {Object|boolean} canConnect\r\n * @param {Object} hints\r\n * @param {Element} [hints.source] source element\r\n * @param {Element} [hints.target] target element\r\n * @param {Point} [hints.connectionStart] connection preview start\r\n * @param {Point} [hints.connectionEnd] connection preview end\r\n * @param {Point[]} [hints.waypoints] provided waypoints for preview\r\n * @param {boolean} [hints.noLayout] true if preview should not be laid out\r\n * @param {boolean} [hints.noCropping] true if preview should not be cropped\r\n * @param {boolean} [hints.noNoop] true if simple connection should not be drawn\r\n */\r\nConnectionPreview.prototype.drawPreview = function(context, canConnect, hints) {\r\n\r\n  hints = hints || {};\r\n\r\n  var connectionPreviewGfx = context.connectionPreviewGfx,\r\n      getConnection = context.getConnection,\r\n      source = hints.source,\r\n      target = hints.target,\r\n      waypoints = hints.waypoints,\r\n      connectionStart = hints.connectionStart,\r\n      connectionEnd = hints.connectionEnd,\r\n      noLayout = hints.noLayout,\r\n      noCropping = hints.noCropping,\r\n      noNoop = hints.noNoop,\r\n      connection;\r\n\r\n  var self = this;\r\n\r\n  if (!connectionPreviewGfx) {\r\n    connectionPreviewGfx = context.connectionPreviewGfx = this.createConnectionPreviewGfx();\r\n  }\r\n\r\n  svgClear(connectionPreviewGfx);\r\n\r\n  if (!getConnection) {\r\n    getConnection = context.getConnection = cacheReturnValues(function(canConnect, source, target) {\r\n      return self.getConnection(canConnect, source, target);\r\n    });\r\n  }\r\n\r\n  if (canConnect) {\r\n    connection = getConnection(canConnect, source, target);\r\n  }\r\n\r\n  if (!connection) {\r\n    !noNoop && this.drawNoopPreview(connectionPreviewGfx, hints);\r\n    return;\r\n  }\r\n\r\n  connection.waypoints = waypoints || [];\r\n\r\n  // optional layout\r\n  if (this._layouter && !noLayout) {\r\n    connection.waypoints = this._layouter.layoutConnection(connection, {\r\n      source: source,\r\n      target: target,\r\n      connectionStart: connectionStart,\r\n      connectionEnd: connectionEnd,\r\n      waypoints: hints.waypoints || connection.waypoints\r\n    });\r\n  }\r\n\r\n  // fallback if no waypoints were provided nor created with layouter\r\n  if (!connection.waypoints || !connection.waypoints.length) {\r\n    connection.waypoints = [\r\n      source ? getMid(source) : connectionStart,\r\n      target ? getMid(target) : connectionEnd\r\n    ];\r\n  }\r\n\r\n  // optional cropping\r\n  if (this._connectionDocking && (source || target) && !noCropping) {\r\n    connection.waypoints = this._connectionDocking.getCroppedWaypoints(connection, source, target);\r\n  }\r\n\r\n  this._graphicsFactory.drawConnection(connectionPreviewGfx, connection, {\r\n    stroke: 'var(--element-dragger-color)'\r\n  });\r\n};\r\n\r\n/**\r\n * Draw simple connection between source and target or provided points.\r\n *\r\n * @param {SVGElement} connectionPreviewGfx container for the connection\r\n * @param {Object} hints\r\n * @param {Element} [hints.source] source element\r\n * @param {Element} [hints.target] target element\r\n * @param {Point} [hints.connectionStart] required if source is not provided\r\n * @param {Point} [hints.connectionEnd] required if target is not provided\r\n */\r\nConnectionPreview.prototype.drawNoopPreview = function(connectionPreviewGfx, hints) {\r\n  var source = hints.source,\r\n      target = hints.target,\r\n      start = hints.connectionStart || getMid(source),\r\n      end = hints.connectionEnd || getMid(target);\r\n\r\n  var waypoints = this.cropWaypoints(start, end, source, target);\r\n\r\n  var connection = this.createNoopConnection(waypoints[0], waypoints[1]);\r\n\r\n  svgAppend(connectionPreviewGfx, connection);\r\n};\r\n\r\n/**\r\n * Return cropped waypoints.\r\n *\r\n * @param {Point} start\r\n * @param {Point} end\r\n * @param {Element} source\r\n * @param {Element} target\r\n *\r\n * @return {Point[]}\r\n */\r\nConnectionPreview.prototype.cropWaypoints = function(start, end, source, target) {\r\n  var graphicsFactory = this._graphicsFactory,\r\n      sourcePath = source && graphicsFactory.getShapePath(source),\r\n      targetPath = target && graphicsFactory.getShapePath(target),\r\n      connectionPath = graphicsFactory.getConnectionPath({ waypoints: [ start, end ] });\r\n\r\n  start = (source && getElementLineIntersection(sourcePath, connectionPath, true)) || start;\r\n  end = (target && getElementLineIntersection(targetPath, connectionPath, false)) || end;\r\n\r\n  return [ start, end ];\r\n};\r\n\r\n/**\r\n * Remove connection preview container if it exists.\r\n *\r\n * @param {Object} [context]\r\n * @param {SVGElement} [context.connectionPreviewGfx] preview container\r\n */\r\nConnectionPreview.prototype.cleanUp = function(context) {\r\n  if (context && context.connectionPreviewGfx) {\r\n    svgRemove(context.connectionPreviewGfx);\r\n  }\r\n};\r\n\r\n/**\r\n * Get connection that connects source and target.\r\n *\r\n * @param {Object|boolean} canConnect\r\n *\r\n * @return {Connection}\r\n */\r\nConnectionPreview.prototype.getConnection = function(canConnect) {\r\n  var attrs = ensureConnectionAttrs(canConnect);\r\n\r\n  return this._elementFactory.createConnection(attrs);\r\n};\r\n\r\n\r\n/**\r\n * Add and return preview graphics.\r\n *\r\n * @return {SVGElement}\r\n */\r\nConnectionPreview.prototype.createConnectionPreviewGfx = function() {\r\n  var gfx = svgCreate('g');\r\n\r\n  svgAttr(gfx, {\r\n    pointerEvents: 'none'\r\n  });\r\n\r\n  svgClasses(gfx).add(MARKER_CONNECTION_PREVIEW);\r\n\r\n  svgAppend(this._canvas.getActiveLayer(), gfx);\r\n\r\n  return gfx;\r\n};\r\n\r\n/**\r\n * Create and return simple connection.\r\n *\r\n * @param {Point} start\r\n * @param {Point} end\r\n *\r\n * @return {SVGElement}\r\n */\r\nConnectionPreview.prototype.createNoopConnection = function(start, end) {\r\n  return createLine([ start, end ], {\r\n    'stroke': '#333',\r\n    'strokeDasharray': [ 1 ],\r\n    'strokeWidth': 2,\r\n    'pointer-events': 'none'\r\n  });\r\n};\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * Returns function that returns cached return values referenced by stringified first argument.\r\n *\r\n * @param {Function} fn\r\n *\r\n * @return {Function}\r\n */\r\nfunction cacheReturnValues(fn) {\r\n  var returnValues = {};\r\n\r\n  /**\r\n   * Return cached return value referenced by stringified first argument.\r\n   *\r\n   * @return {*}\r\n   */\r\n  return function(firstArgument) {\r\n    var key = JSON.stringify(firstArgument);\r\n\r\n    var returnValue = returnValues[key];\r\n\r\n    if (!returnValue) {\r\n      returnValue = returnValues[key] = fn.apply(null, arguments);\r\n    }\r\n\r\n    return returnValue;\r\n  };\r\n}\r\n\r\n/**\r\n * Ensure connection attributes is object.\r\n *\r\n * @param {Object|boolean} canConnect\r\n *\r\n * @return {Object}\r\n */\r\nfunction ensureConnectionAttrs(canConnect) {\r\n  if (isObject(canConnect)) {\r\n    return canConnect;\r\n  } else {\r\n    return {};\r\n  }\r\n}\r\n","import ConnectionPreview from './ConnectionPreview';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'connectionPreview' ],\r\n  connectionPreview: [ 'type', ConnectionPreview ]\r\n};\r\n","import {\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  clone as svgClone,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport { query as domQuery } from 'min-dom';\r\n\r\nimport { getVisual } from '../../util/GraphicsUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ElementLike} Element\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../draw/Styles').default} Styles\r\n */\r\n\r\nvar MARKER_TYPES = [\r\n  'marker-start',\r\n  'marker-mid',\r\n  'marker-end'\r\n];\r\n\r\nvar NODES_CAN_HAVE_MARKER = [\r\n  'circle',\r\n  'ellipse',\r\n  'line',\r\n  'path',\r\n  'polygon',\r\n  'polyline',\r\n  'path',\r\n  'rect'\r\n];\r\n\r\n\r\n/**\r\n * Adds support for previews of moving/resizing elements.\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Styles} styles\r\n */\r\nexport default function PreviewSupport(elementRegistry, eventBus, canvas, styles) {\r\n  this._elementRegistry = elementRegistry;\r\n  this._canvas = canvas;\r\n  this._styles = styles;\r\n\r\n  this._clonedMarkers = {};\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('drag.cleanup', function() {\r\n    self.cleanUp();\r\n  });\r\n}\r\n\r\nPreviewSupport.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'canvas',\r\n  'styles'\r\n];\r\n\r\nPreviewSupport.prototype.cleanUp = function() {\r\n  var self = this;\r\n\r\n  forEach(self._clonedMarkers, function(clonedMarker) {\r\n    svgRemove(clonedMarker);\r\n  });\r\n\r\n  self._clonedMarkers = {};\r\n};\r\n\r\n/**\r\n * Returns graphics of an element.\r\n *\r\n * @param {Element} element\r\n *\r\n * @return {SVGElement}\r\n */\r\nPreviewSupport.prototype.getGfx = function(element) {\r\n  return this._elementRegistry.getGraphics(element);\r\n};\r\n\r\n/**\r\n * Adds a move preview of a given shape to a given SVG group.\r\n *\r\n * @param {Element} element The element to be moved.\r\n * @param {SVGElement} group The SVG group to add the preview to.\r\n * @param {SVGElement} [gfx] The optional graphical element of the element.\r\n * @param {string} [className=\"djs-dragger\"] The optional class name to add to the preview.\r\n *\r\n * @return {SVGElement} The preview.\r\n */\r\nPreviewSupport.prototype.addDragger = function(element, group, gfx, className = 'djs-dragger') {\r\n  gfx = gfx || this.getGfx(element);\r\n\r\n  var dragger = svgClone(gfx);\r\n  var bbox = gfx.getBoundingClientRect();\r\n\r\n  this._cloneMarkers(getVisual(dragger), className);\r\n\r\n  svgAttr(dragger, this._styles.cls(className, [], {\r\n    x: bbox.top,\r\n    y: bbox.left\r\n  }));\r\n\r\n  svgAppend(group, dragger);\r\n\r\n  svgAttr(dragger, 'data-preview-support-element-id', element.id);\r\n\r\n  return dragger;\r\n};\r\n\r\n/**\r\n * Adds a resize preview of a given shape to a given SVG group.\r\n *\r\n * @param {Shape} shape The element to be resized.\r\n * @param {SVGElement} group The SVG group to add the preview to.\r\n *\r\n * @return {SVGElement} The preview.\r\n */\r\nPreviewSupport.prototype.addFrame = function(shape, group) {\r\n\r\n  var frame = svgCreate('rect', {\r\n    class: 'djs-resize-overlay',\r\n    width:  shape.width,\r\n    height: shape.height,\r\n    x: shape.x,\r\n    y: shape.y\r\n  });\r\n\r\n  svgAppend(group, frame);\r\n\r\n  svgAttr(frame, 'data-preview-support-element-id', shape.id);\r\n\r\n  return frame;\r\n};\r\n\r\n/**\r\n * Clone all markers referenced by a node and its child nodes.\r\n *\r\n * @param {SVGElement} gfx\r\n * @param {string} [className=\"djs-dragger\"]\r\n */\r\nPreviewSupport.prototype._cloneMarkers = function(gfx, className = 'djs-dragger') {\r\n  var self = this;\r\n\r\n  if (gfx.childNodes) {\r\n\r\n    // TODO: use forEach once we drop PhantomJS\r\n    for (var i = 0; i < gfx.childNodes.length; i++) {\r\n\r\n      // recursively clone markers of child nodes\r\n      self._cloneMarkers(gfx.childNodes[ i ], className);\r\n    }\r\n  }\r\n\r\n  if (!canHaveMarker(gfx)) {\r\n    return;\r\n  }\r\n\r\n  MARKER_TYPES.forEach(function(markerType) {\r\n    if (svgAttr(gfx, markerType)) {\r\n      var marker = getMarker(gfx, markerType, self._canvas.getContainer());\r\n\r\n      self._cloneMarker(gfx, marker, markerType, className);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Clone marker referenced by an element.\r\n *\r\n * @param {SVGElement} gfx\r\n * @param {SVGElement} marker\r\n * @param {string} markerType\r\n * @param {string} [className=\"djs-dragger\"]\r\n */\r\nPreviewSupport.prototype._cloneMarker = function(gfx, marker, markerType, className = 'djs-dragger') {\r\n  var markerId = marker.id + '-' + className;\r\n\r\n  var clonedMarker = this._clonedMarkers[ markerId ];\r\n\r\n  if (!clonedMarker) {\r\n    clonedMarker = svgClone(marker);\r\n\r\n    var clonedMarkerId = markerId + '-clone';\r\n\r\n    clonedMarker.id = clonedMarkerId;\r\n\r\n    svgClasses(clonedMarker).add(className);\r\n\r\n    this._clonedMarkers[ markerId ] = clonedMarker;\r\n\r\n    var defs = domQuery('defs', this._canvas._svg);\r\n\r\n    if (!defs) {\r\n      defs = svgCreate('defs');\r\n\r\n      svgAppend(this._canvas._svg, defs);\r\n    }\r\n\r\n    svgAppend(defs, clonedMarker);\r\n  }\r\n\r\n  var reference = idToReference(this._clonedMarkers[ markerId ].id);\r\n\r\n  svgAttr(gfx, markerType, reference);\r\n};\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * Get marker of given type referenced by node.\r\n *\r\n * @param {HTMLElement} node\r\n * @param {string} markerType\r\n * @param {HTMLElement} [parentNode]\r\n *\r\n * @param {HTMLElement}\r\n */\r\nfunction getMarker(node, markerType, parentNode) {\r\n  var id = referenceToId(svgAttr(node, markerType));\r\n\r\n  return domQuery('marker#' + id, parentNode || document);\r\n}\r\n\r\n/**\r\n * Get ID of fragment within current document from its functional IRI reference.\r\n * References may use single or double quotes.\r\n *\r\n * @param {string} reference\r\n *\r\n * @return {string}\r\n */\r\nfunction referenceToId(reference) {\r\n  return reference.match(/url\\(['\"]?#([^'\"]*)['\"]?\\)/)[1];\r\n}\r\n\r\n/**\r\n * Get functional IRI reference for given ID of fragment within current document.\r\n *\r\n * @param {string} id\r\n *\r\n * @return {string}\r\n */\r\nfunction idToReference(id) {\r\n  return 'url(#' + id + ')';\r\n}\r\n\r\n/**\r\n * Check wether node type can have marker attributes.\r\n *\r\n * @param {HTMLElement} node\r\n *\r\n * @return {boolean}\r\n */\r\nfunction canHaveMarker(node) {\r\n  return NODES_CAN_HAVE_MARKER.indexOf(node.nodeName) !== -1;\r\n}","import PreviewSupport from './PreviewSupport';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'previewSupport' ],\r\n  previewSupport: [ 'type', PreviewSupport ]\r\n};\r\n","import {\r\n  clear as svgClear,\r\n  create as svgCreate\r\n} from 'tiny-svg';\r\n\r\nimport { getVisual } from '../../util/GraphicsUtil';\r\n\r\nimport { isConnection } from '../../util/ModelUtil';\r\n\r\nimport { translate } from '../../util/SvgTransformUtil';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n * @typedef {import('../../util/Types').Point} Point\r\n * @typedef {import('../../util/Types').Rect} Rect\r\n *\r\n * @typedef { { element: Element, delta: Point } } MovedOption\r\n * @typedef { { shape: Shape, bounds: Rect } } ResizedOption\r\n *\r\n * @typedef { {\r\n *   created?: Element[],\r\n *   removed?: Element[],\r\n *   moved?: MovedOption[],\r\n *   resized?: ResizedOption[]\r\n * } } CreateOptions\r\n */\r\n\r\nconst LAYER_NAME = 'complex-preview';\r\n\r\n/**\r\n * Complex preview for shapes and connections.\r\n */\r\nexport default class ComplexPreview {\r\n  constructor(canvas, graphicsFactory, previewSupport) {\r\n    this._canvas = canvas;\r\n    this._graphicsFactory = graphicsFactory;\r\n    this._previewSupport = previewSupport;\r\n\r\n    this._markers = [];\r\n  }\r\n\r\n  /**\r\n   * Create complex preview.\r\n   *\r\n   * @param {CreateOptions} options\r\n   */\r\n  create(options) {\r\n\r\n    // there can only be one complex preview at a time\r\n    this.cleanUp();\r\n\r\n    const {\r\n      created = [],\r\n      moved = [],\r\n      removed = [],\r\n      resized = []\r\n    } = options;\r\n\r\n    const layer = this._canvas.getLayer(LAYER_NAME);\r\n\r\n    // shapes and connections to be created\r\n    created.filter(element => !isHidden(element)).forEach(element => {\r\n      let gfx;\r\n\r\n      if (isConnection(element)) {\r\n        gfx = this._graphicsFactory._createContainer('connection', svgCreate('g'));\r\n\r\n        this._graphicsFactory.drawConnection(getVisual(gfx), element);\r\n      } else {\r\n        gfx = this._graphicsFactory._createContainer('shape', svgCreate('g'));\r\n\r\n        this._graphicsFactory.drawShape(getVisual(gfx), element);\r\n\r\n        translate(gfx, element.x, element.y);\r\n      }\r\n\r\n      this._previewSupport.addDragger(element, layer, gfx);\r\n    });\r\n\r\n    // elements to be moved\r\n    moved.forEach(({ element, delta }) => {\r\n      this._previewSupport.addDragger(element, layer, undefined, 'djs-dragging');\r\n\r\n      this._canvas.addMarker(element, 'djs-element-hidden');\r\n\r\n      this._markers.push([ element, 'djs-element-hidden' ]);\r\n\r\n      const dragger = this._previewSupport.addDragger(element, layer);\r\n\r\n      if (isConnection(element)) {\r\n        translate(dragger, delta.x, delta.y);\r\n      } else {\r\n        translate(dragger, element.x + delta.x, element.y + delta.y);\r\n      }\r\n    });\r\n\r\n    // elements to be removed\r\n    removed.forEach(element => {\r\n      this._previewSupport.addDragger(element, layer, undefined, 'djs-dragging');\r\n\r\n      this._canvas.addMarker(element, 'djs-element-hidden');\r\n\r\n      this._markers.push([ element, 'djs-element-hidden' ]);\r\n    });\r\n\r\n    // elements to be resized\r\n    resized.forEach(({ shape, bounds }) => {\r\n      this._canvas.addMarker(shape, 'djs-hidden');\r\n\r\n      this._markers.push([ shape, 'djs-hidden' ]);\r\n\r\n      this._previewSupport.addDragger(shape, layer, undefined, 'djs-dragging');\r\n\r\n      const gfx = this._graphicsFactory._createContainer('shape', svgCreate('g'));\r\n\r\n      this._graphicsFactory.drawShape(getVisual(gfx), shape, {\r\n        width: bounds.width,\r\n        height: bounds.height\r\n      });\r\n\r\n      translate(gfx, bounds.x, bounds.y);\r\n\r\n      this._previewSupport.addDragger(shape, layer, gfx);\r\n    });\r\n  }\r\n\r\n  cleanUp() {\r\n    svgClear(this._canvas.getLayer(LAYER_NAME));\r\n\r\n    this._markers.forEach(([ element, marker ]) => this._canvas.removeMarker(element, marker));\r\n\r\n    this._markers = [];\r\n\r\n    this._previewSupport.cleanUp();\r\n  }\r\n\r\n  show() {\r\n    this._canvas.showLayer(LAYER_NAME);\r\n  }\r\n\r\n  hide() {\r\n    this._canvas.hideLayer(LAYER_NAME);\r\n  }\r\n}\r\n\r\nComplexPreview.$inject = [\r\n  'canvas',\r\n  'graphicsFactory',\r\n  'previewSupport'\r\n];\r\n\r\nfunction isHidden(element) {\r\n  return element.hidden;\r\n}","import PreviewSupportModule from '../preview-support';\r\n\r\nimport ComplexPreview from './ComplexPreview';\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [ PreviewSupportModule ],\r\n  __init__: [ 'complexPreview' ],\r\n  complexPreview: [ 'type', ComplexPreview ]\r\n};","import inherits from 'inherits-browser';\n\nimport {\n  getOrientation,\n  getMid,\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substract\n} from 'diagram-js/lib/util/Math';\n\nimport {\n  hasExternalLabel\n} from '../../../util/LabelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n *\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\n */\n\nvar ALIGNMENTS = [\n  'top',\n  'bottom',\n  'left',\n  'right'\n];\n\nvar ELEMENT_LABEL_DISTANCE = 10;\n\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function AdaptiveLabelPositioningBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.postExecuted([\n    'connection.create',\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context,\n        connection = context.connection,\n        source = connection.source,\n        target = connection.target,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      checkLabelAdjustment(source);\n      checkLabelAdjustment(target);\n    }\n  });\n\n\n  this.postExecuted([\n    'label.create'\n  ], function(event) {\n    var context = event.context,\n        shape = context.shape,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      checkLabelAdjustment(shape.labelTarget);\n    }\n  });\n\n\n  this.postExecuted([\n    'elements.create'\n  ], function(event) {\n    var context = event.context,\n        elements = context.elements,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      elements.forEach(function(element) {\n        checkLabelAdjustment(element);\n      });\n    }\n  });\n\n  function checkLabelAdjustment(element) {\n\n    // skip non-existing labels\n    if (!hasExternalLabel(element)) {\n      return;\n    }\n\n    var optimalPosition = getOptimalPosition(element);\n\n    // no optimal position found\n    if (!optimalPosition) {\n      return;\n    }\n\n    adjustLabelPosition(element, optimalPosition);\n  }\n\n  function adjustLabelPosition(element, orientation) {\n\n    var elementMid = getMid(element),\n        label = element.label,\n        labelMid = getMid(label);\n\n    // ignore labels that are being created\n    if (!label.parent) {\n      return;\n    }\n\n    var elementTrbl = asTRBL(element);\n\n    var newLabelMid;\n\n    switch (orientation) {\n    case 'top':\n      newLabelMid = {\n        x: elementMid.x,\n        y: elementTrbl.top - ELEMENT_LABEL_DISTANCE - label.height / 2\n      };\n\n      break;\n\n    case 'left':\n\n      newLabelMid = {\n        x: elementTrbl.left - ELEMENT_LABEL_DISTANCE - label.width / 2,\n        y: elementMid.y\n      };\n\n      break;\n\n    case 'bottom':\n\n      newLabelMid = {\n        x: elementMid.x,\n        y: elementTrbl.bottom + ELEMENT_LABEL_DISTANCE + label.height / 2\n      };\n\n      break;\n\n    case 'right':\n\n      newLabelMid = {\n        x: elementTrbl.right + ELEMENT_LABEL_DISTANCE + label.width / 2,\n        y: elementMid.y\n      };\n\n      break;\n    }\n\n    var delta = substract(newLabelMid, labelMid);\n\n    modeling.moveShape(label, delta);\n  }\n\n}\n\ninherits(AdaptiveLabelPositioningBehavior, CommandInterceptor);\n\nAdaptiveLabelPositioningBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\n/**\n * Return alignments which are taken by a boundary's host element\n *\n * @param {Shape} element\n *\n * @return {DirectionTRBL[]}\n */\nfunction getTakenHostAlignments(element) {\n\n  var hostElement = element.host,\n      elementMid = getMid(element),\n      hostOrientation = getOrientation(elementMid, hostElement);\n\n  var freeAlignments;\n\n  // check whether there is a multi-orientation, e.g. 'top-left'\n  if (hostOrientation.indexOf('-') >= 0) {\n    freeAlignments = hostOrientation.split('-');\n  } else {\n    freeAlignments = [ hostOrientation ];\n  }\n\n  var takenAlignments = ALIGNMENTS.filter(function(alignment) {\n\n    return freeAlignments.indexOf(alignment) === -1;\n  });\n\n  return takenAlignments;\n\n}\n\n/**\n * Return alignments which are taken by related connections\n *\n * @param {Element} element\n *\n * @return {DirectionTRBL[]}\n */\nfunction getTakenConnectionAlignments(element) {\n\n  var elementMid = getMid(element);\n\n  var takenAlignments = [].concat(\n    element.incoming.map(function(c) {\n      return c.waypoints[c.waypoints.length - 2 ];\n    }),\n    element.outgoing.map(function(c) {\n      return c.waypoints[1];\n    })\n  ).map(function(point) {\n    return getApproximateOrientation(elementMid, point);\n  });\n\n  return takenAlignments;\n}\n\n/**\n * Return the optimal label position around an element\n * or `undefined`, if none was found.\n *\n * @param  {Element} element\n *\n * @return {DirectionTRBL|undefined}\n */\nfunction getOptimalPosition(element) {\n\n  var labelMid = getMid(element.label);\n\n  var elementMid = getMid(element);\n\n  var labelOrientation = getApproximateOrientation(elementMid, labelMid);\n\n  if (!isAligned(labelOrientation)) {\n    return;\n  }\n\n  var takenAlignments = getTakenConnectionAlignments(element);\n\n  if (element.host) {\n    var takenHostAlignments = getTakenHostAlignments(element);\n\n    takenAlignments = takenAlignments.concat(takenHostAlignments);\n  }\n\n  var freeAlignments = ALIGNMENTS.filter(function(alignment) {\n\n    return takenAlignments.indexOf(alignment) === -1;\n  });\n\n  // NOTHING TO DO; label already aligned a.O.K.\n  if (freeAlignments.indexOf(labelOrientation) !== -1) {\n    return;\n  }\n\n  return freeAlignments[0];\n}\n\nfunction getApproximateOrientation(p0, p1) {\n  return getOrientation(p1, p0, 5);\n}\n\nfunction isAligned(orientation) {\n  return ALIGNMENTS.indexOf(orientation) !== -1;\n}\n","import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\nexport default function AppendBehavior(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // assign correct shape position unless already set\n\n  this.preExecute('shape.append', function(context) {\n\n    var source = context.source,\n        shape = context.shape;\n\n    if (!context.position) {\n\n      if (is(shape, 'bpmn:TextAnnotation')) {\n        context.position = {\n          x: source.x + source.width / 2 + 75,\n          y: source.y - 50 - shape.height / 2\n        };\n      } else {\n        context.position = {\n          x: source.x + source.width + 80 + shape.width / 2,\n          y: source.y + source.height / 2\n        };\n      }\n    }\n  }, true);\n}\n\ninherits(AppendBehavior, CommandInterceptor);\n\nAppendBehavior.$inject = [\n  'eventBus'\n];","import inherits from 'inherits-browser';\r\n\r\nimport { is } from '../../../util/ModelUtil';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport {\r\n  filter,\r\n  forEach\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * @param {Injector} injector\r\n * @param {Modeling} modeling\r\n */\r\nexport default function AssociationBehavior(injector, modeling) {\r\n  injector.invoke(CommandInterceptor, this);\r\n\r\n  this.postExecute('shape.move', function(context) {\r\n    var newParent = context.newParent,\r\n        shape = context.shape;\r\n\r\n    var associations = filter(shape.incoming.concat(shape.outgoing), function(connection) {\r\n      return is(connection, 'bpmn:Association');\r\n    });\r\n\r\n    forEach(associations, function(association) {\r\n      modeling.moveConnection(association, { x: 0, y: 0 }, newParent);\r\n    });\r\n  }, true);\r\n}\r\n\r\ninherits(AssociationBehavior, CommandInterceptor);\r\n\r\nAssociationBehavior.$inject = [\r\n  'injector',\r\n  'modeling'\r\n];","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getBusinessObject } from '../../../util/ModelUtil';\n\nimport { isAny } from '../util/ModelingUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\n/**\n * @typedef {import('../../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('didi').Injector} Injector\n */\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * Replace intermediate event with boundary event when creating or moving results in attached event.\n *\n * @param {BpmnReplace} bpmnReplace\n * @param {Injector} injector\n */\nexport default function AttachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n\n  var self = this;\n\n  this.postExecuted('elements.create', LOW_PRIORITY, function(context) {\n    var elements = context.elements;\n\n    elements = elements.filter(function(shape) {\n      var host = shape.host;\n\n      return shouldReplace(shape, host);\n    });\n\n    if (elements.length !== 1) {\n      return;\n    }\n\n    elements.map(function(element) {\n      return elements.indexOf(element);\n    }).forEach(function(index) {\n      var host = elements[ index ];\n\n      context.elements[ index ] = self._replaceShape(elements[ index ], host);\n    });\n  }, true);\n\n\n  this.preExecute('elements.move', LOW_PRIORITY, function(context) {\n    var shapes = context.shapes,\n        host = context.newHost;\n\n    if (shapes.length !== 1) {\n      return;\n    }\n\n    var shape = shapes[0];\n\n    if (shouldReplace(shape, host)) {\n      context.shapes = [ self._replaceShape(shape, host) ];\n    }\n  }, true);\n}\n\nAttachEventBehavior.$inject = [\n  'bpmnReplace',\n  'injector'\n];\n\ninherits(AttachEventBehavior, CommandInterceptor);\n\nAttachEventBehavior.prototype._replaceShape = function(shape, host) {\n  var eventDefinition = getEventDefinition(shape);\n\n  var boundaryEvent = {\n    type: 'bpmn:BoundaryEvent',\n    host: host\n  };\n\n  if (eventDefinition) {\n    boundaryEvent.eventDefinitionType = eventDefinition.$type;\n  }\n\n  return this._bpmnReplace.replaceElement(shape, boundaryEvent, { layoutConnection: false });\n};\n\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  var businessObject = getBusinessObject(element),\n      eventDefinitions = businessObject.eventDefinitions;\n\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) &&\n    isAny(shape, [ 'bpmn:IntermediateThrowEvent', 'bpmn:IntermediateCatchEvent' ]) && !!host;\n}\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport {\n  filter,\n  forEach\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * BPMN specific boundary event behavior.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function BoundaryEventBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  function getBoundaryEvents(element) {\n    return filter(element.attachers, function(attacher) {\n      return is(attacher, 'bpmn:BoundaryEvent');\n    });\n  }\n\n  // remove after connecting to event-based gateway\n  this.postExecute('connection.create', function(event) {\n    var source = event.context.source,\n        target = event.context.target,\n        boundaryEvents = getBoundaryEvents(target);\n\n    if (\n      is(source, 'bpmn:EventBasedGateway') &&\n      is(target, 'bpmn:ReceiveTask') &&\n      boundaryEvents.length > 0\n    ) {\n      modeling.removeElements(boundaryEvents);\n    }\n\n  });\n\n  // remove after replacing connected gateway with event-based gateway\n  this.postExecute('connection.reconnect', function(event) {\n    var oldSource = event.context.oldSource,\n        newSource = event.context.newSource;\n\n    if (is(oldSource, 'bpmn:Gateway') &&\n        is(newSource, 'bpmn:EventBasedGateway')) {\n      forEach(newSource.outgoing, function(connection) {\n        var target = connection.target,\n            attachedboundaryEvents = getBoundaryEvents(target);\n\n        if (is(target, 'bpmn:ReceiveTask') &&\n            attachedboundaryEvents.length > 0) {\n          modeling.removeElements(attachedboundaryEvents);\n        }\n      });\n    }\n  });\n\n}\n\nBoundaryEventBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\ninherits(BoundaryEventBehavior, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport { getBusinessObject, is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { hasEventDefinition, isEventSubProcess } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../lib/features/modeling/Modeling').default} Modeling\n */\n\n/**\n * Behavior ensuring that only a single compensation activity is connected to a\n * compensation boundary event when connecting, reconnecting or replacing shapes.\n *\n * @param {import('diagram-js/lib/core/EventBus').default} eventBus\n * @param {import('../Modeling').default} modeling\n * @param {import('../../rules/BpmnRules').default} bpmnRules\n */\nexport default function CompensateBoundaryEventBehavior(eventBus, modeling, bpmnRules) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.preExecute('shape.replace', handleReplacement, true);\n  this.postExecuted('shape.replace', handleReplacementPostExecuted, true);\n  this.preExecute('connection.create', handleNewConnection, true);\n  this.postExecuted('connection.delete', handleConnectionRemoval, true);\n  this.postExecuted('connection.reconnect', handleReconnection, true);\n  this.postExecuted('element.updateProperties', handlePropertiesUpdate, true);\n\n  /**\n   * Given a connection from boundary event is removed, remove the `isForCompensation` property.\n   */\n  function handleConnectionRemoval(context) {\n    const source = context.source,\n          target = context.target;\n\n    if (isCompensationBoundaryEvent(source) && isForCompensation(target)) {\n      removeIsForCompensationProperty(target);\n    }\n  }\n\n  /**\n   * Add `isForCompensation` property and make sure only a single compensation activity is connected.\n   */\n  function handleNewConnection(context) {\n    const connection = context.connection,\n          source = context.source,\n          target = context.target;\n\n    if (isCompensationBoundaryEvent(source) && isForCompensationAllowed(target)) {\n      addIsForCompensationProperty(target);\n      removeExistingAssociations(source, [ connection ]);\n    }\n  }\n\n  function handleReconnection(context) {\n    const newTarget = context.newTarget,\n          oldSource = context.oldSource,\n          oldTarget = context.oldTarget;\n\n    // target changes\n    if (oldTarget !== newTarget) {\n      const source = oldSource;\n\n      // oldTarget perspective\n      if (isForCompensation(oldTarget)) {\n        removeIsForCompensationProperty(oldTarget);\n      }\n\n      // newTarget perspective\n      if (isCompensationBoundaryEvent(source) && isForCompensationAllowed(newTarget)) {\n        addIsForCompensationProperty(newTarget);\n      }\n    }\n  }\n\n  function handlePropertiesUpdate(context) {\n    const { element } = context;\n\n    if (isForCompensation(element)) {\n      removeDisallowedConnections(element);\n      removeAttachments(element);\n    } else if (isForCompensationAllowed(element)) {\n      removeIncomingCompensationAssociations(element);\n    }\n  }\n\n  /**\n   * When replacing a boundary event, make sure the compensation activity is connected,\n   * and remove the potential candidates for connection replacement to have a single compensation activity.\n   */\n  function handleReplacement(context) {\n    const {\n      newData,\n      oldShape\n    } = context;\n\n    // from compensate boundary event\n    if (isCompensationBoundaryEvent(context.oldShape) &&\n      newData.eventDefinitionType !== 'bpmn:CompensateEventDefinition' ||\n      newData.type !== 'bpmn:BoundaryEvent'\n    ) {\n      const targetConnection = oldShape.outgoing.find(\n        ({ target }) => isForCompensation(target)\n      );\n\n      if (targetConnection && targetConnection.target) {\n        context._connectionTarget = targetConnection.target;\n      }\n    }\n\n    // to compensate boundary event\n    else if (\n      !isCompensationBoundaryEvent(context.oldShape) &&\n      newData.eventDefinitionType === 'bpmn:CompensateEventDefinition' &&\n      newData.type === 'bpmn:BoundaryEvent'\n    ) {\n      const targetConnection = oldShape.outgoing.find(\n        ({ target }) => isForCompensationAllowed(target)\n      );\n\n      if (targetConnection && targetConnection.target) {\n        context._connectionTarget = targetConnection.target;\n      }\n\n      removeOutgoingSequenceFlows(oldShape);\n    }\n  }\n\n  function handleReplacementPostExecuted(context) {\n    const { _connectionTarget: target, newShape } = context;\n\n    if (target) {\n      modeling.connect(newShape, target);\n    }\n  }\n\n  function addIsForCompensationProperty(target) {\n    modeling.updateProperties(target, { isForCompensation: true });\n  }\n\n  function removeIsForCompensationProperty(target) {\n    modeling.updateProperties(target, { isForCompensation: undefined });\n  }\n\n  function removeDisallowedConnections(element) {\n\n    for (const connection of element.incoming) {\n      if (!bpmnRules.canConnect(connection.source, element)) {\n        modeling.removeConnection(connection);\n      }\n    }\n\n    for (const connection of element.outgoing) {\n      if (!bpmnRules.canConnect(element, connection.target)) {\n        modeling.removeConnection(connection);\n      }\n    }\n  }\n\n  function removeExistingAssociations(boundaryEvent, ignoredAssociations) {\n    const associations = boundaryEvent.outgoing.filter(connection => is(connection, 'bpmn:Association'));\n    const associationsToRemove = associations.filter(association => {\n      return isForCompensation(association.target) && !ignoredAssociations.includes(association);\n    });\n\n    // remove existing associations\n    associationsToRemove.forEach(association => modeling.removeConnection(association));\n  }\n\n  function removeAttachments(element) {\n    const attachments = element.attachers.slice();\n\n    if (!attachments.length) {\n      return;\n    }\n\n    modeling.removeElements(attachments);\n  }\n\n  function removeIncomingCompensationAssociations(element) {\n    const compensationAssociations = element.incoming.filter(\n      connection => isCompensationBoundaryEvent(connection.source)\n    );\n\n    modeling.removeElements(compensationAssociations);\n  }\n\n  function removeOutgoingSequenceFlows(element) {\n    const sequenceFlows = element.outgoing.filter(\n      connection => is(connection, 'bpmn:SequenceFlow')\n    );\n\n    modeling.removeElements(sequenceFlows);\n  }\n}\n\ninherits(CompensateBoundaryEventBehavior, CommandInterceptor);\n\nCompensateBoundaryEventBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'bpmnRules'\n];\n\n// helpers //////////\n\nfunction isForCompensation(element) {\n  const bo = getBusinessObject(element);\n  return bo && bo.get('isForCompensation');\n}\n\nfunction isCompensationBoundaryEvent(element) {\n  return element && is(element, 'bpmn:BoundaryEvent') &&\n    hasEventDefinition(element, 'bpmn:CompensateEventDefinition');\n}\n\nfunction isForCompensationAllowed(element) {\n  return element && is(element, 'bpmn:Activity') && !isEventSubProcess(element);\n}\n","import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getParent } from '../util/ModelingUtil';\n\n/**\n * @typedef {import('didi').Injector} Injector\n */\n\n/**\n * @param {Injector} injector\n */\nexport default function CreateBehavior(injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.preExecute('shape.create', 1500, function(event) {\n    var context = event.context,\n        parent = context.parent,\n        shape = context.shape;\n\n    if (is(parent, 'bpmn:Lane') && !is(shape, 'bpmn:Lane')) {\n      context.parent = getParent(parent, 'bpmn:Participant');\n    }\n  });\n\n}\n\n\nCreateBehavior.$inject = [ 'injector' ];\n\ninherits(CreateBehavior, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n */\n\n/**\n * BPMN specific create data object behavior.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n */\nexport default function CreateDataObjectBehavior(eventBus, bpmnFactory) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.preExecute('shape.create', function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    if (is(shape, 'bpmn:DataObjectReference') && shape.type !== 'label') {\n\n      // create a DataObject every time a DataObjectReference is created\n      var dataObject = bpmnFactory.create('bpmn:DataObject');\n\n      // set the reference to the DataObject\n      shape.businessObject.dataObjectRef = dataObject;\n    }\n  });\n\n}\n\nCreateDataObjectBehavior.$inject = [\n  'eventBus',\n  'bpmnFactory'\n];\n\ninherits(CreateDataObjectBehavior, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getBusinessObject, is } from '../../../util/ModelUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\nimport { getBBox } from 'diagram-js/lib/util/Elements';\n\nimport {\n  assign,\n  find\n} from 'min-dash';\n\nimport { asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\n\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\nvar HORIZONTAL_PARTICIPANT_PADDING = 20,\n    VERTICAL_PARTICIPANT_PADDING = 20;\n\nexport var PARTICIPANT_BORDER_WIDTH = 30;\n\nvar HIGH_PRIORITY = 2000;\n\n\n/**\n * BPMN-specific behavior for creating participants.\n *\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function CreateParticipantBehavior(canvas, eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  // fit participant\n  eventBus.on([\n    'create.start',\n    'shape.move.start'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        rootElement = canvas.getRootElement();\n\n    if (!is(shape, 'bpmn:Participant') ||\n      !is(rootElement, 'bpmn:Process') ||\n      !rootElement.children.length) {\n      return;\n    }\n\n    // ignore connections, groups and labels\n    var children = rootElement.children.filter(function(element) {\n      return !is(element, 'bpmn:Group') &&\n        !isLabel(element) &&\n        !isConnection(element);\n    });\n\n    // ensure for available children to calculate bounds\n    if (!children.length) {\n      return;\n    }\n\n    var childrenBBox = getBBox(children);\n\n    var participantBounds = getParticipantBounds(shape, childrenBBox);\n\n    // assign width and height\n    assign(shape, participantBounds);\n\n    // assign create constraints\n    context.createConstraints = getParticipantCreateConstraints(shape, childrenBBox);\n  });\n\n  // force hovering process when creating first participant\n  eventBus.on('create.start', HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        rootElement = canvas.getRootElement(),\n        rootElementGfx = canvas.getGraphics(rootElement);\n\n    function ensureHoveringProcess(event) {\n      event.element = rootElement;\n      event.gfx = rootElementGfx;\n    }\n\n    if (is(shape, 'bpmn:Participant') && is(rootElement, 'bpmn:Process')) {\n      eventBus.on('element.hover', HIGH_PRIORITY, ensureHoveringProcess);\n\n      eventBus.once('create.cleanup', function() {\n        eventBus.off('element.hover', ensureHoveringProcess);\n      });\n    }\n  });\n\n  // turn process into collaboration when creating first participant\n  function getOrCreateCollaboration() {\n    var rootElement = canvas.getRootElement();\n\n    if (is(rootElement, 'bpmn:Collaboration')) {\n      return rootElement;\n    }\n\n    return modeling.makeCollaboration();\n  }\n\n  // when creating mutliple elements through `elements.create` parent must be set to collaboration\n  // and passed to `shape.create` as hint\n  this.preExecute('elements.create', HIGH_PRIORITY, function(context) {\n    var elements = context.elements,\n        parent = context.parent,\n        participant = findParticipant(elements),\n        hints;\n\n    if (participant && is(parent, 'bpmn:Process')) {\n      context.parent = getOrCreateCollaboration();\n\n      hints = context.hints = context.hints || {};\n\n      hints.participant = participant;\n      hints.process = parent;\n      hints.processRef = getBusinessObject(participant).get('processRef');\n    }\n  }, true);\n\n  // when creating single shape through `shape.create` parent must be set to collaboration\n  // unless it was already set through `elements.create`\n  this.preExecute('shape.create', function(context) {\n    var parent = context.parent,\n        shape = context.shape;\n\n    if (is(shape, 'bpmn:Participant') && is(parent, 'bpmn:Process')) {\n      context.parent = getOrCreateCollaboration();\n\n      context.process = parent;\n      context.processRef = getBusinessObject(shape).get('processRef');\n    }\n  }, true);\n\n  // #execute necessary because #preExecute not called on CommandStack#redo\n  this.execute('shape.create', function(context) {\n    var hints = context.hints || {},\n        process = context.process || hints.process,\n        shape = context.shape,\n        participant = hints.participant;\n\n    // both shape.create and elements.create must be handled\n    if (process && (!participant || shape === participant)) {\n\n      // monkey-patch process ref\n      getBusinessObject(shape).set('processRef', getBusinessObject(process));\n    }\n  }, true);\n\n  this.revert('shape.create', function(context) {\n    var hints = context.hints || {},\n        process = context.process || hints.process,\n        processRef = context.processRef || hints.processRef,\n        shape = context.shape,\n        participant = hints.participant;\n\n    // both shape.create and elements.create must be handled\n    if (process && (!participant || shape === participant)) {\n\n      // monkey-patch process ref\n      getBusinessObject(shape).set('processRef', processRef);\n    }\n  }, true);\n\n  this.postExecute('shape.create', function(context) {\n    var hints = context.hints || {},\n        process = context.process || context.hints.process,\n        shape = context.shape,\n        participant = hints.participant;\n\n    if (process) {\n      var children = process.children.slice();\n\n      // both shape.create and elements.create must be handled\n      if (!participant) {\n        modeling.moveElements(children, { x: 0, y: 0 }, shape);\n      } else if (shape === participant) {\n        modeling.moveElements(children, { x: 0, y: 0 }, participant);\n      }\n    }\n  }, true);\n}\n\nCreateParticipantBehavior.$inject = [\n  'canvas',\n  'eventBus',\n  'modeling'\n];\n\ninherits(CreateParticipantBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction getParticipantBounds(shape, childrenBBox) {\n  childrenBBox = {\n    width: childrenBBox.width + HORIZONTAL_PARTICIPANT_PADDING * 2 + PARTICIPANT_BORDER_WIDTH,\n    height: childrenBBox.height + VERTICAL_PARTICIPANT_PADDING * 2\n  };\n\n  var width = Math.max(shape.width, childrenBBox.width),\n      height = Math.max(shape.height, childrenBBox.height);\n\n  return {\n    x: -width / 2,\n    y: -height / 2,\n    width: width,\n    height: height\n  };\n}\n\nfunction getParticipantCreateConstraints(shape, childrenBBox) {\n  childrenBBox = asTRBL(childrenBBox);\n\n  return {\n    bottom: childrenBBox.top + shape.height / 2 - VERTICAL_PARTICIPANT_PADDING,\n    left: childrenBBox.right - shape.width / 2 + HORIZONTAL_PARTICIPANT_PADDING,\n    top: childrenBBox.bottom - shape.height / 2 + VERTICAL_PARTICIPANT_PADDING,\n    right: childrenBBox.left + shape.width / 2 - HORIZONTAL_PARTICIPANT_PADDING - PARTICIPANT_BORDER_WIDTH\n  };\n}\n\nfunction findParticipant(elements) {\n  return find(elements, function(element) {\n    return is(element, 'bpmn:Participant');\n  });\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport {\n  find\n} from 'min-dash';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n */\n\nvar TARGET_REF_PLACEHOLDER_NAME = '__targetRef_placeholder';\n\n\n/**\n * This behavior makes sure we always set a fake\n * DataInputAssociation#targetRef as demanded by the BPMN 2.0\n * XSD schema.\n *\n * The reference is set to a bpmn:Property{ name: '__targetRef_placeholder' }\n * which is created on the fly and cleaned up afterwards if not needed\n * anymore.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n */\nexport default function DataInputAssociationBehavior(eventBus, bpmnFactory) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  this.executed([\n    'connection.create',\n    'connection.delete',\n    'connection.move',\n    'connection.reconnect'\n  ], ifDataInputAssociation(fixTargetRef));\n\n  this.reverted([\n    'connection.create',\n    'connection.delete',\n    'connection.move',\n    'connection.reconnect'\n  ], ifDataInputAssociation(fixTargetRef));\n\n\n  function usesTargetRef(element, targetRef, removedConnection) {\n\n    var inputAssociations = element.get('dataInputAssociations');\n\n    return find(inputAssociations, function(association) {\n      return association !== removedConnection &&\n             association.targetRef === targetRef;\n    });\n  }\n\n  function getTargetRef(element, create) {\n\n    var properties = element.get('properties');\n\n    var targetRefProp = find(properties, function(p) {\n      return p.name === TARGET_REF_PLACEHOLDER_NAME;\n    });\n\n    if (!targetRefProp && create) {\n      targetRefProp = bpmnFactory.create('bpmn:Property', {\n        name: TARGET_REF_PLACEHOLDER_NAME\n      });\n\n      collectionAdd(properties, targetRefProp);\n    }\n\n    return targetRefProp;\n  }\n\n  function cleanupTargetRef(element, connection) {\n\n    var targetRefProp = getTargetRef(element);\n\n    if (!targetRefProp) {\n      return;\n    }\n\n    if (!usesTargetRef(element, targetRefProp, connection)) {\n      collectionRemove(element.get('properties'), targetRefProp);\n    }\n  }\n\n  /**\n   * Make sure targetRef is set to a valid property or\n   * `null` if the connection is detached.\n   *\n   * @param {Event} event\n   */\n  function fixTargetRef(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        connectionBo = connection.businessObject,\n        target = connection.target,\n        targetBo = target && target.businessObject,\n        newTarget = context.newTarget,\n        newTargetBo = newTarget && newTarget.businessObject,\n        oldTarget = context.oldTarget || context.target,\n        oldTargetBo = oldTarget && oldTarget.businessObject;\n\n    var dataAssociation = connection.businessObject,\n        targetRefProp;\n\n    if (oldTargetBo && oldTargetBo !== targetBo) {\n      cleanupTargetRef(oldTargetBo, connectionBo);\n    }\n\n    if (newTargetBo && newTargetBo !== targetBo) {\n      cleanupTargetRef(newTargetBo, connectionBo);\n    }\n\n    if (targetBo) {\n      targetRefProp = getTargetRef(targetBo, true);\n      dataAssociation.targetRef = targetRefProp;\n    } else {\n      dataAssociation.targetRef = null;\n    }\n  }\n}\n\nDataInputAssociationBehavior.$inject = [\n  'eventBus',\n  'bpmnFactory'\n];\n\ninherits(DataInputAssociationBehavior, CommandInterceptor);\n\n\n/**\n * Only call the given function when the event\n * changes a bpmn:DataInputAssociation.\n *\n * @param {Function} fn\n * @return {Function}\n */\nfunction ifDataInputAssociation(fn) {\n\n  return function(event) {\n    var context = event.context,\n        connection = context.connection;\n\n    if (is(connection, 'bpmn:DataInputAssociation')) {\n      return fn(event);\n    }\n  };\n}","/**\r\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\r\n *\r\n * @typedef {import('../BpmnUpdater').default} BpmnUpdater\r\n */\r\n\r\n/**\r\n * @implements {CommandHandler}\r\n *\r\n * @param {BpmnUpdater} bpmnUpdater\r\n */\r\nexport default function UpdateSemanticParentHandler(bpmnUpdater) {\r\n  this._bpmnUpdater = bpmnUpdater;\r\n}\r\n\r\nUpdateSemanticParentHandler.$inject = [ 'bpmnUpdater' ];\r\n\r\n\r\nUpdateSemanticParentHandler.prototype.execute = function(context) {\r\n  var dataStoreBo = context.dataStoreBo,\r\n      dataStoreDi = context.dataStoreDi,\r\n      newSemanticParent = context.newSemanticParent,\r\n      newDiParent = context.newDiParent;\r\n\r\n  context.oldSemanticParent = dataStoreBo.$parent;\r\n  context.oldDiParent = dataStoreDi.$parent;\r\n\r\n  // update semantic parent\r\n  this._bpmnUpdater.updateSemanticParent(dataStoreBo, newSemanticParent);\r\n\r\n  // update DI parent\r\n  this._bpmnUpdater.updateDiParent(dataStoreDi, newDiParent);\r\n\r\n  return [];\r\n};\r\n\r\nUpdateSemanticParentHandler.prototype.revert = function(context) {\r\n  var dataStoreBo = context.dataStoreBo,\r\n      dataStoreDi = context.dataStoreDi,\r\n      oldSemanticParent = context.oldSemanticParent,\r\n      oldDiParent = context.oldDiParent;\r\n\r\n  // update semantic parent\r\n  this._bpmnUpdater.updateSemanticParent(dataStoreBo, oldSemanticParent);\r\n\r\n  // update DI parent\r\n  this._bpmnUpdater.updateDiParent(dataStoreDi, oldDiParent);\r\n\r\n  return [];\r\n};\r\n\r\n","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport {\r\n  getBusinessObject,\r\n  getDi,\r\n  is\r\n} from '../../../util/ModelUtil';\r\n\r\nimport { isAny } from '../util/ModelingUtil';\r\n\r\nimport UpdateSemanticParentHandler from '../cmd/UpdateSemanticParentHandler';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n * @typedef {import('diagram-js/lib/command/CommandStack').default} CommandStack\r\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * BPMN specific data store behavior.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {CommandStack} commandStack\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function DataStoreBehavior(\r\n    canvas, commandStack, elementRegistry,\r\n    eventBus) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  commandStack.registerHandler('dataStore.updateContainment', UpdateSemanticParentHandler);\r\n\r\n  function getFirstParticipantWithProcessRef() {\r\n    return elementRegistry.filter(function(element) {\r\n      return is(element, 'bpmn:Participant') && getBusinessObject(element).processRef;\r\n    })[0];\r\n  }\r\n\r\n  function getDataStores(element) {\r\n    return element.children.filter(function(child) {\r\n      return is(child, 'bpmn:DataStoreReference') && !child.labelTarget;\r\n    });\r\n  }\r\n\r\n  function updateDataStoreParent(dataStore, newDataStoreParent) {\r\n    var dataStoreBo = dataStore.businessObject || dataStore;\r\n\r\n    newDataStoreParent = newDataStoreParent || getFirstParticipantWithProcessRef();\r\n\r\n    if (newDataStoreParent) {\r\n      var newDataStoreParentBo = newDataStoreParent.businessObject || newDataStoreParent;\r\n\r\n      commandStack.execute('dataStore.updateContainment', {\r\n        dataStoreBo: dataStoreBo,\r\n        dataStoreDi: getDi(dataStore),\r\n        newSemanticParent: newDataStoreParentBo.processRef || newDataStoreParentBo,\r\n        newDiParent: getDi(newDataStoreParent)\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  // disable auto-resize for data stores\r\n  this.preExecute('shape.create', function(event) {\r\n\r\n    var context = event.context,\r\n        shape = context.shape;\r\n\r\n    if (is(shape, 'bpmn:DataStoreReference') &&\r\n        shape.type !== 'label') {\r\n\r\n      if (!context.hints) {\r\n        context.hints = {};\r\n      }\r\n\r\n      // prevent auto resizing\r\n      context.hints.autoResize = false;\r\n    }\r\n  });\r\n\r\n\r\n  // disable auto-resize for data stores\r\n  this.preExecute('elements.move', function(event) {\r\n    var context = event.context,\r\n        shapes = context.shapes;\r\n\r\n    var dataStoreReferences = shapes.filter(function(shape) {\r\n      return is(shape, 'bpmn:DataStoreReference');\r\n    });\r\n\r\n    if (dataStoreReferences.length) {\r\n      if (!context.hints) {\r\n        context.hints = {};\r\n      }\r\n\r\n      // prevent auto resizing for data store references\r\n      context.hints.autoResize = shapes.filter(function(shape) {\r\n        return !is(shape, 'bpmn:DataStoreReference');\r\n      });\r\n    }\r\n  });\r\n\r\n\r\n  // update parent on data store created\r\n  this.postExecute('shape.create', function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        parent = shape.parent;\r\n\r\n\r\n    if (is(shape, 'bpmn:DataStoreReference') &&\r\n        shape.type !== 'label' &&\r\n        is(parent, 'bpmn:Collaboration')) {\r\n\r\n      updateDataStoreParent(shape);\r\n    }\r\n  });\r\n\r\n\r\n  // update parent on data store moved\r\n  this.postExecute('shape.move', function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        oldParent = context.oldParent,\r\n        parent = shape.parent;\r\n\r\n    if (is(oldParent, 'bpmn:Collaboration')) {\r\n\r\n      // do nothing if not necessary\r\n      return;\r\n    }\r\n\r\n    if (is(shape, 'bpmn:DataStoreReference') &&\r\n        shape.type !== 'label' &&\r\n        is(parent, 'bpmn:Collaboration')) {\r\n\r\n      var participant = is(oldParent, 'bpmn:Participant') ?\r\n        oldParent :\r\n        getAncestor(oldParent, 'bpmn:Participant');\r\n\r\n      updateDataStoreParent(shape, participant);\r\n    }\r\n  });\r\n\r\n\r\n  // update data store parents on participant or subprocess deleted\r\n  this.postExecute('shape.delete', function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        rootElement = canvas.getRootElement();\r\n\r\n    if (isAny(shape, [ 'bpmn:Participant', 'bpmn:SubProcess' ])\r\n        && is(rootElement, 'bpmn:Collaboration')) {\r\n      getDataStores(rootElement)\r\n        .filter(function(dataStore) {\r\n          return isDescendant(dataStore, shape);\r\n        })\r\n        .forEach(function(dataStore) {\r\n          updateDataStoreParent(dataStore);\r\n        });\r\n    }\r\n  });\r\n\r\n  // update data store parents on collaboration -> process\r\n  this.postExecute('canvas.updateRoot', function(event) {\r\n    var context = event.context,\r\n        oldRoot = context.oldRoot,\r\n        newRoot = context.newRoot;\r\n\r\n    var dataStores = getDataStores(oldRoot);\r\n\r\n    dataStores.forEach(function(dataStore) {\r\n\r\n      if (is(newRoot, 'bpmn:Process')) {\r\n        updateDataStoreParent(dataStore, newRoot);\r\n      }\r\n\r\n    });\r\n  });\r\n}\r\n\r\nDataStoreBehavior.$inject = [\r\n  'canvas',\r\n  'commandStack',\r\n  'elementRegistry',\r\n  'eventBus',\r\n];\r\n\r\ninherits(DataStoreBehavior, CommandInterceptor);\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction isDescendant(descendant, ancestor) {\r\n  var descendantBo = descendant.businessObject || descendant,\r\n      ancestorBo = ancestor.businessObject || ancestor;\r\n\r\n  while (descendantBo.$parent) {\r\n    if (descendantBo.$parent === ancestorBo.processRef || ancestorBo) {\r\n      return true;\r\n    }\r\n\r\n    descendantBo = descendantBo.$parent;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction getAncestor(element, type) {\r\n\r\n  while (element.parent) {\r\n    if (is(element.parent, type)) {\r\n      return element.parent;\r\n    }\r\n\r\n    element = element.parent;\r\n  }\r\n}","import {\r\n  filter,\r\n  isNumber\r\n} from 'min-dash';\r\n\r\nvar max = Math.max,\r\n    min = Math.min;\r\n\r\nvar DEFAULT_CHILD_BOX_PADDING = 20;\r\n\r\nimport {\r\n  getBBox\r\n} from '../../util/Elements';\r\n\r\nimport {\r\n  asTRBL,\r\n  asBounds\r\n} from '../../layout/LayoutUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ElementLike} Element\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../util/Types').Direction} Direction\r\n * @typedef {import('../../util/Types').Point} Point\r\n * @typedef {import('../../util/Types').Rect} Rect\r\n * @typedef {import('../../util/Types').RectTRBL} RectTRBL\r\n */\r\n\r\n/**\r\n * Substract a TRBL from another\r\n *\r\n * @param {RectTRBL} trblA\r\n * @param {RectTRBL} trblB\r\n *\r\n * @return {RectTRBL}\r\n */\r\nexport function substractTRBL(trblA, trblB) {\r\n  return {\r\n    top: trblA.top - trblB.top,\r\n    right: trblA.right - trblB.right,\r\n    bottom: trblA.bottom - trblB.bottom,\r\n    left: trblA.left - trblB.left\r\n  };\r\n}\r\n\r\n/**\r\n * Resize the given bounds by the specified delta from a given anchor point.\r\n *\r\n * @param {Rect} bounds the bounding box that should be resized\r\n * @param {Direction} direction in which the element is resized (nw, ne, se, sw)\r\n * @param {Point} delta of the resize operation\r\n *\r\n * @return {Rect} resized bounding box\r\n */\r\nexport function resizeBounds(bounds, direction, delta) {\r\n  var dx = delta.x,\r\n      dy = delta.y;\r\n\r\n  var newBounds = {\r\n    x: bounds.x,\r\n    y: bounds.y,\r\n    width: bounds.width,\r\n    height: bounds.height\r\n  };\r\n\r\n  if (direction.indexOf('n') !== -1) {\r\n    newBounds.y = bounds.y + dy;\r\n    newBounds.height = bounds.height - dy;\r\n  } else if (direction.indexOf('s') !== -1) {\r\n    newBounds.height = bounds.height + dy;\r\n  }\r\n\r\n  if (direction.indexOf('e') !== -1) {\r\n    newBounds.width = bounds.width + dx;\r\n  } else if (direction.indexOf('w') !== -1) {\r\n    newBounds.x = bounds.x + dx;\r\n    newBounds.width = bounds.width - dx;\r\n  }\r\n\r\n  return newBounds;\r\n}\r\n\r\n\r\n/**\r\n * Resize the given bounds by applying the passed\r\n * { top, right, bottom, left } delta.\r\n *\r\n * @param {Rect} bounds\r\n * @param {RectTRBL} resize\r\n *\r\n * @return {Rect}\r\n */\r\nexport function resizeTRBL(bounds, resize) {\r\n  return {\r\n    x: bounds.x + (resize.left || 0),\r\n    y: bounds.y + (resize.top || 0),\r\n    width: bounds.width - (resize.left || 0) + (resize.right || 0),\r\n    height: bounds.height - (resize.top || 0) + (resize.bottom || 0)\r\n  };\r\n}\r\n\r\n\r\nexport function reattachPoint(bounds, newBounds, point) {\r\n\r\n  var sx = bounds.width / newBounds.width,\r\n      sy = bounds.height / newBounds.height;\r\n\r\n  return {\r\n    x: Math.round((newBounds.x + newBounds.width / 2)) - Math.floor(((bounds.x + bounds.width / 2) - point.x) / sx),\r\n    y: Math.round((newBounds.y + newBounds.height / 2)) - Math.floor(((bounds.y + bounds.height / 2) - point.y) / sy)\r\n  };\r\n}\r\n\r\n\r\nfunction applyConstraints(attr, trbl, resizeConstraints) {\r\n\r\n  var value = trbl[attr],\r\n      minValue = resizeConstraints.min && resizeConstraints.min[attr],\r\n      maxValue = resizeConstraints.max && resizeConstraints.max[attr];\r\n\r\n  if (isNumber(minValue)) {\r\n    value = (/top|left/.test(attr) ? min : max)(value, minValue);\r\n  }\r\n\r\n  if (isNumber(maxValue)) {\r\n    value = (/top|left/.test(attr) ? max : min)(value, maxValue);\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\nexport function ensureConstraints(currentBounds, resizeConstraints) {\r\n\r\n  if (!resizeConstraints) {\r\n    return currentBounds;\r\n  }\r\n\r\n  var currentTrbl = asTRBL(currentBounds);\r\n\r\n  return asBounds({\r\n    top: applyConstraints('top', currentTrbl, resizeConstraints),\r\n    right: applyConstraints('right', currentTrbl, resizeConstraints),\r\n    bottom: applyConstraints('bottom', currentTrbl, resizeConstraints),\r\n    left: applyConstraints('left', currentTrbl, resizeConstraints)\r\n  });\r\n}\r\n\r\n\r\nexport function getMinResizeBounds(direction, currentBounds, minDimensions, childrenBounds) {\r\n\r\n  var currentBox = asTRBL(currentBounds);\r\n\r\n  var minBox = {\r\n    top: /n/.test(direction) ? currentBox.bottom - minDimensions.height : currentBox.top,\r\n    left: /w/.test(direction) ? currentBox.right - minDimensions.width : currentBox.left,\r\n    bottom: /s/.test(direction) ? currentBox.top + minDimensions.height : currentBox.bottom,\r\n    right: /e/.test(direction) ? currentBox.left + minDimensions.width : currentBox.right\r\n  };\r\n\r\n  var childrenBox = childrenBounds ? asTRBL(childrenBounds) : minBox;\r\n\r\n  var combinedBox = {\r\n    top: min(minBox.top, childrenBox.top),\r\n    left: min(minBox.left, childrenBox.left),\r\n    bottom: max(minBox.bottom, childrenBox.bottom),\r\n    right: max(minBox.right, childrenBox.right)\r\n  };\r\n\r\n  return asBounds(combinedBox);\r\n}\r\n\r\nfunction asPadding(mayBePadding, defaultValue) {\r\n  if (typeof mayBePadding !== 'undefined') {\r\n    return mayBePadding;\r\n  } else {\r\n    return DEFAULT_CHILD_BOX_PADDING;\r\n  }\r\n}\r\n\r\nexport function addPadding(bbox, padding) {\r\n  var left, right, top, bottom;\r\n\r\n  if (typeof padding === 'object') {\r\n    left = asPadding(padding.left);\r\n    right = asPadding(padding.right);\r\n    top = asPadding(padding.top);\r\n    bottom = asPadding(padding.bottom);\r\n  } else {\r\n    left = right = top = bottom = asPadding(padding);\r\n  }\r\n\r\n  return {\r\n    x: bbox.x - left,\r\n    y: bbox.y - top,\r\n    width: bbox.width + left + right,\r\n    height: bbox.height + top + bottom\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Is the given element part of the resize\r\n * targets min boundary box?\r\n *\r\n * This is the default implementation which excludes\r\n * connections and labels.\r\n *\r\n * @param {Element} element\r\n */\r\nfunction isBBoxChild(element) {\r\n\r\n  // exclude connections\r\n  if (element.waypoints) {\r\n    return false;\r\n  }\r\n\r\n  // exclude labels\r\n  if (element.type === 'label') {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Return children bounding computed from a shapes children\r\n * or a list of prefiltered children.\r\n *\r\n * @param {Shape|Shape[]} shapeOrChildren\r\n * @param {RectTRBL|number} padding\r\n *\r\n * @return {Rect}\r\n */\r\nexport function computeChildrenBBox(shapeOrChildren, padding) {\r\n\r\n  var elements;\r\n\r\n  // compute based on shape\r\n  if (shapeOrChildren.length === undefined) {\r\n\r\n    // grab all the children that are part of the\r\n    // parents children box\r\n    elements = filter(shapeOrChildren.children, isBBoxChild);\r\n\r\n  } else {\r\n    elements = shapeOrChildren;\r\n  }\r\n\r\n  if (elements.length) {\r\n    return addPadding(getBBox(elements), padding);\r\n  }\r\n}\r\n","import { is } from '../../../util/ModelUtil';\n\nimport {\n  getParent\n} from './ModelingUtil';\n\nimport {\n  isHorizontal\n} from '../../../util/DiUtil';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substractTRBL,\n  resizeTRBL\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n/**\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\nvar abs = Math.abs;\n\n\nfunction getTRBLResize(oldBounds, newBounds) {\n  return substractTRBL(asTRBL(newBounds), asTRBL(oldBounds));\n}\n\n\nvar LANE_PARENTS = [\n  'bpmn:Participant',\n  'bpmn:Process',\n  'bpmn:SubProcess'\n];\n\nexport var LANE_INDENTATION = 30;\n\n\n/**\n * Return all lanes that are children of the given shape.\n *\n * @param  {Shape} shape\n * @param  {Shape[]} [collectedShapes]\n *\n * @return {Shape[]}\n */\nexport function collectLanes(shape, collectedShapes) {\n\n  collectedShapes = collectedShapes || [];\n\n  shape.children.filter(function(s) {\n    if (is(s, 'bpmn:Lane')) {\n      collectLanes(s, collectedShapes);\n\n      collectedShapes.push(s);\n    }\n  });\n\n  return collectedShapes;\n}\n\n\n/**\n * Return all lanes that are direct children of the given shape.\n *\n * @param {Shape} shape\n *\n * @return {Shape[]}\n */\nexport function getChildLanes(shape) {\n  return shape.children.filter(function(c) {\n    return is(c, 'bpmn:Lane');\n  });\n}\n\n\n/**\n * Return the parent shape of the given lane.\n *\n * @param {Shape} shape\n *\n * @return {Shape}\n */\nexport function getLanesRoot(shape) {\n  return getParent(shape, LANE_PARENTS) || shape;\n}\n\n\n/**\n * Compute the required resize operations for lanes\n * adjacent to the given shape, assuming it will be\n * resized to the given new bounds.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n *\n * @return { {\n *   shape: Shape;\n *   newBounds: Rect;\n * }[] }\n */\nexport function computeLanesResize(shape, newBounds) {\n\n  var rootElement = getLanesRoot(shape);\n\n  var initialShapes = is(rootElement, 'bpmn:Process') ? [] : [ rootElement ];\n\n  var allLanes = collectLanes(rootElement, initialShapes),\n      shapeTrbl = asTRBL(shape),\n      shapeNewTrbl = asTRBL(newBounds),\n      trblResize = getTRBLResize(shape, newBounds),\n      resizeNeeded = [];\n\n  var isHorizontalLane = isHorizontal(shape);\n\n  allLanes.forEach(function(other) {\n\n    if (other === shape) {\n      return;\n    }\n\n    var topResize = isHorizontalLane ? 0 : trblResize.top,\n        rightResize = isHorizontalLane ? trblResize.right : 0,\n        bottomResize = isHorizontalLane ? 0 : trblResize.bottom,\n        leftResize = isHorizontalLane ? trblResize.left : 0;\n\n    var otherTrbl = asTRBL(other);\n\n    if (trblResize.top) {\n      if (abs(otherTrbl.bottom - shapeTrbl.top) < 10) {\n        bottomResize = shapeNewTrbl.top - otherTrbl.bottom;\n      }\n\n      if (abs(otherTrbl.top - shapeTrbl.top) < 5) {\n        topResize = shapeNewTrbl.top - otherTrbl.top;\n      }\n    }\n\n    if (trblResize.left) {\n      if (abs(otherTrbl.right - shapeTrbl.left) < 10) {\n        rightResize = shapeNewTrbl.left - otherTrbl.right;\n      }\n\n      if (abs(otherTrbl.left - shapeTrbl.left) < 5) {\n        leftResize = shapeNewTrbl.left - otherTrbl.left;\n      }\n    }\n\n    if (trblResize.bottom) {\n      if (abs(otherTrbl.top - shapeTrbl.bottom) < 10) {\n        topResize = shapeNewTrbl.bottom - otherTrbl.top;\n      }\n\n      if (abs(otherTrbl.bottom - shapeTrbl.bottom) < 5) {\n        bottomResize = shapeNewTrbl.bottom - otherTrbl.bottom;\n      }\n    }\n\n    if (trblResize.right) {\n      if (abs(otherTrbl.left - shapeTrbl.right) < 10) {\n        leftResize = shapeNewTrbl.right - otherTrbl.left;\n      }\n\n      if (abs(otherTrbl.right - shapeTrbl.right) < 5) {\n        rightResize = shapeNewTrbl.right - otherTrbl.right;\n      }\n    }\n\n    if (topResize || rightResize || bottomResize || leftResize) {\n\n      resizeNeeded.push({\n        shape: other,\n        newBounds: resizeTRBL(other, {\n          top: topResize,\n          right: rightResize,\n          bottom: bottomResize,\n          left: leftResize\n        })\n      });\n    }\n\n  });\n\n  return resizeNeeded;\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport {\n  getChildLanes\n} from '../util/LaneUtil';\n\nimport {\n  isHorizontal\n} from '../../../util/DiUtil';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../space-tool/BpmnSpaceTool').default} SpaceTool\n */\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * BPMN specific delete lane behavior.\n *\n * @param {EventBus} eventBus\n * @param {SpaceTool} spaceTool\n */\nexport default function DeleteLaneBehavior(eventBus, spaceTool) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  function compensateLaneDelete(shape, oldParent) {\n    var isHorizontalLane = isHorizontal(shape);\n\n    var siblings = getChildLanes(oldParent);\n\n    var topAffected = [];\n    var bottomAffected = [];\n    var leftAffected = [];\n    var rightAffected = [];\n\n    eachElement(siblings, function(element) {\n\n      if (isHorizontalLane) {\n        if (element.y > shape.y) {\n          bottomAffected.push(element);\n        } else {\n          topAffected.push(element);\n        }\n      } else {\n        if (element.x > shape.x) {\n          rightAffected.push(element);\n        } else {\n          leftAffected.push(element);\n        }\n      }\n\n      return element.children;\n    });\n\n    if (!siblings.length) {\n      return;\n    }\n\n    var offset;\n\n    if (isHorizontalLane) {\n      if (bottomAffected.length && topAffected.length) {\n        offset = shape.height / 2;\n      } else {\n        offset = shape.height;\n      }\n    } else {\n      if (rightAffected.length && leftAffected.length) {\n        offset = shape.width / 2;\n      } else {\n        offset = shape.width;\n      }\n    }\n\n    var topAdjustments,\n        bottomAdjustments,\n        leftAdjustments,\n        rightAdjustments;\n\n    if (topAffected.length) {\n      topAdjustments = spaceTool.calculateAdjustments(\n        topAffected, 'y', offset, shape.y - 10);\n\n      spaceTool.makeSpace(\n        topAdjustments.movingShapes,\n        topAdjustments.resizingShapes,\n        { x: 0, y: offset }, 's');\n    }\n\n    if (bottomAffected.length) {\n      bottomAdjustments = spaceTool.calculateAdjustments(\n        bottomAffected, 'y', -offset, shape.y + shape.height + 10);\n\n      spaceTool.makeSpace(\n        bottomAdjustments.movingShapes,\n        bottomAdjustments.resizingShapes,\n        { x: 0, y: -offset }, 'n');\n    }\n\n    if (leftAffected.length) {\n      leftAdjustments = spaceTool.calculateAdjustments(\n        leftAffected, 'x', offset, shape.x - 10);\n\n      spaceTool.makeSpace(\n        leftAdjustments.movingShapes,\n        leftAdjustments.resizingShapes,\n        { x: offset, y: 0 }, 'e');\n    }\n\n    if (rightAffected.length) {\n      rightAdjustments = spaceTool.calculateAdjustments(\n        rightAffected, 'x', -offset, shape.x + shape.width + 10);\n\n      spaceTool.makeSpace(\n        rightAdjustments.movingShapes,\n        rightAdjustments.resizingShapes,\n        { x: -offset, y: 0 }, 'w');\n    }\n  }\n\n\n  /**\n   * Adjust sizes of other lanes after lane deletion\n   */\n  this.postExecuted('shape.delete', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        hints = context.hints,\n        shape = context.shape,\n        oldParent = context.oldParent;\n\n    // only compensate lane deletes\n    if (!is(shape, 'bpmn:Lane')) {\n      return;\n    }\n\n    // compensate root deletes only\n    if (hints && hints.nested) {\n      return;\n    }\n\n    compensateLaneDelete(shape, oldParent);\n  });\n}\n\nDeleteLaneBehavior.$inject = [\n  'eventBus',\n  'spaceTool'\n];\n\ninherits(DeleteLaneBehavior, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  is\n} from '../../../util/ModelUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\n/**\n * @typedef {import('../../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('didi').Injector} Injector\n */\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * Replace boundary event with intermediate event when creating or moving results in detached event.\n *\n * @param {BpmnReplace} bpmnReplace\n * @param {Injector} injector\n */\nexport default function DetachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n\n  var self = this;\n\n  this.postExecuted('elements.create', LOW_PRIORITY, function(context) {\n    var elements = context.elements;\n\n    elements.filter(function(shape) {\n      var host = shape.host;\n\n      return shouldReplace(shape, host);\n    }).map(function(shape) {\n      return elements.indexOf(shape);\n    }).forEach(function(index) {\n      context.elements[ index ] = self._replaceShape(elements[ index ]);\n    });\n  }, true);\n\n  this.preExecute('elements.move', LOW_PRIORITY, function(context) {\n    var shapes = context.shapes,\n        newHost = context.newHost;\n\n    shapes.forEach(function(shape, index) {\n      var host = shape.host;\n\n      if (shouldReplace(shape, includes(shapes, host) ? host : newHost)) {\n        shapes[ index ] = self._replaceShape(shape);\n      }\n    });\n  }, true);\n}\n\nDetachEventBehavior.$inject = [\n  'bpmnReplace',\n  'injector'\n];\n\ninherits(DetachEventBehavior, CommandInterceptor);\n\nDetachEventBehavior.prototype._replaceShape = function(shape) {\n  var eventDefinition = getEventDefinition(shape),\n      intermediateEvent;\n\n  if (eventDefinition) {\n    intermediateEvent = {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: eventDefinition.$type\n    };\n  } else {\n    intermediateEvent = {\n      type: 'bpmn:IntermediateThrowEvent'\n    };\n  }\n\n  return this._bpmnReplace.replaceElement(shape, intermediateEvent, { layoutConnection: false });\n};\n\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  var businessObject = getBusinessObject(element),\n      eventDefinitions = businessObject.eventDefinitions;\n\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) && is(shape, 'bpmn:BoundaryEvent') && !host;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}","import inherits from 'inherits-browser';\n\nimport {\n  assign,\n  filter,\n  find,\n  isNumber\n} from 'min-dash';\n\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getApproxIntersection\n} from 'diagram-js/lib/util/LineIntersection';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('../../modeling/Modeling').default} Modeling\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {BpmnRules} bpmnRules\n * @param {Modeling} modeling\n */\nexport default function DropOnFlowBehavior(eventBus, bpmnRules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Reconnect start / end of a connection after\n   * dropping an element on a flow.\n   */\n\n  function insertShape(shape, targetFlow, positionOrBounds) {\n    var waypoints = targetFlow.waypoints,\n        waypointsBefore,\n        waypointsAfter,\n        dockingPoint,\n        source,\n        target,\n        incomingConnection,\n        outgoingConnection,\n        oldOutgoing = shape.outgoing.slice(),\n        oldIncoming = shape.incoming.slice();\n\n    var mid;\n\n    if (isNumber(positionOrBounds.width)) {\n      mid = getMid(positionOrBounds);\n    } else {\n      mid = positionOrBounds;\n    }\n\n    var intersection = getApproxIntersection(waypoints, mid);\n\n    if (intersection) {\n      waypointsBefore = waypoints.slice(0, intersection.index);\n      waypointsAfter = waypoints.slice(intersection.index + (intersection.bendpoint ? 1 : 0));\n\n      // due to inaccuracy intersection might have been found\n      if (!waypointsBefore.length || !waypointsAfter.length) {\n        return;\n      }\n\n      dockingPoint = intersection.bendpoint ? waypoints[intersection.index] : mid;\n\n      // if last waypointBefore is inside shape's bounds, ignore docking point\n      if (waypointsBefore.length === 1 || !isPointInsideBBox(shape, waypointsBefore[waypointsBefore.length - 1])) {\n        waypointsBefore.push(copy(dockingPoint));\n      }\n\n      // if first waypointAfter is inside shape's bounds, ignore docking point\n      if (waypointsAfter.length === 1 || !isPointInsideBBox(shape, waypointsAfter[0])) {\n        waypointsAfter.unshift(copy(dockingPoint));\n      }\n    }\n\n    source = targetFlow.source;\n    target = targetFlow.target;\n\n    if (bpmnRules.canConnect(source, shape, targetFlow)) {\n\n      // reconnect source -> inserted shape\n      modeling.reconnectEnd(targetFlow, shape, waypointsBefore || mid);\n\n      incomingConnection = targetFlow;\n    }\n\n    if (bpmnRules.canConnect(shape, target, targetFlow)) {\n\n      if (!incomingConnection) {\n\n        // reconnect inserted shape -> end\n        modeling.reconnectStart(targetFlow, shape, waypointsAfter || mid);\n\n        outgoingConnection = targetFlow;\n      } else {\n        outgoingConnection = modeling.connect(\n          shape, target, { type: targetFlow.type, waypoints: waypointsAfter }\n        );\n      }\n    }\n\n    var duplicateConnections = [].concat(\n\n      incomingConnection && filter(oldIncoming, function(connection) {\n        return connection.source === incomingConnection.source;\n      }) || [],\n\n      outgoingConnection && filter(oldOutgoing, function(connection) {\n        return connection.target === outgoingConnection.target;\n      }) || []\n    );\n\n    if (duplicateConnections.length) {\n      modeling.removeElements(duplicateConnections);\n    }\n  }\n\n  this.preExecute('elements.move', function(context) {\n\n    var newParent = context.newParent,\n        shapes = context.shapes,\n        delta = context.delta,\n        shape = shapes[0];\n\n    if (!shape || !newParent) {\n      return;\n    }\n\n    // if the new parent is a connection,\n    // change it to the new parent's parent\n    if (newParent && newParent.waypoints) {\n      context.newParent = newParent = newParent.parent;\n    }\n\n    var shapeMid = getMid(shape);\n    var newShapeMid = {\n      x: shapeMid.x + delta.x,\n      y: shapeMid.y + delta.y\n    };\n\n    // find a connection which intersects with the\n    // element's mid point\n    var connection = find(newParent.children, function(element) {\n      var canInsert = bpmnRules.canInsert(shapes, element);\n\n      return canInsert && getApproxIntersection(element.waypoints, newShapeMid);\n    });\n\n    if (connection) {\n      context.targetFlow = connection;\n      context.position = newShapeMid;\n    }\n\n  }, true);\n\n  this.postExecuted('elements.move', function(context) {\n\n    var shapes = context.shapes,\n        targetFlow = context.targetFlow,\n        position = context.position;\n\n    if (targetFlow) {\n      insertShape(shapes[0], targetFlow, position);\n    }\n\n  }, true);\n\n  this.preExecute('shape.create', function(context) {\n\n    var parent = context.parent,\n        shape = context.shape;\n\n    if (bpmnRules.canInsert(shape, parent)) {\n      context.targetFlow = parent;\n      context.parent = parent.parent;\n    }\n  }, true);\n\n  this.postExecuted('shape.create', function(context) {\n\n    var shape = context.shape,\n        targetFlow = context.targetFlow,\n        positionOrBounds = context.position;\n\n    if (targetFlow) {\n      insertShape(shape, targetFlow, positionOrBounds);\n    }\n  }, true);\n}\n\ninherits(DropOnFlowBehavior, CommandInterceptor);\n\nDropOnFlowBehavior.$inject = [\n  'eventBus',\n  'bpmnRules',\n  'modeling'\n];\n\n\n// helpers /////////////////////\n\nfunction isPointInsideBBox(bbox, point) {\n  var x = point.x,\n      y = point.y;\n\n  return x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height;\n}\n\nfunction copy(obj) {\n  return assign({}, obj);\n}\n\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function EventBasedGatewayBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Remove incoming sequence flows of event-based target when creating\n   * sequence flow.\n   *\n   * 1. If source is event-based gateway remove all incoming sequence flows\n   * 2. If source is not event-based gateway remove all incoming sequence flows\n   * whose source is event-based gateway\n   */\n  this.preExecuted('connection.create', function(event) {\n    var context = event.context,\n        connection = context.connection,\n        source = context.source,\n        target = context.target,\n        hints = context.hints;\n\n    if (hints && hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (!isSequenceFlow(connection)) {\n      return;\n    }\n\n    var sequenceFlows = [];\n\n    if (is(source, 'bpmn:EventBasedGateway')) {\n      sequenceFlows = target.incoming\n        .filter(flow =>\n          flow !== connection &&\n          isSequenceFlow(flow)\n        );\n    } else {\n      sequenceFlows = target.incoming\n        .filter(flow =>\n          flow !== connection &&\n          isSequenceFlow(flow) &&\n          is(flow.source, 'bpmn:EventBasedGateway')\n        );\n    }\n\n    sequenceFlows.forEach(function(sequenceFlow) {\n      modeling.removeConnection(sequenceFlow);\n    });\n  });\n\n  /**\n   * Remove incoming sequence flows of event-based targets when replacing source\n   * with event-based gateway.\n   */\n  this.preExecuted('shape.replace', function(event) {\n    var context = event.context,\n        newShape = context.newShape;\n\n    if (!is(newShape, 'bpmn:EventBasedGateway')) {\n      return;\n    }\n\n    var targets = newShape.outgoing.filter(isSequenceFlow)\n      .reduce(function(targets, sequenceFlow) {\n        if (!targets.includes(sequenceFlow.target)) {\n          return targets.concat(sequenceFlow.target);\n        }\n\n        return targets;\n      }, []);\n\n    targets.forEach(function(target) {\n      target.incoming.filter(isSequenceFlow).forEach(function(sequenceFlow) {\n        const sequenceFlowsFromNewShape = target.incoming.filter(isSequenceFlow).filter(function(sequenceFlow) {\n          return sequenceFlow.source === newShape;\n        });\n\n        if (sequenceFlow.source !== newShape || sequenceFlowsFromNewShape.length > 1) {\n          modeling.removeConnection(sequenceFlow);\n        }\n      });\n    });\n  });\n}\n\nEventBasedGatewayBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\ninherits(EventBasedGatewayBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction isSequenceFlow(connection) {\n  return is(connection, 'bpmn:SequenceFlow');\n}","import { getLanesRoot } from '../util/LaneUtil';\r\n\r\nimport { is, isAny } from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n */\r\n\r\nvar HIGH_PRIORITY = 1500;\r\nvar HIGHEST_PRIORITY = 2000;\r\n\r\n\r\n/**\r\n * Correct hover targets in certain situations to improve diagram interaction.\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function FixHoverBehavior(elementRegistry, eventBus, canvas) {\r\n\r\n  eventBus.on([\r\n    'create.hover',\r\n    'create.move',\r\n    'create.out',\r\n    'create.end',\r\n    'shape.move.hover',\r\n    'shape.move.move',\r\n    'shape.move.out',\r\n    'shape.move.end'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape || event.shape,\r\n        hover = event.hover;\r\n\r\n    // ensure elements are not dropped onto a bpmn:Lane but onto\r\n    // the underlying bpmn:Participant\r\n    if (is(hover, 'bpmn:Lane') && !isAny(shape, [ 'bpmn:Lane', 'bpmn:Participant' ])) {\r\n      event.hover = getLanesRoot(hover);\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n\r\n    var rootElement = canvas.getRootElement();\r\n\r\n    // ensure bpmn:Group and label elements are dropped\r\n    // always onto the root\r\n    if (hover !== rootElement && (shape.labelTarget || isAny(shape, [ 'bpmn:Group', 'bpmn:TextAnnotation' ]))) {\r\n      event.hover = rootElement;\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n  });\r\n\r\n  eventBus.on([\r\n    'connect.hover',\r\n    'connect.out',\r\n    'connect.end',\r\n    'connect.cleanup',\r\n    'global-connect.hover',\r\n    'global-connect.out',\r\n    'global-connect.end',\r\n    'global-connect.cleanup'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var hover = event.hover;\r\n\r\n    // ensure connections start/end on bpmn:Participant,\r\n    // not the underlying bpmn:Lane\r\n    if (is(hover, 'bpmn:Lane')) {\r\n      event.hover = getLanesRoot(hover) || hover;\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n  });\r\n\r\n\r\n  eventBus.on([\r\n    'bendpoint.move.hover'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        hover = event.hover,\r\n        type = context.type;\r\n\r\n    // ensure reconnect start/end on bpmn:Participant,\r\n    // not the underlying bpmn:Lane\r\n    if (is(hover, 'bpmn:Lane') && /reconnect/.test(type)) {\r\n      event.hover = getLanesRoot(hover) || hover;\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n  });\r\n\r\n\r\n  eventBus.on([\r\n    'connect.start'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        start = context.start;\r\n\r\n    // ensure connect start on bpmn:Participant,\r\n    // not the underlying bpmn:Lane\r\n    if (is(start, 'bpmn:Lane')) {\r\n      context.start = getLanesRoot(start) || start;\r\n    }\r\n  });\r\n\r\n\r\n  // allow movement of participants from lanes\r\n  eventBus.on('shape.move.start', HIGHEST_PRIORITY, function(event) {\r\n    var shape = event.shape;\r\n\r\n    if (is(shape, 'bpmn:Lane')) {\r\n      event.shape = getLanesRoot(shape) || shape;\r\n    }\r\n  });\r\n\r\n  // ensure lanes aren't resized without their parent participant when using\r\n  // space tool\r\n  eventBus.on('spaceTool.move', HIGHEST_PRIORITY, function(event) {\r\n    var hover = event.hover;\r\n\r\n    if (hover && is(hover, 'bpmn:Lane')) {\r\n      event.hover = getLanesRoot(hover);\r\n    }\r\n  });\r\n\r\n}\r\n\r\nFixHoverBehavior.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'canvas'\r\n];","import {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\n/**\n * @typedef {import('../../BpmnFactory').default} BpmnFactory\n *\n * @typedef {import('../../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * Creates a new bpmn:CategoryValue inside a new bpmn:Category\n *\n * @param {BpmnFactory} bpmnFactory\n *\n * @return {ModdleElement}\n */\nexport function createCategory(bpmnFactory) {\n  return bpmnFactory.create('bpmn:Category');\n}\n\n/**\n * Creates a new bpmn:CategoryValue inside a new bpmn:Category\n *\n * @param {BpmnFactory} bpmnFactory\n *\n * @return {ModdleElement}\n */\nexport function createCategoryValue(bpmnFactory) {\n  return bpmnFactory.create('bpmn:CategoryValue');\n}\n\n/**\n * Adds category value to definitions\n *\n * @param {ModdleElement} categoryValue\n * @param {ModdleElement} category\n * @param {ModdleElement} definitions\n *\n * @return {ModdleElement}\n */\nexport function linkCategoryValue(categoryValue, category, definitions) {\n  collectionAdd(category.get('categoryValue'), categoryValue);\n  categoryValue.$parent = category;\n\n  collectionAdd(definitions.get('rootElements'), category);\n  category.$parent = definitions;\n\n  return categoryValue;\n}\n\n/**\n * Unlink category value from parent\n *\n * @param {ModdleElement} categoryValue\n *\n * @return {ModdleElement}\n */\nexport function unlinkCategoryValue(categoryValue) {\n  var category = categoryValue.$parent;\n\n  if (category) {\n    collectionRemove(category.get('categoryValue'), categoryValue);\n    categoryValue.$parent = null;\n  }\n\n  return categoryValue;\n}\n\n/**\n * Unlink category from parent\n *\n * @param {ModdleElement} category\n *\n * @return {ModdleElement}\n */\nexport function unlinkCategory(category) {\n  var definitions = category.$parent;\n\n  if (definitions) {\n    collectionRemove(definitions.get('rootElements'), category);\n    category.$parent = null;\n  }\n\n  return category;\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  is\n} from '../../../util/ModelUtil';\n\nimport {\n  createCategory,\n  createCategoryValue,\n  linkCategoryValue,\n  unlinkCategory,\n  unlinkCategoryValue\n} from './util/CategoryUtil';\n\n/**\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n * @typedef {import('../../../Modeler').default} Modeler\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('../../copy-paste/ModdleCopy').default} ModdleCopy\n *\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\n */\n\nvar LOWER_PRIORITY = 770;\n\n\n/**\n * BPMN specific group behavior.\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {Modeler} bpmnjs\n * @param {ElementRegistry} elementRegistry\n * @param {EventBus} eventBus\n * @param {Injector} injector\n * @param {ModdleCopy} moddleCopy\n */\nexport default function GroupBehavior(\n    bpmnFactory,\n    bpmnjs,\n    elementRegistry,\n    eventBus,\n    injector,\n    moddleCopy\n) {\n  injector.invoke(CommandInterceptor, this);\n\n  /**\n   * Returns all group element in the current registry.\n   *\n   * @return {Shape[]}\n   */\n  function getGroupElements() {\n    return elementRegistry.filter(function(e) {\n      return is(e, 'bpmn:Group');\n    });\n  }\n\n  /**\n   * Returns true if given category is referenced in one of the given elements.\n   *\n   * @param {Element[]} elements\n   * @param {ModdleElement} category\n   *\n   * @return {boolean}\n   */\n  function isReferencedCategory(elements, category) {\n    return elements.some(function(element) {\n      var businessObject = getBusinessObject(element);\n\n      var _category = businessObject.categoryValueRef && businessObject.categoryValueRef.$parent;\n\n      return _category === category;\n    });\n  }\n\n  /**\n   * Returns true if given categoryValue is referenced in one of the given elements.\n   *\n   * @param {Element[]} elements\n   * @param {ModdleElement} categoryValue\n   *\n   * @return {boolean}\n   */\n  function isReferencedCategoryValue(elements, categoryValue) {\n    return elements.some(function(element) {\n      var businessObject = getBusinessObject(element);\n\n      return businessObject.categoryValueRef === categoryValue;\n    });\n  }\n\n  /**\n   * Remove category value unless it is still referenced.\n   *\n   * @param {ModdleElement} categoryValue\n   * @param {ModdleElement} category\n   * @param {ModdleElement} businessObject\n   */\n  function removeCategoryValue(categoryValue, category, businessObject) {\n\n    var groups = getGroupElements().filter(function(element) {\n      return element.businessObject !== businessObject;\n    });\n\n    if (category && !isReferencedCategory(groups, category)) {\n      unlinkCategory(category);\n    }\n\n    if (categoryValue && !isReferencedCategoryValue(groups, categoryValue)) {\n      unlinkCategoryValue(categoryValue);\n    }\n  }\n\n  /**\n   * Add category value.\n   *\n   * @param {ModdleElement} categoryValue\n   * @param {ModdleElement} category\n   *\n   * @return {ModdleElement}\n   */\n  function addCategoryValue(categoryValue, category) {\n    return linkCategoryValue(categoryValue, category, bpmnjs.getDefinitions());\n  }\n\n  function setCategoryValue(element, context) {\n    var businessObject = getBusinessObject(element),\n        categoryValue = businessObject.categoryValueRef;\n\n    if (!categoryValue) {\n      categoryValue =\n      businessObject.categoryValueRef =\n      context.categoryValue = (\n        context.categoryValue || createCategoryValue(bpmnFactory)\n      );\n    }\n\n    var category = categoryValue.$parent;\n\n    if (!category) {\n      category =\n      categoryValue.$parent =\n      context.category = (\n        context.category || createCategory(bpmnFactory)\n      );\n    }\n\n    addCategoryValue(categoryValue, category, bpmnjs.getDefinitions());\n  }\n\n  function unsetCategoryValue(element, context) {\n    var category = context.category,\n        categoryValue = context.categoryValue,\n        businessObject = getBusinessObject(element);\n\n    if (categoryValue) {\n      businessObject.categoryValueRef = null;\n\n      removeCategoryValue(categoryValue, category, businessObject);\n    } else {\n      removeCategoryValue(null, businessObject.categoryValueRef.$parent, businessObject);\n    }\n  }\n\n\n  // ensure category + value exist before label editing\n\n  this.execute('label.create', function(event) {\n    var context = event.context,\n        labelTarget = context.labelTarget;\n\n    if (!is(labelTarget, 'bpmn:Group')) {\n      return;\n    }\n\n    setCategoryValue(labelTarget, context);\n  });\n\n  this.revert('label.create', function(event) {\n    var context = event.context,\n        labelTarget = context.labelTarget;\n\n    if (!is(labelTarget, 'bpmn:Group')) {\n      return;\n    }\n\n    unsetCategoryValue(labelTarget, context);\n  });\n\n\n  // remove referenced category + value when group was deleted\n\n  this.execute('shape.delete', function(event) {\n\n    var context = event.context,\n        shape = context.shape,\n        businessObject = getBusinessObject(shape);\n\n    if (!is(shape, 'bpmn:Group') || shape.labelTarget) {\n      return;\n    }\n\n    var categoryValue = context.categoryValue = businessObject.categoryValueRef,\n        category;\n\n    if (categoryValue) {\n      category = context.category = categoryValue.$parent;\n\n      removeCategoryValue(categoryValue, category, businessObject);\n\n      businessObject.categoryValueRef = null;\n    }\n  });\n\n  this.reverted('shape.delete', function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:Group') || shape.labelTarget) {\n      return;\n    }\n\n    var category = context.category,\n        categoryValue = context.categoryValue,\n        businessObject = getBusinessObject(shape);\n\n    if (categoryValue) {\n      businessObject.categoryValueRef = categoryValue;\n\n      addCategoryValue(categoryValue, category);\n    }\n  });\n\n\n  // create new category + value when group was created\n\n  this.execute('shape.create', function(event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:Group') || shape.labelTarget) {\n      return;\n    }\n\n    if (getBusinessObject(shape).categoryValueRef) {\n      setCategoryValue(shape, context);\n    }\n  });\n\n  this.reverted('shape.create', function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:Group') || shape.labelTarget) {\n      return;\n    }\n\n    if (getBusinessObject(shape).categoryValueRef) {\n      unsetCategoryValue(shape, context);\n    }\n  });\n\n\n  // copy + paste categoryValueRef with group\n\n  function copy(bo, clone) {\n    var targetBo = bpmnFactory.create(bo.$type);\n\n    return moddleCopy.copyElement(bo, targetBo, null, clone);\n  }\n\n  eventBus.on('copyPaste.copyElement', LOWER_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        element = context.element;\n\n    if (!is(element, 'bpmn:Group') || element.labelTarget) {\n      return;\n    }\n\n    var groupBo = getBusinessObject(element);\n\n    if (groupBo.categoryValueRef) {\n\n      var categoryValue = groupBo.categoryValueRef;\n\n      descriptor.categoryValue = copy(categoryValue, true);\n\n      if (categoryValue.$parent) {\n        descriptor.category = copy(categoryValue.$parent, true);\n      }\n    }\n  });\n\n  eventBus.on('copyPaste.pasteElement', LOWER_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        businessObject = descriptor.businessObject,\n        categoryValue = descriptor.categoryValue,\n        category = descriptor.category;\n\n    if (categoryValue) {\n      categoryValue = businessObject.categoryValueRef = copy(categoryValue);\n    }\n\n    if (category) {\n      categoryValue.$parent = copy(category);\n    }\n\n    delete descriptor.category;\n    delete descriptor.categoryValue;\n  });\n\n}\n\nGroupBehavior.$inject = [\n  'bpmnFactory',\n  'bpmnjs',\n  'elementRegistry',\n  'eventBus',\n  'injector',\n  'moddleCopy'\n];\n\ninherits(GroupBehavior, CommandInterceptor);","/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\n/**\n * Returns the intersection between two line segments a and b.\n *\n * @param {Point} l1s\n * @param {Point} l1e\n * @param {Point} l2s\n * @param {Point} l2e\n *\n * @return {Point}\n */\nexport default function lineIntersect(l1s, l1e, l2s, l2e) {\n\n  // if the lines intersect, the result contains the x and y of the\n  // intersection (treating the lines as infinite) and booleans for\n  // whether line segment 1 or line segment 2 contain the point\n  var denominator, a, b, c, numerator;\n\n  denominator = ((l2e.y - l2s.y) * (l1e.x - l1s.x)) - ((l2e.x - l2s.x) * (l1e.y - l1s.y));\n\n  if (denominator == 0) {\n    return null;\n  }\n\n  a = l1s.y - l2s.y;\n  b = l1s.x - l2s.x;\n  numerator = ((l2e.x - l2s.x) * a) - ((l2e.y - l2s.y) * b);\n\n  c = numerator / denominator;\n\n  // if we cast these lines infinitely in\n  // both directions, they intersect here\n  return {\n    x: Math.round(l1s.x + (c * (l1e.x - l1s.x))),\n    y: Math.round(l1s.y + (c * (l1e.y - l1s.y)))\n  };\n}","import {\n  getMid\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport lineIntersect from './util/LineIntersect';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * Fix broken dockings after DI imports.\n *\n * @param {EventBus} eventBus\n */\nexport default function ImportDockingFix(eventBus) {\n\n  function adjustDocking(startPoint, nextPoint, elementMid) {\n\n    var elementTop = {\n      x: elementMid.x,\n      y: elementMid.y - 50\n    };\n\n    var elementLeft = {\n      x: elementMid.x - 50,\n      y: elementMid.y\n    };\n\n    var verticalIntersect = lineIntersect(startPoint, nextPoint, elementMid, elementTop),\n        horizontalIntersect = lineIntersect(startPoint, nextPoint, elementMid, elementLeft);\n\n    // original is horizontal or vertical center cross intersection\n    var centerIntersect;\n\n    if (verticalIntersect && horizontalIntersect) {\n      if (getDistance(verticalIntersect, elementMid) > getDistance(horizontalIntersect, elementMid)) {\n        centerIntersect = horizontalIntersect;\n      } else {\n        centerIntersect = verticalIntersect;\n      }\n    } else {\n      centerIntersect = verticalIntersect || horizontalIntersect;\n    }\n\n    startPoint.original = centerIntersect;\n  }\n\n  function fixDockings(connection) {\n    var waypoints = connection.waypoints;\n\n    adjustDocking(\n      waypoints[0],\n      waypoints[1],\n      getMid(connection.source)\n    );\n\n    adjustDocking(\n      waypoints[waypoints.length - 1],\n      waypoints[waypoints.length - 2],\n      getMid(connection.target)\n    );\n  }\n\n  eventBus.on('bpmnElement.added', function(e) {\n\n    var element = e.element;\n\n    if (element.waypoints) {\n      fixDockings(element);\n    }\n  });\n}\n\nImportDockingFix.$inject = [\n  'eventBus'\n];\n\n\n// helpers //////////////////////\n\nfunction getDistance(p1, p2) {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  getDi\n} from '../../../util/ModelUtil';\n\nimport {\n  isAny\n} from '../util/ModelingUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * A component that makes sure that each created or updated\n * Pool and Lane is assigned an isHorizontal property set to true.\n *\n * @param {EventBus} eventBus\n */\nexport default function IsHorizontalFix(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var elementTypesToUpdate = [\n    'bpmn:Participant',\n    'bpmn:Lane'\n  ];\n\n  this.executed([ 'shape.move', 'shape.create', 'shape.resize' ], function(event) {\n    var shape = event.context.shape,\n        bo = getBusinessObject(shape),\n        di = getDi(shape);\n\n    if (isAny(bo, elementTypesToUpdate)) {\n      var isHorizontal = di.get('isHorizontal');\n\n      if (isHorizontal === undefined) {\n        isHorizontal = true;\n      }\n\n      // set attribute directly to avoid modeling#updateProperty side effects\n      di.set('isHorizontal', isHorizontal);\n    }\n  });\n\n}\n\nIsHorizontalFix.$inject = [ 'eventBus' ];\n\ninherits(IsHorizontalFix, CommandInterceptor);\n","/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n *\n * @typedef { {\n*   type: 'bendpoint' | 'segment';\n*   position: Point;\n*   segmentIndex: number;\n*   bendpointIndex?: number;\n*   relativeLocation?: number;\n* } } Attachment\n*/\n\nvar sqrt = Math.sqrt,\n    min = Math.min,\n    max = Math.max,\n    abs = Math.abs;\n\n/**\n * Calculate the square (power to two) of a number.\n *\n * @param {number} n\n *\n * @return {number}\n */\nfunction sq(n) {\n  return Math.pow(n, 2);\n}\n\n/**\n * Get distance between two points.\n *\n * @param {Point} p1\n * @param {Point} p2\n *\n * @return {number}\n */\nfunction getDistance(p1, p2) {\n  return sqrt(sq(p1.x - p2.x) + sq(p1.y - p2.y));\n}\n\n/**\n * Return the attachment of the given point on the specified line.\n *\n * The attachment is either a bendpoint (attached to the given point)\n * or segment (attached to a location on a line segment) attachment:\n *\n * ```javascript\n * var pointAttachment = {\n *   type: 'bendpoint',\n *   bendpointIndex: 3,\n *   position: { x: 10, y: 10 } // the attach point on the line\n * };\n *\n * var segmentAttachment = {\n *   type: 'segment',\n *   segmentIndex: 2,\n *   relativeLocation: 0.31, // attach point location between 0 (at start) and 1 (at end)\n *   position: { x: 10, y: 10 } // the attach point on the line\n * };\n * ```\n *\n * @param {Point} point\n * @param {Point[]} line\n *\n * @return {Attachment}\n */\nexport function getAttachment(point, line) {\n\n  var idx = 0,\n      segmentStart,\n      segmentEnd,\n      segmentStartDistance,\n      segmentEndDistance,\n      attachmentPosition,\n      minDistance,\n      intersections,\n      attachment,\n      attachmentDistance,\n      closestAttachmentDistance,\n      closestAttachment;\n\n  for (idx = 0; idx < line.length - 1; idx++) {\n\n    segmentStart = line[idx];\n    segmentEnd = line[idx + 1];\n\n    if (pointsEqual(segmentStart, segmentEnd)) {\n      intersections = [ segmentStart ];\n    } else {\n      segmentStartDistance = getDistance(point, segmentStart);\n      segmentEndDistance = getDistance(point, segmentEnd);\n\n      minDistance = min(segmentStartDistance, segmentEndDistance);\n\n      intersections = getCircleSegmentIntersections(segmentStart, segmentEnd, point, minDistance);\n    }\n\n    if (intersections.length < 1) {\n      throw new Error('expected between [1, 2] circle -> line intersections');\n    }\n\n    // one intersection -> bendpoint attachment\n    if (intersections.length === 1) {\n      attachment = {\n        type: 'bendpoint',\n        position: intersections[0],\n        segmentIndex: idx,\n        bendpointIndex: pointsEqual(segmentStart, intersections[0]) ? idx : idx + 1\n      };\n    }\n\n    // two intersections -> segment attachment\n    if (intersections.length === 2) {\n\n      attachmentPosition = mid(intersections[0], intersections[1]);\n\n      attachment = {\n        type: 'segment',\n        position: attachmentPosition,\n        segmentIndex: idx,\n        relativeLocation: getDistance(segmentStart, attachmentPosition) / getDistance(segmentStart, segmentEnd)\n      };\n    }\n\n    attachmentDistance = getDistance(attachment.position, point);\n\n    if (!closestAttachment || closestAttachmentDistance > attachmentDistance) {\n      closestAttachment = attachment;\n      closestAttachmentDistance = attachmentDistance;\n    }\n  }\n\n  return closestAttachment;\n}\n\n/**\n * Get the intersection between a circle and a line segment.\n *\n * @param {Point} s1 segment start\n * @param {Point} s2 segment end\n * @param {Point} cc circle center\n * @param {number} cr circle radius\n *\n * @return {Point[]} intersections\n */\nfunction getCircleSegmentIntersections(s1, s2, cc, cr) {\n\n  var baX = s2.x - s1.x;\n  var baY = s2.y - s1.y;\n  var caX = cc.x - s1.x;\n  var caY = cc.y - s1.y;\n\n  var a = baX * baX + baY * baY;\n  var bBy2 = baX * caX + baY * caY;\n  var c = caX * caX + caY * caY - cr * cr;\n\n  var pBy2 = bBy2 / a;\n  var q = c / a;\n\n  var disc = pBy2 * pBy2 - q;\n\n  // check against negative value to work around\n  // negative, very close to zero results (-4e-15)\n  // being produced in some environments\n  if (disc < 0 && disc > -0.000001) {\n    disc = 0;\n  }\n\n  if (disc < 0) {\n    return [];\n  }\n\n  // if disc == 0 ... dealt with later\n  var tmpSqrt = sqrt(disc);\n  var abScalingFactor1 = -pBy2 + tmpSqrt;\n  var abScalingFactor2 = -pBy2 - tmpSqrt;\n\n  var i1 = {\n    x: s1.x - baX * abScalingFactor1,\n    y: s1.y - baY * abScalingFactor1\n  };\n\n  if (disc === 0) { // abScalingFactor1 == abScalingFactor2\n    return [ i1 ];\n  }\n\n  var i2 = {\n    x: s1.x - baX * abScalingFactor2,\n    y: s1.y - baY * abScalingFactor2\n  };\n\n  // return only points on line segment\n  return [ i1, i2 ].filter(function(p) {\n    return isPointInSegment(p, s1, s2);\n  });\n}\n\n\nfunction isPointInSegment(p, segmentStart, segmentEnd) {\n  return (\n    fenced(p.x, segmentStart.x, segmentEnd.x) &&\n    fenced(p.y, segmentStart.y, segmentEnd.y)\n  );\n}\n\nfunction fenced(n, rangeStart, rangeEnd) {\n\n  // use matching threshold to work around\n  // precision errors in intersection computation\n\n  return (\n    n >= min(rangeStart, rangeEnd) - EQUAL_THRESHOLD &&\n    n <= max(rangeStart, rangeEnd) + EQUAL_THRESHOLD\n  );\n}\n\n/**\n * Calculate the mid between two points.\n *\n * @param {Point} p1\n * @param {Point} p2\n *\n * @return {Point}\n */\nfunction mid(p1, p2) {\n\n  return {\n    x: (p1.x + p2.x) / 2,\n    y: (p1.y + p2.y) / 2\n  };\n}\n\nvar EQUAL_THRESHOLD = 0.1;\n\nfunction pointsEqual(p1, p2) {\n\n  return (\n    abs(p1.x - p2.x) <= EQUAL_THRESHOLD &&\n    abs(p1.y - p2.y) <= EQUAL_THRESHOLD\n  );\n}\n","import {\n  getDistancePointPoint,\n  rotateVector,\n  getAngle\n} from './GeometricUtil';\n\nimport {\n  getAttachment\n} from './LineAttachmentUtil';\n\nimport {\n  roundPoint\n} from 'diagram-js/lib/layout/LayoutUtil';\n\n/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n *\n * @typedef {import('./LineAttachmentUtil').Attachment} Attachment\n *\n * @typedef { {\n *   point: Point;\n *   delta: Point;\n * } } AnchorPointAdjustment\n *\n * @typedef { {\n *   segmentMove?: {\n*     segmentStartIndex: number;\n*     newSegmentStartIndex: number;\n*   };\n*   bendpointMove?: {\n*     insert: boolean;\n*     bendpointIndex: number;\n*   };\n*   connectionStart: boolean;\n*   connectionEnd: boolean;\n* } } FindNewLineStartIndexHints\n */\n\n/**\n * @param {Point[]} oldWaypoints\n * @param {Point[]} newWaypoints\n * @param {Attachment} attachment\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {number}\n */\nexport function findNewLineStartIndex(oldWaypoints, newWaypoints, attachment, hints) {\n\n  var index = attachment.segmentIndex;\n\n  var offset = newWaypoints.length - oldWaypoints.length;\n\n  // segmentMove happened\n  if (hints.segmentMove) {\n\n    var oldSegmentStartIndex = hints.segmentMove.segmentStartIndex,\n        newSegmentStartIndex = hints.segmentMove.newSegmentStartIndex;\n\n    // if point was on moved segment return new segment index\n    if (index === oldSegmentStartIndex) {\n      return newSegmentStartIndex;\n    }\n\n    // point is after new segment index\n    if (index >= newSegmentStartIndex) {\n      return (index + offset < newSegmentStartIndex) ? newSegmentStartIndex : index + offset;\n    }\n\n    // if point is before new segment index\n    return index;\n  }\n\n  // bendpointMove happened\n  if (hints.bendpointMove) {\n\n    var insert = hints.bendpointMove.insert,\n        bendpointIndex = hints.bendpointMove.bendpointIndex,\n        newIndex;\n\n    // waypoints length didnt change\n    if (offset === 0) {\n      return index;\n    }\n\n    // point behind new/removed bendpoint\n    if (index >= bendpointIndex) {\n      newIndex = insert ? index + 1 : index - 1;\n    }\n\n    // point before new/removed bendpoint\n    if (index < bendpointIndex) {\n\n      newIndex = index;\n\n      // decide point should take right or left segment\n      if (insert && attachment.type !== 'bendpoint' && bendpointIndex - 1 === index) {\n\n        var rel = relativePositionMidWaypoint(newWaypoints, bendpointIndex);\n\n        if (rel < attachment.relativeLocation) {\n          newIndex++;\n        }\n      }\n    }\n\n    return newIndex;\n  }\n\n  // start/end changed\n  if (offset === 0) {\n    return index;\n  }\n\n  if (hints.connectionStart && index === 0) {\n    return 0;\n  }\n\n  if (hints.connectionEnd && index === oldWaypoints.length - 2) {\n    return newWaypoints.length - 2;\n  }\n\n  // if nothing fits, take the middle segment\n  return Math.floor((newWaypoints.length - 2) / 2);\n}\n\n\n/**\n * Calculate the required adjustment (move delta) for the given point\n * after the connection waypoints got updated.\n *\n * @param {Point} position\n * @param {Point[]} newWaypoints\n * @param {Point[]} oldWaypoints\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {AnchorPointAdjustment} result\n */\nexport function getAnchorPointAdjustment(position, newWaypoints, oldWaypoints, hints) {\n\n  var dx = 0,\n      dy = 0;\n\n  var oldPosition = {\n    point: position,\n    delta: { x: 0, y: 0 }\n  };\n\n  // get closest attachment\n  var attachment = getAttachment(position, oldWaypoints),\n      oldLabelLineIndex = attachment.segmentIndex,\n      newLabelLineIndex = findNewLineStartIndex(oldWaypoints, newWaypoints, attachment, hints);\n\n\n  // should never happen\n  // TODO(@janstuemmel): throw an error here when connectionSegmentMove is refactored\n  if (newLabelLineIndex < 0 ||\n      newLabelLineIndex > newWaypoints.length - 2 ||\n      newLabelLineIndex === null) {\n    return oldPosition;\n  }\n\n  var oldLabelLine = getLine(oldWaypoints, oldLabelLineIndex),\n      newLabelLine = getLine(newWaypoints, newLabelLineIndex),\n      oldFoot = attachment.position;\n\n  var relativeFootPosition = getRelativeFootPosition(oldLabelLine, oldFoot),\n      angleDelta = getAngleDelta(oldLabelLine, newLabelLine);\n\n  // special rule if label on bendpoint\n  if (attachment.type === 'bendpoint') {\n\n    var offset = newWaypoints.length - oldWaypoints.length,\n        oldBendpointIndex = attachment.bendpointIndex,\n        oldBendpoint = oldWaypoints[oldBendpointIndex];\n\n    // bendpoint position hasn't changed, return same position\n    if (newWaypoints.indexOf(oldBendpoint) !== -1) {\n      return oldPosition;\n    }\n\n    // new bendpoint and old bendpoint have same index, then just return the offset\n    if (offset === 0) {\n      var newBendpoint = newWaypoints[oldBendpointIndex];\n\n      dx = newBendpoint.x - attachment.position.x,\n      dy = newBendpoint.y - attachment.position.y;\n\n      return {\n        delta: {\n          x: dx,\n          y: dy\n        },\n        point: {\n          x: position.x + dx,\n          y: position.y + dy\n        }\n      };\n    }\n\n    // if bendpoints get removed\n    if (offset < 0 && oldBendpointIndex !== 0 && oldBendpointIndex < oldWaypoints.length - 1) {\n      relativeFootPosition = relativePositionMidWaypoint(oldWaypoints, oldBendpointIndex);\n    }\n  }\n\n  var newFoot = {\n    x: (newLabelLine[1].x - newLabelLine[0].x) * relativeFootPosition + newLabelLine[0].x,\n    y: (newLabelLine[1].y - newLabelLine[0].y) * relativeFootPosition + newLabelLine[0].y\n  };\n\n  // the rotated vector to label\n  var newLabelVector = rotateVector({\n    x: position.x - oldFoot.x,\n    y: position.y - oldFoot.y\n  }, angleDelta);\n\n  // the new relative position\n  dx = newFoot.x + newLabelVector.x - position.x;\n  dy = newFoot.y + newLabelVector.y - position.y;\n\n  return {\n    point: roundPoint(newFoot),\n    delta: roundPoint({\n      x: dx,\n      y: dy\n    })\n  };\n}\n\n\n// HELPERS //////////////////////\n\nfunction relativePositionMidWaypoint(waypoints, idx) {\n\n  var distanceSegment1 = getDistancePointPoint(waypoints[idx - 1], waypoints[idx]),\n      distanceSegment2 = getDistancePointPoint(waypoints[idx], waypoints[idx + 1]);\n\n  var relativePosition = distanceSegment1 / (distanceSegment1 + distanceSegment2);\n\n  return relativePosition;\n}\n\nfunction getAngleDelta(l1, l2) {\n  var a1 = getAngle(l1),\n      a2 = getAngle(l2);\n  return a2 - a1;\n}\n\nfunction getLine(waypoints, idx) {\n  return [ waypoints[idx], waypoints[idx + 1] ];\n}\n\nfunction getRelativeFootPosition(line, foot) {\n\n  var length = getDistancePointPoint(line[0], line[1]),\n      lengthToFoot = getDistancePointPoint(line[0], foot);\n\n  return length === 0 ? 0 : lengthToFoot / length;\n}\n","import { findNewLineStartIndex, getAnchorPointAdjustment } from './LayoutUtil';\n\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\n\n/**\n * @typedef {import('./LineAttachmentUtil').Attachment} Attachment\n *\n * @typedef {import('./LayoutUtil').FindNewLineStartIndexHints} FindNewLineStartIndexHints\n *\n * @typedef {import('../../../../model/Types').Label} Label\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\n/**\n * @param {Point[]} oldWaypoints\n * @param {Point[]} newWaypoints\n * @param {Attachment} attachment\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {number}\n */\nexport function findNewLabelLineStartIndex(oldWaypoints, newWaypoints, attachment, hints) {\n  return findNewLineStartIndex(oldWaypoints, newWaypoints, attachment, hints);\n}\n\n/**\n * Calculate the required adjustment (move delta) for the given label\n * after the connection waypoints got updated.\n *\n * @param {Label} label\n * @param {Point[]} newWaypoints\n * @param {Point[]} oldWaypoints\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {Point}\n */\nexport function getLabelAdjustment(label, newWaypoints, oldWaypoints, hints) {\n  var labelPosition = getMid(label);\n\n  return getAnchorPointAdjustment(labelPosition, newWaypoints, oldWaypoints, hints).delta;\n}","import {\r\n  asTRBL,\r\n  getOrientation,\r\n  roundPoint\r\n} from '../layout/LayoutUtil';\r\n\r\nimport {\r\n  center,\r\n  delta\r\n} from './PositionUtil';\r\n\r\n/**\r\n * @typedef {import('../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../util/Types').Point} Point\r\n * @typedef {import('../util/Types').Rect} Rect\r\n */\r\n\r\n/**\r\n * Calculates the absolute point relative to the new element's position.\r\n *\r\n * @param {Point} point [absolute]\r\n * @param {Rect} oldBounds\r\n * @param {Rect} newBounds\r\n *\r\n * @return {Point} point [absolute]\r\n */\r\nexport function getNewAttachPoint(point, oldBounds, newBounds) {\r\n  var oldCenter = center(oldBounds),\r\n      newCenter = center(newBounds),\r\n      oldDelta = delta(point, oldCenter);\r\n\r\n  var newDelta = {\r\n    x: oldDelta.x * (newBounds.width / oldBounds.width),\r\n    y: oldDelta.y * (newBounds.height / oldBounds.height)\r\n  };\r\n\r\n  return roundPoint({\r\n    x: newCenter.x + newDelta.x,\r\n    y: newCenter.y + newDelta.y\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * Calculates the shape's delta relative to a new position\r\n * of a certain element's bounds.\r\n *\r\n * @param {Shape} shape\r\n * @param {Rect} oldBounds\r\n * @param {Rect} newBounds\r\n *\r\n * @return {Point} delta\r\n */\r\nexport function getNewAttachShapeDelta(shape, oldBounds, newBounds) {\r\n  var shapeCenter = center(shape),\r\n      oldCenter = center(oldBounds),\r\n      newCenter = center(newBounds),\r\n      shapeDelta = delta(shape, shapeCenter),\r\n      oldCenterDelta = delta(shapeCenter, oldCenter),\r\n      stickyPositionDelta = getStickyPositionDelta(shapeCenter, oldBounds, newBounds);\r\n\r\n  if (stickyPositionDelta) {\r\n    return stickyPositionDelta;\r\n  }\r\n\r\n  var newCenterDelta = {\r\n    x: oldCenterDelta.x * (newBounds.width / oldBounds.width),\r\n    y: oldCenterDelta.y * (newBounds.height / oldBounds.height)\r\n  };\r\n\r\n  var newShapeCenter = {\r\n    x: newCenter.x + newCenterDelta.x,\r\n    y: newCenter.y + newCenterDelta.y\r\n  };\r\n\r\n  return roundPoint({\r\n    x: newShapeCenter.x + shapeDelta.x - shape.x,\r\n    y: newShapeCenter.y + shapeDelta.y - shape.y\r\n  });\r\n}\r\n\r\nfunction getStickyPositionDelta(oldShapeCenter, oldBounds, newBounds) {\r\n  var oldTRBL = asTRBL(oldBounds),\r\n      newTRBL = asTRBL(newBounds);\r\n\r\n  if (isMoved(oldTRBL, newTRBL)) {\r\n    return null;\r\n  }\r\n\r\n  var oldOrientation = getOrientation(oldBounds, oldShapeCenter),\r\n      stickyPositionDelta,\r\n      newShapeCenter,\r\n      newOrientation;\r\n\r\n  if (oldOrientation === 'top') {\r\n    stickyPositionDelta = {\r\n      x: 0,\r\n      y: newTRBL.bottom - oldTRBL.bottom\r\n    };\r\n  } else if (oldOrientation === 'bottom') {\r\n    stickyPositionDelta = {\r\n      x: 0,\r\n      y: newTRBL.top - oldTRBL.top\r\n    };\r\n  } else if (oldOrientation === 'right') {\r\n    stickyPositionDelta = {\r\n      x: newTRBL.left - oldTRBL.left,\r\n      y: 0\r\n    };\r\n  } else if (oldOrientation === 'left') {\r\n    stickyPositionDelta = {\r\n      x: newTRBL.right - oldTRBL.right,\r\n      y: 0\r\n    };\r\n  } else {\r\n\r\n    // fallback to proportional movement for corner-placed attachments\r\n    return null;\r\n  }\r\n\r\n  newShapeCenter = {\r\n    x: oldShapeCenter.x + stickyPositionDelta.x,\r\n    y: oldShapeCenter.y + stickyPositionDelta.y\r\n  };\r\n\r\n  newOrientation = getOrientation(newBounds, newShapeCenter);\r\n\r\n  if (newOrientation !== oldOrientation) {\r\n\r\n    // fallback to proportional movement if orientation would otherwise change\r\n    return null;\r\n  }\r\n\r\n  return stickyPositionDelta;\r\n}\r\n\r\nfunction isMoved(oldTRBL, newTRBL) {\r\n  return isHorizontallyMoved(oldTRBL, newTRBL) || isVerticallyMoved(oldTRBL, newTRBL);\r\n}\r\n\r\nfunction isHorizontallyMoved(oldTRBL, newTRBL) {\r\n  return oldTRBL.right !== newTRBL.right && oldTRBL.left !== newTRBL.left;\r\n}\r\n\r\nfunction isVerticallyMoved(oldTRBL, newTRBL) {\r\n  return oldTRBL.top !== newTRBL.top && oldTRBL.bottom !== newTRBL.bottom;\r\n}\r\n","import {\n  assign\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\nimport {\n  isLabelExternal,\n  getLabel,\n  hasExternalLabel,\n  isLabel\n} from '../../../util/LabelUtil';\n\nimport {\n  getLabelAdjustment\n} from './util/LabelLayoutUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getNewAttachPoint\n} from 'diagram-js/lib/util/AttachUtil';\n\nimport {\n  getMid,\n  roundPoint\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  delta\n} from 'diagram-js/lib/util/PositionUtil';\n\nimport {\n  sortBy\n} from 'min-dash';\n\nimport {\n  getDistancePointLine,\n  perpendicularFoot\n} from './util/GeometricUtil';\n\nvar NAME_PROPERTY = 'name';\nvar TEXT_PROPERTY = 'text';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n * @typedef {import('../../../draw/TextRenderer').default} TextRenderer\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n *\n * @typedef {Point[]} Line\n */\n\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {BpmnFactory} bpmnFactory\n * @param {TextRenderer} textRenderer\n */\nexport default function LabelBehavior(\n    eventBus, modeling, bpmnFactory,\n    textRenderer) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // update label if name property was updated\n  this.postExecute('element.updateProperties', onPropertyUpdate);\n  this.postExecute('element.updateModdleProperties', e => {\n    const elementBo = getBusinessObject(e.context.element);\n\n    if (elementBo === e.context.moddleElement) {\n      onPropertyUpdate(e);\n    }\n  });\n\n  function onPropertyUpdate(e) {\n    var context = e.context,\n        element = context.element,\n        properties = context.properties;\n\n    if (NAME_PROPERTY in properties) {\n      modeling.updateLabel(element, properties[NAME_PROPERTY]);\n    }\n\n    if (TEXT_PROPERTY in properties\n        && is(element, 'bpmn:TextAnnotation')) {\n\n      var newBounds = textRenderer.getTextAnnotationBounds(\n        {\n          x: element.x,\n          y: element.y,\n          width: element.width,\n          height: element.height\n        },\n        properties[TEXT_PROPERTY] || ''\n      );\n\n      modeling.updateLabel(element, properties.text, newBounds);\n    }\n  }\n\n  // create label shape after shape/connection was created\n  this.postExecute([ 'shape.create', 'connection.create' ], function(e) {\n    var context = e.context,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior === false) {\n      return;\n    }\n\n    var element = context.shape || context.connection;\n\n    if (isLabel(element) || !isLabelExternal(element)) {\n      return;\n    }\n\n    // only create label if attribute available\n    if (!getLabel(element)) {\n      return;\n    }\n\n    modeling.updateLabel(element, getLabel(element));\n  });\n\n  // update label after label shape was deleted\n  this.postExecute('shape.delete', function(event) {\n    var context = event.context,\n        labelTarget = context.labelTarget,\n        hints = context.hints || {};\n\n    // check if label\n    if (labelTarget && hints.unsetLabel !== false) {\n      modeling.updateLabel(labelTarget, null, null, { removeShape: false });\n    }\n  });\n\n  function getVisibleLabelAdjustment(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        label = connection.label,\n        hints = assign({}, context.hints),\n        newWaypoints = context.newWaypoints || connection.waypoints,\n        oldWaypoints = context.oldWaypoints;\n\n\n    if (typeof hints.startChanged === 'undefined') {\n      hints.startChanged = !!hints.connectionStart;\n    }\n\n    if (typeof hints.endChanged === 'undefined') {\n      hints.endChanged = !!hints.connectionEnd;\n    }\n\n    return getLabelAdjustment(label, newWaypoints, oldWaypoints, hints);\n  }\n\n  this.postExecute([\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context,\n        hints = context.hints || {};\n\n    if (hints.labelBehavior === false) {\n      return;\n    }\n\n    var connection = context.connection,\n        label = connection.label,\n        labelAdjustment;\n\n    // handle missing label as well as the case\n    // that the label parent does not exist (yet),\n    // because it is being pasted / created via multi element create\n    //\n    // Cf. https://github.com/bpmn-io/bpmn-js/pull/1227\n    if (!label || !label.parent) {\n      return;\n    }\n\n    labelAdjustment = getVisibleLabelAdjustment(event);\n\n    modeling.moveShape(label, labelAdjustment);\n  });\n\n\n  // keep label position on shape replace\n  this.postExecute([ 'shape.replace' ], function(event) {\n    var context = event.context,\n        newShape = context.newShape,\n        oldShape = context.oldShape;\n\n    var businessObject = getBusinessObject(newShape);\n\n    if (businessObject\n      && isLabelExternal(businessObject)\n      && oldShape.label\n      && newShape.label) {\n      newShape.label.x = oldShape.label.x;\n      newShape.label.y = oldShape.label.y;\n    }\n  });\n\n\n  // move external label after resizing\n  this.postExecute('shape.resize', function(event) {\n\n    var context = event.context,\n        shape = context.shape,\n        newBounds = context.newBounds,\n        oldBounds = context.oldBounds;\n\n    if (hasExternalLabel(shape)) {\n\n      var label = shape.label,\n          labelMid = getMid(label),\n          edges = asEdges(oldBounds);\n\n      // get nearest border point to label as reference point\n      var referencePoint = getReferencePoint(labelMid, edges);\n\n      var delta = getReferencePointDelta(referencePoint, oldBounds, newBounds);\n\n      modeling.moveShape(label, delta);\n\n    }\n\n  });\n\n}\n\ninherits(LabelBehavior, CommandInterceptor);\n\nLabelBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'bpmnFactory',\n  'textRenderer'\n];\n\n// helpers //////////////////////\n\n/**\n * Calculates a reference point delta relative to a new position\n * of a certain element's bounds\n *\n * @param {Point} referencePoint\n * @param {Rect} oldBounds\n * @param {Rect} newBounds\n *\n * @return {Point}\n */\nexport function getReferencePointDelta(referencePoint, oldBounds, newBounds) {\n\n  var newReferencePoint = getNewAttachPoint(referencePoint, oldBounds, newBounds);\n\n  return roundPoint(delta(newReferencePoint, referencePoint));\n}\n\n/**\n * Generates the nearest point (reference point) for a given point\n * onto given set of lines\n *\n * @param {Point} point\n * @param {Line[]} lines\n *\n * @return {Point}\n */\nexport function getReferencePoint(point, lines) {\n\n  if (!lines.length) {\n    return;\n  }\n\n  var nearestLine = getNearestLine(point, lines);\n\n  return perpendicularFoot(point, nearestLine);\n}\n\n/**\n * Convert the given bounds to a lines array containing all edges\n *\n * @param {Rect|Point} bounds\n *\n * @return {Line[]}\n */\nexport function asEdges(bounds) {\n  return [\n    [ // top\n      {\n        x: bounds.x,\n        y: bounds.y\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y\n      }\n    ],\n    [ // right\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0)\n      }\n    ],\n    [ // bottom\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0)\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0)\n      }\n    ],\n    [ // left\n      {\n        x: bounds.x,\n        y: bounds.y\n      },\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0)\n      }\n    ]\n  ];\n}\n\n/**\n * Returns the nearest line for a given point by distance\n * @param {Point} point\n * @param {Line[]} lines\n *\n * @return {Line}\n */\nfunction getNearestLine(point, lines) {\n\n  var distances = lines.map(function(l) {\n    return {\n      line: l,\n      distance: getDistancePointLine(point, l)\n    };\n  });\n\n  var sorted = sortBy(distances, 'distance');\n\n  return sorted[0].line;\n}\n","import { getAnchorPointAdjustment } from './LayoutUtil';\n\n/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n *\n * @typedef {import('./LayoutUtil').FindNewLineStartIndexHints} FindNewLineStartIndexHints\n */\n\n/**\n * Calculate the new point after the connection waypoints got updated.\n *\n * @param {Point} position\n * @param {Point[]} newWaypoints\n * @param {Point[]} oldWaypoints\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {Point}\n */\nexport function getConnectionAdjustment(position, newWaypoints, oldWaypoints, hints) {\n  return getAnchorPointAdjustment(position, newWaypoints, oldWaypoints, hints).point;\n}\n\n","import {\n  assign\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getConnectionAdjustment as getConnectionAnchorPoint } from './util/ConnectionLayoutUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * A component that makes sure that Associations connected to Connections\n * are updated together with the Connection.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function LayoutConnectionBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  function getnewAnchorPoint(event, point) {\n\n    var context = event.context,\n        connection = context.connection,\n        hints = assign({}, context.hints),\n        newWaypoints = context.newWaypoints || connection.waypoints,\n        oldWaypoints = context.oldWaypoints;\n\n\n    if (typeof hints.startChanged === 'undefined') {\n      hints.startChanged = !!hints.connectionStart;\n    }\n\n    if (typeof hints.endChanged === 'undefined') {\n      hints.endChanged = !!hints.connectionEnd;\n    }\n\n    return getConnectionAnchorPoint(point, newWaypoints, oldWaypoints, hints);\n  }\n\n  this.postExecute([\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context;\n\n    var connection = context.connection,\n        outgoing = connection.outgoing,\n        incoming = connection.incoming;\n\n    incoming.forEach(function(connection) {\n      var endPoint = connection.waypoints[connection.waypoints.length - 1];\n      var newEndpoint = getnewAnchorPoint(event, endPoint);\n\n      var newWaypoints = [].concat(connection.waypoints.slice(0, -1), [ newEndpoint ]);\n\n      modeling.updateWaypoints(connection, newWaypoints);\n    });\n\n    outgoing.forEach(function(connection) {\n      var startpoint = connection.waypoints[0];\n      var newStartpoint = getnewAnchorPoint(event, startpoint);\n\n      var newWaypoints = [].concat([ newStartpoint ], connection.waypoints.slice(1));\n\n      modeling.updateWaypoints(connection, newWaypoints);\n    });\n\n  });\n\n\n  this.postExecute([\n    'connection.move'\n  ], function(event) {\n    var context = event.context;\n\n    var connection = context.connection,\n        outgoing = connection.outgoing,\n        incoming = connection.incoming,\n        delta = context.delta;\n\n    incoming.forEach(function(connection) {\n      var endPoint = connection.waypoints[connection.waypoints.length - 1];\n      var newEndpoint = {\n        x: endPoint.x + delta.x,\n        y: endPoint.y + delta.y\n      };\n\n      var newWaypoints = [].concat(connection.waypoints.slice(0, -1), [ newEndpoint ]);\n\n      modeling.updateWaypoints(connection, newWaypoints);\n    });\n\n    outgoing.forEach(function(connection) {\n      var startpoint = connection.waypoints[0];\n      var newStartpoint = {\n        x: startpoint.x + delta.x,\n        y: startpoint.y + delta.y\n      };\n\n      var newWaypoints = [].concat([ newStartpoint ], connection.waypoints.slice(1));\n\n      modeling.updateWaypoints(connection, newWaypoints);\n    });\n\n  });\n\n}\n\ninherits(LayoutConnectionBehavior, CommandInterceptor);\n\nLayoutConnectionBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n","import {\r\n  getNewAttachPoint\r\n} from '../../../../util/AttachUtil';\r\n\r\nimport {\r\n  getOrientation\r\n} from '../../../../layout/LayoutUtil';\r\n\r\nimport {\r\n  filter,\r\n  map\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../../../core/Types').ConnectionLike} Connection\r\n * @typedef {import('../../../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../../../util/Types').Point} Point\r\n * @typedef {import('../../../../util/Types').Rect} Rect\r\n */\r\n\r\n/**\r\n * @param {Connection} connection\r\n * @param {Shape} shape\r\n * @param {Rect} oldBounds\r\n * @return {Point}\r\n */\r\nexport function getResizedSourceAnchor(connection, shape, oldBounds) {\r\n\r\n  var waypoints = safeGetWaypoints(connection),\r\n      waypointsInsideNewBounds = getWaypointsInsideBounds(waypoints, shape),\r\n      oldAnchor = waypoints[0];\r\n\r\n  // new anchor is the last waypoint enclosed be resized source\r\n  if (waypointsInsideNewBounds.length) {\r\n    return waypointsInsideNewBounds[ waypointsInsideNewBounds.length - 1 ];\r\n  }\r\n\r\n  return getNewAttachPoint(oldAnchor.original || oldAnchor, oldBounds, shape);\r\n}\r\n\r\n\r\nexport function getResizedTargetAnchor(connection, shape, oldBounds) {\r\n\r\n  var waypoints = safeGetWaypoints(connection),\r\n      waypointsInsideNewBounds = getWaypointsInsideBounds(waypoints, shape),\r\n      oldAnchor = waypoints[waypoints.length - 1];\r\n\r\n  // new anchor is the first waypoint enclosed be resized target\r\n  if (waypointsInsideNewBounds.length) {\r\n    return waypointsInsideNewBounds[ 0 ];\r\n  }\r\n\r\n  return getNewAttachPoint(oldAnchor.original || oldAnchor, oldBounds, shape);\r\n}\r\n\r\n\r\nexport function getMovedSourceAnchor(connection, source, moveDelta) {\r\n\r\n  var waypoints = safeGetWaypoints(connection),\r\n      oldBounds = subtract(source, moveDelta),\r\n      oldAnchor = waypoints[ 0 ];\r\n\r\n  return getNewAttachPoint(oldAnchor.original || oldAnchor, oldBounds, source);\r\n}\r\n\r\n\r\nexport function getMovedTargetAnchor(connection, target, moveDelta) {\r\n\r\n  var waypoints = safeGetWaypoints(connection),\r\n      oldBounds = subtract(target, moveDelta),\r\n      oldAnchor = waypoints[ waypoints.length - 1 ];\r\n\r\n  return getNewAttachPoint(oldAnchor.original || oldAnchor, oldBounds, target);\r\n}\r\n\r\n\r\n// helpers //////////////////////\r\n\r\nfunction subtract(bounds, delta) {\r\n  return {\r\n    x: bounds.x - delta.x,\r\n    y: bounds.y - delta.y,\r\n    width: bounds.width,\r\n    height: bounds.height\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Return waypoints of given connection; throw if non exists (should not happen!!).\r\n *\r\n * @param {Connection} connection\r\n *\r\n * @return {Point[]}\r\n */\r\nfunction safeGetWaypoints(connection) {\r\n\r\n  var waypoints = connection.waypoints;\r\n\r\n  if (!waypoints.length) {\r\n    throw new Error('connection#' + connection.id + ': no waypoints');\r\n  }\r\n\r\n  return waypoints;\r\n}\r\n\r\nfunction getWaypointsInsideBounds(waypoints, bounds) {\r\n  var originalWaypoints = map(waypoints, getOriginal);\r\n\r\n  return filter(originalWaypoints, function(waypoint) {\r\n    return isInsideBounds(waypoint, bounds);\r\n  });\r\n}\r\n\r\n/**\r\n * Checks if point is inside bounds, incl. edges.\r\n *\r\n * @param {Point} point\r\n * @param {Rect} bounds\r\n */\r\nfunction isInsideBounds(point, bounds) {\r\n  return getOrientation(bounds, point, 1) === 'intersect';\r\n}\r\n\r\nfunction getOriginal(point) {\r\n  return point.original || point;\r\n}\r\n","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport { is } from '../../../util/ModelUtil';\r\n\r\nimport { isExpanded } from '../../../util/DiUtil';\r\n\r\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\r\n\r\nimport {\r\n  getResizedSourceAnchor,\r\n  getResizedTargetAnchor\r\n} from 'diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * BPMN-specific message flow behavior.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n */\r\nexport default function MessageFlowBehavior(eventBus, modeling) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  this.postExecute('shape.replace', function(context) {\r\n    var oldShape = context.oldShape,\r\n        newShape = context.newShape;\r\n\r\n    if (!isParticipantCollapse(oldShape, newShape)) {\r\n      return;\r\n    }\r\n\r\n    var messageFlows = getMessageFlows(oldShape);\r\n\r\n    messageFlows.incoming.forEach(function(incoming) {\r\n      var anchor = getResizedTargetAnchor(incoming, newShape, oldShape);\r\n\r\n      modeling.reconnectEnd(incoming, newShape, anchor);\r\n    });\r\n\r\n    messageFlows.outgoing.forEach(function(outgoing) {\r\n      var anchor = getResizedSourceAnchor(outgoing, newShape, oldShape);\r\n\r\n      modeling.reconnectStart(outgoing, newShape, anchor);\r\n    });\r\n  }, true);\r\n\r\n}\r\n\r\nMessageFlowBehavior.$inject = [ 'eventBus', 'modeling' ];\r\n\r\ninherits(MessageFlowBehavior, CommandInterceptor);\r\n\r\n// helpers //////////\r\n\r\nfunction isParticipantCollapse(oldShape, newShape) {\r\n  return is(oldShape, 'bpmn:Participant')\r\n    && isExpanded(oldShape)\r\n    && is(newShape, 'bpmn:Participant')\r\n    && !isExpanded(newShape);\r\n}\r\n\r\nfunction getMessageFlows(parent) {\r\n  var elements = selfAndAllChildren([ parent ], false);\r\n\r\n  var incoming = [],\r\n      outgoing = [];\r\n\r\n  elements.forEach(function(element) {\r\n    if (element === parent) {\r\n      return;\r\n    }\r\n\r\n    element.incoming.forEach(function(connection) {\r\n      if (is(connection, 'bpmn:MessageFlow')) {\r\n        incoming.push(connection);\r\n      }\r\n    });\r\n\r\n    element.outgoing.forEach(function(connection) {\r\n      if (is(connection, 'bpmn:MessageFlow')) {\r\n        outgoing.push(connection);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  return {\r\n    incoming: incoming,\r\n    outgoing: outgoing\r\n  };\r\n}","import { isEventSubProcess } from '../../../../util/DiUtil';\nimport { getBusinessObject, is } from '../../../../util/ModelUtil';\n\nexport const NON_INTERRUPTING_EVENT_TYPES = [\n  'bpmn:MessageEventDefinition',\n  'bpmn:TimerEventDefinition',\n  'bpmn:EscalationEventDefinition',\n  'bpmn:ConditionalEventDefinition',\n  'bpmn:SignalEventDefinition'\n];\n\nexport function canBeNonInterrupting(shape) {\n\n  const businessObject = getBusinessObject(shape);\n\n  if (\n    !is(businessObject, 'bpmn:BoundaryEvent') &&\n    !(is(businessObject, 'bpmn:StartEvent') && isEventSubProcess(businessObject.$parent))\n  ) {\n    return false;\n  }\n\n  const eventDefinitions = businessObject.get('eventDefinitions');\n  if (!eventDefinitions || !eventDefinitions.length) {\n    return false;\n  }\n\n  return NON_INTERRUPTING_EVENT_TYPES.some(event => is(eventDefinitions[0], event));\n}\n\nexport function getInterruptingProperty(shape) {\n  return is(shape, 'bpmn:BoundaryEvent') ? 'cancelActivity' : 'isInterrupting';\n}","import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport inherits from 'inherits-browser';\n\nimport { canBeNonInterrupting, getInterruptingProperty } from './util/NonInterruptingUtil';\nimport { getBusinessObject } from '../../../util/ModelUtil';\n\nexport default function NonInterruptingBehavior(injector, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.postExecuted('shape.replace', function(event) {\n    const oldShape = event.context.oldShape;\n    const newShape = event.context.newShape;\n    const hints = event.context.hints;\n\n    if (!canBeNonInterrupting(newShape)) {\n      return;\n    }\n\n    const property = getInterruptingProperty(newShape);\n    const isExplicitChange = hints.targetElement && hints.targetElement[property] !== undefined;\n\n    if (isExplicitChange) {\n      return;\n    }\n\n    const isOldInterrupting = getBusinessObject(oldShape).get(property);\n    const isNewInterruptingDefault = getBusinessObject(newShape).get(property);\n\n    if (isOldInterrupting === isNewInterruptingDefault) {\n      return;\n    }\n\n    modeling.updateProperties(newShape, {\n      [property]: isOldInterrupting\n    });\n  });\n}\n\nNonInterruptingBehavior.$inject = [ 'injector', 'modeling' ];\n\ninherits(NonInterruptingBehavior, CommandInterceptor);\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getDi } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * BPMN specific behavior ensuring that bpmndi:Label's dc:Bounds are removed\n * when shape is resized.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function RemoveEmbeddedLabelBoundsBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  this.preExecute('shape.resize', function(context) {\n    var shape = context.shape;\n\n    var di = getDi(shape),\n        label = di && di.get('label'),\n        bounds = label && label.get('bounds');\n\n    if (bounds) {\n      modeling.updateModdleProperties(shape, label, {\n        bounds: undefined\n      });\n    }\n  }, true);\n}\n\ninherits(RemoveEmbeddedLabelBoundsBehavior, CommandInterceptor);\n\nRemoveEmbeddedLabelBoundsBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];","import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport lineIntersect from './util/LineIntersect';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {BpmnRules} bpmnRules\n * @param {Modeling} modeling\n */\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n  this.preExecute('shape.delete', function(e) {\n\n    var shape = e.context.shape;\n\n    // only handle [a] -> [shape] -> [b] patterns\n    if (shape.incoming.length !== 1 || shape.outgoing.length !== 1) {\n      return;\n    }\n\n    var inConnection = shape.incoming[0],\n        outConnection = shape.outgoing[0];\n\n    // only handle sequence flows\n    if (!is(inConnection, 'bpmn:SequenceFlow') || !is(outConnection, 'bpmn:SequenceFlow')) {\n      return;\n    }\n\n    if (bpmnRules.canConnect(inConnection.source, outConnection.target, inConnection)) {\n\n      // compute new, combined waypoints\n      var newWaypoints = getNewWaypoints(inConnection.waypoints, outConnection.waypoints);\n\n      modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n    }\n  });\n\n}\n\ninherits(RemoveElementBehavior, CommandInterceptor);\n\nRemoveElementBehavior.$inject = [\n  'eventBus',\n  'bpmnRules',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\n\n\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n\n  var intersection = lineIntersect(\n    getDocking(inWaypoints[inWaypoints.length - 2]),\n    getDocking(inWaypoints[inWaypoints.length - 1]),\n    getDocking(outWaypoints[1]),\n    getDocking(outWaypoints[0]));\n\n  if (intersection) {\n    return [].concat(\n      inWaypoints.slice(0, inWaypoints.length - 1),\n      [ intersection ],\n      outWaypoints.slice(1));\n  } else {\n    return [\n      getDocking(inWaypoints[0]),\n      getDocking(outWaypoints[outWaypoints.length - 1])\n    ];\n  }\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * BPMN specific remove behavior.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function RemoveParticipantBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  /**\n   * morph collaboration diagram into process diagram\n   * after the last participant has been removed\n   */\n\n  this.preExecute('shape.delete', function(context) {\n\n    var shape = context.shape,\n        parent = shape.parent;\n\n    // activate the behavior if the shape to be removed\n    // is a participant\n    if (is(shape, 'bpmn:Participant')) {\n      context.collaborationRoot = parent;\n    }\n  }, true);\n\n  this.postExecute('shape.delete', function(context) {\n\n    var collaborationRoot = context.collaborationRoot;\n\n    if (collaborationRoot && !collaborationRoot.businessObject.participants.length) {\n\n      // replace empty collaboration with process diagram\n      modeling.makeProcess();\n    }\n  }, true);\n\n}\n\nRemoveParticipantBehavior.$inject = [ 'eventBus', 'modeling' ];\n\ninherits(RemoveParticipantBehavior, CommandInterceptor);","import {\n  forEach,\n  find,\n  matchPattern\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('didi').Injector} Injector\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {BpmnRules} bpmnRules\n * @param {Injector} injector\n */\nexport default function ReplaceConnectionBehavior(eventBus, modeling, bpmnRules, injector) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var dragging = injector.get('dragging', false);\n\n  function fixConnection(connection) {\n\n    var source = connection.source,\n        target = connection.target,\n        parent = connection.parent;\n\n    // do not do anything if connection\n    // is already deleted (may happen due to other\n    // behaviors plugged-in before)\n    if (!parent) {\n      return;\n    }\n\n    var replacementType,\n        remove;\n\n    /**\n     * Check if incoming or outgoing connections\n     * can stay or could be substituted with an\n     * appropriate replacement.\n     *\n     * This holds true for SequenceFlow <> MessageFlow.\n     */\n\n    if (is(connection, 'bpmn:SequenceFlow')) {\n      if (!bpmnRules.canConnectSequenceFlow(source, target)) {\n        remove = true;\n      }\n\n      if (bpmnRules.canConnectMessageFlow(source, target)) {\n        replacementType = 'bpmn:MessageFlow';\n      }\n    }\n\n    // transform message flows into sequence flows, if possible\n\n    if (is(connection, 'bpmn:MessageFlow')) {\n\n      if (!bpmnRules.canConnectMessageFlow(source, target)) {\n        remove = true;\n      }\n\n      if (bpmnRules.canConnectSequenceFlow(source, target)) {\n        replacementType = 'bpmn:SequenceFlow';\n      }\n    }\n\n    // remove invalid connection,\n    // unless it has been removed already\n    if (remove) {\n      modeling.removeConnection(connection);\n    }\n\n    // replace SequenceFlow <> MessageFlow\n\n    if (replacementType) {\n      modeling.connect(source, target, {\n        type: replacementType,\n        waypoints: connection.waypoints.slice()\n      });\n    }\n  }\n\n  function replaceReconnectedConnection(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        source = context.newSource || connection.source,\n        target = context.newTarget || connection.target,\n        allowed,\n        replacement;\n\n    allowed = bpmnRules.canConnect(source, target);\n\n    if (!allowed || allowed.type === connection.type) {\n      return;\n    }\n\n    replacement = modeling.connect(source, target, {\n      type: allowed.type,\n      associationDirection: allowed.associationDirection,\n      waypoints: connection.waypoints.slice()\n    });\n\n    // remove old connection unless it's already removed\n    if (connection.parent) {\n      modeling.removeConnection(connection);\n    }\n\n    // replace connection in context to reconnect end/start\n    context.connection = replacement;\n\n    if (dragging) {\n      cleanDraggingSelection(connection, replacement);\n    }\n  }\n\n  // monkey-patch selection saved in dragging in order to re-select it when operation is finished\n  function cleanDraggingSelection(oldConnection, newConnection) {\n    var context = dragging.context(),\n        previousSelection = context && context.payload.previousSelection,\n        index;\n\n    // do nothing if not dragging or no selection was present\n    if (!previousSelection || !previousSelection.length) {\n      return;\n    }\n\n    index = previousSelection.indexOf(oldConnection);\n\n    if (index === -1) {\n      return;\n    }\n\n    previousSelection.splice(index, 1, newConnection);\n  }\n\n  // lifecycle hooks\n\n  this.postExecuted('elements.move', function(context) {\n\n    var closure = context.closure,\n        allConnections = closure.allConnections;\n\n    forEach(allConnections, fixConnection);\n  }, true);\n\n  this.preExecute('connection.reconnect', replaceReconnectedConnection);\n\n  this.postExecuted('element.updateProperties', function(event) {\n    var context = event.context,\n        properties = context.properties,\n        element = context.element,\n        businessObject = element.businessObject,\n        connection;\n\n    // remove condition on change to default\n    if (properties.default) {\n      connection = find(\n        element.outgoing,\n        matchPattern({ id: element.businessObject.default.id })\n      );\n\n      if (connection) {\n        modeling.updateProperties(connection, { conditionExpression: undefined });\n      }\n    }\n\n    // remove default from source on change to conditional\n    if (properties.conditionExpression && businessObject.sourceRef.default === businessObject) {\n      modeling.updateProperties(element.source, { default: undefined });\n    }\n  });\n}\n\ninherits(ReplaceConnectionBehavior, CommandInterceptor);\n\nReplaceConnectionBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'bpmnRules',\n  'injector'\n];\n","import inherits from 'inherits-browser';\n\nimport { forEach, reduce } from 'min-dash';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { isEventSubProcess } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('../../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('diagram-js/lib/features/selection/Selection').default} Selection\n */\n\n/**\n * BPMN-specific replace behavior.\n *\n * @param {BpmnReplace} bpmnReplace\n * @param {BpmnRules} bpmnRules\n * @param {ElementRegistry} elementRegistry\n * @param {Injector} injector\n * @param {Modeling} modeling\n * @param {Selection} selection\n */\nexport default function ReplaceElementBehaviour(\n    bpmnReplace,\n    bpmnRules,\n    elementRegistry,\n    injector,\n    modeling,\n    selection\n) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n  this._elementRegistry = elementRegistry;\n  this._selection = selection;\n\n  // replace elements on create, e.g. during copy-paste\n  this.postExecuted([ 'elements.create' ], 500, function(event) {\n    var context = event.context,\n        target = context.parent,\n        elements = context.elements;\n\n    var elementReplacements = reduce(elements, function(replacements, element) {\n      var canReplace = bpmnRules.canReplace([ element ], element.host || element.parent || target);\n\n      return canReplace ? replacements.concat(canReplace.replacements) : replacements;\n    }, []);\n\n    if (elementReplacements.length) {\n      this._replaceElements(elements, elementReplacements);\n    }\n  }, this);\n\n  // replace elements on move\n  this.postExecuted([ 'elements.move' ], 500, function(event) {\n    var context = event.context,\n        target = context.newParent,\n        newHost = context.newHost,\n        elements = [];\n\n    forEach(context.closure.topLevel, function(topLevelElements) {\n      if (isEventSubProcess(topLevelElements)) {\n        elements = elements.concat(topLevelElements.children);\n      } else {\n        elements = elements.concat(topLevelElements);\n      }\n    });\n\n    // set target to host if attaching\n    if (elements.length === 1 && newHost) {\n      target = newHost;\n    }\n\n    var canReplace = bpmnRules.canReplace(elements, target);\n\n    if (canReplace) {\n      this._replaceElements(elements, canReplace.replacements, newHost);\n    }\n  }, this);\n\n  // update attachments on host replace\n  this.postExecute([ 'shape.replace' ], 1500, function(e) {\n    var context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape,\n        attachers = oldShape.attachers,\n        canReplace;\n\n    if (attachers && attachers.length) {\n      canReplace = bpmnRules.canReplace(attachers, newShape);\n\n      this._replaceElements(attachers, canReplace.replacements);\n    }\n\n  }, this);\n\n  // keep ID on shape replace\n  this.postExecuted([ 'shape.replace' ], 1500, function(e) {\n    var context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape;\n\n    modeling.unclaimId(oldShape.businessObject.id, oldShape.businessObject);\n    modeling.updateProperties(newShape, { id: oldShape.id });\n  });\n}\n\ninherits(ReplaceElementBehaviour, CommandInterceptor);\n\nReplaceElementBehaviour.prototype._replaceElements = function(elements, newElements) {\n  var elementRegistry = this._elementRegistry,\n      bpmnReplace = this._bpmnReplace,\n      selection = this._selection;\n\n  forEach(newElements, function(replacement) {\n    var newElement = {\n      type: replacement.newElementType\n    };\n\n    var oldElement = elementRegistry.get(replacement.oldElementId);\n\n    var idx = elements.indexOf(oldElement);\n\n    elements[idx] = bpmnReplace.replaceElement(oldElement, newElement, { select: false });\n  });\n\n  if (newElements) {\n    selection.select(elements);\n  }\n};\n\nReplaceElementBehaviour.$inject = [\n  'bpmnReplace',\n  'bpmnRules',\n  'elementRegistry',\n  'injector',\n  'modeling',\n  'selection'\n];\n","import { is } from '../../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isHorizontal\n} from '../../../util/DiUtil';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  collectLanes,\n  getLanesRoot\n} from '../util/LaneUtil';\n\nvar HIGH_PRIORITY = 1500;\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Dimensions} Dimensions\n * @typedef {import('diagram-js/lib/util/Types').Direction} Direction\n * @typedef {import('diagram-js/lib/util/Types').RectTRBL} RectTRBL\n */\n\n/**\n * @type {Dimensions}\n */\nexport var GROUP_MIN_DIMENSIONS = { width: 140, height: 120 };\n\n/**\n * @type {Dimensions}\n */\nexport var LANE_MIN_DIMENSIONS = { width: 300, height: 60 };\n\n/**\n * @type {Dimensions}\n */\nexport var VERTICAL_LANE_MIN_DIMENSIONS = { width: 60, height: 300 };\n\n/**\n * @type {Dimensions}\n */\nexport var PARTICIPANT_MIN_DIMENSIONS = { width: 300, height: 150 };\n\n/**\n * @type {Dimensions}\n */\nexport var VERTICAL_PARTICIPANT_MIN_DIMENSIONS = { width: 150, height: 300 };\n\n/**\n * @type {Dimensions}\n */\nexport var SUB_PROCESS_MIN_DIMENSIONS = { width: 140, height: 120 };\n\n/**\n * @type {Dimensions}\n */\nexport var TEXT_ANNOTATION_MIN_DIMENSIONS = { width: 50, height: 30 };\n\n/**\n * Set minimum bounds/resize constraints on resize.\n *\n * @param {EventBus} eventBus\n */\nexport default function ResizeBehavior(eventBus) {\n  eventBus.on('resize.start', HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        direction = context.direction,\n        balanced = context.balanced;\n\n    if (is(shape, 'bpmn:Lane') || is(shape, 'bpmn:Participant')) {\n      context.resizeConstraints = getParticipantResizeConstraints(shape, direction, balanced);\n    }\n\n    if (is(shape, 'bpmn:SubProcess') && isExpanded(shape)) {\n      context.minDimensions = SUB_PROCESS_MIN_DIMENSIONS;\n    }\n\n    if (is(shape, 'bpmn:TextAnnotation')) {\n      context.minDimensions = TEXT_ANNOTATION_MIN_DIMENSIONS;\n    }\n  });\n}\n\nResizeBehavior.$inject = [ 'eventBus' ];\n\n\nvar abs = Math.abs,\n    min = Math.min,\n    max = Math.max;\n\n\nfunction addToTrbl(trbl, attr, value, choice) {\n  var current = trbl[attr];\n\n  // make sure to set the value if it does not exist\n  // or apply the correct value by comparing against\n  // choice(value, currentValue)\n  trbl[attr] = current === undefined ? value : choice(value, current);\n}\n\nfunction addMin(trbl, attr, value) {\n  return addToTrbl(trbl, attr, value, min);\n}\n\nfunction addMax(trbl, attr, value) {\n  return addToTrbl(trbl, attr, value, max);\n}\n\nvar LANE_PADDING = { top: 20, left: 50, right: 20, bottom: 20 },\n    VERTICAL_LANE_PADDING = { top: 50, left: 20, right: 20, bottom: 20 };\n\n/**\n * @param {Shape} laneShape\n * @param {Direction} resizeDirection\n * @param {boolean} [balanced=false]\n *\n * @return { {\n *   min: RectTRBL;\n *   max: RectTRBL;\n * } }\n */\nexport function getParticipantResizeConstraints(laneShape, resizeDirection, balanced) {\n  var lanesRoot = getLanesRoot(laneShape);\n\n  var isFirst = true,\n      isLast = true;\n\n  var allLanes = collectLanes(lanesRoot, [ lanesRoot ]);\n\n  var laneTrbl = asTRBL(laneShape);\n\n  var maxTrbl = {},\n      minTrbl = {};\n\n  var isHorizontalLane = isHorizontal(laneShape);\n\n  var minDimensions = isHorizontalLane ? LANE_MIN_DIMENSIONS : VERTICAL_LANE_MIN_DIMENSIONS;\n\n  if (/n/.test(resizeDirection)) {\n    minTrbl.top = laneTrbl.bottom - minDimensions.height;\n  } else\n  if (/e/.test(resizeDirection)) {\n    minTrbl.right = laneTrbl.left + minDimensions.width;\n  } else\n  if (/s/.test(resizeDirection)) {\n    minTrbl.bottom = laneTrbl.top + minDimensions.height;\n  } else\n  if (/w/.test(resizeDirection)) {\n    minTrbl.left = laneTrbl.right - minDimensions.width;\n  }\n\n  // min/max size based on related lanes\n  allLanes.forEach(function(other) {\n\n    var otherTrbl = asTRBL(other);\n\n    if (/n/.test(resizeDirection)) {\n      if (isHorizontalLane && otherTrbl.top < (laneTrbl.top - 10)) {\n        isFirst = false;\n      }\n\n      // max top size (based on next element)\n      if (balanced && abs(laneTrbl.top - otherTrbl.bottom) < 10) {\n        addMax(maxTrbl, 'top', otherTrbl.top + minDimensions.height);\n      }\n\n      // min top size (based on self or nested element)\n      if (abs(laneTrbl.top - otherTrbl.top) < 5) {\n        addMin(minTrbl, 'top', otherTrbl.bottom - minDimensions.height);\n      }\n    }\n\n    if (/e/.test(resizeDirection)) {\n\n      if (!isHorizontalLane && otherTrbl.right > (laneTrbl.right + 10)) {\n        isLast = false;\n      }\n\n      // max right size (based on previous element)\n      if (balanced && abs(laneTrbl.right - otherTrbl.left) < 10) {\n        addMin(maxTrbl, 'right', otherTrbl.right - minDimensions.width);\n      }\n\n      // min right size (based on self or nested element)\n      if (abs(laneTrbl.right - otherTrbl.right) < 5) {\n        addMax(minTrbl, 'right', otherTrbl.left + minDimensions.width);\n      }\n    }\n\n    if (/s/.test(resizeDirection)) {\n\n      if (isHorizontalLane && otherTrbl.bottom > (laneTrbl.bottom + 10)) {\n        isLast = false;\n      }\n\n      // max bottom size (based on previous element)\n      if (balanced && abs(laneTrbl.bottom - otherTrbl.top) < 10) {\n        addMin(maxTrbl, 'bottom', otherTrbl.bottom - minDimensions.height);\n      }\n\n      // min bottom size (based on self or nested element)\n      if (abs(laneTrbl.bottom - otherTrbl.bottom) < 5) {\n        addMax(minTrbl, 'bottom', otherTrbl.top + minDimensions.height);\n      }\n    }\n\n    if (/w/.test(resizeDirection)) {\n\n      if (!isHorizontalLane && otherTrbl.left < (laneTrbl.left - 10)) {\n        isFirst = false;\n      }\n\n      // max left size (based on next element)\n      if (balanced && abs(laneTrbl.left - otherTrbl.right) < 10) {\n        addMax(maxTrbl, 'left', otherTrbl.left + minDimensions.width);\n      }\n\n      // min left size (based on self or nested element)\n      if (abs(laneTrbl.left - otherTrbl.left) < 5) {\n        addMin(minTrbl, 'left', otherTrbl.right - minDimensions.width);\n      }\n    }\n  });\n\n  // max top/bottom/left/right size based on flow nodes\n  var flowElements = lanesRoot.children.filter(function(s) {\n    return !s.hidden && !s.waypoints && (is(s, 'bpmn:FlowElement') || is(s, 'bpmn:Artifact'));\n  });\n\n  var padding = isHorizontalLane ? LANE_PADDING : VERTICAL_LANE_PADDING;\n\n  flowElements.forEach(function(flowElement) {\n\n    var flowElementTrbl = asTRBL(flowElement);\n\n    if (isFirst && /n/.test(resizeDirection)) {\n      addMin(minTrbl, 'top', flowElementTrbl.top - padding.top);\n    }\n\n    if (isLast && /e/.test(resizeDirection)) {\n      addMax(minTrbl, 'right', flowElementTrbl.right + padding.right);\n    }\n\n    if (isLast && /s/.test(resizeDirection)) {\n      addMax(minTrbl, 'bottom', flowElementTrbl.bottom + padding.bottom);\n    }\n\n    if (isFirst && /w/.test(resizeDirection)) {\n      addMin(minTrbl, 'left', flowElementTrbl.left - padding.left);\n    }\n  });\n\n  return {\n    min: minTrbl,\n    max: maxTrbl\n  };\n}","import { is } from '../../../util/ModelUtil';\n\nimport {\n  roundBounds\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  hasPrimaryModifier\n} from 'diagram-js/lib/util/Mouse';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\nvar SLIGHTLY_HIGHER_PRIORITY = 1001;\n\n\n/**\n * Invoke {@link Modeling#resizeLane} instead of {@link Modeling#resizeShape}\n * when resizing a lane or participant shape.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function ResizeLaneBehavior(eventBus, modeling) {\n\n  eventBus.on('resize.start', SLIGHTLY_HIGHER_PRIORITY + 500, function(event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (is(shape, 'bpmn:Lane') || is(shape, 'bpmn:Participant')) {\n\n      // should we resize the opposite lane(s) in\n      // order to compensate for the resize operation?\n      context.balanced = !hasPrimaryModifier(event);\n    }\n  });\n\n  /**\n   * Intercept resize end and call resize lane function instead.\n   */\n  eventBus.on('resize.end', SLIGHTLY_HIGHER_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        canExecute = context.canExecute,\n        newBounds = context.newBounds;\n\n    if (is(shape, 'bpmn:Lane') || is(shape, 'bpmn:Participant')) {\n\n      if (canExecute) {\n\n        // ensure we have actual pixel values for new bounds\n        // (important when zoom level was > 1 during move)\n        newBounds = roundBounds(newBounds);\n\n        // perform the actual resize\n        modeling.resizeLane(shape, newBounds, context.balanced);\n      }\n\n      // stop propagation\n      return false;\n    }\n  });\n}\n\nResizeLaneBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n","import inherits from 'inherits-browser';\r\n\r\nimport {\r\n  find,\r\n  isArray,\r\n  matchPattern,\r\n  some\r\n} from 'min-dash';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport {\r\n  add as collectionAdd,\r\n  remove as collectionRemove\r\n} from 'diagram-js/lib/util/Collections';\r\n\r\nimport {\r\n  getBusinessObject,\r\n  is\r\n} from '../../../util/ModelUtil';\r\n\r\nimport { isAny } from '../util/ModelingUtil';\r\n\r\nimport { hasEventDefinition } from '../../../util/DiUtil';\r\n\r\n/**\r\n * @typedef {import('../../../Modeler').default} Modeler\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('didi').Injector} Injector\r\n * @typedef {import('../../copy-paste/ModdleCopy').default} ModdleCopy\r\n * @typedef {import('../BpmnFactory').default} BpmnFactory\r\n *\r\n * @typedef {import('../../../model/Types').Element} Element\r\n * @typedef {import('../../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\r\n */\r\n\r\nvar LOW_PRIORITY = 500;\r\n\r\n\r\n/**\r\n * Add referenced root elements (error, escalation, message, signal) if they don't exist.\r\n * Copy referenced root elements on copy & paste.\r\n *\r\n * @param {Modeler} bpmnjs\r\n * @param {EventBus} eventBus\r\n * @param {Injector} injector\r\n * @param {ModdleCopy} moddleCopy\r\n * @param {BpmnFactory} bpmnFactory\r\n */\r\nexport default function RootElementReferenceBehavior(\r\n    bpmnjs, eventBus, injector, moddleCopy, bpmnFactory\r\n) {\r\n  injector.invoke(CommandInterceptor, this);\r\n\r\n  function canHaveRootElementReference(element) {\r\n    return isAny(element, [ 'bpmn:ReceiveTask', 'bpmn:SendTask' ]) ||\r\n      hasAnyEventDefinition(element, [\r\n        'bpmn:ErrorEventDefinition',\r\n        'bpmn:EscalationEventDefinition',\r\n        'bpmn:MessageEventDefinition',\r\n        'bpmn:SignalEventDefinition'\r\n      ]);\r\n  }\r\n\r\n  function hasRootElement(rootElement) {\r\n    var definitions = bpmnjs.getDefinitions(),\r\n        rootElements = definitions.get('rootElements');\r\n\r\n    return !!find(rootElements, matchPattern({ id: rootElement.id }));\r\n  }\r\n\r\n  function getRootElementReferencePropertyName(eventDefinition) {\r\n    if (is(eventDefinition, 'bpmn:ErrorEventDefinition')) {\r\n      return 'errorRef';\r\n    } else if (is(eventDefinition, 'bpmn:EscalationEventDefinition')) {\r\n      return 'escalationRef';\r\n    } else if (is(eventDefinition, 'bpmn:MessageEventDefinition')) {\r\n      return 'messageRef';\r\n    } else if (is(eventDefinition, 'bpmn:SignalEventDefinition')) {\r\n      return 'signalRef';\r\n    }\r\n  }\r\n\r\n  function getRootElement(businessObject) {\r\n    if (isAny(businessObject, [ 'bpmn:ReceiveTask', 'bpmn:SendTask' ])) {\r\n      return businessObject.get('messageRef');\r\n    }\r\n\r\n    var eventDefinitions = businessObject.get('eventDefinitions'),\r\n        eventDefinition = eventDefinitions[ 0 ];\r\n\r\n    return eventDefinition.get(getRootElementReferencePropertyName(eventDefinition));\r\n  }\r\n\r\n  function setRootElement(businessObject, rootElement) {\r\n    if (isAny(businessObject, [ 'bpmn:ReceiveTask', 'bpmn:SendTask' ])) {\r\n      return businessObject.set('messageRef', rootElement);\r\n    }\r\n\r\n    var eventDefinitions = businessObject.get('eventDefinitions'),\r\n        eventDefinition = eventDefinitions[ 0 ];\r\n\r\n    return eventDefinition.set(getRootElementReferencePropertyName(eventDefinition), rootElement);\r\n  }\r\n\r\n  // create shape\r\n  this.executed([\r\n    'shape.create',\r\n    'element.updateProperties',\r\n    'element.updateModdleProperties'\r\n  ], function(context) {\r\n    var shape = context.shape || context.element;\r\n\r\n    if (!canHaveRootElementReference(shape)) {\r\n      return;\r\n    }\r\n\r\n    var businessObject = getBusinessObject(shape),\r\n        rootElement = getRootElement(businessObject),\r\n        rootElements;\r\n\r\n    if (rootElement && !hasRootElement(rootElement)) {\r\n      rootElements = bpmnjs.getDefinitions().get('rootElements');\r\n\r\n      // add root element\r\n      collectionAdd(rootElements, rootElement);\r\n\r\n      context.addedRootElement = rootElement;\r\n    }\r\n  }, true);\r\n\r\n  this.reverted([\r\n    'shape.create',\r\n    'element.updateProperties',\r\n    'element.updateModdleProperties'\r\n  ], function(context) {\r\n    var addedRootElement = context.addedRootElement;\r\n\r\n    if (!addedRootElement) {\r\n      return;\r\n    }\r\n\r\n    var rootElements = bpmnjs.getDefinitions().get('rootElements');\r\n\r\n    // remove root element\r\n    collectionRemove(rootElements, addedRootElement);\r\n  }, true);\r\n\r\n  eventBus.on('copyPaste.copyElement', function(context) {\r\n    var descriptor = context.descriptor,\r\n        element = context.element;\r\n\r\n    if (element.labelTarget || !canHaveRootElementReference(element)) {\r\n      return;\r\n    }\r\n\r\n    var businessObject = getBusinessObject(element),\r\n        rootElement = getRootElement(businessObject);\r\n\r\n    if (rootElement) {\r\n\r\n      // TODO(nikku): clone on copy\r\n      descriptor.referencedRootElement = rootElement;\r\n    }\r\n  });\r\n\r\n  eventBus.on('copyPaste.pasteElement', LOW_PRIORITY, function(context) {\r\n    var descriptor = context.descriptor,\r\n        businessObject = descriptor.businessObject,\r\n        referencedRootElement = descriptor.referencedRootElement;\r\n\r\n    if (!referencedRootElement) {\r\n      return;\r\n    }\r\n\r\n    if (!hasRootElement(referencedRootElement)) {\r\n      referencedRootElement = moddleCopy.copyElement(\r\n        referencedRootElement,\r\n        bpmnFactory.create(referencedRootElement.$type)\r\n      );\r\n    }\r\n\r\n    setRootElement(businessObject, referencedRootElement);\r\n\r\n    delete descriptor.referencedRootElement;\r\n  });\r\n}\r\n\r\nRootElementReferenceBehavior.$inject = [\r\n  'bpmnjs',\r\n  'eventBus',\r\n  'injector',\r\n  'moddleCopy',\r\n  'bpmnFactory'\r\n];\r\n\r\ninherits(RootElementReferenceBehavior, CommandInterceptor);\r\n\r\n// helpers //////////\r\n\r\nfunction hasAnyEventDefinition(element, types) {\r\n  if (!isArray(types)) {\r\n    types = [ types ];\r\n  }\r\n\r\n  return some(types, function(type) {\r\n    return hasEventDefinition(element, type);\r\n  });\r\n}","import { forEach } from 'min-dash';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isHorizontal\n} from '../../../util/DiUtil';\n\nimport {\n  GROUP_MIN_DIMENSIONS,\n  LANE_MIN_DIMENSIONS,\n  VERTICAL_LANE_MIN_DIMENSIONS,\n  PARTICIPANT_MIN_DIMENSIONS,\n  VERTICAL_PARTICIPANT_MIN_DIMENSIONS,\n  SUB_PROCESS_MIN_DIMENSIONS,\n  TEXT_ANNOTATION_MIN_DIMENSIONS\n} from './ResizeBehavior';\n\nimport { getChildLanes } from '../util/LaneUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n */\n\nvar max = Math.max;\n\n/**\n * @param {EventBus} eventBus\n */\nexport default function SpaceToolBehavior(eventBus) {\n  eventBus.on('spaceTool.getMinDimensions', function(context) {\n    var shapes = context.shapes,\n        axis = context.axis,\n        start = context.start,\n        minDimensions = {};\n\n    forEach(shapes, function(shape) {\n      var id = shape.id;\n\n      if (is(shape, 'bpmn:Participant')) {\n        minDimensions[ id ] = getParticipantMinDimensions(shape, axis, start);\n      }\n\n      if (is(shape, 'bpmn:Lane')) {\n        minDimensions[ id ] = isHorizontal(shape) ? LANE_MIN_DIMENSIONS : VERTICAL_LANE_MIN_DIMENSIONS;\n      }\n\n      if (is(shape, 'bpmn:SubProcess') && isExpanded(shape)) {\n        minDimensions[ id ] = SUB_PROCESS_MIN_DIMENSIONS;\n      }\n\n      if (is(shape, 'bpmn:TextAnnotation')) {\n        minDimensions[ id ] = TEXT_ANNOTATION_MIN_DIMENSIONS;\n      }\n\n      if (is(shape, 'bpmn:Group')) {\n        minDimensions[ id ] = GROUP_MIN_DIMENSIONS;\n      }\n    });\n\n    return minDimensions;\n  });\n}\n\nSpaceToolBehavior.$inject = [ 'eventBus' ];\n\n\n// helpers //////////\nfunction isHorizontalAxis(axis) {\n  return axis === 'x';\n}\n\n/**\n * Get minimum dimensions for participant taking lanes into account.\n *\n * @param {Shape} participant\n * @param {Axis} axis\n * @param {number} start\n *\n * @return {number}\n */\nfunction getParticipantMinDimensions(participant, axis, start) {\n  var isHorizontalLane = isHorizontal(participant);\n\n  if (!hasChildLanes(participant)) {\n    return isHorizontalLane ? PARTICIPANT_MIN_DIMENSIONS : VERTICAL_PARTICIPANT_MIN_DIMENSIONS;\n  }\n\n  var isHorizontalResize = isHorizontalAxis(axis);\n  var minDimensions = {};\n\n  if (isHorizontalResize) {\n    if (isHorizontalLane) {\n      minDimensions = PARTICIPANT_MIN_DIMENSIONS;\n    } else {\n      minDimensions = {\n        width: getParticipantMinWidth(participant, start, isHorizontalResize),\n        height: VERTICAL_PARTICIPANT_MIN_DIMENSIONS.height\n      };\n    }\n\n  } else {\n    if (isHorizontalLane) {\n      minDimensions = {\n        width: PARTICIPANT_MIN_DIMENSIONS.width,\n        height: getParticipantMinHeight(participant, start, isHorizontalResize)\n      };\n    } else {\n      minDimensions = VERTICAL_PARTICIPANT_MIN_DIMENSIONS;\n    }\n  }\n\n  return minDimensions;\n}\n\n/**\n * Get minimum height for participant taking lanes into account.\n *\n * @param {Shape} participant\n * @param {number} start\n * @param {boolean} isHorizontalResize\n *\n * @return {number}\n */\nfunction getParticipantMinHeight(participant, start, isHorizontalResize) {\n  var lanesMinHeight;\n  lanesMinHeight = getLanesMinHeight(participant, start, isHorizontalResize);\n  return max(PARTICIPANT_MIN_DIMENSIONS.height, lanesMinHeight);\n}\n\n/**\n * Get minimum width for participant taking lanes into account.\n *\n * @param {Shape} participant\n * @param {number} start\n * @param {boolean} isHorizontalResize\n *\n * @return {number}\n */\nfunction getParticipantMinWidth(participant, start, isHorizontalResize) {\n  var lanesMinWidth;\n  lanesMinWidth = getLanesMinWidth(participant, start, isHorizontalResize);\n  return max(VERTICAL_PARTICIPANT_MIN_DIMENSIONS.width, lanesMinWidth);\n}\n\nfunction hasChildLanes(element) {\n  return !!getChildLanes(element).length;\n}\n\nfunction getLanesMinHeight(participant, resizeStart, isHorizontalResize) {\n  var lanes = getChildLanes(participant),\n      resizedLane;\n\n  // find the nested lane which is currently resized\n  resizedLane = findResizedLane(lanes, resizeStart, isHorizontalResize);\n\n  // resized lane cannot shrink below the minimum height\n  // but remaining lanes' dimensions are kept intact\n  return participant.height - resizedLane.height + LANE_MIN_DIMENSIONS.height;\n}\n\nfunction getLanesMinWidth(participant, resizeStart, isHorizontalResize) {\n  var lanes = getChildLanes(participant),\n      resizedLane;\n\n  // find the nested lane which is currently resized\n  resizedLane = findResizedLane(lanes, resizeStart, isHorizontalResize);\n\n  // resized lane cannot shrink below the minimum width\n  // but remaining lanes' dimensions are kept intact\n  return participant.width - resizedLane.width + VERTICAL_LANE_MIN_DIMENSIONS.width;\n}\n\n/**\n * Find nested lane which is currently resized.\n *\n * @param {Shape[]} lanes\n * @param {number} resizeStart\n * @param {boolean} isHorizontalResize\n *\n * @return {Shape}\n */\nfunction findResizedLane(lanes, resizeStart, isHorizontalResize) {\n  var i, lane, childLanes;\n\n  for (i = 0; i < lanes.length; i++) {\n    lane = lanes[i];\n\n    // resizing current lane or a lane nested\n    if (!isHorizontalResize && resizeStart >= lane.y && resizeStart <= lane.y + lane.height ||\n        isHorizontalResize && resizeStart >= lane.x && resizeStart <= lane.x + lane.width) {\n\n      childLanes = getChildLanes(lane);\n\n      // a nested lane is resized\n      if (childLanes.length) {\n        return findResizedLane(childLanes, resizeStart, isHorizontalResize);\n      }\n\n      // current lane is the resized one\n      return lane;\n    }\n  }\n}\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { find } from 'min-dash';\n\nimport { isExpanded } from '../../../util/DiUtil';\n\nimport { getBusinessObject, getDi, is } from '../../../util/ModelUtil';\n\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\n\nimport { getBBox } from 'diagram-js/lib/util/Elements';\n\nimport {\n  getPlaneIdFromShape,\n  getShapeIdFromPlane,\n  isPlane,\n  toPlaneId\n} from '../../../util/DrilldownUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../ElementFactory').default} ElementFactory\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n * @typedef {import('../../../Modeler').default} Modeler\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n *\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('../../../model/Types').Root} Root\n * @typedef {import('../../../model/Types').ModdleElement} ModdleElement\n */\n\nvar LOW_PRIORITY = 400;\nvar HIGH_PRIORITY = 600;\n\nvar DEFAULT_POSITION = {\n  x: 180,\n  y: 160\n};\n\n\n/**\n * Creates bpmndi:BPMNPlane elements and canvas planes when collapsed subprocesses are created.\n *\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {ElementFactory} elementFactory\n * @param {BpmnFactory} bpmnFactory\n * @param {Modeler} bpmnjs\n * @param {ElementRegistry} elementRegistry\n */\nexport default function SubProcessPlaneBehavior(\n    canvas, eventBus, modeling,\n    elementFactory, bpmnFactory, bpmnjs, elementRegistry) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._elementFactory = elementFactory;\n  this._bpmnFactory = bpmnFactory;\n  this._bpmnjs = bpmnjs;\n  this._elementRegistry = elementRegistry;\n\n  var self = this;\n\n  function isCollapsedSubProcess(element) {\n    return is(element, 'bpmn:SubProcess') && !isExpanded(element);\n  }\n\n  function createRoot(context) {\n    var shape = context.shape,\n        rootElement = context.newRootElement;\n\n    var businessObject = getBusinessObject(shape);\n\n    rootElement = self._addDiagram(rootElement || businessObject);\n\n    context.newRootElement = canvas.addRootElement(rootElement);\n  }\n\n  function removeRoot(context) {\n    var shape = context.shape;\n\n    var businessObject = getBusinessObject(shape);\n    self._removeDiagram(businessObject);\n\n    var rootElement = context.newRootElement = elementRegistry.get(getPlaneIdFromShape(businessObject));\n\n    canvas.removeRootElement(rootElement);\n  }\n\n  // add plane elements for newly created sub-processes\n  // this ensures we can actually drill down into the element\n  this.executed('shape.create', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n\n    createRoot(context);\n  }, true);\n\n\n  this.postExecuted('shape.create', function(context) {\n    var shape = context.shape,\n        rootElement = context.newRootElement;\n\n    if (!rootElement || !shape.children) {\n      return;\n    }\n\n    self._showRecursively(shape.children);\n\n    self._moveChildrenToShape(shape, rootElement);\n  }, true);\n\n\n  this.reverted('shape.create', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n\n    removeRoot(context);\n  }, true);\n\n\n  this.preExecuted('shape.delete', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n\n    var attachedRoot = elementRegistry.get(getPlaneIdFromShape(shape));\n\n    if (!attachedRoot) {\n      return;\n    }\n\n    modeling.removeElements(attachedRoot.children.slice());\n  }, true);\n\n\n  this.executed('shape.delete', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n    removeRoot(context);\n  }, true);\n\n\n  this.reverted('shape.delete', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n\n    createRoot(context);\n  }, true);\n\n\n  this.preExecuted('shape.replace', function(context) {\n    var oldShape = context.oldShape;\n    var newShape = context.newShape;\n\n    if (!isCollapsedSubProcess(oldShape) || !isCollapsedSubProcess(newShape)) {\n      return;\n    }\n\n    // old plane could have content,\n    // we remove it so it is not recursively deleted from 'shape.delete'\n    context.oldRoot = canvas.removeRootElement(getPlaneIdFromShape(oldShape));\n  }, true);\n\n\n  this.postExecuted('shape.replace', function(context) {\n    var newShape = context.newShape,\n        source = context.oldRoot,\n        target = canvas.findRoot(getPlaneIdFromShape(newShape));\n\n    if (!source || !target) {\n      return;\n    }\n    var elements = source.children;\n\n    modeling.moveElements(elements, { x: 0, y: 0 }, target);\n  }, true);\n\n\n  // rename primary elements when the secondary element changes\n  // this ensures rootElement.id = element.id + '_plane'\n  this.executed('element.updateProperties', function(context) {\n    var shape = context.element;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    var properties = context.properties;\n    var oldProperties = context.oldProperties;\n\n    var oldId = oldProperties.id,\n        newId = properties.id;\n\n    if (oldId === newId) {\n      return;\n    }\n\n    if (isPlane(shape)) {\n      elementRegistry.updateId(shape, toPlaneId(newId));\n      elementRegistry.updateId(oldId, newId);\n\n      return;\n    }\n\n    var planeElement = elementRegistry.get(toPlaneId(oldId));\n\n    if (!planeElement) {\n      return;\n    }\n\n    elementRegistry.updateId(toPlaneId(oldId), toPlaneId(newId));\n  }, true);\n\n\n  this.reverted('element.updateProperties', function(context) {\n    var shape = context.element;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    var properties = context.properties;\n    var oldProperties = context.oldProperties;\n\n    var oldId = oldProperties.id,\n        newId = properties.id;\n\n    if (oldId === newId) {\n      return;\n    }\n\n    if (isPlane(shape)) {\n      elementRegistry.updateId(shape, toPlaneId(oldId));\n      elementRegistry.updateId(newId, oldId);\n\n      return;\n    }\n\n    var planeElement = elementRegistry.get(toPlaneId(newId));\n\n    if (!planeElement) {\n      return;\n    }\n\n    elementRegistry.updateId(planeElement, toPlaneId(oldId));\n  }, true);\n\n  // re-throw element.changed to re-render primary shape if associated plane has\n  // changed (e.g. bpmn:name property has changed)\n  eventBus.on('element.changed', function(context) {\n    var element = context.element;\n\n    if (!isPlane(element)) {\n      return;\n    }\n\n    var plane = element;\n\n    var primaryShape = elementRegistry.get(getShapeIdFromPlane(plane));\n\n    // do not re-throw if no associated primary shape (e.g. bpmn:Process)\n    if (!primaryShape || primaryShape === plane) {\n      return;\n    }\n\n    eventBus.fire('element.changed', { element: primaryShape });\n  });\n\n\n  // create/remove plane for the subprocess\n  this.executed('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    if (!isExpanded(shape)) {\n      createRoot(context);\n      self._showRecursively(shape.children);\n    } else {\n      removeRoot(context);\n    }\n\n  }, true);\n\n\n  // create/remove plane for the subprocess\n  this.reverted('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    if (!isExpanded(shape)) {\n      createRoot(context);\n      self._showRecursively(shape.children);\n    } else {\n      removeRoot(context);\n    }\n\n  }, true);\n\n  // move elements between planes\n  this.postExecuted('shape.toggleCollapse', HIGH_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    var rootElement = context.newRootElement;\n\n    if (!rootElement) {\n      return;\n    }\n\n    if (!isExpanded(shape)) {\n\n      // collapsed\n      self._moveChildrenToShape(shape, rootElement);\n\n    } else {\n      self._moveChildrenToShape(rootElement, shape);\n    }\n  }, true);\n\n\n  // copy-paste ///////////\n\n  // add elements in plane to tree\n  eventBus.on('copyPaste.createTree', function(context) {\n    var element = context.element,\n        children = context.children;\n\n    if (!isCollapsedSubProcess(element)) {\n      return;\n    }\n\n    var id = getPlaneIdFromShape(element);\n    var parent = elementRegistry.get(id);\n\n    if (parent) {\n\n      // do not copy invisible root element\n      children.push.apply(children, parent.children);\n    }\n  });\n\n  // set plane children as direct children of collapsed shape\n  eventBus.on('copyPaste.copyElement', function(context) {\n    var descriptor = context.descriptor,\n        element = context.element,\n        elements = context.elements;\n\n    var parent = element.parent;\n\n    var isPlane = is(getDi(parent), 'bpmndi:BPMNPlane');\n    if (!isPlane) {\n      return;\n    }\n\n    var parentId = getShapeIdFromPlane(parent);\n\n    var referencedShape = find(elements, function(element) {\n      return element.id === parentId;\n    });\n\n    if (!referencedShape) {\n      return;\n    }\n\n    descriptor.parent = referencedShape.id;\n  });\n\n  // hide children during pasting\n  eventBus.on('copyPaste.pasteElement', function(context) {\n    var descriptor = context.descriptor;\n\n    if (!descriptor.parent) {\n      return;\n    }\n\n    if (isCollapsedSubProcess(descriptor.parent) || descriptor.parent.hidden) {\n      descriptor.hidden = true;\n    }\n  });\n\n}\n\ninherits(SubProcessPlaneBehavior, CommandInterceptor);\n\n/**\n * Moves the child elements from source to target.\n *\n * If the target is a plane, the children are moved to the top left corner.\n * Otherwise, the center of the target is used.\n *\n * @param {Root} source\n * @param {Root} target\n */\nSubProcessPlaneBehavior.prototype._moveChildrenToShape = function(source, target) {\n  var modeling = this._modeling;\n\n  var children = source.children;\n  var offset;\n\n  if (!children) {\n    return;\n  }\n\n  // add external labels that weren't children of sub process\n  children = children.concat(children.reduce(function(labels, child) {\n    if (child.label && child.label.parent !== source) {\n      return labels.concat(child.label);\n    }\n\n    return labels;\n  }, []));\n\n  // only change plane if there are no visible children, but don't move them\n  var visibleChildren = children.filter(function(child) {\n    return !child.hidden;\n  });\n\n  if (!visibleChildren.length) {\n    modeling.moveElements(children, { x: 0, y: 0 }, target, { autoResize: false });\n    return;\n  }\n\n  var childrenBounds = getBBox(visibleChildren);\n\n  // target is a plane\n  if (!target.x) {\n    offset = {\n      x: DEFAULT_POSITION.x - childrenBounds.x,\n      y: DEFAULT_POSITION.y - childrenBounds.y\n    };\n  }\n\n  // source is a plane\n  else {\n\n    // move relative to the center of the shape\n    var targetMid = getMid(target);\n    var childrenMid = getMid(childrenBounds);\n\n    offset = {\n      x: targetMid.x - childrenMid.x,\n      y: targetMid.y - childrenMid.y\n    };\n  }\n\n  modeling.moveElements(children, offset, target, { autoResize: false });\n};\n\n/**\n * Sets `hidden` property on all children of the given shape.\n *\n * @param {Element[]} elements\n * @param {boolean} [hidden=false]\n *\n * @return {Element[]}\n */\nSubProcessPlaneBehavior.prototype._showRecursively = function(elements, hidden) {\n  var self = this;\n\n  var result = [];\n  elements.forEach(function(element) {\n    element.hidden = !!hidden;\n\n    result = result.concat(element);\n\n    if (element.children) {\n      result = result.concat(\n        self._showRecursively(element.children, element.collapsed || hidden)\n      );\n    }\n  });\n\n  return result;\n};\n\n/**\n * Adds a given root element to the BPMNDI diagrams.\n *\n * @param {Root|ModdleElement} planeElement\n *\n * @return {Root}\n */\nSubProcessPlaneBehavior.prototype._addDiagram = function(planeElement) {\n  var bpmnjs = this._bpmnjs;\n  var diagrams = bpmnjs.getDefinitions().diagrams;\n\n  if (!planeElement.businessObject) {\n    planeElement = this._createNewDiagram(planeElement);\n  }\n\n  diagrams.push(planeElement.di.$parent);\n\n  return planeElement;\n};\n\n\n/**\n * Creates a new plane element for the given sub process.\n *\n * @param {ModdleElement} bpmnElement\n *\n * @return {Root}\n */\nSubProcessPlaneBehavior.prototype._createNewDiagram = function(bpmnElement) {\n  var bpmnFactory = this._bpmnFactory,\n      elementFactory = this._elementFactory;\n\n  var diPlane = bpmnFactory.create('bpmndi:BPMNPlane', {\n    bpmnElement: bpmnElement\n  });\n\n  var diDiagram = bpmnFactory.create('bpmndi:BPMNDiagram', {\n    plane: diPlane\n  });\n\n  diPlane.$parent = diDiagram;\n\n  // add a virtual element (not being drawn),\n  // a copy cat of our BpmnImporter code\n  var planeElement = elementFactory.createRoot({\n    id: getPlaneIdFromShape(bpmnElement),\n    type: bpmnElement.$type,\n    di: diPlane,\n    businessObject: bpmnElement,\n    collapsed: true\n  });\n\n  return planeElement;\n};\n\n/**\n * Removes the diagram for a given root element.\n *\n * @param {Root} rootElement\n *\n * @return {ModdleElement}\n */\nSubProcessPlaneBehavior.prototype._removeDiagram = function(rootElement) {\n  var bpmnjs = this._bpmnjs;\n\n  var diagrams = bpmnjs.getDefinitions().diagrams;\n\n  var removedDiagram = find(diagrams, function(diagram) {\n    return diagram.plane.bpmnElement.id === rootElement.id;\n  });\n\n  diagrams.splice(diagrams.indexOf(removedDiagram), 1);\n\n  return removedDiagram;\n};\n\n\nSubProcessPlaneBehavior.$inject = [\n  'canvas',\n  'eventBus',\n  'modeling',\n  'elementFactory',\n  'bpmnFactory',\n  'bpmnjs',\n  'elementRegistry'\n];\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport { isExpanded } from '../../../util/DiUtil.js';\n\n/**\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * Add start event replacing element with expanded sub process.\n *\n * @param {Injector} injector\n * @param {Modeling} modeling\n */\nexport default function SubProcessStartEventBehavior(injector, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.postExecuted('shape.replace', function(event) {\n    var oldShape = event.context.oldShape,\n        newShape = event.context.newShape;\n\n    if (\n      !is(newShape, 'bpmn:SubProcess') ||\n      ! (is(oldShape, 'bpmn:Task') || is(oldShape, 'bpmn:CallActivity')) ||\n      !isExpanded(newShape)\n    ) {\n      return;\n    }\n\n    var position = getStartEventPosition(newShape);\n\n    modeling.createShape({ type: 'bpmn:StartEvent' }, position, newShape);\n  });\n}\n\nSubProcessStartEventBehavior.$inject = [\n  'injector',\n  'modeling'\n];\n\ninherits(SubProcessStartEventBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction getStartEventPosition(shape) {\n  return {\n    x: shape.x + shape.width / 6,\n    y: shape.y + shape.height / 2\n  };\n}\n","import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\nexport default function TextAnnotationBehavior(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // On Append, TextAnnotations will be created on the Root.\n  // The default for connections will create the connection in the parent of\n  // the source element, so we overwrite the parent here.\n  this.preExecute('connection.create', function(context) {\n    const { target } = context;\n\n    if (!is(target, 'bpmn:TextAnnotation')) {\n      return;\n    }\n\n    context.parent = target.parent;\n  }, true);\n\n  this.preExecute([ 'shape.create', 'shape.resize', 'elements.move' ], function(context) {\n    const shapes = context.shapes || [ context.shape ];\n\n    if (shapes.length === 1 && is(shapes[0], 'bpmn:TextAnnotation')) {\n      context.hints = context.hints || {};\n\n      context.hints.autoResize = false;\n    }\n  }, true);\n}\n\ninherits(TextAnnotationBehavior, CommandInterceptor);\n\nTextAnnotationBehavior.$inject = [\n  'eventBus'\n];","\nimport inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  forEach\n} from 'min-dash';\n\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\n\nimport { isExpanded } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n *\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function ToggleCollapseConnectionBehaviour(\n    eventBus, modeling\n) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.postExecuted('shape.toggleCollapse', 1500, function(context) {\n\n    // var shape = context.shape;\n    var shape = context.shape;\n\n    // only change connections when collapsing\n    if (isExpanded(shape)) {\n      return;\n    }\n\n    var allChildren = selfAndAllChildren(shape);\n\n    allChildren.forEach(function(child) {\n\n      // Ensure that the connection array is not modified during iteration\n      var incomingConnections = child.incoming.slice(),\n          outgoingConnections = child.outgoing.slice();\n\n      forEach(incomingConnections, function(c) {\n        handleConnection(c, true);\n      });\n\n      forEach(outgoingConnections, function(c) {\n        handleConnection(c, false);\n      });\n    });\n\n\n    function handleConnection(c, incoming) {\n      if (allChildren.indexOf(c.source) !== -1 && allChildren.indexOf(c.target) !== -1) {\n        return;\n      }\n\n      if (incoming) {\n        modeling.reconnectEnd(c, shape, getMid(shape));\n      } else {\n        modeling.reconnectStart(c, shape, getMid(shape));\n      }\n\n    }\n\n  }, true);\n\n}\n\ninherits(ToggleCollapseConnectionBehaviour, CommandInterceptor);\n\nToggleCollapseConnectionBehaviour.$inject = [\n  'eventBus',\n  'modeling',\n];\n\n\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getDi,\n  is\n} from '../../../util/ModelUtil';\n\nimport {\n  computeChildrenBBox\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../ElementFactory').default} ElementFactory\n * @typedef {import('../Modeling').default} Modeling\n */\n\nvar LOW_PRIORITY = 500;\n\n/**\n * @param {EventBus} eventBus\n * @param {ElementFactory} elementFactory\n * @param {Modeling} modeling\n */\nexport default function ToggleElementCollapseBehaviour(\n    eventBus, elementFactory, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  function hideEmptyLabels(children) {\n    if (children.length) {\n      children.forEach(function(child) {\n        if (child.type === 'label' && !child.businessObject.name) {\n          child.hidden = true;\n        }\n      });\n    }\n  }\n\n  function expandedBounds(shape, defaultSize) {\n    var children = shape.children,\n        newBounds = defaultSize,\n        visibleElements,\n        visibleBBox;\n\n    visibleElements = filterVisible(children).concat([ shape ]);\n\n    visibleBBox = computeChildrenBBox(visibleElements);\n\n    if (visibleBBox) {\n\n      // center to visibleBBox with max(defaultSize, childrenBounds)\n      newBounds.width = Math.max(visibleBBox.width, newBounds.width);\n      newBounds.height = Math.max(visibleBBox.height, newBounds.height);\n\n      newBounds.x = visibleBBox.x + (visibleBBox.width - newBounds.width) / 2;\n      newBounds.y = visibleBBox.y + (visibleBBox.height - newBounds.height) / 2;\n    } else {\n\n      // center to collapsed shape with defaultSize\n      newBounds.x = shape.x + (shape.width - newBounds.width) / 2;\n      newBounds.y = shape.y + (shape.height - newBounds.height) / 2;\n    }\n\n    return newBounds;\n  }\n\n  function collapsedBounds(shape, defaultSize) {\n\n    return {\n      x: shape.x + (shape.width - defaultSize.width) / 2,\n      y: shape.y + (shape.height - defaultSize.height) / 2,\n      width: defaultSize.width,\n      height: defaultSize.height\n    };\n  }\n\n  this.executed([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n\n    var context = e.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    if (!shape.collapsed) {\n\n      // all children got made visible through djs, hide empty labels\n      hideEmptyLabels(shape.children);\n\n      // remove collapsed marker\n      getDi(shape).isExpanded = true;\n    } else {\n\n      // place collapsed marker\n      getDi(shape).isExpanded = false;\n    }\n  });\n\n  this.reverted([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n\n    var context = e.context;\n    var shape = context.shape;\n\n\n    // revert removing/placing collapsed marker\n    if (!shape.collapsed) {\n      getDi(shape).isExpanded = true;\n\n    } else {\n      getDi(shape).isExpanded = false;\n    }\n  });\n\n  this.postExecuted([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n    var shape = e.context.shape,\n        defaultSize = elementFactory.getDefaultSize(shape),\n        newBounds;\n\n    if (shape.collapsed) {\n\n      // resize to default size of collapsed shapes\n      newBounds = collapsedBounds(shape, defaultSize);\n    } else {\n\n      // resize to bounds of max(visible children, defaultSize)\n      newBounds = expandedBounds(shape, defaultSize);\n    }\n\n    modeling.resizeShape(shape, newBounds, null, {\n      autoResize: shape.collapsed ? false : 'nwse'\n    });\n  });\n\n}\n\n\ninherits(ToggleElementCollapseBehaviour, CommandInterceptor);\n\nToggleElementCollapseBehaviour.$inject = [\n  'eventBus',\n  'elementFactory',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction filterVisible(elements) {\n  return elements.filter(function(e) {\n    return !e.hidden;\n  });\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\nimport { isExpanded } from '../../../util/DiUtil';\nimport { isLabel } from '../../../util/LabelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('../Modeling').default} Modeling\n *\n * @typedef {import('../../../model/Types').Moddle} Moddle\n */\n\n/**\n * Unclaims model IDs on element deletion.\n *\n * @param {Canvas} canvas\n * @param {Injector} injector\n * @param {Moddle} moddle\n * @param {Modeling} modeling\n */\nexport default function UnclaimIdBehavior(canvas, injector, moddle, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.preExecute('shape.delete', function(event) {\n    var context = event.context,\n        shape = context.shape,\n        shapeBo = shape.businessObject;\n\n    if (isLabel(shape)) {\n      return;\n    }\n\n    if (is(shape, 'bpmn:Participant') && isExpanded(shape)) {\n      moddle.ids.unclaim(shapeBo.processRef.id);\n    }\n\n    modeling.unclaimId(shapeBo.id, shapeBo);\n  });\n\n\n  this.preExecute('connection.delete', function(event) {\n    var context = event.context,\n        connection = context.connection,\n        connectionBo = connection.businessObject;\n\n    modeling.unclaimId(connectionBo.id, connectionBo);\n  });\n\n  this.preExecute('canvas.updateRoot', function() {\n    var rootElement = canvas.getRootElement(),\n        rootElementBo = rootElement.businessObject;\n\n    if (is(rootElement, 'bpmn:Collaboration')) {\n      moddle.ids.unclaim(rootElementBo.id);\n    }\n  });\n}\n\ninherits(UnclaimIdBehavior, CommandInterceptor);\n\nUnclaimIdBehavior.$inject = [ 'canvas', 'injector', 'moddle', 'modeling' ];","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  is\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * A behavior that unsets the Default property of sequence flow source on\n * element delete, if the removed element is the Gateway or Task's default flow.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function DeleteSequenceFlowBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  this.preExecute('connection.delete', function(event) {\n    var context = event.context,\n        connection = context.connection,\n        source = connection.source;\n\n    if (isDefaultFlow(connection, source)) {\n      modeling.updateProperties(source, {\n        'default': null\n      });\n    }\n  });\n}\n\ninherits(DeleteSequenceFlowBehavior, CommandInterceptor);\n\nDeleteSequenceFlowBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction isDefaultFlow(connection, source) {\n\n  if (!is(connection, 'bpmn:SequenceFlow')) {\n    return false;\n  }\n\n  var sourceBo = getBusinessObject(source),\n      sequenceFlow = getBusinessObject(connection);\n\n  return sourceBo.get('default') === sequenceFlow;\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\nvar LOW_PRIORITY = 500,\n    HIGH_PRIORITY = 5000;\n\n\n/**\n * BPMN specific delete lane behavior.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function UpdateFlowNodeRefsBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Update Lane#flowNodeRefs and FlowNode#lanes with every flow node\n   * move/resize and lane move/resize. Groups elements to recompute containments\n   * as efficient as possible.\n   */\n\n  // the update context\n  var context;\n\n\n  function initContext() {\n    context = context || new UpdateContext();\n    context.enter();\n\n    return context;\n  }\n\n  function getContext() {\n    if (!context) {\n      throw new Error('out of bounds release');\n    }\n\n    return context;\n  }\n\n  function releaseContext() {\n\n    if (!context) {\n      throw new Error('out of bounds release');\n    }\n\n    var triggerUpdate = context.leave();\n\n    if (triggerUpdate) {\n      modeling.updateLaneRefs(context.flowNodes, context.lanes);\n\n      context = null;\n    }\n\n    return triggerUpdate;\n  }\n\n\n  var laneRefUpdateEvents = [\n    'spaceTool',\n    'lane.add',\n    'lane.resize',\n    'lane.split',\n    'elements.create',\n    'elements.delete',\n    'elements.move',\n    'shape.create',\n    'shape.delete',\n    'shape.move',\n    'shape.resize'\n  ];\n\n\n  // listen to a lot of stuff to group lane updates\n\n  this.preExecute(laneRefUpdateEvents, HIGH_PRIORITY, function(event) {\n    initContext();\n  });\n\n  this.postExecuted(laneRefUpdateEvents, LOW_PRIORITY, function(event) {\n    releaseContext();\n  });\n\n\n  // Mark flow nodes + lanes that need an update\n\n  this.preExecute([\n    'shape.create',\n    'shape.move',\n    'shape.delete',\n    'shape.resize'\n  ], function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    var updateContext = getContext();\n\n    // no need to update labels\n    if (shape.labelTarget) {\n      return;\n    }\n\n    if (is(shape, 'bpmn:Lane')) {\n      updateContext.addLane(shape);\n    }\n\n    if (is(shape, 'bpmn:FlowNode')) {\n      updateContext.addFlowNode(shape);\n    }\n  });\n}\n\nUpdateFlowNodeRefsBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\ninherits(UpdateFlowNodeRefsBehavior, CommandInterceptor);\n\n\nfunction UpdateContext() {\n\n  this.flowNodes = [];\n  this.lanes = [];\n\n  this.counter = 0;\n\n  this.addLane = function(lane) {\n    this.lanes.push(lane);\n  };\n\n  this.addFlowNode = function(flowNode) {\n    this.flowNodes.push(flowNode);\n  };\n\n  this.enter = function() {\n    this.counter++;\n  };\n\n  this.leave = function() {\n    this.counter--;\n\n    return !this.counter;\n  };\n}","import AdaptiveLabelPositioningBehavior from './AdaptiveLabelPositioningBehavior';\nimport AppendBehavior from './AppendBehavior';\nimport AssociationBehavior from './AssociationBehavior';\nimport AttachEventBehavior from './AttachEventBehavior';\nimport BoundaryEventBehavior from './BoundaryEventBehavior';\nimport CompensateBoundaryEventBehavior from './CompensateBoundaryEventBehavior';\nimport CreateBehavior from './CreateBehavior';\nimport CreateDataObjectBehavior from './CreateDataObjectBehavior';\nimport CreateParticipantBehavior from './CreateParticipantBehavior';\nimport DataInputAssociationBehavior from './DataInputAssociationBehavior';\nimport DataStoreBehavior from './DataStoreBehavior';\nimport DeleteLaneBehavior from './DeleteLaneBehavior';\nimport DetachEventBehavior from './DetachEventBehavior';\nimport DropOnFlowBehavior from './DropOnFlowBehavior';\nimport EventBasedGatewayBehavior from './EventBasedGatewayBehavior';\nimport FixHoverBehavior from './FixHoverBehavior';\nimport GroupBehavior from './GroupBehavior';\nimport ImportDockingFix from './ImportDockingFix';\nimport IsHorizontalFix from './IsHorizontalFix';\nimport LabelBehavior from './LabelBehavior';\nimport LayoutConnectionBehavior from './LayoutConnectionBehavior';\nimport MessageFlowBehavior from './MessageFlowBehavior';\nimport NonInterruptingBehavior from './NonInterruptingBehavior';\nimport RemoveEmbeddedLabelBoundsBehavior from './RemoveEmbeddedLabelBoundsBehavior';\nimport RemoveElementBehavior from './RemoveElementBehavior';\nimport RemoveParticipantBehavior from './RemoveParticipantBehavior';\nimport ReplaceConnectionBehavior from './ReplaceConnectionBehavior';\nimport ReplaceElementBehaviour from './ReplaceElementBehaviour';\nimport ResizeBehavior from './ResizeBehavior';\nimport ResizeLaneBehavior from './ResizeLaneBehavior';\nimport RootElementReferenceBehavior from './RootElementReferenceBehavior';\nimport SpaceToolBehavior from './SpaceToolBehavior';\nimport SubProcessPlaneBehavior from './SubProcessPlaneBehavior';\nimport SubProcessStartEventBehavior from './SubProcessStartEventBehavior';\nimport TextAnnotationBehavior from './TextAnnotationBehavior';\nimport ToggleCollapseConnectionBehaviour from './ToggleCollapseConnectionBehaviour';\nimport ToggleElementCollapseBehaviour from './ToggleElementCollapseBehaviour';\nimport UnclaimIdBehavior from './UnclaimIdBehavior';\nimport UnsetDefaultFlowBehavior from './UnsetDefaultFlowBehavior';\nimport UpdateFlowNodeRefsBehavior from './UpdateFlowNodeRefsBehavior';\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [\n    'adaptiveLabelPositioningBehavior',\n    'appendBehavior',\n    'associationBehavior',\n    'attachEventBehavior',\n    'boundaryEventBehavior',\n    'compensateBoundaryEventBehaviour',\n    'createBehavior',\n    'createDataObjectBehavior',\n    'createParticipantBehavior',\n    'dataInputAssociationBehavior',\n    'dataStoreBehavior',\n    'deleteLaneBehavior',\n    'detachEventBehavior',\n    'dropOnFlowBehavior',\n    'eventBasedGatewayBehavior',\n    'fixHoverBehavior',\n    'groupBehavior',\n    'importDockingFix',\n    'isHorizontalFix',\n    'labelBehavior',\n    'layoutConnectionBehavior',\n    'messageFlowBehavior',\n    'nonInterruptingBehavior',\n    'removeElementBehavior',\n    'removeEmbeddedLabelBoundsBehavior',\n    'removeParticipantBehavior',\n    'replaceConnectionBehavior',\n    'replaceElementBehaviour',\n    'resizeBehavior',\n    'resizeLaneBehavior',\n    'rootElementReferenceBehavior',\n    'spaceToolBehavior',\n    'subProcessPlaneBehavior',\n    'subProcessStartEventBehavior',\n    'textAnnotationBehavior',\n    'toggleCollapseConnectionBehaviour',\n    'toggleElementCollapseBehaviour',\n    'unclaimIdBehavior',\n    'updateFlowNodeRefsBehavior',\n    'unsetDefaultFlowBehavior'\n  ],\n  adaptiveLabelPositioningBehavior: [ 'type', AdaptiveLabelPositioningBehavior ],\n  appendBehavior: [ 'type', AppendBehavior ],\n  associationBehavior: [ 'type', AssociationBehavior ],\n  attachEventBehavior: [ 'type', AttachEventBehavior ],\n  boundaryEventBehavior: [ 'type', BoundaryEventBehavior ],\n  compensateBoundaryEventBehaviour: [ 'type', CompensateBoundaryEventBehavior ],\n  createBehavior: [ 'type', CreateBehavior ],\n  createDataObjectBehavior: [ 'type', CreateDataObjectBehavior ],\n  createParticipantBehavior: [ 'type', CreateParticipantBehavior ],\n  dataInputAssociationBehavior: [ 'type', DataInputAssociationBehavior ],\n  dataStoreBehavior: [ 'type', DataStoreBehavior ],\n  deleteLaneBehavior: [ 'type', DeleteLaneBehavior ],\n  detachEventBehavior: [ 'type', DetachEventBehavior ],\n  dropOnFlowBehavior: [ 'type', DropOnFlowBehavior ],\n  eventBasedGatewayBehavior: [ 'type', EventBasedGatewayBehavior ],\n  fixHoverBehavior: [ 'type', FixHoverBehavior ],\n  groupBehavior: [ 'type', GroupBehavior ],\n  importDockingFix: [ 'type', ImportDockingFix ],\n  isHorizontalFix: [ 'type', IsHorizontalFix ],\n  labelBehavior: [ 'type', LabelBehavior ],\n  layoutConnectionBehavior: [ 'type', LayoutConnectionBehavior ],\n  messageFlowBehavior: [ 'type', MessageFlowBehavior ],\n  nonInterruptingBehavior: [ 'type', NonInterruptingBehavior ],\n  removeElementBehavior: [ 'type', RemoveElementBehavior ],\n  removeEmbeddedLabelBoundsBehavior: [ 'type', RemoveEmbeddedLabelBoundsBehavior ],\n  removeParticipantBehavior: [ 'type', RemoveParticipantBehavior ],\n  replaceConnectionBehavior: [ 'type', ReplaceConnectionBehavior ],\n  replaceElementBehaviour: [ 'type', ReplaceElementBehaviour ],\n  resizeBehavior: [ 'type', ResizeBehavior ],\n  resizeLaneBehavior: [ 'type', ResizeLaneBehavior ],\n  rootElementReferenceBehavior: [ 'type', RootElementReferenceBehavior ],\n  spaceToolBehavior: [ 'type', SpaceToolBehavior ],\n  subProcessPlaneBehavior: [ 'type', SubProcessPlaneBehavior ],\n  subProcessStartEventBehavior: [ 'type', SubProcessStartEventBehavior ],\n  textAnnotationBehavior: [ 'type', TextAnnotationBehavior ],\n  toggleCollapseConnectionBehaviour: [ 'type', ToggleCollapseConnectionBehaviour ],\n  toggleElementCollapseBehaviour : [ 'type', ToggleElementCollapseBehaviour ],\n  unclaimIdBehavior: [ 'type', UnclaimIdBehavior ],\n  unsetDefaultFlowBehavior: [ 'type', UnsetDefaultFlowBehavior ],\n  updateFlowNodeRefsBehavior: [ 'type', UpdateFlowNodeRefsBehavior ]\n};\n","import { getOrientation } from 'diagram-js/lib/layout/LayoutUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\r\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\r\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\r\n */\r\n\r\n/**\r\n * @param {Point} position\r\n * @param {Rect} targetBounds\r\n *\r\n * @return {DirectionTRBL|null}\r\n */\r\nexport function getBoundaryAttachment(position, targetBounds) {\r\n\r\n  var orientation = getOrientation(position, targetBounds, -15);\r\n\r\n  if (orientation !== 'intersect') {\r\n    return orientation;\r\n  } else {\r\n    return null;\r\n  }\r\n}","import {\n  every,\n  find,\n  forEach,\n  some\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../util/ModelUtil';\n\nimport {\n  getParent,\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  isLabel\n} from '../../util/LabelUtil';\n\nimport {\n  isExpanded,\n  isEventSubProcess,\n  isInterrupting,\n  hasErrorEventDefinition,\n  hasEscalationEventDefinition,\n  hasCompensateEventDefinition\n} from '../../util/DiUtil';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\n\nimport {\n  getBoundaryAttachment as isBoundaryAttachment\n} from '../snapping/BpmnSnappingUtil';\n\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n *\n * @typedef { {\n *   associationDirection?: 'None' | 'One' | 'Both';\n *   type: string;\n * } | boolean | null } CanConnectResult\n *\n * @typedef { {\n *   id: string;\n *   type: string;\n * } | boolean } CanReplaceResult\n */\n\n/**\n * BPMN-specific modeling rules.\n *\n * @param {EventBus} eventBus\n */\nexport default function BpmnRules(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\ninherits(BpmnRules, RuleProvider);\n\nBpmnRules.$inject = [ 'eventBus' ];\n\nBpmnRules.prototype.init = function() {\n\n  this.addRule('connection.start', function(context) {\n    var source = context.source;\n\n    return canStartConnection(source);\n  });\n\n  this.addRule('connection.create', function(context) {\n    var source = context.source,\n        target = context.target,\n        hints = context.hints || {},\n        targetParent = hints.targetParent,\n        targetAttach = hints.targetAttach;\n\n    // don't allow incoming connections on\n    // newly created boundary events\n    // to boundary events\n    if (targetAttach) {\n      return false;\n    }\n\n    // temporarily set target parent for scoping\n    // checks to work\n    if (targetParent) {\n      target.parent = targetParent;\n    }\n\n    try {\n      return canConnect(source, target);\n    } finally {\n\n      // unset temporary target parent\n      if (targetParent) {\n        target.parent = null;\n      }\n    }\n  });\n\n  this.addRule('connection.reconnect', function(context) {\n\n    var connection = context.connection,\n        source = context.source,\n        target = context.target;\n\n    return canConnect(source, target, connection);\n  });\n\n  this.addRule('connection.updateWaypoints', function(context) {\n    return {\n      type: context.connection.type\n    };\n  });\n\n  this.addRule('shape.resize', function(context) {\n\n    var shape = context.shape,\n        newBounds = context.newBounds;\n\n    return canResize(shape, newBounds);\n  });\n\n  this.addRule('elements.create', function(context) {\n    var elements = context.elements,\n        position = context.position,\n        target = context.target;\n\n    if (isConnection(target) && !canInsert(elements, target, position)) {\n      return false;\n    }\n\n    return every(elements, function(element) {\n      if (isConnection(element)) {\n        return canConnect(element.source, element.target, element);\n      }\n\n      if (element.host) {\n        return canAttach(element, element.host, null, position);\n      }\n\n      return canCreate(element, target, null, position);\n    });\n  });\n\n  this.addRule('elements.move', function(context) {\n\n    var target = context.target,\n        shapes = context.shapes,\n        position = context.position;\n\n    return canAttach(shapes, target, null, position) ||\n           canReplace(shapes, target, position) ||\n           canMove(shapes, target, position) ||\n           canInsert(shapes, target, position);\n  });\n\n  this.addRule('shape.create', function(context) {\n    return canCreate(\n      context.shape,\n      context.target,\n      context.source,\n      context.position\n    );\n  });\n\n  this.addRule('shape.attach', function(context) {\n\n    return canAttach(\n      context.shape,\n      context.target,\n      null,\n      context.position\n    );\n  });\n\n  this.addRule('element.copy', function(context) {\n    var element = context.element,\n        elements = context.elements;\n\n    return canCopy(elements, element);\n  });\n};\n\nBpmnRules.prototype.canConnectMessageFlow = canConnectMessageFlow;\n\nBpmnRules.prototype.canConnectSequenceFlow = canConnectSequenceFlow;\n\nBpmnRules.prototype.canConnectDataAssociation = canConnectDataAssociation;\n\nBpmnRules.prototype.canConnectAssociation = canConnectAssociation;\n\nBpmnRules.prototype.canConnectCompensationAssociation = canConnectCompensationAssociation;\n\nBpmnRules.prototype.canMove = canMove;\n\nBpmnRules.prototype.canAttach = canAttach;\n\nBpmnRules.prototype.canReplace = canReplace;\n\nBpmnRules.prototype.canDrop = canDrop;\n\nBpmnRules.prototype.canInsert = canInsert;\n\nBpmnRules.prototype.canCreate = canCreate;\n\nBpmnRules.prototype.canConnect = canConnect;\n\nBpmnRules.prototype.canResize = canResize;\n\nBpmnRules.prototype.canCopy = canCopy;\n\n/**\n * Utility functions for rule checking\n */\n\n/**\n * Checks if given element can be used for starting connection.\n *\n * @param  {Element} source\n *\n * @return {boolean}\n */\nfunction canStartConnection(element) {\n  if (nonExistingOrLabel(element)) {\n    return null;\n  }\n\n  return isAny(element, [\n    'bpmn:FlowNode',\n    'bpmn:InteractionNode',\n    'bpmn:DataObjectReference',\n    'bpmn:DataStoreReference',\n    'bpmn:Group',\n    'bpmn:TextAnnotation'\n  ]);\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction nonExistingOrLabel(element) {\n  return !element || isLabel(element);\n}\n\nfunction isSame(a, b) {\n  return a === b;\n}\n\n/**\n * @param {Element} element\n *\n * @return {ModdleElement}\n */\nfunction getOrganizationalParent(element) {\n\n  do {\n    if (is(element, 'bpmn:Process')) {\n      return getBusinessObject(element);\n    }\n\n    if (is(element, 'bpmn:Participant')) {\n      return (\n        getBusinessObject(element).processRef ||\n        getBusinessObject(element)\n      );\n    }\n  } while ((element = element.parent));\n\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isTextAnnotation(element) {\n  return is(element, 'bpmn:TextAnnotation');\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isGroup(element) {\n  return is(element, 'bpmn:Group') && !element.labelTarget;\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isCompensationBoundary(element) {\n  return is(element, 'bpmn:BoundaryEvent') &&\n         hasEventDefinition(element, 'bpmn:CompensateEventDefinition');\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isForCompensation(element) {\n  return getBusinessObject(element).isForCompensation;\n}\n\n/**\n * @param {Element} a\n * @param {Element} b\n *\n * @return {boolean}\n */\nfunction isSameOrganization(a, b) {\n  var parentA = getOrganizationalParent(a),\n      parentB = getOrganizationalParent(b);\n\n  return parentA === parentB;\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isMessageFlowSource(element) {\n  return (\n    is(element, 'bpmn:InteractionNode') &&\n    !is(element, 'bpmn:BoundaryEvent') && (\n      !is(element, 'bpmn:Event') || (\n        is(element, 'bpmn:ThrowEvent') &&\n        hasEventDefinitionOrNone(element, 'bpmn:MessageEventDefinition')\n      )\n    )\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isMessageFlowTarget(element) {\n  return (\n    is(element, 'bpmn:InteractionNode') &&\n    !isForCompensation(element) && (\n      !is(element, 'bpmn:Event') || (\n        is(element, 'bpmn:CatchEvent') &&\n        hasEventDefinitionOrNone(element, 'bpmn:MessageEventDefinition')\n      )\n    ) && !(\n      is(element, 'bpmn:BoundaryEvent') &&\n      !hasEventDefinition(element, 'bpmn:MessageEventDefinition')\n    )\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {ModdleElement}\n */\nfunction getScopeParent(element) {\n\n  var parent = element;\n\n  while ((parent = parent.parent)) {\n\n    if (is(parent, 'bpmn:FlowElementsContainer')) {\n      return getBusinessObject(parent);\n    }\n\n    if (is(parent, 'bpmn:Participant')) {\n      return getBusinessObject(parent).processRef;\n    }\n  }\n\n  return null;\n}\n\n/**\n * @param {Element} a\n * @param {Element} b\n *\n * @return {boolean}\n */\nfunction isSameScope(a, b) {\n  var scopeParentA = getScopeParent(a),\n      scopeParentB = getScopeParent(b);\n\n  return scopeParentA === scopeParentB;\n}\n\n/**\n * @param {Element} element\n * @param {string} eventDefinition\n *\n * @return {boolean}\n */\nfunction hasEventDefinition(element, eventDefinition) {\n  var businessObject = getBusinessObject(element);\n\n  return !!find(businessObject.eventDefinitions || [], function(definition) {\n    return is(definition, eventDefinition);\n  });\n}\n\n/**\n * @param {Element} element\n * @param {string} eventDefinition\n *\n * @return {boolean}\n */\nfunction hasEventDefinitionOrNone(element, eventDefinition) {\n  var businessObject = getBusinessObject(element);\n\n  return (businessObject.eventDefinitions || []).every(function(definition) {\n    return is(definition, eventDefinition);\n  });\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isSequenceFlowSource(element) {\n  return (\n    is(element, 'bpmn:FlowNode') &&\n    !is(element, 'bpmn:EndEvent') &&\n    !isEventSubProcess(element) &&\n    !(is(element, 'bpmn:IntermediateThrowEvent') &&\n      hasEventDefinition(element, 'bpmn:LinkEventDefinition')\n    ) &&\n    !isCompensationBoundary(element) &&\n    !isForCompensation(element)\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isSequenceFlowTarget(element) {\n  return (\n    is(element, 'bpmn:FlowNode') &&\n    !is(element, 'bpmn:StartEvent') &&\n    !is(element, 'bpmn:BoundaryEvent') &&\n    !isEventSubProcess(element) &&\n    !(is(element, 'bpmn:IntermediateCatchEvent') &&\n      hasEventDefinition(element, 'bpmn:LinkEventDefinition')\n    ) &&\n    !isForCompensation(element)\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isEventBasedTarget(element) {\n  return (\n    is(element, 'bpmn:ReceiveTask') || (\n      is(element, 'bpmn:IntermediateCatchEvent') && (\n        hasEventDefinition(element, 'bpmn:MessageEventDefinition') ||\n        hasEventDefinition(element, 'bpmn:TimerEventDefinition') ||\n        hasEventDefinition(element, 'bpmn:ConditionalEventDefinition') ||\n        hasEventDefinition(element, 'bpmn:SignalEventDefinition')\n      )\n    )\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {Shape[]}\n */\nfunction getParents(element) {\n\n  var parents = [];\n\n  while (element) {\n    element = element.parent;\n\n    if (element) {\n      parents.push(element);\n    }\n  }\n\n  return parents;\n}\n\n/**\n * @param {Shape} possibleParent\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isParent(possibleParent, element) {\n  var allParents = getParents(element);\n\n  return allParents.indexOf(possibleParent) !== -1;\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n * @param {Connection} connection\n *\n * @return {CanConnectResult}\n */\nfunction canConnect(source, target, connection) {\n\n  if (nonExistingOrLabel(source) || nonExistingOrLabel(target)) {\n    return null;\n  }\n\n  if (!is(connection, 'bpmn:DataAssociation')) {\n\n    if (canConnectMessageFlow(source, target)) {\n      return { type: 'bpmn:MessageFlow' };\n    }\n\n    if (canConnectSequenceFlow(source, target)) {\n      return { type: 'bpmn:SequenceFlow' };\n    }\n  }\n\n  var connectDataAssociation = canConnectDataAssociation(source, target);\n\n  if (connectDataAssociation) {\n    return connectDataAssociation;\n  }\n\n  if (canConnectCompensationAssociation(source, target)) {\n    return {\n      type: 'bpmn:Association',\n      associationDirection: 'One'\n    };\n  }\n\n  if (canConnectAssociation(source, target)) {\n    return {\n      type: 'bpmn:Association',\n      associationDirection: 'None'\n    };\n  }\n\n  return false;\n}\n\n/**\n * Can an element be dropped into the target element.\n *\n * @param {Element} element\n * @param {Shape} target\n *\n * @return {boolean}\n */\nfunction canDrop(element, target) {\n\n  // can move labels and groups everywhere\n  if (isLabel(element) || isGroup(element)) {\n    return true;\n  }\n\n\n  // disallow to create elements on collapsed pools\n  if (is(target, 'bpmn:Participant') && !isExpanded(target)) {\n    return false;\n  }\n\n  // allow to create new participants on\n  // existing collaboration and process diagrams\n  if (is(element, 'bpmn:Participant')) {\n    return is(target, 'bpmn:Process') || is(target, 'bpmn:Collaboration');\n  }\n\n  // allow moving DataInput / DataOutput within its original container only\n  if (isAny(element, [ 'bpmn:DataInput', 'bpmn:DataOutput' ])) {\n\n    if (element.parent) {\n      return target === element.parent;\n    }\n  }\n\n  // allow creating lanes on participants and other lanes only\n  if (is(element, 'bpmn:Lane')) {\n    return is(target, 'bpmn:Participant') || is(target, 'bpmn:Lane');\n  }\n\n  // disallow dropping boundary events which cannot replace with intermediate event\n  if (is(element, 'bpmn:BoundaryEvent') && !isDroppableBoundaryEvent(element)) {\n    return false;\n  }\n\n  // drop flow elements onto flow element containers\n  // and participants\n  if (is(element, 'bpmn:FlowElement') && !is(element, 'bpmn:DataStoreReference')) {\n    if (is(target, 'bpmn:FlowElementsContainer')) {\n      return isExpanded(target);\n    }\n\n    return isAny(target, [ 'bpmn:Participant', 'bpmn:Lane' ]);\n  }\n\n  // disallow dropping data store reference if there is no process to append to\n  if (is(element, 'bpmn:DataStoreReference') && is(target, 'bpmn:Collaboration')) {\n    return some(getBusinessObject(target).get('participants'), function(participant) {\n      return !!participant.get('processRef');\n    });\n  }\n\n  // account for the fact that data associations are always\n  // rendered and moved to top (Process or Collaboration level)\n  //\n  // artifacts may be placed wherever, too\n  if (isAny(element, [ 'bpmn:Artifact', 'bpmn:DataAssociation', 'bpmn:DataStoreReference' ])) {\n    return isAny(target, [\n      'bpmn:Collaboration',\n      'bpmn:Lane',\n      'bpmn:Participant',\n      'bpmn:Process',\n      'bpmn:SubProcess' ]);\n  }\n\n  if (is(element, 'bpmn:MessageFlow')) {\n    return is(target, 'bpmn:Collaboration')\n      || element.source.parent == target\n      || element.target.parent == target;\n  }\n\n  return false;\n}\n\n/**\n * @param {Shape} event\n *\n * @return {boolean}\n */\nfunction isDroppableBoundaryEvent(event) {\n  return getBusinessObject(event).cancelActivity && (\n    hasNoEventDefinition(event) || hasCommonBoundaryIntermediateEventDefinition(event)\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isBoundaryEvent(element) {\n  return !isLabel(element) && is(element, 'bpmn:BoundaryEvent');\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isLane(element) {\n  return is(element, 'bpmn:Lane');\n}\n\n/**\n * `bpmn:IntermediateThrowEvents` are treated as boundary events during create.\n *\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isBoundaryCandidate(element) {\n  if (isBoundaryEvent(element)) {\n    return true;\n  }\n\n  if (is(element, 'bpmn:IntermediateThrowEvent') && hasNoEventDefinition(element)) {\n    return true;\n  }\n\n  return (\n    is(element, 'bpmn:IntermediateCatchEvent') &&\n    hasCommonBoundaryIntermediateEventDefinition(element)\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction hasNoEventDefinition(element) {\n  var businessObject = getBusinessObject(element);\n\n  return businessObject && !(businessObject.eventDefinitions && businessObject.eventDefinitions.length);\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction hasCommonBoundaryIntermediateEventDefinition(element) {\n  return hasOneOfEventDefinitions(element, [\n    'bpmn:MessageEventDefinition',\n    'bpmn:TimerEventDefinition',\n    'bpmn:SignalEventDefinition',\n    'bpmn:ConditionalEventDefinition'\n  ]);\n}\n\n/**\n * @param {Element} element\n * @param {string[]} eventDefinitions\n *\n * @return {boolean}\n */\nfunction hasOneOfEventDefinitions(element, eventDefinitions) {\n  return eventDefinitions.some(function(definition) {\n    return hasEventDefinition(element, definition);\n  });\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isReceiveTaskAfterEventBasedGateway(element) {\n  return (\n    is(element, 'bpmn:ReceiveTask') &&\n    find(element.incoming, function(incoming) {\n      return is(incoming.source, 'bpmn:EventBasedGateway');\n    })\n  );\n}\n\n/**\n * TODO(philippfromme): remove `source` parameter\n *\n * @param {Element[]} elements\n * @param {Shape} target\n * @param {Element} source\n * @param {Point} [position]\n *\n * @return {boolean | 'attach'}\n */\nfunction canAttach(elements, target, source, position) {\n\n  if (!Array.isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  // only (re-)attach one element at a time\n  if (elements.length !== 1) {\n    return false;\n  }\n\n  var element = elements[0];\n\n  // do not attach labels\n  if (isLabel(element)) {\n    return false;\n  }\n\n  // only handle boundary events\n  if (!isBoundaryCandidate(element)) {\n    return false;\n  }\n\n  // disallow drop on event sub processes\n  if (isEventSubProcess(target)) {\n    return false;\n  }\n\n  // only allow drop on non compensation activities\n  if (!is(target, 'bpmn:Activity') || isForCompensation(target)) {\n    return false;\n  }\n\n  // only attach to subprocess border\n  if (position && !isBoundaryAttachment(position, target)) {\n    return false;\n  }\n\n  // do not attach on receive tasks after event based gateways\n  if (isReceiveTaskAfterEventBasedGateway(target)) {\n    return false;\n  }\n\n  return 'attach';\n}\n\n/**\n * Check whether the given elements can be replaced. Return all elements which\n * can be replaced.\n *\n * @example\n *\n * ```javascript\n * [{\n *   id: 'IntermediateEvent_1',\n *   type: 'bpmn:StartEvent'\n * },\n * {\n *   id: 'Task_1',\n *   type: 'bpmn:ServiceTask'\n * }]\n * ```\n *\n * @param  {Element[]} elements\n * @param  {Shape} [target]\n * @param  {Point} [position]\n *\n * @return {CanReplaceResult}\n */\nfunction canReplace(elements, target, position) {\n\n  if (!target) {\n    return false;\n  }\n\n  var canExecute = {\n    replacements: []\n  };\n\n  forEach(elements, function(element) {\n\n    if (!isEventSubProcess(target)) {\n\n      if (is(element, 'bpmn:StartEvent') &&\n          element.type !== 'label' &&\n          canDrop(element, target)) {\n\n        // replace a non-interrupting start event by a blank interrupting start event\n        // when the target is not an event sub process\n        if (!isInterrupting(element)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:StartEvent'\n          });\n        }\n\n        // replace an error/escalation/compensate start event by a blank interrupting start event\n        // when the target is not an event sub process\n        if (hasErrorEventDefinition(element) ||\n            hasEscalationEventDefinition(element) ||\n            hasCompensateEventDefinition(element)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:StartEvent'\n          });\n        }\n\n        // replace a typed start event by a blank interrupting start event\n        // when the target is a sub process but not an event sub process\n        if (hasOneOfEventDefinitions(element,\n          [\n            'bpmn:MessageEventDefinition',\n            'bpmn:TimerEventDefinition',\n            'bpmn:SignalEventDefinition',\n            'bpmn:ConditionalEventDefinition'\n          ]) &&\n            is(target, 'bpmn:SubProcess')) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:StartEvent'\n          });\n        }\n      }\n    }\n\n    if (!is(target, 'bpmn:Transaction')) {\n      if (hasEventDefinition(element, 'bpmn:CancelEventDefinition') &&\n          element.type !== 'label') {\n\n        if (is(element, 'bpmn:EndEvent') && canDrop(element, target)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:EndEvent'\n          });\n        }\n\n        if (is(element, 'bpmn:BoundaryEvent') && canAttach(element, target, null, position)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:BoundaryEvent'\n          });\n        }\n      }\n    }\n  });\n\n  return canExecute.replacements.length ? canExecute : false;\n}\n\n/**\n * @param {Element[]} elements\n * @param {Shape} target\n *\n * @return {boolean}\n */\nfunction canMove(elements, target) {\n\n  // do not move selection containing lanes\n  if (some(elements, isLane)) {\n    return false;\n  }\n\n  // allow default move check to start move operation\n  if (!target) {\n    return true;\n  }\n\n  return elements.every(function(element) {\n    return canDrop(element, target);\n  });\n}\n\n/**\n * @param {Shape} shape\n * @param {Shape} target\n * @param {Element} source\n * @param {Point} position\n *\n * @return {boolean}\n */\nfunction canCreate(shape, target, source, position) {\n\n  if (!target) {\n    return false;\n  }\n\n  if (isLabel(shape) || isGroup(shape)) {\n    return true;\n  }\n\n  if (isSame(source, target)) {\n    return false;\n  }\n\n  // ensure we do not drop the element\n  // into source\n  if (source && isParent(source, target)) {\n    return false;\n  }\n\n  return canDrop(shape, target, position) || canInsert(shape, target, position);\n}\n\n/**\n * @param {Shape} shape\n * @param {Rect} newBounds\n *\n * @return {boolean}\n */\nfunction canResize(shape, newBounds) {\n  if (is(shape, 'bpmn:SubProcess')) {\n    return (\n      isExpanded(shape) && (\n        !newBounds || (newBounds.width >= 100 && newBounds.height >= 80)\n      )\n    );\n  }\n\n  if (is(shape, 'bpmn:Lane')) {\n    return true;\n  }\n\n  if (is(shape, 'bpmn:Participant')) {\n    return true;\n  }\n\n  if (isTextAnnotation(shape)) {\n    return true;\n  }\n\n  if (isGroup(shape)) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Check whether one of of the elements to be connected is a text annotation.\n *\n * @param {Element} source\n * @param {Element} target\n *\n * @return {boolean}\n */\nfunction isOneTextAnnotation(source, target) {\n\n  var sourceTextAnnotation = isTextAnnotation(source),\n      targetTextAnnotation = isTextAnnotation(target);\n\n  return (\n    (sourceTextAnnotation || targetTextAnnotation) &&\n    (sourceTextAnnotation !== targetTextAnnotation)\n  );\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {CanConnectResult}\n */\nfunction canConnectAssociation(source, target) {\n\n  // don't connect parent <-> child\n  if (isParent(target, source) || isParent(source, target)) {\n    return false;\n  }\n\n  // allow connection of associations between <!TextAnnotation> and <TextAnnotation>\n  if (isOneTextAnnotation(source, target)) {\n    return true;\n  }\n\n  // can connect associations where we can connect\n  // data associations, too (!)\n  return !!canConnectDataAssociation(source, target);\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {boolean}\n */\nfunction canConnectCompensationAssociation(source, target) {\n  return (\n    isSameScope(source, target) &&\n    isCompensationBoundary(source) &&\n    is(target, 'bpmn:Activity') &&\n    !isHostOfElement(target, source) &&\n    !isEventSubProcess(target)\n  );\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {boolean}\n */\nfunction canConnectMessageFlow(source, target) {\n\n  // during connect user might move mouse out of canvas\n  // https://github.com/bpmn-io/bpmn-js/issues/1033\n  if (getRootElement(source) && !getRootElement(target)) {\n    return false;\n  }\n\n  return (\n    isMessageFlowSource(source) &&\n    isMessageFlowTarget(target) &&\n    !isSameOrganization(source, target)\n  );\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {boolean}\n */\nfunction canConnectSequenceFlow(source, target) {\n  return isSequenceFlowSource(source) &&\n         isSequenceFlowTarget(target) &&\n         isSameScope(source, target) &&\n         !(is(source, 'bpmn:EventBasedGateway') && !isEventBasedTarget(target));\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {CanConnectResult}\n */\nfunction canConnectDataAssociation(source, target) {\n\n  if (isAny(source, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ]) &&\n      isAny(target, [ 'bpmn:Activity', 'bpmn:ThrowEvent' ])) {\n    return { type: 'bpmn:DataInputAssociation' };\n  }\n\n  if (isAny(target, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ]) &&\n      isAny(source, [ 'bpmn:Activity', 'bpmn:CatchEvent' ])) {\n    return { type: 'bpmn:DataOutputAssociation' };\n  }\n\n  return false;\n}\n\n/**\n * @param {Shape} shape\n * @param {Connection} connection\n * @param {Point} position\n *\n * @return {boolean}\n */\nfunction canInsert(shape, connection, position) {\n  if (!connection) {\n    return false;\n  }\n\n  if (Array.isArray(shape)) {\n    if (shape.length !== 1) {\n      return false;\n    }\n\n    shape = shape[ 0 ];\n  }\n\n  if (connection.source === shape ||\n      connection.target === shape) {\n    return false;\n  }\n\n  // return true if shape can be inserted into connection parent\n  return (\n    isAny(connection, [ 'bpmn:SequenceFlow', 'bpmn:MessageFlow' ]) &&\n    !isLabel(connection) &&\n    is(shape, 'bpmn:FlowNode') &&\n    !is(shape, 'bpmn:BoundaryEvent') &&\n    canDrop(shape, connection.parent, position));\n}\n\n/**\n * @param {Element[]} elements\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction includes(elements, element) {\n  return (elements && element) && elements.indexOf(element) !== -1;\n}\n\n/**\n * @param {Element[]} elements\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction canCopy(elements, element) {\n  if (isLabel(element)) {\n    return true;\n  }\n\n  if (is(element, 'bpmn:Lane') && !includes(elements, element.parent)) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * @param {Element} element\n *\n * @return {Element|null}\n */\nfunction getRootElement(element) {\n  return getParent(element, 'bpmn:Process') || getParent(element, 'bpmn:Collaboration');\n}\n\nfunction isHostOfElement(potentialHost, element) {\n  return potentialHost.attachers.includes(element);\n}\n","import RulesModule from 'diagram-js/lib/features/rules';\n\nimport BpmnRules from './BpmnRules';\n\nexport default {\n  __depends__: [\n    RulesModule\n  ],\n  __init__: [ 'bpmnRules' ],\n  bpmnRules: [ 'type', BpmnRules ]\n};\n","import { getDi } from '../../util/ModelUtil';\n\nimport {\n  filter,\n  forEach,\n  map\n} from 'min-dash';\n\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n */\n\nvar HIGH_PRIORITY = 2000;\n\n/**\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function BpmnDiOrdering(eventBus, canvas) {\n\n  eventBus.on('saveXML.start', HIGH_PRIORITY, orderDi);\n\n  function orderDi() {\n    var rootElements = canvas.getRootElements();\n\n    forEach(rootElements, function(root) {\n      var rootDi = getDi(root),\n          elements,\n          diElements;\n\n      elements = selfAndAllChildren([ root ], false);\n\n      // only bpmndi:Shape and bpmndi:Edge can be direct children of bpmndi:Plane\n      elements = filter(elements, function(element) {\n        return element !== root && !element.labelTarget;\n      });\n\n      diElements = map(elements, getDi);\n\n      rootDi.set('planeElement', diElements);\n    });\n  }\n}\n\nBpmnDiOrdering.$inject = [ 'eventBus', 'canvas' ];\n","import BpmnDiOrdering from '../di-ordering/BpmnDiOrdering';\n\nexport default {\n  __init__: [\n    'bpmnDiOrdering'\n  ],\n  bpmnDiOrdering: [ 'type', BpmnDiOrdering ]\n};","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from '../../command/CommandInterceptor';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ElementLike} Element\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * An abstract provider that allows modelers to implement a custom\r\n * ordering of diagram elements on the canvas.\r\n *\r\n * It makes sure that the order is always preserved during element\r\n * creation and move operations.\r\n *\r\n * In order to use this behavior, inherit from it and override\r\n * the method {@link OrderingProvider#getOrdering}.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * function CustomOrderingProvider(eventBus) {\r\n *   OrderingProvider.call(this, eventBus);\r\n *\r\n *   this.getOrdering = function(element, newParent) {\r\n *     // always insert elements at the front\r\n *     // when moving\r\n *     return {\r\n *       index: 0,\r\n *       parent: newParent\r\n *     };\r\n *   };\r\n * }\r\n * ```\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function OrderingProvider(eventBus) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n\r\n  var self = this;\r\n\r\n  this.preExecute([ 'shape.create', 'connection.create' ], function(event) {\r\n\r\n    var context = event.context,\r\n        element = context.shape || context.connection,\r\n        parent = context.parent;\r\n\r\n    var ordering = self.getOrdering(element, parent);\r\n\r\n    if (ordering) {\r\n\r\n      if (ordering.parent !== undefined) {\r\n        context.parent = ordering.parent;\r\n      }\r\n\r\n      context.parentIndex = ordering.index;\r\n    }\r\n  });\r\n\r\n  this.preExecute([ 'shape.move', 'connection.move' ], function(event) {\r\n\r\n    var context = event.context,\r\n        element = context.shape || context.connection,\r\n        parent = context.newParent || element.parent;\r\n\r\n    var ordering = self.getOrdering(element, parent);\r\n\r\n    if (ordering) {\r\n\r\n      if (ordering.parent !== undefined) {\r\n        context.newParent = ordering.parent;\r\n      }\r\n\r\n      context.newParentIndex = ordering.index;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Return a custom ordering of the element, both in terms\r\n * of parent element and index in the new parent.\r\n *\r\n * Implementors of this method must return an object with\r\n * `parent` _and_ `index` in it.\r\n *\r\n * @param {Element} element\r\n * @param {Shape} newParent\r\n *\r\n * @return {Object} ordering descriptor\r\n */\r\nOrderingProvider.prototype.getOrdering = function(element, newParent) {\r\n  return null;\r\n};\r\n\r\ninherits(OrderingProvider, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport OrderingProvider from 'diagram-js/lib/features/ordering/OrderingProvider';\n\nimport {\n  is,\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  findIndex,\n  find\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * A BPMN-specific ordering provider.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function BpmnOrderingProvider(eventBus, canvas) {\n\n  OrderingProvider.call(this, eventBus);\n\n  var orders = [\n    { type: 'bpmn:SubProcess', order: { level: 6 } },\n\n    // handle SequenceFlow(s) like message flows and render them always on top\n    {\n      type: 'bpmn:SequenceFlow',\n      order: {\n        level: 9,\n        containers: [\n          'bpmn:Participant',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n\n    // handle DataAssociation(s) like message flows and render them always on top\n    {\n      type: 'bpmn:DataAssociation',\n      order: {\n        level: 9,\n        containers: [\n          'bpmn:Collaboration',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n    {\n      type: 'bpmn:TextAnnotation',\n      order: {\n        level: 9\n      }\n    },\n    {\n      type: 'bpmn:MessageFlow', order: {\n        level: 9,\n        containers: [ 'bpmn:Collaboration' ]\n      }\n    },\n    {\n      type: 'bpmn:Association',\n      order: {\n        level: 6,\n        containers: [\n          'bpmn:Participant',\n          'bpmn:FlowElementsContainer',\n          'bpmn:Collaboration'\n        ]\n      }\n    },\n    { type: 'bpmn:BoundaryEvent', order: { level: 8 } },\n    {\n      type: 'bpmn:Group',\n      order: {\n        level: 10,\n        containers: [\n          'bpmn:Collaboration',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n    { type: 'bpmn:FlowElement', order: { level: 5 } },\n    { type: 'bpmn:Participant', order: { level: -2 } },\n    { type: 'bpmn:Lane', order: { level: -1 } }\n  ];\n\n  function computeOrder(element) {\n    if (element.labelTarget) {\n      return { level: 10 };\n    }\n\n    var entry = find(orders, function(o) {\n      return isAny(element, [ o.type ]);\n    });\n\n    return entry && entry.order || { level: 1 };\n  }\n\n  function getOrder(element) {\n\n    var order = element.order;\n\n    if (!order) {\n      element.order = order = computeOrder(element);\n    }\n\n    if (!order) {\n      throw new Error(`no order for <${ element.id }>`);\n    }\n\n    return order;\n  }\n\n  function findActualParent(element, newParent, containers) {\n\n    var actualParent = newParent;\n\n    while (actualParent) {\n\n      if (isAny(actualParent, containers)) {\n        break;\n      }\n\n      actualParent = actualParent.parent;\n    }\n\n    if (!actualParent) {\n      throw new Error(`no parent for <${ element.id }> in <${ newParent && newParent.id }>`);\n    }\n\n    return actualParent;\n  }\n\n  this.getOrdering = function(element, newParent) {\n\n    // render labels and text annotations always on top\n    if (element.labelTarget || is(element, 'bpmn:TextAnnotation')) {\n      return {\n        parent: canvas.findRoot(newParent) || canvas.getRootElement(),\n        index: -1\n      };\n    }\n\n    var elementOrder = getOrder(element);\n\n    if (elementOrder.containers) {\n      newParent = findActualParent(element, newParent, elementOrder.containers);\n    }\n\n    var currentIndex = newParent.children.indexOf(element);\n\n    var insertIndex = findIndex(newParent.children, function(child) {\n\n      // do not compare with labels, they are created\n      // in the wrong order (right after elements) during import and\n      // mess up the positioning.\n      if (!element.labelTarget && child.labelTarget) {\n        return false;\n      }\n\n      return elementOrder.level < getOrder(child).level;\n    });\n\n\n    // if the element is already in the child list at\n    // a smaller index, we need to adjust the insert index.\n    // this takes into account that the element is being removed\n    // before being re-inserted\n    if (insertIndex !== -1) {\n      if (currentIndex !== -1 && currentIndex < insertIndex) {\n        insertIndex -= 1;\n      }\n    }\n\n    return {\n      index: insertIndex,\n      parent: newParent\n    };\n  };\n}\n\nBpmnOrderingProvider.$inject = [ 'eventBus', 'canvas' ];\n\ninherits(BpmnOrderingProvider, OrderingProvider);","import BpmnOrderingProvider from './BpmnOrderingProvider';\n\nexport default {\n  __init__: [ 'bpmnOrderingProvider' ],\n  bpmnOrderingProvider: [ 'type', BpmnOrderingProvider ]\n};","/**\r\n * A clip board stub\r\n */\r\nexport default function Clipboard() {}\r\n\r\n\r\nClipboard.prototype.get = function() {\r\n  return this._data;\r\n};\r\n\r\nClipboard.prototype.set = function(data) {\r\n  this._data = data;\r\n};\r\n\r\nClipboard.prototype.clear = function() {\r\n  var data = this._data;\r\n\r\n  delete this._data;\r\n\r\n  return data;\r\n};\r\n\r\nClipboard.prototype.isEmpty = function() {\r\n  return !this._data;\r\n};","import Clipboard from './Clipboard';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  clipboard: [ 'type', Clipboard ]\r\n};\r\n","var MARKER_OK = 'drop-ok',\r\n    MARKER_NOT_OK = 'drop-not-ok',\r\n    MARKER_ATTACH = 'attach-ok',\r\n    MARKER_NEW_PARENT = 'new-parent';\r\n\r\nimport {\r\n  assign,\r\n  filter,\r\n  find,\r\n  forEach,\r\n  isArray,\r\n  isNumber,\r\n  map\r\n} from 'min-dash';\r\n\r\nimport { getBBox } from '../../util/Elements';\r\n\r\nimport {\r\n  isConnection,\r\n  isLabel\r\n} from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ElementLike} Element\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n */\r\n\r\nvar PREFIX = 'create';\r\n\r\nvar HIGH_PRIORITY = 2000;\r\n\r\n\r\n/**\r\n * Create new elements through drag and drop.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {Dragging} dragging\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n * @param {Rules} rules\r\n */\r\nexport default function Create(\r\n    canvas,\r\n    dragging,\r\n    eventBus,\r\n    modeling,\r\n    rules\r\n) {\r\n\r\n  // rules //////////\r\n\r\n  /**\r\n   * Check wether elements can be created.\r\n   *\r\n   * @param {Element[]} elements\r\n   * @param {Shape} target\r\n   * @param {Point} position\r\n   * @param {Element} [source]\r\n   *\r\n   * @return {boolean|null|Object}\r\n   */\r\n  function canCreate(elements, target, position, source, hints) {\r\n    if (!target) {\r\n      return false;\r\n    }\r\n\r\n    // ignore child elements and external labels\r\n    elements = filter(elements, function(element) {\r\n      var labelTarget = element.labelTarget;\r\n\r\n      return !element.parent && !(isLabel(element) && elements.indexOf(labelTarget) !== -1);\r\n    });\r\n\r\n    var shape = find(elements, function(element) {\r\n      return !isConnection(element);\r\n    });\r\n\r\n    var attach = false,\r\n        connect = false,\r\n        create = false;\r\n\r\n    // (1) attaching single shapes\r\n    if (isSingleShape(elements)) {\r\n      attach = rules.allowed('shape.attach', {\r\n        position: position,\r\n        shape: shape,\r\n        target: target\r\n      });\r\n    }\r\n\r\n    if (!attach) {\r\n\r\n      // (2) creating elements\r\n      if (isSingleShape(elements)) {\r\n        create = rules.allowed('shape.create', {\r\n          position: position,\r\n          shape: shape,\r\n          source: source,\r\n          target: target\r\n        });\r\n      } else {\r\n        create = rules.allowed('elements.create', {\r\n          elements: elements,\r\n          position: position,\r\n          target: target\r\n        });\r\n      }\r\n\r\n    }\r\n\r\n    var connectionTarget = hints.connectionTarget;\r\n\r\n    // (3) appending single shapes\r\n    if (create || attach) {\r\n      if (shape && source) {\r\n        connect = rules.allowed('connection.create', {\r\n          source: connectionTarget === source ? shape : source,\r\n          target: connectionTarget === source ? source : shape,\r\n          hints: {\r\n            targetParent: target,\r\n            targetAttach: attach\r\n          }\r\n        });\r\n      }\r\n\r\n      return {\r\n        attach: attach,\r\n        connect: connect\r\n      };\r\n    }\r\n\r\n    // ignore wether or not elements can be created\r\n    if (create === null || attach === null) {\r\n      return null;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  function setMarker(element, marker) {\r\n    [ MARKER_ATTACH, MARKER_OK, MARKER_NOT_OK, MARKER_NEW_PARENT ].forEach(function(m) {\r\n\r\n      if (m === marker) {\r\n        canvas.addMarker(element, m);\r\n      } else {\r\n        canvas.removeMarker(element, m);\r\n      }\r\n    });\r\n  }\r\n\r\n  // event handling //////////\r\n\r\n  eventBus.on([ 'create.move', 'create.hover' ], function(event) {\r\n    var context = event.context,\r\n        elements = context.elements,\r\n        hover = event.hover,\r\n        source = context.source,\r\n        hints = context.hints || {};\r\n\r\n    if (!hover) {\r\n      context.canExecute = false;\r\n      context.target = null;\r\n\r\n      return;\r\n    }\r\n\r\n    ensureConstraints(event);\r\n\r\n    var position = {\r\n      x: event.x,\r\n      y: event.y\r\n    };\r\n\r\n    var canExecute = context.canExecute = hover && canCreate(elements, hover, position, source, hints);\r\n\r\n    if (hover && canExecute !== null) {\r\n      context.target = hover;\r\n\r\n      if (canExecute && canExecute.attach) {\r\n        setMarker(hover, MARKER_ATTACH);\r\n      } else {\r\n        setMarker(hover, canExecute ? MARKER_NEW_PARENT : MARKER_NOT_OK);\r\n      }\r\n    }\r\n  });\r\n\r\n  eventBus.on([ 'create.end', 'create.out', 'create.cleanup' ], function(event) {\r\n    var hover = event.hover;\r\n\r\n    if (hover) {\r\n      setMarker(hover, null);\r\n    }\r\n  });\r\n\r\n  eventBus.on('create.end', function(event) {\r\n    var context = event.context,\r\n        source = context.source,\r\n        shape = context.shape,\r\n        elements = context.elements,\r\n        target = context.target,\r\n        canExecute = context.canExecute,\r\n        attach = canExecute && canExecute.attach,\r\n        connect = canExecute && canExecute.connect,\r\n        hints = context.hints || {};\r\n\r\n    if (canExecute === false || !target) {\r\n      return false;\r\n    }\r\n\r\n    ensureConstraints(event);\r\n\r\n    var position = {\r\n      x: event.x,\r\n      y: event.y\r\n    };\r\n\r\n    if (connect) {\r\n      shape = modeling.appendShape(source, shape, position, target, {\r\n        attach: attach,\r\n        connection: connect === true ? {} : connect,\r\n        connectionTarget: hints.connectionTarget\r\n      });\r\n    } else {\r\n      elements = modeling.createElements(elements, position, target, assign({}, hints, {\r\n        attach: attach\r\n      }));\r\n\r\n      // update shape\r\n      shape = find(elements, function(element) {\r\n        return !isConnection(element);\r\n      });\r\n    }\r\n\r\n    // update elements and shape\r\n    assign(context, {\r\n      elements: elements,\r\n      shape: shape\r\n    });\r\n\r\n    assign(event, {\r\n      elements: elements,\r\n      shape: shape\r\n    });\r\n  });\r\n\r\n  function cancel() {\r\n    var context = dragging.context();\r\n\r\n    if (context && context.prefix === PREFIX) {\r\n      dragging.cancel();\r\n    }\r\n  }\r\n\r\n  // cancel on <elements.changed> that is not result of <drag.end>\r\n  eventBus.on('create.init', function() {\r\n    eventBus.on('elements.changed', cancel);\r\n\r\n    eventBus.once([ 'create.cancel', 'create.end' ], HIGH_PRIORITY, function() {\r\n      eventBus.off('elements.changed', cancel);\r\n    });\r\n  });\r\n\r\n  // API //////////\r\n\r\n  /**\r\n   * @param event\r\n   * @param elements\r\n   * @param {any} [context={}]\r\n   */\r\n  this.start = function(event, elements, context) {\r\n    if (!isArray(elements)) {\r\n      elements = [ elements ];\r\n    }\r\n\r\n    var shape = find(elements, function(element) {\r\n      return !isConnection(element);\r\n    });\r\n\r\n    if (!shape) {\r\n\r\n      // at least one shape is required\r\n      return;\r\n    }\r\n\r\n    context = assign({\r\n      elements: elements,\r\n      hints: {},\r\n      shape: shape\r\n    }, context || {});\r\n\r\n    // make sure each element has x and y\r\n    forEach(elements, function(element) {\r\n      if (!isNumber(element.x)) {\r\n        element.x = 0;\r\n      }\r\n\r\n      if (!isNumber(element.y)) {\r\n        element.y = 0;\r\n      }\r\n    });\r\n\r\n    var visibleElements = filter(elements, function(element) {\r\n      return !element.hidden;\r\n    });\r\n\r\n    var bbox = getBBox(visibleElements);\r\n\r\n    // center elements around cursor\r\n    forEach(elements, function(element) {\r\n      if (isConnection(element)) {\r\n        element.waypoints = map(element.waypoints, function(waypoint) {\r\n          return {\r\n            x: waypoint.x - bbox.x - bbox.width / 2,\r\n            y: waypoint.y - bbox.y - bbox.height / 2\r\n          };\r\n        });\r\n      }\r\n\r\n      assign(element, {\r\n        x: element.x - bbox.x - bbox.width / 2,\r\n        y: element.y - bbox.y - bbox.height / 2\r\n      });\r\n    });\r\n\r\n    dragging.init(event, PREFIX, {\r\n      cursor: 'grabbing',\r\n      autoActivate: true,\r\n      data: {\r\n        shape: shape,\r\n        elements: elements,\r\n        context: context\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nCreate.$inject = [\r\n  'canvas',\r\n  'dragging',\r\n  'eventBus',\r\n  'modeling',\r\n  'rules'\r\n];\r\n\r\n// helpers //////////\r\n\r\nfunction ensureConstraints(event) {\r\n  var context = event.context,\r\n      createConstraints = context.createConstraints;\r\n\r\n  if (!createConstraints) {\r\n    return;\r\n  }\r\n\r\n  if (createConstraints.left) {\r\n    event.x = Math.max(event.x, createConstraints.left);\r\n  }\r\n\r\n  if (createConstraints.right) {\r\n    event.x = Math.min(event.x, createConstraints.right);\r\n  }\r\n\r\n  if (createConstraints.top) {\r\n    event.y = Math.max(event.y, createConstraints.top);\r\n  }\r\n\r\n  if (createConstraints.bottom) {\r\n    event.y = Math.min(event.y, createConstraints.bottom);\r\n  }\r\n}\r\n\r\nfunction isSingleShape(elements) {\r\n  return elements && elements.length === 1 && !isConnection(elements[ 0 ]);\r\n}","import {\r\n  translate\r\n} from '../../util/SvgTransformUtil';\r\n\r\nimport { getVisual } from '../../util/GraphicsUtil';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../core/GraphicsFactory').default} GraphicsFactory\r\n * @typedef {import('../preview-support/PreviewSupport').default} PreviewSupport\r\n * @typedef {import('../../draw/Styles').default} Styles\r\n */\r\n\r\nvar LOW_PRIORITY = 750;\r\n\r\n/**\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n * @param {GraphicsFactory} graphicsFactory\r\n * @param {PreviewSupport} previewSupport\r\n * @param {Styles} styles\r\n */\r\nexport default function CreatePreview(\r\n    canvas,\r\n    eventBus,\r\n    graphicsFactory,\r\n    previewSupport,\r\n    styles\r\n) {\r\n  function createDragGroup(elements) {\r\n    var dragGroup = svgCreate('g');\r\n\r\n    svgAttr(dragGroup, styles.cls('djs-drag-group', [ 'no-events' ]));\r\n\r\n    var childrenGfx = svgCreate('g');\r\n\r\n    elements.forEach(function(element) {\r\n\r\n      // create graphics\r\n      var gfx;\r\n\r\n      if (element.hidden) {\r\n        return;\r\n      }\r\n\r\n      if (element.waypoints) {\r\n        gfx = graphicsFactory._createContainer('connection', childrenGfx);\r\n\r\n        graphicsFactory.drawConnection(getVisual(gfx), element);\r\n      } else {\r\n        gfx = graphicsFactory._createContainer('shape', childrenGfx);\r\n\r\n        graphicsFactory.drawShape(getVisual(gfx), element);\r\n\r\n        translate(gfx, element.x, element.y);\r\n      }\r\n\r\n      // add preview\r\n      previewSupport.addDragger(element, dragGroup, gfx);\r\n    });\r\n\r\n    return dragGroup;\r\n  }\r\n\r\n  eventBus.on('create.move', LOW_PRIORITY, function(event) {\r\n\r\n    var hover = event.hover,\r\n        context = event.context,\r\n        elements = context.elements,\r\n        dragGroup = context.dragGroup;\r\n\r\n    // lazily create previews\r\n    if (!dragGroup) {\r\n      dragGroup = context.dragGroup = createDragGroup(elements);\r\n    }\r\n\r\n    var activeLayer;\r\n\r\n    if (hover) {\r\n      if (!dragGroup.parentNode) {\r\n        activeLayer = canvas.getActiveLayer();\r\n\r\n        svgAppend(activeLayer, dragGroup);\r\n      }\r\n\r\n      translate(dragGroup, event.x, event.y);\r\n    } else {\r\n      svgRemove(dragGroup);\r\n    }\r\n  });\r\n\r\n  eventBus.on('create.cleanup', function(event) {\r\n    var context = event.context,\r\n        dragGroup = context.dragGroup;\r\n\r\n    if (dragGroup) {\r\n      svgRemove(dragGroup);\r\n    }\r\n  });\r\n}\r\n\r\nCreatePreview.$inject = [\r\n  'canvas',\r\n  'eventBus',\r\n  'graphicsFactory',\r\n  'previewSupport',\r\n  'styles'\r\n];\r\n","import DraggingModule from '../dragging';\r\nimport PreviewSupportModule from '../preview-support';\r\nimport RulesModule from '../rules';\r\nimport SelectionModule from '../selection';\r\n\r\nimport Create from './Create';\r\nimport CreatePreview from './CreatePreview';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    DraggingModule,\r\n    PreviewSupportModule,\r\n    RulesModule,\r\n    SelectionModule\r\n  ],\r\n  __init__: [\r\n    'create',\r\n    'createPreview'\r\n  ],\r\n  create: [ 'type', Create ],\r\n  createPreview: [ 'type', CreatePreview ]\r\n};\r\n","/**\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function Mouse(eventBus) {\r\n  var self = this;\r\n\r\n  this._lastMoveEvent = null;\r\n\r\n  function setLastMoveEvent(mousemoveEvent) {\r\n    self._lastMoveEvent = mousemoveEvent;\r\n  }\r\n\r\n  eventBus.on('canvas.init', function(context) {\r\n    var svg = self._svg = context.svg;\r\n\r\n    svg.addEventListener('mousemove', setLastMoveEvent);\r\n  });\r\n\r\n  eventBus.on('canvas.destroy', function() {\r\n    self._lastMouseEvent = null;\r\n\r\n    self._svg.removeEventListener('mousemove', setLastMoveEvent);\r\n  });\r\n}\r\n\r\nMouse.$inject = [ 'eventBus' ];\r\n\r\nMouse.prototype.getLastMoveEvent = function() {\r\n  return this._lastMoveEvent || createMoveEvent(0, 0);\r\n};\r\n\r\n// helpers //////////\r\n\r\nexport function createMoveEvent(x, y) {\r\n  var event = document.createEvent('MouseEvent');\r\n\r\n  var screenX = x,\r\n      screenY = y,\r\n      clientX = x,\r\n      clientY = y;\r\n\r\n  if (event.initMouseEvent) {\r\n    event.initMouseEvent(\r\n      'mousemove',\r\n      true,\r\n      true,\r\n      window,\r\n      0,\r\n      screenX,\r\n      screenY,\r\n      clientX,\r\n      clientY,\r\n      false,\r\n      false,\r\n      false,\r\n      false,\r\n      0,\r\n      null\r\n    );\r\n  }\r\n\r\n  return event;\r\n}","import Mouse from './Mouse';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'mouse' ],\r\n  mouse: [ 'type', Mouse ]\r\n};\r\n","import {\r\n  assign,\r\n  find,\r\n  forEach,\r\n  isArray,\r\n  isNumber,\r\n  map,\r\n  matchPattern,\r\n  omit,\r\n  sortBy\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getBBox,\r\n  getParents\r\n} from '../../util/Elements';\r\n\r\nimport { eachElement } from '../../util/Elements';\r\n\r\nimport {\r\n  isConnection,\r\n  isLabel\r\n} from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ElementLike} Element\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../clipboard/Clipboard').default} Clipboard\r\n * @typedef {import('../create/Create').default} Create\r\n * @typedef {import('../../core/ElementFactory').default} ElementFactory\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../mouse/Mouse').default} Mouse\r\n * @typedef {import('../rules/Rules').default} Rules\r\n */\r\n\r\n/**\r\n * @typedef { (event: { elements: Element[] }) => Element[]|boolean } CopyPasteCanCopyElementsListener\r\n */\r\n\r\n/**\r\n * @typedef { (event: { descriptor: any, element: Element, elements: Element[] }) => void } CopyPasteCopyElementListener\r\n */\r\n\r\n/**\r\n * @typedef { (event: { element: Element, children: Element[] }) => void } CopyPasteCreateTreeListener\r\n */\r\n\r\n/**\r\n * @typedef { (event: { elements: any, tree: any }) => void } CopyPasteElementsCopiedListener\r\n */\r\n\r\n/**\r\n * @typedef { (event: { cache: any, descriptor: any }) => void } CopyPastePasteElementListener\r\n */\r\n\r\n/**\r\n * @typedef { (event: { hints: any }) => void } CopyPastePasteElementsListener\r\n */\r\n\r\n/**\r\n * Copy and paste elements.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {Create} create\r\n * @param {Clipboard} clipboard\r\n * @param {ElementFactory} elementFactory\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n * @param {Mouse} mouse\r\n * @param {Rules} rules\r\n */\r\nexport default function CopyPaste(\r\n    canvas,\r\n    create,\r\n    clipboard,\r\n    elementFactory,\r\n    eventBus,\r\n    modeling,\r\n    mouse,\r\n    rules\r\n) {\r\n\r\n  this._canvas = canvas;\r\n  this._create = create;\r\n  this._clipboard = clipboard;\r\n  this._elementFactory = elementFactory;\r\n  this._eventBus = eventBus;\r\n  this._modeling = modeling;\r\n  this._mouse = mouse;\r\n  this._rules = rules;\r\n\r\n  eventBus.on('copyPaste.copyElement', function(context) {\r\n    var descriptor = context.descriptor,\r\n        element = context.element,\r\n        elements = context.elements;\r\n\r\n    // default priority (priority = 1)\r\n    descriptor.priority = 1;\r\n\r\n    descriptor.id = element.id;\r\n\r\n    var parentCopied = find(elements, function(e) {\r\n      return e === element.parent;\r\n    });\r\n\r\n    // do NOT reference parent if parent wasn't copied\r\n    if (parentCopied) {\r\n      descriptor.parent = element.parent.id;\r\n    }\r\n\r\n    // attachers (priority = 2)\r\n    if (isAttacher(element)) {\r\n      descriptor.priority = 2;\r\n\r\n      descriptor.host = element.host.id;\r\n    }\r\n\r\n    // connections (priority = 3)\r\n    if (isConnection(element)) {\r\n      descriptor.priority = 3;\r\n\r\n      descriptor.source = element.source.id;\r\n      descriptor.target = element.target.id;\r\n\r\n      descriptor.waypoints = copyWaypoints(element);\r\n    }\r\n\r\n    // labels (priority = 4)\r\n    if (isLabel(element)) {\r\n      descriptor.priority = 4;\r\n\r\n      descriptor.labelTarget = element.labelTarget.id;\r\n    }\r\n\r\n    forEach([ 'x', 'y', 'width', 'height' ], function(property) {\r\n      if (isNumber(element[ property ])) {\r\n        descriptor[ property ] = element[ property ];\r\n      }\r\n    });\r\n\r\n    descriptor.hidden = element.hidden;\r\n    descriptor.collapsed = element.collapsed;\r\n\r\n  });\r\n\r\n  eventBus.on('copyPaste.pasteElements', function(context) {\r\n    var hints = context.hints;\r\n\r\n    assign(hints, {\r\n      createElementsBehavior: false\r\n    });\r\n  });\r\n}\r\n\r\nCopyPaste.$inject = [\r\n  'canvas',\r\n  'create',\r\n  'clipboard',\r\n  'elementFactory',\r\n  'eventBus',\r\n  'modeling',\r\n  'mouse',\r\n  'rules'\r\n];\r\n\r\n\r\n/**\r\n * Copy elements.\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {Object}\r\n */\r\nCopyPaste.prototype.copy = function(elements) {\r\n  var allowed,\r\n      tree;\r\n\r\n  if (!isArray(elements)) {\r\n    elements = elements ? [ elements ] : [];\r\n  }\r\n\r\n  allowed = this._eventBus.fire('copyPaste.canCopyElements', {\r\n    elements: elements\r\n  });\r\n\r\n  if (allowed === false) {\r\n    tree = {};\r\n  } else {\r\n    tree = this.createTree(isArray(allowed) ? allowed : elements);\r\n  }\r\n\r\n  // we set an empty tree, selection of elements\r\n  // to copy was empty.\r\n  this._clipboard.set(tree);\r\n\r\n  this._eventBus.fire('copyPaste.elementsCopied', {\r\n    elements: elements,\r\n    tree: tree\r\n  });\r\n\r\n  return tree;\r\n};\r\n\r\n/**\r\n * Paste elements.\r\n *\r\n * @param {Object} [context]\r\n * @param {Shape} [context.element] The optional parent.\r\n * @param {Point} [context.point] The optional position.\r\n * @param {Object} [context.hints] The optional hints.\r\n */\r\nCopyPaste.prototype.paste = function(context) {\r\n  var tree = this._clipboard.get();\r\n\r\n  if (this._clipboard.isEmpty()) {\r\n    return;\r\n  }\r\n\r\n  var hints = context && context.hints || {};\r\n\r\n  this._eventBus.fire('copyPaste.pasteElements', {\r\n    hints: hints\r\n  });\r\n\r\n  var elements = this._createElements(tree);\r\n\r\n  // paste directly\r\n  if (context && context.element && context.point) {\r\n    return this._paste(elements, context.element, context.point, hints);\r\n  }\r\n\r\n  this._create.start(this._mouse.getLastMoveEvent(), elements, {\r\n    hints: hints || {}\r\n  });\r\n};\r\n\r\n/**\r\n * Paste elements directly.\r\n *\r\n * @param {Element[]} elements\r\n * @param {Shape} target\r\n * @param {Point} position\r\n * @param {Object} [hints]\r\n */\r\nCopyPaste.prototype._paste = function(elements, target, position, hints) {\r\n\r\n  // make sure each element has x and y\r\n  forEach(elements, function(element) {\r\n    if (!isNumber(element.x)) {\r\n      element.x = 0;\r\n    }\r\n\r\n    if (!isNumber(element.y)) {\r\n      element.y = 0;\r\n    }\r\n  });\r\n\r\n  var bbox = getBBox(elements);\r\n\r\n  // center elements around cursor\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      element.waypoints = map(element.waypoints, function(waypoint) {\r\n        return {\r\n          x: waypoint.x - bbox.x - bbox.width / 2,\r\n          y: waypoint.y - bbox.y - bbox.height / 2\r\n        };\r\n      });\r\n    }\r\n\r\n    assign(element, {\r\n      x: element.x - bbox.x - bbox.width / 2,\r\n      y: element.y - bbox.y - bbox.height / 2\r\n    });\r\n  });\r\n\r\n  return this._modeling.createElements(elements, position, target, assign({}, hints));\r\n};\r\n\r\n/**\r\n * Create elements from tree.\r\n */\r\nCopyPaste.prototype._createElements = function(tree) {\r\n  var self = this;\r\n\r\n  var eventBus = this._eventBus;\r\n\r\n  var cache = {};\r\n\r\n  var elements = [];\r\n\r\n  forEach(tree, function(branch, depth) {\r\n\r\n    depth = parseInt(depth, 10);\r\n\r\n    // sort by priority\r\n    branch = sortBy(branch, 'priority');\r\n\r\n    forEach(branch, function(descriptor) {\r\n\r\n      // remove priority\r\n      var attrs = assign({}, omit(descriptor, [ 'priority' ]));\r\n\r\n      if (cache[ descriptor.parent ]) {\r\n        attrs.parent = cache[ descriptor.parent ];\r\n      } else {\r\n        delete attrs.parent;\r\n      }\r\n\r\n      eventBus.fire('copyPaste.pasteElement', {\r\n        cache: cache,\r\n        descriptor: attrs\r\n      });\r\n\r\n      var element;\r\n\r\n      if (isConnection(attrs)) {\r\n        attrs.source = cache[ descriptor.source ];\r\n        attrs.target = cache[ descriptor.target ];\r\n\r\n        element = cache[ descriptor.id ] = self.createConnection(attrs);\r\n\r\n        elements.push(element);\r\n\r\n        return;\r\n      }\r\n\r\n      if (isLabel(attrs)) {\r\n        attrs.labelTarget = cache[ attrs.labelTarget ];\r\n\r\n        element = cache[ descriptor.id ] = self.createLabel(attrs);\r\n\r\n        elements.push(element);\r\n\r\n        return;\r\n      }\r\n\r\n      if (attrs.host) {\r\n        attrs.host = cache[ attrs.host ];\r\n      }\r\n\r\n      element = cache[ descriptor.id ] = self.createShape(attrs);\r\n\r\n      elements.push(element);\r\n    });\r\n\r\n  });\r\n\r\n  return elements;\r\n};\r\n\r\nCopyPaste.prototype.createConnection = function(attrs) {\r\n  var connection = this._elementFactory.createConnection(omit(attrs, [ 'id' ]));\r\n\r\n  return connection;\r\n};\r\n\r\nCopyPaste.prototype.createLabel = function(attrs) {\r\n  var label = this._elementFactory.createLabel(omit(attrs, [ 'id' ]));\r\n\r\n  return label;\r\n};\r\n\r\nCopyPaste.prototype.createShape = function(attrs) {\r\n  var shape = this._elementFactory.createShape(omit(attrs, [ 'id' ]));\r\n\r\n  return shape;\r\n};\r\n\r\n/**\r\n * Check wether element has relations to other elements e.g. attachers, labels and connections.\r\n *\r\n * @param {Object} element\r\n * @param {Element[]} elements\r\n *\r\n * @return {boolean}\r\n */\r\nCopyPaste.prototype.hasRelations = function(element, elements) {\r\n  var labelTarget,\r\n      source,\r\n      target;\r\n\r\n  if (isConnection(element)) {\r\n    source = find(elements, matchPattern({ id: element.source.id }));\r\n    target = find(elements, matchPattern({ id: element.target.id }));\r\n\r\n    if (!source || !target) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  if (isLabel(element)) {\r\n    labelTarget = find(elements, matchPattern({ id: element.labelTarget.id }));\r\n\r\n    if (!labelTarget) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * Create a tree-like structure from elements.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * tree: {\r\n *  0: [\r\n *    { id: 'Shape_1', priority: 1, ... },\r\n *    { id: 'Shape_2', priority: 1, ... },\r\n *    { id: 'Connection_1', source: 'Shape_1', target: 'Shape_2', priority: 3, ... },\r\n *    ...\r\n *  ],\r\n *  1: [\r\n *    { id: 'Shape_3', parent: 'Shape1', priority: 1, ... },\r\n *    ...\r\n *  ]\r\n * };\r\n * ```\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {Object}\r\n */\r\nCopyPaste.prototype.createTree = function(elements) {\r\n  var rules = this._rules,\r\n      self = this;\r\n\r\n  var tree = {},\r\n      elementsData = [];\r\n\r\n  var parents = getParents(elements);\r\n\r\n  function canCopy(element, elements) {\r\n    return rules.allowed('element.copy', {\r\n      element: element,\r\n      elements: elements\r\n    });\r\n  }\r\n\r\n  function addElementData(element, depth) {\r\n\r\n    // (1) check wether element has already been added\r\n    var foundElementData = find(elementsData, function(elementsData) {\r\n      return element === elementsData.element;\r\n    });\r\n\r\n    // (2) add element if not already added\r\n    if (!foundElementData) {\r\n      elementsData.push({\r\n        element: element,\r\n        depth: depth\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    // (3) update depth\r\n    if (foundElementData.depth < depth) {\r\n      elementsData = removeElementData(foundElementData, elementsData);\r\n\r\n      elementsData.push({\r\n        element: foundElementData.element,\r\n        depth: depth\r\n      });\r\n    }\r\n  }\r\n\r\n  function removeElementData(elementData, elementsData) {\r\n    var index = elementsData.indexOf(elementData);\r\n\r\n    if (index !== -1) {\r\n      elementsData.splice(index, 1);\r\n    }\r\n\r\n    return elementsData;\r\n  }\r\n\r\n  // (1) add elements\r\n  eachElement(parents, function(element, _index, depth) {\r\n\r\n    // do NOT add external labels directly\r\n    if (isLabel(element)) {\r\n      return;\r\n    }\r\n\r\n    // always copy external labels\r\n    forEach(element.labels, function(label) {\r\n      addElementData(label, depth);\r\n    });\r\n\r\n    function addRelatedElements(elements) {\r\n      elements && elements.length && forEach(elements, function(element) {\r\n\r\n        // add external labels\r\n        forEach(element.labels, function(label) {\r\n          addElementData(label, depth);\r\n        });\r\n\r\n        addElementData(element, depth);\r\n      });\r\n    }\r\n\r\n    forEach([ element.attachers, element.incoming, element.outgoing ], addRelatedElements);\r\n\r\n    addElementData(element, depth);\r\n\r\n    var children = [];\r\n\r\n    if (element.children) {\r\n      children = element.children.slice();\r\n    }\r\n\r\n    // allow others to add children to tree\r\n    self._eventBus.fire('copyPaste.createTree', {\r\n      element: element,\r\n      children: children\r\n    });\r\n\r\n    return children;\r\n  });\r\n\r\n  elements = map(elementsData, function(elementData) {\r\n    return elementData.element;\r\n  });\r\n\r\n  // (2) copy elements\r\n  elementsData = map(elementsData, function(elementData) {\r\n    elementData.descriptor = {};\r\n\r\n    self._eventBus.fire('copyPaste.copyElement', {\r\n      descriptor: elementData.descriptor,\r\n      element: elementData.element,\r\n      elements: elements\r\n    });\r\n\r\n    return elementData;\r\n  });\r\n\r\n  // (3) sort elements by priority\r\n  elementsData = sortBy(elementsData, function(elementData) {\r\n    return elementData.descriptor.priority;\r\n  });\r\n\r\n  elements = map(elementsData, function(elementData) {\r\n    return elementData.element;\r\n  });\r\n\r\n  // (4) create tree\r\n  forEach(elementsData, function(elementData) {\r\n    var depth = elementData.depth;\r\n\r\n    if (!self.hasRelations(elementData.element, elements)) {\r\n      removeElement(elementData.element, elements);\r\n\r\n      return;\r\n    }\r\n\r\n    if (!canCopy(elementData.element, elements)) {\r\n      removeElement(elementData.element, elements);\r\n\r\n      return;\r\n    }\r\n\r\n    if (!tree[depth]) {\r\n      tree[depth] = [];\r\n    }\r\n\r\n    tree[depth].push(elementData.descriptor);\r\n  });\r\n\r\n  return tree;\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction isAttacher(element) {\r\n  return !!element.host;\r\n}\r\n\r\nfunction copyWaypoints(element) {\r\n  return map(element.waypoints, function(waypoint) {\r\n\r\n    waypoint = copyWaypoint(waypoint);\r\n\r\n    if (waypoint.original) {\r\n      waypoint.original = copyWaypoint(waypoint.original);\r\n    }\r\n\r\n    return waypoint;\r\n  });\r\n}\r\n\r\nfunction copyWaypoint(waypoint) {\r\n  return assign({}, waypoint);\r\n}\r\n\r\nfunction removeElement(element, elements) {\r\n  var index = elements.indexOf(element);\r\n\r\n  if (index === -1) {\r\n    return elements;\r\n  }\r\n\r\n  return elements.splice(index, 1);\r\n}","import ClipboardModule from '../clipboard';\r\nimport CreateModule from '../create';\r\nimport MouseModule from '../mouse';\r\nimport RulesModule from '../rules';\r\n\r\nimport CopyPaste from './CopyPaste';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    ClipboardModule,\r\n    CreateModule,\r\n    MouseModule,\r\n    RulesModule\r\n  ],\r\n  __init__: [ 'copyPaste' ],\r\n  copyPaste: [ 'type', CopyPaste ]\r\n};\r\n","import {\n  getBusinessObject,\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  forEach,\n  isArray,\n  isUndefined,\n  omit,\n  reduce\n} from 'min-dash';\n\nimport { isLabel } from '../../util/LabelUtil';\n\n/**\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('./ModdleCopy').default} ModdleCopy\n */\n\nfunction copyProperties(source, target, properties) {\n  if (!isArray(properties)) {\n    properties = [ properties ];\n  }\n\n  forEach(properties, function(property) {\n    if (!isUndefined(source[property])) {\n      target[property] = source[property];\n    }\n  });\n}\n\nvar LOW_PRIORITY = 750;\n\n/**\n * BPMN-specific copy & paste.\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {EventBus} eventBus\n * @param {ModdleCopy} moddleCopy\n */\nexport default function BpmnCopyPaste(bpmnFactory, eventBus, moddleCopy) {\n\n  function copy(bo, clone) {\n    var targetBo = bpmnFactory.create(bo.$type);\n\n    return moddleCopy.copyElement(bo, targetBo, null, clone);\n  }\n\n  eventBus.on('copyPaste.copyElement', LOW_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        element = context.element,\n        businessObject = getBusinessObject(element);\n\n    // do not copy business object + di for labels;\n    // will be pulled from the referenced label target\n    if (isLabel(element)) {\n      return descriptor;\n    }\n\n    var businessObjectCopy = descriptor.businessObject = copy(businessObject, true);\n    var diCopy = descriptor.di = copy(getDi(element), true);\n    diCopy.bpmnElement = businessObjectCopy;\n\n    copyProperties(businessObjectCopy, descriptor, 'name');\n    copyProperties(diCopy, descriptor, 'isExpanded');\n\n    // default sequence flow\n    if (businessObject.default) {\n      descriptor.default = businessObject.default.id;\n    }\n  });\n\n  var referencesKey = '-bpmn-js-refs';\n\n  function getReferences(cache) {\n    return (cache[referencesKey] = cache[referencesKey] || {});\n  }\n\n  function setReferences(cache, references) {\n    cache[referencesKey] = references;\n  }\n\n  function resolveReferences(descriptor, cache, references) {\n    var businessObject = getBusinessObject(descriptor);\n\n    // default sequence flows\n    if (descriptor.default) {\n\n      // relationship cannot be resolved immediately\n      references[ descriptor.default ] = {\n        element: businessObject,\n        property: 'default'\n      };\n    }\n\n    // boundary events\n    if (descriptor.host) {\n\n      // relationship can be resolved immediately\n      getBusinessObject(descriptor).attachedToRef = getBusinessObject(cache[ descriptor.host ]);\n    }\n\n    return omit(references, reduce(references, function(array, reference, key) {\n      var element = reference.element,\n          property = reference.property;\n\n      if (key === descriptor.id) {\n        element.set(property, businessObject);\n\n        array.push(descriptor.id);\n      }\n\n      return array;\n    }, []));\n  }\n\n  eventBus.on('copyPaste.pasteElement', function(context) {\n    var cache = context.cache,\n        descriptor = context.descriptor,\n        businessObject = descriptor.businessObject,\n        di = descriptor.di;\n\n    // wire existing di + businessObject for external label\n    if (isLabel(descriptor)) {\n      descriptor.businessObject = getBusinessObject(cache[ descriptor.labelTarget ]);\n      descriptor.di = getDi(cache[ descriptor.labelTarget ]);\n\n      return;\n    }\n\n    businessObject = descriptor.businessObject = copy(businessObject);\n\n    di = descriptor.di = copy(di);\n    di.bpmnElement = businessObject;\n\n    copyProperties(descriptor, businessObject, [\n      'isExpanded',\n      'name'\n    ]);\n\n    descriptor.type = businessObject.$type;\n  });\n\n  // copy + paste processRef with participant\n\n  eventBus.on('copyPaste.copyElement', LOW_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        element = context.element;\n\n    if (!is(element, 'bpmn:Participant')) {\n      return;\n    }\n\n    var participantBo = getBusinessObject(element);\n\n    if (participantBo.processRef) {\n      descriptor.processRef = copy(participantBo.processRef, true);\n    }\n  });\n\n  eventBus.on('copyPaste.pasteElement', function(context) {\n    var descriptor = context.descriptor,\n        processRef = descriptor.processRef;\n\n    if (processRef) {\n      descriptor.processRef = copy(processRef);\n    }\n  });\n\n  // resolve references\n\n  eventBus.on('copyPaste.pasteElement', LOW_PRIORITY, function(context) {\n    var cache = context.cache,\n        descriptor = context.descriptor;\n\n    // resolve references e.g. default sequence flow\n    setReferences(\n      cache,\n      resolveReferences(descriptor, cache, getReferences(cache))\n    );\n  });\n\n}\n\n\nBpmnCopyPaste.$inject = [\n  'bpmnFactory',\n  'eventBus',\n  'moddleCopy'\n];","import {\n  find,\n  forEach,\n  has,\n  isArray,\n  isDefined,\n  isFunction,\n  isObject,\n  matchPattern,\n  reduce,\n  sortBy\n} from 'min-dash';\n\nvar DISALLOWED_PROPERTIES = [\n  'artifacts',\n  'dataInputAssociations',\n  'dataOutputAssociations',\n  'default',\n  'flowElements',\n  'lanes',\n  'incoming',\n  'outgoing',\n  'categoryValue'\n];\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('../../model/Types').Moddle} Moddle\n *\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * Utility for copying model properties from source element to target element.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n * @param {Moddle} moddle\n */\nexport default function ModdleCopy(eventBus, bpmnFactory, moddle) {\n  this._bpmnFactory = bpmnFactory;\n  this._eventBus = eventBus;\n  this._moddle = moddle;\n\n  // copy extension elements last\n  eventBus.on('moddleCopy.canCopyProperties', function(context) {\n    var propertyNames = context.propertyNames;\n\n    if (!propertyNames || !propertyNames.length) {\n      return;\n    }\n\n    return sortBy(propertyNames, function(propertyName) {\n      return propertyName === 'extensionElements';\n    });\n  });\n\n  // default check whether property can be copied\n  eventBus.on('moddleCopy.canCopyProperty', function(context) {\n    var parent = context.parent,\n        parentDescriptor = isObject(parent) && parent.$descriptor,\n        propertyName = context.propertyName;\n\n    if (propertyName && DISALLOWED_PROPERTIES.indexOf(propertyName) !== -1) {\n\n      // disallow copying property\n      return false;\n    }\n\n    if (propertyName &&\n      parentDescriptor &&\n      !find(parentDescriptor.properties, matchPattern({ name: propertyName }))) {\n\n      // disallow copying property\n      return false;\n    }\n  });\n\n  // do NOT allow to copy empty extension elements\n  eventBus.on('moddleCopy.canSetCopiedProperty', function(context) {\n    var property = context.property;\n\n    if (is(property, 'bpmn:ExtensionElements') && (!property.values || !property.values.length)) {\n\n      // disallow setting copied property\n      return false;\n    }\n  });\n}\n\nModdleCopy.$inject = [\n  'eventBus',\n  'bpmnFactory',\n  'moddle'\n];\n\n/**\n * Copy model properties of source element to target element.\n *\n * @param {ModdleElement} sourceElement\n * @param {ModdleElement} targetElement\n * @param {string[]} [propertyNames]\n * @param {boolean} [clone=false]\n *\n * @return {ModdleElement}\n */\nModdleCopy.prototype.copyElement = function(sourceElement, targetElement, propertyNames, clone = false) {\n  var self = this;\n\n  if (propertyNames && !isArray(propertyNames)) {\n    propertyNames = [ propertyNames ];\n  }\n\n  propertyNames = propertyNames || getPropertyNames(sourceElement.$descriptor);\n\n  var canCopyProperties = this._eventBus.fire('moddleCopy.canCopyProperties', {\n    propertyNames: propertyNames,\n    sourceElement: sourceElement,\n    targetElement: targetElement,\n    clone: clone\n  });\n\n  if (canCopyProperties === false) {\n    return targetElement;\n  }\n\n  if (isArray(canCopyProperties)) {\n    propertyNames = canCopyProperties;\n  }\n\n  // copy properties\n  forEach(propertyNames, function(propertyName) {\n    var sourceProperty;\n\n    if (has(sourceElement, propertyName)) {\n      sourceProperty = sourceElement.get(propertyName);\n    }\n\n    var copiedProperty = self.copyProperty(sourceProperty, targetElement, propertyName, clone);\n\n    if (!isDefined(copiedProperty)) {\n      return;\n    }\n\n    var canSetProperty = self._eventBus.fire('moddleCopy.canSetCopiedProperty', {\n      parent: targetElement,\n      property: copiedProperty,\n      propertyName: propertyName\n    });\n\n    if (canSetProperty === false) {\n      return;\n    }\n\n    // TODO(nikku): unclaim old IDs if ID property is copied over\n    // this._moddle.getPropertyDescriptor(parent, propertyName)\n    targetElement.set(propertyName, copiedProperty);\n  });\n\n  return targetElement;\n};\n\n/**\n * Copy model property.\n *\n * @param {any} property\n * @param {ModdleElement} parent\n * @param {string} propertyName\n * @param {boolean} [clone=false]\n *\n * @return {any}\n */\nModdleCopy.prototype.copyProperty = function(property, parent, propertyName, clone = false) {\n  var self = this;\n\n  // allow others to copy property\n  var copiedProperty = this._eventBus.fire('moddleCopy.canCopyProperty', {\n    parent: parent,\n    property: property,\n    propertyName: propertyName,\n    clone: clone\n  });\n\n  // return if copying is NOT allowed\n  if (copiedProperty === false) {\n    return;\n  }\n\n  if (copiedProperty) {\n    if (isObject(copiedProperty) && copiedProperty.$type && !copiedProperty.$parent) {\n      copiedProperty.$parent = parent;\n    }\n\n    return copiedProperty;\n  }\n\n  var propertyDescriptor = this._moddle.getPropertyDescriptor(parent, propertyName);\n\n  // do NOT copy references\n  if (propertyDescriptor.isReference) {\n    return;\n  }\n\n  // copy id\n  if (propertyDescriptor.isId) {\n    return property && this._copyId(property, parent, clone);\n  }\n\n  // copy arrays\n  if (isArray(property)) {\n    return reduce(property, function(childProperties, childProperty) {\n\n      // recursion\n      copiedProperty = self.copyProperty(childProperty, parent, propertyName, clone);\n\n      // copying might NOT be allowed\n      if (copiedProperty) {\n        return childProperties.concat(copiedProperty);\n      }\n\n      return childProperties;\n    }, []);\n  }\n\n  // copy model elements\n  if (isObject(property) && property.$type) {\n    if (this._moddle.getElementDescriptor(property).isGeneric) {\n      return;\n    }\n\n    copiedProperty = self._bpmnFactory.create(property.$type);\n\n    copiedProperty.$parent = parent;\n\n    // recursion\n    copiedProperty = self.copyElement(property, copiedProperty, null, clone);\n\n    return copiedProperty;\n  }\n\n  // copy primitive properties\n  return property;\n};\n\nModdleCopy.prototype._copyId = function(id, element, clone = false) {\n  if (clone) {\n    return id;\n  }\n\n  // disallow if already taken\n  if (this._moddle.ids.assigned(id)) {\n    return;\n  } else {\n\n    this._moddle.ids.claim(id, element);\n    return id;\n  }\n};\n\n// helpers //////////\n\nexport function getPropertyNames(descriptor, keepDefaultProperties) {\n  return reduce(descriptor.properties, function(properties, property) {\n\n    if (keepDefaultProperties && property.default) {\n      return properties;\n    }\n\n    return properties.concat(property.name);\n  }, []);\n}\n\nfunction is(element, type) {\n  return element && isFunction(element.$instanceOf) && element.$instanceOf(type);\n}","import CopyPasteModule from 'diagram-js/lib/features/copy-paste';\n\nimport BpmnCopyPaste from './BpmnCopyPaste';\nimport ModdleCopy from './ModdleCopy';\n\nexport default {\n  __depends__: [\n    CopyPasteModule\n  ],\n  __init__: [ 'bpmnCopyPaste', 'moddleCopy' ],\n  bpmnCopyPaste: [ 'type', BpmnCopyPaste ],\n  moddleCopy: [ 'type', ModdleCopy ]\n};\n","import {\r\n  assign\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n *\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n */\r\n\r\nvar round = Math.round;\r\n\r\n/**\r\n * Service that allows replacing of elements.\r\n *\r\n * @param {Modeling} modeling\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function Replace(modeling, eventBus) {\r\n  this._modeling = modeling;\r\n  this._eventBus = eventBus;\r\n}\r\n\r\nReplace.$inject = [ 'modeling', 'eventBus' ];\r\n\r\n/**\r\n * Replace an element.\r\n *\r\n * @param {Shape} oldElement The element to be replaced.\r\n * @param {Object} attrs Containing information about the new element, for\r\n * example the new bounds and type.\r\n * @param {Object} hints Custom hints that will be attached to the context. It\r\n * can be used to inject data that is needed in the command chain. For example\r\n * it could be used in eventbus.on('commandStack.shape.replace.postExecute') to\r\n * change shape attributes after shape creation.\r\n *\r\n * @return {Shape}\r\n */\r\nReplace.prototype.replaceElement = function(oldElement, attrs, hints) {\r\n\r\n  if (oldElement.waypoints) {\r\n\r\n    // TODO(nikku): we do not replace connections, yet\r\n    return null;\r\n  }\r\n\r\n  var modeling = this._modeling;\r\n  var eventBus = this._eventBus;\r\n\r\n  eventBus.fire('replace.start', {\r\n    element: oldElement,\r\n    attrs,\r\n    hints\r\n  });\r\n\r\n  var width = attrs.width || oldElement.width,\r\n      height = attrs.height || oldElement.height,\r\n      x = attrs.x || oldElement.x,\r\n      y = attrs.y || oldElement.y,\r\n      centerX = round(x + width / 2),\r\n      centerY = round(y + height / 2);\r\n\r\n  // modeling API requires center coordinates,\r\n  // account for that when handling shape bounds\r\n\r\n  var newElement = modeling.replaceShape(\r\n    oldElement,\r\n    assign(\r\n      {},\r\n      attrs,\r\n      {\r\n        x: centerX,\r\n        y: centerY,\r\n        width: width,\r\n        height: height\r\n      }\r\n    ),\r\n    hints\r\n  );\r\n\r\n  eventBus.fire('replace.end', {\r\n    element: oldElement,\r\n    newElement,\r\n    hints\r\n  });\r\n\r\n  return newElement;\r\n};\r\n","export default function ReplaceSelectionBehavior(selection, eventBus) {\r\n\r\n  eventBus.on('replace.end', 500, function(event) {\r\n    const {\r\n      newElement,\r\n      hints = {}\r\n    } = event;\r\n\r\n    if (hints.select === false) {\r\n      return;\r\n    }\r\n\r\n    selection.select(newElement);\r\n  });\r\n\r\n}\r\n\r\nReplaceSelectionBehavior.$inject = [ 'selection', 'eventBus' ];","import Replace from './Replace';\r\nimport ReplaceSelectionBehavior from './ReplaceSelectionBehavior';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'replace', 'replaceSelectionBehavior' ],\r\n  replaceSelectionBehavior: [ 'type', ReplaceSelectionBehavior ],\r\n  replace: [ 'type', Replace ]\r\n};","import {\n  pick,\n  assign,\n  filter,\n  forEach,\n  isArray,\n  isUndefined,\n  has\n} from 'min-dash';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../util/ModelUtil';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  isExpanded,\n  isEventSubProcess\n} from '../../util/DiUtil';\n\nimport { getPropertyNames } from '../copy-paste/ModdleCopy';\n\n/**\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('../modeling/ElementFactory').default} ElementFactory\n * @typedef {import('../copy-paste/ModdleCopy').default} ModdleCopy\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('diagram-js/lib/features/replace/Replace').default} Replace\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef { {\n *   type: string;\n *   cancelActivity: boolean;\n *   instantiate: boolean;\n *   eventGatewayType: string;\n *   triggeredByEvent: boolean;\n *   isInterrupting: boolean;\n *   collapsed: boolean;\n *   isExpanded: boolean;\n *   eventDefinitionType: string;\n *   eventDefinitionAttrs: Object;\n *   host: Shape;\n * } } TargetElement\n *\n * @typedef { {\n *   moveChildren: boolean;\n * } & Record<string, any> } Hints\n */\n\nfunction copyProperties(source, target, properties) {\n  if (!isArray(properties)) {\n    properties = [ properties ];\n  }\n\n  forEach(properties, function(property) {\n    if (!isUndefined(source[property])) {\n      target[property] = source[property];\n    }\n  });\n}\n\n\nvar CUSTOM_PROPERTIES = [\n  'cancelActivity',\n  'instantiate',\n  'eventGatewayType',\n  'triggeredByEvent',\n  'isInterrupting'\n];\n\n/**\n * Check if element should be collapsed or expanded.\n */\nfunction shouldToggleCollapsed(element, targetElement) {\n\n  var oldCollapsed = (\n    element && has(element, 'collapsed') ? element.collapsed : !isExpanded(element)\n  );\n\n  var targetCollapsed;\n\n  if (targetElement && (has(targetElement, 'collapsed') || has(targetElement, 'isExpanded'))) {\n\n    // property is explicitly set so use it\n    targetCollapsed = (\n      has(targetElement, 'collapsed') ? targetElement.collapsed : !targetElement.isExpanded\n    );\n  } else {\n\n    // keep old state\n    targetCollapsed = oldCollapsed;\n  }\n\n  if (oldCollapsed !== targetCollapsed) {\n    return true;\n  }\n\n  return false;\n}\n\n\n/**\n * BPMN-specific replace.\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {ElementFactory} elementFactory\n * @param {ModdleCopy} moddleCopy\n * @param {Modeling} modeling\n * @param {Replace} replace\n * @param {Rules} rules\n */\nexport default function BpmnReplace(\n    bpmnFactory,\n    elementFactory,\n    moddleCopy,\n    modeling,\n    replace,\n    rules\n) {\n\n  /**\n   * Prepares a new business object for the replacement element\n   * and triggers the replace operation.\n   *\n   * @param  {Element} element\n   * @param  {TargetElement} targetElement\n   * @param  {Hints} [hints]\n   *\n   * @return {Element}\n   */\n  function replaceElement(element, targetElement, hints) {\n\n    hints = hints || {};\n\n    var type = targetElement.type,\n        oldBusinessObject = element.businessObject;\n\n    if (isSubProcess(oldBusinessObject) && type === 'bpmn:SubProcess') {\n      if (shouldToggleCollapsed(element, targetElement)) {\n\n        // expanding or collapsing process\n        modeling.toggleCollapse(element);\n\n        return element;\n      }\n    }\n\n    var newBusinessObject = bpmnFactory.create(type);\n\n    var newElement = {\n      type: type,\n      businessObject: newBusinessObject,\n    };\n\n    newElement.di = {};\n\n    if (type === 'bpmn:ExclusiveGateway') {\n      newElement.di.isMarkerVisible = true;\n    }\n\n    // colors will be set to DI\n    copyProperties(element.di, newElement.di, [\n      'fill',\n      'stroke',\n      'background-color',\n      'border-color',\n      'color'\n    ]);\n\n    var elementProps = getPropertyNames(oldBusinessObject.$descriptor),\n        newElementProps = getPropertyNames(newBusinessObject.$descriptor, true),\n        copyProps = intersection(elementProps, newElementProps);\n\n    // initialize special properties defined in target definition\n    assign(newBusinessObject, pick(targetElement, CUSTOM_PROPERTIES));\n\n    var properties = filter(copyProps, function(propertyName) {\n\n      // copying event definitions, unless we replace\n      if (propertyName === 'eventDefinitions') {\n        return hasEventDefinition(element, targetElement.eventDefinitionType);\n      }\n\n      // retain loop characteristics if the target element\n      // is not an event sub process\n      if (propertyName === 'loopCharacteristics') {\n        return !isEventSubProcess(newBusinessObject);\n      }\n\n      // so the applied properties from 'target' don't get lost\n      if (has(newBusinessObject, propertyName)) {\n        return false;\n      }\n\n      if (propertyName === 'processRef' && targetElement.isExpanded === false) {\n        return false;\n      }\n\n      if (propertyName === 'triggeredByEvent') {\n        return false;\n      }\n\n      if (propertyName === 'isForCompensation') {\n        return !isEventSubProcess(newBusinessObject);\n      }\n\n      return true;\n    });\n\n    newBusinessObject = moddleCopy.copyElement(\n      oldBusinessObject,\n      newBusinessObject,\n      properties\n    );\n\n    // initialize custom BPMN extensions\n    if (targetElement.eventDefinitionType) {\n\n      // only initialize with new eventDefinition\n      // if we did not set an event definition yet,\n      // i.e. because we copied it\n      if (!hasEventDefinition(newBusinessObject, targetElement.eventDefinitionType)) {\n        newElement.eventDefinitionType = targetElement.eventDefinitionType;\n        newElement.eventDefinitionAttrs = targetElement.eventDefinitionAttrs;\n      }\n    }\n\n    if (is(oldBusinessObject, 'bpmn:Activity')) {\n\n      if (isSubProcess(oldBusinessObject)) {\n\n        // no toggeling, so keep old state\n        newElement.isExpanded = isExpanded(element);\n      }\n\n      // else if property is explicitly set, use it\n      else if (targetElement && has(targetElement, 'isExpanded')) {\n        newElement.isExpanded = targetElement.isExpanded;\n\n        // assign default size of new expanded element\n        var defaultSize = elementFactory.getDefaultSize(newBusinessObject, {\n          isExpanded: newElement.isExpanded\n        });\n\n        newElement.width = defaultSize.width;\n        newElement.height = defaultSize.height;\n\n        // keep element centered\n        newElement.x = element.x - (newElement.width - element.width) / 2;\n        newElement.y = element.y - (newElement.height - element.height) / 2;\n      }\n\n      // TODO: need also to respect min/max Size\n      // copy size, from an expanded subprocess to an expanded alternative subprocess\n      // except bpmn:Task, because Task is always expanded\n      if ((isExpanded(element) && !is(oldBusinessObject, 'bpmn:Task')) && newElement.isExpanded) {\n        newElement.width = element.width;\n        newElement.height = element.height;\n      }\n    }\n\n    // remove children if not expanding sub process\n    if (isSubProcess(oldBusinessObject) && !isSubProcess(newBusinessObject)) {\n      hints.moveChildren = false;\n    }\n\n    // transform collapsed/expanded pools\n    if (is(oldBusinessObject, 'bpmn:Participant')) {\n\n      // create expanded pool\n      if (targetElement.isExpanded === true) {\n        newBusinessObject.processRef = bpmnFactory.create('bpmn:Process');\n      } else {\n\n        // remove children when transforming to collapsed pool\n        hints.moveChildren = false;\n      }\n\n      // apply same width and default height\n      newElement.width = element.width;\n      newElement.height = elementFactory.getDefaultSize(newElement).height;\n    }\n\n    if (!rules.allowed('shape.resize', { shape: newBusinessObject })) {\n      newElement.height = elementFactory.getDefaultSize(newElement).height;\n      newElement.width = elementFactory.getDefaultSize(newElement).width;\n    }\n\n    newBusinessObject.name = oldBusinessObject.name;\n\n    // retain default flow's reference between inclusive <-> exclusive gateways and activities\n    if (\n      isAny(oldBusinessObject, [\n        'bpmn:ExclusiveGateway',\n        'bpmn:InclusiveGateway',\n        'bpmn:Activity'\n      ]) &&\n      isAny(newBusinessObject, [\n        'bpmn:ExclusiveGateway',\n        'bpmn:InclusiveGateway',\n        'bpmn:Activity'\n      ])\n    ) {\n      newBusinessObject.default = oldBusinessObject.default;\n    }\n\n    if (\n      targetElement.host &&\n      !is(oldBusinessObject, 'bpmn:BoundaryEvent') &&\n      is(newBusinessObject, 'bpmn:BoundaryEvent')\n    ) {\n      newElement.host = targetElement.host;\n    }\n\n    // The DataStoreReference element is 14px wider than the DataObjectReference element\n    // This ensures that they stay centered on the x axis when replaced\n    if (\n      newElement.type === 'bpmn:DataStoreReference' ||\n      newElement.type === 'bpmn:DataObjectReference'\n    ) {\n      newElement.x = element.x + (element.width - newElement.width) / 2;\n    }\n\n    return replace.replaceElement(element, newElement, { ...hints, targetElement });\n  }\n\n  this.replaceElement = replaceElement;\n}\n\nBpmnReplace.$inject = [\n  'bpmnFactory',\n  'elementFactory',\n  'moddleCopy',\n  'modeling',\n  'replace',\n  'rules'\n];\n\n/**\n * @param {ModdleElement} businessObject\n *\n * @return {boolean}\n */\nfunction isSubProcess(businessObject) {\n  return is(businessObject, 'bpmn:SubProcess');\n}\n\n/**\n * @param {Element|ModdleElement} element\n * @param {string} type\n *\n * @return {boolean}\n */\nfunction hasEventDefinition(element, type) {\n  var businessObject = getBusinessObject(element);\n\n  return type && businessObject.get('eventDefinitions').some(function(definition) {\n    return is(definition, type);\n  });\n}\n\n/**\n * Compute intersection between two arrays.\n *\n * @param {Array} a\n * @param {Array} b\n *\n * @return {Array}\n */\nfunction intersection(a, b) {\n  return a.filter(function(item) {\n    return b.includes(item);\n  });\n}\n","import CopyPasteModule from '../copy-paste';\nimport ReplaceModule from 'diagram-js/lib/features/replace';\nimport SelectionModule from 'diagram-js/lib/features/selection';\n\nimport BpmnReplace from './BpmnReplace';\n\nexport default {\n  __depends__: [\n    CopyPasteModule,\n    ReplaceModule,\n    SelectionModule\n  ],\n  bpmnReplace: [ 'type', BpmnReplace ]\n};\n","import {\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  closest as domClosest\r\n} from 'min-dom';\r\n\r\n/**\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('../../core/EventBus').Event} Event\r\n */\r\n\r\nvar LOW_PRIORITY = 250;\r\n\r\n/**\r\n * The tool manager acts as middle-man between the available tool's and the Palette,\r\n * it takes care of making sure that the correct active state is set.\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function ToolManager(eventBus) {\r\n  this._eventBus = eventBus;\r\n\r\n  this._tools = [];\r\n  this._active = null;\r\n}\r\n\r\nToolManager.$inject = [ 'eventBus' ];\r\n\r\n/**\r\n * Register a tool.\r\n *\r\n * @param {string} name\r\n * @param { {\r\n *   tool: string;\r\n * } } events\r\n */\r\nToolManager.prototype.registerTool = function(name, events) {\r\n  var tools = this._tools;\r\n\r\n  if (!events) {\r\n    throw new Error('A tool has to be registered with it\\'s \"events\"');\r\n  }\r\n\r\n  tools.push(name);\r\n  this.bindEvents(name, events);\r\n};\r\n\r\nToolManager.prototype.isActive = function(tool) {\r\n  return tool && this._active === tool;\r\n};\r\n\r\nToolManager.prototype.length = function(tool) {\r\n  return this._tools.length;\r\n};\r\n\r\nToolManager.prototype.setActive = function(tool) {\r\n  var eventBus = this._eventBus;\r\n\r\n  if (this._active !== tool) {\r\n    this._active = tool;\r\n\r\n    eventBus.fire('tool-manager.update', { tool: tool });\r\n  }\r\n};\r\n\r\nToolManager.prototype.bindEvents = function(name, events) {\r\n  var eventBus = this._eventBus;\r\n\r\n  var eventsToRegister = [];\r\n\r\n  eventBus.on(events.tool + '.init', function(event) {\r\n    var context = event.context;\r\n\r\n    // Active tools that want to reactivate themselves must do this explicitly\r\n    if (!context.reactivate && this.isActive(name)) {\r\n      this.setActive(null);\r\n\r\n      return;\r\n    }\r\n\r\n    this.setActive(name);\r\n\r\n  }, this);\r\n\r\n  // TODO: add test cases\r\n  forEach(events, function(event) {\r\n    eventsToRegister.push(event + '.ended');\r\n    eventsToRegister.push(event + '.canceled');\r\n  });\r\n\r\n  eventBus.on(eventsToRegister, LOW_PRIORITY, function(event) {\r\n\r\n    // We defer the de-activation of the tool to the .activate phase,\r\n    // so we're able to check if we want to toggle off the current\r\n    // active tool or switch to a new one\r\n    if (!this._active) {\r\n      return;\r\n    }\r\n\r\n    if (isPaletteClick(event)) {\r\n      return;\r\n    }\r\n\r\n    this.setActive(null);\r\n  }, this);\r\n\r\n};\r\n\r\n\r\n// helpers ///////////////\r\n\r\n/**\r\n * Check if a given event is a palette click event.\r\n *\r\n * @param {Event} event\r\n *\r\n * @return {boolean}\r\n */\r\nfunction isPaletteClick(event) {\r\n  var target = event.originalEvent && event.originalEvent.target;\r\n\r\n  return target && domClosest(target, '.group[data-group=\"tools\"]');\r\n}","import DraggingModule from '../dragging';\r\n\r\nimport ToolManager from './ToolManager';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    DraggingModule\r\n  ],\r\n  __init__: [ 'toolManager' ],\r\n  toolManager: [ 'type', ToolManager ]\r\n};\r\n","/**\r\n * @typedef {import('../../core/Types').ConnectionLike} Connection\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../util/Types').Axis} Axis\r\n * @typedef {import('../../util/Types').Direction} Direction\r\n * @typedef {import('../../util/Types').Point} Point\r\n * @typedef {import('../../util/Types').Rect} Rect\r\n */\r\n\r\nimport { forEach } from 'min-dash';\r\n\r\n/**\r\n * Return direction given axis and delta.\r\n *\r\n * @param {Axis} axis\r\n * @param {number} delta\r\n *\r\n * @return {Direction}\r\n */\r\nexport function getDirection(axis, delta) {\r\n\r\n  if (axis === 'x') {\r\n    if (delta > 0) {\r\n      return 'e';\r\n    }\r\n\r\n    if (delta < 0) {\r\n      return 'w';\r\n    }\r\n  }\r\n\r\n  if (axis === 'y') {\r\n    if (delta > 0) {\r\n      return 's';\r\n    }\r\n\r\n    if (delta < 0) {\r\n      return 'n';\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Returns connections whose waypoints are to be updated. Waypoints are to be updated if start\r\n * or end is to be moved or resized.\r\n *\r\n * @param {Array<Shape>} movingShapes\r\n * @param {Array<Shape>} resizingShapes\r\n *\r\n * @return {Array<Connection>}\r\n */\r\nexport function getWaypointsUpdatingConnections(movingShapes, resizingShapes) {\r\n  var waypointsUpdatingConnections = [];\r\n\r\n  forEach(movingShapes.concat(resizingShapes), function(shape) {\r\n    var incoming = shape.incoming,\r\n        outgoing = shape.outgoing;\r\n\r\n    forEach(incoming.concat(outgoing), function(connection) {\r\n      var source = connection.source,\r\n          target = connection.target;\r\n\r\n      if (includes(movingShapes, source) ||\r\n        includes(movingShapes, target) ||\r\n        includes(resizingShapes, source) ||\r\n        includes(resizingShapes, target)) {\r\n\r\n        if (!includes(waypointsUpdatingConnections, connection)) {\r\n          waypointsUpdatingConnections.push(connection);\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  return waypointsUpdatingConnections;\r\n}\r\n\r\nfunction includes(array, item) {\r\n  return array.indexOf(item) !== -1;\r\n}\r\n\r\n/**\r\n * Resize bounds.\r\n *\r\n * @param {Rect} bounds\r\n * @param {Direction} direction\r\n * @param {Point} delta\r\n *\r\n * @return {Rect}\r\n */\r\nexport function resizeBounds(bounds, direction, delta) {\r\n  var x = bounds.x,\r\n      y = bounds.y,\r\n      width = bounds.width,\r\n      height = bounds.height,\r\n      dx = delta.x,\r\n      dy = delta.y;\r\n\r\n  switch (direction) {\r\n  case 'n':\r\n    return {\r\n      x: x,\r\n      y: y + dy,\r\n      width: width,\r\n      height: height - dy\r\n    };\r\n  case 's':\r\n    return {\r\n      x: x,\r\n      y: y,\r\n      width: width,\r\n      height: height + dy\r\n    };\r\n  case 'w':\r\n    return {\r\n      x: x + dx,\r\n      y: y,\r\n      width: width - dx,\r\n      height: height\r\n    };\r\n  case 'e':\r\n    return {\r\n      x: x,\r\n      y: y,\r\n      width: width + dx,\r\n      height: height\r\n    };\r\n  default:\r\n    throw new Error('unknown direction: ' + direction);\r\n  }\r\n}","import {\r\n  assign,\r\n  filter,\r\n  forEach,\r\n  isNumber\r\n} from 'min-dash';\r\n\r\nimport {\r\n  asTRBL,\r\n  getMid\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport { getBBox } from '../../util/Elements';\r\n\r\nimport { getDirection } from './SpaceUtil';\r\n\r\nimport {\r\n  hasPrimaryModifier,\r\n  hasSecondaryModifier\r\n} from '../../util/Mouse';\r\n\r\nimport { set as setCursor } from '../../util/Cursor';\r\n\r\nimport { selfAndAllChildren } from '../../util/Elements';\r\n\r\nimport {\r\n  isConnection,\r\n  isLabel\r\n} from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../mouse/Mouse').default} Mouse\r\n * @typedef {import('../rules/Rules').default} Rules\r\n * @typedef {import('../tool-manager/ToolManager').default} ToolManager\r\n *\r\n * @typedef {import('../../util/Types').Axis} Axis\r\n * @typedef {import('../../util/Types').Direction} Direction\r\n * @typedef {import('../../util/Types').Point} Point\r\n */\r\n\r\nvar abs = Math.abs,\r\n    round = Math.round;\r\n\r\nvar AXIS_TO_DIMENSION = {\r\n  x: 'width',\r\n  y: 'height'\r\n};\r\n\r\nvar CURSOR_CROSSHAIR = 'crosshair';\r\n\r\nvar DIRECTION_TO_TRBL = {\r\n  n: 'top',\r\n  w: 'left',\r\n  s: 'bottom',\r\n  e: 'right'\r\n};\r\n\r\nvar HIGH_PRIORITY = 1500;\r\n\r\nvar DIRECTION_TO_OPPOSITE = {\r\n  n: 's',\r\n  w: 'e',\r\n  s: 'n',\r\n  e: 'w'\r\n};\r\n\r\nvar PADDING = 20;\r\n\r\n\r\n/**\r\n * Add or remove space by moving and resizing elements.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {Dragging} dragging\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n * @param {Rules} rules\r\n * @param {ToolManager} toolManager\r\n * @param {Mouse} mouse\r\n */\r\nexport default function SpaceTool(\r\n    canvas, dragging, eventBus,\r\n    modeling, rules, toolManager,\r\n    mouse) {\r\n\r\n  this._canvas = canvas;\r\n  this._dragging = dragging;\r\n  this._eventBus = eventBus;\r\n  this._modeling = modeling;\r\n  this._rules = rules;\r\n  this._toolManager = toolManager;\r\n  this._mouse = mouse;\r\n\r\n  var self = this;\r\n\r\n  toolManager.registerTool('space', {\r\n    tool: 'spaceTool.selection',\r\n    dragging: 'spaceTool'\r\n  });\r\n\r\n  eventBus.on('spaceTool.selection.end', function(event) {\r\n    eventBus.once('spaceTool.selection.ended', function() {\r\n      self.activateMakeSpace(event.originalEvent);\r\n    });\r\n  });\r\n\r\n  eventBus.on('spaceTool.move', HIGH_PRIORITY , function(event) {\r\n    var context = event.context,\r\n        initialized = context.initialized;\r\n\r\n    if (!initialized) {\r\n      initialized = context.initialized = self.init(event, context);\r\n    }\r\n\r\n    if (initialized) {\r\n      ensureConstraints(event);\r\n    }\r\n  });\r\n\r\n  eventBus.on('spaceTool.end', function(event) {\r\n    var context = event.context,\r\n        axis = context.axis,\r\n        direction = context.direction,\r\n        movingShapes = context.movingShapes,\r\n        resizingShapes = context.resizingShapes,\r\n        start = context.start;\r\n\r\n    if (!context.initialized) {\r\n      return;\r\n    }\r\n\r\n    ensureConstraints(event);\r\n\r\n    var delta = {\r\n      x: 0,\r\n      y: 0\r\n    };\r\n\r\n    delta[ axis ] = round(event[ 'd' + axis ]);\r\n\r\n    self.makeSpace(movingShapes, resizingShapes, delta, direction, start);\r\n\r\n    eventBus.once('spaceTool.ended', function(event) {\r\n\r\n      // activate space tool selection after make space\r\n      self.activateSelection(event.originalEvent, true, true);\r\n    });\r\n  });\r\n}\r\n\r\nSpaceTool.$inject = [\r\n  'canvas',\r\n  'dragging',\r\n  'eventBus',\r\n  'modeling',\r\n  'rules',\r\n  'toolManager',\r\n  'mouse'\r\n];\r\n\r\n/**\r\n * Activate space tool selection.\r\n *\r\n * @param {MouseEvent|TouchEvent} event\r\n * @param {boolean} autoActivate\r\n * @param {boolean} reactivate\r\n */\r\nSpaceTool.prototype.activateSelection = function(event, autoActivate, reactivate) {\r\n  this._dragging.init(event, 'spaceTool.selection', {\r\n    autoActivate: autoActivate,\r\n    cursor: CURSOR_CROSSHAIR,\r\n    data: {\r\n      context: {\r\n        reactivate: reactivate\r\n      }\r\n    },\r\n    trapClick: false\r\n  });\r\n};\r\n\r\n/**\r\n * Activate space tool make space.\r\n *\r\n * @param {MouseEvent|TouchEvent} event\r\n */\r\nSpaceTool.prototype.activateMakeSpace = function(event) {\r\n  this._dragging.init(event, 'spaceTool', {\r\n    autoActivate: true,\r\n    cursor: CURSOR_CROSSHAIR,\r\n    data: {\r\n      context: {}\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Make space.\r\n *\r\n * @param {Array<Shape>} movingShapes\r\n * @param {Array<Shape>} resizingShapes\r\n * @param {Point} delta\r\n * @param {Direction} direction\r\n * @param {number} start\r\n */\r\nSpaceTool.prototype.makeSpace = function(movingShapes, resizingShapes, delta, direction, start) {\r\n  return this._modeling.createSpace(movingShapes, resizingShapes, delta, direction, start);\r\n};\r\n\r\n/**\r\n * Initialize make space and return true if that was successful.\r\n *\r\n * @param {MouseEvent|TouchEvent} event\r\n * @param {Object} context\r\n *\r\n * @return {boolean}\r\n */\r\nSpaceTool.prototype.init = function(event, context) {\r\n  var axis = abs(event.dx) > abs(event.dy) ? 'x' : 'y',\r\n      delta = event[ 'd' + axis ],\r\n      start = event[ axis ] - delta;\r\n\r\n  if (abs(delta) < 5) {\r\n    return false;\r\n  }\r\n\r\n  // invert delta to remove space when moving left\r\n  if (delta < 0) {\r\n    delta *= -1;\r\n  }\r\n\r\n  // invert delta to add/remove space when removing/adding space if modifier key is pressed\r\n  if (hasPrimaryModifier(event)) {\r\n    delta *= -1;\r\n  }\r\n\r\n  var direction = getDirection(axis, delta);\r\n\r\n  var root = this._canvas.getRootElement();\r\n\r\n  if (!hasSecondaryModifier(event) && event.hover) {\r\n    root = event.hover;\r\n  }\r\n\r\n  var children = [\r\n    ...selfAndAllChildren(root, true),\r\n    ...(root.attachers || [])\r\n  ];\r\n\r\n  var elements = this.calculateAdjustments(children, axis, delta, start);\r\n\r\n  var minDimensions = this._eventBus.fire('spaceTool.getMinDimensions', {\r\n    axis: axis,\r\n    direction: direction,\r\n    shapes: elements.resizingShapes,\r\n    start: start\r\n  });\r\n\r\n  var spaceToolConstraints = getSpaceToolConstraints(elements, axis, direction, start, minDimensions);\r\n\r\n  assign(\r\n    context,\r\n    elements,\r\n    {\r\n      axis: axis,\r\n      direction: direction,\r\n      spaceToolConstraints: spaceToolConstraints,\r\n      start: start\r\n    }\r\n  );\r\n\r\n  setCursor('resize-' + (axis === 'x' ? 'ew' : 'ns'));\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * Get elements to be moved and resized.\r\n *\r\n * @param {Array<Shape>} elements\r\n * @param {Axis} axis\r\n * @param {Point} delta\r\n * @param {number} start\r\n *\r\n * @return {Object}\r\n */\r\nSpaceTool.prototype.calculateAdjustments = function(elements, axis, delta, start) {\r\n  var rules = this._rules;\r\n\r\n  var movingShapes = [],\r\n      resizingShapes = [];\r\n\r\n  var attachers = [],\r\n      connections = [];\r\n\r\n  function moveShape(shape) {\r\n    if (!movingShapes.includes(shape)) {\r\n      movingShapes.push(shape);\r\n    }\r\n\r\n    var label = shape.label;\r\n\r\n    // move external label if its label target is moving\r\n    if (label && !movingShapes.includes(label)) {\r\n      movingShapes.push(label);\r\n    }\r\n  }\r\n\r\n  function resizeShape(shape) {\r\n    if (!resizingShapes.includes(shape)) {\r\n      resizingShapes.push(shape);\r\n    }\r\n  }\r\n\r\n  forEach(elements, function(element) {\r\n    if (!element.parent || isLabel(element)) {\r\n      return;\r\n    }\r\n\r\n    // handle connections separately\r\n    if (isConnection(element)) {\r\n      connections.push(element);\r\n\r\n      return;\r\n    }\r\n\r\n    var shapeStart = element[ axis ],\r\n        shapeEnd = shapeStart + element[ AXIS_TO_DIMENSION[ axis ] ];\r\n\r\n    // handle attachers separately\r\n    if (isAttacher(element)\r\n      && ((delta > 0 && getMid(element)[ axis ] > start)\r\n        || (delta < 0 && getMid(element)[ axis ] < start))) {\r\n      attachers.push(element);\r\n\r\n      return;\r\n    }\r\n\r\n    // move shape if its start is after space tool\r\n    if ((delta > 0 && shapeStart > start)\r\n      || (delta < 0 && shapeEnd < start)) {\r\n      moveShape(element);\r\n\r\n      return;\r\n    }\r\n\r\n    // resize shape if it's resizable and its start is before and its end is after space tool\r\n    if (shapeStart < start\r\n      && shapeEnd > start\r\n      && rules.allowed('shape.resize', { shape: element })\r\n    ) {\r\n      resizeShape(element);\r\n\r\n      return;\r\n    }\r\n  });\r\n\r\n  // move attacher if its host is moving\r\n  forEach(movingShapes, function(shape) {\r\n    var attachers = shape.attachers;\r\n\r\n    if (attachers) {\r\n      forEach(attachers, function(attacher) {\r\n        moveShape(attacher);\r\n      });\r\n    }\r\n  });\r\n\r\n  var allShapes = movingShapes.concat(resizingShapes);\r\n\r\n  // move attacher if its mid is after space tool and its host is moving or resizing\r\n  forEach(attachers, function(attacher) {\r\n    var host = attacher.host;\r\n\r\n    if (includes(allShapes, host)) {\r\n      moveShape(attacher);\r\n    }\r\n  });\r\n\r\n  allShapes = movingShapes.concat(resizingShapes);\r\n\r\n  // move external label if its label target's (connection) source and target are moving\r\n  forEach(connections, function(connection) {\r\n    var source = connection.source,\r\n        target = connection.target,\r\n        label = connection.label;\r\n\r\n    if (includes(allShapes, source)\r\n      && includes(allShapes, target)\r\n      && label) {\r\n      moveShape(label);\r\n    }\r\n  });\r\n\r\n  return {\r\n    movingShapes: movingShapes,\r\n    resizingShapes: resizingShapes\r\n  };\r\n};\r\n\r\nSpaceTool.prototype.toggle = function() {\r\n\r\n  if (this.isActive()) {\r\n    return this._dragging.cancel();\r\n  }\r\n\r\n  var mouseEvent = this._mouse.getLastMoveEvent();\r\n\r\n  this.activateSelection(mouseEvent, !!mouseEvent);\r\n};\r\n\r\nSpaceTool.prototype.isActive = function() {\r\n  var context = this._dragging.context();\r\n\r\n  if (context) {\r\n    return /^spaceTool/.test(context.prefix);\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction addPadding(trbl) {\r\n  return {\r\n    top: trbl.top - PADDING,\r\n    right: trbl.right + PADDING,\r\n    bottom: trbl.bottom + PADDING,\r\n    left: trbl.left - PADDING\r\n  };\r\n}\r\n\r\nfunction ensureConstraints(event) {\r\n  var context = event.context,\r\n      spaceToolConstraints = context.spaceToolConstraints;\r\n\r\n  if (!spaceToolConstraints) {\r\n    return;\r\n  }\r\n\r\n  var x, y;\r\n\r\n  if (isNumber(spaceToolConstraints.left)) {\r\n    x = Math.max(event.x, spaceToolConstraints.left);\r\n\r\n    event.dx = event.dx + x - event.x;\r\n    event.x = x;\r\n  }\r\n\r\n  if (isNumber(spaceToolConstraints.right)) {\r\n    x = Math.min(event.x, spaceToolConstraints.right);\r\n\r\n    event.dx = event.dx + x - event.x;\r\n    event.x = x;\r\n  }\r\n\r\n  if (isNumber(spaceToolConstraints.top)) {\r\n    y = Math.max(event.y, spaceToolConstraints.top);\r\n\r\n    event.dy = event.dy + y - event.y;\r\n    event.y = y;\r\n  }\r\n\r\n  if (isNumber(spaceToolConstraints.bottom)) {\r\n    y = Math.min(event.y, spaceToolConstraints.bottom);\r\n\r\n    event.dy = event.dy + y - event.y;\r\n    event.y = y;\r\n  }\r\n}\r\n\r\nfunction getSpaceToolConstraints(elements, axis, direction, start, minDimensions) {\r\n  var movingShapes = elements.movingShapes,\r\n      resizingShapes = elements.resizingShapes;\r\n\r\n  if (!resizingShapes.length) {\r\n    return;\r\n  }\r\n\r\n  var spaceToolConstraints = {},\r\n      min,\r\n      max;\r\n\r\n  forEach(resizingShapes, function(resizingShape) {\r\n    var attachers = resizingShape.attachers,\r\n        children = resizingShape.children;\r\n\r\n    var resizingShapeBBox = asTRBL(resizingShape);\r\n\r\n    // find children that are not moving or resizing\r\n    var nonMovingResizingChildren = filter(children, function(child) {\r\n      return !isConnection(child) &&\r\n        !isLabel(child) &&\r\n        !includes(movingShapes, child) &&\r\n        !includes(resizingShapes, child);\r\n    });\r\n\r\n    // find children that are moving\r\n    var movingChildren = filter(children, function(child) {\r\n      return !isConnection(child) && !isLabel(child) && includes(movingShapes, child);\r\n    });\r\n\r\n    var minOrMax,\r\n        nonMovingResizingChildrenBBox,\r\n        movingChildrenBBox,\r\n        movingAttachers = [],\r\n        nonMovingAttachers = [],\r\n        movingAttachersBBox,\r\n        movingAttachersConstraint,\r\n        nonMovingAttachersBBox,\r\n        nonMovingAttachersConstraint;\r\n\r\n    if (nonMovingResizingChildren.length) {\r\n      nonMovingResizingChildrenBBox = addPadding(asTRBL(getBBox(nonMovingResizingChildren)));\r\n\r\n      minOrMax = start -\r\n        resizingShapeBBox[ DIRECTION_TO_TRBL[ direction ] ] +\r\n        nonMovingResizingChildrenBBox[ DIRECTION_TO_TRBL[ direction ] ];\r\n\r\n      if (direction === 'n') {\r\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\r\n      } else if (direction === 'w') {\r\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\r\n      } else if (direction === 's') {\r\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\r\n      } else if (direction === 'e') {\r\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\r\n      }\r\n    }\r\n\r\n    if (movingChildren.length) {\r\n      movingChildrenBBox = addPadding(asTRBL(getBBox(movingChildren)));\r\n\r\n      minOrMax = start -\r\n        movingChildrenBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ] +\r\n        resizingShapeBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ];\r\n\r\n      if (direction === 'n') {\r\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\r\n      } else if (direction === 'w') {\r\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\r\n      } else if (direction === 's') {\r\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\r\n      } else if (direction === 'e') {\r\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\r\n      }\r\n    }\r\n\r\n    if (attachers && attachers.length) {\r\n      attachers.forEach(function(attacher) {\r\n        if (includes(movingShapes, attacher)) {\r\n          movingAttachers.push(attacher);\r\n        } else {\r\n          nonMovingAttachers.push(attacher);\r\n        }\r\n      });\r\n\r\n      if (movingAttachers.length) {\r\n        movingAttachersBBox = asTRBL(getBBox(movingAttachers.map(getMid)));\r\n\r\n        movingAttachersConstraint = resizingShapeBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ]\r\n              - (movingAttachersBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ] - start);\r\n      }\r\n\r\n      if (nonMovingAttachers.length) {\r\n        nonMovingAttachersBBox = asTRBL(getBBox(nonMovingAttachers.map(getMid)));\r\n\r\n        nonMovingAttachersConstraint = nonMovingAttachersBBox[ DIRECTION_TO_TRBL[ direction ] ]\r\n              - (resizingShapeBBox[ DIRECTION_TO_TRBL[ direction ] ] - start);\r\n      }\r\n\r\n      if (direction === 'n') {\r\n        minOrMax = Math.min(movingAttachersConstraint || Infinity, nonMovingAttachersConstraint || Infinity);\r\n\r\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\r\n      } else if (direction === 'w') {\r\n        minOrMax = Math.min(movingAttachersConstraint || Infinity, nonMovingAttachersConstraint || Infinity);\r\n\r\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\r\n      } else if (direction === 's') {\r\n        minOrMax = Math.max(movingAttachersConstraint || -Infinity, nonMovingAttachersConstraint || -Infinity);\r\n\r\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\r\n      } else if (direction === 'e') {\r\n        minOrMax = Math.max(movingAttachersConstraint || -Infinity, nonMovingAttachersConstraint || -Infinity);\r\n\r\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\r\n      }\r\n    }\r\n\r\n    var resizingShapeMinDimensions = minDimensions && minDimensions[ resizingShape.id ];\r\n\r\n    if (resizingShapeMinDimensions) {\r\n\r\n      if (direction === 'n') {\r\n        minOrMax = start +\r\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] -\r\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\r\n\r\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\r\n      } else if (direction === 'w') {\r\n        minOrMax = start +\r\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] -\r\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\r\n\r\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\r\n      } else if (direction === 's') {\r\n        minOrMax = start -\r\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] +\r\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\r\n\r\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\r\n      } else if (direction === 'e') {\r\n        minOrMax = start -\r\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] +\r\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\r\n\r\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\r\n      }\r\n    }\r\n  });\r\n\r\n  return spaceToolConstraints;\r\n}\r\n\r\nfunction includes(array, item) {\r\n  return array.indexOf(item) !== -1;\r\n}\r\n\r\nfunction isAttacher(element) {\r\n  return !!element.host;\r\n}","import {\r\n  forEach\r\n} from 'min-dash';\r\n\r\nvar MARKER_DRAGGING = 'djs-dragging',\r\n    MARKER_RESIZING = 'djs-resizing';\r\n\r\nvar LOW_PRIORITY = 250;\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  translate\r\n} from '../../util/SvgTransformUtil';\r\n\r\nimport { isConnection } from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../draw/Styles').default} Styles\r\n */\r\n\r\nvar max = Math.max;\r\n\r\n\r\n/**\r\n * Provides previews for selecting/moving/resizing shapes when creating/removing space.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {Canvas} canvas\r\n * @param {Styles} styles\r\n */\r\nexport default function SpaceToolPreview(\r\n    eventBus, elementRegistry, canvas,\r\n    styles, previewSupport) {\r\n\r\n  function addPreviewGfx(collection, dragGroup) {\r\n    forEach(collection, function(element) {\r\n      previewSupport.addDragger(element, dragGroup);\r\n\r\n      canvas.addMarker(element, MARKER_DRAGGING);\r\n    });\r\n  }\r\n\r\n  // add crosshair\r\n  eventBus.on('spaceTool.selection.start', function(event) {\r\n    var space = canvas.getLayer('space'),\r\n        context = event.context;\r\n\r\n    var orientation = {\r\n      x: 'M 0,-10000 L 0,10000',\r\n      y: 'M -10000,0 L 10000,0'\r\n    };\r\n\r\n    var crosshairGroup = svgCreate('g');\r\n    svgAttr(crosshairGroup, styles.cls('djs-crosshair-group', [ 'no-events' ]));\r\n\r\n    svgAppend(space, crosshairGroup);\r\n\r\n    // horizontal path\r\n    var pathX = svgCreate('path');\r\n    svgAttr(pathX, 'd', orientation.x);\r\n    svgClasses(pathX).add('djs-crosshair');\r\n\r\n    svgAppend(crosshairGroup, pathX);\r\n\r\n    // vertical path\r\n    var pathY = svgCreate('path');\r\n    svgAttr(pathY, 'd', orientation.y);\r\n    svgClasses(pathY).add('djs-crosshair');\r\n\r\n    svgAppend(crosshairGroup, pathY);\r\n\r\n    context.crosshairGroup = crosshairGroup;\r\n  });\r\n\r\n  // update crosshair\r\n  eventBus.on('spaceTool.selection.move', function(event) {\r\n    var crosshairGroup = event.context.crosshairGroup;\r\n\r\n    translate(crosshairGroup, event.x, event.y);\r\n  });\r\n\r\n  // remove crosshair\r\n  eventBus.on('spaceTool.selection.cleanup', function(event) {\r\n    var context = event.context,\r\n        crosshairGroup = context.crosshairGroup;\r\n\r\n    if (crosshairGroup) {\r\n      svgRemove(crosshairGroup);\r\n    }\r\n  });\r\n\r\n  // add and update move/resize previews\r\n  eventBus.on('spaceTool.move', LOW_PRIORITY, function(event) {\r\n\r\n    var context = event.context,\r\n        line = context.line,\r\n        axis = context.axis,\r\n        movingShapes = context.movingShapes,\r\n        resizingShapes = context.resizingShapes;\r\n\r\n    if (!context.initialized) {\r\n      return;\r\n    }\r\n\r\n    if (!context.dragGroup) {\r\n      var spaceLayer = canvas.getLayer('space');\r\n\r\n      line = svgCreate('path');\r\n      svgAttr(line, 'd', 'M0,0 L0,0');\r\n      svgClasses(line).add('djs-crosshair');\r\n\r\n      svgAppend(spaceLayer, line);\r\n\r\n      context.line = line;\r\n\r\n      var dragGroup = svgCreate('g');\r\n      svgAttr(dragGroup, styles.cls('djs-drag-group', [ 'no-events' ]));\r\n\r\n      svgAppend(canvas.getActiveLayer(), dragGroup);\r\n\r\n      // shapes\r\n      addPreviewGfx(movingShapes, dragGroup);\r\n\r\n      // connections\r\n      var movingConnections = context.movingConnections = elementRegistry.filter(function(element) {\r\n        var sourceIsMoving = false;\r\n\r\n        forEach(movingShapes, function(shape) {\r\n          forEach(shape.outgoing, function(connection) {\r\n            if (element === connection) {\r\n              sourceIsMoving = true;\r\n            }\r\n          });\r\n        });\r\n\r\n        var targetIsMoving = false;\r\n\r\n        forEach(movingShapes, function(shape) {\r\n          forEach(shape.incoming, function(connection) {\r\n            if (element === connection) {\r\n              targetIsMoving = true;\r\n            }\r\n          });\r\n        });\r\n\r\n        var sourceIsResizing = false;\r\n\r\n        forEach(resizingShapes, function(shape) {\r\n          forEach(shape.outgoing, function(connection) {\r\n            if (element === connection) {\r\n              sourceIsResizing = true;\r\n            }\r\n          });\r\n        });\r\n\r\n        var targetIsResizing = false;\r\n\r\n        forEach(resizingShapes, function(shape) {\r\n          forEach(shape.incoming, function(connection) {\r\n            if (element === connection) {\r\n              targetIsResizing = true;\r\n            }\r\n          });\r\n        });\r\n\r\n        return isConnection(element)\r\n          && (sourceIsMoving || sourceIsResizing)\r\n          && (targetIsMoving || targetIsResizing);\r\n      });\r\n\r\n\r\n      addPreviewGfx(movingConnections, dragGroup);\r\n\r\n      context.dragGroup = dragGroup;\r\n    }\r\n\r\n    if (!context.frameGroup) {\r\n      var frameGroup = svgCreate('g');\r\n      svgAttr(frameGroup, styles.cls('djs-frame-group', [ 'no-events' ]));\r\n\r\n      svgAppend(canvas.getActiveLayer(), frameGroup);\r\n\r\n      var frames = [];\r\n\r\n      forEach(resizingShapes, function(shape) {\r\n        var frame = previewSupport.addFrame(shape, frameGroup);\r\n\r\n        var initialBounds = frame.getBBox();\r\n\r\n        frames.push({\r\n          element: frame,\r\n          initialBounds: initialBounds\r\n        });\r\n\r\n        canvas.addMarker(shape, MARKER_RESIZING);\r\n      });\r\n\r\n      context.frameGroup = frameGroup;\r\n      context.frames = frames;\r\n    }\r\n\r\n    var orientation = {\r\n      x: 'M' + event.x + ', -10000 L' + event.x + ', 10000',\r\n      y: 'M -10000, ' + event.y + ' L 10000, ' + event.y\r\n    };\r\n\r\n    svgAttr(line, { d: orientation[ axis ] });\r\n\r\n    var opposite = { x: 'y', y: 'x' };\r\n    var delta = { x: event.dx, y: event.dy };\r\n    delta[ opposite[ context.axis ] ] = 0;\r\n\r\n    // update move previews\r\n    translate(context.dragGroup, delta.x, delta.y);\r\n\r\n    // update resize previews\r\n    forEach(context.frames, function(frame) {\r\n      var element = frame.element,\r\n          initialBounds = frame.initialBounds,\r\n          width,\r\n          height;\r\n\r\n      if (context.direction === 'e') {\r\n        svgAttr(element, {\r\n          width: max(initialBounds.width + delta.x, 5)\r\n        });\r\n      } else {\r\n        width = max(initialBounds.width - delta.x, 5);\r\n\r\n        svgAttr(element, {\r\n          width: width,\r\n          x: initialBounds.x + initialBounds.width - width\r\n        });\r\n      }\r\n\r\n      if (context.direction === 's') {\r\n        svgAttr(element, {\r\n          height: max(initialBounds.height + delta.y, 5)\r\n        });\r\n      } else {\r\n        height = max(initialBounds.height - delta.y, 5);\r\n\r\n        svgAttr(element, {\r\n          height: height,\r\n          y: initialBounds.y + initialBounds.height - height\r\n        });\r\n      }\r\n    });\r\n\r\n  });\r\n\r\n  // remove move/resize previews\r\n  eventBus.on('spaceTool.cleanup', function(event) {\r\n\r\n    var context = event.context,\r\n        movingShapes = context.movingShapes,\r\n        movingConnections = context.movingConnections,\r\n        resizingShapes = context.resizingShapes,\r\n        line = context.line,\r\n        dragGroup = context.dragGroup,\r\n        frameGroup = context.frameGroup;\r\n\r\n    // moving shapes\r\n    forEach(movingShapes, function(shape) {\r\n      canvas.removeMarker(shape, MARKER_DRAGGING);\r\n    });\r\n\r\n    // moving connections\r\n    forEach(movingConnections, function(connection) {\r\n      canvas.removeMarker(connection, MARKER_DRAGGING);\r\n    });\r\n\r\n    if (dragGroup) {\r\n      svgRemove(line);\r\n      svgRemove(dragGroup);\r\n    }\r\n\r\n    forEach(resizingShapes, function(shape) {\r\n      canvas.removeMarker(shape, MARKER_RESIZING);\r\n    });\r\n\r\n    if (frameGroup) {\r\n      svgRemove(frameGroup);\r\n    }\r\n  });\r\n}\r\n\r\nSpaceToolPreview.$inject = [\r\n  'eventBus',\r\n  'elementRegistry',\r\n  'canvas',\r\n  'styles',\r\n  'previewSupport'\r\n];\r\n","import DraggingModule from '../dragging';\r\nimport RulesModule from '../rules';\r\nimport ToolManagerModule from '../tool-manager';\r\nimport PreviewSupportModule from '../preview-support';\r\nimport MouseModule from '../mouse';\r\n\r\nimport SpaceTool from './SpaceTool';\r\nimport SpaceToolPreview from './SpaceToolPreview';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'spaceToolPreview' ],\r\n  __depends__: [\r\n    DraggingModule,\r\n    RulesModule,\r\n    ToolManagerModule,\r\n    PreviewSupportModule,\r\n    MouseModule\r\n  ],\r\n  spaceTool: [ 'type', SpaceTool ],\r\n  spaceToolPreview: [ 'type', SpaceToolPreview ]\r\n};\r\n","import inherits from 'inherits-browser';\n\nimport SpaceTool from 'diagram-js/lib/features/space-tool/SpaceTool';\n\nimport { getBusinessObject, is } from '../../util/ModelUtil';\n\nimport { isHorizontal } from '../../util/DiUtil';\n\n/**\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Axis} Axis\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\n/**\n * @param {Injector} injector\n */\nexport default function BpmnSpaceTool(injector) {\n  injector.invoke(SpaceTool, this);\n}\n\nBpmnSpaceTool.$inject = [\n  'injector'\n];\n\ninherits(BpmnSpaceTool, SpaceTool);\n\n/**\n * @param {Shape[]} elements\n * @param {Axis} axis\n * @param {Point} delta\n * @param {number} start\n *\n * @return {Object}\n */\nBpmnSpaceTool.prototype.calculateAdjustments = function(elements, axis, delta, start) {\n  var adjustments = SpaceTool.prototype.calculateAdjustments.call(this, elements, axis, delta, start);\n\n  // do not resize:\n  //\n  // * text annotations (horizontally/vertically)\n  // * empty horizontal pools (vertically)\n  // * empty vertical pools (horizontally)\n  adjustments.resizingShapes = adjustments.resizingShapes.filter(function(shape) {\n\n    if (is(shape, 'bpmn:TextAnnotation')) {\n      return false;\n    }\n\n    if (isCollapsedPool(shape)) {\n      if (axis === 'y' && isHorizontal(shape) || axis === 'x' && !isHorizontal(shape)) {\n        return false;\n      }\n    }\n\n    return true;\n  });\n\n  return adjustments;\n};\n\n\n// helpers ///////////\n\nfunction isCollapsedPool(shape) {\n  return is(shape, 'bpmn:Participant') && !getBusinessObject(shape).processRef;\n}","import SpaceToolModule from 'diagram-js/lib/features/space-tool';\n\nimport BpmnSpaceTool from './BpmnSpaceTool';\n\nexport default {\n  __depends__: [ SpaceToolModule ],\n  spaceTool: [ 'type', BpmnSpaceTool ]\n};","import {\r\n  uniqueBy,\r\n  isArray\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../core/Types').ElementLike} ElementLike\r\n *\r\n * @typedef {import('../core/EventBus').default} EventBus\r\n * @typedef {import('./CommandHandler').default} CommandHandler\r\n *\r\n * @typedef { any } CommandContext\r\n * @typedef { {\r\n *   new (...args: any[]) : CommandHandler\r\n * } } CommandHandlerConstructor\r\n * @typedef { {\r\n *   [key: string]: CommandHandler;\r\n * } } CommandHandlerMap\r\n * @typedef { {\r\n *   command: string;\r\n *   context: any;\r\n *   id?: any;\r\n * } } CommandStackAction\r\n * @typedef { {\r\n *   actions: CommandStackAction[];\r\n *   dirty: ElementLike[];\r\n *   trigger: 'execute' | 'undo' | 'redo' | 'clear' | null;\r\n *   atomic?: boolean;\r\n * } } CurrentExecution\r\n */\r\n\r\n/**\r\n * A service that offers un- and redoable execution of commands.\r\n *\r\n * The command stack is responsible for executing modeling actions\r\n * in a un- and redoable manner. To do this it delegates the actual\r\n * command execution to {@link CommandHandler}s.\r\n *\r\n * Command handlers provide {@link CommandHandler#execute(ctx)} and\r\n * {@link CommandHandler#revert(ctx)} methods to un- and redo a command\r\n * identified by a command context.\r\n *\r\n *\r\n * ## Life-Cycle events\r\n *\r\n * In the process the command stack fires a number of life-cycle events\r\n * that other components to participate in the command execution.\r\n *\r\n *    * preExecute\r\n *    * preExecuted\r\n *    * execute\r\n *    * executed\r\n *    * postExecute\r\n *    * postExecuted\r\n *    * revert\r\n *    * reverted\r\n *\r\n * A special event is used for validating, whether a command can be\r\n * performed prior to its execution.\r\n *\r\n *    * canExecute\r\n *\r\n * Each of the events is fired as `commandStack.{eventName}` and\r\n * `commandStack.{commandName}.{eventName}`, respectively. This gives\r\n * components fine grained control on where to hook into.\r\n *\r\n * The event object fired transports `command`, the name of the\r\n * command and `context`, the command context.\r\n *\r\n *\r\n * ## Creating Command Handlers\r\n *\r\n * Command handlers should provide the {@link CommandHandler#execute(ctx)}\r\n * and {@link CommandHandler#revert(ctx)} methods to implement\r\n * redoing and undoing of a command.\r\n *\r\n * A command handler _must_ ensure undo is performed properly in order\r\n * not to break the undo chain. It must also return the shapes that\r\n * got changed during the `execute` and `revert` operations.\r\n *\r\n * Command handlers may execute other modeling operations (and thus\r\n * commands) in their `preExecute(d)` and `postExecute(d)` phases. The command\r\n * stack will properly group all commands together into a logical unit\r\n * that may be re- and undone atomically.\r\n *\r\n * Command handlers must not execute other commands from within their\r\n * core implementation (`execute`, `revert`).\r\n *\r\n *\r\n * ## Change Tracking\r\n *\r\n * During the execution of the CommandStack it will keep track of all\r\n * elements that have been touched during the command's execution.\r\n *\r\n * At the end of the CommandStack execution it will notify interested\r\n * components via an 'elements.changed' event with all the dirty\r\n * elements.\r\n *\r\n * The event can be picked up by components that are interested in the fact\r\n * that elements have been changed. One use case for this is updating\r\n * their graphical representation after moving / resizing or deletion.\r\n *\r\n * @see CommandHandler\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Injector} injector\r\n */\r\nexport default function CommandStack(eventBus, injector) {\r\n\r\n  /**\r\n   * A map of all registered command handlers.\r\n   *\r\n   * @type {CommandHandlerMap}\r\n   */\r\n  this._handlerMap = {};\r\n\r\n  /**\r\n   * A stack containing all re/undoable actions on the diagram\r\n   *\r\n   * @type {CommandStackAction[]}\r\n   */\r\n  this._stack = [];\r\n\r\n  /**\r\n   * The current index on the stack\r\n   *\r\n   * @type {number}\r\n   */\r\n  this._stackIdx = -1;\r\n\r\n  /**\r\n   * Current active commandStack execution\r\n   *\r\n   * @type {CurrentExecution}\r\n   */\r\n  this._currentExecution = {\r\n    actions: [],\r\n    dirty: [],\r\n    trigger: null\r\n  };\r\n\r\n  /**\r\n   * @type {Injector}\r\n   */\r\n  this._injector = injector;\r\n\r\n  /**\r\n   * @type EventBus\r\n   */\r\n  this._eventBus = eventBus;\r\n\r\n  /**\r\n   * @type { number }\r\n   */\r\n  this._uid = 1;\r\n\r\n  eventBus.on([\r\n    'diagram.destroy',\r\n    'diagram.clear'\r\n  ], function() {\r\n    this.clear(false);\r\n  }, this);\r\n}\r\n\r\nCommandStack.$inject = [ 'eventBus', 'injector' ];\r\n\r\n\r\n/**\r\n * Execute a command.\r\n *\r\n * @param {string} command The command to execute.\r\n * @param {CommandContext} context The context with which to execute the command.\r\n */\r\nCommandStack.prototype.execute = function(command, context) {\r\n  if (!command) {\r\n    throw new Error('command required');\r\n  }\r\n\r\n  this._currentExecution.trigger = 'execute';\r\n\r\n  const action = { command: command, context: context };\r\n\r\n  this._pushAction(action);\r\n  this._internalExecute(action);\r\n  this._popAction();\r\n};\r\n\r\n\r\n/**\r\n * Check whether a command can be executed.\r\n *\r\n * Implementors may hook into the mechanism on two ways:\r\n *\r\n *   * in event listeners:\r\n *\r\n *     Users may prevent the execution via an event listener.\r\n *     It must prevent the default action for `commandStack.(<command>.)canExecute` events.\r\n *\r\n *   * in command handlers:\r\n *\r\n *     If the method {@link CommandHandler#canExecute} is implemented in a handler\r\n *     it will be called to figure out whether the execution is allowed.\r\n *\r\n * @param {string} command The command to execute.\r\n * @param {CommandContext} context The context with which to execute the command.\r\n *\r\n * @return {boolean} Whether the command can be executed with the given context.\r\n */\r\nCommandStack.prototype.canExecute = function(command, context) {\r\n\r\n  const action = { command: command, context: context };\r\n\r\n  const handler = this._getHandler(command);\r\n\r\n  let result = this._fire(command, 'canExecute', action);\r\n\r\n  // handler#canExecute will only be called if no listener\r\n  // decided on a result already\r\n  if (result === undefined) {\r\n    if (!handler) {\r\n      return false;\r\n    }\r\n\r\n    if (handler.canExecute) {\r\n      result = handler.canExecute(context);\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n\r\n/**\r\n * Clear the command stack, erasing all undo / redo history.\r\n *\r\n * @param {boolean} [emit=true] Whether to fire an event. Defaults to `true`.\r\n */\r\nCommandStack.prototype.clear = function(emit) {\r\n  this._stack.length = 0;\r\n  this._stackIdx = -1;\r\n\r\n  if (emit !== false) {\r\n    this._fire('changed', { trigger: 'clear' });\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Undo last command(s)\r\n */\r\nCommandStack.prototype.undo = function() {\r\n  let action = this._getUndoAction(),\r\n      next;\r\n\r\n  if (action) {\r\n    this._currentExecution.trigger = 'undo';\r\n\r\n    this._pushAction(action);\r\n\r\n    while (action) {\r\n      this._internalUndo(action);\r\n      next = this._getUndoAction();\r\n\r\n      if (!next || next.id !== action.id) {\r\n        break;\r\n      }\r\n\r\n      action = next;\r\n    }\r\n\r\n    this._popAction();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Redo last command(s)\r\n */\r\nCommandStack.prototype.redo = function() {\r\n  let action = this._getRedoAction(),\r\n      next;\r\n\r\n  if (action) {\r\n    this._currentExecution.trigger = 'redo';\r\n\r\n    this._pushAction(action);\r\n\r\n    while (action) {\r\n      this._internalExecute(action, true);\r\n      next = this._getRedoAction();\r\n\r\n      if (!next || next.id !== action.id) {\r\n        break;\r\n      }\r\n\r\n      action = next;\r\n    }\r\n\r\n    this._popAction();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Register a handler instance with the command stack.\r\n *\r\n * @param {string} command Command to be executed.\r\n * @param {CommandHandler} handler Handler to execute the command.\r\n */\r\nCommandStack.prototype.register = function(command, handler) {\r\n  this._setHandler(command, handler);\r\n};\r\n\r\n\r\n/**\r\n * Register a handler type with the command stack  by instantiating it and\r\n * injecting its dependencies.\r\n *\r\n * @param {string} command Command to be executed.\r\n * @param {CommandHandlerConstructor} handlerCls Constructor to instantiate a {@link CommandHandler}.\r\n */\r\nCommandStack.prototype.registerHandler = function(command, handlerCls) {\r\n\r\n  if (!command || !handlerCls) {\r\n    throw new Error('command and handlerCls must be defined');\r\n  }\r\n\r\n  const handler = this._injector.instantiate(handlerCls);\r\n  this.register(command, handler);\r\n};\r\n\r\n/**\r\n * @return {boolean}\r\n */\r\nCommandStack.prototype.canUndo = function() {\r\n  return !!this._getUndoAction();\r\n};\r\n\r\n/**\r\n * @return {boolean}\r\n */\r\nCommandStack.prototype.canRedo = function() {\r\n  return !!this._getRedoAction();\r\n};\r\n\r\n// stack access  //////////////////////\r\n\r\nCommandStack.prototype._getRedoAction = function() {\r\n  return this._stack[this._stackIdx + 1];\r\n};\r\n\r\n\r\nCommandStack.prototype._getUndoAction = function() {\r\n  return this._stack[this._stackIdx];\r\n};\r\n\r\n\r\n// internal functionality //////////////////////\r\n\r\nCommandStack.prototype._internalUndo = function(action) {\r\n  const command = action.command,\r\n        context = action.context;\r\n\r\n  const handler = this._getHandler(command);\r\n\r\n  // guard against illegal nested command stack invocations\r\n  this._atomicDo(() => {\r\n    this._fire(command, 'revert', action);\r\n\r\n    if (handler.revert) {\r\n      this._markDirty(handler.revert(context));\r\n    }\r\n\r\n    this._revertedAction(action);\r\n\r\n    this._fire(command, 'reverted', action);\r\n  });\r\n};\r\n\r\n\r\nCommandStack.prototype._fire = function(command, qualifier, event) {\r\n  if (arguments.length < 3) {\r\n    event = qualifier;\r\n    qualifier = null;\r\n  }\r\n\r\n  const names = qualifier ? [ command + '.' + qualifier, qualifier ] : [ command ];\r\n  let result;\r\n\r\n  event = this._eventBus.createEvent(event);\r\n\r\n  for (const name of names) {\r\n    result = this._eventBus.fire('commandStack.' + name, event);\r\n\r\n    if (event.cancelBubble) {\r\n      break;\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nCommandStack.prototype._createId = function() {\r\n  return this._uid++;\r\n};\r\n\r\nCommandStack.prototype._atomicDo = function(fn) {\r\n\r\n  const execution = this._currentExecution;\r\n\r\n  execution.atomic = true;\r\n\r\n  try {\r\n    fn();\r\n  } finally {\r\n    execution.atomic = false;\r\n  }\r\n};\r\n\r\nCommandStack.prototype._internalExecute = function(action, redo) {\r\n  const command = action.command,\r\n        context = action.context;\r\n\r\n  const handler = this._getHandler(command);\r\n\r\n  if (!handler) {\r\n    throw new Error('no command handler registered for <' + command + '>');\r\n  }\r\n\r\n  this._pushAction(action);\r\n\r\n  if (!redo) {\r\n    this._fire(command, 'preExecute', action);\r\n\r\n    if (handler.preExecute) {\r\n      handler.preExecute(context);\r\n    }\r\n\r\n    this._fire(command, 'preExecuted', action);\r\n  }\r\n\r\n  // guard against illegal nested command stack invocations\r\n  this._atomicDo(() => {\r\n\r\n    this._fire(command, 'execute', action);\r\n\r\n    if (handler.execute) {\r\n\r\n      // actual execute + mark return results as dirty\r\n      this._markDirty(handler.execute(context));\r\n    }\r\n\r\n    // log to stack\r\n    this._executedAction(action, redo);\r\n\r\n    this._fire(command, 'executed', action);\r\n  });\r\n\r\n  if (!redo) {\r\n    this._fire(command, 'postExecute', action);\r\n\r\n    if (handler.postExecute) {\r\n      handler.postExecute(context);\r\n    }\r\n\r\n    this._fire(command, 'postExecuted', action);\r\n  }\r\n\r\n  this._popAction();\r\n};\r\n\r\n\r\nCommandStack.prototype._pushAction = function(action) {\r\n\r\n  const execution = this._currentExecution,\r\n        actions = execution.actions;\r\n\r\n  const baseAction = actions[0];\r\n\r\n  if (execution.atomic) {\r\n    throw new Error('illegal invocation in <execute> or <revert> phase (action: ' + action.command + ')');\r\n  }\r\n\r\n  if (!action.id) {\r\n    action.id = (baseAction && baseAction.id) || this._createId();\r\n  }\r\n\r\n  actions.push(action);\r\n};\r\n\r\n\r\nCommandStack.prototype._popAction = function() {\r\n  const execution = this._currentExecution,\r\n        trigger = execution.trigger,\r\n        actions = execution.actions,\r\n        dirty = execution.dirty;\r\n\r\n  actions.pop();\r\n\r\n  if (!actions.length) {\r\n    this._eventBus.fire('elements.changed', { elements: uniqueBy('id', dirty.reverse()) });\r\n\r\n    dirty.length = 0;\r\n\r\n    this._fire('changed', { trigger: trigger });\r\n\r\n    execution.trigger = null;\r\n  }\r\n};\r\n\r\n\r\nCommandStack.prototype._markDirty = function(elements) {\r\n  const execution = this._currentExecution;\r\n\r\n  if (!elements) {\r\n    return;\r\n  }\r\n\r\n  elements = isArray(elements) ? elements : [ elements ];\r\n\r\n  execution.dirty = execution.dirty.concat(elements);\r\n};\r\n\r\n\r\nCommandStack.prototype._executedAction = function(action, redo) {\r\n  const stackIdx = ++this._stackIdx;\r\n\r\n  if (!redo) {\r\n    this._stack.splice(stackIdx, this._stack.length, action);\r\n  }\r\n};\r\n\r\n\r\nCommandStack.prototype._revertedAction = function(action) {\r\n  this._stackIdx--;\r\n};\r\n\r\n\r\nCommandStack.prototype._getHandler = function(command) {\r\n  return this._handlerMap[command];\r\n};\r\n\r\nCommandStack.prototype._setHandler = function(command, handler) {\r\n  if (!command || !handler) {\r\n    throw new Error('command and handler required');\r\n  }\r\n\r\n  if (this._handlerMap[command]) {\r\n    throw new Error('overriding handler for command <' + command + '>');\r\n  }\r\n\r\n  this._handlerMap[command] = handler;\r\n};\r\n","import CommandStack from './CommandStack';\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  commandStack: [ 'type', CommandStack ]\r\n};\r\n","/**\r\n * Remove from the beginning of a collection until it is empty.\r\n *\r\n * This is a null-safe operation that ensures elements\r\n * are being removed from the given collection until the\r\n * collection is empty.\r\n *\r\n * The implementation deals with the fact that a remove operation\r\n * may touch, i.e. remove multiple elements in the collection\r\n * at a time.\r\n *\r\n * @param {Object[]} [collection]\r\n * @param {(element: Object) => void} removeFn\r\n *\r\n * @return {Object[]} the cleared collection\r\n */\r\nexport function saveClear(collection, removeFn) {\r\n\r\n  if (typeof removeFn !== 'function') {\r\n    throw new Error('removeFn iterator must be a function');\r\n  }\r\n\r\n  if (!collection) {\r\n    return;\r\n  }\r\n\r\n  var e;\r\n\r\n  while ((e = collection[0])) {\r\n    removeFn(e);\r\n  }\r\n\r\n  return collection;\r\n}\r\n","import {\r\n  forEach,\r\n  filter\r\n} from 'min-dash';\r\n\r\nimport inherits from 'inherits-browser';\r\n\r\nvar LOW_PRIORITY = 250,\r\n    HIGH_PRIORITY = 1400;\r\n\r\nimport {\r\n  add as collectionAdd,\r\n  indexOf as collectionIdx\r\n} from '../../util/Collections';\r\n\r\nimport { saveClear } from '../../util/Removal';\r\n\r\nimport CommandInterceptor from '../../command/CommandInterceptor';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that makes sure labels are properly moved with\r\n * their label targets.\r\n *\r\n * @param {Injector} injector\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n */\r\nexport default function LabelSupport(injector, eventBus, modeling) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  var movePreview = injector.get('movePreview', false);\r\n\r\n  // remove labels from the collection that are being\r\n  // moved with other elements anyway\r\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(e) {\r\n\r\n    var context = e.context,\r\n        shapes = context.shapes,\r\n        validatedShapes = context.validatedShapes;\r\n\r\n    context.shapes = removeLabels(shapes);\r\n    context.validatedShapes = removeLabels(validatedShapes);\r\n  });\r\n\r\n  // add labels to visual's group\r\n  movePreview && eventBus.on('shape.move.start', LOW_PRIORITY, function(e) {\r\n\r\n    var context = e.context,\r\n        shapes = context.shapes;\r\n\r\n    var labels = [];\r\n\r\n    forEach(shapes, function(element) {\r\n\r\n      forEach(element.labels, function(label) {\r\n\r\n        if (!label.hidden && context.shapes.indexOf(label) === -1) {\r\n          labels.push(label);\r\n        }\r\n\r\n        if (element.labelTarget) {\r\n          labels.push(element);\r\n        }\r\n      });\r\n    });\r\n\r\n    forEach(labels, function(label) {\r\n      movePreview.makeDraggable(context, label, true);\r\n    });\r\n\r\n  });\r\n\r\n  // add all labels to move closure\r\n  this.preExecuted('elements.move', HIGH_PRIORITY, function(e) {\r\n    var context = e.context,\r\n        closure = context.closure,\r\n        enclosedElements = closure.enclosedElements;\r\n\r\n    var enclosedLabels = [];\r\n\r\n    // find labels that are not part of\r\n    // move closure yet and add them\r\n    forEach(enclosedElements, function(element) {\r\n      forEach(element.labels, function(label) {\r\n\r\n        if (!enclosedElements[label.id]) {\r\n          enclosedLabels.push(label);\r\n        }\r\n      });\r\n    });\r\n\r\n    closure.addAll(enclosedLabels);\r\n  });\r\n\r\n\r\n  this.preExecute([\r\n    'connection.delete',\r\n    'shape.delete'\r\n  ], function(e) {\r\n\r\n    var context = e.context,\r\n        element = context.connection || context.shape;\r\n\r\n    saveClear(element.labels, function(label) {\r\n      modeling.removeShape(label, { nested: true });\r\n    });\r\n  });\r\n\r\n\r\n  this.execute('shape.delete', function(e) {\r\n\r\n    var context = e.context,\r\n        shape = context.shape,\r\n        labelTarget = shape.labelTarget;\r\n\r\n    // unset labelTarget\r\n    if (labelTarget) {\r\n      context.labelTargetIndex = collectionIdx(labelTarget.labels, shape);\r\n      context.labelTarget = labelTarget;\r\n\r\n      shape.labelTarget = null;\r\n    }\r\n  });\r\n\r\n  this.revert('shape.delete', function(e) {\r\n\r\n    var context = e.context,\r\n        shape = context.shape,\r\n        labelTarget = context.labelTarget,\r\n        labelTargetIndex = context.labelTargetIndex;\r\n\r\n    // restore labelTarget\r\n    if (labelTarget) {\r\n      collectionAdd(labelTarget.labels, shape, labelTargetIndex);\r\n\r\n      shape.labelTarget = labelTarget;\r\n    }\r\n  });\r\n\r\n}\r\n\r\ninherits(LabelSupport, CommandInterceptor);\r\n\r\nLabelSupport.$inject = [\r\n  'injector',\r\n  'eventBus',\r\n  'modeling'\r\n];\r\n\r\n\r\n/**\r\n * Return a filtered list of elements that do not\r\n * contain attached elements with hosts being part\r\n * of the selection.\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {Element[]} filtered\r\n */\r\nfunction removeLabels(elements) {\r\n\r\n  return filter(elements, function(element) {\r\n\r\n    // filter out labels that are move together\r\n    // with their label targets\r\n    return elements.indexOf(element.labelTarget) === -1;\r\n  });\r\n}\r\n","import LabelSupport from './LabelSupport';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'labelSupport' ],\r\n  labelSupport: [ 'type', LabelSupport ]\r\n};\r\n","import {\r\n  flatten,\r\n  filter,\r\n  forEach,\r\n  groupBy,\r\n  map,\r\n  unionBy\r\n} from 'min-dash';\r\n\r\nimport { saveClear } from '../../util/Removal';\r\n\r\nimport { getNewAttachShapeDelta } from '../../util/AttachUtil';\r\n\r\nimport inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from '../../command/CommandInterceptor';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../rules/Rules').default} Rules\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n */\r\n\r\nvar LOW_PRIORITY = 251,\r\n    HIGH_PRIORITY = 1401;\r\n\r\nvar MARKER_ATTACH = 'attach-ok';\r\n\r\n\r\n/**\r\n * Adds the notion of attached elements to the modeler.\r\n *\r\n * Optionally depends on `diagram-js/lib/features/move` to render\r\n * the attached elements during move preview.\r\n *\r\n * Optionally depends on `diagram-js/lib/features/label-support`\r\n * to render attached labels during move preview.\r\n *\r\n * @param {Injector} injector\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Rules} rules\r\n * @param {Modeling} modeling\r\n */\r\nexport default function AttachSupport(injector, eventBus, canvas, rules, modeling) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  var movePreview = injector.get('movePreview', false);\r\n\r\n\r\n  // remove all the attached elements from the shapes to be validated\r\n  // add all the attached shapes to the overall list of moved shapes\r\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(e) {\r\n\r\n    var context = e.context,\r\n        shapes = context.shapes,\r\n        validatedShapes = context.validatedShapes;\r\n\r\n    context.shapes = addAttached(shapes);\r\n\r\n    context.validatedShapes = removeAttached(validatedShapes);\r\n  });\r\n\r\n  // add attachers to the visual's group\r\n  movePreview && eventBus.on('shape.move.start', LOW_PRIORITY, function(e) {\r\n\r\n    var context = e.context,\r\n        shapes = context.shapes,\r\n        attachers = getAttachers(shapes);\r\n\r\n    forEach(attachers, function(attacher) {\r\n      movePreview.makeDraggable(context, attacher, true);\r\n\r\n      forEach(attacher.labels, function(label) {\r\n        movePreview.makeDraggable(context, label, true);\r\n      });\r\n    });\r\n  });\r\n\r\n  // add attach-ok marker to current host\r\n  movePreview && eventBus.on('shape.move.start', function(event) {\r\n    var context = event.context,\r\n        shapes = context.shapes;\r\n\r\n    if (shapes.length !== 1) {\r\n      return;\r\n    }\r\n\r\n    var shape = shapes[0];\r\n\r\n    var host = shape.host;\r\n\r\n    if (host) {\r\n      canvas.addMarker(host, MARKER_ATTACH);\r\n\r\n      eventBus.once([\r\n        'shape.move.out',\r\n        'shape.move.cleanup'\r\n      ], function() {\r\n        canvas.removeMarker(host, MARKER_ATTACH);\r\n      });\r\n    }\r\n  });\r\n\r\n  // add all attachers to move closure\r\n  this.preExecuted('elements.move', HIGH_PRIORITY, function(e) {\r\n    var context = e.context,\r\n        closure = context.closure,\r\n        shapes = context.shapes,\r\n        attachers = getAttachers(shapes);\r\n\r\n    forEach(attachers, function(attacher) {\r\n      closure.add(attacher, closure.topLevel[attacher.host.id]);\r\n    });\r\n  });\r\n\r\n  // perform the attaching after shapes are done moving\r\n  this.postExecuted('elements.move', function(e) {\r\n\r\n    var context = e.context,\r\n        shapes = context.shapes,\r\n        newHost = context.newHost,\r\n        attachers;\r\n\r\n    // only single elements can be attached\r\n    // multiply elements can be detached\r\n    if (newHost && shapes.length !== 1) {\r\n      return;\r\n    }\r\n\r\n    if (newHost) {\r\n      attachers = shapes;\r\n    } else {\r\n\r\n      // find attachers moved without host\r\n      attachers = filter(shapes, function(shape) {\r\n        var host = shape.host;\r\n\r\n        return isAttacher(shape) && !includes(shapes, host);\r\n      });\r\n    }\r\n\r\n    forEach(attachers, function(attacher) {\r\n      modeling.updateAttachment(attacher, newHost);\r\n    });\r\n  });\r\n\r\n  // ensure invalid attachment connections are removed\r\n  this.postExecuted('elements.move', function(e) {\r\n\r\n    var shapes = e.context.shapes;\r\n\r\n    forEach(shapes, function(shape) {\r\n\r\n      forEach(shape.attachers, function(attacher) {\r\n\r\n        // remove invalid outgoing connections\r\n        forEach(attacher.outgoing.slice(), function(connection) {\r\n          var allowed = rules.allowed('connection.reconnect', {\r\n            connection: connection,\r\n            source: connection.source,\r\n            target: connection.target\r\n          });\r\n\r\n          if (!allowed) {\r\n            modeling.removeConnection(connection);\r\n          }\r\n        });\r\n\r\n        // remove invalid incoming connections\r\n        forEach(attacher.incoming.slice(), function(connection) {\r\n          var allowed = rules.allowed('connection.reconnect', {\r\n            connection: connection,\r\n            source: connection.source,\r\n            target: connection.target\r\n          });\r\n\r\n          if (!allowed) {\r\n            modeling.removeConnection(connection);\r\n          }\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  this.postExecute('shape.create', function(e) {\r\n    var context = e.context,\r\n        shape = context.shape,\r\n        host = context.host;\r\n\r\n    if (host) {\r\n      modeling.updateAttachment(shape, host);\r\n    }\r\n  });\r\n\r\n  // update attachments if the host is replaced\r\n  this.postExecute('shape.replace', function(e) {\r\n\r\n    var context = e.context,\r\n        oldShape = context.oldShape,\r\n        newShape = context.newShape;\r\n\r\n    // move the attachers to the new host\r\n    saveClear(oldShape.attachers, function(attacher) {\r\n      var allowed = rules.allowed('elements.move', {\r\n        target: newShape,\r\n        shapes: [ attacher ]\r\n      });\r\n\r\n      if (allowed === 'attach') {\r\n        modeling.updateAttachment(attacher, newShape);\r\n      } else {\r\n        modeling.removeShape(attacher);\r\n      }\r\n    });\r\n\r\n    // move attachers if new host has different size\r\n    if (newShape.attachers.length) {\r\n\r\n      forEach(newShape.attachers, function(attacher) {\r\n        var delta = getNewAttachShapeDelta(attacher, oldShape, newShape);\r\n        modeling.moveShape(attacher, delta, attacher.parent);\r\n      });\r\n    }\r\n\r\n  });\r\n\r\n  // move shape on host resize\r\n  this.postExecute('shape.resize', function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        oldBounds = context.oldBounds,\r\n        newBounds = context.newBounds,\r\n        attachers = shape.attachers,\r\n        hints = context.hints || {};\r\n\r\n    if (hints.attachSupport === false) {\r\n      return;\r\n    }\r\n\r\n    forEach(attachers, function(attacher) {\r\n      var delta = getNewAttachShapeDelta(attacher, oldBounds, newBounds);\r\n\r\n      modeling.moveShape(attacher, delta, attacher.parent);\r\n\r\n      forEach(attacher.labels, function(label) {\r\n        modeling.moveShape(label, delta, label.parent);\r\n      });\r\n    });\r\n  });\r\n\r\n  // remove attachments\r\n  this.preExecute('shape.delete', function(event) {\r\n\r\n    var shape = event.context.shape;\r\n\r\n    saveClear(shape.attachers, function(attacher) {\r\n      modeling.removeShape(attacher);\r\n    });\r\n\r\n    if (shape.host) {\r\n      modeling.updateAttachment(shape, null);\r\n    }\r\n  });\r\n}\r\n\r\ninherits(AttachSupport, CommandInterceptor);\r\n\r\nAttachSupport.$inject = [\r\n  'injector',\r\n  'eventBus',\r\n  'canvas',\r\n  'rules',\r\n  'modeling'\r\n];\r\n\r\n\r\n/**\r\n * Return attachers of the given shapes\r\n *\r\n * @param {Element[]} shapes\r\n * @return {Element[]}\r\n */\r\nfunction getAttachers(shapes) {\r\n  return flatten(map(shapes, function(s) {\r\n    return s.attachers || [];\r\n  }));\r\n}\r\n\r\n/**\r\n * Return a combined list of elements and\r\n * attachers.\r\n *\r\n * @param {Element[]} elements\r\n * @return {Element[]} filtered\r\n */\r\nfunction addAttached(elements) {\r\n  var attachers = getAttachers(elements);\r\n\r\n  return unionBy('id', elements, attachers);\r\n}\r\n\r\n/**\r\n * Return a filtered list of elements that do not\r\n * contain attached elements with hosts being part\r\n * of the selection.\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {Element[]} filtered\r\n */\r\nfunction removeAttached(elements) {\r\n\r\n  var ids = groupBy(elements, 'id');\r\n\r\n  return filter(elements, function(element) {\r\n    while (element) {\r\n\r\n      // host in selection\r\n      if (element.host && ids[element.host.id]) {\r\n        return false;\r\n      }\r\n\r\n      element = element.parent;\r\n    }\r\n\r\n    return true;\r\n  });\r\n}\r\n\r\nfunction isAttacher(shape) {\r\n  return !!shape.host;\r\n}\r\n\r\nfunction includes(array, item) {\r\n  return array.indexOf(item) !== -1;\r\n}","import RulesModule from '../rules';\r\n\r\nimport AttachSupport from './AttachSupport';\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    RulesModule\r\n  ],\r\n  __init__: [ 'attachSupport' ],\r\n  attachSupport: [ 'type', AttachSupport ]\r\n};\r\n","import {\n  map,\n  assign,\n  pick\n} from 'min-dash';\n\nimport {\n  isAny\n} from './util/ModelingUtil';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\n/**\n * @typedef {import('../../model/Types').Moddle} Moddle\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\n/**\n * A factory for BPMN elements.\n *\n * @param {Moddle} moddle\n */\nexport default function BpmnFactory(moddle) {\n  this._model = moddle;\n}\n\nBpmnFactory.$inject = [ 'moddle' ];\n\n/**\n * @param {ModdleElement} element\n *\n * @return {boolean}\n */\nBpmnFactory.prototype._needsId = function(element) {\n  return isAny(element, [\n    'bpmn:RootElement',\n    'bpmn:FlowElement',\n    'bpmn:MessageFlow',\n    'bpmn:DataAssociation',\n    'bpmn:Artifact',\n    'bpmn:Participant',\n    'bpmn:Lane',\n    'bpmn:LaneSet',\n    'bpmn:Process',\n    'bpmn:Collaboration',\n    'bpmndi:BPMNShape',\n    'bpmndi:BPMNEdge',\n    'bpmndi:BPMNDiagram',\n    'bpmndi:BPMNPlane',\n    'bpmn:Property',\n    'bpmn:CategoryValue'\n  ]);\n};\n\n/**\n * @param {ModdleElement} element\n */\nBpmnFactory.prototype._ensureId = function(element) {\n  if (element.id) {\n    this._model.ids.claim(element.id, element);\n    return;\n  }\n\n  // generate semantic ids for elements\n  // bpmn:SequenceFlow -> SequenceFlow_ID\n  var prefix;\n\n  if (is(element, 'bpmn:Activity')) {\n    prefix = 'Activity';\n  } else if (is(element, 'bpmn:Event')) {\n    prefix = 'Event';\n  } else if (is(element, 'bpmn:Gateway')) {\n    prefix = 'Gateway';\n  } else if (isAny(element, [ 'bpmn:SequenceFlow', 'bpmn:MessageFlow' ])) {\n    prefix = 'Flow';\n  } else {\n    prefix = (element.$type || '').replace(/^[^:]*:/g, '');\n  }\n\n  prefix += '_';\n\n  if (!element.id && this._needsId(element)) {\n    element.id = this._model.ids.nextPrefixed(prefix, element);\n  }\n};\n\n/**\n * Create BPMN element.\n *\n * @param {string} type\n * @param {Object} [attrs]\n *\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.create = function(type, attrs) {\n  var element = this._model.create(type, attrs || {});\n\n  this._ensureId(element);\n\n  return element;\n};\n\n/**\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiLabel = function() {\n  return this.create('bpmndi:BPMNLabel', {\n    bounds: this.createDiBounds()\n  });\n};\n\n/**\n * @param {ModdleElement} semantic\n * @param {Object} [attrs]\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiShape = function(semantic, attrs) {\n  return this.create('bpmndi:BPMNShape', assign({\n    bpmnElement: semantic,\n    bounds: this.createDiBounds()\n  }, attrs));\n};\n\n/**\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiBounds = function(bounds) {\n  return this.create('dc:Bounds', bounds);\n};\n\n/**\n * @param {Point[]} waypoints\n *\n * @return {ModdleElement[]}\n */\nBpmnFactory.prototype.createDiWaypoints = function(waypoints) {\n  var self = this;\n\n  return map(waypoints, function(pos) {\n    return self.createDiWaypoint(pos);\n  });\n};\n\n/**\n * @param {Point} point\n *\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiWaypoint = function(point) {\n  return this.create('dc:Point', pick(point, [ 'x', 'y' ]));\n};\n\n/**\n * @param {ModdleElement} semantic\n * @param {Object} [attrs]\n *\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiEdge = function(semantic, attrs) {\n  return this.create('bpmndi:BPMNEdge', assign({\n    bpmnElement: semantic,\n    waypoint: this.createDiWaypoints([])\n  }, attrs));\n};\n\n/**\n * @param {ModdleElement} semantic\n * @param {Object} [attrs]\n *\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiPlane = function(semantic, attrs) {\n  return this.create('bpmndi:BPMNPlane', assign({\n    bpmnElement: semantic\n  }, attrs));\n};\n","import {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport {\n  getBusinessObject,\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport { isAny } from './util/ModelingUtil';\n\nimport {\n  getLabel,\n  isLabel,\n  isLabelExternal\n} from '../../util/LabelUtil';\n\nimport { isPlane } from '../../util/DrilldownUtil';\n\nimport { delta } from 'diagram-js/lib/util/PositionUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('./BpmnFactory').default} BpmnFactory\n * @typedef {import('diagram-js/lib/layout/CroppingConnectionDocking').default} CroppingConnectionDocking\n *\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').Parent} Parent\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * A handler responsible for updating the underlying BPMN 2.0 XML & DI\n * once changes on the diagram happen.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n * @param {CroppingConnectionDocking} connectionDocking\n */\nexport default function BpmnUpdater(\n    eventBus,\n    bpmnFactory,\n    connectionDocking\n) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this._bpmnFactory = bpmnFactory;\n\n  var self = this;\n\n\n  // connection cropping //////////////////////\n\n  // crop connection ends during create/update\n  function cropConnection(e) {\n    var context = e.context,\n        hints = context.hints || {},\n        connection;\n\n    if (!context.cropped && hints.createElementsBehavior !== false) {\n      connection = context.connection;\n      connection.waypoints = connectionDocking.getCroppedWaypoints(connection);\n      context.cropped = true;\n    }\n  }\n\n  this.executed([\n    'connection.layout',\n    'connection.create'\n  ], cropConnection);\n\n  this.reverted([ 'connection.layout' ], function(e) {\n    delete e.context.cropped;\n  });\n\n\n\n  // BPMN + DI update //////////////////////\n\n\n  // update parent\n  function updateParent(e) {\n    var context = e.context;\n\n    self.updateParent(context.shape || context.connection, context.oldParent);\n  }\n\n  function reverseUpdateParent(e) {\n    var context = e.context;\n\n    var element = context.shape || context.connection,\n\n        // oldParent is the (old) new parent, because we are undoing\n        oldParent = context.parent || context.newParent;\n\n    self.updateParent(element, oldParent);\n  }\n\n  this.executed([\n    'shape.move',\n    'shape.create',\n    'shape.delete',\n    'connection.create',\n    'connection.move',\n    'connection.delete'\n  ], ifBpmn(updateParent));\n\n  this.reverted([\n    'shape.move',\n    'shape.create',\n    'shape.delete',\n    'connection.create',\n    'connection.move',\n    'connection.delete'\n  ], ifBpmn(reverseUpdateParent));\n\n  /*\n   * ## Updating Parent\n   *\n   * When morphing a Process into a Collaboration or vice-versa,\n   * make sure that both the *semantic* and *di* parent of each element\n   * is updated.\n   *\n   */\n  function updateRoot(event) {\n    var context = event.context,\n        oldRoot = context.oldRoot,\n        children = oldRoot.children;\n\n    forEach(children, function(child) {\n      if (is(child, 'bpmn:BaseElement')) {\n        self.updateParent(child);\n      }\n    });\n  }\n\n  this.executed([ 'canvas.updateRoot' ], updateRoot);\n  this.reverted([ 'canvas.updateRoot' ], updateRoot);\n\n\n  // update bounds\n  function updateBounds(e) {\n    var shape = e.context.shape;\n\n    if (!is(shape, 'bpmn:BaseElement')) {\n      return;\n    }\n\n    self.updateBounds(shape);\n  }\n\n  this.executed([ 'shape.move', 'shape.create', 'shape.resize' ], ifBpmn(function(event) {\n\n    // exclude labels because they're handled separately during shape.changed\n    if (event.context.shape.type === 'label') {\n      return;\n    }\n\n    updateBounds(event);\n  }));\n\n  this.reverted([ 'shape.move', 'shape.create', 'shape.resize' ], ifBpmn(function(event) {\n\n    // exclude labels because they're handled separately during shape.changed\n    if (event.context.shape.type === 'label') {\n      return;\n    }\n\n    updateBounds(event);\n  }));\n\n  // Handle labels separately. This is necessary, because the label bounds have to be updated\n  // every time its shape changes, not only on move, create and resize.\n  eventBus.on('shape.changed', function(event) {\n    if (event.element.type === 'label') {\n      updateBounds({ context: { shape: event.element } });\n    }\n  });\n\n  // attach / detach connection\n  function updateConnection(e) {\n    self.updateConnection(e.context);\n  }\n\n  this.executed([\n    'connection.create',\n    'connection.move',\n    'connection.delete',\n    'connection.reconnect'\n  ], ifBpmn(updateConnection));\n\n  this.reverted([\n    'connection.create',\n    'connection.move',\n    'connection.delete',\n    'connection.reconnect'\n  ], ifBpmn(updateConnection));\n\n\n  // update waypoints\n  function updateConnectionWaypoints(e) {\n    self.updateConnectionWaypoints(e.context.connection);\n  }\n\n  this.executed([\n    'connection.layout',\n    'connection.move',\n    'connection.updateWaypoints',\n  ], ifBpmn(updateConnectionWaypoints));\n\n  this.reverted([\n    'connection.layout',\n    'connection.move',\n    'connection.updateWaypoints',\n  ], ifBpmn(updateConnectionWaypoints));\n\n  // update conditional/default flows\n  this.executed('connection.reconnect', ifBpmn(function(event) {\n    var context = event.context,\n        connection = context.connection,\n        oldSource = context.oldSource,\n        newSource = context.newSource,\n        connectionBo = getBusinessObject(connection),\n        oldSourceBo = getBusinessObject(oldSource),\n        newSourceBo = getBusinessObject(newSource);\n\n    // remove condition from connection on reconnect to new source\n    // if new source can NOT have condional sequence flow\n    if (connectionBo.conditionExpression && !isAny(newSourceBo, [\n      'bpmn:Activity',\n      'bpmn:ExclusiveGateway',\n      'bpmn:InclusiveGateway'\n    ])) {\n      context.oldConditionExpression = connectionBo.conditionExpression;\n\n      delete connectionBo.conditionExpression;\n    }\n\n    // remove default from old source flow on reconnect to new source\n    // if source changed\n    if (oldSource !== newSource && oldSourceBo.default === connectionBo) {\n      context.oldDefault = oldSourceBo.default;\n\n      delete oldSourceBo.default;\n    }\n  }));\n\n  this.reverted('connection.reconnect', ifBpmn(function(event) {\n    var context = event.context,\n        connection = context.connection,\n        oldSource = context.oldSource,\n        newSource = context.newSource,\n        connectionBo = getBusinessObject(connection),\n        oldSourceBo = getBusinessObject(oldSource),\n        newSourceBo = getBusinessObject(newSource);\n\n    // add condition to connection on revert reconnect to new source\n    if (context.oldConditionExpression) {\n      connectionBo.conditionExpression = context.oldConditionExpression;\n    }\n\n    // add default to old source on revert reconnect to new source\n    if (context.oldDefault) {\n      oldSourceBo.default = context.oldDefault;\n\n      delete newSourceBo.default;\n    }\n  }));\n\n  // update attachments\n  function updateAttachment(e) {\n    self.updateAttachment(e.context);\n  }\n\n  this.executed([ 'element.updateAttachment' ], ifBpmn(updateAttachment));\n  this.reverted([ 'element.updateAttachment' ], ifBpmn(updateAttachment));\n\n\n  // update BPMNLabel\n  this.executed('element.updateLabel', ifBpmn(updateBPMNLabel));\n  this.reverted('element.updateLabel', ifBpmn(updateBPMNLabel));\n\n  function updateBPMNLabel(event) {\n    const { element } = event.context,\n          label = getLabel(element);\n    const di = getDi(element),\n          diLabel = di && di.get('label');\n\n    if (isLabelExternal(element) || isPlane(element)) {\n      return;\n    }\n\n    if (label && !diLabel) {\n      di.set('label', bpmnFactory.create('bpmndi:BPMNLabel'));\n    } else if (!label && diLabel) {\n      di.set('label', undefined);\n    }\n  }\n}\n\ninherits(BpmnUpdater, CommandInterceptor);\n\nBpmnUpdater.$inject = [\n  'eventBus',\n  'bpmnFactory',\n  'connectionDocking'\n];\n\n\n// implementation //////////////////////\n\n/**\n * @param { {\n *   shape: Shape;\n *   host: Shape;\n * } } context\n */\nBpmnUpdater.prototype.updateAttachment = function(context) {\n\n  var shape = context.shape,\n      businessObject = shape.businessObject,\n      host = shape.host;\n\n  businessObject.attachedToRef = host && host.businessObject;\n};\n\n/**\n * @param {Element} element\n * @param {Parent} oldParent\n */\nBpmnUpdater.prototype.updateParent = function(element, oldParent) {\n\n  // do not update BPMN 2.0 label parent\n  if (isLabel(element)) {\n    return;\n  }\n\n  // data stores in collaborations are handled separately by DataStoreBehavior\n  if (is(element, 'bpmn:DataStoreReference') &&\n      element.parent &&\n      is(element.parent, 'bpmn:Collaboration')) {\n    return;\n  }\n\n  var parentShape = element.parent;\n\n  var businessObject = element.businessObject,\n      di = getDi(element),\n      parentBusinessObject = parentShape && parentShape.businessObject,\n      parentDi = getDi(parentShape);\n\n  if (is(element, 'bpmn:FlowNode')) {\n    this.updateFlowNodeRefs(businessObject, parentBusinessObject, oldParent && oldParent.businessObject);\n  }\n\n  if (is(element, 'bpmn:DataOutputAssociation')) {\n    if (element.source) {\n      parentBusinessObject = element.source.businessObject;\n    } else {\n      parentBusinessObject = null;\n    }\n  }\n\n  if (is(element, 'bpmn:DataInputAssociation')) {\n    if (element.target) {\n      parentBusinessObject = element.target.businessObject;\n    } else {\n      parentBusinessObject = null;\n    }\n  }\n\n  this.updateSemanticParent(businessObject, parentBusinessObject);\n\n  if (is(element, 'bpmn:DataObjectReference') && businessObject.dataObjectRef) {\n    this.updateSemanticParent(businessObject.dataObjectRef, parentBusinessObject);\n  }\n\n  this.updateDiParent(di, parentDi);\n};\n\n/**\n * @param {Shape} shape\n */\nBpmnUpdater.prototype.updateBounds = function(shape) {\n\n  var di = getDi(shape),\n      embeddedLabelBounds = getEmbeddedLabelBounds(shape);\n\n  // update embedded label bounds if possible\n  if (embeddedLabelBounds) {\n    var embeddedLabelBoundsDelta = delta(embeddedLabelBounds, di.get('bounds'));\n\n    assign(embeddedLabelBounds, {\n      x: shape.x + embeddedLabelBoundsDelta.x,\n      y: shape.y + embeddedLabelBoundsDelta.y\n    });\n  }\n\n  var target = isLabel(shape) ? this._getLabel(di) : di;\n\n  var bounds = target.bounds;\n\n  if (!bounds) {\n    bounds = this._bpmnFactory.createDiBounds();\n    target.set('bounds', bounds);\n  }\n\n  assign(bounds, {\n    x: shape.x,\n    y: shape.y,\n    width: shape.width,\n    height: shape.height\n  });\n};\n\n/**\n * @param {ModdleElement} businessObject\n * @param {ModdleElement} newContainment\n * @param {ModdleElement} oldContainment\n */\nBpmnUpdater.prototype.updateFlowNodeRefs = function(businessObject, newContainment, oldContainment) {\n\n  if (oldContainment === newContainment) {\n    return;\n  }\n\n  var oldRefs, newRefs;\n\n  if (is (oldContainment, 'bpmn:Lane')) {\n    oldRefs = oldContainment.get('flowNodeRef');\n    collectionRemove(oldRefs, businessObject);\n  }\n\n  if (is(newContainment, 'bpmn:Lane')) {\n    newRefs = newContainment.get('flowNodeRef');\n    collectionAdd(newRefs, businessObject);\n  }\n};\n\n/**\n * @param {Connection} connection\n * @param {Element} newSource\n * @param {Element} newTarget\n */\nBpmnUpdater.prototype.updateDiConnection = function(connection, newSource, newTarget) {\n  var connectionDi = getDi(connection),\n      newSourceDi = getDi(newSource),\n      newTargetDi = getDi(newTarget);\n\n  if (connectionDi.sourceElement && connectionDi.sourceElement.bpmnElement !== getBusinessObject(newSource)) {\n    connectionDi.sourceElement = newSource && newSourceDi;\n  }\n\n  if (connectionDi.targetElement && connectionDi.targetElement.bpmnElement !== getBusinessObject(newTarget)) {\n    connectionDi.targetElement = newTarget && newTargetDi;\n  }\n\n};\n\n/**\n * @param {ModdleElement} di\n * @param {ModdleElement} parentDi\n */\nBpmnUpdater.prototype.updateDiParent = function(di, parentDi) {\n\n  if (parentDi && !is(parentDi, 'bpmndi:BPMNPlane')) {\n    parentDi = parentDi.$parent;\n  }\n\n  if (di.$parent === parentDi) {\n    return;\n  }\n\n  var planeElements = (parentDi || di.$parent).get('planeElement');\n\n  if (parentDi) {\n    planeElements.push(di);\n    di.$parent = parentDi;\n  } else {\n    collectionRemove(planeElements, di);\n    di.$parent = null;\n  }\n};\n\n/**\n * @param {ModdleElement} element\n *\n * @return {ModdleElement}\n */\nfunction getDefinitions(element) {\n  while (element && !is(element, 'bpmn:Definitions')) {\n    element = element.$parent;\n  }\n\n  return element;\n}\n\n/**\n * @param {ModdleElement} container\n *\n * @return {ModdleElement}\n */\nBpmnUpdater.prototype.getLaneSet = function(container) {\n\n  var laneSet, laneSets;\n\n  // bpmn:Lane\n  if (is(container, 'bpmn:Lane')) {\n    laneSet = container.childLaneSet;\n\n    if (!laneSet) {\n      laneSet = this._bpmnFactory.create('bpmn:LaneSet');\n      container.childLaneSet = laneSet;\n      laneSet.$parent = container;\n    }\n\n    return laneSet;\n  }\n\n  // bpmn:Participant\n  if (is(container, 'bpmn:Participant')) {\n    container = container.processRef;\n  }\n\n  // bpmn:FlowElementsContainer\n  laneSets = container.get('laneSets');\n  laneSet = laneSets[0];\n\n  if (!laneSet) {\n    laneSet = this._bpmnFactory.create('bpmn:LaneSet');\n    laneSet.$parent = container;\n    laneSets.push(laneSet);\n  }\n\n  return laneSet;\n};\n\n/**\n * @param {ModdleElement} businessObject\n * @param {ModdleElement} newParent\n * @param {ModdleElement} visualParent\n */\nBpmnUpdater.prototype.updateSemanticParent = function(businessObject, newParent, visualParent) {\n\n  var containment;\n\n  if (businessObject.$parent === newParent) {\n    return;\n  }\n\n  if (is(businessObject, 'bpmn:DataInput') || is(businessObject, 'bpmn:DataOutput')) {\n\n    if (is(newParent, 'bpmn:Participant') && 'processRef' in newParent) {\n      newParent = newParent.processRef;\n    }\n\n    // already in correct ioSpecification\n    if ('ioSpecification' in newParent && newParent.ioSpecification === businessObject.$parent) {\n      return;\n    }\n  }\n\n  if (is(businessObject, 'bpmn:Lane')) {\n\n    if (newParent) {\n      newParent = this.getLaneSet(newParent);\n    }\n\n    containment = 'lanes';\n  } else\n\n  if (is(businessObject, 'bpmn:FlowElement')) {\n\n    if (newParent) {\n\n      if (is(newParent, 'bpmn:Participant')) {\n        newParent = newParent.processRef;\n      } else\n\n      if (is(newParent, 'bpmn:Lane')) {\n        do {\n\n          // unwrap Lane -> LaneSet -> (Lane | FlowElementsContainer)\n          newParent = newParent.$parent.$parent;\n        } while (is(newParent, 'bpmn:Lane'));\n\n      }\n    }\n\n    containment = 'flowElements';\n\n  } else\n\n  if (is(businessObject, 'bpmn:Artifact')) {\n\n    while (newParent &&\n           !is(newParent, 'bpmn:Process') &&\n           !is(newParent, 'bpmn:SubProcess') &&\n           !is(newParent, 'bpmn:Collaboration')) {\n\n      if (is(newParent, 'bpmn:Participant')) {\n        newParent = newParent.processRef;\n        break;\n      } else {\n        newParent = newParent.$parent;\n      }\n    }\n\n    containment = 'artifacts';\n  } else\n\n  if (is(businessObject, 'bpmn:MessageFlow')) {\n    containment = 'messageFlows';\n\n  } else\n\n  if (is(businessObject, 'bpmn:Participant')) {\n    containment = 'participants';\n\n    // make sure the participants process is properly attached / detached\n    // from the XML document\n\n    var process = businessObject.processRef,\n        definitions;\n\n    if (process) {\n      definitions = getDefinitions(businessObject.$parent || newParent);\n\n      if (businessObject.$parent) {\n        collectionRemove(definitions.get('rootElements'), process);\n        process.$parent = null;\n      }\n\n      if (newParent) {\n        collectionAdd(definitions.get('rootElements'), process);\n        process.$parent = definitions;\n      }\n    }\n  } else\n\n  if (is(businessObject, 'bpmn:DataOutputAssociation')) {\n    containment = 'dataOutputAssociations';\n  } else\n\n  if (is(businessObject, 'bpmn:DataInputAssociation')) {\n    containment = 'dataInputAssociations';\n  }\n\n  if (!containment) {\n    throw new Error(`no parent for <${ businessObject.id }> in <${ newParent.id }>`);\n  }\n\n  var children;\n\n  if (businessObject.$parent) {\n\n    // remove from old parent\n    children = businessObject.$parent.get(containment);\n    collectionRemove(children, businessObject);\n  }\n\n  if (!newParent) {\n    businessObject.$parent = null;\n  } else {\n\n    // add to new parent\n    children = newParent.get(containment);\n    children.push(businessObject);\n    businessObject.$parent = newParent;\n  }\n\n  if (visualParent) {\n    var diChildren = visualParent.get(containment);\n\n    collectionRemove(children, businessObject);\n\n    if (newParent) {\n\n      if (!diChildren) {\n        diChildren = [];\n        newParent.set(containment, diChildren);\n      }\n\n      diChildren.push(businessObject);\n    }\n  }\n};\n\n/**\n * @param {Connection} connection\n */\nBpmnUpdater.prototype.updateConnectionWaypoints = function(connection) {\n  var di = getDi(connection);\n\n  di.set('waypoint', this._bpmnFactory.createDiWaypoints(connection.waypoints));\n};\n\n/**\n * @param { {\n *   connection: Connection;\n *   parent: Parent;\n *   newParent: Parent;\n * } } context\n */\nBpmnUpdater.prototype.updateConnection = function(context) {\n  var connection = context.connection,\n      businessObject = getBusinessObject(connection),\n      newSource = connection.source,\n      newSourceBo = getBusinessObject(newSource),\n      newTarget = connection.target,\n      newTargetBo = getBusinessObject(connection.target),\n      visualParent;\n\n  if (!is(businessObject, 'bpmn:DataAssociation')) {\n\n    var inverseSet = is(businessObject, 'bpmn:SequenceFlow');\n\n    if (businessObject.sourceRef !== newSourceBo) {\n      if (inverseSet) {\n        collectionRemove(businessObject.sourceRef && businessObject.sourceRef.get('outgoing'), businessObject);\n\n        if (newSourceBo && newSourceBo.get('outgoing')) {\n          newSourceBo.get('outgoing').push(businessObject);\n        }\n      }\n\n      businessObject.sourceRef = newSourceBo;\n    }\n\n    if (businessObject.targetRef !== newTargetBo) {\n      if (inverseSet) {\n        collectionRemove(businessObject.targetRef && businessObject.targetRef.get('incoming'), businessObject);\n\n        if (newTargetBo && newTargetBo.get('incoming')) {\n          newTargetBo.get('incoming').push(businessObject);\n        }\n      }\n\n      businessObject.targetRef = newTargetBo;\n    }\n  } else\n\n  if (is(businessObject, 'bpmn:DataInputAssociation')) {\n\n    // handle obnoxious isMsome sourceRef\n    businessObject.get('sourceRef')[0] = newSourceBo;\n\n    visualParent = context.parent || context.newParent || newTargetBo;\n\n    this.updateSemanticParent(businessObject, newTargetBo, visualParent);\n  } else\n\n  if (is(businessObject, 'bpmn:DataOutputAssociation')) {\n    visualParent = context.parent || context.newParent || newSourceBo;\n\n    this.updateSemanticParent(businessObject, newSourceBo, visualParent);\n\n    // targetRef = new target\n    businessObject.targetRef = newTargetBo;\n  }\n\n  this.updateConnectionWaypoints(connection);\n\n  this.updateDiConnection(connection, newSource, newTarget);\n};\n\n\n// helpers //////////////////////\n\nBpmnUpdater.prototype._getLabel = function(di) {\n  if (!di.label) {\n    di.label = this._bpmnFactory.createDiLabel();\n  }\n\n  return di.label;\n};\n\n\n/**\n * Call function if shape or connection is BPMN element.\n *\n * @param  {Function} fn\n *\n * @return {Function}\n */\nfunction ifBpmn(fn) {\n\n  return function(event) {\n\n    var context = event.context,\n        element = context.shape || context.connection || context.element;\n\n    if (is(element, 'bpmn:BaseElement')) {\n      fn(event);\n    }\n  };\n}\n\n/**\n * Return dc:Bounds of bpmndi:BPMNLabel if exists.\n *\n * @param {Shape} shape\n *\n * @return {ModdleElement|undefined}\n */\nfunction getEmbeddedLabelBounds(shape) {\n  if (!is(shape, 'bpmn:Activity')) {\n    return;\n  }\n\n  var di = getDi(shape);\n\n  if (!di) {\n    return;\n  }\n\n  var label = di.get('label');\n\n  if (!label) {\n    return;\n  }\n\n  return label.get('bounds');\n}","import {\n  assign,\n  forEach,\n  has,\n  isDefined,\n  isObject,\n  omit\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  getBusinessObject,\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  isExpanded\n} from '../../util/DiUtil';\n\nimport BaseElementFactory from 'diagram-js/lib/core/ElementFactory';\n\nimport {\n  DEFAULT_LABEL_SIZE\n} from '../../util/LabelUtil';\n\nimport {\n  ensureCompatDiRef\n} from '../../util/CompatibilityUtil';\n\n/**\n * @typedef {import('diagram-js/lib/util/Types').Dimensions} Dimensions\n *\n * @typedef {import('./BpmnFactory').default} BpmnFactory\n *\n * @typedef {import('../../model/Types').BpmnAttributes} BpmnAttributes\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Label} Label\n * @typedef {import('../../model/Types').Root} Root\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').Moddle} Moddle\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * A BPMN-specific element factory.\n *\n * @template {Connection} [T=Connection]\n * @template {Label} [U=Label]\n * @template {Root} [V=Root]\n * @template {Shape} [W=Shape]\n *\n * @extends {BaseElementFactory<T, U, V, W>}\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {Moddle} moddle\n */\nexport default function ElementFactory(bpmnFactory, moddle) {\n  BaseElementFactory.call(this);\n\n  this._bpmnFactory = bpmnFactory;\n  this._moddle = moddle;\n}\n\ninherits(ElementFactory, BaseElementFactory);\n\nElementFactory.$inject = [\n  'bpmnFactory',\n  'moddle'\n];\n\nElementFactory.prototype._baseCreate = BaseElementFactory.prototype.create;\n\n/**\n * Create a root element.\n *\n * @overlord\n * @param {'root'} elementType\n * @param {Partial<Root> & Partial<BpmnAttributes>} [attrs]\n * @return {V}\n */\n\n/**\n * Create a shape.\n *\n * @overlord\n * @param {'shape'} elementType\n * @param {Partial<Shape> & Partial<BpmnAttributes>} [attrs]\n * @return {W}\n */\n\n/**\n * Create a connection.\n *\n * @overlord\n * @param {'connection'} elementType\n * @param {Partial<Connection> & Partial<BpmnAttributes>} [attrs]\n * @return {T}\n */\n\n/**\n * Create a label.\n *\n * @param {'label'} elementType\n * @param {Partial<Label> & Partial<BpmnAttributes>} [attrs]\n * @return {U}\n */\nElementFactory.prototype.create = function(elementType, attrs) {\n\n  // no special magic for labels,\n  // we assume their businessObjects have already been created\n  // and wired via attrs\n  if (elementType === 'label') {\n    var di = attrs.di || this._bpmnFactory.createDiLabel();\n    return this._baseCreate(elementType, assign({ type: 'label', di: di }, DEFAULT_LABEL_SIZE, attrs));\n  }\n\n  return this.createElement(elementType, attrs);\n};\n\n/**\n * Create a BPMN root element.\n *\n * @overlord\n * @param {'root'} elementType\n * @param {Partial<Root> & Partial<BpmnAttributes>} [attrs]\n * @return {V}\n */\n\n/**\n * Create a BPMN shape.\n *\n * @overlord\n * @param {'shape'} elementType\n * @param {Partial<Shape> & Partial<BpmnAttributes>} [attrs]\n * @return {W}\n */\n\n/**\n * Create a BPMN connection.\n *\n * @param {'connection'} elementType\n * @param {Partial<Connection> & Partial<BpmnAttributes>} [attrs]\n * @return {T}\n */\nElementFactory.prototype.createElement = function(elementType, attrs) {\n\n  attrs = assign({}, attrs || {});\n\n  var size;\n\n  var businessObject = attrs.businessObject,\n      di = attrs.di;\n\n  if (!businessObject) {\n    if (!attrs.type) {\n      throw new Error('no shape type specified');\n    }\n\n    businessObject = this._bpmnFactory.create(attrs.type);\n\n    ensureCompatDiRef(businessObject);\n  }\n\n  if (!isModdleDi(di)) {\n    var diAttrs = assign(\n      {},\n      di || {},\n      { id: businessObject.id + '_di' }\n    );\n\n    if (elementType === 'root') {\n      di = this._bpmnFactory.createDiPlane(businessObject, diAttrs);\n    } else\n    if (elementType === 'connection') {\n      di = this._bpmnFactory.createDiEdge(businessObject, diAttrs);\n    } else {\n      di = this._bpmnFactory.createDiShape(businessObject, diAttrs);\n    }\n  }\n\n  if (is(businessObject, 'bpmn:Group')) {\n    attrs = assign({\n      isFrame: true\n    }, attrs);\n  }\n\n  attrs = applyAttributes(businessObject, attrs, [\n    'processRef',\n    'isInterrupting',\n    'associationDirection',\n    'isForCompensation'\n  ]);\n\n  if (attrs.isExpanded) {\n    attrs = applyAttribute(di, attrs, 'isExpanded');\n  }\n\n  if (isAny(businessObject, [ 'bpmn:Lane', 'bpmn:Participant' ])) {\n    attrs = applyAttribute(di, attrs, 'isHorizontal');\n  }\n\n  if (is(businessObject, 'bpmn:SubProcess')) {\n    attrs.collapsed = !isExpanded(businessObject, di);\n  }\n\n  if (is(businessObject, 'bpmn:ExclusiveGateway')) {\n    if (has(di, 'isMarkerVisible')) {\n      if (di.isMarkerVisible === undefined) {\n        di.isMarkerVisible = false;\n      }\n    } else {\n      di.isMarkerVisible = true;\n    }\n  }\n\n  if (isDefined(attrs.triggeredByEvent)) {\n    businessObject.triggeredByEvent = attrs.triggeredByEvent;\n    delete attrs.triggeredByEvent;\n  }\n\n  if (isDefined(attrs.cancelActivity)) {\n    businessObject.cancelActivity = attrs.cancelActivity;\n    delete attrs.cancelActivity;\n  }\n\n  var eventDefinitions,\n      newEventDefinition;\n\n  if (attrs.eventDefinitionType) {\n    eventDefinitions = businessObject.get('eventDefinitions') || [];\n    newEventDefinition = this._bpmnFactory.create(attrs.eventDefinitionType, attrs.eventDefinitionAttrs);\n\n    if (attrs.eventDefinitionType === 'bpmn:ConditionalEventDefinition') {\n      newEventDefinition.condition = this._bpmnFactory.create('bpmn:FormalExpression');\n    }\n\n    eventDefinitions.push(newEventDefinition);\n\n    newEventDefinition.$parent = businessObject;\n    businessObject.eventDefinitions = eventDefinitions;\n\n    delete attrs.eventDefinitionType;\n  }\n\n  size = this.getDefaultSize(businessObject, di);\n\n  attrs = assign({\n    id: businessObject.id\n  }, size, attrs, {\n    businessObject: businessObject,\n    di: di\n  });\n\n  return this._baseCreate(elementType, attrs);\n};\n\n/**\n * Get the default size of a diagram element.\n *\n * @param {Element} element The element.\n * @param {ModdleElement} di The DI.\n *\n * @return {Dimensions} Default width and height of the element.\n */\nElementFactory.prototype.getDefaultSize = function(element, di) {\n\n  var bo = getBusinessObject(element);\n  di = di || getDi(element);\n\n  if (is(bo, 'bpmn:SubProcess')) {\n    if (isExpanded(bo, di)) {\n      return { width: 350, height: 200 };\n    } else {\n      return { width: 100, height: 80 };\n    }\n  }\n\n  if (is(bo, 'bpmn:Task')) {\n    return { width: 100, height: 80 };\n  }\n\n  if (is(bo, 'bpmn:Gateway')) {\n    return { width: 50, height: 50 };\n  }\n\n  if (is(bo, 'bpmn:Event')) {\n    return { width: 36, height: 36 };\n  }\n\n  if (is(bo, 'bpmn:Participant')) {\n    if (isExpanded(bo, di)) {\n      return { width: 600, height: 250 };\n    } else {\n      return { width: 400, height: 60 };\n    }\n  }\n\n  if (is(bo, 'bpmn:Lane')) {\n    return { width: 400, height: 100 };\n  }\n\n  if (is(bo, 'bpmn:DataObjectReference')) {\n    return { width: 36, height: 50 };\n  }\n\n  if (is(bo, 'bpmn:DataStoreReference')) {\n    return { width: 50, height: 50 };\n  }\n\n  if (is(bo, 'bpmn:TextAnnotation')) {\n    return { width: 100, height: 30 };\n  }\n\n  if (is(bo, 'bpmn:Group')) {\n    return { width: 300, height: 300 };\n  }\n\n  return { width: 100, height: 80 };\n};\n\n\n/**\n * Create participant.\n *\n * @param {boolean|Partial<Shape> & Partial<BpmnAttributes>} [attrs]\n * Attributes or whether the participant is expanded.\n *\n * @return {W} The created participant.\n */\nElementFactory.prototype.createParticipantShape = function(attrs) {\n\n  if (!isObject(attrs)) {\n    attrs = { isExpanded: attrs };\n  }\n\n  attrs = assign({ type: 'bpmn:Participant' }, attrs || {});\n\n  // participants are expanded by default\n  if (attrs.isExpanded !== false) {\n    attrs.processRef = this._bpmnFactory.create('bpmn:Process');\n  }\n\n  return this.createShape(attrs);\n};\n\n\n// helpers //////////////////////\n\n/**\n * Apply attributes from a map to the given element, remove attribute from the\n * map on application.\n *\n * @param {Element} element\n * @param {Object} attrs (in/out map of attributes)\n * @param {string[]} attributeNames name of attributes to apply\n *\n * @return {Object} changed attrs\n */\nfunction applyAttributes(element, attrs, attributeNames) {\n\n  forEach(attributeNames, function(property) {\n    attrs = applyAttribute(element, attrs, property);\n  });\n\n  return attrs;\n}\n\n/**\n * Apply named property to element and drain it from the attrs collection.\n *\n * @param {Element} element\n * @param {Object} attrs (in/out map of attributes)\n * @param {string} attributeName to apply\n *\n * @return {Object} changed attrs\n */\nfunction applyAttribute(element, attrs, attributeName) {\n  if (attrs[attributeName] === undefined) {\n    return attrs;\n  }\n\n  element[attributeName] = attrs[attributeName];\n\n  return omit(attrs, [ attributeName ]);\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isModdleDi(element) {\n  return isAny(element, [\n    'bpmndi:BPMNShape',\n    'bpmndi:BPMNEdge',\n    'bpmndi:BPMNDiagram',\n    'bpmndi:BPMNPlane',\n  ]);\n}\n","import { forEach, isDefined } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../../core/Canvas').default} Canvas\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that align elements in a certain way.\r\n *\r\n * @param {Modeling} modeling\r\n * @param {Canvas} canvas\r\n */\r\nexport default function AlignElements(modeling, canvas) {\r\n  this._modeling = modeling;\r\n  this._canvas = canvas;\r\n}\r\n\r\nAlignElements.$inject = [ 'modeling', 'canvas' ];\r\n\r\n\r\nAlignElements.prototype.preExecute = function(context) {\r\n  var modeling = this._modeling;\r\n\r\n  var elements = context.elements,\r\n      alignment = context.alignment;\r\n\r\n\r\n  forEach(elements, function(element) {\r\n    var delta = {\r\n      x: 0,\r\n      y: 0\r\n    };\r\n\r\n    if (isDefined(alignment.left)) {\r\n      delta.x = alignment.left - element.x;\r\n\r\n    } else if (isDefined(alignment.right)) {\r\n      delta.x = (alignment.right - element.width) - element.x;\r\n\r\n    } else if (isDefined(alignment.center)) {\r\n      delta.x = (alignment.center - Math.round(element.width / 2)) - element.x;\r\n\r\n    } else if (isDefined(alignment.top)) {\r\n      delta.y = alignment.top - element.y;\r\n\r\n    } else if (isDefined(alignment.bottom)) {\r\n      delta.y = (alignment.bottom - element.height) - element.y;\r\n\r\n    } else if (isDefined(alignment.middle)) {\r\n      delta.y = (alignment.middle - Math.round(element.height / 2)) - element.y;\r\n    }\r\n\r\n    modeling.moveElements([ element ], delta, element.parent);\r\n  });\r\n};\r\n\r\nAlignElements.prototype.postExecute = function(context) {\r\n\r\n};\r\n","import { some } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../../model/Types').Element} Element\r\n * @typedef {import('../../../model/Types').Parent} Parent\r\n * @typedef {import('../../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that implements reversible appending of shapes\r\n * to a source shape.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function AppendShapeHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nAppendShapeHandler.$inject = [ 'modeling' ];\r\n\r\n\r\n// api //////////////////////\r\n\r\n\r\n/**\r\n * Creates a new shape.\r\n *\r\n * @param {Object} context\r\n * @param {Partial<Shape>} context.shape The new shape.\r\n * @param {Element} context.source The element to which to append the new shape to.\r\n * @param {Parent} context.parent The parent.\r\n * @param {Point} context.position The position at which to create the new shape.\r\n */\r\nAppendShapeHandler.prototype.preExecute = function(context) {\r\n\r\n  var source = context.source;\r\n\r\n  if (!source) {\r\n    throw new Error('source required');\r\n  }\r\n\r\n  var target = context.target || source.parent,\r\n      shape = context.shape,\r\n      hints = context.hints || {};\r\n\r\n  shape = context.shape =\r\n    this._modeling.createShape(\r\n      shape,\r\n      context.position,\r\n      target, { attach: hints.attach });\r\n\r\n  context.shape = shape;\r\n};\r\n\r\nAppendShapeHandler.prototype.postExecute = function(context) {\r\n  var hints = context.hints || {};\r\n\r\n  if (!existsConnection(context.source, context.shape)) {\r\n\r\n    // create connection\r\n    if (hints.connectionTarget === context.source) {\r\n      this._modeling.connect(context.shape, context.source, context.connection);\r\n    } else {\r\n      this._modeling.connect(context.source, context.shape, context.connection);\r\n    }\r\n  }\r\n};\r\n\r\n\r\nfunction existsConnection(source, target) {\r\n  return some(source.outgoing, function(c) {\r\n    return c.target === target;\r\n  });\r\n}","/**\r\n * @typedef {import('../../../model/Types').Element} Element\r\n * @typedef {import('../../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../Modeling').ModelingHints} ModelingHints\r\n *\r\n * @typedef {import('../../../core/Canvas').default} Canvas\r\n * @typedef {import('../../../layout/BaseLayouter').default} Layouter\r\n */\r\n\r\n/**\r\n * @param {Canvas} canvas\r\n * @param {Layouter} layouter\r\n */\r\nexport default function CreateConnectionHandler(canvas, layouter) {\r\n  this._canvas = canvas;\r\n  this._layouter = layouter;\r\n}\r\n\r\nCreateConnectionHandler.$inject = [ 'canvas', 'layouter' ];\r\n\r\n\r\n// api //////////////////////\r\n\r\n\r\n/**\r\n * Creates a new connection between two elements.\r\n *\r\n * @param {Object} context\r\n * @param {Element} context.source The source.\r\n * @param {Element} context.target The target.\r\n * @param {Shape} context.parent The parent.\r\n * @param {number} [context.parentIndex] The optional index at which to add the\r\n * connection to the parent's children.\r\n * @param {ModelingHints} [context.hints] The optional hints.\r\n */\r\nCreateConnectionHandler.prototype.execute = function(context) {\r\n\r\n  var connection = context.connection,\r\n      source = context.source,\r\n      target = context.target,\r\n      parent = context.parent,\r\n      parentIndex = context.parentIndex,\r\n      hints = context.hints;\r\n\r\n  if (!source || !target) {\r\n    throw new Error('source and target required');\r\n  }\r\n\r\n  if (!parent) {\r\n    throw new Error('parent required');\r\n  }\r\n\r\n  connection.source = source;\r\n  connection.target = target;\r\n\r\n  if (!connection.waypoints) {\r\n    connection.waypoints = this._layouter.layoutConnection(connection, hints);\r\n  }\r\n\r\n  // add connection\r\n  this._canvas.addConnection(connection, parent, parentIndex);\r\n\r\n  return connection;\r\n};\r\n\r\nCreateConnectionHandler.prototype.revert = function(context) {\r\n  var connection = context.connection;\r\n\r\n  this._canvas.removeConnection(connection);\r\n\r\n  connection.source = null;\r\n  connection.target = null;\r\n\r\n  return connection;\r\n};","import {\r\n  assign,\r\n  filter,\r\n  forEach,\r\n  isNumber,\r\n  map,\r\n  omit,\r\n  pick,\r\n  values\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getBBox,\r\n  getParents\r\n} from '../../../util/Elements';\r\n\r\nimport {\r\n  isConnection,\r\n  isLabel\r\n} from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\nvar round = Math.round;\r\n\r\n/**\r\n * @param {Modeling} modeling\r\n */\r\nexport default function CreateElementsHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nCreateElementsHandler.$inject = [\r\n  'modeling'\r\n];\r\n\r\nCreateElementsHandler.prototype.preExecute = function(context) {\r\n  var elements = context.elements,\r\n      parent = context.parent,\r\n      parentIndex = context.parentIndex,\r\n      position = context.position,\r\n      hints = context.hints;\r\n\r\n  var modeling = this._modeling;\r\n\r\n  // make sure each element has x and y\r\n  forEach(elements, function(element) {\r\n    if (!isNumber(element.x)) {\r\n      element.x = 0;\r\n    }\r\n\r\n    if (!isNumber(element.y)) {\r\n      element.y = 0;\r\n    }\r\n  });\r\n\r\n  var visibleElements = filter(elements, function(element) {\r\n    return !element.hidden;\r\n  });\r\n\r\n  var bbox = getBBox(visibleElements);\r\n\r\n  // center elements around position\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      element.waypoints = map(element.waypoints, function(waypoint) {\r\n        return {\r\n          x: round(waypoint.x - bbox.x - bbox.width / 2 + position.x),\r\n          y: round(waypoint.y - bbox.y - bbox.height / 2 + position.y)\r\n        };\r\n      });\r\n    }\r\n\r\n    assign(element, {\r\n      x: round(element.x - bbox.x - bbox.width / 2 + position.x),\r\n      y: round(element.y - bbox.y - bbox.height / 2 + position.y)\r\n    });\r\n  });\r\n\r\n  var parents = getParents(elements);\r\n\r\n  var cache = {};\r\n\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      cache[ element.id ] = isNumber(parentIndex) ?\r\n        modeling.createConnection(\r\n          cache[ element.source.id ],\r\n          cache[ element.target.id ],\r\n          parentIndex,\r\n          element,\r\n          element.parent || parent,\r\n          hints\r\n        ) :\r\n        modeling.createConnection(\r\n          cache[ element.source.id ],\r\n          cache[ element.target.id ],\r\n          element,\r\n          element.parent || parent,\r\n          hints\r\n        );\r\n\r\n      return;\r\n    }\r\n\r\n    var createShapeHints = assign({}, hints);\r\n\r\n    if (parents.indexOf(element) === -1) {\r\n      createShapeHints.autoResize = false;\r\n    }\r\n\r\n    if (isLabel(element)) {\r\n      createShapeHints = omit(createShapeHints, [ 'attach' ]);\r\n    }\r\n\r\n    cache[ element.id ] = isNumber(parentIndex) ?\r\n      modeling.createShape(\r\n        element,\r\n        pick(element, [ 'x', 'y', 'width', 'height' ]),\r\n        element.parent || parent,\r\n        parentIndex,\r\n        createShapeHints\r\n      ) :\r\n      modeling.createShape(\r\n        element,\r\n        pick(element, [ 'x', 'y', 'width', 'height' ]),\r\n        element.parent || parent,\r\n        createShapeHints\r\n      );\r\n  });\r\n\r\n  context.elements = values(cache);\r\n};","import { assign } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../../model/Types').Element} Element\r\n * @typedef {import('../../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../../../core/Canvas').default} Canvas\r\n */\r\n\r\nvar round = Math.round;\r\n\r\n\r\n/**\r\n * A handler that implements reversible addition of shapes.\r\n *\r\n * @param {Canvas} canvas\r\n */\r\nexport default function CreateShapeHandler(canvas) {\r\n  this._canvas = canvas;\r\n}\r\n\r\nCreateShapeHandler.$inject = [ 'canvas' ];\r\n\r\n\r\n// api //////////////////////\r\n\r\n\r\n/**\r\n * Appends a shape to a target shape\r\n *\r\n * @param {Object} context\r\n * @param {Element} context.parent The parent.\r\n * @param {Point} context.position The position at which to create the new shape.\r\n * @param {number} [context.parentIndex] The optional index at which to add the\r\n * shape to the parent's children.\r\n */\r\nCreateShapeHandler.prototype.execute = function(context) {\r\n\r\n  var shape = context.shape,\r\n      positionOrBounds = context.position,\r\n      parent = context.parent,\r\n      parentIndex = context.parentIndex;\r\n\r\n  if (!parent) {\r\n    throw new Error('parent required');\r\n  }\r\n\r\n  if (!positionOrBounds) {\r\n    throw new Error('position required');\r\n  }\r\n\r\n  // (1) add at event center position _or_ at given bounds\r\n  if (positionOrBounds.width !== undefined) {\r\n    assign(shape, positionOrBounds);\r\n  } else {\r\n    assign(shape, {\r\n      x: positionOrBounds.x - round(shape.width / 2),\r\n      y: positionOrBounds.y - round(shape.height / 2)\r\n    });\r\n  }\r\n\r\n  // (2) add to canvas\r\n  this._canvas.addShape(shape, parent, parentIndex);\r\n\r\n  return shape;\r\n};\r\n\r\n\r\n/**\r\n * Undo append by removing the shape\r\n */\r\nCreateShapeHandler.prototype.revert = function(context) {\r\n\r\n  var shape = context.shape;\r\n\r\n  // (3) remove form canvas\r\n  this._canvas.removeShape(shape);\r\n\r\n  return shape;\r\n};","import inherits from 'inherits-browser';\r\n\r\nimport CreateShapeHandler from './CreateShapeHandler';\r\n\r\n/**\r\n * @typedef {import('../../../core/Canvas').default} Canvas\r\n *\r\n * @typedef {import('../../../model/Types').Element} Element\r\n * @typedef {import('../../../model/Types').Parent} Parent\r\n * @typedef {import('../../../model/Types').Shape} Shape\r\n * @typedef {import('../../../util/Types').Point} Point\r\n */\r\n\r\n/**\r\n * A handler that attaches a label to a given target shape.\r\n *\r\n * @param {Canvas} canvas\r\n */\r\nexport default function CreateLabelHandler(canvas) {\r\n  CreateShapeHandler.call(this, canvas);\r\n}\r\n\r\ninherits(CreateLabelHandler, CreateShapeHandler);\r\n\r\nCreateLabelHandler.$inject = [ 'canvas' ];\r\n\r\n\r\n// api //////////////////////\r\n\r\n\r\nvar originalExecute = CreateShapeHandler.prototype.execute;\r\n\r\n/**\r\n * Append label to element.\r\n *\r\n * @param { {\r\n *   parent: Parent;\r\n *   position: Point;\r\n *   shape: Shape;\r\n *   target: Element;\r\n * } } context\r\n */\r\nCreateLabelHandler.prototype.execute = function(context) {\r\n\r\n  var label = context.shape;\r\n\r\n  ensureValidDimensions(label);\r\n\r\n  label.labelTarget = context.labelTarget;\r\n\r\n  return originalExecute.call(this, context);\r\n};\r\n\r\nvar originalRevert = CreateShapeHandler.prototype.revert;\r\n\r\n/**\r\n * Revert appending by removing label.\r\n */\r\nCreateLabelHandler.prototype.revert = function(context) {\r\n  context.shape.labelTarget = null;\r\n\r\n  return originalRevert.call(this, context);\r\n};\r\n\r\n\r\n// helpers //////////////////////\r\n\r\nfunction ensureValidDimensions(label) {\r\n\r\n  // make sure a label has valid { width, height } dimensions\r\n  [ 'width', 'height' ].forEach(function(prop) {\r\n    if (typeof label[prop] === 'undefined') {\r\n      label[prop] = 0;\r\n    }\r\n  });\r\n}","import {\r\n  add as collectionAdd,\r\n  indexOf as collectionIdx\r\n} from '../../../util/Collections';\r\n\r\nimport { saveClear } from '../../../util/Removal';\r\n\r\n/**\r\n * @typedef {import('../../../core/Canvas').default} Canvas\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that implements reversible deletion of Connections.\r\n */\r\nexport default function DeleteConnectionHandler(canvas, modeling) {\r\n  this._canvas = canvas;\r\n  this._modeling = modeling;\r\n}\r\n\r\nDeleteConnectionHandler.$inject = [\r\n  'canvas',\r\n  'modeling'\r\n];\r\n\r\n\r\n/**\r\n * - Remove connections\r\n */\r\nDeleteConnectionHandler.prototype.preExecute = function(context) {\r\n\r\n  var modeling = this._modeling;\r\n\r\n  var connection = context.connection;\r\n\r\n  // remove connections\r\n  saveClear(connection.incoming, function(connection) {\r\n\r\n    // To make sure that the connection isn't removed twice\r\n    // For example if a container is removed\r\n    modeling.removeConnection(connection, { nested: true });\r\n  });\r\n\r\n  saveClear(connection.outgoing, function(connection) {\r\n    modeling.removeConnection(connection, { nested: true });\r\n  });\r\n\r\n};\r\n\r\n\r\nDeleteConnectionHandler.prototype.execute = function(context) {\r\n\r\n  var connection = context.connection,\r\n      parent = connection.parent;\r\n\r\n  context.parent = parent;\r\n\r\n  // remember containment\r\n  context.parentIndex = collectionIdx(parent.children, connection);\r\n\r\n  context.source = connection.source;\r\n  context.target = connection.target;\r\n\r\n  this._canvas.removeConnection(connection);\r\n\r\n  connection.source = null;\r\n  connection.target = null;\r\n\r\n  return connection;\r\n};\r\n\r\n/**\r\n * Command revert implementation.\r\n */\r\nDeleteConnectionHandler.prototype.revert = function(context) {\r\n\r\n  var connection = context.connection,\r\n      parent = context.parent,\r\n      parentIndex = context.parentIndex;\r\n\r\n  connection.source = context.source;\r\n  connection.target = context.target;\r\n\r\n  // restore containment\r\n  collectionAdd(parent.children, connection, parentIndex);\r\n\r\n  this._canvas.addConnection(connection, parent);\r\n\r\n  return connection;\r\n};\r\n","import { forEach } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * @param {Modeling} modeling\r\n * @param {ElementRegistry} elementRegistry\r\n */\r\nexport default function DeleteElementsHandler(modeling, elementRegistry) {\r\n  this._modeling = modeling;\r\n  this._elementRegistry = elementRegistry;\r\n}\r\n\r\nDeleteElementsHandler.$inject = [\r\n  'modeling',\r\n  'elementRegistry'\r\n];\r\n\r\n\r\nDeleteElementsHandler.prototype.postExecute = function(context) {\r\n\r\n  var modeling = this._modeling,\r\n      elementRegistry = this._elementRegistry,\r\n      elements = context.elements;\r\n\r\n  forEach(elements, function(element) {\r\n\r\n    // element may have been removed with previous\r\n    // remove operations already (e.g. in case of nesting)\r\n    if (!elementRegistry.get(element.id)) {\r\n      return;\r\n    }\r\n\r\n    if (element.waypoints) {\r\n      modeling.removeConnection(element);\r\n    } else {\r\n      modeling.removeShape(element);\r\n    }\r\n  });\r\n};","import {\r\n  add as collectionAdd,\r\n  indexOf as collectionIdx\r\n} from '../../../util/Collections';\r\n\r\nimport { saveClear } from '../../../util/Removal';\r\n\r\nimport { isConnection } from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../../core/Canvas').default} Canvas\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that implements reversible deletion of shapes.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {Modeling} modeling\r\n */\r\nexport default function DeleteShapeHandler(canvas, modeling) {\r\n  this._canvas = canvas;\r\n  this._modeling = modeling;\r\n}\r\n\r\nDeleteShapeHandler.$inject = [ 'canvas', 'modeling' ];\r\n\r\n\r\n/**\r\n * - Remove connections\r\n * - Remove all direct children\r\n */\r\nDeleteShapeHandler.prototype.preExecute = function(context) {\r\n\r\n  var modeling = this._modeling;\r\n\r\n  var shape = context.shape;\r\n\r\n  // remove connections\r\n  saveClear(shape.incoming, function(connection) {\r\n\r\n    // To make sure that the connection isn't removed twice\r\n    // For example if a container is removed\r\n    modeling.removeConnection(connection, { nested: true });\r\n  });\r\n\r\n  saveClear(shape.outgoing, function(connection) {\r\n    modeling.removeConnection(connection, { nested: true });\r\n  });\r\n\r\n  // remove child shapes and connections\r\n  saveClear(shape.children, function(child) {\r\n    if (isConnection(child)) {\r\n      modeling.removeConnection(child, { nested: true });\r\n    } else {\r\n      modeling.removeShape(child, { nested: true });\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Remove shape and remember the parent\r\n */\r\nDeleteShapeHandler.prototype.execute = function(context) {\r\n  var canvas = this._canvas;\r\n\r\n  var shape = context.shape,\r\n      oldParent = shape.parent;\r\n\r\n  context.oldParent = oldParent;\r\n\r\n  // remove containment\r\n  context.oldParentIndex = collectionIdx(oldParent.children, shape);\r\n\r\n  // remove shape\r\n  canvas.removeShape(shape);\r\n\r\n  return shape;\r\n};\r\n\r\n\r\n/**\r\n * Command revert implementation\r\n */\r\nDeleteShapeHandler.prototype.revert = function(context) {\r\n\r\n  var canvas = this._canvas;\r\n\r\n  var shape = context.shape,\r\n      oldParent = context.oldParent,\r\n      oldParentIndex = context.oldParentIndex;\r\n\r\n  // restore containment\r\n  collectionAdd(oldParent.children, shape, oldParentIndex);\r\n\r\n  canvas.addShape(shape, oldParent);\r\n\r\n  return shape;\r\n};\r\n","import {\r\n  forEach,\r\n  sortBy\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that distributes elements evenly.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function DistributeElements(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nDistributeElements.$inject = [ 'modeling' ];\r\n\r\nvar OFF_AXIS = {\r\n  x: 'y',\r\n  y: 'x'\r\n};\r\n\r\nDistributeElements.prototype.preExecute = function(context) {\r\n  var modeling = this._modeling;\r\n\r\n  var groups = context.groups,\r\n      axis = context.axis,\r\n      dimension = context.dimension;\r\n\r\n  function updateRange(group, element) {\r\n    group.range.min = Math.min(element[axis], group.range.min);\r\n    group.range.max = Math.max(element[axis] + element[dimension], group.range.max);\r\n  }\r\n\r\n  function center(element) {\r\n    return element[axis] + element[dimension] / 2;\r\n  }\r\n\r\n  function lastIdx(arr) {\r\n    return arr.length - 1;\r\n  }\r\n\r\n  function rangeDiff(range) {\r\n    return range.max - range.min;\r\n  }\r\n\r\n  function centerElement(refCenter, element) {\r\n    var delta = { y: 0 };\r\n\r\n    delta[axis] = refCenter - center(element);\r\n\r\n    if (delta[axis]) {\r\n\r\n      delta[OFF_AXIS[axis]] = 0;\r\n\r\n      modeling.moveElements([ element ], delta, element.parent);\r\n    }\r\n  }\r\n\r\n  var firstGroup = groups[0],\r\n      lastGroupIdx = lastIdx(groups),\r\n      lastGroup = groups[ lastGroupIdx ];\r\n\r\n  var margin,\r\n      spaceInBetween,\r\n      groupsSize = 0; // the size of each range\r\n\r\n  forEach(groups, function(group, idx) {\r\n    var sortedElements,\r\n        refElem,\r\n        refCenter;\r\n\r\n    if (group.elements.length < 2) {\r\n      if (idx && idx !== groups.length - 1) {\r\n        updateRange(group, group.elements[0]);\r\n\r\n        groupsSize += rangeDiff(group.range);\r\n      }\r\n      return;\r\n    }\r\n\r\n    sortedElements = sortBy(group.elements, axis);\r\n\r\n    refElem = sortedElements[0];\r\n\r\n    if (idx === lastGroupIdx) {\r\n      refElem = sortedElements[lastIdx(sortedElements)];\r\n    }\r\n\r\n    refCenter = center(refElem);\r\n\r\n    // wanna update the ranges after the shapes have been centered\r\n    group.range = null;\r\n\r\n    forEach(sortedElements, function(element) {\r\n\r\n      centerElement(refCenter, element);\r\n\r\n      if (group.range === null) {\r\n        group.range = {\r\n          min: element[axis],\r\n          max: element[axis] + element[dimension]\r\n        };\r\n\r\n        return;\r\n      }\r\n\r\n      // update group's range after centering the range elements\r\n      updateRange(group, element);\r\n    });\r\n\r\n    if (idx && idx !== groups.length - 1) {\r\n      groupsSize += rangeDiff(group.range);\r\n    }\r\n  });\r\n\r\n  spaceInBetween = Math.abs(lastGroup.range.min - firstGroup.range.max);\r\n\r\n  margin = Math.round((spaceInBetween - groupsSize) / (groups.length - 1));\r\n\r\n  if (margin < groups.length - 1) {\r\n    return;\r\n  }\r\n\r\n  forEach(groups, function(group, groupIdx) {\r\n    var delta = {},\r\n        prevGroup;\r\n\r\n    if (group === firstGroup || group === lastGroup) {\r\n      return;\r\n    }\r\n\r\n    prevGroup = groups[groupIdx - 1];\r\n\r\n    group.range.max = 0;\r\n\r\n    forEach(group.elements, function(element, idx) {\r\n      delta[OFF_AXIS[axis]] = 0;\r\n      delta[axis] = (prevGroup.range.max - element[axis]) + margin;\r\n\r\n      if (group.range.min !== element[axis]) {\r\n        delta[axis] += element[axis] - group.range.min;\r\n      }\r\n\r\n      if (delta[axis]) {\r\n        modeling.moveElements([ element ], delta, element.parent);\r\n      }\r\n\r\n      group.range.max = Math.max(element[axis] + element[dimension], idx ? group.range.max : 0);\r\n    });\r\n  });\r\n};\r\n\r\nDistributeElements.prototype.postExecute = function(context) {\r\n\r\n};\r\n","import { assign } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../../core/Canvas').default} Canvas\r\n * @typedef {import('../../../layout/BaseLayouter').default} Layouter\r\n */\r\n\r\n/**\r\n * A handler that implements reversible moving of shapes.\r\n *\r\n * @param {Layouter} layouter\r\n * @param {Canvas} canvas\r\n */\r\nexport default function LayoutConnectionHandler(layouter, canvas) {\r\n  this._layouter = layouter;\r\n  this._canvas = canvas;\r\n}\r\n\r\nLayoutConnectionHandler.$inject = [ 'layouter', 'canvas' ];\r\n\r\nLayoutConnectionHandler.prototype.execute = function(context) {\r\n\r\n  var connection = context.connection;\r\n\r\n  var oldWaypoints = connection.waypoints;\r\n\r\n  assign(context, {\r\n    oldWaypoints: oldWaypoints\r\n  });\r\n\r\n  connection.waypoints = this._layouter.layoutConnection(connection, context.hints);\r\n\r\n  return connection;\r\n};\r\n\r\nLayoutConnectionHandler.prototype.revert = function(context) {\r\n\r\n  var connection = context.connection;\r\n\r\n  connection.waypoints = context.oldWaypoints;\r\n\r\n  return connection;\r\n};\r\n","import { forEach } from 'min-dash';\r\n\r\n\r\nimport {\r\n  add as collectionAdd,\r\n  remove as collectionRemove\r\n} from '../../../util/Collections';\r\n\r\n\r\n/**\r\n * A handler that implements reversible moving of connections.\r\n *\r\n * The handler differs from the layout connection handler in a sense\r\n * that it preserves the connection layout.\r\n */\r\nexport default function MoveConnectionHandler() { }\r\n\r\n\r\nMoveConnectionHandler.prototype.execute = function(context) {\r\n\r\n  var connection = context.connection,\r\n      delta = context.delta;\r\n\r\n  var newParent = context.newParent || connection.parent,\r\n      newParentIndex = context.newParentIndex,\r\n      oldParent = connection.parent;\r\n\r\n  // save old parent in context\r\n  context.oldParent = oldParent;\r\n  context.oldParentIndex = collectionRemove(oldParent.children, connection);\r\n\r\n  // add to new parent at position\r\n  collectionAdd(newParent.children, connection, newParentIndex);\r\n\r\n  // update parent\r\n  connection.parent = newParent;\r\n\r\n  // update waypoint positions\r\n  forEach(connection.waypoints, function(p) {\r\n    p.x += delta.x;\r\n    p.y += delta.y;\r\n\r\n    if (p.original) {\r\n      p.original.x += delta.x;\r\n      p.original.y += delta.y;\r\n    }\r\n  });\r\n\r\n  return connection;\r\n};\r\n\r\nMoveConnectionHandler.prototype.revert = function(context) {\r\n\r\n  var connection = context.connection,\r\n      newParent = connection.parent,\r\n      oldParent = context.oldParent,\r\n      oldParentIndex = context.oldParentIndex,\r\n      delta = context.delta;\r\n\r\n  // remove from newParent\r\n  collectionRemove(newParent.children, connection);\r\n\r\n  // restore previous location in old parent\r\n  collectionAdd(oldParent.children, connection, oldParentIndex);\r\n\r\n  // restore parent\r\n  connection.parent = oldParent;\r\n\r\n  // revert to old waypoint positions\r\n  forEach(connection.waypoints, function(p) {\r\n    p.x -= delta.x;\r\n    p.y -= delta.y;\r\n\r\n    if (p.original) {\r\n      p.original.x -= delta.x;\r\n      p.original.y -= delta.y;\r\n    }\r\n  });\r\n\r\n  return connection;\r\n};","import {\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getClosure\r\n} from '../../../../util/Elements';\r\n\r\n/**\r\n * @typedef {import('../../../../model/Types').Connection} Connection\r\n * @typedef {import('../../../../model/Types').Element} Element\r\n * @typedef {import('../../../../model/Types').Shape} Shape\r\n */\r\n\r\nexport default function MoveClosure() {\r\n\r\n  /**\r\n   * @type {Record<string, Shape>}\r\n   */\r\n  this.allShapes = {};\r\n\r\n  /**\r\n   * @type {Record<string, Connection>}\r\n   */\r\n  this.allConnections = {};\r\n\r\n  /**\r\n   * @type {Record<string, Element>}\r\n   */\r\n  this.enclosedElements = {};\r\n\r\n  /**\r\n   * @type {Record<string, Connection>}\r\n   */\r\n  this.enclosedConnections = {};\r\n\r\n  /**\r\n   * @type {Record<string, Element>}\r\n   */\r\n  this.topLevel = {};\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n * @param {boolean} [isTopLevel]\r\n *\r\n * @return {MoveClosure}\r\n */\r\nMoveClosure.prototype.add = function(element, isTopLevel) {\r\n  return this.addAll([ element ], isTopLevel);\r\n};\r\n\r\n/**\r\n * @param {Element[]} elements\r\n * @param {boolean} [isTopLevel]\r\n *\r\n * @return {MoveClosure}\r\n */\r\nMoveClosure.prototype.addAll = function(elements, isTopLevel) {\r\n\r\n  var newClosure = getClosure(elements, !!isTopLevel, this);\r\n\r\n  assign(this, newClosure);\r\n\r\n  return this;\r\n};","import {\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getMovedSourceAnchor,\r\n  getMovedTargetAnchor\r\n} from './AnchorsHelper';\r\n\r\nimport MoveClosure from './MoveClosure';\r\n\r\n/**\r\n * @typedef {import('../../../../core/Types').ElementLike} Element\r\n * @typedef {import('../../../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A helper that is able to carry out serialized move\r\n * operations on multiple elements.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function MoveHelper(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\n/**\r\n * Move the specified elements and all children by the given delta.\r\n *\r\n * This moves all enclosed connections, too and layouts all affected\r\n * external connections.\r\n *\r\n * @template {Element} T\r\n *\r\n * @param {T[]} elements\r\n * @param {Point} delta\r\n * @param {Shape} newParent The new parent of all elements that are not nested.\r\n *\r\n * @return {T[]}\r\n */\r\nMoveHelper.prototype.moveRecursive = function(elements, delta, newParent) {\r\n  if (!elements) {\r\n    return [];\r\n  } else {\r\n    return this.moveClosure(this.getClosure(elements), delta, newParent);\r\n  }\r\n};\r\n\r\n/**\r\n * Move the given closure of elmements.\r\n *\r\n * @param {Object} closure\r\n * @param {Point} delta\r\n * @param {Shape} [newParent]\r\n * @param {Shape} [newHost]\r\n */\r\nMoveHelper.prototype.moveClosure = function(closure, delta, newParent, newHost, primaryShape) {\r\n  var modeling = this._modeling;\r\n\r\n  var allShapes = closure.allShapes,\r\n      allConnections = closure.allConnections,\r\n      enclosedConnections = closure.enclosedConnections,\r\n      topLevel = closure.topLevel,\r\n      keepParent = false;\r\n\r\n  if (primaryShape && primaryShape.parent === newParent) {\r\n    keepParent = true;\r\n  }\r\n\r\n  // move all shapes\r\n  forEach(allShapes, function(shape) {\r\n\r\n    // move the element according to the given delta\r\n    modeling.moveShape(shape, delta, topLevel[shape.id] && !keepParent && newParent, {\r\n      recurse: false,\r\n      layout: false\r\n    });\r\n  });\r\n\r\n  // move all child connections / layout external connections\r\n  forEach(allConnections, function(c) {\r\n\r\n    var sourceMoved = !!allShapes[c.source.id],\r\n        targetMoved = !!allShapes[c.target.id];\r\n\r\n    if (enclosedConnections[c.id] && sourceMoved && targetMoved) {\r\n      modeling.moveConnection(c, delta, topLevel[c.id] && !keepParent && newParent);\r\n    } else {\r\n      modeling.layoutConnection(c, {\r\n        connectionStart: sourceMoved && getMovedSourceAnchor(c, c.source, delta),\r\n        connectionEnd: targetMoved && getMovedTargetAnchor(c, c.target, delta)\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Returns the closure for the selected elements\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {MoveClosure}\r\n */\r\nMoveHelper.prototype.getClosure = function(elements) {\r\n  return new MoveClosure().addAll(elements, true);\r\n};","import MoveHelper from './helper/MoveHelper';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that implements reversible moving of shapes.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function MoveElementsHandler(modeling) {\r\n  this._helper = new MoveHelper(modeling);\r\n}\r\n\r\nMoveElementsHandler.$inject = [ 'modeling' ];\r\n\r\nMoveElementsHandler.prototype.preExecute = function(context) {\r\n  context.closure = this._helper.getClosure(context.shapes);\r\n};\r\n\r\nMoveElementsHandler.prototype.postExecute = function(context) {\r\n\r\n  var hints = context.hints,\r\n      primaryShape;\r\n\r\n  if (hints && hints.primaryShape) {\r\n    primaryShape = hints.primaryShape;\r\n    hints.oldParent = primaryShape.parent;\r\n  }\r\n\r\n  this._helper.moveClosure(\r\n    context.closure,\r\n    context.delta,\r\n    context.newParent,\r\n    context.newHost,\r\n    primaryShape\r\n  );\r\n};","import {\r\n  assign,\r\n  forEach,\r\n  pick\r\n} from 'min-dash';\r\n\r\nimport MoveHelper from './helper/MoveHelper';\r\n\r\nimport {\r\n  add as collectionAdd,\r\n  remove as collectionRemove\r\n} from '../../../util/Collections';\r\n\r\nimport {\r\n  getMovedSourceAnchor,\r\n  getMovedTargetAnchor\r\n} from './helper/AnchorsHelper';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that implements reversible moving of shapes.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function MoveShapeHandler(modeling) {\r\n  this._modeling = modeling;\r\n\r\n  this._helper = new MoveHelper(modeling);\r\n}\r\n\r\nMoveShapeHandler.$inject = [ 'modeling' ];\r\n\r\n\r\nMoveShapeHandler.prototype.execute = function(context) {\r\n\r\n  var shape = context.shape,\r\n      delta = context.delta,\r\n      newParent = context.newParent || shape.parent,\r\n      newParentIndex = context.newParentIndex,\r\n      oldParent = shape.parent;\r\n\r\n  context.oldBounds = pick(shape, [ 'x', 'y', 'width', 'height' ]);\r\n\r\n  // save old parent in context\r\n  context.oldParent = oldParent;\r\n  context.oldParentIndex = collectionRemove(oldParent.children, shape);\r\n\r\n  // add to new parent at position\r\n  collectionAdd(newParent.children, shape, newParentIndex);\r\n\r\n  // update shape parent + position\r\n  assign(shape, {\r\n    parent: newParent,\r\n    x: shape.x + delta.x,\r\n    y: shape.y + delta.y\r\n  });\r\n\r\n  return shape;\r\n};\r\n\r\nMoveShapeHandler.prototype.postExecute = function(context) {\r\n\r\n  var shape = context.shape,\r\n      delta = context.delta,\r\n      hints = context.hints;\r\n\r\n  var modeling = this._modeling;\r\n\r\n  if (hints.layout !== false) {\r\n\r\n    forEach(shape.incoming, function(c) {\r\n      modeling.layoutConnection(c, {\r\n        connectionEnd: getMovedTargetAnchor(c, shape, delta)\r\n      });\r\n    });\r\n\r\n    forEach(shape.outgoing, function(c) {\r\n      modeling.layoutConnection(c, {\r\n        connectionStart: getMovedSourceAnchor(c, shape, delta)\r\n      });\r\n    });\r\n  }\r\n\r\n  if (hints.recurse !== false) {\r\n    this.moveChildren(context);\r\n  }\r\n};\r\n\r\nMoveShapeHandler.prototype.revert = function(context) {\r\n\r\n  var shape = context.shape,\r\n      oldParent = context.oldParent,\r\n      oldParentIndex = context.oldParentIndex,\r\n      delta = context.delta;\r\n\r\n  // restore previous location in old parent\r\n  collectionAdd(oldParent.children, shape, oldParentIndex);\r\n\r\n  // revert to old position and parent\r\n  assign(shape, {\r\n    parent: oldParent,\r\n    x: shape.x - delta.x,\r\n    y: shape.y - delta.y\r\n  });\r\n\r\n  return shape;\r\n};\r\n\r\nMoveShapeHandler.prototype.moveChildren = function(context) {\r\n\r\n  var delta = context.delta,\r\n      shape = context.shape;\r\n\r\n  this._helper.moveRecursive(shape.children, delta, null);\r\n};\r\n\r\nMoveShapeHandler.prototype.getNewParent = function(context) {\r\n  return context.newParent || context.shape.parent;\r\n};\r\n","import { isArray } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * Reconnect connection handler.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function ReconnectConnectionHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nReconnectConnectionHandler.$inject = [ 'modeling' ];\r\n\r\nReconnectConnectionHandler.prototype.execute = function(context) {\r\n  var newSource = context.newSource,\r\n      newTarget = context.newTarget,\r\n      connection = context.connection,\r\n      dockingOrPoints = context.dockingOrPoints;\r\n\r\n  if (!newSource && !newTarget) {\r\n    throw new Error('newSource or newTarget required');\r\n  }\r\n\r\n  if (isArray(dockingOrPoints)) {\r\n    context.oldWaypoints = connection.waypoints;\r\n    connection.waypoints = dockingOrPoints;\r\n  }\r\n\r\n  if (newSource) {\r\n    context.oldSource = connection.source;\r\n    connection.source = newSource;\r\n  }\r\n\r\n  if (newTarget) {\r\n    context.oldTarget = connection.target;\r\n    connection.target = newTarget;\r\n  }\r\n\r\n  return connection;\r\n};\r\n\r\nReconnectConnectionHandler.prototype.postExecute = function(context) {\r\n  var connection = context.connection,\r\n      newSource = context.newSource,\r\n      newTarget = context.newTarget,\r\n      dockingOrPoints = context.dockingOrPoints,\r\n      hints = context.hints || {};\r\n\r\n  var layoutConnectionHints = {};\r\n\r\n  if (hints.connectionStart) {\r\n    layoutConnectionHints.connectionStart = hints.connectionStart;\r\n  }\r\n\r\n  if (hints.connectionEnd) {\r\n    layoutConnectionHints.connectionEnd = hints.connectionEnd;\r\n  }\r\n\r\n  if (hints.layoutConnection === false) {\r\n    return;\r\n  }\r\n\r\n  if (newSource && (!newTarget || hints.docking === 'source')) {\r\n    layoutConnectionHints.connectionStart = layoutConnectionHints.connectionStart\r\n      || getDocking(isArray(dockingOrPoints) ? dockingOrPoints[ 0 ] : dockingOrPoints);\r\n  }\r\n\r\n  if (newTarget && (!newSource || hints.docking === 'target')) {\r\n    layoutConnectionHints.connectionEnd = layoutConnectionHints.connectionEnd\r\n      || getDocking(isArray(dockingOrPoints) ? dockingOrPoints[ dockingOrPoints.length - 1 ] : dockingOrPoints);\r\n  }\r\n\r\n  if (hints.newWaypoints) {\r\n    layoutConnectionHints.waypoints = hints.newWaypoints;\r\n  }\r\n\r\n  this._modeling.layoutConnection(connection, layoutConnectionHints);\r\n};\r\n\r\nReconnectConnectionHandler.prototype.revert = function(context) {\r\n  var oldSource = context.oldSource,\r\n      oldTarget = context.oldTarget,\r\n      oldWaypoints = context.oldWaypoints,\r\n      connection = context.connection;\r\n\r\n  if (oldSource) {\r\n    connection.source = oldSource;\r\n  }\r\n\r\n  if (oldTarget) {\r\n    connection.target = oldTarget;\r\n  }\r\n\r\n  if (oldWaypoints) {\r\n    connection.waypoints = oldWaypoints;\r\n  }\r\n\r\n  return connection;\r\n};\r\n\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction getDocking(point) {\r\n  return point.original || point;\r\n}","import { forEach } from 'min-dash';\r\n\r\nimport {\r\n  getResizedSourceAnchor,\r\n  getResizedTargetAnchor\r\n} from './helper/AnchorsHelper';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../Modeling').default} Modeling\r\n * @typedef {import('../../rules/Rules').default} Rules\r\n */\r\n\r\n/**\r\n * Replace shape by adding new shape and removing old shape. Incoming and outgoing connections will\r\n * be kept if possible.\r\n *\r\n * @class\r\n * @constructor\r\n *\r\n * @param {Modeling} modeling\r\n * @param {Rules} rules\r\n */\r\nexport default function ReplaceShapeHandler(modeling, rules) {\r\n  this._modeling = modeling;\r\n  this._rules = rules;\r\n}\r\n\r\nReplaceShapeHandler.$inject = [ 'modeling', 'rules' ];\r\n\r\n\r\n/**\r\n * Add new shape.\r\n *\r\n * @param {Object} context\r\n * @param {Shape} context.oldShape\r\n * @param {Object} context.newData\r\n * @param {string} context.newData.type\r\n * @param {number} context.newData.x\r\n * @param {number} context.newData.y\r\n * @param {Object} [context.hints]\r\n */\r\nReplaceShapeHandler.prototype.preExecute = function(context) {\r\n  var self = this,\r\n      modeling = this._modeling,\r\n      rules = this._rules;\r\n\r\n  var oldShape = context.oldShape,\r\n      newData = context.newData,\r\n      hints = context.hints || {},\r\n      newShape;\r\n\r\n  function canReconnect(source, target, connection) {\r\n    return rules.allowed('connection.reconnect', {\r\n      connection: connection,\r\n      source: source,\r\n      target: target\r\n    });\r\n  }\r\n\r\n  // (1) add new shape at given position\r\n  var position = {\r\n    x: newData.x,\r\n    y: newData.y\r\n  };\r\n\r\n  var oldBounds = {\r\n    x: oldShape.x,\r\n    y: oldShape.y,\r\n    width: oldShape.width,\r\n    height: oldShape.height\r\n  };\r\n\r\n  newShape = context.newShape =\r\n    context.newShape ||\r\n    self.createShape(newData, position, oldShape.parent, hints);\r\n\r\n  // (2) update host\r\n  if (oldShape.host) {\r\n    modeling.updateAttachment(newShape, oldShape.host);\r\n  }\r\n\r\n  // (3) adopt all children from old shape\r\n  var children;\r\n\r\n  if (hints.moveChildren !== false) {\r\n    children = oldShape.children.slice();\r\n\r\n    modeling.moveElements(children, { x: 0, y: 0 }, newShape, hints);\r\n  }\r\n\r\n  // (4) reconnect connections to new shape if possible\r\n  var incoming = oldShape.incoming.slice(),\r\n      outgoing = oldShape.outgoing.slice();\r\n\r\n  forEach(incoming, function(connection) {\r\n    var source = connection.source,\r\n        allowed = canReconnect(source, newShape, connection);\r\n\r\n    if (allowed) {\r\n      self.reconnectEnd(\r\n        connection, newShape,\r\n        getResizedTargetAnchor(connection, newShape, oldBounds),\r\n        hints\r\n      );\r\n    }\r\n  });\r\n\r\n  forEach(outgoing, function(connection) {\r\n    var target = connection.target,\r\n        allowed = canReconnect(newShape, target, connection);\r\n\r\n    if (allowed) {\r\n      self.reconnectStart(\r\n        connection, newShape,\r\n        getResizedSourceAnchor(connection, newShape, oldBounds),\r\n        hints\r\n      );\r\n    }\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Remove old shape.\r\n */\r\nReplaceShapeHandler.prototype.postExecute = function(context) {\r\n  var oldShape = context.oldShape;\r\n\r\n  this._modeling.removeShape(oldShape);\r\n};\r\n\r\n\r\nReplaceShapeHandler.prototype.execute = function(context) {};\r\n\r\n\r\nReplaceShapeHandler.prototype.revert = function(context) {};\r\n\r\n\r\nReplaceShapeHandler.prototype.createShape = function(shape, position, target, hints) {\r\n  return this._modeling.createShape(shape, position, target, hints);\r\n};\r\n\r\n\r\nReplaceShapeHandler.prototype.reconnectStart = function(connection, newSource, dockingPoint, hints) {\r\n  this._modeling.reconnectStart(connection, newSource, dockingPoint, hints);\r\n};\r\n\r\n\r\nReplaceShapeHandler.prototype.reconnectEnd = function(connection, newTarget, dockingPoint, hints) {\r\n  this._modeling.reconnectEnd(connection, newTarget, dockingPoint, hints);\r\n};\r\n","import {\r\n  assign,\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getResizedSourceAnchor,\r\n  getResizedTargetAnchor\r\n} from './helper/AnchorsHelper';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that implements reversible resizing of shapes.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function ResizeShapeHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nResizeShapeHandler.$inject = [ 'modeling' ];\r\n\r\n/**\r\n * {\r\n *   shape: {....}\r\n *   newBounds: {\r\n *     width:  20,\r\n *     height: 40,\r\n *     x:       5,\r\n *     y:      10\r\n *   }\r\n *\r\n * }\r\n */\r\nResizeShapeHandler.prototype.execute = function(context) {\r\n  var shape = context.shape,\r\n      newBounds = context.newBounds,\r\n      minBounds = context.minBounds;\r\n\r\n  if (newBounds.x === undefined || newBounds.y === undefined ||\r\n      newBounds.width === undefined || newBounds.height === undefined) {\r\n    throw new Error('newBounds must have {x, y, width, height} properties');\r\n  }\r\n\r\n  if (minBounds && (newBounds.width < minBounds.width\r\n    || newBounds.height < minBounds.height)) {\r\n    throw new Error('width and height cannot be less than minimum height and width');\r\n  } else if (!minBounds\r\n    && newBounds.width < 10 || newBounds.height < 10) {\r\n    throw new Error('width and height cannot be less than 10px');\r\n  }\r\n\r\n  // save old bbox in context\r\n  context.oldBounds = {\r\n    width:  shape.width,\r\n    height: shape.height,\r\n    x:      shape.x,\r\n    y:      shape.y\r\n  };\r\n\r\n  // update shape\r\n  assign(shape, {\r\n    width:  newBounds.width,\r\n    height: newBounds.height,\r\n    x:      newBounds.x,\r\n    y:      newBounds.y\r\n  });\r\n\r\n  return shape;\r\n};\r\n\r\nResizeShapeHandler.prototype.postExecute = function(context) {\r\n  var modeling = this._modeling;\r\n\r\n  var shape = context.shape,\r\n      oldBounds = context.oldBounds,\r\n      hints = context.hints || {};\r\n\r\n  if (hints.layout === false) {\r\n    return;\r\n  }\r\n\r\n  forEach(shape.incoming, function(c) {\r\n    modeling.layoutConnection(c, {\r\n      connectionEnd: getResizedTargetAnchor(c, shape, oldBounds)\r\n    });\r\n  });\r\n\r\n  forEach(shape.outgoing, function(c) {\r\n    modeling.layoutConnection(c, {\r\n      connectionStart: getResizedSourceAnchor(c, shape, oldBounds)\r\n    });\r\n  });\r\n\r\n};\r\n\r\nResizeShapeHandler.prototype.revert = function(context) {\r\n\r\n  var shape = context.shape,\r\n      oldBounds = context.oldBounds;\r\n\r\n  // restore previous bbox\r\n  assign(shape, {\r\n    width:  oldBounds.width,\r\n    height: oldBounds.height,\r\n    x:      oldBounds.x,\r\n    y:      oldBounds.y\r\n  });\r\n\r\n  return shape;\r\n};\r\n","import {\r\n  assign,\r\n  forEach,\r\n  map\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getWaypointsUpdatingConnections,\r\n  resizeBounds\r\n} from '../../space-tool/SpaceUtil';\r\n\r\nimport {\r\n  getMovedSourceAnchor,\r\n  getMovedTargetAnchor,\r\n  getResizedSourceAnchor,\r\n  getResizedTargetAnchor\r\n} from './helper/AnchorsHelper';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * Add or remove space by moving and resizing shapes and updating connection waypoints.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function SpaceToolHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nSpaceToolHandler.$inject = [ 'modeling' ];\r\n\r\nSpaceToolHandler.prototype.preExecute = function(context) {\r\n  var delta = context.delta,\r\n      direction = context.direction,\r\n      movingShapes = context.movingShapes,\r\n      resizingShapes = context.resizingShapes,\r\n      start = context.start,\r\n      oldBounds = {};\r\n\r\n  // (1) move shapes\r\n  this.moveShapes(movingShapes, delta);\r\n\r\n  // (2a) save old bounds of resized shapes\r\n  forEach(resizingShapes, function(shape) {\r\n    oldBounds[shape.id] = getBounds(shape);\r\n  });\r\n\r\n  // (2b) resize shapes\r\n  this.resizeShapes(resizingShapes, delta, direction);\r\n\r\n  // (3) update connection waypoints\r\n  this.updateConnectionWaypoints(\r\n    getWaypointsUpdatingConnections(movingShapes, resizingShapes),\r\n    delta,\r\n    direction,\r\n    start,\r\n    movingShapes,\r\n    resizingShapes,\r\n    oldBounds\r\n  );\r\n};\r\n\r\nSpaceToolHandler.prototype.execute = function() {};\r\nSpaceToolHandler.prototype.revert = function() {};\r\n\r\nSpaceToolHandler.prototype.moveShapes = function(shapes, delta) {\r\n  var self = this;\r\n\r\n  forEach(shapes, function(element) {\r\n    self._modeling.moveShape(element, delta, null, {\r\n      autoResize: false,\r\n      layout: false,\r\n      recurse: false\r\n    });\r\n  });\r\n};\r\n\r\nSpaceToolHandler.prototype.resizeShapes = function(shapes, delta, direction) {\r\n  var self = this;\r\n\r\n  forEach(shapes, function(shape) {\r\n    var newBounds = resizeBounds(shape, direction, delta);\r\n\r\n    self._modeling.resizeShape(shape, newBounds, null, {\r\n      attachSupport: false,\r\n      autoResize: false,\r\n      layout: false\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * Update connections waypoints according to the rules:\r\n *   1. Both source and target are moved/resized => move waypoints by the delta\r\n *   2. Only one of source and target is moved/resized => re-layout connection with moved start/end\r\n */\r\nSpaceToolHandler.prototype.updateConnectionWaypoints = function(\r\n    connections,\r\n    delta,\r\n    direction,\r\n    start,\r\n    movingShapes,\r\n    resizingShapes,\r\n    oldBounds\r\n) {\r\n  var self = this,\r\n      affectedShapes = movingShapes.concat(resizingShapes);\r\n\r\n  forEach(connections, function(connection) {\r\n    var source = connection.source,\r\n        target = connection.target,\r\n        waypoints = copyWaypoints(connection),\r\n        axis = getAxisFromDirection(direction),\r\n        layoutHints = {};\r\n\r\n    if (includes(affectedShapes, source) && includes(affectedShapes, target)) {\r\n\r\n      // move waypoints\r\n      waypoints = map(waypoints, function(waypoint) {\r\n        if (shouldMoveWaypoint(waypoint, start, direction)) {\r\n\r\n          // move waypoint\r\n          waypoint[ axis ] = waypoint[ axis ] + delta[ axis ];\r\n        }\r\n\r\n        if (waypoint.original && shouldMoveWaypoint(waypoint.original, start, direction)) {\r\n\r\n          // move waypoint original\r\n          waypoint.original[ axis ] = waypoint.original[ axis ] + delta[ axis ];\r\n        }\r\n\r\n        return waypoint;\r\n      });\r\n\r\n      self._modeling.updateWaypoints(connection, waypoints, {\r\n        labelBehavior: false\r\n      });\r\n    } else if (includes(affectedShapes, source) || includes(affectedShapes, target)) {\r\n\r\n      // re-layout connection with moved start/end\r\n      if (includes(movingShapes, source)) {\r\n        layoutHints.connectionStart = getMovedSourceAnchor(connection, source, delta);\r\n      } else if (includes(movingShapes, target)) {\r\n        layoutHints.connectionEnd = getMovedTargetAnchor(connection, target, delta);\r\n      } else if (includes(resizingShapes, source)) {\r\n        layoutHints.connectionStart = getResizedSourceAnchor(\r\n          connection, source, oldBounds[source.id]\r\n        );\r\n      } else if (includes(resizingShapes, target)) {\r\n        layoutHints.connectionEnd = getResizedTargetAnchor(\r\n          connection, target, oldBounds[target.id]\r\n        );\r\n      }\r\n\r\n      self._modeling.layoutConnection(connection, layoutHints);\r\n    }\r\n  });\r\n};\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction copyWaypoint(waypoint) {\r\n  return assign({}, waypoint);\r\n}\r\n\r\nfunction copyWaypoints(connection) {\r\n  return map(connection.waypoints, function(waypoint) {\r\n\r\n    waypoint = copyWaypoint(waypoint);\r\n\r\n    if (waypoint.original) {\r\n      waypoint.original = copyWaypoint(waypoint.original);\r\n    }\r\n\r\n    return waypoint;\r\n  });\r\n}\r\n\r\nfunction getAxisFromDirection(direction) {\r\n  switch (direction) {\r\n  case 'n':\r\n    return 'y';\r\n  case 'w':\r\n    return 'x';\r\n  case 's':\r\n    return 'y';\r\n  case 'e':\r\n    return 'x';\r\n  }\r\n}\r\n\r\nfunction shouldMoveWaypoint(waypoint, start, direction) {\r\n  var relevantAxis = getAxisFromDirection(direction);\r\n\r\n  if (/e|s/.test(direction)) {\r\n    return waypoint[ relevantAxis ] > start;\r\n  } else if (/n|w/.test(direction)) {\r\n    return waypoint[ relevantAxis ] < start;\r\n  }\r\n}\r\n\r\nfunction includes(array, item) {\r\n  return array.indexOf(item) !== -1;\r\n}\r\n\r\nfunction getBounds(shape) {\r\n  return {\r\n    x: shape.x,\r\n    y: shape.y,\r\n    height: shape.height,\r\n    width: shape.width\r\n  };\r\n}\r\n","import {\r\n  assign,\r\n  forEach\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that toggles the collapsed state of an element\r\n * and the visibility of all its children.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function ToggleShapeCollapseHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nToggleShapeCollapseHandler.$inject = [ 'modeling' ];\r\n\r\n\r\nToggleShapeCollapseHandler.prototype.execute = function(context) {\r\n\r\n  var shape = context.shape,\r\n      children = shape.children;\r\n\r\n  // recursively remember previous visibility of children\r\n  context.oldChildrenVisibility = getElementsVisibilityRecursive(children);\r\n\r\n  // toggle state\r\n  shape.collapsed = !shape.collapsed;\r\n\r\n  // recursively hide/show children\r\n  var result = setHiddenRecursive(children, shape.collapsed);\r\n\r\n  return [ shape ].concat(result);\r\n};\r\n\r\n\r\nToggleShapeCollapseHandler.prototype.revert = function(context) {\r\n\r\n  var shape = context.shape,\r\n      oldChildrenVisibility = context.oldChildrenVisibility;\r\n\r\n  var children = shape.children;\r\n\r\n  // recursively set old visability of children\r\n  var result = restoreVisibilityRecursive(children, oldChildrenVisibility);\r\n\r\n  // retoggle state\r\n  shape.collapsed = !shape.collapsed;\r\n\r\n  return [ shape ].concat(result);\r\n};\r\n\r\n\r\n// helpers //////////////////////\r\n\r\n/**\r\n * Return a map { elementId -> hiddenState}.\r\n *\r\n * @param {Shape[]} elements\r\n *\r\n * @return {Object}\r\n */\r\nfunction getElementsVisibilityRecursive(elements) {\r\n\r\n  var result = {};\r\n\r\n  forEach(elements, function(element) {\r\n    result[element.id] = element.hidden;\r\n\r\n    if (element.children) {\r\n      result = assign({}, result, getElementsVisibilityRecursive(element.children));\r\n    }\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n\r\nfunction setHiddenRecursive(elements, newHidden) {\r\n  var result = [];\r\n  forEach(elements, function(element) {\r\n    element.hidden = newHidden;\r\n\r\n    result = result.concat(element);\r\n\r\n    if (element.children) {\r\n      result = result.concat(setHiddenRecursive(element.children, element.collapsed || newHidden));\r\n    }\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nfunction restoreVisibilityRecursive(elements, lastState) {\r\n  var result = [];\r\n  forEach(elements, function(element) {\r\n    element.hidden = lastState[element.id];\r\n\r\n    result = result.concat(element);\r\n\r\n    if (element.children) {\r\n      result = result.concat(restoreVisibilityRecursive(element.children, lastState));\r\n    }\r\n  });\r\n\r\n  return result;\r\n}\r\n","import {\r\n  add as collectionAdd,\r\n  remove as collectionRemove\r\n} from '../../../util/Collections';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * A handler that implements reversible attaching/detaching of shapes.\r\n *\r\n * @param {Modeling} modeling\r\n */\r\nexport default function UpdateAttachmentHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nUpdateAttachmentHandler.$inject = [ 'modeling' ];\r\n\r\n\r\nUpdateAttachmentHandler.prototype.execute = function(context) {\r\n  var shape = context.shape,\r\n      newHost = context.newHost,\r\n      oldHost = shape.host;\r\n\r\n  // (0) detach from old host\r\n  context.oldHost = oldHost;\r\n  context.attacherIdx = removeAttacher(oldHost, shape);\r\n\r\n  // (1) attach to new host\r\n  addAttacher(newHost, shape);\r\n\r\n  // (2) update host\r\n  shape.host = newHost;\r\n\r\n  return shape;\r\n};\r\n\r\nUpdateAttachmentHandler.prototype.revert = function(context) {\r\n  var shape = context.shape,\r\n      newHost = context.newHost,\r\n      oldHost = context.oldHost,\r\n      attacherIdx = context.attacherIdx;\r\n\r\n  // (2) update host\r\n  shape.host = oldHost;\r\n\r\n  // (1) attach to new host\r\n  removeAttacher(newHost, shape);\r\n\r\n  // (0) detach from old host\r\n  addAttacher(oldHost, shape, attacherIdx);\r\n\r\n  return shape;\r\n};\r\n\r\n\r\nfunction removeAttacher(host, attacher) {\r\n\r\n  // remove attacher from host\r\n  return collectionRemove(host && host.attachers, attacher);\r\n}\r\n\r\nfunction addAttacher(host, attacher, idx) {\r\n\r\n  if (!host) {\r\n    return;\r\n  }\r\n\r\n  var attachers = host.attachers;\r\n\r\n  if (!attachers) {\r\n    host.attachers = attachers = [];\r\n  }\r\n\r\n  collectionAdd(attachers, attacher, idx);\r\n}\r\n","export default function UpdateWaypointsHandler() { }\r\n\r\nUpdateWaypointsHandler.prototype.execute = function(context) {\r\n\r\n  var connection = context.connection,\r\n      newWaypoints = context.newWaypoints;\r\n\r\n  context.oldWaypoints = connection.waypoints;\r\n\r\n  connection.waypoints = newWaypoints;\r\n\r\n  return connection;\r\n};\r\n\r\nUpdateWaypointsHandler.prototype.revert = function(context) {\r\n\r\n  var connection = context.connection,\r\n      oldWaypoints = context.oldWaypoints;\r\n\r\n  connection.waypoints = oldWaypoints;\r\n\r\n  return connection;\r\n};","import {\r\n  assign,\r\n  forEach,\r\n  isArray\r\n} from 'min-dash';\r\n\r\nimport AlignElementsHandler from './cmd/AlignElementsHandler';\r\nimport AppendShapeHandler from './cmd/AppendShapeHandler';\r\nimport CreateConnectionHandler from './cmd/CreateConnectionHandler';\r\nimport CreateElementsHandler from './cmd/CreateElementsHandler';\r\nimport CreateLabelHandler from './cmd/CreateLabelHandler';\r\nimport CreateShapeHandler from './cmd/CreateShapeHandler';\r\nimport DeleteConnectionHandler from './cmd/DeleteConnectionHandler';\r\nimport DeleteElementsHandler from './cmd/DeleteElementsHandler';\r\nimport DeleteShapeHandler from './cmd/DeleteShapeHandler';\r\nimport DistributeElementsHandler from './cmd/DistributeElementsHandler';\r\nimport LayoutConnectionHandler from './cmd/LayoutConnectionHandler';\r\nimport MoveConnectionHandler from './cmd/MoveConnectionHandler';\r\nimport MoveElementsHandler from './cmd/MoveElementsHandler';\r\nimport MoveShapeHandler from './cmd/MoveShapeHandler';\r\nimport ReconnectConnectionHandler from './cmd/ReconnectConnectionHandler';\r\nimport ReplaceShapeHandler from './cmd/ReplaceShapeHandler';\r\nimport ResizeShapeHandler from './cmd/ResizeShapeHandler';\r\nimport SpaceToolHandler from './cmd/SpaceToolHandler';\r\nimport ToggleShapeCollapseHandler from './cmd/ToggleShapeCollapseHandler';\r\nimport UpdateAttachmentHandler from './cmd/UpdateAttachmentHandler';\r\nimport UpdateWaypointsHandler from './cmd/UpdateWaypointsHandler';\r\n\r\nimport { isModelElement } from '../../model';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n * @typedef {import('../../model/Types').Connection} Connection\r\n * @typedef {import('../../model/Types').Parent} Parent\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n * @typedef {import('../../model/Types').Label} Label\r\n *\r\n * @typedef {import('../../command/CommandStack').default} CommandStack\r\n * @typedef {import('../../core/ElementFactory').default} ElementFactory\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('../../command/CommandStack').CommandHandlerConstructor} CommandHandlerConstructor\r\n *\r\n * @typedef {import('../../util/Types').Dimensions} Dimensions\r\n * @typedef {import('../../util/Types').Direction} Direction\r\n * @typedef {import('../../util/Types').Point} Point\r\n * @typedef {import('../../util/Types').Rect} Rect\r\n *\r\n * @typedef { 'x' | 'y' } ModelingDistributeAxis\r\n *\r\n * @typedef { 'width' | 'height' } ModelingDistributeDimension\r\n *\r\n * @typedef { {\r\n *   bottom?: number;\r\n *   center?: number;\r\n *   left?: number;\r\n *   middle?: number;\r\n *   right?: number;\r\n *   top?: number;\r\n * } } ModelingAlignAlignment\r\n *\r\n * @typedef { {\r\n *   [key: string]: any;\r\n * } } ModelingHints\r\n *\r\n * @typedef { {\r\n *   attach?: boolean;\r\n * } & ModelingHints } ModelingMoveElementsHints\r\n *\r\n * @typedef { {\r\n *   attach?: boolean;\r\n * } & ModelingHints } ModelingCreateShapeHints\r\n */\r\n\r\n/**\r\n * @template {Element} U\r\n *\r\n * @typedef { {\r\n *   elements: U[],\r\n *   range: {\r\n *     min: number;\r\n *     max: number;\r\n *   } }\r\n * } ModelingDistributeGroup\r\n */\r\n\r\n/**\r\n * The basic modeling entry point.\r\n *\r\n * @template {Connection} [T=Connection]\r\n * @template {Element} [U=Element]\r\n * @template {Label} [V=Label]\r\n * @template {Parent} [W=Parent]\r\n * @template {Shape} [X=Shape]\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {ElementFactory} elementFactory\r\n * @param {CommandStack} commandStack\r\n */\r\nexport default function Modeling(eventBus, elementFactory, commandStack) {\r\n  this._eventBus = eventBus;\r\n  this._elementFactory = elementFactory;\r\n  this._commandStack = commandStack;\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('diagram.init', function() {\r\n\r\n    // register modeling handlers\r\n    self.registerHandlers(commandStack);\r\n  });\r\n}\r\n\r\nModeling.$inject = [ 'eventBus', 'elementFactory', 'commandStack' ];\r\n\r\n/**\r\n * Get a map of all command handlers.\r\n *\r\n * @return {Map<string, CommandHandlerConstructor>}\r\n */\r\nModeling.prototype.getHandlers = function() {\r\n  return {\r\n    'shape.append': AppendShapeHandler,\r\n    'shape.create': CreateShapeHandler,\r\n    'shape.delete': DeleteShapeHandler,\r\n    'shape.move': MoveShapeHandler,\r\n    'shape.resize': ResizeShapeHandler,\r\n    'shape.replace': ReplaceShapeHandler,\r\n    'shape.toggleCollapse': ToggleShapeCollapseHandler,\r\n\r\n    'spaceTool': SpaceToolHandler,\r\n\r\n    'label.create': CreateLabelHandler,\r\n\r\n    'connection.create': CreateConnectionHandler,\r\n    'connection.delete': DeleteConnectionHandler,\r\n    'connection.move': MoveConnectionHandler,\r\n    'connection.layout': LayoutConnectionHandler,\r\n\r\n    'connection.updateWaypoints': UpdateWaypointsHandler,\r\n\r\n    'connection.reconnect': ReconnectConnectionHandler,\r\n\r\n    'elements.create': CreateElementsHandler,\r\n    'elements.move': MoveElementsHandler,\r\n    'elements.delete': DeleteElementsHandler,\r\n\r\n    'elements.distribute': DistributeElementsHandler,\r\n    'elements.align': AlignElementsHandler,\r\n\r\n    'element.updateAttachment': UpdateAttachmentHandler\r\n  };\r\n};\r\n\r\n/**\r\n * Register handlers with the command stack\r\n *\r\n * @param {CommandStack} commandStack\r\n */\r\nModeling.prototype.registerHandlers = function(commandStack) {\r\n  forEach(this.getHandlers(), function(handler, id) {\r\n    commandStack.registerHandler(id, handler);\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Move a shape by the given delta and optionally to a new parent.\r\n *\r\n * @param {X} shape\r\n * @param {Point} delta\r\n * @param {W} [newParent]\r\n * @param {number} [newParentIndex]\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.moveShape = function(shape, delta, newParent, newParentIndex, hints) {\r\n\r\n  if (typeof newParentIndex === 'object') {\r\n    hints = newParentIndex;\r\n    newParentIndex = null;\r\n  }\r\n\r\n  var context = {\r\n    shape: shape,\r\n    delta:  delta,\r\n    newParent: newParent,\r\n    newParentIndex: newParentIndex,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('shape.move', context);\r\n};\r\n\r\n\r\n/**\r\n * Update the attachment of a shape.\r\n *\r\n * @param {X} shape\r\n * @param {X} [newHost=undefined]\r\n */\r\nModeling.prototype.updateAttachment = function(shape, newHost) {\r\n  var context = {\r\n    shape: shape,\r\n    newHost: newHost\r\n  };\r\n\r\n  this._commandStack.execute('element.updateAttachment', context);\r\n};\r\n\r\n\r\n/**\r\n * Move elements by a given delta and optionally to a new parent.\r\n *\r\n * @param {U[]} shapes\r\n * @param {Point} delta\r\n * @param {W} [target]\r\n * @param {ModelingMoveElementsHints} [hints]\r\n */\r\nModeling.prototype.moveElements = function(shapes, delta, target, hints) {\r\n\r\n  hints = hints || {};\r\n\r\n  var attach = hints.attach;\r\n\r\n  var newParent = target,\r\n      newHost;\r\n\r\n  if (attach === true) {\r\n    newHost = target;\r\n    newParent = target.parent;\r\n  } else if (attach === false) {\r\n    newHost = null;\r\n  }\r\n\r\n  var context = {\r\n    shapes: shapes,\r\n    delta: delta,\r\n    newParent: newParent,\r\n    newHost: newHost,\r\n    hints: hints\r\n  };\r\n\r\n  this._commandStack.execute('elements.move', context);\r\n};\r\n\r\n/**\r\n * Move a shape by the given delta and optionally to a new parent.\r\n *\r\n * @param {T} connection\r\n * @param {Point} delta\r\n * @param {W} [newParent]\r\n * @param {number} [newParentIndex]\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.moveConnection = function(connection, delta, newParent, newParentIndex, hints) {\r\n\r\n  if (typeof newParentIndex === 'object') {\r\n    hints = newParentIndex;\r\n    newParentIndex = undefined;\r\n  }\r\n\r\n  var context = {\r\n    connection: connection,\r\n    delta: delta,\r\n    newParent: newParent,\r\n    newParentIndex: newParentIndex,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('connection.move', context);\r\n};\r\n\r\n/**\r\n * Layout a connection.\r\n *\r\n * @param {T} connection\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.layoutConnection = function(connection, hints) {\r\n  var context = {\r\n    connection: connection,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('connection.layout', context);\r\n};\r\n\r\n/**\r\n * Create a connection.\r\n *\r\n * @overlord\r\n *\r\n * @param {U} source\r\n * @param {U} target\r\n * @param {Partial<T>} connection\r\n * @param {W} parent\r\n * @param {ModelingHints} [hints]\r\n *\r\n * @return {T}\r\n */\r\n\r\n/**\r\n * Create a connection.\r\n *\r\n * @param {U} source\r\n * @param {U} target\r\n * @param {number} parentIndex\r\n * @param {Partial<T>} connection\r\n * @param {W} parent\r\n * @param {ModelingHints} [hints]\r\n *\r\n * @return {T}\r\n */\r\nModeling.prototype.createConnection = function(source, target, parentIndex, connection, parent, hints) {\r\n\r\n  if (typeof parentIndex === 'object') {\r\n    hints = parent;\r\n    parent = connection;\r\n    connection = parentIndex;\r\n    parentIndex = undefined;\r\n  }\r\n\r\n  connection = this._create('connection', connection);\r\n\r\n  var context = {\r\n    source: source,\r\n    target: target,\r\n    parent: parent,\r\n    parentIndex: parentIndex,\r\n    connection: connection,\r\n    hints: hints\r\n  };\r\n\r\n  this._commandStack.execute('connection.create', context);\r\n\r\n  return context.connection;\r\n};\r\n\r\n\r\n/**\r\n * Create a shape.\r\n *\r\n * @overlord\r\n *\r\n * @param {Partial<X>} shape\r\n * @param {Point} position\r\n * @param {W} target\r\n * @param {ModelingCreateShapeHints} [hints]\r\n *\r\n * @return {X}\r\n */\r\n\r\n/**\r\n * Create a shape.\r\n *\r\n * @param {Partial<X>} shape\r\n * @param {Point} position\r\n * @param {W} target\r\n * @param {number} parentIndex\r\n * @param {ModelingCreateShapeHints} [hints]\r\n *\r\n * @return {X}\r\n */\r\nModeling.prototype.createShape = function(shape, position, target, parentIndex, hints) {\r\n\r\n  if (typeof parentIndex !== 'number') {\r\n    hints = parentIndex;\r\n    parentIndex = undefined;\r\n  }\r\n\r\n  hints = hints || {};\r\n\r\n  var attach = hints.attach,\r\n      parent,\r\n      host;\r\n\r\n  shape = this._create('shape', shape);\r\n\r\n  if (attach) {\r\n    parent = target.parent;\r\n    host = target;\r\n  } else {\r\n    parent = target;\r\n  }\r\n\r\n  var context = {\r\n    position: position,\r\n    shape: shape,\r\n    parent: parent,\r\n    parentIndex: parentIndex,\r\n    host: host,\r\n    hints: hints\r\n  };\r\n\r\n  this._commandStack.execute('shape.create', context);\r\n\r\n  return context.shape;\r\n};\r\n\r\n/**\r\n * Create elements.\r\n *\r\n * @param {Partial<U>[]} elements\r\n * @param {Point} position\r\n * @param {W} parent\r\n * @param {number} [parentIndex]\r\n * @param {ModelingHints} [hints]\r\n *\r\n * @return {U[]}\r\n */\r\nModeling.prototype.createElements = function(elements, position, parent, parentIndex, hints) {\r\n  if (!isArray(elements)) {\r\n    elements = [ elements ];\r\n  }\r\n\r\n  if (typeof parentIndex !== 'number') {\r\n    hints = parentIndex;\r\n    parentIndex = undefined;\r\n  }\r\n\r\n  hints = hints || {};\r\n\r\n  var context = {\r\n    position: position,\r\n    elements: elements,\r\n    parent: parent,\r\n    parentIndex: parentIndex,\r\n    hints: hints\r\n  };\r\n\r\n  this._commandStack.execute('elements.create', context);\r\n\r\n  return context.elements;\r\n};\r\n\r\n/**\r\n * Create a label.\r\n *\r\n * @param {U} labelTarget\r\n * @param {Point} position\r\n * @param {Partial<V>} label\r\n * @param {W} [parent]\r\n *\r\n * @return {V}\r\n */\r\nModeling.prototype.createLabel = function(labelTarget, position, label, parent) {\r\n\r\n  label = this._create('label', label);\r\n\r\n  var context = {\r\n    labelTarget: labelTarget,\r\n    position: position,\r\n    parent: parent || labelTarget.parent,\r\n    shape: label\r\n  };\r\n\r\n  this._commandStack.execute('label.create', context);\r\n\r\n  return context.shape;\r\n};\r\n\r\n\r\n/**\r\n * Create and connect a shape to a source.\r\n *\r\n * @param {U} source\r\n * @param {Partial<X>} shape\r\n * @param {Point} position\r\n * @param {W} target\r\n * @param {ModelingHints} [hints]\r\n *\r\n * @return {X}\r\n */\r\nModeling.prototype.appendShape = function(source, shape, position, target, hints) {\r\n\r\n  hints = hints || {};\r\n\r\n  shape = this._create('shape', shape);\r\n\r\n  var context = {\r\n    source: source,\r\n    position: position,\r\n    target: target,\r\n    shape: shape,\r\n    connection: hints.connection,\r\n    connectionParent: hints.connectionParent,\r\n    hints: hints\r\n  };\r\n\r\n  this._commandStack.execute('shape.append', context);\r\n\r\n  return context.shape;\r\n};\r\n\r\n/**\r\n * Remove elements.\r\n *\r\n * @param {U[]} elements\r\n */\r\nModeling.prototype.removeElements = function(elements) {\r\n  var context = {\r\n    elements: elements\r\n  };\r\n\r\n  this._commandStack.execute('elements.delete', context);\r\n};\r\n\r\n/**\r\n * Distribute elements along a given axis.\r\n *\r\n * @param {ModelingDistributeGroup<U>[]} groups\r\n * @param {ModelingDistributeAxis} axis\r\n * @param {ModelingDistributeDimension} dimension\r\n */\r\nModeling.prototype.distributeElements = function(groups, axis, dimension) {\r\n  var context = {\r\n    groups: groups,\r\n    axis: axis,\r\n    dimension: dimension\r\n  };\r\n\r\n  this._commandStack.execute('elements.distribute', context);\r\n};\r\n\r\n/**\r\n * Remove a shape.\r\n *\r\n * @param {X} shape\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.removeShape = function(shape, hints) {\r\n  var context = {\r\n    shape: shape,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('shape.delete', context);\r\n};\r\n\r\n/**\r\n * Remove a connection.\r\n *\r\n * @param {T} connection\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.removeConnection = function(connection, hints) {\r\n  var context = {\r\n    connection: connection,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('connection.delete', context);\r\n};\r\n\r\n/**\r\n * Replace a shape.\r\n *\r\n * @param {X} oldShape\r\n * @param {Partial<X>} newShape\r\n * @param {ModelingHints} [hints]\r\n *\r\n * @return {X}\r\n */\r\nModeling.prototype.replaceShape = function(oldShape, newShape, hints) {\r\n  var context = {\r\n    oldShape: oldShape,\r\n    newData: newShape,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('shape.replace', context);\r\n\r\n  return context.newShape;\r\n};\r\n\r\n/**\r\n * Align elements.\r\n *\r\n * @param {U[]} elements\r\n * @param {ModelingAlignAlignment} alignment\r\n */\r\nModeling.prototype.alignElements = function(elements, alignment) {\r\n  var context = {\r\n    elements: elements,\r\n    alignment: alignment\r\n  };\r\n\r\n  this._commandStack.execute('elements.align', context);\r\n};\r\n\r\n/**\r\n * Resize a shape.\r\n *\r\n * @param {X} shape\r\n * @param {Rect} newBounds\r\n * @param {Dimensions} [minBounds]\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.resizeShape = function(shape, newBounds, minBounds, hints) {\r\n  var context = {\r\n    shape: shape,\r\n    newBounds: newBounds,\r\n    minBounds: minBounds,\r\n    hints: hints\r\n  };\r\n\r\n  this._commandStack.execute('shape.resize', context);\r\n};\r\n\r\n/**\r\n * Create space along an horizontally or vertically.\r\n *\r\n * @param {X[]} movingShapes\r\n * @param {X[]} resizingShapes\r\n * @param {Point} delta\r\n * @param {Direction} direction\r\n * @param {number} start\r\n */\r\nModeling.prototype.createSpace = function(movingShapes, resizingShapes, delta, direction, start) {\r\n  var context = {\r\n    delta: delta,\r\n    direction: direction,\r\n    movingShapes: movingShapes,\r\n    resizingShapes: resizingShapes,\r\n    start: start\r\n  };\r\n\r\n  this._commandStack.execute('spaceTool', context);\r\n};\r\n\r\n/**\r\n * Update a connetions waypoints.\r\n *\r\n * @param {T} connection\r\n * @param {Point[]} newWaypoints\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.updateWaypoints = function(connection, newWaypoints, hints) {\r\n  var context = {\r\n    connection: connection,\r\n    newWaypoints: newWaypoints,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('connection.updateWaypoints', context);\r\n};\r\n\r\n/**\r\n * Reconnect a connections source and/or target.\r\n *\r\n * @param {T} connection\r\n * @param {U} source\r\n * @param {U} target\r\n * @param {Point|Point[]} dockingOrPoints\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.reconnect = function(connection, source, target, dockingOrPoints, hints) {\r\n  var context = {\r\n    connection: connection,\r\n    newSource: source,\r\n    newTarget: target,\r\n    dockingOrPoints: dockingOrPoints,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('connection.reconnect', context);\r\n};\r\n\r\n/**\r\n * Reconnect a connections source.\r\n *\r\n * @param {T} connection\r\n * @param {U} newSource\r\n * @param {Point|Point[]} dockingOrPoints\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.reconnectStart = function(connection, newSource, dockingOrPoints, hints) {\r\n  if (!hints) {\r\n    hints = {};\r\n  }\r\n\r\n  this.reconnect(connection, newSource, connection.target, dockingOrPoints, assign(hints, {\r\n    docking: 'source'\r\n  }));\r\n};\r\n\r\n/**\r\n * Reconnect a connections target.\r\n *\r\n * @param {T} connection\r\n * @param {U} newTarget\r\n * @param {Point|Point[]} dockingOrPoints\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.reconnectEnd = function(connection, newTarget, dockingOrPoints, hints) {\r\n  if (!hints) {\r\n    hints = {};\r\n  }\r\n\r\n  this.reconnect(connection, connection.source, newTarget, dockingOrPoints, assign(hints, {\r\n    docking: 'target'\r\n  }));\r\n};\r\n\r\n/**\r\n * Connect two elements.\r\n *\r\n * @param {U} source\r\n * @param {U} target\r\n * @param {Partial<T>} [attrs]\r\n * @param {ModelingHints} [hints]\r\n *\r\n * @return {T}\r\n */\r\nModeling.prototype.connect = function(source, target, attrs, hints) {\r\n  return this.createConnection(source, target, attrs || {}, source.parent, hints);\r\n};\r\n\r\nModeling.prototype._create = function(type, attrs) {\r\n  if (isModelElement(attrs)) {\r\n    return attrs;\r\n  } else {\r\n    return this._elementFactory.create(type, attrs);\r\n  }\r\n};\r\n\r\n/**\r\n * Collapse or expand a shape.\r\n *\r\n * @param {X} shape\r\n * @param {ModelingHints} [hints]\r\n */\r\nModeling.prototype.toggleCollapse = function(shape, hints) {\r\n  var context = {\r\n    shape: shape,\r\n    hints: hints || {}\r\n  };\r\n\r\n  this._commandStack.execute('shape.toggleCollapse', context);\r\n};\r\n","import {\n  reduce,\n  keys,\n  forEach\n} from 'min-dash';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n * @typedef {import('../../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * @implements {CommandHandler}\n *\n * @param {ElementRegistry} elementRegistry\n */\nexport default function UpdateModdlePropertiesHandler(elementRegistry) {\n  this._elementRegistry = elementRegistry;\n}\n\nUpdateModdlePropertiesHandler.$inject = [ 'elementRegistry' ];\n\nUpdateModdlePropertiesHandler.prototype.execute = function(context) {\n\n  var element = context.element,\n      moddleElement = context.moddleElement,\n      properties = context.properties;\n\n  if (!moddleElement) {\n    throw new Error('<moddleElement> required');\n  }\n\n  // TODO(nikku): we need to ensure that ID properties\n  // are properly registered / unregistered via\n  // this._moddle.ids.assigned(id)\n  var changed = context.changed || this._getVisualReferences(moddleElement).concat(element);\n  var oldProperties = context.oldProperties || getModdleProperties(moddleElement, keys(properties));\n\n  setModdleProperties(moddleElement, properties);\n\n  context.oldProperties = oldProperties;\n  context.changed = changed;\n\n  return changed;\n};\n\nUpdateModdlePropertiesHandler.prototype.revert = function(context) {\n  var oldProperties = context.oldProperties,\n      moddleElement = context.moddleElement,\n      changed = context.changed;\n\n  setModdleProperties(moddleElement, oldProperties);\n\n  return changed;\n};\n\n/**\n * Return visual references of given moddle element within the diagram.\n *\n * @param {ModdleElement} moddleElement\n *\n * @return {Shape[]}\n */\nUpdateModdlePropertiesHandler.prototype._getVisualReferences = function(moddleElement) {\n\n  var elementRegistry = this._elementRegistry;\n\n  if (is(moddleElement, 'bpmn:DataObject')) {\n    return getAllDataObjectReferences(moddleElement, elementRegistry);\n  }\n\n  return [];\n};\n\n\n// helpers /////////////////\n\nfunction getModdleProperties(moddleElement, propertyNames) {\n  return reduce(propertyNames, function(result, key) {\n    result[key] = moddleElement.get(key);\n    return result;\n  }, {});\n}\n\nfunction setModdleProperties(moddleElement, properties) {\n  forEach(properties, function(value, key) {\n    moddleElement.set(key, value);\n  });\n}\n\nfunction getAllDataObjectReferences(dataObject, elementRegistry) {\n  return elementRegistry.filter(function(element) {\n    return (\n      is(element, 'bpmn:DataObjectReference') &&\n          getBusinessObject(element).dataObjectRef === dataObject\n    );\n  });\n}\n","import {\n  reduce,\n  keys,\n  forEach,\n  assign\n} from 'min-dash';\n\nimport {\n  getBusinessObject,\n  getDi\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n * @typedef {import('diagram-js/lib/command/CommandStack').CommandContext} CommandContext\n *\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../../model/Types').Moddle} Moddle\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../../draw/TextRenderer').default} TextRenderer\n *\n * @typedef {import('../../../model/Types').Element} Element\n */\n\nvar DEFAULT_FLOW = 'default',\n    ID = 'id',\n    DI = 'di';\n\nvar NULL_DIMENSIONS = {\n  width: 0,\n  height: 0\n};\n\n/**\n * A handler that implements a BPMN 2.0 property update.\n *\n * This should be used to set simple properties on elements with\n * an underlying BPMN business object.\n *\n * Use respective diagram-js provided handlers if you would\n * like to perform automated modeling.\n *\n * @implements {CommandHandler}\n *\n * @param {ElementRegistry} elementRegistry\n * @param {Moddle} moddle\n * @param {Modeling} modeling\n * @param {TextRenderer} textRenderer\n */\nexport default function UpdatePropertiesHandler(\n    elementRegistry, moddle,\n    modeling, textRenderer) {\n\n  this._elementRegistry = elementRegistry;\n  this._moddle = moddle;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n}\n\nUpdatePropertiesHandler.$inject = [\n  'elementRegistry',\n  'moddle',\n  'modeling',\n  'textRenderer'\n];\n\n\n// api //////////////////////\n\n/**\n * Update a BPMN element's properties.\n *\n * @param { {\n *   element: Element;\n *   properties: Record<string, any>;\n * } & CommandContext } context\n *\n * @return {Element[]}\n */\nUpdatePropertiesHandler.prototype.execute = function(context) {\n\n  var element = context.element,\n      changed = [ element ];\n\n  if (!element) {\n    throw new Error('element required');\n  }\n\n  var elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  var businessObject = element.businessObject,\n      properties = unwrapBusinessObjects(context.properties),\n      oldProperties = context.oldProperties || getProperties(element, properties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(businessObject[ID]);\n\n    elementRegistry.updateId(element, properties[ID]);\n\n    ids.claim(properties[ID], businessObject);\n  }\n\n  // correctly indicate visual changes on default flow updates\n  if (DEFAULT_FLOW in properties) {\n\n    if (properties[DEFAULT_FLOW]) {\n      changed.push(elementRegistry.get(properties[DEFAULT_FLOW].id));\n    }\n\n    if (businessObject[DEFAULT_FLOW]) {\n      changed.push(elementRegistry.get(businessObject[DEFAULT_FLOW].id));\n    }\n  }\n\n  // update properties\n  setProperties(element, properties);\n\n  // store old values\n  context.oldProperties = oldProperties;\n  context.changed = changed;\n\n  // indicate changed on objects affected by the update\n  return changed;\n};\n\n\nUpdatePropertiesHandler.prototype.postExecute = function(context) {\n  var element = context.element,\n      label = element.label;\n\n  var text = label && getBusinessObject(label).name;\n\n  if (!text) {\n    return;\n  }\n\n  // get layouted text bounds and resize external\n  // external label accordingly\n  var newLabelBounds = this._textRenderer.getExternalLabelBounds(label, text);\n\n  this._modeling.resizeShape(label, newLabelBounds, NULL_DIMENSIONS);\n};\n\n/**\n * Revert updating a BPMN element's properties.\n *\n * @param { {\n *   element: Element;\n *   properties: Record<string, any>;\n *   oldProperties: Record<string, any>;\n * } & CommandContext } context\n *\n * @return {Element[]}\n */\nUpdatePropertiesHandler.prototype.revert = function(context) {\n\n  var element = context.element,\n      properties = context.properties,\n      oldProperties = context.oldProperties,\n      businessObject = element.businessObject,\n      elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  // update properties\n  setProperties(element, oldProperties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(properties[ID]);\n\n    elementRegistry.updateId(element, oldProperties[ID]);\n\n    ids.claim(oldProperties[ID], businessObject);\n  }\n\n  return context.changed;\n};\n\n\nfunction isIdChange(properties, businessObject) {\n  return ID in properties && properties[ID] !== businessObject[ID];\n}\n\n\nfunction getProperties(element, properties) {\n  var propertyNames = keys(properties),\n      businessObject = element.businessObject,\n      di = getDi(element);\n\n  return reduce(propertyNames, function(result, key) {\n\n    // handle DI separately\n    if (key !== DI) {\n      result[key] = businessObject.get(key);\n\n    } else {\n      result[key] = getDiProperties(di, keys(properties.di));\n    }\n\n    return result;\n  }, {});\n}\n\n\nfunction getDiProperties(di, propertyNames) {\n  return reduce(propertyNames, function(result, key) {\n    result[key] = di && di.get(key);\n\n    return result;\n  }, {});\n}\n\n\nfunction setProperties(element, properties) {\n  var businessObject = element.businessObject,\n      di = getDi(element);\n\n  forEach(properties, function(value, key) {\n\n    if (key !== DI) {\n      businessObject.set(key, value);\n    } else {\n\n      // only update, if di exists\n      if (di) {\n        setDiProperties(di, value);\n      }\n    }\n  });\n}\n\n\nfunction setDiProperties(di, properties) {\n  forEach(properties, function(value, key) {\n    di.set(key, value);\n  });\n}\n\n\nvar referencePropertyNames = [ 'default' ];\n\n/**\n * Make sure we unwrap the actual business object behind diagram element that\n * may have been passed as arguments.\n *\n * @param  {Record<string, any>} properties\n *\n * @return {Record<string, any>} unwrappedProps\n */\nfunction unwrapBusinessObjects(properties) {\n\n  var unwrappedProps = assign({}, properties);\n\n  referencePropertyNames.forEach(function(name) {\n    if (name in properties) {\n      unwrappedProps[name] = getBusinessObject(unwrappedProps[name]);\n    }\n  });\n\n  return unwrappedProps;\n}","import {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport { getDi } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * @implements {CommandHandler}\n *\n * @param {Canvas} canvas\n * @param {Modeling} modeling\n */\nexport default function UpdateCanvasRootHandler(canvas, modeling) {\n  this._canvas = canvas;\n  this._modeling = modeling;\n}\n\nUpdateCanvasRootHandler.$inject = [\n  'canvas',\n  'modeling'\n];\n\n\nUpdateCanvasRootHandler.prototype.execute = function(context) {\n\n  var canvas = this._canvas;\n\n  var newRoot = context.newRoot,\n      newRootBusinessObject = newRoot.businessObject,\n      oldRoot = canvas.getRootElement(),\n      oldRootBusinessObject = oldRoot.businessObject,\n      bpmnDefinitions = oldRootBusinessObject.$parent,\n      diPlane = getDi(oldRoot);\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(newRoot);\n  canvas.removeRootElement(oldRoot);\n\n  // (2) update root elements\n  collectionAdd(bpmnDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = bpmnDefinitions;\n\n  collectionRemove(bpmnDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = null;\n\n  // (3) wire di\n  oldRoot.di = null;\n\n  diPlane.bpmnElement = newRootBusinessObject;\n  newRoot.di = diPlane;\n\n  context.oldRoot = oldRoot;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n  return [];\n};\n\n\nUpdateCanvasRootHandler.prototype.revert = function(context) {\n\n  var canvas = this._canvas;\n\n  var newRoot = context.newRoot,\n      newRootBusinessObject = newRoot.businessObject,\n      oldRoot = context.oldRoot,\n      oldRootBusinessObject = oldRoot.businessObject,\n      bpmnDefinitions = newRootBusinessObject.$parent,\n      diPlane = getDi(newRoot);\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(oldRoot);\n  canvas.removeRootElement(newRoot);\n\n  // (2) update root elements\n  collectionRemove(bpmnDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = null;\n\n  collectionAdd(bpmnDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = bpmnDefinitions;\n\n  // (3) wire di\n  newRoot.di = null;\n\n  diPlane.bpmnElement = oldRootBusinessObject;\n  oldRoot.di = diPlane;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n\n  return [];\n};","import {\n  filter\n} from 'min-dash';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\nimport {\n  getLanesRoot,\n  getChildLanes,\n  LANE_INDENTATION\n} from '../util/LaneUtil';\n\nimport {\n  isHorizontal\n} from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../space-tool/BpmnSpaceTool').default} SpaceTool\n */\n\n/**\n * A handler that allows us to add a new lane\n * above or below an existing one.\n *\n * @implements {CommandHandler}\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\nexport default function AddLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nAddLaneHandler.$inject = [\n  'modeling',\n  'spaceTool'\n];\n\n\nAddLaneHandler.prototype.preExecute = function(context) {\n\n  var spaceTool = this._spaceTool,\n      modeling = this._modeling;\n\n  var shape = context.shape,\n      location = context.location;\n\n  var lanesRoot = getLanesRoot(shape);\n\n  var isRoot = lanesRoot === shape,\n      laneParent = isRoot ? shape : shape.parent;\n\n  var existingChildLanes = getChildLanes(laneParent);\n\n  var isHorizontalLane = isHorizontal(shape);\n\n  // never mix up horizontal/vertical lanes\n  if (isHorizontalLane) {\n    if (location === 'left') {\n      location = 'top';\n    } else\n    if (location === 'right') {\n      location = 'bottom';\n    }\n  } else {\n    if (location === 'top') {\n      location = 'left';\n    } else\n    if (location === 'bottom') {\n      location = 'right';\n    }\n  }\n\n  // (0) add a lane if we currently got none and are adding to root\n  if (!existingChildLanes.length) {\n    var siblingPosition = isHorizontalLane ? {\n      x: shape.x + LANE_INDENTATION,\n      y: shape.y,\n      width: shape.width - LANE_INDENTATION,\n      height: shape.height\n    } : {\n      x: shape.x,\n      y: shape.y + LANE_INDENTATION,\n      width: shape.width,\n      height: shape.height - LANE_INDENTATION\n    };\n\n    modeling.createShape(\n      {\n        type: 'bpmn:Lane',\n        isHorizontal: isHorizontalLane\n      },\n      siblingPosition,\n      laneParent\n    );\n  }\n\n  // (1) collect affected elements to create necessary space\n  var allAffected = [];\n\n  eachElement(lanesRoot, function(element) {\n    allAffected.push(element);\n\n    // handle element labels in the diagram root\n    if (element.label) {\n      allAffected.push(element.label);\n    }\n\n    if (element === shape) {\n      return [];\n    }\n\n    return filter(element.children, function(c) {\n      return c !== shape;\n    });\n  });\n\n  var offset,\n      lanePosition,\n      spacePos,\n      direction,\n      axis;\n\n  if (location === 'top') {\n    offset = -120;\n    lanePosition = shape.y;\n    spacePos = lanePosition + 10;\n    direction = 'n';\n    axis = 'y';\n  } else\n  if (location === 'left') {\n    offset = -120;\n    lanePosition = shape.x;\n    spacePos = lanePosition + 10;\n    direction = 'w';\n    axis = 'x';\n  } else\n  if (location === 'bottom') {\n    offset = 120;\n    lanePosition = shape.y + shape.height;\n    spacePos = lanePosition - 10;\n    direction = 's';\n    axis = 'y';\n  } else\n  if (location === 'right') {\n    offset = 120;\n    lanePosition = shape.x + shape.width;\n    spacePos = lanePosition - 10;\n    direction = 'e';\n    axis = 'x';\n  }\n\n  var adjustments = spaceTool.calculateAdjustments(allAffected, axis, offset, spacePos);\n\n  var delta = isHorizontalLane ? { x: 0, y: offset } : { x: offset, y: 0 };\n\n  spaceTool.makeSpace(\n    adjustments.movingShapes,\n    adjustments.resizingShapes,\n    delta,\n    direction,\n    spacePos\n  );\n\n  // (2) create new lane at open space\n  var newLanePosition = isHorizontalLane ? {\n    x: shape.x + (isRoot ? LANE_INDENTATION : 0),\n    y: lanePosition - (location === 'top' ? 120 : 0),\n    width: shape.width - (isRoot ? LANE_INDENTATION : 0),\n    height: 120\n  } : {\n    x: lanePosition - (location === 'left' ? 120 : 0),\n    y: shape.y + (isRoot ? LANE_INDENTATION : 0),\n    width: 120,\n    height: shape.height - (isRoot ? LANE_INDENTATION : 0)\n  };\n\n  context.newLane = modeling.createShape(\n    {\n      type: 'bpmn:Lane',\n      isHorizontal: isHorizontalLane\n    },\n    newLanePosition,\n    laneParent\n  );\n};\n","import {\n  getChildLanes,\n  LANE_INDENTATION\n} from '../util/LaneUtil';\n\nimport {\n  isHorizontal\n} from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * A handler that splits a lane into a number of sub-lanes,\n * creating new sub lanes, if necessary.\n *\n * @implements {CommandHandler}\n *\n * @param {Modeling} modeling\n */\nexport default function SplitLaneHandler(modeling) {\n  this._modeling = modeling;\n}\n\nSplitLaneHandler.$inject = [\n  'modeling'\n];\n\n\nSplitLaneHandler.prototype.preExecute = function(context) {\n\n  var modeling = this._modeling;\n\n  var shape = context.shape,\n      newLanesCount = context.count;\n\n  var childLanes = getChildLanes(shape),\n      existingLanesCount = childLanes.length;\n\n  if (existingLanesCount > newLanesCount) {\n    throw new Error(`more than <${ newLanesCount }> child lanes`);\n  }\n\n  var isHorizontalLane = isHorizontal(shape);\n\n  var laneBaseSize = isHorizontalLane ? shape.height : shape.width;\n  var newLanesSize = Math.round(laneBaseSize / newLanesCount);\n\n  // Iterate from first to last in child lane order,\n  // resizing existing lanes and creating new ones\n  // so that they split the parent proportionally.\n  //\n  // Due to rounding related errors, the last lane\n  // needs to take up all the remaining space.\n  var laneSize,\n      laneBounds,\n      newLaneAttrs,\n      idx;\n\n  for (idx = 0; idx < newLanesCount; idx++) {\n\n    // if last lane\n    if (idx === newLanesCount - 1) {\n      laneSize = laneBaseSize - (newLanesSize * idx);\n    } else {\n      laneSize = newLanesSize;\n    }\n\n    laneBounds = isHorizontalLane ? {\n      x: shape.x + LANE_INDENTATION,\n      y: shape.y + idx * newLanesSize,\n      width: shape.width - LANE_INDENTATION,\n      height: laneSize\n    } : {\n      x: shape.x + idx * newLanesSize,\n      y: shape.y + LANE_INDENTATION,\n      width: laneSize,\n      height: shape.height - LANE_INDENTATION\n    };\n\n    if (idx < existingLanesCount) {\n\n      // resize existing lane\n      modeling.resizeShape(childLanes[idx], laneBounds);\n    } else {\n\n      // create a new lane at position\n      newLaneAttrs = {\n        type: 'bpmn:Lane',\n        isHorizontal: isHorizontalLane\n      };\n\n      modeling.createShape(newLaneAttrs, laneBounds, shape);\n    }\n  }\n};\n","import { is } from '../../../util/ModelUtil';\n\nimport {\n  getLanesRoot,\n  computeLanesResize\n} from '../util/LaneUtil';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substractTRBL\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../space-tool/BpmnSpaceTool').default} SpaceTool\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\n/**\n * A handler that resizes a lane.\n *\n * @implements {CommandHandler}\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\nexport default function ResizeLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nResizeLaneHandler.$inject = [\n  'modeling',\n  'spaceTool'\n];\n\n\nResizeLaneHandler.prototype.preExecute = function(context) {\n\n  var shape = context.shape,\n      newBounds = context.newBounds,\n      balanced = context.balanced;\n\n  if (balanced !== false) {\n    this.resizeBalanced(shape, newBounds);\n  } else {\n    this.resizeSpace(shape, newBounds);\n  }\n};\n\n\n/**\n * Resize balanced, adjusting next / previous lane sizes.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n */\nResizeLaneHandler.prototype.resizeBalanced = function(shape, newBounds) {\n\n  var modeling = this._modeling;\n\n  var resizeNeeded = computeLanesResize(shape, newBounds);\n\n  // resize the lane\n  modeling.resizeShape(shape, newBounds);\n\n  // resize other lanes as needed\n  resizeNeeded.forEach(function(r) {\n    modeling.resizeShape(r.shape, r.newBounds);\n  });\n};\n\n\n/**\n * Resize, making actual space and moving below / above elements.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n */\nResizeLaneHandler.prototype.resizeSpace = function(shape, newBounds) {\n  var spaceTool = this._spaceTool;\n\n  var shapeTrbl = asTRBL(shape),\n      newTrbl = asTRBL(newBounds);\n\n  var trblDiff = substractTRBL(newTrbl, shapeTrbl);\n\n  var lanesRoot = getLanesRoot(shape);\n\n  var allAffected = [],\n      allLanes = [];\n\n  eachElement(lanesRoot, function(element) {\n    allAffected.push(element);\n\n    if (is(element, 'bpmn:Lane') || is(element, 'bpmn:Participant')) {\n      allLanes.push(element);\n    }\n\n    return element.children;\n  });\n\n  var change,\n      spacePos,\n      direction,\n      offset,\n      adjustments;\n\n  if (trblDiff.bottom || trblDiff.top) {\n\n    change = trblDiff.bottom || trblDiff.top;\n    spacePos = shape.y + (trblDiff.bottom ? shape.height : 0) + (trblDiff.bottom ? -10 : 10);\n    direction = trblDiff.bottom ? 's' : 'n';\n\n    offset = trblDiff.top > 0 || trblDiff.bottom < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(allAffected, 'y', offset, spacePos);\n\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, { x: 0, y: change }, direction);\n  }\n\n\n  if (trblDiff.left || trblDiff.right) {\n\n    change = trblDiff.right || trblDiff.left;\n    spacePos = shape.x + (trblDiff.right ? shape.width : 0) + (trblDiff.right ? -10 : 100);\n    direction = trblDiff.right ? 'e' : 'w';\n\n    offset = trblDiff.left > 0 || trblDiff.right < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(allLanes, 'x', offset, spacePos);\n\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, { x: change, y: 0 }, direction);\n  }\n};","import {\n  collectLanes,\n  getLanesRoot\n} from '../util/LaneUtil';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n */\n\nvar FLOW_NODE_REFS_ATTR = 'flowNodeRef',\n    LANES_ATTR = 'lanes';\n\n\n/**\n * A handler that updates lane refs on changed elements.\n *\n * @implements {CommandHandler}\n *\n * @param {ElementRegistry} elementRegistry\n */\nexport default function UpdateFlowNodeRefsHandler(elementRegistry) {\n  this._elementRegistry = elementRegistry;\n}\n\nUpdateFlowNodeRefsHandler.$inject = [\n  'elementRegistry'\n];\n\n/**\n * @param {Shape} flowNodeShapes\n * @param {Shape} laneShapes\n *\n * @return { {\n *   flowNode: Shape;\n *   add: Shape[];\n *   remove: Shape[];\n * }[] }\n */\nUpdateFlowNodeRefsHandler.prototype._computeUpdates = function(flowNodeShapes, laneShapes) {\n\n  var handledNodes = [];\n\n  var updates = [];\n\n  var participantCache = {};\n\n  var allFlowNodeShapes = [];\n\n  function isInLaneShape(element, laneShape) {\n\n    var laneTrbl = asTRBL(laneShape);\n\n    var elementMid = {\n      x: element.x + element.width / 2,\n      y: element.y + element.height / 2\n    };\n\n    return elementMid.x > laneTrbl.left &&\n           elementMid.x < laneTrbl.right &&\n           elementMid.y > laneTrbl.top &&\n           elementMid.y < laneTrbl.bottom;\n  }\n\n  function addFlowNodeShape(flowNodeShape) {\n    if (handledNodes.indexOf(flowNodeShape) === -1) {\n      allFlowNodeShapes.push(flowNodeShape);\n      handledNodes.push(flowNodeShape);\n    }\n  }\n\n  function getAllLaneShapes(flowNodeShape) {\n\n    var root = getLanesRoot(flowNodeShape);\n\n    if (!participantCache[root.id]) {\n      participantCache[root.id] = collectLanes(root);\n    }\n\n    return participantCache[root.id];\n  }\n\n  function getNewLanes(flowNodeShape) {\n    if (!flowNodeShape.parent) {\n      return [];\n    }\n\n    var allLaneShapes = getAllLaneShapes(flowNodeShape);\n\n    return allLaneShapes.filter(function(l) {\n      return isInLaneShape(flowNodeShape, l);\n    }).map(function(shape) {\n      return shape.businessObject;\n    });\n  }\n\n  laneShapes.forEach(function(laneShape) {\n    var root = getLanesRoot(laneShape);\n\n    if (!root || handledNodes.indexOf(root) !== -1) {\n      return;\n    }\n\n    var children = root.children.filter(function(c) {\n      return is(c, 'bpmn:FlowNode');\n    });\n\n    children.forEach(addFlowNodeShape);\n\n    handledNodes.push(root);\n  });\n\n  flowNodeShapes.forEach(addFlowNodeShape);\n\n\n  allFlowNodeShapes.forEach(function(flowNodeShape) {\n\n    var flowNode = flowNodeShape.businessObject;\n\n    var lanes = flowNode.get(LANES_ATTR),\n        remove = lanes.slice(),\n        add = getNewLanes(flowNodeShape);\n\n    updates.push({ flowNode: flowNode, remove: remove, add: add });\n  });\n\n  laneShapes.forEach(function(laneShape) {\n\n    var lane = laneShape.businessObject;\n\n    // lane got removed XX-)\n    if (!laneShape.parent) {\n      lane.get(FLOW_NODE_REFS_ATTR).forEach(function(flowNode) {\n        updates.push({ flowNode: flowNode, remove: [ lane ], add: [] });\n      });\n    }\n  });\n\n  return updates;\n};\n\nUpdateFlowNodeRefsHandler.prototype.execute = function(context) {\n\n  var updates = context.updates;\n\n  if (!updates) {\n    updates = context.updates = this._computeUpdates(context.flowNodeShapes, context.laneShapes);\n  }\n\n\n  updates.forEach(function(update) {\n\n    var flowNode = update.flowNode,\n        lanes = flowNode.get(LANES_ATTR);\n\n    // unwire old\n    update.remove.forEach(function(oldLane) {\n      collectionRemove(lanes, oldLane);\n      collectionRemove(oldLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n\n    // wire new\n    update.add.forEach(function(newLane) {\n      collectionAdd(lanes, newLane);\n      collectionAdd(newLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n  });\n\n  // TODO(nikku): return changed elements\n  // return [ ... ];\n\n  return [];\n};\n\n\nUpdateFlowNodeRefsHandler.prototype.revert = function(context) {\n\n  var updates = context.updates;\n\n  updates.forEach(function(update) {\n\n    var flowNode = update.flowNode,\n        lanes = flowNode.get(LANES_ATTR);\n\n    // unwire new\n    update.add.forEach(function(newLane) {\n      collectionRemove(lanes, newLane);\n      collectionRemove(newLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n\n    // wire old\n    update.remove.forEach(function(oldLane) {\n      collectionAdd(lanes, oldLane);\n      collectionAdd(oldLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n  });\n\n  // TODO(nikku): return changed elements\n  // return [ ... ];\n\n  return [];\n};\n","/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../../../model/Types').Moddle} Moddle\n */\n\n/**\n * @implements {CommandHandler}\n *\n * @param {Moddle} moddle\n */\nexport default function IdClaimHandler(moddle) {\n  this._moddle = moddle;\n}\n\nIdClaimHandler.$inject = [ 'moddle' ];\n\n\nIdClaimHandler.prototype.execute = function(context) {\n  var ids = this._moddle.ids,\n      id = context.id,\n      element = context.element,\n      claiming = context.claiming;\n\n  if (claiming) {\n    ids.claim(id, element);\n  } else {\n    ids.unclaim(id);\n  }\n\n  return [];\n};\n\n/**\n * Command revert implementation.\n */\nIdClaimHandler.prototype.revert = function(context) {\n  var ids = this._moddle.ids,\n      id = context.id,\n      element = context.element,\n      claiming = context.claiming;\n\n  if (claiming) {\n    ids.unclaim(id);\n  } else {\n    ids.claim(id, element);\n  }\n\n  return [];\n};\n\n","import {\r\n  assign,\r\n  forEach,\r\n  isString,\r\n  pick\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getDi,\r\n  isAny\r\n} from '../../../util/ModelUtil';\r\n\r\nimport {\r\n  isLabel\r\n} from '../../../util/LabelUtil';\r\n\r\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\r\n *\r\n * @typedef {import('diagram-js/lib/command/CommandStack').default} CommandStack\r\n *\r\n * @typedef {import('../../../model/Types').ModdleElement} ModdleElement\r\n */\r\n\r\nvar DEFAULT_COLORS = {\r\n  fill: undefined,\r\n  stroke: undefined\r\n};\r\n\r\n/**\r\n * @implements {CommandHandler}\r\n *\r\n * @param {CommandStack} commandStack\r\n */\r\nexport default function SetColorHandler(commandStack) {\r\n  this._commandStack = commandStack;\r\n\r\n  this._normalizeColor = function(color) {\r\n\r\n    // Remove color for falsy values.\r\n    if (!color) {\r\n      return undefined;\r\n    }\r\n\r\n    if (isString(color)) {\r\n      var hexColor = colorToHex(color);\r\n\r\n      if (hexColor) {\r\n        return hexColor;\r\n      }\r\n    }\r\n\r\n    throw new Error(`invalid color value: ${ color }`);\r\n  };\r\n}\r\n\r\nSetColorHandler.$inject = [\r\n  'commandStack'\r\n];\r\n\r\n\r\nSetColorHandler.prototype.postExecute = function(context) {\r\n  var elements = context.elements,\r\n      colors = context.colors || DEFAULT_COLORS;\r\n\r\n  var self = this;\r\n\r\n  var di = {};\r\n\r\n  if ('fill' in colors) {\r\n    assign(di, {\r\n      'background-color': this._normalizeColor(colors.fill) });\r\n  }\r\n\r\n  if ('stroke' in colors) {\r\n    assign(di, {\r\n      'border-color': this._normalizeColor(colors.stroke) });\r\n  }\r\n\r\n  forEach(elements, function(element) {\r\n    var assignedDi = isConnection(element) ? pick(di, [ 'border-color' ]) : di,\r\n        elementDi = getDi(element);\r\n\r\n    // TODO @barmac: remove once we drop bpmn.io properties\r\n    ensureLegacySupport(assignedDi);\r\n\r\n    if (isLabel(element)) {\r\n\r\n      // set label colors as bpmndi:BPMNLabel#color\r\n      self._commandStack.execute('element.updateModdleProperties', {\r\n        element: element,\r\n        moddleElement: elementDi.label,\r\n        properties: {\r\n          color: di['border-color']\r\n        }\r\n      });\r\n    } else {\r\n\r\n      // ignore non-compliant di\r\n      if (!isAny(elementDi, [ 'bpmndi:BPMNEdge', 'bpmndi:BPMNShape' ])) {\r\n        return;\r\n      }\r\n\r\n      // set colors bpmndi:BPMNEdge or bpmndi:BPMNShape\r\n      self._commandStack.execute('element.updateProperties', {\r\n        element: element,\r\n        properties: {\r\n          di: assignedDi\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n};\r\n\r\n/**\r\n * Convert color from rgb(a)/hsl to hex. Returns `null` for unknown color names\r\n * and for colors with alpha less than 1.0. This depends on `<canvas>`\r\n * serialization of the `context.fillStyle`.\r\n * Cf. https://html.spec.whatwg.org/multipage/canvas.html#dom-context-2d-fillstyle\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * colorToHex('fuchsia'); // \"#ff00ff\"\r\n *\r\n * colorToHex('rgba(1, 2, 3, 0.4)'); // null\r\n * ```\r\n *\r\n * @param {string} color\r\n *\r\n * @return {string|null}\r\n */\r\nfunction colorToHex(color) {\r\n  var context = document.createElement('canvas').getContext('2d');\r\n\r\n  // (0) Start with transparent to account for browser default values.\r\n  context.fillStyle = 'transparent';\r\n\r\n  // (1) Assign color so that it's serialized.\r\n  context.fillStyle = color;\r\n\r\n  // (2) Return null for non-hex serialization result.\r\n  return /^#[0-9a-fA-F]{6}$/.test(context.fillStyle) ? context.fillStyle : null;\r\n}\r\n\r\n/**\r\n * Add legacy properties if required.\r\n *\r\n * @param {ModdleElement} di\r\n */\r\nfunction ensureLegacySupport(di) {\r\n  if ('border-color' in di) {\r\n    di.stroke = di['border-color'];\r\n  }\r\n\r\n  if ('background-color' in di) {\r\n    di.fill = di['background-color'];\r\n  }\r\n}\r\n","import {\n  setLabel,\n  getLabel\n} from '../../../util/LabelUtil';\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel\n} from '../../../util/LabelUtil';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\nvar NULL_DIMENSIONS = {\n  width: 0,\n  height: 0\n};\n\n/**\n * @typedef {import('../../modeling/Modeling').default} Modeling\n * @typedef {import('../../../draw/TextRenderer').default} TextRenderer\n * @typedef {import('../../modeling/BpmnFactory').default} BpmnFactory\n *\n * @typedef {import('../../../model/Types').Element} Element\n */\n\n/**\n * A handler that updates the text of a BPMN element.\n *\n * @param {Modeling} modeling\n * @param {TextRenderer} textRenderer\n * @param {BpmnFactory} bpmnFactory\n */\nexport default function UpdateLabelHandler(modeling, textRenderer, bpmnFactory) {\n\n  /**\n   * Set the label and return the changed elements.\n   *\n   * Element parameter can be label itself or connection (i.e. sequence flow).\n   *\n   * @param {Element} element\n   * @param {string} text\n   */\n  function setText(element, text) {\n\n    // external label if present\n    var label = element.label || element;\n\n    var labelTarget = element.labelTarget || element;\n\n    setLabel(label, text, labelTarget !== label);\n\n    return [ label, labelTarget ];\n  }\n\n  function preExecute(ctx) {\n    var element = ctx.element,\n        businessObject = element.businessObject,\n        newLabel = ctx.newLabel;\n\n    if (!isLabel(element)\n        && isLabelExternal(element)\n        && !hasExternalLabel(element)\n        && !isEmptyText(newLabel)) {\n\n      // create label\n      var paddingTop = 7;\n\n      var labelCenter = getExternalLabelMid(element);\n\n      labelCenter = {\n        x: labelCenter.x,\n        y: labelCenter.y + paddingTop\n      };\n\n      modeling.createLabel(element, labelCenter, {\n        id: businessObject.id + '_label',\n        businessObject: businessObject,\n        di: element.di\n      });\n    }\n  }\n\n  function execute(ctx) {\n    ctx.oldLabel = getLabel(ctx.element);\n    return setText(ctx.element, ctx.newLabel);\n  }\n\n  function revert(ctx) {\n    return setText(ctx.element, ctx.oldLabel);\n  }\n\n  function postExecute(ctx) {\n    var element = ctx.element,\n        label = element.label || element,\n        newLabel = ctx.newLabel,\n        newBounds = ctx.newBounds,\n        hints = ctx.hints || {};\n\n    // ignore internal labels for elements except text annotations\n    if (!isLabel(label) && !is(label, 'bpmn:TextAnnotation')) {\n      return;\n    }\n\n    if (isLabel(label) && isEmptyText(newLabel)) {\n\n      if (hints.removeShape !== false) {\n        modeling.removeShape(label, { unsetLabel: false });\n      }\n\n      return;\n    }\n\n    var text = getLabel(element);\n\n    // resize element based on label _or_ pre-defined bounds\n    if (typeof newBounds === 'undefined') {\n      newBounds = textRenderer.getExternalLabelBounds(label, text);\n    }\n\n    // setting newBounds to false or _null_ will\n    // disable the postExecute resize operation\n    if (newBounds) {\n      modeling.resizeShape(label, newBounds, NULL_DIMENSIONS);\n    }\n  }\n\n  // API\n\n  this.preExecute = preExecute;\n  this.execute = execute;\n  this.revert = revert;\n  this.postExecute = postExecute;\n}\n\nUpdateLabelHandler.$inject = [\n  'modeling',\n  'textRenderer',\n  'bpmnFactory'\n];\n\n\n// helpers //////////\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}","import inherits from 'inherits-browser';\n\nimport BaseModeling from 'diagram-js/lib/features/modeling/Modeling';\n\nimport UpdateModdlePropertiesHandler from './cmd/UpdateModdlePropertiesHandler';\nimport UpdatePropertiesHandler from './cmd/UpdatePropertiesHandler';\nimport UpdateCanvasRootHandler from './cmd/UpdateCanvasRootHandler';\nimport AddLaneHandler from './cmd/AddLaneHandler';\nimport SplitLaneHandler from './cmd/SplitLaneHandler';\nimport ResizeLaneHandler from './cmd/ResizeLaneHandler';\nimport UpdateFlowNodeRefsHandler from './cmd/UpdateFlowNodeRefsHandler';\nimport IdClaimHandler from './cmd/IdClaimHandler';\nimport SetColorHandler from './cmd/SetColorHandler';\n\nimport UpdateLabelHandler from '../label-editing/cmd/UpdateLabelHandler';\n\n/**\n * @typedef {import('../rules/BpmnRules').default} BpmnRules\n * @typedef {import('diagram-js/lib/command/CommandStack').default} CommandStack\n * @typedef {import('./ElementFactory').default} ElementFactory\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('diagram-js/lib/features/modeling/Modeling').ModelingHints} ModelingHints\n *\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Label} Label\n * @typedef {import('../../model/Types').Parent} Parent\n * @typedef {import('../../model/Types').Root} Root\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n *\n * @typedef {import('../../util/Types').Colors} Colors\n *\n * @typedef { {\n *   removeShape?: boolean;\n * } } UpdateLabelHints\n */\n\n/**\n * The BPMN 2.0 modeling entry point.\n *\n * @template {Connection} [T=Connection]\n * @template {Element} [U=Element]\n * @template {Label} [V=Label]\n * @template {Parent} [W=Parent]\n * @template {Shape} [X=Shape]\n *\n * @extends {BaseModeling<T, U, V, W, X>}\n *\n * @param {EventBus} eventBus\n * @param {ElementFactory} elementFactory\n * @param {CommandStack} commandStack\n * @param {BpmnRules} bpmnRules\n */\nexport default function Modeling(\n    eventBus,\n    elementFactory,\n    commandStack,\n    bpmnRules\n) {\n\n  BaseModeling.call(this, eventBus, elementFactory, commandStack);\n\n  this._bpmnRules = bpmnRules;\n}\n\ninherits(Modeling, BaseModeling);\n\nModeling.$inject = [\n  'eventBus',\n  'elementFactory',\n  'commandStack',\n  'bpmnRules'\n];\n\n\nModeling.prototype.getHandlers = function() {\n  var handlers = BaseModeling.prototype.getHandlers.call(this);\n\n  handlers['element.updateModdleProperties'] = UpdateModdlePropertiesHandler;\n  handlers['element.updateProperties'] = UpdatePropertiesHandler;\n  handlers['canvas.updateRoot'] = UpdateCanvasRootHandler;\n  handlers['lane.add'] = AddLaneHandler;\n  handlers['lane.resize'] = ResizeLaneHandler;\n  handlers['lane.split'] = SplitLaneHandler;\n  handlers['lane.updateRefs'] = UpdateFlowNodeRefsHandler;\n  handlers['id.updateClaim'] = IdClaimHandler;\n  handlers['element.setColor'] = SetColorHandler;\n  handlers['element.updateLabel'] = UpdateLabelHandler;\n\n  return handlers;\n};\n\n/**\n * Update an element's label.\n *\n * @param {Element} element The element.\n * @param {string} newLabel The new label.\n * @param {Rect} [newBounds] The optional bounds of the label.\n * @param {UpdateLabelHints} [hints] The optional hints.\n */\nModeling.prototype.updateLabel = function(element, newLabel, newBounds, hints) {\n  this._commandStack.execute('element.updateLabel', {\n    element: element,\n    newLabel: newLabel,\n    newBounds: newBounds,\n    hints: hints || {}\n  });\n};\n\n/**\n * @param {Element} source\n * @param {Element} target\n * @param {Partial<Connection>} attrs\n * @param {ModelingHints} [hints]\n *\n * @return {T}\n */\nModeling.prototype.connect = function(source, target, attrs, hints) {\n\n  var bpmnRules = this._bpmnRules;\n\n  if (!attrs) {\n    attrs = bpmnRules.canConnect(source, target);\n  }\n\n  if (!attrs) {\n    return;\n  }\n\n  return this.createConnection(source, target, attrs, source.parent, hints);\n};\n\n/**\n * Update a model element's properties.\n *\n * @param {Element} element The element.\n * @param {ModdleElement} moddleElement The model element.\n * @param {Object} properties The updated properties.\n */\nModeling.prototype.updateModdleProperties = function(element, moddleElement, properties) {\n  this._commandStack.execute('element.updateModdleProperties', {\n    element: element,\n    moddleElement: moddleElement,\n    properties: properties\n  });\n};\n\n/**\n * Update an element's properties.\n *\n * @param {Element} element The element.\n * @param {Object} properties The updated properties.\n */\nModeling.prototype.updateProperties = function(element, properties) {\n  this._commandStack.execute('element.updateProperties', {\n    element: element,\n    properties: properties\n  });\n};\n\n/**\n * Resize a lane.\n *\n * @param {Shape} laneShape The lane.\n * @param {Rect} newBounds The new bounds of the lane.\n * @param {boolean} [balanced] Wether to resize neighboring lanes.\n */\nModeling.prototype.resizeLane = function(laneShape, newBounds, balanced) {\n  this._commandStack.execute('lane.resize', {\n    shape: laneShape,\n    newBounds: newBounds,\n    balanced: balanced\n  });\n};\n\n/**\n * Add a lane.\n *\n * @param {Shape} targetLaneShape The shape to add the lane to.\n * @param {string} location The location.\n *\n * @return {Shape} The added lane.\n */\nModeling.prototype.addLane = function(targetLaneShape, location) {\n  var context = {\n    shape: targetLaneShape,\n    location: location\n  };\n\n  this._commandStack.execute('lane.add', context);\n\n  return context.newLane;\n};\n\n/**\n * Split a lane.\n *\n * @param {Shape} targetLane The lane to split.\n * @param {number} count The number of lanes to split the lane into. Must not\n * exceed the number of existing lanes.\n */\nModeling.prototype.splitLane = function(targetLane, count) {\n  this._commandStack.execute('lane.split', {\n    shape: targetLane,\n    count: count\n  });\n};\n\n/**\n * Turn a process into a collaboration.\n *\n * @return {Root} The root of the collaboration.\n */\nModeling.prototype.makeCollaboration = function() {\n\n  var collaborationElement = this._create('root', {\n    type: 'bpmn:Collaboration'\n  });\n\n  var context = {\n    newRoot: collaborationElement\n  };\n\n  this._commandStack.execute('canvas.updateRoot', context);\n\n  return collaborationElement;\n};\n\n/**\n * Transform a collaboration into a process.\n *\n * @return {Root} The root of the process.\n */\nModeling.prototype.makeProcess = function() {\n\n  var processElement = this._create('root', {\n    type: 'bpmn:Process'\n  });\n\n  var context = {\n    newRoot: processElement\n  };\n\n  this._commandStack.execute('canvas.updateRoot', context);\n};\n\n/**\n * Update the referenced lanes of each flow node.\n *\n * @param {Shape[]} flowNodeShapes The flow nodes to update.\n * @param {Shape[]} laneShapes The lanes.\n */\nModeling.prototype.updateLaneRefs = function(flowNodeShapes, laneShapes) {\n\n  this._commandStack.execute('lane.updateRefs', {\n    flowNodeShapes: flowNodeShapes,\n    laneShapes: laneShapes\n  });\n};\n\n/**\n * Claim an ID.\n *\n * @param {string} id The ID to claim.\n * @param {ModdleElement} moddleElement The model element the ID is claimed for.\n */\nModeling.prototype.claimId = function(id, moddleElement) {\n  this._commandStack.execute('id.updateClaim', {\n    id: id,\n    element: moddleElement,\n    claiming: true\n  });\n};\n\n/**\n * Unclaim an ID.\n *\n * @param {string} id The ID to unclaim.\n * @param {ModdleElement} moddleElement The model element the ID is claimed for.\n */\nModeling.prototype.unclaimId = function(id, moddleElement) {\n  this._commandStack.execute('id.updateClaim', {\n    id: id,\n    element: moddleElement\n  });\n};\n\n/**\n * Set the color(s) of one or many elements.\n *\n * @param {Element[]} elements The elements to set the color(s) for.\n * @param {Colors} colors The color(s) to set.\n */\nModeling.prototype.setColor = function(elements, colors) {\n  if (!elements.length) {\n    elements = [ elements ];\n  }\n\n  this._commandStack.execute('element.setColor', {\n    elements: elements,\n    colors: colors\n  });\n};\n","/**\r\n * @typedef {import('../core/Types').ElementLike} Element\r\n * @typedef {import('../core/Types').ConnectionLike} Connection\r\n *\r\n * @typedef {import('../util').Point} Point\r\n *\r\n * @typedef { {\r\n *   connectionStart?: Point;\r\n *   connectionEnd?: Point;\r\n *   source?: Element;\r\n *   target?: Element;\r\n * } } LayoutConnectionHints\r\n */\r\n\r\nimport {\r\n  getMid\r\n} from './LayoutUtil';\r\n\r\n\r\n/**\r\n * A base connection layouter implementation\r\n * that layouts the connection by directly connecting\r\n * mid(source) + mid(target).\r\n */\r\nexport default function BaseLayouter() {}\r\n\r\n\r\n/**\r\n * Return the new layouted waypoints for the given connection.\r\n *\r\n * The connection passed is still unchanged; you may figure out about\r\n * the new connection start / end via the layout hints provided.\r\n *\r\n * @param {Connection} connection\r\n * @param {LayoutConnectionHints} [hints]\r\n *\r\n * @return {Point[]} The waypoints of the laid out connection.\r\n */\r\nBaseLayouter.prototype.layoutConnection = function(connection, hints) {\r\n\r\n  hints = hints || {};\r\n\r\n  return [\r\n    hints.connectionStart || getMid(hints.source || connection.source),\r\n    hints.connectionEnd || getMid(hints.target || connection.target)\r\n  ];\r\n};\r\n","import {\r\n  assign,\r\n  find,\r\n  isArray,\r\n  without\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getOrientation,\r\n  getMid\r\n} from './LayoutUtil';\r\n\r\nimport {\r\n  pointInRect,\r\n  pointDistance,\r\n  pointsAligned,\r\n  pointsOnLine\r\n} from '../util/Geometry';\r\n\r\n/**\r\n * @typedef {import('../util/Types').Point} Point\r\n * @typedef {import('../util/Types').Rect} Rect\r\n */\r\n\r\nvar MIN_SEGMENT_LENGTH = 20,\r\n    POINT_ORIENTATION_PADDING = 5;\r\n\r\nvar round = Math.round;\r\n\r\nvar INTERSECTION_THRESHOLD = 20,\r\n    ORIENTATION_THRESHOLD = {\r\n      'h:h': 20,\r\n      'v:v': 20,\r\n      'h:v': -10,\r\n      'v:h': -10\r\n    };\r\n\r\nfunction needsTurn(orientation, startDirection) {\r\n  return !{\r\n    t: /top/,\r\n    r: /right/,\r\n    b: /bottom/,\r\n    l: /left/,\r\n    h: /./,\r\n    v: /./\r\n  }[startDirection].test(orientation);\r\n}\r\n\r\nfunction canLayoutStraight(direction, targetOrientation) {\r\n  return {\r\n    t: /top/,\r\n    r: /right/,\r\n    b: /bottom/,\r\n    l: /left/,\r\n    h: /left|right/,\r\n    v: /top|bottom/\r\n  }[direction].test(targetOrientation);\r\n}\r\n\r\nfunction getSegmentBendpoints(a, b, directions) {\r\n  var orientation = getOrientation(b, a, POINT_ORIENTATION_PADDING);\r\n\r\n  var startDirection = directions.split(':')[0];\r\n\r\n  var xmid = round((b.x - a.x) / 2 + a.x),\r\n      ymid = round((b.y - a.y) / 2 + a.y);\r\n\r\n  var segmentEnd, segmentDirections;\r\n\r\n  var layoutStraight = canLayoutStraight(startDirection, orientation),\r\n      layoutHorizontal = /h|r|l/.test(startDirection),\r\n      layoutTurn = false;\r\n\r\n  var turnNextDirections = false;\r\n\r\n  if (layoutStraight) {\r\n    segmentEnd = layoutHorizontal ? { x: xmid, y: a.y } : { x: a.x, y: ymid };\r\n\r\n    segmentDirections = layoutHorizontal ? 'h:h' : 'v:v';\r\n  } else {\r\n    layoutTurn = needsTurn(orientation, startDirection);\r\n\r\n    segmentDirections = layoutHorizontal ? 'h:v' : 'v:h';\r\n\r\n    if (layoutTurn) {\r\n\r\n      if (layoutHorizontal) {\r\n        turnNextDirections = ymid === a.y;\r\n\r\n        segmentEnd = {\r\n          x: a.x + MIN_SEGMENT_LENGTH * (/l/.test(startDirection) ? -1 : 1),\r\n          y: turnNextDirections ? ymid + MIN_SEGMENT_LENGTH : ymid\r\n        };\r\n      } else {\r\n        turnNextDirections = xmid === a.x;\r\n\r\n        segmentEnd = {\r\n          x: turnNextDirections ? xmid + MIN_SEGMENT_LENGTH : xmid,\r\n          y: a.y + MIN_SEGMENT_LENGTH * (/t/.test(startDirection) ? -1 : 1)\r\n        };\r\n      }\r\n\r\n    } else {\r\n      segmentEnd = {\r\n        x: xmid,\r\n        y: ymid\r\n      };\r\n    }\r\n  }\r\n\r\n  return {\r\n    waypoints: getBendpoints(a, segmentEnd, segmentDirections).concat(segmentEnd),\r\n    directions:  segmentDirections,\r\n    turnNextDirections: turnNextDirections\r\n  };\r\n}\r\n\r\nfunction getStartSegment(a, b, directions) {\r\n  return getSegmentBendpoints(a, b, directions);\r\n}\r\n\r\nfunction getEndSegment(a, b, directions) {\r\n  var invertedSegment = getSegmentBendpoints(b, a, invertDirections(directions));\r\n\r\n  return {\r\n    waypoints: invertedSegment.waypoints.slice().reverse(),\r\n    directions: invertDirections(invertedSegment.directions),\r\n    turnNextDirections: invertedSegment.turnNextDirections\r\n  };\r\n}\r\n\r\nfunction getMidSegment(startSegment, endSegment) {\r\n\r\n  var startDirection = startSegment.directions.split(':')[1],\r\n      endDirection = endSegment.directions.split(':')[0];\r\n\r\n  if (startSegment.turnNextDirections) {\r\n    startDirection = startDirection == 'h' ? 'v' : 'h';\r\n  }\r\n\r\n  if (endSegment.turnNextDirections) {\r\n    endDirection = endDirection == 'h' ? 'v' : 'h';\r\n  }\r\n\r\n  var directions = startDirection + ':' + endDirection;\r\n\r\n  var bendpoints = getBendpoints(\r\n    startSegment.waypoints[startSegment.waypoints.length - 1],\r\n    endSegment.waypoints[0],\r\n    directions\r\n  );\r\n\r\n  return {\r\n    waypoints: bendpoints,\r\n    directions: directions\r\n  };\r\n}\r\n\r\nfunction invertDirections(directions) {\r\n  return directions.split(':').reverse().join(':');\r\n}\r\n\r\n/**\r\n * Handle simple layouts with maximum two bendpoints.\r\n */\r\nfunction getSimpleBendpoints(a, b, directions) {\r\n\r\n  var xmid = round((b.x - a.x) / 2 + a.x),\r\n      ymid = round((b.y - a.y) / 2 + a.y);\r\n\r\n  // one point, right or left from a\r\n  if (directions === 'h:v') {\r\n    return [ { x: b.x, y: a.y } ];\r\n  }\r\n\r\n  // one point, above or below a\r\n  if (directions === 'v:h') {\r\n    return [ { x: a.x, y: b.y } ];\r\n  }\r\n\r\n  // vertical segment between a and b\r\n  if (directions === 'h:h') {\r\n    return [\r\n      { x: xmid, y: a.y },\r\n      { x: xmid, y: b.y }\r\n    ];\r\n  }\r\n\r\n  // horizontal segment between a and b\r\n  if (directions === 'v:v') {\r\n    return [\r\n      { x: a.x, y: ymid },\r\n      { x: b.x, y: ymid }\r\n    ];\r\n  }\r\n\r\n  throw new Error('invalid directions: can only handle varians of [hv]:[hv]');\r\n}\r\n\r\n\r\n/**\r\n * Returns the mid points for a manhattan connection between two points.\r\n *\r\n * @example h:h (horizontal:horizontal)\r\n *\r\n * [a]----[x]\r\n *         |\r\n *        [x]----[b]\r\n *\r\n * @example h:v (horizontal:vertical)\r\n *\r\n * [a]----[x]\r\n *         |\r\n *        [b]\r\n *\r\n * @example h:r (horizontal:right)\r\n *\r\n * [a]----[x]\r\n *         |\r\n *    [b]-[x]\r\n *\r\n * @param {Point} a\r\n * @param {Point} b\r\n * @param {string} directions\r\n *\r\n * @return {Point[]}\r\n */\r\nfunction getBendpoints(a, b, directions) {\r\n  directions = directions || 'h:h';\r\n\r\n  if (!isValidDirections(directions)) {\r\n    throw new Error(\r\n      'unknown directions: <' + directions + '>: ' +\r\n      'must be specified as <start>:<end> ' +\r\n      'with start/end in { h,v,t,r,b,l }'\r\n    );\r\n  }\r\n\r\n  // compute explicit directions, involving trbl dockings\r\n  // using a three segmented layouting algorithm\r\n  if (isExplicitDirections(directions)) {\r\n    var startSegment = getStartSegment(a, b, directions),\r\n        endSegment = getEndSegment(a, b, directions),\r\n        midSegment = getMidSegment(startSegment, endSegment);\r\n\r\n    return [].concat(\r\n      startSegment.waypoints,\r\n      midSegment.waypoints,\r\n      endSegment.waypoints\r\n    );\r\n  }\r\n\r\n  // handle simple [hv]:[hv] cases that can be easily computed\r\n  return getSimpleBendpoints(a, b, directions);\r\n}\r\n\r\n/**\r\n * Create a connection between the two points according\r\n * to the manhattan layout (only horizontal and vertical) edges.\r\n *\r\n * @param {Point} a\r\n * @param {Point} b\r\n * @param {string} [directions='h:h'] Specifies manhattan directions for each\r\n * point as {direction}:{direction}. A direction for a point is either\r\n * `h` (horizontal) or `v` (vertical).\r\n *\r\n * @return {Point[]}\r\n */\r\nexport function connectPoints(a, b, directions) {\r\n\r\n  var points = getBendpoints(a, b, directions);\r\n\r\n  points.unshift(a);\r\n  points.push(b);\r\n\r\n  return withoutRedundantPoints(points);\r\n}\r\n\r\n\r\n/**\r\n * Connect two rectangles using a manhattan layouted connection.\r\n *\r\n * @param {Rect} source source rectangle\r\n * @param {Rect} target target rectangle\r\n * @param {Point} [start] source docking\r\n * @param {Point} [end] target docking\r\n * @param {Object} [hints]\r\n * @param {string} [hints.preserveDocking=source] preserve docking on selected side\r\n * @param {string[]} [hints.preferredLayouts]\r\n * @param {Point|boolean} [hints.connectionStart] whether the start changed\r\n * @param {Point|boolean} [hints.connectionEnd] whether the end changed\r\n *\r\n * @return {Point[]} connection points\r\n */\r\nexport function connectRectangles(source, target, start, end, hints) {\r\n\r\n  var preferredLayouts = hints && hints.preferredLayouts || [];\r\n\r\n  var preferredLayout = without(preferredLayouts, 'straight')[0] || 'h:h';\r\n\r\n  var threshold = ORIENTATION_THRESHOLD[preferredLayout] || 0;\r\n\r\n  var orientation = getOrientation(source, target, threshold);\r\n\r\n  var directions = getDirections(orientation, preferredLayout);\r\n\r\n  start = start || getMid(source);\r\n  end = end || getMid(target);\r\n\r\n  var directionSplit = directions.split(':');\r\n\r\n  // compute actual docking points for start / end\r\n  // this ensures we properly layout only parts of the\r\n  // connection that lies in between the two rectangles\r\n  var startDocking = getDockingPoint(start, source, directionSplit[0], invertOrientation(orientation)),\r\n      endDocking = getDockingPoint(end, target, directionSplit[1], orientation);\r\n\r\n  return connectPoints(startDocking, endDocking, directions);\r\n}\r\n\r\n\r\n/**\r\n * Repair the connection between two rectangles, of which one has been updated.\r\n *\r\n * @param {Rect} source\r\n * @param {Rect} target\r\n * @param {Point} [start]\r\n * @param {Point} [end]\r\n * @param {Point[]} [waypoints]\r\n * @param {Object} [hints]\r\n * @param {string[]} [hints.preferredLayouts] The list of preferred layouts.\r\n * @param {boolean} [hints.connectionStart]\r\n * @param {boolean} [hints.connectionEnd]\r\n *\r\n * @return {Point[]} The waypoints of the repaired connection.\r\n */\r\nexport function repairConnection(source, target, start, end, waypoints, hints) {\r\n\r\n  if (isArray(start)) {\r\n    waypoints = start;\r\n    hints = end;\r\n\r\n    start = getMid(source);\r\n    end = getMid(target);\r\n  }\r\n\r\n  hints = assign({ preferredLayouts: [] }, hints);\r\n  waypoints = waypoints || [];\r\n\r\n  var preferredLayouts = hints.preferredLayouts,\r\n      preferStraight = preferredLayouts.indexOf('straight') !== -1,\r\n      repairedWaypoints;\r\n\r\n  // just layout non-existing or simple connections\r\n  // attempt to render straight lines, if required\r\n\r\n  // attempt to layout a straight line\r\n  repairedWaypoints = preferStraight && tryLayoutStraight(source, target, start, end, hints);\r\n\r\n  if (repairedWaypoints) {\r\n    return repairedWaypoints;\r\n  }\r\n\r\n  // try to layout from end\r\n  repairedWaypoints = hints.connectionEnd && tryRepairConnectionEnd(target, source, end, waypoints);\r\n\r\n  if (repairedWaypoints) {\r\n    return repairedWaypoints;\r\n  }\r\n\r\n  // try to layout from start\r\n  repairedWaypoints = hints.connectionStart && tryRepairConnectionStart(source, target, start, waypoints);\r\n\r\n  if (repairedWaypoints) {\r\n    return repairedWaypoints;\r\n  }\r\n\r\n  // or whether nothing seems to have changed\r\n  if (!hints.connectionStart && !hints.connectionEnd && waypoints && waypoints.length) {\r\n    return waypoints;\r\n  }\r\n\r\n  // simply reconnect if nothing else worked\r\n  return connectRectangles(source, target, start, end, hints);\r\n}\r\n\r\n\r\nfunction inRange(a, start, end) {\r\n  return a >= start && a <= end;\r\n}\r\n\r\nfunction isInRange(axis, a, b) {\r\n  var size = {\r\n    x: 'width',\r\n    y: 'height'\r\n  };\r\n\r\n  return inRange(a[axis], b[axis], b[axis] + b[size[axis]]);\r\n}\r\n\r\n/**\r\n * Lay out a straight connection.\r\n *\r\n * @param {Rect} source\r\n * @param {Rect} target\r\n * @param {Point} start\r\n * @param {Point} end\r\n * @param {Object} [hints]\r\n * @param {string} [hints.preserveDocking]\r\n *\r\n * @return {Point[]|null} The waypoints or null if layout isn't possible.\r\n */\r\nexport function tryLayoutStraight(source, target, start, end, hints) {\r\n  var axis = {},\r\n      primaryAxis,\r\n      orientation;\r\n\r\n  orientation = getOrientation(source, target);\r\n\r\n  // only layout a straight connection if shapes are\r\n  // horizontally or vertically aligned\r\n  if (!/^(top|bottom|left|right)$/.test(orientation)) {\r\n    return null;\r\n  }\r\n\r\n  if (/top|bottom/.test(orientation)) {\r\n    primaryAxis = 'x';\r\n  }\r\n\r\n  if (/left|right/.test(orientation)) {\r\n    primaryAxis = 'y';\r\n  }\r\n\r\n  if (hints.preserveDocking === 'target') {\r\n\r\n    if (!isInRange(primaryAxis, end, source)) {\r\n      return null;\r\n    }\r\n\r\n    axis[primaryAxis] = end[primaryAxis];\r\n\r\n    return [\r\n      {\r\n        x: axis.x !== undefined ? axis.x : start.x,\r\n        y: axis.y !== undefined ? axis.y : start.y,\r\n        original: {\r\n          x: axis.x !== undefined ? axis.x : start.x,\r\n          y: axis.y !== undefined ? axis.y : start.y\r\n        }\r\n      },\r\n      {\r\n        x: end.x,\r\n        y: end.y\r\n      }\r\n    ];\r\n\r\n  } else {\r\n\r\n    if (!isInRange(primaryAxis, start, target)) {\r\n      return null;\r\n    }\r\n\r\n    axis[primaryAxis] = start[primaryAxis];\r\n\r\n    return [\r\n      {\r\n        x: start.x,\r\n        y: start.y\r\n      },\r\n      {\r\n        x: axis.x !== undefined ? axis.x : end.x,\r\n        y: axis.y !== undefined ? axis.y : end.y,\r\n        original: {\r\n          x: axis.x !== undefined ? axis.x : end.x,\r\n          y: axis.y !== undefined ? axis.y : end.y\r\n        }\r\n      }\r\n    ];\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * Repair a connection from start.\r\n *\r\n * @param {Rect} moved\r\n * @param {Rect} other\r\n * @param {Point} newDocking\r\n * @param {Point[]} points originalPoints from moved to other\r\n *\r\n * @return {Point[]|null} The waypoints of the repaired connection.\r\n */\r\nfunction tryRepairConnectionStart(moved, other, newDocking, points) {\r\n  return _tryRepairConnectionSide(moved, other, newDocking, points);\r\n}\r\n\r\n/**\r\n * Repair a connection from end.\r\n *\r\n * @param {Rect} moved\r\n * @param {Rect} other\r\n * @param {Point} newDocking\r\n * @param {Point[]} points originalPoints from moved to other\r\n *\r\n * @return {Point[]|null} The waypoints of the repaired connection.\r\n */\r\nfunction tryRepairConnectionEnd(moved, other, newDocking, points) {\r\n  var waypoints = points.slice().reverse();\r\n\r\n  waypoints = _tryRepairConnectionSide(moved, other, newDocking, waypoints);\r\n\r\n  return waypoints ? waypoints.reverse() : null;\r\n}\r\n\r\n/**\r\n * Repair a connection from one side that moved.\r\n *\r\n * @param {Rect} moved\r\n * @param {Rect} other\r\n * @param {Point} newDocking\r\n * @param {Point[]} points originalPoints from moved to other\r\n *\r\n * @return {Point[]} The waypoints of the repaired connection.\r\n */\r\nfunction _tryRepairConnectionSide(moved, other, newDocking, points) {\r\n\r\n  function needsRelayout(points) {\r\n    if (points.length < 3) {\r\n      return true;\r\n    }\r\n\r\n    if (points.length > 4) {\r\n      return false;\r\n    }\r\n\r\n    // relayout if two points overlap\r\n    // this is most likely due to\r\n    return !!find(points, function(p, idx) {\r\n      var q = points[idx - 1];\r\n\r\n      return q && pointDistance(p, q) < 3;\r\n    });\r\n  }\r\n\r\n  function repairBendpoint(candidate, oldPeer, newPeer) {\r\n\r\n    var alignment = pointsAligned(oldPeer, candidate);\r\n\r\n    switch (alignment) {\r\n    case 'v':\r\n\r\n      // repair horizontal alignment\r\n      return { x: newPeer.x, y: candidate.y };\r\n    case 'h':\r\n\r\n      // repair vertical alignment\r\n      return { x: candidate.x, y: newPeer.y };\r\n    }\r\n\r\n    return { x: candidate.x, y: candidate. y };\r\n  }\r\n\r\n  function removeOverlapping(points, a, b) {\r\n    var i;\r\n\r\n    for (i = points.length - 2; i !== 0; i--) {\r\n\r\n      // intersects (?) break, remove all bendpoints up to this one and relayout\r\n      if (pointInRect(points[i], a, INTERSECTION_THRESHOLD) ||\r\n          pointInRect(points[i], b, INTERSECTION_THRESHOLD)) {\r\n\r\n        // return sliced old connection\r\n        return points.slice(i);\r\n      }\r\n    }\r\n\r\n    return points;\r\n  }\r\n\r\n  // (0) only repair what has layoutable bendpoints\r\n\r\n  // (1) if only one bendpoint and on shape moved onto other shapes axis\r\n  //     (horizontally / vertically), relayout\r\n\r\n  if (needsRelayout(points)) {\r\n    return null;\r\n  }\r\n\r\n  var oldDocking = points[0],\r\n      newPoints = points.slice(),\r\n      slicedPoints;\r\n\r\n  // (2) repair only last line segment and only if it was layouted before\r\n\r\n  newPoints[0] = newDocking;\r\n  newPoints[1] = repairBendpoint(newPoints[1], oldDocking, newDocking);\r\n\r\n\r\n  // (3) if shape intersects with any bendpoint after repair,\r\n  //     remove all segments up to this bendpoint and repair from there\r\n  slicedPoints = removeOverlapping(newPoints, moved, other);\r\n\r\n  if (slicedPoints !== newPoints) {\r\n    newPoints = _tryRepairConnectionSide(moved, other, newDocking, slicedPoints);\r\n  }\r\n\r\n  // (4) do NOT repair if repaired bendpoints are aligned\r\n  if (newPoints && pointsAligned(newPoints)) {\r\n    return null;\r\n  }\r\n\r\n  return newPoints;\r\n}\r\n\r\n\r\n/**\r\n * Returns the manhattan directions connecting two rectangles\r\n * with the given orientation.\r\n *\r\n * Will always return the default layout, if it is specific\r\n * regarding sides already (trbl).\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * getDirections('top'); // -> 'v:v'\r\n * getDirections('intersect'); // -> 't:t'\r\n *\r\n * getDirections('top-right', 'v:h'); // -> 'v:h'\r\n * getDirections('top-right', 'h:h'); // -> 'h:h'\r\n * ```\r\n *\r\n * @param {string} orientation\r\n * @param {string} defaultLayout\r\n *\r\n * @return {string}\r\n */\r\nfunction getDirections(orientation, defaultLayout) {\r\n\r\n  // don't override specific trbl directions\r\n  if (isExplicitDirections(defaultLayout)) {\r\n    return defaultLayout;\r\n  }\r\n\r\n  switch (orientation) {\r\n  case 'intersect':\r\n    return 't:t';\r\n\r\n  case 'top':\r\n  case 'bottom':\r\n    return 'v:v';\r\n\r\n  case 'left':\r\n  case 'right':\r\n    return 'h:h';\r\n\r\n  // 'top-left'\r\n  // 'top-right'\r\n  // 'bottom-left'\r\n  // 'bottom-right'\r\n  default:\r\n    return defaultLayout;\r\n  }\r\n}\r\n\r\nfunction isValidDirections(directions) {\r\n  return directions && /^h|v|t|r|b|l:h|v|t|r|b|l$/.test(directions);\r\n}\r\n\r\nfunction isExplicitDirections(directions) {\r\n  return directions && /t|r|b|l/.test(directions);\r\n}\r\n\r\nfunction invertOrientation(orientation) {\r\n  return {\r\n    'top': 'bottom',\r\n    'bottom': 'top',\r\n    'left': 'right',\r\n    'right': 'left',\r\n    'top-left': 'bottom-right',\r\n    'bottom-right': 'top-left',\r\n    'top-right': 'bottom-left',\r\n    'bottom-left': 'top-right',\r\n  }[orientation];\r\n}\r\n\r\nfunction getDockingPoint(point, rectangle, dockingDirection, targetOrientation) {\r\n\r\n  // ensure we end up with a specific docking direction\r\n  // based on the targetOrientation, if <h|v> is being passed\r\n\r\n  if (dockingDirection === 'h') {\r\n    dockingDirection = /left/.test(targetOrientation) ? 'l' : 'r';\r\n  }\r\n\r\n  if (dockingDirection === 'v') {\r\n    dockingDirection = /top/.test(targetOrientation) ? 't' : 'b';\r\n  }\r\n\r\n  if (dockingDirection === 't') {\r\n    return { original: point, x: point.x, y: rectangle.y };\r\n  }\r\n\r\n  if (dockingDirection === 'r') {\r\n    return { original: point, x: rectangle.x + rectangle.width, y: point.y };\r\n  }\r\n\r\n  if (dockingDirection === 'b') {\r\n    return { original: point, x: point.x, y: rectangle.y + rectangle.height };\r\n  }\r\n\r\n  if (dockingDirection === 'l') {\r\n    return { original: point, x: rectangle.x, y: point.y };\r\n  }\r\n\r\n  throw new Error('unexpected dockingDirection: <' + dockingDirection + '>');\r\n}\r\n\r\n\r\n/**\r\n * Return list of waypoints with redundant ones filtered out.\r\n *\r\n * @example\r\n *\r\n * Original points:\r\n *\r\n *   [x] ----- [x] ------ [x]\r\n *                         |\r\n *                        [x] ----- [x] - [x]\r\n *\r\n * Filtered:\r\n *\r\n *   [x] ---------------- [x]\r\n *                         |\r\n *                        [x] ----------- [x]\r\n *\r\n * @param {Point[]} waypoints\r\n *\r\n * @return {Point[]}\r\n */\r\nexport function withoutRedundantPoints(waypoints) {\r\n  return waypoints.reduce(function(points, p, idx) {\r\n\r\n    var previous = points[points.length - 1],\r\n        next = waypoints[idx + 1];\r\n\r\n    if (!pointsOnLine(previous, next, p, 0)) {\r\n      points.push(p);\r\n    }\r\n\r\n    return points;\r\n  }, []);\r\n}\r\n","import inherits from 'inherits-browser';\n\nimport {\n  assign\n} from 'min-dash';\n\nimport BaseLayouter from 'diagram-js/lib/layout/BaseLayouter';\n\nimport {\n  repairConnection,\n  withoutRedundantPoints\n} from 'diagram-js/lib/layout/ManhattanLayout';\n\nimport {\n  getMid,\n  getOrientation\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  isExpanded\n} from '../../util/DiUtil';\n\nimport { is } from '../../util/ModelUtil';\n\nimport { isDirectionHorizontal } from './util/ModelingUtil';\n\n/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n *\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('diagram-js/lib/layout/BaseLayouter').LayoutConnectionHints} LayoutConnectionHints\n *\n * @typedef { {\n *   source?: Element;\n *   target?: Element;\n *   waypoints?: Point[];\n *   connectionStart?: Point;\n *   connectionEnd?: Point;\n * } & LayoutConnectionHints } BpmnLayoutConnectionHints\n */\n\nvar ATTACH_ORIENTATION_PADDING = -10,\n    BOUNDARY_TO_HOST_THRESHOLD = 40;\n\n// layout all connection between flow elements h:h, except for\n// (1) outgoing of boundary events -> layout based on attach orientation and target orientation\n// (2) incoming/outgoing of gateways -> v:h for outgoing, h:v for incoming\n// (3) loops connect sides clockwise\nvar PREFERRED_LAYOUTS_HORIZONTAL = {\n  default: [ 'h:h' ],\n  fromGateway: [ 'v:h' ],\n  toGateway: [ 'h:v' ],\n  loop: {\n    fromTop: [ 't:r' ],\n    fromRight: [ 'r:b' ],\n    fromLeft: [ 'l:t' ],\n    fromBottom: [ 'b:l' ]\n  },\n  boundaryLoop: {\n    alternateHorizontalSide: 'b',\n    alternateVerticalSide: 'l',\n    default: 'v'\n  },\n  messageFlow: [ 'straight', 'v:v' ],\n  subProcess: [ 'straight', 'h:h' ],\n  isHorizontal: true\n};\n\n// for vertical layouts, switch h and v and loop counter-clockwise\nvar PREFERRED_LAYOUTS_VERTICAL = {\n  default: [ 'v:v' ],\n  fromGateway: [ 'h:v' ],\n  toGateway: [ 'v:h' ],\n  loop: {\n    fromTop: [ 't:l' ],\n    fromRight: [ 'r:t' ],\n    fromLeft: [ 'l:b' ],\n    fromBottom: [ 'b:r' ]\n  },\n  boundaryLoop: {\n    alternateHorizontalSide: 't',\n    alternateVerticalSide: 'r',\n    default: 'h'\n  },\n  messageFlow: [ 'straight', 'h:h' ],\n  subProcess: [ 'straight', 'v:v' ],\n  isHorizontal: false\n};\n\nvar oppositeOrientationMapping = {\n  'top': 'bottom',\n  'top-right': 'bottom-left',\n  'top-left': 'bottom-right',\n  'right': 'left',\n  'bottom': 'top',\n  'bottom-right': 'top-left',\n  'bottom-left': 'top-right',\n  'left': 'right'\n};\n\nvar orientationDirectionMapping = {\n  top: 't',\n  right: 'r',\n  bottom: 'b',\n  left: 'l'\n};\n\nexport default function BpmnLayouter() {}\n\ninherits(BpmnLayouter, BaseLayouter);\n\n/**\n * Returns waypoints of laid out connection.\n *\n * @param {Connection} connection\n * @param {BpmnLayoutConnectionHints} [hints]\n *\n * @return {Point[]}\n */\nBpmnLayouter.prototype.layoutConnection = function(connection, hints) {\n  if (!hints) {\n    hints = {};\n  }\n\n  var source = hints.source || connection.source,\n      target = hints.target || connection.target,\n      waypoints = hints.waypoints || connection.waypoints,\n      connectionStart = hints.connectionStart,\n      connectionEnd = hints.connectionEnd;\n\n  var manhattanOptions,\n      updatedWaypoints;\n\n  if (!connectionStart) {\n    connectionStart = getConnectionDocking(waypoints && waypoints[ 0 ], source);\n  }\n\n  if (!connectionEnd) {\n    connectionEnd = getConnectionDocking(waypoints && waypoints[ waypoints.length - 1 ], target);\n  }\n\n  if (is(connection, 'bpmn:Association') ||\n      is(connection, 'bpmn:DataAssociation')) {\n\n    if (waypoints && !isCompensationAssociation(source, target)) {\n      return [].concat([ connectionStart ], waypoints.slice(1, -1), [ connectionEnd ]);\n    }\n  }\n\n  var layout = isDirectionHorizontal(source) ? PREFERRED_LAYOUTS_HORIZONTAL : PREFERRED_LAYOUTS_VERTICAL;\n\n  if (is(connection, 'bpmn:MessageFlow')) {\n    manhattanOptions = getMessageFlowManhattanOptions(source, target, layout);\n  } else if (is(connection, 'bpmn:SequenceFlow') || isCompensationAssociation(source, target)) {\n\n    if (source === target) {\n      manhattanOptions = {\n        preferredLayouts: getLoopPreferredLayout(source, connection, layout)\n      };\n    } else if (is(source, 'bpmn:BoundaryEvent')) {\n      manhattanOptions = {\n        preferredLayouts: getBoundaryEventPreferredLayouts(source, target, connectionEnd, layout)\n      };\n    } else if (isExpandedSubProcess(source) || isExpandedSubProcess(target)) {\n      manhattanOptions = {\n        preferredLayouts: layout.subProcess,\n        preserveDocking: getSubProcessPreserveDocking(source)\n      };\n    } else if (is(source, 'bpmn:Gateway')) {\n      manhattanOptions = {\n        preferredLayouts: layout.fromGateway\n      };\n    } else if (is(target, 'bpmn:Gateway')) {\n      manhattanOptions = {\n        preferredLayouts: layout.toGateway\n      };\n    } else {\n      manhattanOptions = {\n        preferredLayouts: layout.default\n      };\n    }\n  }\n\n  if (manhattanOptions) {\n    manhattanOptions = assign(manhattanOptions, hints);\n\n    updatedWaypoints = withoutRedundantPoints(repairConnection(\n      source,\n      target,\n      connectionStart,\n      connectionEnd,\n      waypoints,\n      manhattanOptions\n    ));\n  }\n\n  return updatedWaypoints || [ connectionStart, connectionEnd ];\n};\n\n\n// helpers //////////\n\nfunction getAttachOrientation(attachedElement) {\n  var hostElement = attachedElement.host;\n\n  return getOrientation(getMid(attachedElement), hostElement, ATTACH_ORIENTATION_PADDING);\n}\n\nfunction getMessageFlowManhattanOptions(source, target, layout) {\n  return {\n    preferredLayouts: layout.messageFlow,\n    preserveDocking: getMessageFlowPreserveDocking(source, target)\n  };\n}\n\nfunction getMessageFlowPreserveDocking(source, target) {\n\n  // (1) docking element connected to participant has precedence\n  if (is(target, 'bpmn:Participant')) {\n    return 'source';\n  }\n\n  if (is(source, 'bpmn:Participant')) {\n    return 'target';\n  }\n\n  // (2) docking element connected to expanded sub-process has precedence\n  if (isExpandedSubProcess(target)) {\n    return 'source';\n  }\n\n  if (isExpandedSubProcess(source)) {\n    return 'target';\n  }\n\n  // (3) docking event has precedence\n  if (is(target, 'bpmn:Event')) {\n    return 'target';\n  }\n\n  if (is(source, 'bpmn:Event')) {\n    return 'source';\n  }\n\n  return null;\n}\n\nfunction getSubProcessPreserveDocking(source) {\n  return isExpandedSubProcess(source) ? 'target' : 'source';\n}\n\nfunction getConnectionDocking(point, shape) {\n  return point ? (point.original || point) : getMid(shape);\n}\n\nfunction isCompensationAssociation(source, target) {\n  return is(target, 'bpmn:Activity') &&\n    is(source, 'bpmn:BoundaryEvent') &&\n    target.businessObject.isForCompensation;\n}\n\nfunction isExpandedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && isExpanded(element);\n}\n\nfunction isSame(a, b) {\n  return a === b;\n}\n\nfunction isAnyOrientation(orientation, orientations) {\n  return orientations.indexOf(orientation) !== -1;\n}\n\nfunction getHorizontalOrientation(orientation) {\n  var matches = /right|left/.exec(orientation);\n\n  return matches && matches[0];\n}\n\nfunction getVerticalOrientation(orientation) {\n  var matches = /top|bottom/.exec(orientation);\n\n  return matches && matches[0];\n}\n\nfunction isOppositeOrientation(a, b) {\n  return oppositeOrientationMapping[a] === b;\n}\n\nfunction isOppositeHorizontalOrientation(a, b) {\n  var horizontalOrientation = getHorizontalOrientation(a);\n\n  var oppositeHorizontalOrientation = oppositeOrientationMapping[horizontalOrientation];\n\n  return b.indexOf(oppositeHorizontalOrientation) !== -1;\n}\n\nfunction isOppositeVerticalOrientation(a, b) {\n  var verticalOrientation = getVerticalOrientation(a);\n\n  var oppositeVerticalOrientation = oppositeOrientationMapping[verticalOrientation];\n\n  return b.indexOf(oppositeVerticalOrientation) !== -1;\n}\n\nfunction isHorizontalOrientation(orientation) {\n  return orientation === 'right' || orientation === 'left';\n}\n\nfunction getLoopPreferredLayout(source, connection, layout) {\n  var waypoints = connection.waypoints;\n\n  var orientation = waypoints && waypoints.length && getOrientation(waypoints[0], source);\n\n  if (orientation === 'top') {\n    return layout.loop.fromTop;\n  } else if (orientation === 'right') {\n    return layout.loop.fromRight;\n  } else if (orientation === 'left') {\n    return layout.loop.fromLeft;\n  }\n\n  return layout.loop.fromBottom;\n}\n\nfunction getBoundaryEventPreferredLayouts(source, target, end, layout) {\n  var sourceMid = getMid(source),\n      targetMid = getMid(target),\n      attachOrientation = getAttachOrientation(source),\n      sourceLayout,\n      targetLayout;\n\n  var isLoop = isSame(source.host, target);\n\n  var attachedToSide = isAnyOrientation(attachOrientation, [ 'top', 'right', 'bottom', 'left' ]);\n\n  var targetOrientation = getOrientation(targetMid, sourceMid, {\n    x: source.width / 2 + target.width / 2,\n    y: source.height / 2 + target.height / 2\n  });\n\n  if (isLoop) {\n    return getBoundaryEventLoopLayout(attachOrientation, attachedToSide, source, target, end, layout);\n  }\n\n  // source layout\n  sourceLayout = getBoundaryEventSourceLayout(attachOrientation, targetOrientation, attachedToSide, layout.isHorizontal);\n\n  // target layout\n  targetLayout = getBoundaryEventTargetLayout(attachOrientation, targetOrientation, attachedToSide, layout.isHorizontal);\n\n  return [ sourceLayout + ':' + targetLayout ];\n}\n\nfunction getBoundaryEventLoopLayout(attachOrientation, attachedToSide, source, target, end, layout) {\n  var orientation = attachedToSide ? attachOrientation : layout.isHorizontal ? getVerticalOrientation(attachOrientation) : getHorizontalOrientation(attachOrientation),\n      sourceLayout = orientationDirectionMapping[ orientation ],\n      targetLayout;\n\n  if (attachedToSide) {\n    if (isHorizontalOrientation(attachOrientation)) {\n      targetLayout = shouldConnectToSameSide('y', source, target, end) ? 'h' : layout.boundaryLoop.alternateHorizontalSide;\n    } else {\n      targetLayout = shouldConnectToSameSide('x', source, target, end) ? 'v' : layout.boundaryLoop.alternateVerticalSide;\n    }\n  } else {\n    targetLayout = layout.boundaryLoop.default;\n  }\n\n  return [ sourceLayout + ':' + targetLayout ];\n}\n\nfunction shouldConnectToSameSide(axis, source, target, end) {\n  var threshold = BOUNDARY_TO_HOST_THRESHOLD;\n\n  return !(\n    areCloseOnAxis(axis, end, target, threshold) ||\n    areCloseOnAxis(axis, end, {\n      x: target.x + target.width,\n      y: target.y + target.height\n    }, threshold) ||\n    areCloseOnAxis(axis, end, getMid(source), threshold)\n  );\n}\n\nfunction areCloseOnAxis(axis, a, b, threshold) {\n  return Math.abs(a[ axis ] - b[ axis ]) < threshold;\n}\n\nfunction getBoundaryEventSourceLayout(attachOrientation, targetOrientation, attachedToSide, isHorizontal) {\n\n  // attached to either top, right, bottom or left side\n  if (attachedToSide) {\n    return orientationDirectionMapping[ attachOrientation ];\n  }\n\n  // attached to either top-right, top-left, bottom-right or bottom-left corner\n\n  var verticalAttachOrientation = getVerticalOrientation(attachOrientation),\n      horizontalAttachOrientation = getHorizontalOrientation(attachOrientation),\n      verticalTargetOrientation = getVerticalOrientation(targetOrientation),\n      horizontalTargetOrientation = getHorizontalOrientation(targetOrientation);\n\n  if (isHorizontal) {\n\n    // same vertical or opposite horizontal orientation\n    if (\n      isSame(verticalAttachOrientation, verticalTargetOrientation) ||\n      isOppositeOrientation(horizontalAttachOrientation, horizontalTargetOrientation)\n    ) {\n      return orientationDirectionMapping[ verticalAttachOrientation ];\n    }\n  } else {\n\n    // same horizontal or opposite vertical orientation\n    if (\n      isSame(horizontalAttachOrientation, horizontalTargetOrientation) ||\n      isOppositeOrientation(verticalAttachOrientation, verticalTargetOrientation)\n    ) {\n      return orientationDirectionMapping[ horizontalAttachOrientation ];\n    }\n  }\n\n  // fallback\n  return orientationDirectionMapping[ isHorizontal ? horizontalAttachOrientation : verticalAttachOrientation ];\n}\n\nfunction getBoundaryEventTargetLayout(attachOrientation, targetOrientation, attachedToSide, isHorizontal) {\n\n  // attached to either top, right, bottom or left side\n  if (attachedToSide) {\n    if (isHorizontalOrientation(attachOrientation)) {\n\n      // orientation is right or left\n\n      // opposite horizontal orientation or same orientation\n      if (\n        isOppositeHorizontalOrientation(attachOrientation, targetOrientation) ||\n        isSame(attachOrientation, targetOrientation)\n      ) {\n        return 'h';\n      }\n\n      // fallback\n      return 'v';\n    } else {\n\n      // orientation is top or bottom\n\n      // opposite vertical orientation or same orientation\n      if (\n        isOppositeVerticalOrientation(attachOrientation, targetOrientation) ||\n        isSame(attachOrientation, targetOrientation)\n      ) {\n        return 'v';\n      }\n\n      // fallback\n      return 'h';\n    }\n  }\n\n  // attached to either top-right, top-left, bottom-right or bottom-left corner\n  // and orientation is same on the counter-axis\n\n  if (isHorizontal) {\n    if (isSame(getVerticalOrientation(attachOrientation), getVerticalOrientation(targetOrientation))) {\n      return 'h';\n    } else {\n      return 'v';\n    }\n  } else {\n    if (isSame(getHorizontalOrientation(attachOrientation), getHorizontalOrientation(targetOrientation))) {\n      return 'v';\n    } else {\n      return 'h';\n    }\n  }\n}\n","import {\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getElementLineIntersection\r\n} from './LayoutUtil';\r\n\r\n/**\r\n * @typedef {import('../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../core/GraphicsFactory').default} GraphicsFactory\r\n */\r\n\r\nfunction dockingToPoint(docking) {\r\n\r\n  // use the dockings actual point and\r\n  // retain the original docking\r\n  return assign({ original: docking.point.original || docking.point }, docking.actual);\r\n}\r\n\r\n\r\n/**\r\n * A {@link ConnectionDocking} that crops connection waypoints based on\r\n * the path(s) of the connection source and target.\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {GraphicsFactory} graphicsFactory\r\n */\r\nexport default function CroppingConnectionDocking(elementRegistry, graphicsFactory) {\r\n  this._elementRegistry = elementRegistry;\r\n  this._graphicsFactory = graphicsFactory;\r\n}\r\n\r\nCroppingConnectionDocking.$inject = [ 'elementRegistry', 'graphicsFactory' ];\r\n\r\n\r\n/**\r\n * @inheritDoc ConnectionDocking#getCroppedWaypoints\r\n */\r\nCroppingConnectionDocking.prototype.getCroppedWaypoints = function(connection, source, target) {\r\n\r\n  source = source || connection.source;\r\n  target = target || connection.target;\r\n\r\n  var sourceDocking = this.getDockingPoint(connection, source, true),\r\n      targetDocking = this.getDockingPoint(connection, target);\r\n\r\n  var croppedWaypoints = connection.waypoints.slice(sourceDocking.idx + 1, targetDocking.idx);\r\n\r\n  croppedWaypoints.unshift(dockingToPoint(sourceDocking));\r\n  croppedWaypoints.push(dockingToPoint(targetDocking));\r\n\r\n  return croppedWaypoints;\r\n};\r\n\r\n/**\r\n * Return the connection docking point on the specified shape\r\n *\r\n * @inheritDoc ConnectionDocking#getDockingPoint\r\n */\r\nCroppingConnectionDocking.prototype.getDockingPoint = function(connection, shape, dockStart) {\r\n\r\n  var waypoints = connection.waypoints,\r\n      dockingIdx,\r\n      dockingPoint,\r\n      croppedPoint;\r\n\r\n  dockingIdx = dockStart ? 0 : waypoints.length - 1;\r\n  dockingPoint = waypoints[dockingIdx];\r\n\r\n  croppedPoint = this._getIntersection(shape, connection, dockStart);\r\n\r\n  return {\r\n    point: dockingPoint,\r\n    actual: croppedPoint || dockingPoint,\r\n    idx: dockingIdx\r\n  };\r\n};\r\n\r\n\r\n// helpers //////////////////////\r\n\r\nCroppingConnectionDocking.prototype._getIntersection = function(shape, connection, takeFirst) {\r\n\r\n  var shapePath = this._getShapePath(shape),\r\n      connectionPath = this._getConnectionPath(connection);\r\n\r\n  return getElementLineIntersection(shapePath, connectionPath, takeFirst);\r\n};\r\n\r\nCroppingConnectionDocking.prototype._getConnectionPath = function(connection) {\r\n  return this._graphicsFactory.getConnectionPath(connection);\r\n};\r\n\r\nCroppingConnectionDocking.prototype._getShapePath = function(shape) {\r\n  return this._graphicsFactory.getShapePath(shape);\r\n};\r\n\r\nCroppingConnectionDocking.prototype._getGfx = function(element) {\r\n  return this._elementRegistry.getGraphics(element);\r\n};\r\n","import BehaviorModule from './behavior';\nimport RulesModule from '../rules';\nimport DiOrderingModule from '../di-ordering';\nimport OrderingModule from '../ordering';\nimport ReplaceModule from '../replace';\nimport SpaceToolModule from '../space-tool';\n\nimport CommandModule from 'diagram-js/lib/command';\nimport LabelSupportModule from 'diagram-js/lib/features/label-support';\nimport AttachSupportModule from 'diagram-js/lib/features/attach-support';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport ChangeSupportModule from 'diagram-js/lib/features/change-support';\n\nimport BpmnFactory from './BpmnFactory';\nimport BpmnUpdater from './BpmnUpdater';\nimport ElementFactory from './ElementFactory';\nimport Modeling from './Modeling';\nimport BpmnLayouter from './BpmnLayouter';\nimport CroppingConnectionDocking from 'diagram-js/lib/layout/CroppingConnectionDocking';\n\n\nexport default {\n  __init__: [\n    'modeling',\n    'bpmnUpdater'\n  ],\n  __depends__: [\n    BehaviorModule,\n    RulesModule,\n    DiOrderingModule,\n    OrderingModule,\n    ReplaceModule,\n    CommandModule,\n    LabelSupportModule,\n    AttachSupportModule,\n    SelectionModule,\n    ChangeSupportModule,\n    SpaceToolModule\n  ],\n  bpmnFactory: [ 'type', BpmnFactory ],\n  bpmnUpdater: [ 'type', BpmnUpdater ],\n  elementFactory: [ 'type', ElementFactory ],\n  modeling: [ 'type', Modeling ],\n  layouter: [ 'type', BpmnLayouter ],\n  connectionDocking: [ 'type', CroppingConnectionDocking ]\n};","import {\n  assign,\n  isNil\n} from 'min-dash';\n\nconst round = Math.round;\n\n/**\n * @typedef {import('diagram-js/lib/features/complex-preview/ComplexPreview').default} ComplexPreview\n * @typedef {import('diagram-js/lib/layout/ConnectionDocking').default} ConnectionDocking\n * @typedef {import('../modeling/ElementFactory').default} ElementFactory\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/layout/ManhattanLayout').default} ManhattanLayout\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n *\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\n/**\n * A preview for appending.\n *\n * @param {ComplexPreview} complexPreview\n * @param {ConnectionDocking} connectionDocking\n * @param {ElementFactory} elementFactory\n * @param {EventBus} eventBus\n * @param {ManhattanLayout} layouter\n * @param {Rules} rules\n */\nexport default function AppendPreview(complexPreview, connectionDocking, elementFactory, eventBus, layouter, rules) {\n  this._complexPreview = complexPreview;\n  this._connectionDocking = connectionDocking;\n  this._elementFactory = elementFactory;\n  this._eventBus = eventBus;\n  this._layouter = layouter;\n  this._rules = rules;\n}\n\n/**\n * Create a preview of appending a shape of the given type to the given source.\n *\n * @param {Shape} source\n * @param {string} type\n * @param {Partial<Shape>} options\n */\nAppendPreview.prototype.create = function(source, type, options) {\n  const complexPreview = this._complexPreview,\n        connectionDocking = this._connectionDocking,\n        elementFactory = this._elementFactory,\n        eventBus = this._eventBus,\n        layouter = this._layouter,\n        rules = this._rules;\n\n  const shape = elementFactory.createShape(assign({ type }, options));\n\n  const position = eventBus.fire('autoPlace', {\n    source,\n    shape\n  });\n\n  if (!position) {\n    return;\n  }\n\n  assign(shape, {\n    x: position.x - round(shape.width / 2),\n    y: position.y - round(shape.height / 2)\n  });\n\n  const connectionCreateAllowed = rules.allowed('connection.create', {\n    source,\n    target: shape,\n    hints: {\n      targetParent: source.parent\n    }\n  });\n\n  let connection = null;\n\n  if (connectionCreateAllowed) {\n    connection = elementFactory.createConnection(connectionCreateAllowed);\n\n    connection.waypoints = layouter.layoutConnection(connection, {\n      source,\n      target: shape\n    });\n\n    connection.waypoints = connectionDocking.getCroppedWaypoints(connection, source, shape);\n  }\n\n  complexPreview.create({\n    created: [\n      shape,\n      connection\n    ].filter((element) => !isNil(element))\n  });\n};\n\nAppendPreview.prototype.cleanUp = function() {\n  this._complexPreview.cleanUp();\n};\n\nAppendPreview.$inject = [\n  'complexPreview',\n  'connectionDocking',\n  'elementFactory',\n  'eventBus',\n  'layouter',\n  'rules'\n];","import AutoPlaceModule from '../auto-place';\nimport ComplexPreviewModule from 'diagram-js/lib/features/complex-preview';\nimport ModelingModule from '../modeling';\n\nimport AppendPreview from './AppendPreview';\n\nexport default {\n  __depends__: [\n    AutoPlaceModule,\n    ComplexPreviewModule,\n    ModelingModule\n  ],\n  __init__: [ 'appendPreview' ],\n  appendPreview: [ 'type', AppendPreview ]\n};\n","import {\n  assign,\n  bind,\n  pick\n} from 'min-dash';\n\nimport {\n  domify,\n  query as domQuery,\n  event as domEvent,\n  remove as domRemove\n} from 'min-dom';\n\nvar min = Math.min,\n    max = Math.max;\n\nfunction preventDefault(e) {\n  e.preventDefault();\n}\n\nfunction stopPropagation(e) {\n  e.stopPropagation();\n}\n\nfunction isTextNode(node) {\n  return node.nodeType === Node.TEXT_NODE;\n}\n\nfunction toArray(nodeList) {\n  return [].slice.call(nodeList);\n}\n\n/**\n * Initializes a container for a content editable div.\n *\n * Structure:\n *\n * container\n *   parent\n *     content\n *     resize-handle\n *\n * @param {object} options\n * @param {DOMElement} options.container The DOM element to append the contentContainer to\n * @param {Function} options.keyHandler Handler for key events\n * @param {Function} options.resizeHandler Handler for resize events\n */\nexport default function TextBox(options) {\n  this.container = options.container;\n\n  this.parent = domify(\n    '<div class=\"djs-direct-editing-parent\">' +\n      '<div class=\"djs-direct-editing-content\" contenteditable=\"true\"></div>' +\n    '</div>'\n  );\n\n  this.content = domQuery('[contenteditable]', this.parent);\n\n  this.keyHandler = options.keyHandler || function() {};\n  this.resizeHandler = options.resizeHandler || function() {};\n\n  this.autoResize = bind(this.autoResize, this);\n  this.handlePaste = bind(this.handlePaste, this);\n}\n\n\n/**\n * Create a text box with the given position, size, style and text content\n *\n * @param {Object} bounds\n * @param {Number} bounds.x absolute x position\n * @param {Number} bounds.y absolute y position\n * @param {Number} [bounds.width] fixed width value\n * @param {Number} [bounds.height] fixed height value\n * @param {Number} [bounds.maxWidth] maximum width value\n * @param {Number} [bounds.maxHeight] maximum height value\n * @param {Number} [bounds.minWidth] minimum width value\n * @param {Number} [bounds.minHeight] minimum height value\n * @param {Object} [style]\n * @param {String} value text content\n *\n * @return {DOMElement} The created content DOM element\n */\nTextBox.prototype.create = function(bounds, style, value, options) {\n  var self = this;\n\n  var parent = this.parent,\n      content = this.content,\n      container = this.container;\n\n  options = this.options = options || {};\n\n  style = this.style = style || {};\n\n  var parentStyle = pick(style, [\n    'width',\n    'height',\n    'maxWidth',\n    'maxHeight',\n    'minWidth',\n    'minHeight',\n    'left',\n    'top',\n    'backgroundColor',\n    'position',\n    'overflow',\n    'border',\n    'wordWrap',\n    'textAlign',\n    'outline',\n    'transform'\n  ]);\n\n  assign(parent.style, {\n    width: bounds.width + 'px',\n    height: bounds.height + 'px',\n    maxWidth: bounds.maxWidth + 'px',\n    maxHeight: bounds.maxHeight + 'px',\n    minWidth: bounds.minWidth + 'px',\n    minHeight: bounds.minHeight + 'px',\n    left: bounds.x + 'px',\n    top: bounds.y + 'px',\n    backgroundColor: '#ffffff',\n    position: 'absolute',\n    overflow: 'visible',\n    border: '1px solid #ccc',\n    boxSizing: 'border-box',\n    wordWrap: 'normal',\n    textAlign: 'center',\n    outline: 'none'\n  }, parentStyle);\n\n  var contentStyle = pick(style, [\n    'fontFamily',\n    'fontSize',\n    'fontWeight',\n    'lineHeight',\n    'padding',\n    'paddingTop',\n    'paddingRight',\n    'paddingBottom',\n    'paddingLeft'\n  ]);\n\n  assign(content.style, {\n    boxSizing: 'border-box',\n    width: '100%',\n    outline: 'none',\n    wordWrap: 'break-word'\n  }, contentStyle);\n\n  if (options.centerVertically) {\n    assign(content.style, {\n      position: 'absolute',\n      top: '50%',\n      transform: 'translate(0, -50%)'\n    }, contentStyle);\n  }\n\n  content.innerText = value;\n\n  domEvent.bind(content, 'keydown', this.keyHandler);\n  domEvent.bind(content, 'mousedown', stopPropagation);\n  domEvent.bind(content, 'paste', self.handlePaste);\n\n  if (options.autoResize) {\n    domEvent.bind(content, 'input', this.autoResize);\n  }\n\n  if (options.resizable) {\n    this.resizable(style);\n  }\n\n  container.appendChild(parent);\n\n  // set selection to end of text\n  this.setSelection(content.lastChild, content.lastChild && content.lastChild.length);\n\n  return parent;\n};\n\n/**\n * Intercept paste events to remove formatting from pasted text.\n */\nTextBox.prototype.handlePaste = function(e) {\n  var options = this.options,\n      style = this.style;\n\n  e.preventDefault();\n\n  var text;\n\n  if (e.clipboardData) {\n\n    // Chrome, Firefox, Safari\n    text = e.clipboardData.getData('text/plain');\n  } else {\n\n    // Internet Explorer\n    text = window.clipboardData.getData('Text');\n  }\n\n  this.insertText(text);\n\n  if (options.autoResize) {\n    var hasResized = this.autoResize(style);\n\n    if (hasResized) {\n      this.resizeHandler(hasResized);\n    }\n  }\n};\n\nTextBox.prototype.insertText = function(text) {\n  text = normalizeEndOfLineSequences(text);\n\n  // insertText command not supported by Internet Explorer\n  var success = document.execCommand('insertText', false, text);\n\n  if (success) {\n    return;\n  }\n\n  this._insertTextIE(text);\n};\n\nTextBox.prototype._insertTextIE = function(text) {\n\n  // Internet Explorer\n  var range = this.getSelection(),\n      startContainer = range.startContainer,\n      endContainer = range.endContainer,\n      startOffset = range.startOffset,\n      endOffset = range.endOffset,\n      commonAncestorContainer = range.commonAncestorContainer;\n\n  var childNodesArray = toArray(commonAncestorContainer.childNodes);\n\n  var container,\n      offset;\n\n  if (isTextNode(commonAncestorContainer)) {\n    var containerTextContent = startContainer.textContent;\n\n    startContainer.textContent =\n      containerTextContent.substring(0, startOffset)\n      + text\n      + containerTextContent.substring(endOffset);\n\n    container = startContainer;\n    offset = startOffset + text.length;\n\n  } else if (startContainer === this.content && endContainer === this.content) {\n    var textNode = document.createTextNode(text);\n\n    this.content.insertBefore(textNode, childNodesArray[startOffset]);\n\n    container = textNode;\n    offset = textNode.textContent.length;\n  } else {\n    var startContainerChildIndex = childNodesArray.indexOf(startContainer),\n        endContainerChildIndex = childNodesArray.indexOf(endContainer);\n\n    childNodesArray.forEach(function(childNode, index) {\n\n      if (index === startContainerChildIndex) {\n        childNode.textContent =\n          startContainer.textContent.substring(0, startOffset) +\n          text +\n          endContainer.textContent.substring(endOffset);\n      } else if (index > startContainerChildIndex && index <= endContainerChildIndex) {\n        domRemove(childNode);\n      }\n    });\n\n    container = startContainer;\n    offset = startOffset + text.length;\n  }\n\n  if (container && offset !== undefined) {\n\n    // is necessary in Internet Explorer\n    setTimeout(function() {\n      self.setSelection(container, offset);\n    });\n  }\n};\n\n/**\n * Automatically resize element vertically to fit its content.\n */\nTextBox.prototype.autoResize = function() {\n  var parent = this.parent,\n      content = this.content;\n\n  var fontSize = parseInt(this.style.fontSize) || 12;\n\n  if (content.scrollHeight > parent.offsetHeight ||\n      content.scrollHeight < parent.offsetHeight - fontSize) {\n    var bounds = parent.getBoundingClientRect();\n\n    var height = content.scrollHeight;\n    parent.style.height = height + 'px';\n\n    this.resizeHandler({\n      width: bounds.width,\n      height: bounds.height,\n      dx: 0,\n      dy: height - bounds.height\n    });\n  }\n};\n\n/**\n * Make an element resizable by adding a resize handle.\n */\nTextBox.prototype.resizable = function() {\n  var self = this;\n\n  var parent = this.parent,\n      resizeHandle = this.resizeHandle;\n\n  var minWidth = parseInt(this.style.minWidth) || 0,\n      minHeight = parseInt(this.style.minHeight) || 0,\n      maxWidth = parseInt(this.style.maxWidth) || Infinity,\n      maxHeight = parseInt(this.style.maxHeight) || Infinity;\n\n  if (!resizeHandle) {\n    resizeHandle = this.resizeHandle = domify(\n      '<div class=\"djs-direct-editing-resize-handle\"></div>'\n    );\n\n    var startX, startY, startWidth, startHeight;\n\n    var onMouseDown = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      startX = e.clientX;\n      startY = e.clientY;\n\n      var bounds = parent.getBoundingClientRect();\n\n      startWidth = bounds.width;\n      startHeight = bounds.height;\n\n      domEvent.bind(document, 'mousemove', onMouseMove);\n      domEvent.bind(document, 'mouseup', onMouseUp);\n    };\n\n    var onMouseMove = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      var newWidth = min(max(startWidth + e.clientX - startX, minWidth), maxWidth);\n      var newHeight = min(max(startHeight + e.clientY - startY, minHeight), maxHeight);\n\n      parent.style.width = newWidth + 'px';\n      parent.style.height = newHeight + 'px';\n\n      self.resizeHandler({\n        width: startWidth,\n        height: startHeight,\n        dx: e.clientX - startX,\n        dy: e.clientY - startY\n      });\n    };\n\n    var onMouseUp = function(e) {\n      preventDefault(e);\n      stopPropagation(e);\n\n      domEvent.unbind(document,'mousemove', onMouseMove, false);\n      domEvent.unbind(document, 'mouseup', onMouseUp, false);\n    };\n\n    domEvent.bind(resizeHandle, 'mousedown', onMouseDown);\n  }\n\n  assign(resizeHandle.style, {\n    position: 'absolute',\n    bottom: '0px',\n    right: '0px',\n    cursor: 'nwse-resize',\n    width: '0',\n    height: '0',\n    borderTop: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid transparent',\n    borderRight: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid #ccc',\n    borderBottom: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid #ccc',\n    borderLeft: (parseInt(this.style.fontSize) / 4 || 3) + 'px solid transparent'\n  });\n\n  parent.appendChild(resizeHandle);\n};\n\n\n/**\n * Clear content and style of the textbox, unbind listeners and\n * reset CSS style.\n */\nTextBox.prototype.destroy = function() {\n  var parent = this.parent,\n      content = this.content,\n      resizeHandle = this.resizeHandle;\n\n  // clear content\n  content.innerText = '';\n\n  // clear styles\n  parent.removeAttribute('style');\n  content.removeAttribute('style');\n\n  domEvent.unbind(content, 'keydown', this.keyHandler);\n  domEvent.unbind(content, 'mousedown', stopPropagation);\n  domEvent.unbind(content, 'input', this.autoResize);\n  domEvent.unbind(content, 'paste', this.handlePaste);\n\n  if (resizeHandle) {\n    resizeHandle.removeAttribute('style');\n\n    domRemove(resizeHandle);\n  }\n\n  domRemove(parent);\n};\n\n\nTextBox.prototype.getValue = function() {\n  return this.content.innerText.trim();\n};\n\n\nTextBox.prototype.getSelection = function() {\n  var selection = window.getSelection(),\n      range = selection.getRangeAt(0);\n\n  return range;\n};\n\n\nTextBox.prototype.setSelection = function(container, offset) {\n  var range = document.createRange();\n\n  if (container === null) {\n    range.selectNodeContents(this.content);\n  } else {\n    range.setStart(container, offset);\n    range.setEnd(container, offset);\n  }\n\n  var selection = window.getSelection();\n\n  selection.removeAllRanges();\n  selection.addRange(range);\n};\n\n// helpers //////////\n\nfunction normalizeEndOfLineSequences(string) {\n  return string.replace(/\\r\\n|\\r|\\n/g, '\\n');\n}","import {\n  bind,\n  find\n} from 'min-dash';\n\nimport TextBox from './TextBox.js';\n\n\n/**\n * A direct editing component that allows users\n * to edit an elements text directly in the diagram\n *\n * @param {EventBus} eventBus the event bus\n */\nexport default function DirectEditing(eventBus, canvas) {\n\n  this._eventBus = eventBus;\n\n  this._providers = [];\n  this._textbox = new TextBox({\n    container: canvas.getContainer(),\n    keyHandler: bind(this._handleKey, this),\n    resizeHandler: bind(this._handleResize, this)\n  });\n}\n\nDirectEditing.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * Register a direct editing provider\n\n * @param {Object} provider the provider, must expose an #activate(element) method that returns\n *                          an activation context ({ bounds: {x, y, width, height }, text }) if\n *                          direct editing is available for the given element.\n *                          Additionally the provider must expose a #update(element, value) method\n *                          to receive direct editing updates.\n */\nDirectEditing.prototype.registerProvider = function(provider) {\n  this._providers.push(provider);\n};\n\n\n/**\n * Returns true if direct editing is currently active\n *\n * @param {djs.model.Base} [element]\n *\n * @return {boolean}\n */\nDirectEditing.prototype.isActive = function(element) {\n  return !!(this._active && (!element || this._active.element === element));\n};\n\n\n/**\n * Cancel direct editing, if it is currently active\n */\nDirectEditing.prototype.cancel = function() {\n  if (!this._active) {\n    return;\n  }\n\n  this._fire('cancel');\n  this.close();\n};\n\n\nDirectEditing.prototype._fire = function(event, context) {\n  this._eventBus.fire('directEditing.' + event, context || { active: this._active });\n};\n\nDirectEditing.prototype.close = function() {\n  this._textbox.destroy();\n\n  this._fire('deactivate');\n\n  this._active = null;\n\n  this.resizable = undefined;\n};\n\n\nDirectEditing.prototype.complete = function() {\n\n  var active = this._active;\n\n  if (!active) {\n    return;\n  }\n\n  var containerBounds,\n      previousBounds = active.context.bounds,\n      newBounds = this.$textbox.getBoundingClientRect(),\n      newText = this.getValue(),\n      previousText = active.context.text;\n\n  if (\n    newText !== previousText ||\n    newBounds.height !== previousBounds.height ||\n    newBounds.width !== previousBounds.width\n  ) {\n    containerBounds = this._textbox.container.getBoundingClientRect();\n\n    active.provider.update(active.element, newText, active.context.text, {\n      x: newBounds.left - containerBounds.left,\n      y: newBounds.top - containerBounds.top,\n      width: newBounds.width,\n      height: newBounds.height\n    });\n  }\n\n  this._fire('complete');\n\n  this.close();\n};\n\n\nDirectEditing.prototype.getValue = function() {\n  return this._textbox.getValue();\n};\n\n\nDirectEditing.prototype._handleKey = function(e) {\n\n  // stop bubble\n  e.stopPropagation();\n\n  var key = e.keyCode || e.charCode;\n\n  // ESC\n  if (key === 27) {\n    e.preventDefault();\n    return this.cancel();\n  }\n\n  // Enter\n  if (key === 13 && !e.shiftKey) {\n    e.preventDefault();\n    return this.complete();\n  }\n};\n\n\nDirectEditing.prototype._handleResize = function(event) {\n  this._fire('resize', event);\n};\n\n\n/**\n * Activate direct editing on the given element\n *\n * @param {Object} ElementDescriptor the descriptor for a shape or connection\n * @return {Boolean} true if the activation was possible\n */\nDirectEditing.prototype.activate = function(element) {\n  if (this.isActive()) {\n    this.cancel();\n  }\n\n  // the direct editing context\n  var context;\n\n  var provider = find(this._providers, function(p) {\n    return ((context = p.activate(element))) ? p : null;\n  });\n\n  // check if activation took place\n  if (context) {\n    this.$textbox = this._textbox.create(\n      context.bounds,\n      context.style,\n      context.text,\n      context.options\n    );\n\n    this._active = {\n      element: element,\n      context: context,\n      provider: provider\n    };\n\n    if (context.options && context.options.resizable) {\n      this.resizable = true;\n    }\n\n    this._fire('activate');\n  }\n\n  return !!context;\n};\n","import InteractionEventsModule from 'diagram-js/lib/features/interaction-events';\n\nimport DirectEditing from './DirectEditing.js';\n\nexport default {\n  __depends__: [\n    InteractionEventsModule\n  ],\n  __init__: [ 'directEditing' ],\n  directEditing: [ 'type', DirectEditing ]\n};","import {\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\nimport {\n  isExpanded\n} from '../../../util/DiUtil';\n\n/**\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n *\n * @typedef {(entry: PopupMenuTarget) => boolean} DifferentTypeValidator\n */\n\n/**\n * Returns true, if an element is from a different type\n * than a target definition. Takes into account the type,\n * event definition type and triggeredByEvent property.\n *\n * @param {Element} element\n *\n * @return {DifferentTypeValidator}\n */\nexport function isDifferentType(element) {\n\n  return function(entry) {\n    var target = entry.target;\n\n    var businessObject = getBusinessObject(element),\n        eventDefinition = businessObject.eventDefinitions && businessObject.eventDefinitions[0];\n\n    var isTypeEqual = businessObject.$type === target.type;\n\n    var isEventDefinitionEqual = (\n      (eventDefinition && eventDefinition.$type) === target.eventDefinitionType\n    );\n\n    var isTriggeredByEventEqual = (\n\n      // coherse to <false>\n      !!target.triggeredByEvent === !!businessObject.triggeredByEvent\n    );\n\n    var isExpandedEqual = (\n      target.isExpanded === undefined ||\n      target.isExpanded === isExpanded(element)\n    );\n\n    return !isTypeEqual || !isEventDefinitionEqual || !isTriggeredByEventEqual || !isExpandedEqual;\n  };\n}\n","/**\n * @typedef { () => string } LabelGetter\n *\n * @typedef { {\n *   label: string | LabelGetter;\n *   actionName: string;\n *   className: string;\n *   target?: {\n *     type: string;\n *     isExpanded?: boolean;\n *     isInterrupting?: boolean;\n *     triggeredByEvent?: boolean;\n *     cancelActivity?: boolean;\n *     eventDefinitionType?: string;\n *     eventDefinitionAttrs?: Record<string, any>\n *   };\n * } } ReplaceOption\n */\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var START_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throwing',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message start event',\n    actionName: 'replace-with-message-start',\n    className: 'bpmn-icon-start-event-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer start event',\n    actionName: 'replace-with-timer-start',\n    className: 'bpmn-icon-start-event-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional start event',\n    actionName: 'replace-with-conditional-start',\n    className: 'bpmn-icon-start-event-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Signal start event',\n    actionName: 'replace-with-signal-start',\n    className: 'bpmn-icon-start-event-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var START_EVENT_SUB_PROCESS = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throwing',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var INTERMEDIATE_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message intermediate catch event',\n    actionName: 'replace-with-message-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-message',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Message intermediate throw event',\n    actionName: 'replace-with-message-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-message',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer intermediate catch event',\n    actionName: 'replace-with-timer-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-timer',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation intermediate throw event',\n    actionName: 'replace-with-escalation-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-escalation',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional intermediate catch event',\n    actionName: 'replace-with-conditional-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-condition',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Link intermediate catch event',\n    actionName: 'replace-with-link-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-link',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:LinkEventDefinition',\n      eventDefinitionAttrs: {\n        name: ''\n      }\n    }\n  },\n  {\n    label: 'Link intermediate throw event',\n    actionName: 'replace-with-link-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-link',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:LinkEventDefinition',\n      eventDefinitionAttrs: {\n        name: ''\n      }\n    }\n  },\n  {\n    label: 'Compensation intermediate throw event',\n    actionName: 'replace-with-compensation-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-compensation',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Signal intermediate catch event',\n    actionName: 'replace-with-signal-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-signal',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Signal intermediate throw event',\n    actionName: 'replace-with-signal-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-signal',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var END_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message end event',\n    actionName: 'replace-with-message-end',\n    className: 'bpmn-icon-end-event-message',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation end event',\n    actionName: 'replace-with-escalation-end',\n    className: 'bpmn-icon-end-event-escalation',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Error end event',\n    actionName: 'replace-with-error-end',\n    className: 'bpmn-icon-end-event-error',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition'\n    }\n  },\n  {\n    label: 'Cancel end event',\n    actionName: 'replace-with-cancel-end',\n    className: 'bpmn-icon-end-event-cancel',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:CancelEventDefinition'\n    }\n  },\n  {\n    label: 'Compensation end event',\n    actionName: 'replace-with-compensation-end',\n    className: 'bpmn-icon-end-event-compensation',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Signal end event',\n    actionName: 'replace-with-signal-end',\n    className: 'bpmn-icon-end-event-signal',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Terminate end event',\n    actionName: 'replace-with-terminate-end',\n    className: 'bpmn-icon-end-event-terminate',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:TerminateEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var GATEWAY = [\n  {\n    label: 'Exclusive gateway',\n    actionName: 'replace-with-exclusive-gateway',\n    className: 'bpmn-icon-gateway-xor',\n    target: {\n      type: 'bpmn:ExclusiveGateway'\n    }\n  },\n  {\n    label: 'Parallel gateway',\n    actionName: 'replace-with-parallel-gateway',\n    className: 'bpmn-icon-gateway-parallel',\n    target: {\n      type: 'bpmn:ParallelGateway'\n    }\n  },\n  {\n    label: 'Inclusive gateway',\n    actionName: 'replace-with-inclusive-gateway',\n    className: 'bpmn-icon-gateway-or',\n    target: {\n      type: 'bpmn:InclusiveGateway'\n    }\n  },\n  {\n    label: 'Complex gateway',\n    actionName: 'replace-with-complex-gateway',\n    className: 'bpmn-icon-gateway-complex',\n    target: {\n      type: 'bpmn:ComplexGateway'\n    }\n  },\n  {\n    label: 'Event-based gateway',\n    actionName: 'replace-with-event-based-gateway',\n    className: 'bpmn-icon-gateway-eventbased',\n    target: {\n      type: 'bpmn:EventBasedGateway',\n      instantiate: false,\n      eventGatewayType: 'Exclusive'\n    }\n  }\n\n  // Gateways deactivated until https://github.com/bpmn-io/bpmn-js/issues/194\n  // {\n  //   label: 'Event based instantiating Gateway',\n  //   actionName: 'replace-with-exclusive-event-based-gateway',\n  //   className: 'bpmn-icon-exclusive-event-based',\n  //   target: {\n  //     type: 'bpmn:EventBasedGateway'\n  //   },\n  //   options: {\n  //     businessObject: { instantiate: true, eventGatewayType: 'Exclusive' }\n  //   }\n  // },\n  // {\n  //   label: 'Parallel Event based instantiating Gateway',\n  //   actionName: 'replace-with-parallel-event-based-instantiate-gateway',\n  //   className: 'bpmn-icon-parallel-event-based-instantiate-gateway',\n  //   target: {\n  //     type: 'bpmn:EventBasedGateway'\n  //   },\n  //   options: {\n  //     businessObject: { instantiate: true, eventGatewayType: 'Parallel' }\n  //   }\n  // }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var SUBPROCESS_EXPANDED = [\n  {\n    label: 'Transaction',\n    actionName: 'replace-with-transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    actionName: 'replace-with-event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var TRANSACTION = [\n  {\n    label: 'Transaction',\n    actionName: 'replace-with-transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Sub-process',\n    actionName: 'replace-with-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    actionName: 'replace-with-event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var EVENT_SUB_PROCESS = TRANSACTION;\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var TASK = [\n  {\n    label: 'Task',\n    actionName: 'replace-with-task',\n    className: 'bpmn-icon-task',\n    target: {\n      type: 'bpmn:Task'\n    }\n  },\n  {\n    label: 'User task',\n    actionName: 'replace-with-user-task',\n    className: 'bpmn-icon-user',\n    target: {\n      type: 'bpmn:UserTask'\n    }\n  },\n  {\n    label: 'Service task',\n    actionName: 'replace-with-service-task',\n    className: 'bpmn-icon-service',\n    target: {\n      type: 'bpmn:ServiceTask'\n    }\n  },\n  {\n    label: 'Send task',\n    actionName: 'replace-with-send-task',\n    className: 'bpmn-icon-send',\n    target: {\n      type: 'bpmn:SendTask'\n    }\n  },\n  {\n    label: 'Receive task',\n    actionName: 'replace-with-receive-task',\n    className: 'bpmn-icon-receive',\n    target: {\n      type: 'bpmn:ReceiveTask'\n    }\n  },\n  {\n    label: 'Manual task',\n    actionName: 'replace-with-manual-task',\n    className: 'bpmn-icon-manual',\n    target: {\n      type: 'bpmn:ManualTask'\n    }\n  },\n  {\n    label: 'Business rule task',\n    actionName: 'replace-with-rule-task',\n    className: 'bpmn-icon-business-rule',\n    target: {\n      type: 'bpmn:BusinessRuleTask'\n    }\n  },\n  {\n    label: 'Script task',\n    actionName: 'replace-with-script-task',\n    className: 'bpmn-icon-script',\n    target: {\n      type: 'bpmn:ScriptTask'\n    }\n  },\n  {\n    label: 'Call activity',\n    actionName: 'replace-with-call-activity',\n    className: 'bpmn-icon-call-activity',\n    target: {\n      type: 'bpmn:CallActivity'\n    }\n  },\n  {\n    label: 'Sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: false\n    }\n  },\n  {\n    label: 'Sub-process (expanded)',\n    actionName: 'replace-with-expanded-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var DATA_OBJECT_REFERENCE = [\n  {\n    label: 'Data store reference',\n    actionName: 'replace-with-data-store-reference',\n    className: 'bpmn-icon-data-store',\n    target: {\n      type: 'bpmn:DataStoreReference'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var DATA_STORE_REFERENCE = [\n  {\n    label: 'Data object reference',\n    actionName: 'replace-with-data-object-reference',\n    className: 'bpmn-icon-data-object',\n    target: {\n      type: 'bpmn:DataObjectReference'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var BOUNDARY_EVENT = [\n  {\n    label: 'Message boundary event',\n    actionName: 'replace-with-message-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-message',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Timer boundary event',\n    actionName: 'replace-with-timer-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-timer',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Escalation boundary event',\n    actionName: 'replace-with-escalation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-escalation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Conditional boundary event',\n    actionName: 'replace-with-conditional-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-condition',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Error boundary event',\n    actionName: 'replace-with-error-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-error',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Cancel boundary event',\n    actionName: 'replace-with-cancel-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-cancel',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:CancelEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Signal boundary event',\n    actionName: 'replace-with-signal-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-signal',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Compensation boundary event',\n    actionName: 'replace-with-compensation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-compensation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Message boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-message-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-message',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Timer boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-timer-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-timer',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Escalation boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-escalation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-escalation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Conditional boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-conditional-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-condition',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Signal boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-signal-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-signal',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      cancelActivity: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var EVENT_SUB_PROCESS_START_EVENT = [\n  {\n    label: 'Message start event',\n    actionName: 'replace-with-message-start',\n    className: 'bpmn-icon-start-event-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Timer start event',\n    actionName: 'replace-with-timer-start',\n    className: 'bpmn-icon-start-event-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Conditional start event',\n    actionName: 'replace-with-conditional-start',\n    className: 'bpmn-icon-start-event-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Signal start event',\n    actionName: 'replace-with-signal-start',\n    className: 'bpmn-icon-start-event-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Error start event',\n    actionName: 'replace-with-error-start',\n    className: 'bpmn-icon-start-event-error',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Escalation start event',\n    actionName: 'replace-with-escalation-start',\n    className: 'bpmn-icon-start-event-escalation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Compensation start event',\n    actionName: 'replace-with-compensation-start',\n    className: 'bpmn-icon-start-event-compensation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Message start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-message-start',\n    className: 'bpmn-icon-start-event-non-interrupting-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Timer start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-timer-start',\n    className: 'bpmn-icon-start-event-non-interrupting-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Conditional start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-conditional-start',\n    className: 'bpmn-icon-start-event-non-interrupting-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Signal start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-signal-start',\n    className: 'bpmn-icon-start-event-non-interrupting-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Escalation start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-escalation-start',\n    className: 'bpmn-icon-start-event-non-interrupting-escalation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      isInterrupting: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var SEQUENCE_FLOW = [\n  {\n    label: 'Sequence flow',\n    actionName: 'replace-with-sequence-flow',\n    className: 'bpmn-icon-connection'\n  },\n  {\n    label: 'Default flow',\n    actionName: 'replace-with-default-flow',\n    className: 'bpmn-icon-default-flow'\n  },\n  {\n    label: 'Conditional flow',\n    actionName: 'replace-with-conditional-flow',\n    className: 'bpmn-icon-conditional-flow'\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var PARTICIPANT = [\n  {\n    label: 'Expanded pool/participant',\n    actionName: 'replace-with-expanded-pool',\n    className: 'bpmn-icon-participant',\n    target: {\n      type: 'bpmn:Participant',\n      isExpanded: true\n    }\n  },\n  {\n    label: function(element) {\n      var label = 'Empty pool/participant';\n\n      if (element.children && element.children.length) {\n        label += ' (removes content)';\n      }\n\n      return label;\n    },\n    actionName: 'replace-with-collapsed-pool',\n\n    // TODO(@janstuemmel): maybe design new icon\n    className: 'bpmn-icon-lane',\n    target: {\n      type: 'bpmn:Participant',\n      isExpanded: false\n    }\n  }\n];\n","export default {\n  'start-event-non-interrupting': `\n  <svg viewBox=\"0 0 2048 2048\" xmlns=\"http://www.w3.org/2000/svg\">\n    <g transform=\"translate(0 995.64)\">\n      <path d=\"m1899 28.357c21.545 567.43-598.38 1023.5-1133.6 835.92-548.09-147.21-801.57-873.95-463.59-1330 302.62-480.3 1071.7-507.54 1407.6-49.847 122.14 153.12 190.07 348.07 189.59 543.91z\" fill=\"none\" stroke=\"currentColor\" stroke-dasharray=\"418.310422, 361.2328165\" stroke-linecap=\"round\" stroke-width=\"100\"/>\n    </g>\n  </svg>`,\n  'intermediate-event-non-interrupting': `\n  <svg viewBox=\"0 0 2048 2048\" xmlns=\"http://www.w3.org/2000/svg\">\n     <g transform=\"translate(0 995.64)\" fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\">\n        <circle cx=\"1024\" cy=\"28.357\" r=\"875\" stroke-dasharray=\"418.310422, 361.2328165\" stroke-width=\"100\"/>\n        <circle cx=\"1024\" cy=\"28.357\" r=\"685\" stroke-dasharray=\"348.31044857,261.23283643\" stroke-dashoffset=\"500\" stroke-width=\"100\"/>\n     </g>\n  </svg>`\n};","import {\n  getBusinessObject,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  isEventSubProcess,\n  isExpanded\n} from '../../util/DiUtil';\n\nimport {\n  isDifferentType\n} from './util/TypeUtil';\n\nimport {\n  forEach,\n  filter,\n  isArray\n} from 'min-dash';\n\nimport * as replaceOptions from '../replace/ReplaceOptions';\nimport { canBeNonInterrupting, getInterruptingProperty } from '../modeling/behavior/util/NonInterruptingUtil';\nimport Icons from './util/Icons';\n\n/**\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('diagram-js/lib/features/Rules').default} Rules\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n * @typedef {import('../copy-paste/ModdleCopy').default} ModdleCopy\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Moddle} Moddle\n *\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuEntries} PopupMenuEntries\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuEntry} PopupMenuEntry\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuEntryAction} PopupMenuEntryAction\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuHeaderEntries} PopupMenuHeaderEntries\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').default} PopupMenuProvider\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n *\n * @typedef {import('./ReplaceOptions').ReplaceOption} ReplaceOption\n */\n\n/**\n * A BPMN-specific popup menu provider.\n *\n * @implements {PopupMenuProvider}\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {PopupMenu} popupMenu\n * @param {Modeling} modeling\n * @param {Moddle} moddle\n * @param {BpmnReplace} bpmnReplace\n * @param {Rules} rules\n * @param {Translate} translate\n * @param {ModdleCopy} moddleCopy\n */\nexport default function ReplaceMenuProvider(\n    bpmnFactory, popupMenu, modeling, moddle,\n    bpmnReplace, rules, translate, moddleCopy) {\n\n  this._bpmnFactory = bpmnFactory;\n  this._popupMenu = popupMenu;\n  this._modeling = modeling;\n  this._moddle = moddle;\n  this._bpmnReplace = bpmnReplace;\n  this._rules = rules;\n  this._translate = translate;\n  this._moddleCopy = moddleCopy;\n\n  this._register();\n}\n\nReplaceMenuProvider.$inject = [\n  'bpmnFactory',\n  'popupMenu',\n  'modeling',\n  'moddle',\n  'bpmnReplace',\n  'rules',\n  'translate',\n  'moddleCopy'\n];\n\nReplaceMenuProvider.prototype._register = function() {\n  this._popupMenu.registerProvider('bpmn-replace', this);\n};\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuEntries}\n */\nReplaceMenuProvider.prototype.getPopupMenuEntries = function(target) {\n\n  var businessObject = target.businessObject;\n\n  var rules = this._rules;\n\n  var filteredReplaceOptions = [];\n\n  if (isArray(target) || !rules.allowed('shape.replace', { element: target })) {\n    return {};\n  }\n\n  var differentType = isDifferentType(target);\n\n  if (is(businessObject, 'bpmn:DataObjectReference')) {\n    return this._createEntries(target, replaceOptions.DATA_OBJECT_REFERENCE);\n  }\n\n  if (is(businessObject, 'bpmn:DataStoreReference') && !is(target.parent, 'bpmn:Collaboration')) {\n    return this._createEntries(target, replaceOptions.DATA_STORE_REFERENCE);\n  }\n\n  // start events outside sub processes\n  if (is(businessObject, 'bpmn:StartEvent') && !is(businessObject.$parent, 'bpmn:SubProcess')) {\n\n    filteredReplaceOptions = filter(replaceOptions.START_EVENT, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // expanded/collapsed pools\n  if (is(businessObject, 'bpmn:Participant')) {\n\n    filteredReplaceOptions = filter(replaceOptions.PARTICIPANT, function(replaceOption) {\n      return isExpanded(target) !== replaceOption.target.isExpanded;\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // start events inside event sub processes\n  if (is(businessObject, 'bpmn:StartEvent') && isEventSubProcess(businessObject.$parent)) {\n    filteredReplaceOptions = filter(replaceOptions.EVENT_SUB_PROCESS_START_EVENT, function(replaceOption) {\n\n      var target = replaceOption.target;\n\n      var isInterrupting = target.isInterrupting !== false;\n\n      var isInterruptingEqual = businessObject.isInterrupting === isInterrupting;\n\n      // filters elements which types and event definition are equal but have have different interrupting types\n      return differentType(replaceOption) || !differentType(replaceOption) && !isInterruptingEqual;\n\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // start events inside sub processes\n  if (is(businessObject, 'bpmn:StartEvent') && !isEventSubProcess(businessObject.$parent)\n      && is(businessObject.$parent, 'bpmn:SubProcess')) {\n    filteredReplaceOptions = filter(replaceOptions.START_EVENT_SUB_PROCESS, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // end events\n  if (is(businessObject, 'bpmn:EndEvent')) {\n\n    filteredReplaceOptions = filter(replaceOptions.END_EVENT, function(replaceOption) {\n      var target = replaceOption.target;\n\n      // hide cancel end events outside transactions\n      if (target.eventDefinitionType == 'bpmn:CancelEventDefinition' && !is(businessObject.$parent, 'bpmn:Transaction')) {\n        return false;\n      }\n\n      return differentType(replaceOption);\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // boundary events\n  if (is(businessObject, 'bpmn:BoundaryEvent')) {\n\n    filteredReplaceOptions = filter(replaceOptions.BOUNDARY_EVENT, function(replaceOption) {\n\n      var target = replaceOption.target;\n\n      if (target.eventDefinitionType == 'bpmn:CancelEventDefinition' &&\n         !is(businessObject.attachedToRef, 'bpmn:Transaction')) {\n        return false;\n      }\n      var cancelActivity = target.cancelActivity !== false;\n\n      var isCancelActivityEqual = businessObject.cancelActivity == cancelActivity;\n\n      return differentType(replaceOption) || !differentType(replaceOption) && !isCancelActivityEqual;\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // intermediate events\n  if (is(businessObject, 'bpmn:IntermediateCatchEvent') ||\n      is(businessObject, 'bpmn:IntermediateThrowEvent')) {\n\n    filteredReplaceOptions = filter(replaceOptions.INTERMEDIATE_EVENT, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // gateways\n  if (is(businessObject, 'bpmn:Gateway')) {\n\n    filteredReplaceOptions = filter(replaceOptions.GATEWAY, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // transactions\n  if (is(businessObject, 'bpmn:Transaction')) {\n\n    filteredReplaceOptions = filter(replaceOptions.TRANSACTION, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // expanded event sub processes\n  if (isEventSubProcess(businessObject) && isExpanded(target)) {\n\n    filteredReplaceOptions = filter(replaceOptions.EVENT_SUB_PROCESS, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // expanded sub processes\n  if (is(businessObject, 'bpmn:SubProcess') && isExpanded(target)) {\n\n    filteredReplaceOptions = filter(replaceOptions.SUBPROCESS_EXPANDED, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // collapsed ad hoc sub processes\n  if (is(businessObject, 'bpmn:AdHocSubProcess') && !isExpanded(target)) {\n\n    filteredReplaceOptions = filter(replaceOptions.TASK, function(replaceOption) {\n\n      var target = replaceOption.target;\n\n      var isTargetSubProcess = target.type === 'bpmn:SubProcess';\n\n      var isTargetExpanded = target.isExpanded === true;\n\n      return isDifferentType(target, target) && (!isTargetSubProcess || isTargetExpanded);\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // sequence flows\n  if (is(businessObject, 'bpmn:SequenceFlow')) {\n    return this._createSequenceFlowEntries(target, replaceOptions.SEQUENCE_FLOW);\n  }\n\n  // flow nodes\n  if (is(businessObject, 'bpmn:FlowNode')) {\n    filteredReplaceOptions = filter(replaceOptions.TASK, differentType);\n\n    // collapsed sub process cannot be replaced with itself\n    if (is(businessObject, 'bpmn:SubProcess') && !isExpanded(target)) {\n      filteredReplaceOptions = filter(filteredReplaceOptions, function(replaceOption) {\n        return replaceOption.label !== 'Sub-process (collapsed)';\n      });\n    }\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  return {};\n};\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype.getPopupMenuHeaderEntries = function(target) {\n\n  var headerEntries = {};\n\n  if (is(target, 'bpmn:Activity') && !isEventSubProcess(target)) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getLoopCharacteristicsHeaderEntries(target)\n    };\n  }\n\n  if (is(target, 'bpmn:DataObjectReference')) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getCollectionHeaderEntries(target)\n    };\n  }\n\n  if (is(target, 'bpmn:Participant')) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getParticipantMultiplicityHeaderEntries(target)\n    };\n  }\n\n  if (is(target, 'bpmn:SubProcess') &&\n      !is(target, 'bpmn:Transaction') &&\n      !isEventSubProcess(target)) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getAdHocHeaderEntries(target)\n    };\n  }\n\n  if (canBeNonInterrupting(target)) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getNonInterruptingHeaderEntries(target)\n    };\n  }\n\n  return headerEntries;\n};\n\n\n/**\n * Create popup menu entries for the given target.\n *\n * @param  {PopupMenuTarget} target\n * @param  {ReplaceOption[]} replaceOptions\n *\n * @return {PopupMenuEntries}\n */\nReplaceMenuProvider.prototype._createEntries = function(target, replaceOptions) {\n  var entries = {};\n\n  var self = this;\n\n  forEach(replaceOptions, function(replaceOption) {\n    entries[ replaceOption.actionName ] = self._createEntry(replaceOption, target);\n  });\n\n  return entries;\n};\n\n/**\n * Creates popup menu entries for the given sequence flow.\n *\n * @param  {PopupMenuTarget} target\n * @param  {ReplaceOption[]} replaceOptions\n *\n * @return {PopupMenuEntries}\n */\nReplaceMenuProvider.prototype._createSequenceFlowEntries = function(target, replaceOptions) {\n\n  var businessObject = getBusinessObject(target);\n\n  var entries = {};\n\n  var modeling = this._modeling,\n      moddle = this._moddle;\n\n  var self = this;\n\n  forEach(replaceOptions, function(replaceOption) {\n\n    switch (replaceOption.actionName) {\n    case 'replace-with-default-flow':\n      if (businessObject.sourceRef.default !== businessObject &&\n            (is(businessObject.sourceRef, 'bpmn:ExclusiveGateway') ||\n             is(businessObject.sourceRef, 'bpmn:InclusiveGateway') ||\n             is(businessObject.sourceRef, 'bpmn:ComplexGateway') ||\n             is(businessObject.sourceRef, 'bpmn:Activity'))) {\n\n        entries = {\n          ...entries,\n          [ replaceOption.actionName ]: self._createEntry(replaceOption, target, function() {\n            modeling.updateProperties(target.source, { default: businessObject });\n          })\n        };\n      }\n      break;\n    case 'replace-with-conditional-flow':\n      if (!businessObject.conditionExpression && is(businessObject.sourceRef, 'bpmn:Activity')) {\n\n        entries = {\n          ...entries,\n          [ replaceOption.actionName ]: self._createEntry(replaceOption, target, function() {\n            var conditionExpression = moddle.create('bpmn:FormalExpression', { body: '' });\n\n            modeling.updateProperties(target, { conditionExpression: conditionExpression });\n          })\n        };\n      }\n      break;\n    default:\n\n      // conditional flow -> sequence flow\n      if (is(businessObject.sourceRef, 'bpmn:Activity') && businessObject.conditionExpression) {\n        entries = {\n          ...entries,\n          [ replaceOption.actionName ]: self._createEntry(replaceOption, target, function() {\n            modeling.updateProperties(target, { conditionExpression: undefined });\n          })\n        };\n      }\n\n      // default flow -> sequence flow\n      if ((is(businessObject.sourceRef, 'bpmn:ExclusiveGateway') ||\n           is(businessObject.sourceRef, 'bpmn:InclusiveGateway') ||\n           is(businessObject.sourceRef, 'bpmn:ComplexGateway') ||\n           is(businessObject.sourceRef, 'bpmn:Activity')) &&\n           businessObject.sourceRef.default === businessObject) {\n        entries = {\n          ...entries,\n          [ replaceOption.actionName ]: self._createEntry(replaceOption, target, function() {\n            modeling.updateProperties(target.source, { default: undefined });\n          })\n        };\n      }\n    }\n  });\n\n  return entries;\n};\n\n/**\n * Create a popup menu entry for the given replace option.\n *\n * @param  {ReplaceOption} replaceOption\n * @param  {PopupMenuTarget} target\n * @param  {PopupMenuEntryAction} [action]\n *\n * @return {PopupMenuEntry}\n */\nReplaceMenuProvider.prototype._createEntry = function(replaceOption, target, action) {\n  var translate = this._translate;\n  var replaceElement = this._bpmnReplace.replaceElement;\n\n  var replaceAction = function() {\n    return replaceElement(target, replaceOption.target);\n  };\n\n  var label = replaceOption.label;\n  if (label && typeof label === 'function') {\n    label = label(target);\n  }\n\n  action = action || replaceAction;\n\n  return {\n    label: translate(label),\n    className: replaceOption.className,\n    action: action\n  };\n};\n\n/**\n * Get popup menu header entries for the loop characteristics of the given BPMN element.\n *\n * @param  {PopupMenuTarget} target\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype._getLoopCharacteristicsHeaderEntries = function(target) {\n\n  var self = this;\n  var translate = this._translate;\n\n  function toggleLoopEntry(event, entry) {\n\n    // remove\n    if (entry.active) {\n      self._modeling.updateProperties(target, { loopCharacteristics: undefined });\n      return;\n    }\n\n    const currentLoopCharacteristics = target.businessObject.get('loopCharacteristics'),\n          newLoopCharacteristics = self._moddle.create(entry.options.loopCharacteristics);\n\n    // copy old properties\n    if (currentLoopCharacteristics) {\n      self._moddleCopy.copyElement(currentLoopCharacteristics, newLoopCharacteristics);\n    }\n\n    // update `isSequential` property\n    newLoopCharacteristics.set('isSequential', entry.options.isSequential);\n\n    self._modeling.updateProperties(target, { loopCharacteristics: newLoopCharacteristics });\n  }\n\n  var businessObject = getBusinessObject(target),\n      loopCharacteristics = businessObject.loopCharacteristics;\n\n  var isSequential,\n      isLoop,\n      isParallel;\n\n  if (loopCharacteristics) {\n    isSequential = loopCharacteristics.isSequential;\n    isLoop = loopCharacteristics.isSequential === undefined;\n    isParallel = loopCharacteristics.isSequential !== undefined && !loopCharacteristics.isSequential;\n  }\n\n\n  return {\n    'toggle-parallel-mi' : {\n      className: 'bpmn-icon-parallel-mi-marker',\n      title: translate('Parallel multi-instance'),\n      active: isParallel,\n      action: toggleLoopEntry,\n      options: {\n        loopCharacteristics: 'bpmn:MultiInstanceLoopCharacteristics',\n        isSequential: false\n      }\n    },\n    'toggle-sequential-mi': {\n      className: 'bpmn-icon-sequential-mi-marker',\n      title: translate('Sequential multi-instance'),\n      active: isSequential,\n      action: toggleLoopEntry,\n      options: {\n        loopCharacteristics: 'bpmn:MultiInstanceLoopCharacteristics',\n        isSequential: true\n      }\n    },\n    'toggle-loop': {\n      className: 'bpmn-icon-loop-marker',\n      title: translate('Loop'),\n      active: isLoop,\n      action: toggleLoopEntry,\n      options: {\n        loopCharacteristics: 'bpmn:StandardLoopCharacteristics'\n      }\n    }\n  };\n};\n\n/**\n * Get popup menu header entries for the collection property of the given BPMN element.\n *\n * @param  {PopupMenuTarget} target\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype._getCollectionHeaderEntries = function(target) {\n\n  var self = this;\n  var translate = this._translate;\n\n  var dataObject = target.businessObject.dataObjectRef;\n\n  if (!dataObject) {\n    return {};\n  }\n\n  function toggleIsCollection(event, entry) {\n    self._modeling.updateModdleProperties(\n      target,\n      dataObject,\n      { isCollection: !entry.active });\n  }\n\n  var isCollection = dataObject.isCollection;\n\n  return {\n    'toggle-is-collection': {\n      className: 'bpmn-icon-parallel-mi-marker',\n      title: translate('Collection'),\n      active: isCollection,\n      action: toggleIsCollection,\n    }\n  };\n};\n\n/**\n * Get popup menu header entries for the participant multiplicity property of the given BPMN element.\n *\n * @param  {PopupMenuTarget} target\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype._getParticipantMultiplicityHeaderEntries = function(target) {\n\n  var self = this;\n  var bpmnFactory = this._bpmnFactory;\n  var translate = this._translate;\n\n  function toggleParticipantMultiplicity(event, entry) {\n    var isActive = entry.active;\n    var participantMultiplicity;\n\n    if (!isActive) {\n      participantMultiplicity = bpmnFactory.create('bpmn:ParticipantMultiplicity');\n    }\n\n    self._modeling.updateProperties(\n      target,\n      { participantMultiplicity: participantMultiplicity });\n  }\n\n  var participantMultiplicity = target.businessObject.participantMultiplicity;\n\n  return {\n    'toggle-participant-multiplicity': {\n      className: 'bpmn-icon-parallel-mi-marker',\n      title: translate('Participant multiplicity'),\n      active: !!participantMultiplicity,\n      action: toggleParticipantMultiplicity,\n    }\n  };\n};\n\n/**\n * Get popup menu header entries for the ad-hoc property of the given BPMN element.\n *\n * @param  {PopupMenuTarget} element\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype._getAdHocHeaderEntries = function(element) {\n  var translate = this._translate;\n  var businessObject = getBusinessObject(element);\n\n  var isAdHoc = is(businessObject, 'bpmn:AdHocSubProcess');\n\n  var replaceElement = this._bpmnReplace.replaceElement;\n\n  return {\n    'toggle-adhoc': {\n      className: 'bpmn-icon-ad-hoc-marker',\n      title: translate('Ad-hoc'),\n      active: isAdHoc,\n      action: function(event, entry) {\n        if (isAdHoc) {\n          return replaceElement(element, { type: 'bpmn:SubProcess' }, {\n            autoResize: false,\n            layoutConnection: false\n          });\n        } else {\n          return replaceElement(element, { type: 'bpmn:AdHocSubProcess' }, {\n            autoResize: false,\n            layoutConnection: false\n          });\n        }\n      }\n    }\n  };\n};\n\n\nReplaceMenuProvider.prototype._getNonInterruptingHeaderEntries = function(element) {\n  const translate = this._translate;\n  const businessObject = getBusinessObject(element);\n  const self = this;\n\n  const interruptingProperty = getInterruptingProperty(element);\n\n  const icon = is(element, 'bpmn:BoundaryEvent') ? Icons['intermediate-event-non-interrupting'] : Icons['start-event-non-interrupting'];\n\n  const isNonInterrupting = !businessObject[interruptingProperty];\n\n  return {\n    'toggle-non-interrupting': {\n      imageHtml: icon,\n      title: translate('Toggle non-interrupting'),\n      active: isNonInterrupting,\n      action: function() {\n        self._modeling.updateProperties(element, {\n          [interruptingProperty]: !!isNonInterrupting\n        });\n      }\n    }\n  };\n};","import PopupMenuModule from 'diagram-js/lib/features/popup-menu';\nimport ReplaceModule from '../replace';\n\nimport ReplaceMenuProvider from './ReplaceMenuProvider';\nimport AutoPlaceModule from '../auto-place';\n\nexport default {\n  __depends__: [\n    PopupMenuModule,\n    ReplaceModule,\n    AutoPlaceModule\n  ],\n  __init__: [\n    'replaceMenuProvider'\n  ],\n  replaceMenuProvider: [ 'type', ReplaceMenuProvider ]\n};","import {\n  assign,\n  forEach,\n  isArray,\n  every\n} from 'min-dash';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isHorizontal,\n  isEventSubProcess\n} from '../../util/DiUtil';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  getChildLanes\n} from '../modeling/util/LaneUtil';\n\nimport {\n  hasPrimaryModifier\n} from 'diagram-js/lib/util/Mouse';\n\n/**\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPad').default} ContextPad\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('../modeling/ElementFactory').default} ElementFactory\n * @typedef {import('diagram-js/lib/features/connect/Connect').default} Connect\n * @typedef {import('diagram-js/lib/features/create/Create').default} Create\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('diagram-js/lib/features/canvas/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPadProvider').default<Element>} BaseContextPadProvider\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPadProvider').ContextPadEntries} ContextPadEntries\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPadProvider').ContextPadEntry} ContextPadEntry\n *\n * @typedef { { autoPlace?: boolean; } } ContextPadConfig\n */\n\n/**\n * BPMN-specific context pad provider.\n *\n * @implements {BaseContextPadProvider}\n *\n * @param {ContextPadConfig} config\n * @param {Injector} injector\n * @param {EventBus} eventBus\n * @param {ContextPad} contextPad\n * @param {Modeling} modeling\n * @param {ElementFactory} elementFactory\n * @param {Connect} connect\n * @param {Create} create\n * @param {PopupMenu} popupMenu\n * @param {Canvas} canvas\n * @param {Rules} rules\n * @param {Translate} translate\n */\nexport default function ContextPadProvider(\n    config, injector, eventBus,\n    contextPad, modeling, elementFactory,\n    connect, create, popupMenu,\n    canvas, rules, translate, appendPreview) {\n\n  config = config || {};\n\n  contextPad.registerProvider(this);\n\n  this._contextPad = contextPad;\n\n  this._modeling = modeling;\n\n  this._elementFactory = elementFactory;\n  this._connect = connect;\n  this._create = create;\n  this._popupMenu = popupMenu;\n  this._canvas = canvas;\n  this._rules = rules;\n  this._translate = translate;\n  this._eventBus = eventBus;\n  this._appendPreview = appendPreview;\n\n  if (config.autoPlace !== false) {\n    this._autoPlace = injector.get('autoPlace', false);\n  }\n\n  eventBus.on('create.end', 250, function(event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (!hasPrimaryModifier(event) || !contextPad.isOpen(shape)) {\n      return;\n    }\n\n    var entries = contextPad.getEntries(shape);\n\n    if (entries.replace) {\n      entries.replace.action.click(event, shape);\n    }\n  });\n\n  eventBus.on('contextPad.close', function() {\n    appendPreview.cleanUp();\n  });\n}\n\nContextPadProvider.$inject = [\n  'config.contextPad',\n  'injector',\n  'eventBus',\n  'contextPad',\n  'modeling',\n  'elementFactory',\n  'connect',\n  'create',\n  'popupMenu',\n  'canvas',\n  'rules',\n  'translate',\n  'appendPreview'\n];\n\n/**\n * @param {Element[]} elements\n *\n * @return {ContextPadEntries}\n */\nContextPadProvider.prototype.getMultiElementContextPadEntries = function(elements) {\n  var modeling = this._modeling;\n\n  var actions = {};\n\n  if (this._isDeleteAllowed(elements)) {\n    assign(actions, {\n      'delete': {\n        group: 'edit',\n        className: 'bpmn-icon-trash',\n        title: this._translate('Delete'),\n        action: {\n          click: function(event, elements) {\n            modeling.removeElements(elements.slice());\n          }\n        }\n      }\n    });\n  }\n\n  return actions;\n};\n\n/**\n * @param {Element[]} elements\n *\n * @return {boolean}\n */\nContextPadProvider.prototype._isDeleteAllowed = function(elements) {\n\n  var baseAllowed = this._rules.allowed('elements.delete', {\n    elements: elements\n  });\n\n  if (isArray(baseAllowed)) {\n    return every(baseAllowed, function(element) {\n      return includes(baseAllowed, element);\n    });\n  }\n\n  return baseAllowed;\n};\n\n/**\n * @param {Element} element\n *\n * @return {ContextPadEntries}\n */\nContextPadProvider.prototype.getContextPadEntries = function(element) {\n  var contextPad = this._contextPad,\n      modeling = this._modeling,\n      elementFactory = this._elementFactory,\n      connect = this._connect,\n      create = this._create,\n      popupMenu = this._popupMenu,\n      rules = this._rules,\n      autoPlace = this._autoPlace,\n      translate = this._translate,\n      appendPreview = this._appendPreview;\n\n  var actions = {};\n\n  if (element.type === 'label') {\n    return actions;\n  }\n\n  var businessObject = element.businessObject;\n\n  function startConnect(event, element) {\n    connect.start(event, element);\n  }\n\n  function removeElement(e, element) {\n    modeling.removeElements([ element ]);\n  }\n\n  function getReplaceMenuPosition(element) {\n\n    var Y_OFFSET = 5;\n\n    var pad = contextPad.getPad(element).html;\n\n    var padRect = pad.getBoundingClientRect();\n\n    var pos = {\n      x: padRect.left,\n      y: padRect.bottom + Y_OFFSET\n    };\n\n    return pos;\n  }\n\n  /**\n   * Create an append action.\n   *\n   * @param {string} type\n   * @param {string} className\n   * @param {string} title\n   * @param {Object} [options]\n   *\n   * @return {ContextPadEntry}\n   */\n  function appendAction(type, className, title, options) {\n\n    function appendStart(event, element) {\n\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n\n      create.start(event, shape, {\n        source: element\n      });\n    }\n\n    var append = autoPlace ? function(_, element) {\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n\n      autoPlace.append(element, shape);\n    } : appendStart;\n\n    var previewAppend = autoPlace ? function(_, element) {\n\n      // mouseover\n      appendPreview.create(element, type, options);\n\n      return () => {\n\n        // mouseout\n        appendPreview.cleanUp();\n      };\n    } : null;\n\n    return {\n      group: 'model',\n      className: className,\n      title: title,\n      action: {\n        dragstart: appendStart,\n        click: append,\n        hover: previewAppend\n      }\n    };\n  }\n\n  function splitLaneHandler(count) {\n\n    return function(_, element) {\n\n      // actual split\n      modeling.splitLane(element, count);\n\n      // refresh context pad after split to\n      // get rid of split icons\n      contextPad.open(element, true);\n    };\n  }\n\n\n  if (isAny(businessObject, [ 'bpmn:Lane', 'bpmn:Participant' ]) && isExpanded(element)) {\n\n    var childLanes = getChildLanes(element);\n\n    assign(actions, {\n      'lane-insert-above': {\n        group: 'lane-insert-above',\n        className: 'bpmn-icon-lane-insert-above',\n        title: translate('Add lane above'),\n        action: {\n          click: function(event, element) {\n            modeling.addLane(element, 'top');\n          }\n        }\n      }\n    });\n\n    if (childLanes.length < 2) {\n\n      if (isHorizontal(element) ? element.height >= 120 : element.width >= 120) {\n        assign(actions, {\n          'lane-divide-two': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-two',\n            title: translate('Divide into two lanes'),\n            action: {\n              click: splitLaneHandler(2)\n            }\n          }\n        });\n      }\n\n      if (isHorizontal(element) ? element.height >= 180 : element.width >= 180) {\n        assign(actions, {\n          'lane-divide-three': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-three',\n            title: translate('Divide into three lanes'),\n            action: {\n              click: splitLaneHandler(3)\n            }\n          }\n        });\n      }\n    }\n\n    assign(actions, {\n      'lane-insert-below': {\n        group: 'lane-insert-below',\n        className: 'bpmn-icon-lane-insert-below',\n        title: translate('Add lane below'),\n        action: {\n          click: function(event, element) {\n            modeling.addLane(element, 'bottom');\n          }\n        }\n      }\n    });\n\n  }\n\n  if (is(businessObject, 'bpmn:FlowNode')) {\n\n    if (is(businessObject, 'bpmn:EventBasedGateway')) {\n\n      assign(actions, {\n        'append.receive-task': appendAction(\n          'bpmn:ReceiveTask',\n          'bpmn-icon-receive-task',\n          translate('Append receive task')\n        ),\n        'append.message-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-message',\n          translate('Append message intermediate catch event'),\n          { eventDefinitionType: 'bpmn:MessageEventDefinition' }\n        ),\n        'append.timer-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-timer',\n          translate('Append timer intermediate catch event'),\n          { eventDefinitionType: 'bpmn:TimerEventDefinition' }\n        ),\n        'append.condition-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-condition',\n          translate('Append conditional intermediate catch event'),\n          { eventDefinitionType: 'bpmn:ConditionalEventDefinition' }\n        ),\n        'append.signal-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-signal',\n          translate('Append signal intermediate catch event'),\n          { eventDefinitionType: 'bpmn:SignalEventDefinition' }\n        )\n      });\n    } else\n\n    if (isEventType(businessObject, 'bpmn:BoundaryEvent', 'bpmn:CompensateEventDefinition')) {\n\n      assign(actions, {\n        'append.compensation-activity':\n            appendAction(\n              'bpmn:Task',\n              'bpmn-icon-task',\n              translate('Append compensation activity'),\n              {\n                isForCompensation: true\n              }\n            )\n      });\n    } else\n\n    if (!is(businessObject, 'bpmn:EndEvent') &&\n        !businessObject.isForCompensation &&\n        !isEventType(businessObject, 'bpmn:IntermediateThrowEvent', 'bpmn:LinkEventDefinition') &&\n        !isEventSubProcess(businessObject)) {\n\n      assign(actions, {\n        'append.end-event': appendAction(\n          'bpmn:EndEvent',\n          'bpmn-icon-end-event-none',\n          translate('Append end event')\n        ),\n        'append.gateway': appendAction(\n          'bpmn:ExclusiveGateway',\n          'bpmn-icon-gateway-none',\n          translate('Append gateway')\n        ),\n        'append.append-task': appendAction(\n          'bpmn:Task',\n          'bpmn-icon-task',\n          translate('Append task')\n        ),\n        'append.intermediate-event': appendAction(\n          'bpmn:IntermediateThrowEvent',\n          'bpmn-icon-intermediate-event-none',\n          translate('Append intermediate/boundary event')\n        )\n      });\n    }\n  }\n\n  if (!popupMenu.isEmpty(element, 'bpmn-replace')) {\n\n    // Replace menu entry\n    assign(actions, {\n      'replace': {\n        group: 'edit',\n        className: 'bpmn-icon-screw-wrench',\n        title: translate('Change element'),\n        action: {\n          click: function(event, element) {\n\n            var position = assign(getReplaceMenuPosition(element), {\n              cursor: { x: event.x, y: event.y }\n            });\n\n            popupMenu.open(element, 'bpmn-replace', position, {\n              title: translate('Change element'),\n              width: 300,\n              search: true\n            });\n          }\n        }\n      }\n    });\n  }\n\n  if (is(businessObject, 'bpmn:SequenceFlow')) {\n    assign(actions, {\n      'append.text-annotation': appendAction(\n        'bpmn:TextAnnotation',\n        'bpmn-icon-text-annotation',\n        translate('Add text annotation')\n      )\n    });\n  }\n\n  if (\n    isAny(businessObject, [\n      'bpmn:FlowNode',\n      'bpmn:InteractionNode',\n      'bpmn:DataObjectReference',\n      'bpmn:DataStoreReference',\n    ])\n  ) {\n    assign(actions, {\n      'append.text-annotation': appendAction(\n        'bpmn:TextAnnotation',\n        'bpmn-icon-text-annotation',\n        translate('Add text annotation')\n      ),\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect to other element'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect,\n        },\n      },\n    });\n  }\n\n  if (is(businessObject, 'bpmn:TextAnnotation')) {\n    assign(actions, {\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using association'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect,\n        },\n      },\n    });\n  }\n\n  if (isAny(businessObject, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ])) {\n    assign(actions, {\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using data input association'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect\n        }\n      }\n    });\n  }\n\n  if (is(businessObject, 'bpmn:Group')) {\n    assign(actions, {\n      'append.text-annotation': appendAction(\n        'bpmn:TextAnnotation',\n        'bpmn-icon-text-annotation',\n        translate('Add text annotation')\n      )\n    });\n  }\n\n  // delete element entry, only show if allowed by rules\n  var deleteAllowed = rules.allowed('elements.delete', { elements: [ element ] });\n\n  if (isArray(deleteAllowed)) {\n\n    // was the element returned as a deletion candidate?\n    deleteAllowed = deleteAllowed[0] === element;\n  }\n\n  if (deleteAllowed) {\n    assign(actions, {\n      'delete': {\n        group: 'edit',\n        className: 'bpmn-icon-trash',\n        title: translate('Delete'),\n        action: {\n          click: removeElement\n        }\n      }\n    });\n  }\n\n  return actions;\n};\n\n\n// helpers /////////\n\n/**\n * @param {ModdleElement} businessObject\n * @param {string} type\n * @param {string} eventDefinitionType\n *\n * @return {boolean}\n */\nfunction isEventType(businessObject, type, eventDefinitionType) {\n\n  var isType = businessObject.$instanceOf(type);\n  var isDefinition = false;\n\n  var definitions = businessObject.eventDefinitions || [];\n  forEach(definitions, function(def) {\n    if (def.$type === eventDefinitionType) {\n      isDefinition = true;\n    }\n  });\n\n  return isType && isDefinition;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}","import AppendPreviewModule from '../append-preview';\nimport DirectEditingModule from 'diagram-js-direct-editing';\nimport ContextPadModule from 'diagram-js/lib/features/context-pad';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport ConnectModule from 'diagram-js/lib/features/connect';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport PopupMenuModule from '../popup-menu';\n\nimport ContextPadProvider from './ContextPadProvider';\n\nexport default {\n  __depends__: [\n    AppendPreviewModule,\n    DirectEditingModule,\n    ContextPadModule,\n    SelectionModule,\n    ConnectModule,\n    CreateModule,\n    PopupMenuModule\n  ],\n  __init__: [ 'contextPadProvider' ],\n  contextPadProvider: [ 'type', ContextPadProvider ]\n};","import {\r\n  sortBy,\r\n  forEach,\r\n  isArray\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../../util/Types').Axis} Axis\r\n * @typedef {import('../../util/Types').Dimension} Dimension\r\n * @typedef {import('../../util/Types').Rect} Rect\r\n *\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n *\r\n * @typedef { {\r\n *   min: number;\r\n *   max: number;\r\n * } } Range\r\n *\r\n * @typedef { {\r\n *   elements: Element[];\r\n *   range: Range;\r\n * } } Group\r\n */\r\n\r\nvar AXIS_DIMENSIONS = {\r\n  horizontal: [ 'x', 'width' ],\r\n  vertical: [ 'y', 'height' ]\r\n};\r\n\r\nvar THRESHOLD = 5;\r\n\r\n\r\n/**\r\n * Groups and filters elements and then trigger even distribution.\r\n *\r\n * @param {Modeling} modeling\r\n * @param {Rules} rules\r\n */\r\nexport default function DistributeElements(modeling, rules) {\r\n  this._modeling = modeling;\r\n\r\n  this._filters = [];\r\n\r\n  this.registerFilter(function(elements) {\r\n    var allowed = rules.allowed('elements.distribute', { elements: elements });\r\n\r\n    if (isArray(allowed)) {\r\n      return allowed;\r\n    }\r\n\r\n    return allowed ? elements : [];\r\n  });\r\n}\r\n\r\nDistributeElements.$inject = [ 'modeling', 'rules' ];\r\n\r\n\r\n/**\r\n * Registers filter functions that allow external parties to filter\r\n * out certain elements.\r\n *\r\n * @param {(distributableElements: Element[], axis: Axis, dimension: Dimension) => Element[]} filterFn\r\n */\r\nDistributeElements.prototype.registerFilter = function(filterFn) {\r\n  if (typeof filterFn !== 'function') {\r\n    throw new Error('the filter has to be a function');\r\n  }\r\n\r\n  this._filters.push(filterFn);\r\n};\r\n\r\n/**\r\n * Distributes the elements with a given orientation\r\n *\r\n * @param {Element[]} elements\r\n * @param {string} orientation\r\n */\r\nDistributeElements.prototype.trigger = function(elements, orientation) {\r\n  var modeling = this._modeling;\r\n\r\n  var groups,\r\n      distributableElements;\r\n\r\n  if (elements.length < 3) {\r\n    return;\r\n  }\r\n\r\n  this._setOrientation(orientation);\r\n\r\n  distributableElements = this._filterElements(elements);\r\n\r\n  groups = this._createGroups(distributableElements);\r\n\r\n  // nothing to distribute\r\n  if (groups.length <= 2) {\r\n    return;\r\n  }\r\n\r\n  modeling.distributeElements(groups, this._axis, this._dimension);\r\n\r\n  return groups;\r\n};\r\n\r\n/**\r\n * Filters the elements with provided filters by external parties\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {Element[]}\r\n */\r\nDistributeElements.prototype._filterElements = function(elements) {\r\n  var filters = this._filters,\r\n      axis = this._axis,\r\n      dimension = this._dimension,\r\n      distributableElements = [].concat(elements);\r\n\r\n  if (!filters.length) {\r\n    return elements;\r\n  }\r\n\r\n  forEach(filters, function(filterFn) {\r\n    distributableElements = filterFn(distributableElements, axis, dimension);\r\n  });\r\n\r\n  return distributableElements;\r\n};\r\n\r\n\r\n/**\r\n * Create range (min, max) groups. Also tries to group elements\r\n * together that share the same range.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n *   const groups = [\r\n *     {\r\n *       range: { min: 100, max: 200 },\r\n *       elements: [ { id: 'shape1', ... } ]\r\n *     }\r\n *   ]\r\n * ```\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {Group[]}\r\n */\r\nDistributeElements.prototype._createGroups = function(elements) {\r\n  var rangeGroups = [],\r\n      self = this,\r\n      axis = this._axis,\r\n      dimension = this._dimension;\r\n\r\n  if (!axis) {\r\n    throw new Error('must have a defined \"axis\" and \"dimension\"');\r\n  }\r\n\r\n  // sort by 'left->right' or 'top->bottom'\r\n  var sortedElements = sortBy(elements, axis);\r\n\r\n  forEach(sortedElements, function(element, idx) {\r\n    var elementRange = self._findRange(element, axis, dimension),\r\n        range;\r\n\r\n    var previous = rangeGroups[rangeGroups.length - 1];\r\n\r\n    if (previous && self._hasIntersection(previous.range, elementRange)) {\r\n      rangeGroups[rangeGroups.length - 1].elements.push(element);\r\n    } else {\r\n      range = { range: elementRange, elements: [ element ] };\r\n\r\n      rangeGroups.push(range);\r\n    }\r\n  });\r\n\r\n  return rangeGroups;\r\n};\r\n\r\n\r\n/**\r\n * Maps a direction to the according axis and dimension.\r\n *\r\n * @param {'horizontal' | 'vertical'} direction 'horizontal' or 'vertical'\r\n */\r\nDistributeElements.prototype._setOrientation = function(direction) {\r\n  var orientation = AXIS_DIMENSIONS[direction];\r\n\r\n  this._axis = orientation[0];\r\n  this._dimension = orientation[1];\r\n};\r\n\r\n\r\n/**\r\n * Checks if the two ranges intercept each other.\r\n *\r\n * @param {Range} rangeA\r\n * @param {Range} rangeB\r\n *\r\n * @return {boolean}\r\n */\r\nDistributeElements.prototype._hasIntersection = function(rangeA, rangeB) {\r\n  return Math.max(rangeA.min, rangeA.max) >= Math.min(rangeB.min, rangeB.max) &&\r\n         Math.min(rangeA.min, rangeA.max) <= Math.max(rangeB.min, rangeB.max);\r\n};\r\n\r\n\r\n/**\r\n * Returns the min and max values for an element\r\n *\r\n * @param {Element} element\r\n *\r\n * @return {Range}\r\n */\r\nDistributeElements.prototype._findRange = function(element) {\r\n  var axis = element[this._axis],\r\n      dimension = element[this._dimension];\r\n\r\n  return {\r\n    min: axis + THRESHOLD,\r\n    max: axis + dimension - THRESHOLD\r\n  };\r\n};\r\n","import DistributeElements from './DistributeElements';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'distributeElements' ],\r\n  distributeElements: [ 'type', DistributeElements ]\r\n};\r\n","import inherits from 'inherits-browser';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\nimport { getParents } from 'diagram-js/lib/util/Elements';\n\nimport {\n  filter\n} from 'min-dash';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * Registers element exclude filters for elements that currently do not support\n * distribution.\n *\n * @param {EventBus} eventBus\n */\nexport default function BpmnDistributeElements(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\nBpmnDistributeElements.$inject = [ 'eventBus' ];\n\ninherits(BpmnDistributeElements, RuleProvider);\n\nBpmnDistributeElements.prototype.init = function() {\n  this.addRule('elements.distribute', function(context) {\n    var elements = context.elements;\n\n    elements = filter(elements, function(element) {\n      var cannotDistribute = isAny(element, [\n        'bpmn:Association',\n        'bpmn:BoundaryEvent',\n        'bpmn:DataInputAssociation',\n        'bpmn:DataOutputAssociation',\n        'bpmn:Lane',\n        'bpmn:MessageFlow',\n        'bpmn:SequenceFlow',\n        'bpmn:TextAnnotation'\n      ]);\n\n      return !(element.labelTarget || cannotDistribute);\n    });\n\n    // filter out elements which are children of any of the selected elements\n    elements = getParents(elements);\n\n    if (elements.length < 3) {\n      return false;\n    }\n\n    return elements;\n  });\n};\n","/**\n * To change the icons, modify the SVGs in `./resources`, execute `npx svgo -f resources --datauri enc -o dist`,\n * and then replace respective icons with the optimized data URIs in `./dist`.\n */\nvar icons = {\n  horizontal: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n                <polyline points=\"450 400 450 150 1350 150 1350 400\" style=\"fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;\"/>\n                <rect x=\"150\" y=\"450\" width=\"600\" height=\"1200\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n                <rect x=\"1050\" y=\"450\" width=\"600\" height=\"800\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n              </svg>`,\n  vertical: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n              <polyline points=\"400 1350 150 1350 150 450 400 450\" style=\"fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;\"/>\n              <rect x=\"450\" y=\"150\" width=\"1200\" height=\"600\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n              <rect x=\"450\" y=\"1050\" width=\"800\" height=\"600\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n            </svg>`\n};\n\nexport default icons;\n","import ICONS from './DistributeElementsIcons';\n\nimport { assign } from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('./BpmnDistributeElements').default} DistributeElements\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n *\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuEntries} PopupMenuEntries\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').default} PopupMenuProvider\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n */\n\nvar LOW_PRIORITY = 900;\n\n/**\n * A provider for the distribute elements popup menu.\n *\n * @implements {PopupMenuProvider}\n *\n * @param {PopupMenu} popupMenu\n * @param {DistributeElements} distributeElements\n * @param {Translate} translate\n * @param {Rules} rules\n */\nexport default function DistributeElementsMenuProvider(\n    popupMenu, distributeElements, translate, rules) {\n  this._distributeElements = distributeElements;\n  this._translate = translate;\n  this._popupMenu = popupMenu;\n  this._rules = rules;\n\n  popupMenu.registerProvider('align-elements', LOW_PRIORITY, this);\n}\n\nDistributeElementsMenuProvider.$inject = [\n  'popupMenu',\n  'distributeElements',\n  'translate',\n  'rules'\n];\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuEntries}\n */\nDistributeElementsMenuProvider.prototype.getPopupMenuEntries = function(target) {\n  var entries = {};\n\n  if (this._isAllowed(target)) {\n    assign(entries, this._getEntries(target));\n  }\n\n  return entries;\n};\n\nDistributeElementsMenuProvider.prototype._isAllowed = function(elements) {\n  return this._rules.allowed('elements.distribute', { elements: elements });\n};\n\nDistributeElementsMenuProvider.prototype._getEntries = function(elements) {\n  var distributeElements = this._distributeElements,\n      translate = this._translate,\n      popupMenu = this._popupMenu;\n\n  var entries = {\n    'distribute-elements-horizontal': {\n      group: 'distribute',\n      title: translate('Distribute elements horizontally'),\n      className: 'bjs-align-elements-menu-entry',\n      imageHtml: ICONS['horizontal'],\n      action: function(event, entry) {\n        distributeElements.trigger(elements, 'horizontal');\n        popupMenu.close();\n      }\n    },\n    'distribute-elements-vertical': {\n      group: 'distribute',\n      title: translate('Distribute elements vertically'),\n      imageHtml: ICONS['vertical'],\n      action: function(event, entry) {\n        distributeElements.trigger(elements, 'vertical');\n        popupMenu.close();\n      }\n    },\n  };\n\n  return entries;\n};\n","import DistributeElementsModule from 'diagram-js/lib/features/distribute-elements';\nimport PopupMenuModule from 'diagram-js/lib/features/popup-menu';\n\nimport BpmnDistributeElements from './BpmnDistributeElements';\nimport DistributeElementsMenuProvider from './DistributeElementsMenuProvider';\n\n\nexport default {\n  __depends__: [\n    PopupMenuModule,\n    DistributeElementsModule\n  ],\n  __init__: [\n    'bpmnDistributeElements',\n    'distributeElementsMenuProvider'\n  ],\n  bpmnDistributeElements: [ 'type', BpmnDistributeElements ],\n  distributeElementsMenuProvider: [ 'type', DistributeElementsMenuProvider ]\n};\n","import {\r\n  forEach,\r\n  isArray\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\nvar NOT_REGISTERED_ERROR = 'is not a registered action',\r\n    IS_REGISTERED_ERROR = 'is already registered';\r\n\r\n\r\n/**\r\n * An interface that provides access to modeling actions by decoupling\r\n * the one who requests the action to be triggered and the trigger itself.\r\n *\r\n * It's possible to add new actions by registering them with ´registerAction´\r\n * and likewise unregister existing ones with ´unregisterAction´.\r\n *\r\n *\r\n * ## Life-Cycle and configuration\r\n *\r\n * The editor actions will wait for diagram initialization before\r\n * registering default actions _and_ firing an `editorActions.init` event.\r\n *\r\n * Interested parties may listen to the `editorActions.init` event with\r\n * low priority to check, which actions got registered. Other components\r\n * may use the event to register their own actions via `registerAction`.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Injector} injector\r\n */\r\nexport default function EditorActions(eventBus, injector) {\r\n\r\n  // initialize actions\r\n  this._actions = {};\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('diagram.init', function() {\r\n\r\n    // all diagram modules got loaded; check which ones\r\n    // are available and register the respective default actions\r\n    self._registerDefaultActions(injector);\r\n\r\n    // ask interested parties to register available editor\r\n    // actions on diagram initialization\r\n    eventBus.fire('editorActions.init', {\r\n      editorActions: self\r\n    });\r\n  });\r\n\r\n}\r\n\r\nEditorActions.$inject = [\r\n  'eventBus',\r\n  'injector'\r\n];\r\n\r\n/**\r\n * Register default actions.\r\n *\r\n * @param {Injector} injector\r\n */\r\nEditorActions.prototype._registerDefaultActions = function(injector) {\r\n\r\n  // (1) retrieve optional components to integrate with\r\n\r\n  var commandStack = injector.get('commandStack', false);\r\n  var modeling = injector.get('modeling', false);\r\n  var selection = injector.get('selection', false);\r\n  var zoomScroll = injector.get('zoomScroll', false);\r\n  var copyPaste = injector.get('copyPaste', false);\r\n  var canvas = injector.get('canvas', false);\r\n  var rules = injector.get('rules', false);\r\n  var keyboardMove = injector.get('keyboardMove', false);\r\n  var keyboardMoveSelection = injector.get('keyboardMoveSelection', false);\r\n\r\n  // (2) check components and register actions\r\n\r\n  if (commandStack) {\r\n    this.register('undo', function() {\r\n      commandStack.undo();\r\n    });\r\n\r\n    this.register('redo', function() {\r\n      commandStack.redo();\r\n    });\r\n  }\r\n\r\n  if (copyPaste && selection) {\r\n    this.register('copy', function() {\r\n      var selectedElements = selection.get();\r\n\r\n      if (selectedElements.length) {\r\n        return copyPaste.copy(selectedElements);\r\n      }\r\n    });\r\n  }\r\n\r\n  if (copyPaste) {\r\n    this.register('paste', function() {\r\n      copyPaste.paste();\r\n    });\r\n  }\r\n\r\n  if (zoomScroll) {\r\n    this.register('stepZoom', function(opts) {\r\n      zoomScroll.stepZoom(opts.value);\r\n    });\r\n  }\r\n\r\n  if (canvas) {\r\n    this.register('zoom', function(opts) {\r\n      canvas.zoom(opts.value);\r\n    });\r\n  }\r\n\r\n  if (modeling && selection && rules) {\r\n    this.register('removeSelection', function() {\r\n\r\n      var selectedElements = selection.get();\r\n\r\n      if (!selectedElements.length) {\r\n        return;\r\n      }\r\n\r\n      var allowed = rules.allowed('elements.delete', { elements: selectedElements }),\r\n          removableElements;\r\n\r\n      if (allowed === false) {\r\n        return;\r\n      }\r\n      else if (isArray(allowed)) {\r\n        removableElements = allowed;\r\n      }\r\n      else {\r\n        removableElements = selectedElements;\r\n      }\r\n\r\n      if (removableElements.length) {\r\n        modeling.removeElements(removableElements.slice());\r\n      }\r\n    });\r\n  }\r\n\r\n  if (keyboardMove) {\r\n    this.register('moveCanvas', function(opts) {\r\n      keyboardMove.moveCanvas(opts);\r\n    });\r\n  }\r\n\r\n  if (keyboardMoveSelection) {\r\n    this.register('moveSelection', function(opts) {\r\n      keyboardMoveSelection.moveSelection(opts.direction, opts.accelerated);\r\n    });\r\n  }\r\n\r\n};\r\n\r\n\r\n/**\r\n * Triggers a registered action\r\n *\r\n * @param {string} action\r\n * @param {Object} opts\r\n *\r\n * @return {unknown} Returns what the registered listener returns\r\n */\r\nEditorActions.prototype.trigger = function(action, opts) {\r\n  if (!this._actions[action]) {\r\n    throw error(action, NOT_REGISTERED_ERROR);\r\n  }\r\n\r\n  return this._actions[action](opts);\r\n};\r\n\r\n\r\n/**\r\n * Registers a collections of actions.\r\n * The key of the object will be the name of the action.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * var actions = {\r\n *   spaceTool: function() {\r\n *     spaceTool.activateSelection();\r\n *   },\r\n *   lassoTool: function() {\r\n *     lassoTool.activateSelection();\r\n *   }\r\n * ];\r\n *\r\n * editorActions.register(actions);\r\n *\r\n * editorActions.isRegistered('spaceTool'); // true\r\n * ```\r\n *\r\n * @param {Object} actions\r\n */\r\nEditorActions.prototype.register = function(actions, listener) {\r\n  var self = this;\r\n\r\n  if (typeof actions === 'string') {\r\n    return this._registerAction(actions, listener);\r\n  }\r\n\r\n  forEach(actions, function(listener, action) {\r\n    self._registerAction(action, listener);\r\n  });\r\n};\r\n\r\n/**\r\n * Registers a listener to an action key\r\n *\r\n * @param {string} action\r\n * @param {Function} listener\r\n */\r\nEditorActions.prototype._registerAction = function(action, listener) {\r\n  if (this.isRegistered(action)) {\r\n    throw error(action, IS_REGISTERED_ERROR);\r\n  }\r\n\r\n  this._actions[action] = listener;\r\n};\r\n\r\n/**\r\n * Unregister an existing action\r\n *\r\n * @param {string} action\r\n */\r\nEditorActions.prototype.unregister = function(action) {\r\n  if (!this.isRegistered(action)) {\r\n    throw error(action, NOT_REGISTERED_ERROR);\r\n  }\r\n\r\n  this._actions[action] = undefined;\r\n};\r\n\r\n/**\r\n * Returns the identifiers of all currently registered editor actions\r\n *\r\n * @return {string[]}\r\n */\r\nEditorActions.prototype.getActions = function() {\r\n  return Object.keys(this._actions);\r\n};\r\n\r\n/**\r\n * Checks wether the given action is registered\r\n *\r\n * @param {string} action\r\n *\r\n * @return {boolean}\r\n */\r\nEditorActions.prototype.isRegistered = function(action) {\r\n  return !!this._actions[action];\r\n};\r\n\r\n\r\nfunction error(action, message) {\r\n  return new Error(action + ' ' + message);\r\n}\r\n","import EditorActions from './EditorActions';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'editorActions' ],\r\n  editorActions: [ 'type', EditorActions ]\r\n};\r\n","import inherits from 'inherits-browser';\n\nimport EditorActions from 'diagram-js/lib/features/editor-actions/EditorActions';\n\nimport { filter } from 'min-dash';\n\nimport { is } from '../../util/ModelUtil';\n\nimport {\n  getBBox\n} from 'diagram-js/lib/util/Elements';\n\n/**\n * @typedef {import('didi').Injector} Injector\n */\n\n/**\n * Registers and executes BPMN specific editor actions.\n *\n * @param {Injector} injector\n */\nexport default function BpmnEditorActions(injector) {\n  injector.invoke(EditorActions, this);\n}\n\ninherits(BpmnEditorActions, EditorActions);\n\nBpmnEditorActions.$inject = [\n  'injector'\n];\n\n/**\n * Register default actions.\n *\n * @param {Injector} injector\n */\nBpmnEditorActions.prototype._registerDefaultActions = function(injector) {\n\n  // (0) invoke super method\n\n  EditorActions.prototype._registerDefaultActions.call(this, injector);\n\n  // (1) retrieve optional components to integrate with\n\n  var canvas = injector.get('canvas', false);\n  var elementRegistry = injector.get('elementRegistry', false);\n  var selection = injector.get('selection', false);\n  var spaceTool = injector.get('spaceTool', false);\n  var lassoTool = injector.get('lassoTool', false);\n  var handTool = injector.get('handTool', false);\n  var globalConnect = injector.get('globalConnect', false);\n  var distributeElements = injector.get('distributeElements', false);\n  var alignElements = injector.get('alignElements', false);\n  var directEditing = injector.get('directEditing', false);\n  var searchPad = injector.get('searchPad', false);\n  var modeling = injector.get('modeling', false);\n  var contextPad = injector.get('contextPad', false);\n\n  // (2) check components and register actions\n\n  if (canvas && elementRegistry && selection) {\n    this._registerAction('selectElements', function() {\n\n      // select all elements except for the invisible\n      // root element\n      var rootElement = canvas.getRootElement();\n\n      var elements = elementRegistry.filter(function(element) {\n        return element !== rootElement;\n      });\n\n      selection.select(elements);\n\n      return elements;\n    });\n  }\n\n  if (spaceTool) {\n    this._registerAction('spaceTool', function() {\n      spaceTool.toggle();\n    });\n  }\n\n  if (lassoTool) {\n    this._registerAction('lassoTool', function() {\n      lassoTool.toggle();\n    });\n  }\n\n  if (handTool) {\n    this._registerAction('handTool', function() {\n      handTool.toggle();\n    });\n  }\n\n  if (globalConnect) {\n    this._registerAction('globalConnectTool', function() {\n      globalConnect.toggle();\n    });\n  }\n\n  if (selection && distributeElements) {\n    this._registerAction('distributeElements', function(opts) {\n      var currentSelection = selection.get(),\n          type = opts.type;\n\n      if (currentSelection.length) {\n        distributeElements.trigger(currentSelection, type);\n      }\n    });\n  }\n\n  if (selection && alignElements) {\n    this._registerAction('alignElements', function(opts) {\n      var currentSelection = selection.get(),\n          aligneableElements = [],\n          type = opts.type;\n\n      if (currentSelection.length) {\n        aligneableElements = filter(currentSelection, function(element) {\n          return !is(element, 'bpmn:Lane');\n        });\n\n        alignElements.trigger(aligneableElements, type);\n      }\n    });\n  }\n\n  if (selection && modeling) {\n    this._registerAction('setColor', function(opts) {\n      var currentSelection = selection.get();\n\n      if (currentSelection.length) {\n        modeling.setColor(currentSelection, opts);\n      }\n    });\n  }\n\n  if (selection && directEditing) {\n    this._registerAction('directEditing', function() {\n      var currentSelection = selection.get();\n\n      if (currentSelection.length) {\n        directEditing.activate(currentSelection[0]);\n      }\n    });\n  }\n\n  if (searchPad) {\n    this._registerAction('find', function() {\n      searchPad.toggle();\n    });\n  }\n\n  if (canvas && modeling) {\n    this._registerAction('moveToOrigin', function() {\n      var rootElement = canvas.getRootElement(),\n          boundingBox,\n          elements;\n\n      if (is(rootElement, 'bpmn:Collaboration')) {\n        elements = elementRegistry.filter(function(element) {\n          return is(element.parent, 'bpmn:Collaboration');\n        });\n      } else {\n        elements = elementRegistry.filter(function(element) {\n          return element !== rootElement && !is(element.parent, 'bpmn:SubProcess');\n        });\n      }\n\n      boundingBox = getBBox(elements);\n\n      modeling.moveElements(\n        elements,\n        { x: -boundingBox.x, y: -boundingBox.y },\n        rootElement\n      );\n    });\n  }\n\n  if (selection && contextPad) {\n    this._registerAction('replaceElement', function(event) {\n      contextPad.triggerEntry('replace', 'click', event);\n    });\n  }\n\n};\n","import EditorActionsModule from 'diagram-js/lib/features/editor-actions';\n\nimport BpmnEditorActions from './BpmnEditorActions';\n\nexport default {\n  __depends__: [\n    EditorActionsModule\n  ],\n  editorActions: [ 'type', BpmnEditorActions ]\n};\n","import { isAny } from '../modeling/util/ModelingUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function BpmnGridSnapping(eventBus) {\r\n  eventBus.on([\r\n    'create.init',\r\n    'shape.move.init'\r\n  ], function(event) {\r\n    var context = event.context,\r\n        shape = event.shape;\r\n\r\n    if (isAny(shape, [\r\n      'bpmn:Participant',\r\n      'bpmn:SubProcess',\r\n      'bpmn:TextAnnotation'\r\n    ])) {\r\n      if (!context.gridSnappingContext) {\r\n        context.gridSnappingContext = {};\r\n      }\r\n\r\n      context.gridSnappingContext.snapLocation = 'top-left';\r\n    }\r\n  });\r\n}\r\n\r\nBpmnGridSnapping.$inject = [ 'eventBus' ];","export var SPACING = 10;\r\n\r\nexport function quantize(value, quantum, fn) {\r\n  if (!fn) {\r\n    fn = 'round';\r\n  }\r\n\r\n  return Math[ fn ](value / quantum) * quantum;\r\n}","import {\r\n  setSnapped,\r\n  isSnapped\r\n} from '../snapping/SnapUtil';\r\n\r\nimport { isCmd } from '../keyboard/KeyboardUtil';\r\n\r\nimport {\r\n  assign,\r\n  isNumber\r\n} from 'min-dash';\r\n\r\nimport {\r\n  SPACING,\r\n  quantize\r\n} from './GridUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n */\r\n\r\nvar LOWER_PRIORITY = 1200;\r\nvar LOW_PRIORITY = 800;\r\n\r\n/**\r\n * Basic grid snapping that covers connecting, creating, moving, resizing shapes, moving bendpoints\r\n * and connection segments.\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Object} config\r\n */\r\nexport default function GridSnapping(elementRegistry, eventBus, config) {\r\n\r\n  var active = !config || config.active !== false;\r\n\r\n  this._eventBus = eventBus;\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('diagram.init', LOW_PRIORITY, function() {\r\n    self.setActive(active);\r\n  });\r\n\r\n  eventBus.on([\r\n    'create.move',\r\n    'create.end',\r\n    'bendpoint.move.move',\r\n    'bendpoint.move.end',\r\n    'connect.move',\r\n    'connect.end',\r\n    'connectionSegment.move.move',\r\n    'connectionSegment.move.end',\r\n    'resize.move',\r\n    'resize.end',\r\n    'shape.move.move',\r\n    'shape.move.end'\r\n  ], LOWER_PRIORITY, function(event) {\r\n    var originalEvent = event.originalEvent;\r\n\r\n    if (!self.active || (originalEvent && isCmd(originalEvent))) {\r\n      return;\r\n    }\r\n\r\n    var context = event.context,\r\n        gridSnappingContext = context.gridSnappingContext;\r\n\r\n    if (!gridSnappingContext) {\r\n      gridSnappingContext = context.gridSnappingContext = {};\r\n    }\r\n\r\n    [ 'x', 'y' ].forEach(function(axis) {\r\n      var options = {};\r\n\r\n      // allow snapping with offset\r\n      var snapOffset = getSnapOffset(event, axis, elementRegistry);\r\n\r\n      if (snapOffset) {\r\n        options.offset = snapOffset;\r\n      }\r\n\r\n      // allow snapping with min and max\r\n      var snapConstraints = getSnapConstraints(event, axis);\r\n\r\n      if (snapConstraints) {\r\n        assign(options, snapConstraints);\r\n      }\r\n\r\n      if (!isSnapped(event, axis)) {\r\n        self.snapEvent(event, axis, options);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Snap an events x or y with optional min, max and offset.\r\n *\r\n * @param {Object} event\r\n * @param {string} axis\r\n * @param {number} [options.min]\r\n * @param {number} [options.max]\r\n * @param {number} [options.offset]\r\n */\r\nGridSnapping.prototype.snapEvent = function(event, axis, options) {\r\n  var snappedValue = this.snapValue(event[ axis ], options);\r\n\r\n  setSnapped(event, axis, snappedValue);\r\n};\r\n\r\n/**\r\n * Expose grid spacing for third parties (i.e. extensions).\r\n *\r\n * @return {number} spacing of grid dots\r\n */\r\nGridSnapping.prototype.getGridSpacing = function() {\r\n  return SPACING;\r\n};\r\n\r\n/**\r\n * Snap value with optional min, max and offset.\r\n *\r\n * @param {number} value\r\n * @param {Object} options\r\n * @param {number} [options.min]\r\n * @param {number} [options.max]\r\n * @param {number} [options.offset]\r\n */\r\nGridSnapping.prototype.snapValue = function(value, options) {\r\n  var offset = 0;\r\n\r\n  if (options && options.offset) {\r\n    offset = options.offset;\r\n  }\r\n\r\n  value += offset;\r\n\r\n  value = quantize(value, SPACING);\r\n\r\n  var min, max;\r\n\r\n  if (options && options.min) {\r\n    min = options.min;\r\n\r\n    if (isNumber(min)) {\r\n      min = quantize(min + offset, SPACING, 'ceil');\r\n\r\n      value = Math.max(value, min);\r\n    }\r\n  }\r\n\r\n  if (options && options.max) {\r\n    max = options.max;\r\n\r\n    if (isNumber(max)) {\r\n      max = quantize(max + offset, SPACING, 'floor');\r\n\r\n      value = Math.min(value, max);\r\n    }\r\n  }\r\n\r\n  value -= offset;\r\n\r\n  return value;\r\n};\r\n\r\nGridSnapping.prototype.isActive = function() {\r\n  return this.active;\r\n};\r\n\r\nGridSnapping.prototype.setActive = function(active) {\r\n  this.active = active;\r\n\r\n  this._eventBus.fire('gridSnapping.toggle', { active: active });\r\n};\r\n\r\nGridSnapping.prototype.toggleActive = function() {\r\n  this.setActive(!this.active);\r\n};\r\n\r\nGridSnapping.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'config.gridSnapping'\r\n];\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * Get minimum and maximum snap constraints.\r\n * Constraints are cached.\r\n *\r\n * @param {Object} event\r\n * @param {Object} event.context\r\n * @param {string} axis\r\n *\r\n * @return {boolean|Object}\r\n */\r\nfunction getSnapConstraints(event, axis) {\r\n  var context = event.context,\r\n      createConstraints = context.createConstraints,\r\n      resizeConstraints = context.resizeConstraints || {},\r\n      gridSnappingContext = context.gridSnappingContext,\r\n      snapConstraints = gridSnappingContext.snapConstraints;\r\n\r\n  // cache snap constraints\r\n  if (snapConstraints && snapConstraints[ axis ]) {\r\n    return snapConstraints[ axis ];\r\n  }\r\n\r\n  if (!snapConstraints) {\r\n    snapConstraints = gridSnappingContext.snapConstraints = {};\r\n  }\r\n\r\n  if (!snapConstraints[ axis ]) {\r\n    snapConstraints[ axis ] = {};\r\n  }\r\n\r\n  var direction = context.direction;\r\n\r\n  // create\r\n  if (createConstraints) {\r\n    if (isHorizontal(axis)) {\r\n      snapConstraints.x.min = createConstraints.left;\r\n      snapConstraints.x.max = createConstraints.right;\r\n    } else {\r\n      snapConstraints.y.min = createConstraints.top;\r\n      snapConstraints.y.max = createConstraints.bottom;\r\n    }\r\n  }\r\n\r\n  // resize\r\n  var minResizeConstraints = resizeConstraints.min,\r\n      maxResizeConstraints = resizeConstraints.max;\r\n\r\n  if (minResizeConstraints) {\r\n    if (isHorizontal(axis)) {\r\n\r\n      if (isWest(direction)) {\r\n        snapConstraints.x.max = minResizeConstraints.left;\r\n      } else {\r\n        snapConstraints.x.min = minResizeConstraints.right;\r\n      }\r\n\r\n    } else {\r\n\r\n      if (isNorth(direction)) {\r\n        snapConstraints.y.max = minResizeConstraints.top;\r\n      } else {\r\n        snapConstraints.y.min = minResizeConstraints.bottom;\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  if (maxResizeConstraints) {\r\n    if (isHorizontal(axis)) {\r\n\r\n      if (isWest(direction)) {\r\n        snapConstraints.x.min = maxResizeConstraints.left;\r\n      } else {\r\n        snapConstraints.x.max = maxResizeConstraints.right;\r\n      }\r\n\r\n    } else {\r\n\r\n      if (isNorth(direction)) {\r\n        snapConstraints.y.min = maxResizeConstraints.top;\r\n      } else {\r\n        snapConstraints.y.max = maxResizeConstraints.bottom;\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  return snapConstraints[ axis ];\r\n}\r\n\r\n/**\r\n * Get snap offset.\r\n * Offset is cached.\r\n *\r\n * @param {Object} event\r\n * @param {string} axis\r\n * @param {ElementRegistry} elementRegistry\r\n *\r\n * @return {number}\r\n */\r\nfunction getSnapOffset(event, axis, elementRegistry) {\r\n  var context = event.context,\r\n      shape = event.shape,\r\n      gridSnappingContext = context.gridSnappingContext,\r\n      snapLocation = gridSnappingContext.snapLocation,\r\n      snapOffset = gridSnappingContext.snapOffset;\r\n\r\n  // cache snap offset\r\n  if (snapOffset && isNumber(snapOffset[ axis ])) {\r\n    return snapOffset[ axis ];\r\n  }\r\n\r\n  if (!snapOffset) {\r\n    snapOffset = gridSnappingContext.snapOffset = {};\r\n  }\r\n\r\n  if (!isNumber(snapOffset[ axis ])) {\r\n    snapOffset[ axis ] = 0;\r\n  }\r\n\r\n  if (!shape) {\r\n    return snapOffset[ axis ];\r\n  }\r\n\r\n  if (!elementRegistry.get(shape.id)) {\r\n\r\n    if (isHorizontal(axis)) {\r\n      snapOffset[ axis ] += shape[ axis ] + shape.width / 2;\r\n    } else {\r\n      snapOffset[ axis ] += shape[ axis ] + shape.height / 2;\r\n    }\r\n  }\r\n\r\n  if (!snapLocation) {\r\n    return snapOffset[ axis ];\r\n  }\r\n\r\n  if (axis === 'x') {\r\n    if (/left/.test(snapLocation)) {\r\n      snapOffset[ axis ] -= shape.width / 2;\r\n    } else if (/right/.test(snapLocation)) {\r\n      snapOffset[ axis ] += shape.width / 2;\r\n    }\r\n  } else {\r\n    if (/top/.test(snapLocation)) {\r\n      snapOffset[ axis ] -= shape.height / 2;\r\n    } else if (/bottom/.test(snapLocation)) {\r\n      snapOffset[ axis ] += shape.height / 2;\r\n    }\r\n  }\r\n\r\n  return snapOffset[ axis ];\r\n}\r\n\r\nfunction isHorizontal(axis) {\r\n  return axis === 'x';\r\n}\r\n\r\nfunction isNorth(direction) {\r\n  return direction.indexOf('n') !== -1;\r\n}\r\n\r\nfunction isWest(direction) {\r\n  return direction.indexOf('w') !== -1;\r\n}","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from '../../../command/CommandInterceptor';\r\n\r\nimport {\r\n  assign,\r\n  isString\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('../../../util/Types').Rect} Rect\r\n *\r\n * @typedef {import('../../../core/EventBus').default} EventBus\r\n * @typedef {import('../../grid-snapping/GridSnapping').default} GridSnapping\r\n */\r\n\r\n/**\r\n * Integrates resizing with grid snapping.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {GridSnapping} gridSnapping\r\n */\r\nexport default function ResizeBehavior(eventBus, gridSnapping) {\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  this._gridSnapping = gridSnapping;\r\n\r\n  var self = this;\r\n\r\n  this.preExecute('shape.resize', function(event) {\r\n    var context = event.context,\r\n        hints = context.hints || {},\r\n        autoResize = hints.autoResize;\r\n\r\n    if (!autoResize) {\r\n      return;\r\n    }\r\n\r\n    var shape = context.shape,\r\n        newBounds = context.newBounds;\r\n\r\n    if (isString(autoResize)) {\r\n      context.newBounds = self.snapComplex(newBounds, autoResize);\r\n    } else {\r\n      context.newBounds = self.snapSimple(shape, newBounds);\r\n    }\r\n  });\r\n}\r\n\r\nResizeBehavior.$inject = [\r\n  'eventBus',\r\n  'gridSnapping',\r\n  'modeling'\r\n];\r\n\r\ninherits(ResizeBehavior, CommandInterceptor);\r\n\r\n/**\r\n * Snap width and height in relation to center.\r\n *\r\n * @param {Shape} shape\r\n * @param {Rect} newBounds\r\n *\r\n * @return {Rect} Snapped bounds.\r\n */\r\nResizeBehavior.prototype.snapSimple = function(shape, newBounds) {\r\n  var gridSnapping = this._gridSnapping;\r\n\r\n  newBounds.width = gridSnapping.snapValue(newBounds.width, {\r\n    min: newBounds.width\r\n  });\r\n\r\n  newBounds.height = gridSnapping.snapValue(newBounds.height, {\r\n    min: newBounds.height\r\n  });\r\n\r\n  newBounds.x = shape.x + (shape.width / 2) - (newBounds.width / 2);\r\n  newBounds.y = shape.y + (shape.height / 2) - (newBounds.height / 2);\r\n\r\n  return newBounds;\r\n};\r\n\r\n/**\r\n * Snap x, y, width and height according to given directions.\r\n *\r\n * @param {Rect} newBounds\r\n * @param {string} directions - Directions as {n|w|s|e}.\r\n *\r\n * @return {Rect} Snapped bounds.\r\n */\r\nResizeBehavior.prototype.snapComplex = function(newBounds, directions) {\r\n  if (/w|e/.test(directions)) {\r\n    newBounds = this.snapHorizontally(newBounds, directions);\r\n  }\r\n\r\n  if (/n|s/.test(directions)) {\r\n    newBounds = this.snapVertically(newBounds, directions);\r\n  }\r\n\r\n  return newBounds;\r\n};\r\n\r\n/**\r\n * Snap in one or both directions horizontally.\r\n *\r\n * @param {Rect} newBounds\r\n * @param {string} directions - Directions as {n|w|s|e}.\r\n *\r\n * @return {Rect} Snapped bounds.\r\n */\r\nResizeBehavior.prototype.snapHorizontally = function(newBounds, directions) {\r\n  var gridSnapping = this._gridSnapping,\r\n      west = /w/.test(directions),\r\n      east = /e/.test(directions);\r\n\r\n  var snappedNewBounds = {};\r\n\r\n  snappedNewBounds.width = gridSnapping.snapValue(newBounds.width, {\r\n    min: newBounds.width\r\n  });\r\n\r\n  if (east) {\r\n\r\n    // handle <we>\r\n    if (west) {\r\n      snappedNewBounds.x = gridSnapping.snapValue(newBounds.x, {\r\n        max: newBounds.x\r\n      });\r\n\r\n      snappedNewBounds.width += gridSnapping.snapValue(newBounds.x - snappedNewBounds.x, {\r\n        min: newBounds.x - snappedNewBounds.x\r\n      });\r\n    }\r\n\r\n    // handle <e>\r\n    else {\r\n      newBounds.x = newBounds.x + newBounds.width - snappedNewBounds.width;\r\n    }\r\n  }\r\n\r\n  // assign snapped x and width\r\n  assign(newBounds, snappedNewBounds);\r\n\r\n  return newBounds;\r\n};\r\n\r\n/**\r\n * Snap in one or both directions vertically.\r\n *\r\n * @param {Rect} newBounds\r\n * @param {string} directions - Directions as {n|w|s|e}.\r\n *\r\n * @return {Rect} Snapped bounds.\r\n */\r\nResizeBehavior.prototype.snapVertically = function(newBounds, directions) {\r\n  var gridSnapping = this._gridSnapping,\r\n      north = /n/.test(directions),\r\n      south = /s/.test(directions);\r\n\r\n  var snappedNewBounds = {};\r\n\r\n  snappedNewBounds.height = gridSnapping.snapValue(newBounds.height, {\r\n    min: newBounds.height\r\n  });\r\n\r\n  if (north) {\r\n\r\n    // handle <ns>\r\n    if (south) {\r\n      snappedNewBounds.y = gridSnapping.snapValue(newBounds.y, {\r\n        max: newBounds.y\r\n      });\r\n\r\n      snappedNewBounds.height += gridSnapping.snapValue(newBounds.y - snappedNewBounds.y, {\r\n        min: newBounds.y - snappedNewBounds.y\r\n      });\r\n    }\r\n\r\n    // handle <n>\r\n    else {\r\n      newBounds.y = newBounds.y + newBounds.height - snappedNewBounds.height;\r\n    }\r\n  }\r\n\r\n  // assign snapped y and height\r\n  assign(newBounds, snappedNewBounds);\r\n\r\n  return newBounds;\r\n};","/**\r\n * @typedef {import('../../../core/EventBus').default} EventBus\r\n * @typedef {import('../../grid-snapping/GridSnapping').default} GridSnapping\r\n */\r\n\r\nvar HIGH_PRIORITY = 2000;\r\n\r\n/**\r\n * Integrates space tool with grid snapping.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {GridSnapping} gridSnapping\r\n */\r\nexport default function SpaceToolBehavior(eventBus, gridSnapping) {\r\n  eventBus.on([\r\n    'spaceTool.move',\r\n    'spaceTool.end'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context;\r\n\r\n    if (!context.initialized) {\r\n      return;\r\n    }\r\n\r\n    var axis = context.axis;\r\n\r\n    var snapped;\r\n\r\n    if (axis === 'x') {\r\n\r\n      // snap delta x to multiple of 10\r\n      snapped = gridSnapping.snapValue(event.dx);\r\n\r\n      event.x = event.x + snapped - event.dx;\r\n      event.dx = snapped;\r\n    } else {\r\n\r\n      // snap delta y to multiple of 10\r\n      snapped = gridSnapping.snapValue(event.dy);\r\n\r\n      event.y = event.y + snapped - event.dy;\r\n      event.dy = snapped;\r\n    }\r\n  });\r\n}\r\n\r\nSpaceToolBehavior.$inject = [\r\n  'eventBus',\r\n  'gridSnapping'\r\n];","import ResizeBehavior from './ResizeBehavior';\r\nimport SpaceToolBehavior from './SpaceToolBehavior';\r\n\r\nexport default {\r\n  __init__: [\r\n    'gridSnappingResizeBehavior',\r\n    'gridSnappingSpaceToolBehavior'\r\n  ],\r\n  gridSnappingResizeBehavior: [ 'type', ResizeBehavior ],\r\n  gridSnappingSpaceToolBehavior: [ 'type', SpaceToolBehavior ]\r\n};","import GridSnapping from './GridSnapping';\r\n\r\nimport GridSnappingBehaviorModule from './behavior';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [ GridSnappingBehaviorModule ],\r\n  __init__: [ 'gridSnapping' ],\r\n  gridSnapping: [ 'type', GridSnapping ]\r\n};","import { getNewShapePosition } from '../../auto-place/BpmnAutoPlaceUtil';\r\n\r\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\r\nimport { is } from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('diagram-js/lib/features/grid-snapping/GridSnapping').default} GridSnapping\r\n *\r\n * @typedef {import('diagram-js/lib/util/Types').Axis} Axis\r\n */\r\n\r\nvar HIGH_PRIORITY = 2000;\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n * @param {GridSnapping} gridSnapping\r\n */\r\nexport default function GridSnappingAutoPlaceBehavior(eventBus, gridSnapping) {\r\n  eventBus.on('autoPlace', HIGH_PRIORITY, function(context) {\r\n    var source = context.source,\r\n        sourceMid = getMid(source),\r\n        shape = context.shape;\r\n\r\n    var position = getNewShapePosition(source, shape);\r\n\r\n    [ 'x', 'y' ].forEach(function(axis) {\r\n      var options = {};\r\n\r\n      // do not snap if x/y equal\r\n      if (position[ axis ] === sourceMid[ axis ]) {\r\n        return;\r\n      }\r\n\r\n      if (position[ axis ] > sourceMid[ axis ]) {\r\n        options.min = position[ axis ];\r\n      } else {\r\n        options.max = position[ axis ];\r\n      }\r\n\r\n      if (is(shape, 'bpmn:TextAnnotation')) {\r\n\r\n        if (isHorizontal(axis)) {\r\n          options.offset = -shape.width / 2;\r\n        } else {\r\n          options.offset = -shape.height / 2;\r\n        }\r\n\r\n      }\r\n\r\n      position[ axis ] = gridSnapping.snapValue(position[ axis ], options);\r\n\r\n    });\r\n\r\n    // must be returned to be considered by auto place\r\n    return position;\r\n  });\r\n}\r\n\r\nGridSnappingAutoPlaceBehavior.$inject = [\r\n  'eventBus',\r\n  'gridSnapping'\r\n];\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * @param {Axis} axis\r\n *\r\n * @return {boolean}\r\n */\r\nfunction isHorizontal(axis) {\r\n  return axis === 'x';\r\n}","import { is } from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('diagram-js/lib/features/grid-snapping/GridSnapping').default} GridSnapping\r\n */\r\n\r\nvar HIGHER_PRIORITY = 1750;\r\n\r\n/**\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n * @param {GridSnapping} gridSnapping\r\n */\r\nexport default function GridSnappingParticipantBehavior(canvas, eventBus, gridSnapping) {\r\n  eventBus.on([\r\n    'create.start',\r\n    'shape.move.start'\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        rootElement = canvas.getRootElement();\r\n\r\n    if (!is(shape, 'bpmn:Participant') ||\r\n      !is(rootElement, 'bpmn:Process') ||\r\n      !rootElement.children.length) {\r\n      return;\r\n    }\r\n\r\n    var createConstraints = context.createConstraints;\r\n\r\n    if (!createConstraints) {\r\n      return;\r\n    }\r\n\r\n    shape.width = gridSnapping.snapValue(shape.width, { min: shape.width });\r\n    shape.height = gridSnapping.snapValue(shape.height, { min: shape.height });\r\n  });\r\n}\r\n\r\nGridSnappingParticipantBehavior.$inject = [\r\n  'canvas',\r\n  'eventBus',\r\n  'gridSnapping'\r\n];","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { pointsAligned } from 'diagram-js/lib/util/Geometry';\n\nimport {\n  assign\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/grid-snapping/GridSnapping').default} GridSnapping\n * @typedef {import('../../modeling/Modeling').default} Modeling\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\nvar HIGH_PRIORITY = 3000;\n\n\n/**\n * Snaps connections with Manhattan layout.\n *\n * @param {EventBus} eventBus\n * @param {GridSnapping} gridSnapping\n * @param {Modeling} modeling\n */\nexport default function GridSnappingLayoutConnectionBehavior(eventBus, gridSnapping, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  this._gridSnapping = gridSnapping;\n\n  var self = this;\n\n  this.postExecuted([\n    'connection.create',\n    'connection.layout'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        connection = context.connection,\n        hints = context.hints || {},\n        waypoints = connection.waypoints;\n\n    if (hints.connectionStart || hints.connectionEnd || hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (!hasMiddleSegments(waypoints)) {\n      return;\n    }\n\n    modeling.updateWaypoints(connection, self.snapMiddleSegments(waypoints));\n  });\n}\n\nGridSnappingLayoutConnectionBehavior.$inject = [\n  'eventBus',\n  'gridSnapping',\n  'modeling'\n];\n\ninherits(GridSnappingLayoutConnectionBehavior, CommandInterceptor);\n\n/**\n * Snap middle segments of a given connection.\n *\n * @param {Point[]} waypoints\n *\n * @return {Point[]}\n */\nGridSnappingLayoutConnectionBehavior.prototype.snapMiddleSegments = function(waypoints) {\n  var gridSnapping = this._gridSnapping,\n      snapped;\n\n  waypoints = waypoints.slice();\n\n  for (var i = 1; i < waypoints.length - 2; i++) {\n\n    snapped = snapSegment(gridSnapping, waypoints[i], waypoints[i + 1]);\n\n    waypoints[i] = snapped[0];\n    waypoints[i + 1] = snapped[1];\n  }\n\n  return waypoints;\n};\n\n\n// helpers //////////\n\n/**\n * Check whether a connection has a middle segments.\n *\n * @param {Point[]} waypoints\n *\n * @return {boolean}\n */\nfunction hasMiddleSegments(waypoints) {\n  return waypoints.length > 3;\n}\n\n/**\n * Check whether an alignment is horizontal.\n *\n * @param {string} aligned\n *\n * @return {boolean}\n */\nfunction horizontallyAligned(aligned) {\n  return aligned === 'h';\n}\n\n/**\n * Check whether an alignment is vertical.\n *\n * @param {string} aligned\n *\n * @return {boolean}\n */\nfunction verticallyAligned(aligned) {\n  return aligned === 'v';\n}\n\n/**\n * Get middle segments from a given connection.\n *\n * @param {Point[]} waypoints\n *\n * @return {Point[]}\n */\nfunction snapSegment(gridSnapping, segmentStart, segmentEnd) {\n\n  var aligned = pointsAligned(segmentStart, segmentEnd);\n\n  var snapped = {};\n\n  if (horizontallyAligned(aligned)) {\n\n    // snap horizontally\n    snapped.y = gridSnapping.snapValue(segmentStart.y);\n  }\n\n  if (verticallyAligned(aligned)) {\n\n    // snap vertically\n    snapped.x = gridSnapping.snapValue(segmentStart.x);\n  }\n\n  if ('x' in snapped || 'y' in snapped) {\n    segmentStart = assign({}, segmentStart, snapped);\n    segmentEnd = assign({}, segmentEnd, snapped);\n  }\n\n  return [ segmentStart, segmentEnd ];\n}","import GridSnappingAutoPlaceBehavior from './GridSnappingAutoPlaceBehavior';\r\nimport GridSnappingParticipantBehavior from './GridSnappingParticipantBehavior';\r\nimport GridSnappingLayoutConnectionBehavior from './GridSnappingLayoutConnectionBehavior';\r\n\r\nexport default {\r\n  __init__: [\r\n    'gridSnappingAutoPlaceBehavior',\r\n    'gridSnappingParticipantBehavior',\r\n    'gridSnappingLayoutConnectionBehavior',\r\n  ],\r\n  gridSnappingAutoPlaceBehavior: [ 'type', GridSnappingAutoPlaceBehavior ],\r\n  gridSnappingParticipantBehavior: [ 'type', GridSnappingParticipantBehavior ],\r\n  gridSnappingLayoutConnectionBehavior: [ 'type', GridSnappingLayoutConnectionBehavior ]\r\n};","import BpmnGridSnapping from './BpmnGridSnapping';\r\nimport GridSnappingModule from 'diagram-js/lib/features/grid-snapping';\r\n\r\nimport GridSnappingBehaviorModule from './behavior';\r\n\r\nexport default {\r\n  __depends__: [\r\n    GridSnappingModule,\r\n    GridSnappingBehaviorModule\r\n  ],\r\n  __init__: [ 'bpmnGridSnapping' ],\r\n  bpmnGridSnapping: [ 'type', BpmnGridSnapping ]\r\n};","import { is } from '../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isHorizontal\n} from '../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/interaction-events/InteractionEvents').default} InteractionEvents\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\nvar LABEL_WIDTH = 30,\n    LABEL_HEIGHT = 30;\n\n\n/**\n * BPMN-specific hit zones and interaction fixes.\n *\n * @param {EventBus} eventBus\n * @param {InteractionEvents} interactionEvents\n */\nexport default function BpmnInteractionEvents(eventBus, interactionEvents) {\n\n  this._interactionEvents = interactionEvents;\n\n  var self = this;\n\n  eventBus.on([\n    'interactionEvents.createHit',\n    'interactionEvents.updateHit'\n  ], function(context) {\n    var element = context.element,\n        gfx = context.gfx;\n\n    if (is(element, 'bpmn:Lane')) {\n      return self._createParticipantHit(element, gfx);\n    } else\n\n    if (is(element, 'bpmn:Participant')) {\n      if (isExpanded(element)) {\n        return self._createParticipantHit(element, gfx);\n      } else {\n        return self._createDefaultHit(element, gfx);\n      }\n    } else\n\n    if (is(element, 'bpmn:SubProcess')) {\n      if (isExpanded(element)) {\n        return self._createSubProcessHit(element, gfx);\n      } else {\n        return self._createDefaultHit(element, gfx);\n      }\n    }\n  });\n\n}\n\nBpmnInteractionEvents.$inject = [\n  'eventBus',\n  'interactionEvents'\n];\n\n/**\n * @param {Element} element\n * @param {SVGElement} gfx\n *\n * @return {boolean}\n */\nBpmnInteractionEvents.prototype._createDefaultHit = function(element, gfx) {\n  this._interactionEvents.removeHits(gfx);\n\n  this._interactionEvents.createDefaultHit(element, gfx);\n\n  // indicate that we created a hit\n  return true;\n};\n\n/**\n * @param {Shape} element\n * @param {SVGElement} gfx\n *\n * @return {boolean}\n */\nBpmnInteractionEvents.prototype._createParticipantHit = function(element, gfx) {\n\n  // remove existing hits\n  this._interactionEvents.removeHits(gfx);\n\n  // add body hit\n  this._interactionEvents.createBoxHit(gfx, 'no-move', {\n    width: element.width,\n    height: element.height\n  });\n\n  // add outline hit\n  this._interactionEvents.createBoxHit(gfx, 'click-stroke', {\n    width: element.width,\n    height: element.height\n  });\n\n  // add label hit\n  var box = isHorizontal(element) ? {\n    width: LABEL_WIDTH,\n    height: element.height\n  } : {\n    width: element.width,\n    height: LABEL_HEIGHT\n  };\n\n  this._interactionEvents.createBoxHit(gfx, 'all', box);\n\n  // indicate that we created a hit\n  return true;\n};\n\n/**\n * @param {Shape} element\n * @param {SVGElement} gfx\n *\n * @return {boolean}\n */\nBpmnInteractionEvents.prototype._createSubProcessHit = function(element, gfx) {\n\n  // remove existing hits\n  this._interactionEvents.removeHits(gfx);\n\n  // add body hit\n  this._interactionEvents.createBoxHit(gfx, 'no-move', {\n    width: element.width,\n    height: element.height\n  });\n\n  // add outline hit\n  this._interactionEvents.createBoxHit(gfx, 'click-stroke', {\n    width: element.width,\n    height: element.height\n  });\n\n  // add label hit\n  this._interactionEvents.createBoxHit(gfx, 'all', {\n    width: element.width,\n    height: LABEL_HEIGHT\n  });\n\n  // indicate that we created a hit\n  return true;\n};","import BpmnInteractionEvents from './BpmnInteractionEvents';\n\nexport default {\n  __init__: [ 'bpmnInteractionEvents' ],\n  bpmnInteractionEvents: [ 'type', BpmnInteractionEvents ]\n};","import inherits from 'inherits-browser';\n\nimport KeyboardBindings from 'diagram-js/lib/features/keyboard/KeyboardBindings';\n\n/**\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('diagram-js/lib/features/editor-actions/EditorActions').default} EditorActions\n * @typedef {import('diagram-js/lib/features/keyboard/Keyboard').default} Keyboard\n */\n\n/**\n * BPMN 2.0 specific keyboard bindings.\n *\n * @param {Injector} injector\n */\nexport default function BpmnKeyboardBindings(injector) {\n  injector.invoke(KeyboardBindings, this);\n}\n\ninherits(BpmnKeyboardBindings, KeyboardBindings);\n\nBpmnKeyboardBindings.$inject = [\n  'injector'\n];\n\n\n/**\n * Register available keyboard bindings.\n *\n * @param {Keyboard} keyboard\n * @param {EditorActions} editorActions\n */\nBpmnKeyboardBindings.prototype.registerBindings = function(keyboard, editorActions) {\n\n  // inherit default bindings\n  KeyboardBindings.prototype.registerBindings.call(this, keyboard, editorActions);\n\n  /**\n   * Add keyboard binding if respective editor action\n   * is registered.\n   *\n   * @param {string} action name\n   * @param {Function} fn that implements the key binding\n   */\n  function addListener(action, fn) {\n\n    if (editorActions.isRegistered(action)) {\n      keyboard.addListener(fn);\n    }\n  }\n\n  // select all elements\n  // CTRL + A\n  addListener('selectElements', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.isKey([ 'a', 'A' ], event) && keyboard.isCmd(event)) {\n      editorActions.trigger('selectElements');\n\n      return true;\n    }\n  });\n\n  // search labels\n  // CTRL + F\n  addListener('find', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.isKey([ 'f', 'F' ], event) && keyboard.isCmd(event)) {\n      editorActions.trigger('find');\n\n      return true;\n    }\n  });\n\n  // activate space tool\n  // S\n  addListener('spaceTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 's', 'S' ], event)) {\n      editorActions.trigger('spaceTool');\n\n      return true;\n    }\n  });\n\n  // activate lasso tool\n  // L\n  addListener('lassoTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'l', 'L' ], event)) {\n      editorActions.trigger('lassoTool');\n\n      return true;\n    }\n  });\n\n  // activate hand tool\n  // H\n  addListener('handTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'h', 'H' ], event)) {\n      editorActions.trigger('handTool');\n\n      return true;\n    }\n  });\n\n  // activate global connect tool\n  // C\n  addListener('globalConnectTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'c', 'C' ], event)) {\n      editorActions.trigger('globalConnectTool');\n\n      return true;\n    }\n  });\n\n  // activate direct editing\n  // E\n  addListener('directEditing', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'e', 'E' ], event)) {\n      editorActions.trigger('directEditing');\n\n      return true;\n    }\n  });\n\n  // activate replace element\n  // R\n  addListener('replaceElement', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'r', 'R' ], event)) {\n      editorActions.trigger('replaceElement', event);\n\n      return true;\n    }\n  });\n\n};","import KeyboardModule from 'diagram-js/lib/features/keyboard';\n\nimport BpmnKeyboardBindings from './BpmnKeyboardBindings';\n\nexport default {\n  __depends__: [\n    KeyboardModule\n  ],\n  __init__: [ 'keyboardBindings' ],\n  keyboardBindings: [ 'type', BpmnKeyboardBindings ]\n};\n","import {\r\n  assign\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../keyboard/Keyboard').default} Keyboard\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n * @typedef {import('../selection/Selection').default} Selection\r\n */\r\n\r\nvar DEFAULT_CONFIG = {\r\n  moveSpeed: 1,\r\n  moveSpeedAccelerated: 10\r\n};\r\n\r\nvar HIGHER_PRIORITY = 1500;\r\n\r\nvar LEFT = 'left';\r\nvar UP = 'up';\r\nvar RIGHT = 'right';\r\nvar DOWN = 'down';\r\n\r\nvar KEY_TO_DIRECTION = {\r\n  ArrowLeft: LEFT,\r\n  Left: LEFT,\r\n  ArrowUp: UP,\r\n  Up: UP,\r\n  ArrowRight: RIGHT,\r\n  Right: RIGHT,\r\n  ArrowDown: DOWN,\r\n  Down: DOWN\r\n};\r\n\r\nvar DIRECTIONS_DELTA = {\r\n  left: function(speed) {\r\n    return {\r\n      x: -speed,\r\n      y: 0\r\n    };\r\n  },\r\n  up: function(speed) {\r\n    return {\r\n      x: 0,\r\n      y: -speed\r\n    };\r\n  },\r\n  right: function(speed) {\r\n    return {\r\n      x: speed,\r\n      y: 0\r\n    };\r\n  },\r\n  down: function(speed) {\r\n    return {\r\n      x: 0,\r\n      y: speed\r\n    };\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Enables to move selection with keyboard arrows.\r\n * Use with Shift for modified speed (default=1, with Shift=10).\r\n * Pressed Cmd/Ctrl turns the feature off.\r\n *\r\n * @param {Object} config\r\n * @param {number} [config.moveSpeed=1]\r\n * @param {number} [config.moveSpeedAccelerated=10]\r\n * @param {Keyboard} keyboard\r\n * @param {Modeling} modeling\r\n * @param {Rules} rules\r\n * @param {Selection} selection\r\n */\r\nexport default function KeyboardMoveSelection(\r\n    config,\r\n    keyboard,\r\n    modeling,\r\n    rules,\r\n    selection\r\n) {\r\n\r\n  var self = this;\r\n\r\n  this._config = assign({}, DEFAULT_CONFIG, config || {});\r\n\r\n  keyboard.addListener(HIGHER_PRIORITY, function(event) {\r\n\r\n    var keyEvent = event.keyEvent;\r\n\r\n    var direction = KEY_TO_DIRECTION[keyEvent.key];\r\n\r\n    if (!direction) {\r\n      return;\r\n    }\r\n\r\n    if (keyboard.isCmd(keyEvent)) {\r\n      return;\r\n    }\r\n\r\n    var accelerated = keyboard.isShift(keyEvent);\r\n\r\n    self.moveSelection(direction, accelerated);\r\n\r\n    return true;\r\n  });\r\n\r\n\r\n  /**\r\n   * Move selected elements in the given direction,\r\n   * optionally specifying accelerated movement.\r\n   *\r\n   * @param {string} direction\r\n   * @param {boolean} [accelerated=false]\r\n   */\r\n  this.moveSelection = function(direction, accelerated) {\r\n\r\n    var selectedElements = selection.get();\r\n\r\n    if (!selectedElements.length) {\r\n      return;\r\n    }\r\n\r\n    var speed = this._config[\r\n      accelerated ?\r\n        'moveSpeedAccelerated' :\r\n        'moveSpeed'\r\n    ];\r\n\r\n    var delta = DIRECTIONS_DELTA[direction](speed);\r\n\r\n    var canMove = rules.allowed('elements.move', {\r\n      shapes: selectedElements\r\n    });\r\n\r\n    if (canMove) {\r\n      modeling.moveElements(selectedElements, delta);\r\n    }\r\n  };\r\n\r\n}\r\n\r\nKeyboardMoveSelection.$inject = [\r\n  'config.keyboardMoveSelection',\r\n  'keyboard',\r\n  'modeling',\r\n  'rules',\r\n  'selection'\r\n];","import KeyboardModule from '../keyboard';\r\nimport SelectionModule from '../selection';\r\n\r\nimport KeyboardMoveSelection from './KeyboardMoveSelection';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    KeyboardModule,\r\n    SelectionModule\r\n  ],\r\n  __init__: [\r\n    'keyboardMoveSelection'\r\n  ],\r\n  keyboardMoveSelection: [ 'type', KeyboardMoveSelection ]\r\n};\r\n","import {\r\n  pick,\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport {\r\n  resizeBounds,\r\n  ensureConstraints,\r\n  computeChildrenBBox,\r\n  getMinResizeBounds\r\n} from './ResizeUtil';\r\n\r\nimport {\r\n  asTRBL,\r\n  getMid,\r\n  roundBounds\r\n} from '../../layout/LayoutUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../../util/Types').Direction} Direction\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n */\r\n\r\nvar DEFAULT_MIN_WIDTH = 10;\r\n\r\n\r\n/**\r\n * A component that provides resizing of shapes on the canvas.\r\n *\r\n * The following components are part of shape resize:\r\n *\r\n *  * adding resize handles,\r\n *  * creating a visual during resize\r\n *  * checking resize rules\r\n *  * committing a change once finished\r\n *\r\n *\r\n * ## Customizing\r\n *\r\n * It's possible to customize the resizing behaviour by intercepting 'resize.start'\r\n * and providing the following parameters through the 'context':\r\n *\r\n *   * minDimensions ({ width, height }): minimum shape dimensions\r\n *\r\n *   * childrenBoxPadding ({ left, top, bottom, right } || number):\r\n *     gap between the minimum bounding box and the container\r\n *\r\n * f.ex:\r\n *\r\n * ```javascript\r\n * eventBus.on('resize.start', 1500, function(event) {\r\n *   var context = event.context,\r\n *\r\n *  context.minDimensions = { width: 140, height: 120 };\r\n *\r\n *  // Passing general padding\r\n *  context.childrenBoxPadding = 30;\r\n *\r\n *  // Passing padding to a specific side\r\n *  context.childrenBoxPadding.left = 20;\r\n * });\r\n * ```\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Rules} rules\r\n * @param {Modeling} modeling\r\n * @param {Dragging} dragging\r\n */\r\nexport default function Resize(eventBus, rules, modeling, dragging) {\r\n\r\n  this._dragging = dragging;\r\n  this._rules = rules;\r\n\r\n  var self = this;\r\n\r\n\r\n  /**\r\n   * Handle resize move by specified delta.\r\n   *\r\n   * @param {Object} context\r\n   * @param {Point} delta\r\n   */\r\n  function handleMove(context, delta) {\r\n\r\n    var shape = context.shape,\r\n        direction = context.direction,\r\n        resizeConstraints = context.resizeConstraints,\r\n        newBounds;\r\n\r\n    context.delta = delta;\r\n\r\n    newBounds = resizeBounds(shape, direction, delta);\r\n\r\n    // ensure constraints during resize\r\n    context.newBounds = ensureConstraints(newBounds, resizeConstraints);\r\n\r\n    // update + cache executable state\r\n    context.canExecute = self.canResize(context);\r\n  }\r\n\r\n  /**\r\n   * Handle resize start.\r\n   *\r\n   * @param {Object} context\r\n   */\r\n  function handleStart(context) {\r\n\r\n    var resizeConstraints = context.resizeConstraints,\r\n\r\n        // evaluate minBounds for backwards compatibility\r\n        minBounds = context.minBounds;\r\n\r\n    if (resizeConstraints !== undefined) {\r\n      return;\r\n    }\r\n\r\n    if (minBounds === undefined) {\r\n      minBounds = self.computeMinResizeBox(context);\r\n    }\r\n\r\n    context.resizeConstraints = {\r\n      min: asTRBL(minBounds)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handle resize end.\r\n   *\r\n   * @param {Object} context\r\n   */\r\n  function handleEnd(context) {\r\n    var shape = context.shape,\r\n        canExecute = context.canExecute,\r\n        newBounds = context.newBounds;\r\n\r\n    if (canExecute) {\r\n\r\n      // ensure we have actual pixel values for new bounds\r\n      // (important when zoom level was > 1 during move)\r\n      newBounds = roundBounds(newBounds);\r\n\r\n      if (!boundsChanged(shape, newBounds)) {\r\n\r\n        // no resize necessary\r\n        return;\r\n      }\r\n\r\n      // perform the actual resize\r\n      modeling.resizeShape(shape, newBounds);\r\n    }\r\n  }\r\n\r\n\r\n  eventBus.on('resize.start', function(event) {\r\n    handleStart(event.context);\r\n  });\r\n\r\n  eventBus.on('resize.move', function(event) {\r\n    var delta = {\r\n      x: event.dx,\r\n      y: event.dy\r\n    };\r\n\r\n    handleMove(event.context, delta);\r\n  });\r\n\r\n  eventBus.on('resize.end', function(event) {\r\n    handleEnd(event.context);\r\n  });\r\n\r\n}\r\n\r\n\r\nResize.prototype.canResize = function(context) {\r\n  var rules = this._rules;\r\n\r\n  var ctx = pick(context, [ 'newBounds', 'shape', 'delta', 'direction' ]);\r\n\r\n  return rules.allowed('shape.resize', ctx);\r\n};\r\n\r\n/**\r\n * Activate a resize operation.\r\n *\r\n * You may specify additional contextual information and must specify a\r\n * resize direction during activation of the resize event.\r\n *\r\n * @param {MouseEvent|TouchEvent} event\r\n * @param {Shape} shape\r\n * @param {Object|Direction} contextOrDirection\r\n */\r\nResize.prototype.activate = function(event, shape, contextOrDirection) {\r\n  var dragging = this._dragging,\r\n      context,\r\n      direction;\r\n\r\n  if (typeof contextOrDirection === 'string') {\r\n    contextOrDirection = {\r\n      direction: contextOrDirection\r\n    };\r\n  }\r\n\r\n  context = assign({ shape: shape }, contextOrDirection);\r\n\r\n  direction = context.direction;\r\n\r\n  if (!direction) {\r\n    throw new Error('must provide a direction (n|w|s|e|nw|se|ne|sw)');\r\n  }\r\n\r\n  dragging.init(event, getReferencePoint(shape, direction), 'resize', {\r\n    autoActivate: true,\r\n    cursor: getCursor(direction),\r\n    data: {\r\n      shape: shape,\r\n      context: context\r\n    }\r\n  });\r\n};\r\n\r\nResize.prototype.computeMinResizeBox = function(context) {\r\n  var shape = context.shape,\r\n      direction = context.direction,\r\n      minDimensions,\r\n      childrenBounds;\r\n\r\n  minDimensions = context.minDimensions || {\r\n    width: DEFAULT_MIN_WIDTH,\r\n    height: DEFAULT_MIN_WIDTH\r\n  };\r\n\r\n  // get children bounds\r\n  childrenBounds = computeChildrenBBox(shape, context.childrenBoxPadding);\r\n\r\n  // get correct minimum bounds from given resize direction\r\n  // basically ensures that the minBounds is max(childrenBounds, minDimensions)\r\n  return getMinResizeBounds(direction, shape, minDimensions, childrenBounds);\r\n};\r\n\r\n\r\nResize.$inject = [\r\n  'eventBus',\r\n  'rules',\r\n  'modeling',\r\n  'dragging'\r\n];\r\n\r\n// helpers //////////\r\n\r\nfunction boundsChanged(shape, newBounds) {\r\n  return shape.x !== newBounds.x ||\r\n    shape.y !== newBounds.y ||\r\n    shape.width !== newBounds.width ||\r\n    shape.height !== newBounds.height;\r\n}\r\n\r\nexport function getReferencePoint(shape, direction) {\r\n  var mid = getMid(shape),\r\n      trbl = asTRBL(shape);\r\n\r\n  var referencePoint = {\r\n    x: mid.x,\r\n    y: mid.y\r\n  };\r\n\r\n  if (direction.indexOf('n') !== -1) {\r\n    referencePoint.y = trbl.top;\r\n  } else if (direction.indexOf('s') !== -1) {\r\n    referencePoint.y = trbl.bottom;\r\n  }\r\n\r\n  if (direction.indexOf('e') !== -1) {\r\n    referencePoint.x = trbl.right;\r\n  } else if (direction.indexOf('w') !== -1) {\r\n    referencePoint.x = trbl.left;\r\n  }\r\n\r\n  return referencePoint;\r\n}\r\n\r\nfunction getCursor(direction) {\r\n  var prefix = 'resize-';\r\n\r\n  if (direction === 'n' || direction === 's') {\r\n    return prefix + 'ns';\r\n  } else if (direction === 'e' || direction === 'w') {\r\n    return prefix + 'ew';\r\n  } else if (direction === 'nw' || direction === 'se') {\r\n    return prefix + 'nwse';\r\n  } else {\r\n    return prefix + 'nesw';\r\n  }\r\n}","var MARKER_RESIZING = 'djs-resizing',\r\n    MARKER_RESIZE_NOT_OK = 'resize-not-ok';\r\n\r\nvar LOW_PRIORITY = 500;\r\n\r\nimport {\r\n  attr as svgAttr,\r\n  remove as svgRemove,\r\n  classes as svgClasses\r\n} from 'tiny-svg';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../preview-support/PreviewSupport').default} PreviewSupport\r\n */\r\n\r\n/**\r\n * Provides previews for resizing shapes when resizing.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {PreviewSupport} previewSupport\r\n */\r\nexport default function ResizePreview(eventBus, canvas, previewSupport) {\r\n\r\n  /**\r\n   * Update resizer frame.\r\n   *\r\n   * @param {Object} context\r\n   */\r\n  function updateFrame(context) {\r\n\r\n    var shape = context.shape,\r\n        bounds = context.newBounds,\r\n        frame = context.frame;\r\n\r\n    if (!frame) {\r\n      frame = context.frame = previewSupport.addFrame(shape, canvas.getActiveLayer());\r\n\r\n      canvas.addMarker(shape, MARKER_RESIZING);\r\n    }\r\n\r\n    if (bounds.width > 5) {\r\n      svgAttr(frame, { x: bounds.x, width: bounds.width });\r\n    }\r\n\r\n    if (bounds.height > 5) {\r\n      svgAttr(frame, { y: bounds.y, height: bounds.height });\r\n    }\r\n\r\n    if (context.canExecute) {\r\n      svgClasses(frame).remove(MARKER_RESIZE_NOT_OK);\r\n    } else {\r\n      svgClasses(frame).add(MARKER_RESIZE_NOT_OK);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove resizer frame.\r\n   *\r\n   * @param {Object} context\r\n   */\r\n  function removeFrame(context) {\r\n    var shape = context.shape,\r\n        frame = context.frame;\r\n\r\n    if (frame) {\r\n      svgRemove(context.frame);\r\n    }\r\n\r\n    canvas.removeMarker(shape, MARKER_RESIZING);\r\n  }\r\n\r\n  // add and update previews\r\n  eventBus.on('resize.move', LOW_PRIORITY, function(event) {\r\n    updateFrame(event.context);\r\n  });\r\n\r\n  // remove previews\r\n  eventBus.on('resize.cleanup', function(event) {\r\n    removeFrame(event.context);\r\n  });\r\n\r\n}\r\n\r\nResizePreview.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'previewSupport'\r\n];","import {\r\n  bind,\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  clear as svgClear,\r\n  create as svgCreate\r\n} from 'tiny-svg';\r\n\r\nimport {\r\n  event as domEvent\r\n} from 'min-dom';\r\n\r\nimport {\r\n  isPrimaryButton\r\n} from '../../util/Mouse';\r\n\r\nimport {\r\n  transform\r\n} from '../../util/SvgTransformUtil';\r\n\r\nimport { getReferencePoint } from './Resize';\r\n\r\nimport { isConnection } from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../resize/Resize').default} Resize\r\n * @typedef {import('../selection/Selection').default} Selection\r\n */\r\n\r\nvar HANDLE_OFFSET = -6,\r\n    HANDLE_SIZE = 8,\r\n    HANDLE_HIT_SIZE = 20;\r\n\r\nvar CLS_RESIZER = 'djs-resizer';\r\n\r\nvar directions = [ 'n', 'w', 's', 'e', 'nw', 'ne', 'se', 'sw' ];\r\n\r\n\r\n/**\r\n * This component is responsible for adding resize handles.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Selection} selection\r\n * @param {Resize} resize\r\n */\r\nexport default function ResizeHandles(eventBus, canvas, selection, resize) {\r\n\r\n  this._resize = resize;\r\n  this._canvas = canvas;\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('selection.changed', function(e) {\r\n    var newSelection = e.newSelection;\r\n\r\n    // remove old selection markers\r\n    self.removeResizers();\r\n\r\n    // add new selection markers ONLY if single selection\r\n    if (newSelection.length === 1) {\r\n      forEach(newSelection, bind(self.addResizer, self));\r\n    }\r\n  });\r\n\r\n  eventBus.on('shape.changed', function(e) {\r\n    var shape = e.element;\r\n\r\n    if (selection.isSelected(shape)) {\r\n      self.removeResizers();\r\n\r\n      self.addResizer(shape);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nResizeHandles.prototype.makeDraggable = function(element, gfx, direction) {\r\n  var resize = this._resize;\r\n\r\n  function startResize(event) {\r\n\r\n    // only trigger on left mouse button\r\n    if (isPrimaryButton(event)) {\r\n      resize.activate(event, element, direction);\r\n    }\r\n  }\r\n\r\n  domEvent.bind(gfx, 'mousedown', startResize);\r\n  domEvent.bind(gfx, 'touchstart', startResize);\r\n};\r\n\r\n\r\nResizeHandles.prototype._createResizer = function(element, x, y, direction) {\r\n  var resizersParent = this._getResizersParent();\r\n\r\n  var offset = getHandleOffset(direction);\r\n\r\n  var group = svgCreate('g');\r\n\r\n  svgClasses(group).add(CLS_RESIZER);\r\n  svgClasses(group).add(CLS_RESIZER + '-' + element.id);\r\n  svgClasses(group).add(CLS_RESIZER + '-' + direction);\r\n\r\n  svgAppend(resizersParent, group);\r\n\r\n  var visual = svgCreate('rect');\r\n\r\n  svgAttr(visual, {\r\n    x: -HANDLE_SIZE / 2 + offset.x,\r\n    y: -HANDLE_SIZE / 2 + offset.y,\r\n    width: HANDLE_SIZE,\r\n    height: HANDLE_SIZE\r\n  });\r\n\r\n  svgClasses(visual).add(CLS_RESIZER + '-visual');\r\n\r\n  svgAppend(group, visual);\r\n\r\n  var hit = svgCreate('rect');\r\n\r\n  svgAttr(hit, {\r\n    x: -HANDLE_HIT_SIZE / 2 + offset.x,\r\n    y: -HANDLE_HIT_SIZE / 2 + offset.y,\r\n    width: HANDLE_HIT_SIZE,\r\n    height: HANDLE_HIT_SIZE\r\n  });\r\n\r\n  svgClasses(hit).add(CLS_RESIZER + '-hit');\r\n\r\n  svgAppend(group, hit);\r\n\r\n  transform(group, x, y);\r\n\r\n  return group;\r\n};\r\n\r\nResizeHandles.prototype.createResizer = function(element, direction) {\r\n  var point = getReferencePoint(element, direction);\r\n\r\n  var resizer = this._createResizer(element, point.x, point.y, direction);\r\n\r\n  this.makeDraggable(element, resizer, direction);\r\n};\r\n\r\n// resize handles implementation ///////////////////////////////\r\n\r\n/**\r\n * Add resizers for a given element.\r\n *\r\n * @param {Element} element\r\n */\r\nResizeHandles.prototype.addResizer = function(element) {\r\n  var self = this;\r\n\r\n  if (isConnection(element) || !this._resize.canResize({ shape: element })) {\r\n    return;\r\n  }\r\n\r\n  forEach(directions, function(direction) {\r\n    self.createResizer(element, direction);\r\n  });\r\n};\r\n\r\n/**\r\n * Remove all resizers\r\n */\r\nResizeHandles.prototype.removeResizers = function() {\r\n  var resizersParent = this._getResizersParent();\r\n\r\n  svgClear(resizersParent);\r\n};\r\n\r\nResizeHandles.prototype._getResizersParent = function() {\r\n  return this._canvas.getLayer('resizers');\r\n};\r\n\r\nResizeHandles.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'selection',\r\n  'resize'\r\n];\r\n\r\n// helpers //////////\r\n\r\nfunction getHandleOffset(direction) {\r\n  var offset = {\r\n    x: 0,\r\n    y: 0\r\n  };\r\n\r\n  if (direction.indexOf('e') !== -1) {\r\n    offset.x = -HANDLE_OFFSET;\r\n  } else if (direction.indexOf('w') !== -1) {\r\n    offset.x = HANDLE_OFFSET;\r\n  }\r\n\r\n  if (direction.indexOf('s') !== -1) {\r\n    offset.y = -HANDLE_OFFSET;\r\n  } else if (direction.indexOf('n') !== -1) {\r\n    offset.y = HANDLE_OFFSET;\r\n  }\r\n\r\n  return offset;\r\n}","import RulesModule from '../rules';\r\nimport DraggingModule from '../dragging';\r\nimport PreviewSupportModule from '../preview-support';\r\n\r\nimport Resize from './Resize';\r\nimport ResizePreview from './ResizePreview';\r\nimport ResizeHandles from './ResizeHandles';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    RulesModule,\r\n    DraggingModule,\r\n    PreviewSupportModule\r\n  ],\r\n  __init__: [\r\n    'resize',\r\n    'resizePreview',\r\n    'resizeHandles'\r\n  ],\r\n  resize: [ 'type', Resize ],\r\n  resizePreview: [ 'type', ResizePreview ],\r\n  resizeHandles: [ 'type', ResizeHandles ]\r\n};\r\n","import {\n  assign\n} from 'min-dash';\n\nimport {\n  getLabel\n} from '../../util/LabelUtil';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\nimport { isAny } from '../modeling/util/ModelingUtil';\n\nimport {\n  isExpanded,\n  isHorizontal\n} from '../../util/DiUtil';\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel\n} from '../../util/LabelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js-direct-editing/lib/DirectEditing').default} DirectEditing\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('diagram-js/lib/features/resize/ResizeHandles').default} ResizeHandles\n * @typedef {import('../../draw/TextRenderer').default} TextRenderer\n *\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef { {\n *   bounds: {\n *     x: number;\n *     y: number;\n *     width: number;\n *     height: number;\n *     minWidth?: number;\n *     minHeight?: number;\n *   };\n *   style: Object;\n * } } DirectEditingContext\n */\n\nvar HIGH_PRIORITY = 2000;\n\n/**\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n * @param {Canvas} canvas\n * @param {DirectEditing} directEditing\n * @param {Modeling} modeling\n * @param {ResizeHandles} resizeHandles\n * @param {TextRenderer} textRenderer\n */\nexport default function LabelEditingProvider(\n    eventBus, bpmnFactory, canvas, directEditing,\n    modeling, resizeHandles, textRenderer) {\n\n  this._bpmnFactory = bpmnFactory;\n  this._canvas = canvas;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n\n  directEditing.registerProvider(this);\n\n  // listen to dblclick on non-root elements\n  eventBus.on('element.dblclick', function(event) {\n    activateDirectEdit(event.element, true);\n  });\n\n  // complete on followup canvas operation\n  eventBus.on([\n    'autoPlace.start',\n    'canvas.viewbox.changing',\n    'drag.init',\n    'element.mousedown',\n    'popupMenu.open',\n    'root.set',\n    'selection.changed'\n  ], function() {\n    if (directEditing.isActive()) {\n      directEditing.complete();\n    }\n  });\n\n  eventBus.on([\n    'shape.remove',\n    'connection.remove'\n  ], HIGH_PRIORITY, function(event) {\n\n    if (directEditing.isActive(event.element)) {\n      directEditing.cancel();\n    }\n  });\n\n  // cancel on command stack changes\n  eventBus.on([ 'commandStack.changed' ], function(e) {\n    if (directEditing.isActive()) {\n      directEditing.cancel();\n    }\n  });\n\n\n  eventBus.on('directEditing.activate', function(event) {\n    resizeHandles.removeResizers();\n  });\n\n  eventBus.on('create.end', 500, function(event) {\n\n    var context = event.context,\n        element = context.shape,\n        canExecute = event.context.canExecute,\n        isTouch = event.isTouch;\n\n    // TODO(nikku): we need to find a way to support the\n    // direct editing on mobile devices; right now this will\n    // break for desworkflowediting on mobile devices\n    // as it breaks the user interaction workflow\n\n    // TODO(nikku): we should temporarily focus the edited element\n    // here and release the focused viewport after the direct edit\n    // operation is finished\n    if (isTouch) {\n      return;\n    }\n\n    if (!canExecute) {\n      return;\n    }\n\n    if (context.hints && context.hints.createElementsBehavior === false) {\n      return;\n    }\n\n    activateDirectEdit(element);\n  });\n\n  eventBus.on('autoPlace.end', 500, function(event) {\n    activateDirectEdit(event.shape);\n  });\n\n\n  function activateDirectEdit(element, force) {\n    if (force ||\n        isAny(element, [ 'bpmn:Task', 'bpmn:TextAnnotation', 'bpmn:Participant' ]) ||\n        isCollapsedSubProcess(element)) {\n\n      directEditing.activate(element);\n    }\n  }\n\n}\n\nLabelEditingProvider.$inject = [\n  'eventBus',\n  'bpmnFactory',\n  'canvas',\n  'directEditing',\n  'modeling',\n  'resizeHandles',\n  'textRenderer'\n];\n\n\n/**\n * Activate direct editing for activities and text annotations.\n *\n * @param {Element} element\n *\n * @return { {\n *   text: string;\n *   options?: {\n *     autoResize?: boolean;\n *     centerVertically?: boolean;\n *     resizable?: boolean;\n *   }\n * } & DirectEditingContext }\n */\nLabelEditingProvider.prototype.activate = function(element) {\n\n  // text\n  var text = getLabel(element);\n\n  if (text === undefined) {\n    return;\n  }\n\n  var context = {\n    text: text\n  };\n\n  // bounds\n  var bounds = this.getEditingBBox(element);\n\n  assign(context, bounds);\n\n  var options = {};\n  var style = context.style || {};\n\n  // Remove background and border\n  assign(style, {\n    backgroundColor: null,\n    border: null\n  });\n\n  // tasks\n  if (\n    isAny(element, [\n      'bpmn:Task',\n      'bpmn:Participant',\n      'bpmn:Lane',\n      'bpmn:CallActivity'\n    ]) ||\n    isCollapsedSubProcess(element)\n  ) {\n    assign(options, {\n      centerVertically: true\n    });\n  }\n\n  // external labels\n  if (isLabelExternal(element)) {\n    assign(options, {\n      autoResize: true\n    });\n\n    // keep background and border for external labels\n    assign(style, {\n      backgroundColor: '#ffffff',\n      border: '1px solid #ccc'\n    });\n  }\n\n  // text annotations\n  if (is(element, 'bpmn:TextAnnotation')) {\n    assign(options, {\n      resizable: true,\n      autoResize: true\n    });\n\n    // keep background and border for text annotations\n    assign(style, {\n      backgroundColor: '#ffffff',\n      border: '1px solid #ccc'\n    });\n  }\n\n  assign(context, {\n    options: options,\n    style: style\n  });\n\n  return context;\n};\n\n\n/**\n * Get the editing bounding box based on the element's size and position.\n *\n * @param {Element} element\n *\n * @return {DirectEditingContext}\n */\nLabelEditingProvider.prototype.getEditingBBox = function(element) {\n  var canvas = this._canvas;\n\n  var target = element.label || element;\n\n  var bbox = canvas.getAbsoluteBBox(target);\n\n  var mid = {\n    x: bbox.x + bbox.width / 2,\n    y: bbox.y + bbox.height / 2\n  };\n\n  // default position\n  var bounds = { x: bbox.x, y: bbox.y };\n\n  var zoom = canvas.zoom();\n\n  var defaultStyle = this._textRenderer.getDefaultStyle(),\n      externalStyle = this._textRenderer.getExternalStyle();\n\n  // take zoom into account\n  var externalFontSize = externalStyle.fontSize * zoom,\n      externalLineHeight = externalStyle.lineHeight,\n      defaultFontSize = defaultStyle.fontSize * zoom,\n      defaultLineHeight = defaultStyle.lineHeight;\n\n  var style = {\n    fontFamily: this._textRenderer.getDefaultStyle().fontFamily,\n    fontWeight: this._textRenderer.getDefaultStyle().fontWeight\n  };\n\n  // adjust for expanded pools AND lanes\n  if (is(element, 'bpmn:Lane') || isExpandedPool(element)) {\n    var isHorizontalLane = isHorizontal(element);\n\n    var laneBounds = isHorizontalLane ? {\n      width: bbox.height,\n      height: 30 * zoom,\n      x: bbox.x - bbox.height / 2 + (15 * zoom),\n      y: mid.y - (30 * zoom) / 2\n    } : {\n      width: bbox.width,\n      height: 30 * zoom\n    };\n\n    assign(bounds, laneBounds);\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px',\n      transform: isHorizontalLane ? 'rotate(-90deg)' : null\n    });\n  }\n\n\n  // internal labels for collapsed participants\n  if (isCollapsedPool(element)) {\n    var isHorizontalPool = isHorizontal(element);\n\n    var poolBounds = isHorizontalPool ? {\n      width: bbox.width,\n      height: bbox.height\n    } : {\n      width: bbox.height,\n      height: bbox.width,\n      x: mid.x - bbox.height / 2,\n      y: mid.y - bbox.width / 2\n    };\n\n    assign(bounds, poolBounds);\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px',\n      transform: isHorizontalPool ? null : 'rotate(-90deg)'\n    });\n  }\n\n\n  // internal labels for tasks and collapsed call activities\n  // and sub processes\n  if (isAny(element, [ 'bpmn:Task', 'bpmn:CallActivity' ]) ||\n      isCollapsedSubProcess(element)) {\n\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px'\n    });\n  }\n\n\n  // internal labels for expanded sub processes\n  if (isExpandedSubProcess(element)) {\n    assign(bounds, {\n      width: bbox.width,\n      x: bbox.x\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px'\n    });\n  }\n\n  var width = 90 * zoom,\n      paddingTop = 7 * zoom,\n      paddingBottom = 4 * zoom;\n\n  // external labels for events, data elements, gateways, groups and connections\n  if (target.labelTarget) {\n    assign(bounds, {\n      width: width,\n      height: bbox.height + paddingTop + paddingBottom,\n      x: mid.x - width / 2,\n      y: bbox.y - paddingTop\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  }\n\n  // external label not yet created\n  if (isLabelExternal(target)\n      && !hasExternalLabel(target)\n      && !isLabel(target)) {\n\n    var externalLabelMid = getExternalLabelMid(element);\n\n    var absoluteBBox = canvas.getAbsoluteBBox({\n      x: externalLabelMid.x,\n      y: externalLabelMid.y,\n      width: 0,\n      height: 0\n    });\n\n    var height = externalFontSize + paddingTop + paddingBottom;\n\n    assign(bounds, {\n      width: width,\n      height: height,\n      x: absoluteBBox.x - width / 2,\n      y: absoluteBBox.y - height / 2\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  }\n\n  // text annotations\n  if (is(element, 'bpmn:TextAnnotation')) {\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height,\n      minWidth: 30 * zoom,\n      minHeight: 10 * zoom\n    });\n\n    assign(style, {\n      textAlign: 'left',\n      paddingTop: (5 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (7 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px',\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight\n    });\n  }\n\n  return { bounds: bounds, style: style };\n};\n\n\nLabelEditingProvider.prototype.update = function(\n    element, newLabel,\n    activeContextText, bounds) {\n\n  var newBounds,\n      bbox;\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n\n    bbox = this._canvas.getAbsoluteBBox(element);\n\n    newBounds = {\n      x: element.x,\n      y: element.y,\n      width: element.width / bbox.width * bounds.width,\n      height: element.height / bbox.height * bounds.height\n    };\n  }\n\n  if (isEmptyText(newLabel)) {\n    newLabel = null;\n  }\n\n  this._modeling.updateLabel(element, newLabel, newBounds);\n};\n\n\n\n// helpers //////////\n\nfunction isCollapsedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && !isExpanded(element);\n}\n\nfunction isExpandedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && isExpanded(element);\n}\n\nfunction isCollapsedPool(element) {\n  return is(element, 'bpmn:Participant') && !isExpanded(element);\n}\n\nfunction isExpandedPool(element) {\n  return is(element, 'bpmn:Participant') && isExpanded(element);\n}\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}","import {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  translate\n} from 'diagram-js/lib/util/SvgTransformUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../draw/PathMap').default} PathMap\n */\n\nvar MARKER_HIDDEN = 'djs-element-hidden',\n    MARKER_LABEL_HIDDEN = 'djs-label-hidden';\n\n/**\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {PathMap} pathMap\n */\nexport default function LabelEditingPreview(eventBus, canvas, pathMap) {\n\n  var self = this;\n\n  var defaultLayer = canvas.getDefaultLayer();\n\n  var element, absoluteElementBBox, gfx;\n\n  eventBus.on('directEditing.activate', function(context) {\n    var activeProvider = context.active;\n\n    element = activeProvider.element.label || activeProvider.element;\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      absoluteElementBBox = canvas.getAbsoluteBBox(element);\n\n      gfx = svgCreate('g');\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      var path = self.path = svgCreate('path');\n\n      svgAttr(path, {\n        d: textPathData,\n        strokeWidth: 2,\n        stroke: getStrokeColor(element)\n      });\n\n      svgAppend(gfx, path);\n\n      svgAppend(defaultLayer, gfx);\n\n      translate(gfx, element.x, element.y);\n    }\n\n    if (is(element, 'bpmn:TextAnnotation') ||\n        element.labelTarget) {\n      canvas.addMarker(element, MARKER_HIDDEN);\n    } else if (is(element, 'bpmn:Task') ||\n               is(element, 'bpmn:CallActivity') ||\n               is(element, 'bpmn:SubProcess') ||\n               is(element, 'bpmn:Participant')) {\n      canvas.addMarker(element, MARKER_LABEL_HIDDEN);\n    }\n  });\n\n  eventBus.on('directEditing.resize', function(context) {\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      var height = context.height,\n          dy = context.dy;\n\n      var newElementHeight = Math.max(element.height / absoluteElementBBox.height * (height + dy), 0);\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: newElementHeight,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      svgAttr(self.path, {\n        d: textPathData\n      });\n    }\n  });\n\n  eventBus.on([ 'directEditing.complete', 'directEditing.cancel' ], function(context) {\n    var activeProvider = context.active;\n\n    if (activeProvider) {\n      canvas.removeMarker(activeProvider.element.label || activeProvider.element, MARKER_HIDDEN);\n      canvas.removeMarker(element, MARKER_LABEL_HIDDEN);\n    }\n\n    element = undefined;\n    absoluteElementBBox = undefined;\n\n    if (gfx) {\n      svgRemove(gfx);\n\n      gfx = undefined;\n    }\n  });\n}\n\nLabelEditingPreview.$inject = [\n  'eventBus',\n  'canvas',\n  'pathMap'\n];\n\n\n// helpers //////////\n\nfunction getStrokeColor(element, defaultColor) {\n  var di = getDi(element);\n\n  return di.get('stroke') || defaultColor || 'black';\n}","import ChangeSupportModule from 'diagram-js/lib/features/change-support';\nimport ResizeModule from 'diagram-js/lib/features/resize';\nimport DirectEditingModule from 'diagram-js-direct-editing';\n\nimport LabelEditingProvider from './LabelEditingProvider';\nimport LabelEditingPreview from './LabelEditingPreview';\n\n\nexport default {\n  __depends__: [\n    ChangeSupportModule,\n    ResizeModule,\n    DirectEditingModule\n  ],\n  __init__: [\n    'labelEditingProvider',\n    'labelEditingPreview'\n  ],\n  labelEditingProvider: [ 'type', LabelEditingProvider ],\n  labelEditingPreview: [ 'type', LabelEditingPreview ]\n};\n","import {\r\n  isString,\r\n  assign,\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  assignStyle,\r\n  domify,\r\n  attr as domAttr,\r\n  classes as domClasses,\r\n  remove as domRemove,\r\n  delegate as domDelegate\r\n} from 'min-dom';\r\n\r\nimport Ids from '../../util/IdGenerator';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('../../util/Types').RectTRBL} RectTRBL\r\n *\r\n * @typedef { {\r\n *   html: string | HTMLElement;\r\n *   position: RectTRBL;\r\n *   show?: {\r\n *     minZoom?: number;\r\n *     maxZoom?: number;\r\n *   };\r\n *   timeout?: number;\r\n * } } Tooltip\r\n */\r\n\r\n// document wide unique tooltip ids\r\nvar ids = new Ids('tt');\r\n\r\n\r\nfunction createRoot(parentNode) {\r\n  var root = domify(\r\n    '<div class=\"djs-tooltip-container\" />'\r\n  );\r\n\r\n  assignStyle(root, {\r\n    position: 'absolute',\r\n    width: '0',\r\n    height: '0'\r\n  });\r\n\r\n  parentNode.insertBefore(root, parentNode.firstChild);\r\n\r\n  return root;\r\n}\r\n\r\n\r\nfunction setPosition(el, x, y) {\r\n  assignStyle(el, { left: x + 'px', top: y + 'px' });\r\n}\r\n\r\nfunction setVisible(el, visible) {\r\n  el.style.display = visible === false ? 'none' : '';\r\n}\r\n\r\n\r\nvar tooltipClass = 'djs-tooltip',\r\n    tooltipSelector = '.' + tooltipClass;\r\n\r\n/**\r\n * A service that allows users to render tool tips on the diagram.\r\n *\r\n * The tooltip service will take care of updating the tooltip positioning\r\n * during navigation + zooming.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n *\r\n * // add a pink badge on the top left of the shape\r\n * tooltips.add({\r\n *   position: {\r\n *     x: 50,\r\n *     y: 100\r\n *   },\r\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\r\n * });\r\n *\r\n * // or with optional life span\r\n * tooltips.add({\r\n *   position: {\r\n *     top: -5,\r\n *     left: -5\r\n *   },\r\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>',\r\n *   ttl: 2000\r\n * });\r\n *\r\n * // remove a tool tip\r\n * var id = tooltips.add(...);\r\n *\r\n * tooltips.remove(id);\r\n * ```\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function Tooltips(eventBus, canvas) {\r\n\r\n  this._eventBus = eventBus;\r\n  this._canvas = canvas;\r\n\r\n  this._ids = ids;\r\n\r\n  this._tooltipDefaults = {\r\n    show: {\r\n      minZoom: 0.7,\r\n      maxZoom: 5.0\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @type {Record<string, Tooltip>}\r\n   */\r\n  this._tooltips = {};\r\n\r\n  // root html element for all tooltips\r\n  this._tooltipRoot = createRoot(canvas.getContainer());\r\n\r\n\r\n  var self = this;\r\n\r\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mousedown', function(event) {\r\n    event.stopPropagation();\r\n  });\r\n\r\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mouseover', function(event) {\r\n    self.trigger('mouseover', event);\r\n  });\r\n\r\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mouseout', function(event) {\r\n    self.trigger('mouseout', event);\r\n  });\r\n\r\n  this._init();\r\n}\r\n\r\n\r\nTooltips.$inject = [ 'eventBus', 'canvas' ];\r\n\r\n\r\n/**\r\n * Adds an HTML tooltip to the diagram.\r\n *\r\n * @param {Tooltip} tooltip\r\n *\r\n * @return {string} ID of the tooltip.\r\n */\r\nTooltips.prototype.add = function(tooltip) {\r\n\r\n  if (!tooltip.position) {\r\n    throw new Error('must specifiy tooltip position');\r\n  }\r\n\r\n  if (!tooltip.html) {\r\n    throw new Error('must specifiy tooltip html');\r\n  }\r\n\r\n  var id = this._ids.next();\r\n\r\n  tooltip = assign({}, this._tooltipDefaults, tooltip, {\r\n    id: id\r\n  });\r\n\r\n  this._addTooltip(tooltip);\r\n\r\n  if (tooltip.timeout) {\r\n    this.setTimeout(tooltip);\r\n  }\r\n\r\n  return id;\r\n};\r\n\r\n/**\r\n * @param {string} action\r\n * @param {Event} event\r\n */\r\nTooltips.prototype.trigger = function(action, event) {\r\n\r\n  var node = event.delegateTarget || event.target;\r\n\r\n  var tooltip = this.get(domAttr(node, 'data-tooltip-id'));\r\n\r\n  if (!tooltip) {\r\n    return;\r\n  }\r\n\r\n  if (action === 'mouseover' && tooltip.timeout) {\r\n    this.clearTimeout(tooltip);\r\n  }\r\n\r\n  if (action === 'mouseout' && tooltip.timeout) {\r\n\r\n    // cut timeout after mouse out\r\n    tooltip.timeout = 1000;\r\n\r\n    this.setTimeout(tooltip);\r\n  }\r\n};\r\n\r\n/**\r\n * Get tooltip with given ID.\r\n *\r\n * @param {Tooltip|string} id\r\n *\r\n * @return {Tooltip|undefined}\r\n */\r\nTooltips.prototype.get = function(id) {\r\n\r\n  if (typeof id !== 'string') {\r\n    id = id.id;\r\n  }\r\n\r\n  return this._tooltips[id];\r\n};\r\n\r\n/**\r\n * @param {Tooltip} tooltip\r\n */\r\nTooltips.prototype.clearTimeout = function(tooltip) {\r\n\r\n  tooltip = this.get(tooltip);\r\n\r\n  if (!tooltip) {\r\n    return;\r\n  }\r\n\r\n  var removeTimer = tooltip.removeTimer;\r\n\r\n  if (removeTimer) {\r\n    clearTimeout(removeTimer);\r\n    tooltip.removeTimer = null;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {Tooltip} tooltip\r\n */\r\nTooltips.prototype.setTimeout = function(tooltip) {\r\n\r\n  tooltip = this.get(tooltip);\r\n\r\n  if (!tooltip) {\r\n    return;\r\n  }\r\n\r\n  this.clearTimeout(tooltip);\r\n\r\n  var self = this;\r\n\r\n  tooltip.removeTimer = setTimeout(function() {\r\n    self.remove(tooltip);\r\n  }, tooltip.timeout);\r\n};\r\n\r\n/**\r\n * Remove tooltip with given ID.\r\n *\r\n * @param {string | Tooltip} id\r\n */\r\nTooltips.prototype.remove = function(id) {\r\n\r\n  var tooltip = this.get(id);\r\n\r\n  if (tooltip) {\r\n    domRemove(tooltip.html);\r\n    domRemove(tooltip.htmlContainer);\r\n\r\n    delete tooltip.htmlContainer;\r\n\r\n    delete this._tooltips[tooltip.id];\r\n  }\r\n};\r\n\r\n\r\nTooltips.prototype.show = function() {\r\n  setVisible(this._tooltipRoot);\r\n};\r\n\r\n\r\nTooltips.prototype.hide = function() {\r\n  setVisible(this._tooltipRoot, false);\r\n};\r\n\r\n\r\nTooltips.prototype._updateRoot = function(viewbox) {\r\n  var a = viewbox.scale || 1;\r\n  var d = viewbox.scale || 1;\r\n\r\n  var matrix = 'matrix(' + a + ',0,0,' + d + ',' + (-1 * viewbox.x * a) + ',' + (-1 * viewbox.y * d) + ')';\r\n\r\n  this._tooltipRoot.style.transform = matrix;\r\n  this._tooltipRoot.style['-ms-transform'] = matrix;\r\n};\r\n\r\n\r\nTooltips.prototype._addTooltip = function(tooltip) {\r\n\r\n  var id = tooltip.id,\r\n      html = tooltip.html,\r\n      htmlContainer,\r\n      tooltipRoot = this._tooltipRoot;\r\n\r\n  // unwrap jquery (for those who need it)\r\n  if (html.get && html.constructor.prototype.jquery) {\r\n    html = html.get(0);\r\n  }\r\n\r\n  // create proper html elements from\r\n  // tooltip HTML strings\r\n  if (isString(html)) {\r\n    html = domify(html);\r\n  }\r\n\r\n  htmlContainer = domify('<div data-tooltip-id=\"' + id + '\" class=\"' + tooltipClass + '\">');\r\n  assignStyle(htmlContainer, { position: 'absolute' });\r\n\r\n  htmlContainer.appendChild(html);\r\n\r\n  if (tooltip.type) {\r\n    domClasses(htmlContainer).add('djs-tooltip-' + tooltip.type);\r\n  }\r\n\r\n  if (tooltip.className) {\r\n    domClasses(htmlContainer).add(tooltip.className);\r\n  }\r\n\r\n  tooltip.htmlContainer = htmlContainer;\r\n\r\n  tooltipRoot.appendChild(htmlContainer);\r\n\r\n  this._tooltips[id] = tooltip;\r\n\r\n  this._updateTooltip(tooltip);\r\n};\r\n\r\n\r\nTooltips.prototype._updateTooltip = function(tooltip) {\r\n\r\n  var position = tooltip.position,\r\n      htmlContainer = tooltip.htmlContainer;\r\n\r\n  // update overlay html based on tooltip x, y\r\n\r\n  setPosition(htmlContainer, position.x, position.y);\r\n};\r\n\r\n\r\nTooltips.prototype._updateTooltipVisibilty = function(viewbox) {\r\n\r\n  forEach(this._tooltips, function(tooltip) {\r\n    var show = tooltip.show,\r\n        htmlContainer = tooltip.htmlContainer,\r\n        visible = true;\r\n\r\n    if (show) {\r\n      if (show.minZoom > viewbox.scale ||\r\n          show.maxZoom < viewbox.scale) {\r\n        visible = false;\r\n      }\r\n\r\n      setVisible(htmlContainer, visible);\r\n    }\r\n  });\r\n};\r\n\r\nTooltips.prototype._init = function() {\r\n\r\n  var self = this;\r\n\r\n  // scroll/zoom integration\r\n\r\n  function updateViewbox(viewbox) {\r\n    self._updateRoot(viewbox);\r\n    self._updateTooltipVisibilty(viewbox);\r\n\r\n    self.show();\r\n  }\r\n\r\n  this._eventBus.on('canvas.viewbox.changing', function(event) {\r\n    self.hide();\r\n  });\r\n\r\n  this._eventBus.on('canvas.viewbox.changed', function(event) {\r\n    updateViewbox(event.viewbox);\r\n  });\r\n};\r\n","import Tooltips from './Tooltips';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'tooltips' ],\r\n  tooltips: [ 'type', Tooltips ]\r\n};","import { is } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/tooltips/Tooltips').default} Tooltips\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n */\n\nvar COLLAB_ERR_MSG = 'flow elements must be children of pools/participants';\n\n/**\n * @param {EventBus} eventBus\n * @param {Tooltips} tooltips\n * @param {Translate} translate\n */\nexport default function ModelingFeedback(eventBus, tooltips, translate) {\n\n  function showError(position, message, timeout) {\n    tooltips.add({\n      position: {\n        x: position.x + 5,\n        y: position.y + 5\n      },\n      type: 'error',\n      timeout: timeout || 2000,\n      html: '<div>' + message + '</div>'\n    });\n  }\n\n  eventBus.on([ 'shape.move.rejected', 'create.rejected' ], function(event) {\n    var context = event.context,\n        shape = context.shape,\n        target = context.target;\n\n    if (is(target, 'bpmn:Collaboration') && is(shape, 'bpmn:FlowNode')) {\n      showError(event, translate(COLLAB_ERR_MSG));\n    }\n  });\n\n}\n\nModelingFeedback.$inject = [\n  'eventBus',\n  'tooltips',\n  'translate'\n];\n","import TooltipsModule from 'diagram-js/lib/features/tooltips';\n\nimport ModelingFeedback from './ModelingFeedback';\n\nexport default {\n  __depends__: [\n    TooltipsModule\n  ],\n  __init__: [\n    'modelingFeedback'\n  ],\n  modelingFeedback: [ 'type', ModelingFeedback ]\n};","import {\r\n  assign,\r\n  filter,\r\n  groupBy,\r\n  isObject\r\n} from 'min-dash';\r\n\r\nimport {\r\n  classes as svgClasses\r\n} from 'tiny-svg';\r\n\r\n/**\r\n * @typedef {import('../../core/Types').ElementLike} Element\r\n * @typedef {import('../../core/Types').ShapeLike} Shape\r\n *\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../modeling/Modeling').default} Modeling\r\n * @typedef {import('../rules/Rules').default} Rules\r\n * @typedef {import('../selection/Selection').default} Selection\r\n */\r\n\r\nvar LOW_PRIORITY = 500,\r\n    MEDIUM_PRIORITY = 1250,\r\n    HIGH_PRIORITY = 1500;\r\n\r\nimport { getOriginal as getOriginalEvent } from '../../util/Event';\r\n\r\nimport {\r\n  isPrimaryButton\r\n} from '../../util/Mouse';\r\n\r\nvar round = Math.round;\r\n\r\nfunction mid(element) {\r\n  return {\r\n    x: element.x + round(element.width / 2),\r\n    y: element.y + round(element.height / 2)\r\n  };\r\n}\r\n\r\n/**\r\n * A plugin that makes shapes draggable / droppable.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Dragging} dragging\r\n * @param {Modeling} modeling\r\n * @param {Selection} selection\r\n * @param {Rules} rules\r\n */\r\nexport default function MoveEvents(\r\n    eventBus, dragging, modeling,\r\n    selection, rules) {\r\n\r\n  // rules\r\n\r\n  function canMove(shapes, delta, position, target) {\r\n\r\n    return rules.allowed('elements.move', {\r\n      shapes: shapes,\r\n      delta: delta,\r\n      position: position,\r\n      target: target\r\n    });\r\n  }\r\n\r\n\r\n  // move events\r\n\r\n  // assign a high priority to this handler to setup the environment\r\n  // others may hook up later, e.g. at default priority and modify\r\n  // the move environment.\r\n  //\r\n  // This sets up the context with\r\n  //\r\n  // * shape: the primary shape being moved\r\n  // * shapes: a list of shapes to be moved\r\n  // * validatedShapes: a list of shapes that are being checked\r\n  //                    against the rules before and during move\r\n  //\r\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(event) {\r\n\r\n    var context = event.context,\r\n        shape = event.shape,\r\n        shapes = selection.get().slice();\r\n\r\n    // move only single shape if the dragged element\r\n    // is not part of the current selection\r\n    if (shapes.indexOf(shape) === -1) {\r\n      shapes = [ shape ];\r\n    }\r\n\r\n    // ensure we remove nested elements in the collection\r\n    // and add attachers for a proper dragger\r\n    shapes = removeNested(shapes);\r\n\r\n    // attach shapes to drag context\r\n    assign(context, {\r\n      shapes: shapes,\r\n      validatedShapes: shapes,\r\n      shape: shape\r\n    });\r\n  });\r\n\r\n\r\n  // assign a high priority to this handler to setup the environment\r\n  // others may hook up later, e.g. at default priority and modify\r\n  // the move environment\r\n  //\r\n  eventBus.on('shape.move.start', MEDIUM_PRIORITY, function(event) {\r\n\r\n    var context = event.context,\r\n        validatedShapes = context.validatedShapes,\r\n        canExecute;\r\n\r\n    canExecute = context.canExecute = canMove(validatedShapes);\r\n\r\n    // check if we can move the elements\r\n    if (!canExecute) {\r\n      return false;\r\n    }\r\n  });\r\n\r\n  // assign a low priority to this handler\r\n  // to let others modify the move event before we update\r\n  // the context\r\n  //\r\n  eventBus.on('shape.move.move', LOW_PRIORITY, function(event) {\r\n\r\n    var context = event.context,\r\n        validatedShapes = context.validatedShapes,\r\n        hover = event.hover,\r\n        delta = { x: event.dx, y: event.dy },\r\n        position = { x: event.x, y: event.y },\r\n        canExecute;\r\n\r\n    // check if we can move the elements\r\n    canExecute = canMove(validatedShapes, delta, position, hover);\r\n\r\n    context.delta = delta;\r\n    context.canExecute = canExecute;\r\n\r\n    // simply ignore move over\r\n    if (canExecute === null) {\r\n      context.target = null;\r\n\r\n      return;\r\n    }\r\n\r\n    context.target = hover;\r\n  });\r\n\r\n  eventBus.on('shape.move.end', function(event) {\r\n\r\n    var context = event.context;\r\n\r\n    var delta = context.delta,\r\n        canExecute = context.canExecute,\r\n        isAttach = canExecute === 'attach',\r\n        shapes = context.shapes;\r\n\r\n    if (canExecute === false) {\r\n      return false;\r\n    }\r\n\r\n    // ensure we have actual pixel values deltas\r\n    // (important when zoom level was > 1 during move)\r\n    delta.x = round(delta.x);\r\n    delta.y = round(delta.y);\r\n\r\n    if (delta.x === 0 && delta.y === 0) {\r\n\r\n      // didn't move\r\n      return;\r\n    }\r\n\r\n    modeling.moveElements(shapes, delta, context.target, {\r\n      primaryShape: context.shape,\r\n      attach: isAttach\r\n    });\r\n  });\r\n\r\n\r\n  // move activation\r\n\r\n  eventBus.on('element.mousedown', function(event) {\r\n\r\n    if (!isPrimaryButton(event)) {\r\n      return;\r\n    }\r\n\r\n    var originalEvent = getOriginalEvent(event);\r\n\r\n    if (!originalEvent) {\r\n      throw new Error('must supply DOM mousedown event');\r\n    }\r\n\r\n    return start(originalEvent, event.element);\r\n  });\r\n\r\n  /**\r\n   * Start move.\r\n   *\r\n   * @param {MouseEvent|TouchEvent} event\r\n   * @param {Shape} element\r\n   * @param {boolean} [activate]\r\n   * @param {Object} [context]\r\n   */\r\n  function start(event, element, activate, context) {\r\n    if (isObject(activate)) {\r\n      context = activate;\r\n      activate = false;\r\n    }\r\n\r\n    // do not move connections or the root element\r\n    if (element.waypoints || !element.parent) {\r\n      return;\r\n    }\r\n\r\n    // ignore non-draggable hits\r\n    if (svgClasses(event.target).has('djs-hit-no-move')) {\r\n      return;\r\n    }\r\n\r\n    var referencePoint = mid(element);\r\n\r\n    dragging.init(event, referencePoint, 'shape.move', {\r\n      cursor: 'grabbing',\r\n      autoActivate: activate,\r\n      data: {\r\n        shape: element,\r\n        context: context || {}\r\n      }\r\n    });\r\n\r\n    // we've handled the event\r\n    return true;\r\n  }\r\n\r\n  // API\r\n\r\n  this.start = start;\r\n}\r\n\r\nMoveEvents.$inject = [\r\n  'eventBus',\r\n  'dragging',\r\n  'modeling',\r\n  'selection',\r\n  'rules'\r\n];\r\n\r\n\r\n/**\r\n * Return a filtered list of elements that do not contain\r\n * those nested into others.\r\n *\r\n * @param {Element[]} elements\r\n *\r\n * @return {Element[]} filtered\r\n */\r\nfunction removeNested(elements) {\r\n\r\n  var ids = groupBy(elements, 'id');\r\n\r\n  return filter(elements, function(element) {\r\n    while ((element = element.parent)) {\r\n\r\n      // parent in selection\r\n      if (ids[element.id]) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  });\r\n}\r\n","import {\r\n  flatten,\r\n  forEach,\r\n  filter,\r\n  find,\r\n  groupBy,\r\n  map,\r\n  matchPattern,\r\n  size\r\n} from 'min-dash';\r\n\r\nimport {\r\n  selfAndAllChildren\r\n} from '../../util/Elements';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\nimport { translate } from '../../util/SvgTransformUtil';\r\n\r\nimport { isConnection } from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../preview-support/PreviewSupport').default} PreviewSupport\r\n * @typedef {import('../../draw/Styles').default} Styles\r\n */\r\n\r\nvar LOW_PRIORITY = 499;\r\n\r\nvar MARKER_DRAGGING = 'djs-dragging',\r\n    MARKER_OK = 'drop-ok',\r\n    MARKER_NOT_OK = 'drop-not-ok',\r\n    MARKER_NEW_PARENT = 'new-parent',\r\n    MARKER_ATTACH = 'attach-ok';\r\n\r\n\r\n/**\r\n * Provides previews for moving shapes when moving.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Styles} styles\r\n * @param {PreviewSupport} previewSupport\r\n */\r\nexport default function MovePreview(\r\n    eventBus, canvas, styles, previewSupport) {\r\n\r\n  function getVisualDragShapes(shapes) {\r\n    var elements = getAllDraggedElements(shapes);\r\n\r\n    var filteredElements = removeEdges(elements);\r\n\r\n    return filteredElements;\r\n  }\r\n\r\n  function getAllDraggedElements(shapes) {\r\n    var allShapes = selfAndAllChildren(shapes, true);\r\n\r\n    var allConnections = map(allShapes, function(shape) {\r\n      return (shape.incoming || []).concat(shape.outgoing || []);\r\n    });\r\n\r\n    return flatten(allShapes.concat(allConnections));\r\n  }\r\n\r\n  /**\r\n   * Sets drop marker on an element.\r\n   */\r\n  function setMarker(element, marker) {\r\n\r\n    [ MARKER_ATTACH, MARKER_OK, MARKER_NOT_OK, MARKER_NEW_PARENT ].forEach(function(m) {\r\n\r\n      if (m === marker) {\r\n        canvas.addMarker(element, m);\r\n      } else {\r\n        canvas.removeMarker(element, m);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Make an element draggable.\r\n   *\r\n   * @param {Object} context\r\n   * @param {Element} element\r\n   * @param {boolean} addMarker\r\n   */\r\n  function makeDraggable(context, element, addMarker) {\r\n\r\n    previewSupport.addDragger(element, context.dragGroup);\r\n\r\n    if (addMarker) {\r\n      canvas.addMarker(element, MARKER_DRAGGING);\r\n    }\r\n\r\n    if (context.allDraggedElements) {\r\n      context.allDraggedElements.push(element);\r\n    } else {\r\n      context.allDraggedElements = [ element ];\r\n    }\r\n  }\r\n\r\n  // assign a low priority to this handler\r\n  // to let others modify the move context before\r\n  // we draw things\r\n  eventBus.on('shape.move.start', LOW_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        dragShapes = context.shapes,\r\n        allDraggedElements = context.allDraggedElements;\r\n\r\n    var visuallyDraggedShapes = getVisualDragShapes(dragShapes);\r\n\r\n    if (!context.dragGroup) {\r\n      var dragGroup = svgCreate('g');\r\n\r\n      svgAttr(dragGroup, styles.cls('djs-drag-group', [ 'no-events' ]));\r\n\r\n      var activeLayer = canvas.getActiveLayer();\r\n\r\n      svgAppend(activeLayer, dragGroup);\r\n\r\n      context.dragGroup = dragGroup;\r\n    }\r\n\r\n    // add previews\r\n    visuallyDraggedShapes.forEach(function(shape) {\r\n      previewSupport.addDragger(shape, context.dragGroup);\r\n    });\r\n\r\n    // cache all dragged elements / gfx\r\n    // so that we can quickly undo their state changes later\r\n    if (!allDraggedElements) {\r\n      allDraggedElements = getAllDraggedElements(dragShapes);\r\n    } else {\r\n      allDraggedElements = flatten([\r\n        allDraggedElements,\r\n        getAllDraggedElements(dragShapes)\r\n      ]);\r\n    }\r\n\r\n    // add dragging marker\r\n    forEach(allDraggedElements, function(e) {\r\n      canvas.addMarker(e, MARKER_DRAGGING);\r\n    });\r\n\r\n    context.allDraggedElements = allDraggedElements;\r\n\r\n    // determine, if any of the dragged elements have different parents\r\n    context.differentParents = haveDifferentParents(dragShapes);\r\n  });\r\n\r\n  // update previews\r\n  eventBus.on('shape.move.move', LOW_PRIORITY, function(event) {\r\n\r\n    var context = event.context,\r\n        dragGroup = context.dragGroup,\r\n        target = context.target,\r\n        parent = context.shape.parent,\r\n        canExecute = context.canExecute;\r\n\r\n    if (target) {\r\n      if (canExecute === 'attach') {\r\n        setMarker(target, MARKER_ATTACH);\r\n      } else if (context.canExecute && parent && target.id !== parent.id) {\r\n        setMarker(target, MARKER_NEW_PARENT);\r\n      } else {\r\n        setMarker(target, context.canExecute ? MARKER_OK : MARKER_NOT_OK);\r\n      }\r\n    }\r\n\r\n    translate(dragGroup, event.dx, event.dy);\r\n  });\r\n\r\n  eventBus.on([ 'shape.move.out', 'shape.move.cleanup' ], function(event) {\r\n    var context = event.context,\r\n        target = context.target;\r\n\r\n    if (target) {\r\n      setMarker(target, null);\r\n    }\r\n  });\r\n\r\n  // remove previews\r\n  eventBus.on('shape.move.cleanup', function(event) {\r\n\r\n    var context = event.context,\r\n        allDraggedElements = context.allDraggedElements,\r\n        dragGroup = context.dragGroup;\r\n\r\n\r\n    // remove dragging marker\r\n    forEach(allDraggedElements, function(e) {\r\n      canvas.removeMarker(e, MARKER_DRAGGING);\r\n    });\r\n\r\n    if (dragGroup) {\r\n      svgRemove(dragGroup);\r\n    }\r\n  });\r\n\r\n\r\n  // API //////////////////////\r\n\r\n  /**\r\n   * Make an element draggable.\r\n   *\r\n   * @param {Object} context\r\n   * @param {Element} element\r\n   * @param {boolean} addMarker\r\n   */\r\n  this.makeDraggable = makeDraggable;\r\n}\r\n\r\nMovePreview.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'styles',\r\n  'previewSupport'\r\n];\r\n\r\n\r\n// helpers //////////////////////\r\n\r\n/**\r\n * returns elements minus all connections\r\n * where source or target is not elements\r\n */\r\nfunction removeEdges(elements) {\r\n\r\n  var filteredElements = filter(elements, function(element) {\r\n\r\n    if (!isConnection(element)) {\r\n      return true;\r\n    } else {\r\n\r\n      return (\r\n        find(elements, matchPattern({ id: element.source.id })) &&\r\n        find(elements, matchPattern({ id: element.target.id }))\r\n      );\r\n    }\r\n  });\r\n\r\n  return filteredElements;\r\n}\r\n\r\nfunction haveDifferentParents(elements) {\r\n  return size(groupBy(elements, function(e) { return e.parent && e.parent.id; })) !== 1;\r\n}\r\n","import InteractionEventsModule from '../interaction-events';\r\nimport SelectionModule from '../selection';\r\nimport OutlineModule from '../outline';\r\nimport RulesModule from '../rules';\r\nimport DraggingModule from '../dragging';\r\nimport PreviewSupportModule from '../preview-support';\r\n\r\nimport Move from './Move';\r\nimport MovePreview from './MovePreview';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    InteractionEventsModule,\r\n    SelectionModule,\r\n    OutlineModule,\r\n    RulesModule,\r\n    DraggingModule,\r\n    PreviewSupportModule\r\n  ],\r\n  __init__: [\r\n    'move',\r\n    'movePreview'\r\n  ],\r\n  move: [ 'type', Move ],\r\n  movePreview: [ 'type', MovePreview ]\r\n};\r\n","import {\r\n  isArray,\r\n  isFunction,\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  domify,\r\n  query as domQuery,\r\n  attr as domAttr,\r\n  clear as domClear,\r\n  classes as domClasses,\r\n  matches as domMatches,\r\n  delegate as domDelegate,\r\n  event as domEvent\r\n} from 'min-dom';\r\n\r\nimport {\r\n  escapeCSS\r\n} from '../../util/EscapeUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('./PaletteProvider').PaletteEntries} PaletteEntries\r\n * @typedef {import('./PaletteProvider').default} PaletteProvider\r\n */\r\n\r\nvar TOGGLE_SELECTOR = '.djs-palette-toggle',\r\n    ENTRY_SELECTOR = '.entry',\r\n    ELEMENT_SELECTOR = TOGGLE_SELECTOR + ', ' + ENTRY_SELECTOR;\r\n\r\nvar PALETTE_PREFIX = 'djs-palette-',\r\n    PALETTE_SHOWN_CLS = 'shown',\r\n    PALETTE_OPEN_CLS = 'open',\r\n    PALETTE_TWO_COLUMN_CLS = 'two-column';\r\n\r\nvar DEFAULT_PRIORITY = 1000;\r\n\r\n\r\n/**\r\n * A palette containing modeling elements.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function Palette(eventBus, canvas) {\r\n\r\n  this._eventBus = eventBus;\r\n  this._canvas = canvas;\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('tool-manager.update', function(event) {\r\n    var tool = event.tool;\r\n\r\n    self.updateToolHighlight(tool);\r\n  });\r\n\r\n  eventBus.on('i18n.changed', function() {\r\n    self._update();\r\n  });\r\n\r\n  eventBus.on('diagram.init', function() {\r\n\r\n    self._diagramInitialized = true;\r\n\r\n    self._rebuild();\r\n  });\r\n}\r\n\r\nPalette.$inject = [ 'eventBus', 'canvas' ];\r\n\r\n/**\r\n * @overlord\r\n *\r\n * Register a palette provider with default priority. See\r\n * {@link PaletteProvider} for examples.\r\n *\r\n * @param {PaletteProvider} provider\r\n */\r\n\r\n/**\r\n * Register a palette provider with the given priority. See\r\n * {@link PaletteProvider} for examples.\r\n *\r\n * @param {number} priority\r\n * @param {PaletteProvider} provider\r\n */\r\nPalette.prototype.registerProvider = function(priority, provider) {\r\n  if (!provider) {\r\n    provider = priority;\r\n    priority = DEFAULT_PRIORITY;\r\n  }\r\n\r\n  this._eventBus.on('palette.getProviders', priority, function(event) {\r\n    event.providers.push(provider);\r\n  });\r\n\r\n  this._rebuild();\r\n};\r\n\r\n\r\n/**\r\n * Returns the palette entries.\r\n *\r\n * @return {PaletteEntries}\r\n */\r\nPalette.prototype.getEntries = function() {\r\n  var providers = this._getProviders();\r\n\r\n  return providers.reduce(addPaletteEntries, {});\r\n};\r\n\r\nPalette.prototype._rebuild = function() {\r\n\r\n  if (!this._diagramInitialized) {\r\n    return;\r\n  }\r\n\r\n  var providers = this._getProviders();\r\n\r\n  if (!providers.length) {\r\n    return;\r\n  }\r\n\r\n  if (!this._container) {\r\n    this._init();\r\n  }\r\n\r\n  this._update();\r\n};\r\n\r\n/**\r\n * Initialize palette.\r\n */\r\nPalette.prototype._init = function() {\r\n\r\n  var self = this;\r\n\r\n  var eventBus = this._eventBus;\r\n\r\n  var parentContainer = this._getParentContainer();\r\n\r\n  var container = this._container = domify(Palette.HTML_MARKUP);\r\n\r\n  parentContainer.appendChild(container);\r\n  domClasses(parentContainer).add(PALETTE_PREFIX + PALETTE_SHOWN_CLS);\r\n\r\n  domDelegate.bind(container, ELEMENT_SELECTOR, 'click', function(event) {\r\n\r\n    var target = event.delegateTarget;\r\n\r\n    if (domMatches(target, TOGGLE_SELECTOR)) {\r\n      return self.toggle();\r\n    }\r\n\r\n    self.trigger('click', event);\r\n  });\r\n\r\n  // prevent drag propagation\r\n  domEvent.bind(container, 'mousedown', function(event) {\r\n    event.stopPropagation();\r\n  });\r\n\r\n  // prevent drag propagation\r\n  domDelegate.bind(container, ENTRY_SELECTOR, 'dragstart', function(event) {\r\n    self.trigger('dragstart', event);\r\n  });\r\n\r\n  eventBus.on('canvas.resized', this._layoutChanged, this);\r\n\r\n  eventBus.fire('palette.create', {\r\n    container: container\r\n  });\r\n};\r\n\r\nPalette.prototype._getProviders = function(id) {\r\n\r\n  var event = this._eventBus.createEvent({\r\n    type: 'palette.getProviders',\r\n    providers: []\r\n  });\r\n\r\n  this._eventBus.fire(event);\r\n\r\n  return event.providers;\r\n};\r\n\r\n/**\r\n * Update palette state.\r\n *\r\n * @param { {\r\n *   open?: boolean;\r\n *   twoColumn?: boolean;\r\n * } } [state]\r\n */\r\nPalette.prototype._toggleState = function(state) {\r\n\r\n  state = state || {};\r\n\r\n  var parent = this._getParentContainer(),\r\n      container = this._container;\r\n\r\n  var eventBus = this._eventBus;\r\n\r\n  var twoColumn;\r\n\r\n  var cls = domClasses(container),\r\n      parentCls = domClasses(parent);\r\n\r\n  if ('twoColumn' in state) {\r\n    twoColumn = state.twoColumn;\r\n  } else {\r\n    twoColumn = this._needsCollapse(parent.clientHeight, this._entries || {});\r\n  }\r\n\r\n  // always update two column\r\n  cls.toggle(PALETTE_TWO_COLUMN_CLS, twoColumn);\r\n  parentCls.toggle(PALETTE_PREFIX + PALETTE_TWO_COLUMN_CLS, twoColumn);\r\n\r\n  if ('open' in state) {\r\n    cls.toggle(PALETTE_OPEN_CLS, state.open);\r\n    parentCls.toggle(PALETTE_PREFIX + PALETTE_OPEN_CLS, state.open);\r\n  }\r\n\r\n  eventBus.fire('palette.changed', {\r\n    twoColumn: twoColumn,\r\n    open: this.isOpen()\r\n  });\r\n};\r\n\r\nPalette.prototype._update = function() {\r\n\r\n  var entriesContainer = domQuery('.djs-palette-entries', this._container),\r\n      entries = this._entries = this.getEntries();\r\n\r\n  domClear(entriesContainer);\r\n\r\n  forEach(entries, function(entry, id) {\r\n\r\n    var grouping = entry.group || 'default';\r\n\r\n    var container = domQuery('[data-group=' + escapeCSS(grouping) + ']', entriesContainer);\r\n    if (!container) {\r\n      container = domify('<div class=\"group\"></div>');\r\n      domAttr(container, 'data-group', grouping);\r\n\r\n      entriesContainer.appendChild(container);\r\n    }\r\n\r\n    var html = entry.html || (\r\n      entry.separator ?\r\n        '<hr class=\"separator\" />' :\r\n        '<div class=\"entry\" draggable=\"true\"></div>');\r\n\r\n\r\n    var control = domify(html);\r\n    container.appendChild(control);\r\n\r\n    if (!entry.separator) {\r\n      domAttr(control, 'data-action', id);\r\n\r\n      if (entry.title) {\r\n        domAttr(control, 'title', entry.title);\r\n      }\r\n\r\n      if (entry.className) {\r\n        addClasses(control, entry.className);\r\n      }\r\n\r\n      if (entry.imageUrl) {\r\n        var image = domify('<img>');\r\n        domAttr(image, 'src', entry.imageUrl);\r\n\r\n        control.appendChild(image);\r\n      }\r\n    }\r\n  });\r\n\r\n  // open after update\r\n  this.open();\r\n};\r\n\r\n\r\n/**\r\n * Trigger an action available on the palette\r\n *\r\n * @param {string} action\r\n * @param {Event} event\r\n * @param {boolean} [autoActivate=false]\r\n */\r\nPalette.prototype.trigger = function(action, event, autoActivate) {\r\n  var entry,\r\n      originalEvent,\r\n      button = event.delegateTarget || event.target;\r\n\r\n  if (!button) {\r\n    return event.preventDefault();\r\n  }\r\n\r\n  entry = domAttr(button, 'data-action');\r\n  originalEvent = event.originalEvent || event;\r\n\r\n  return this.triggerEntry(entry, action, originalEvent, autoActivate);\r\n};\r\n\r\n/**\r\n * @param {string} entryId\r\n * @param {string} action\r\n * @param {Event} event\r\n * @param {boolean} [autoActivate=false]\r\n */\r\nPalette.prototype.triggerEntry = function(entryId, action, event, autoActivate) {\r\n  var entries = this._entries,\r\n      entry,\r\n      handler;\r\n\r\n  entry = entries[entryId];\r\n\r\n  // when user clicks on the palette and not on an action\r\n  if (!entry) {\r\n    return;\r\n  }\r\n\r\n  handler = entry.action;\r\n\r\n  if (this._eventBus.fire('palette.trigger', { entry, event }) === false) {\r\n    return;\r\n  }\r\n\r\n  // simple action (via callback function)\r\n  if (isFunction(handler)) {\r\n    if (action === 'click') {\r\n      return handler(event, autoActivate);\r\n    }\r\n  } else {\r\n    if (handler[action]) {\r\n      return handler[action](event, autoActivate);\r\n    }\r\n  }\r\n\r\n  // silence other actions\r\n  event.preventDefault();\r\n};\r\n\r\nPalette.prototype._layoutChanged = function() {\r\n  this._toggleState({});\r\n};\r\n\r\n/**\r\n * Do we need to collapse to two columns?\r\n *\r\n * @param {number} availableHeight\r\n * @param {PaletteEntries} entries\r\n *\r\n * @return {boolean}\r\n */\r\nPalette.prototype._needsCollapse = function(availableHeight, entries) {\r\n\r\n  // top margin + bottom toggle + bottom margin\r\n  // implementors must override this method if they\r\n  // change the palette styles\r\n  var margin = 20 + 10 + 20;\r\n\r\n  var entriesHeight = Object.keys(entries).length * 46;\r\n\r\n  return availableHeight < entriesHeight + margin;\r\n};\r\n\r\n/**\r\n * Close the palette.\r\n */\r\nPalette.prototype.close = function() {\r\n  this._toggleState({\r\n    open: false,\r\n    twoColumn: false\r\n  });\r\n};\r\n\r\n/**\r\n * Open the palette.\r\n */\r\nPalette.prototype.open = function() {\r\n  this._toggleState({ open: true });\r\n};\r\n\r\n/**\r\n * Toggle the palette.\r\n */\r\nPalette.prototype.toggle = function() {\r\n  if (this.isOpen()) {\r\n    this.close();\r\n  } else {\r\n    this.open();\r\n  }\r\n};\r\n\r\n/**\r\n * @param {string} tool\r\n *\r\n * @return {boolean}\r\n */\r\nPalette.prototype.isActiveTool = function(tool) {\r\n  return tool && this._activeTool === tool;\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n */\r\nPalette.prototype.updateToolHighlight = function(name) {\r\n  var entriesContainer,\r\n      toolsContainer;\r\n\r\n  if (!this._toolsContainer) {\r\n    entriesContainer = domQuery('.djs-palette-entries', this._container);\r\n\r\n    this._toolsContainer = domQuery('[data-group=tools]', entriesContainer);\r\n  }\r\n\r\n  toolsContainer = this._toolsContainer;\r\n\r\n  forEach(toolsContainer.children, function(tool) {\r\n    var actionName = tool.getAttribute('data-action');\r\n\r\n    if (!actionName) {\r\n      return;\r\n    }\r\n\r\n    var toolClasses = domClasses(tool);\r\n\r\n    actionName = actionName.replace('-tool', '');\r\n\r\n    if (toolClasses.contains('entry') && actionName === name) {\r\n      toolClasses.add('highlighted-entry');\r\n    } else {\r\n      toolClasses.remove('highlighted-entry');\r\n    }\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Return `true` if the palette is opened.\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * palette.open();\r\n *\r\n * if (palette.isOpen()) {\r\n *   // yes, we are open\r\n * }\r\n * ```\r\n *\r\n * @return {boolean}\r\n */\r\nPalette.prototype.isOpen = function() {\r\n  return domClasses(this._container).has(PALETTE_OPEN_CLS);\r\n};\r\n\r\n/**\r\n * Get parent element of palette.\r\n *\r\n * @return {HTMLElement}\r\n */\r\nPalette.prototype._getParentContainer = function() {\r\n  return this._canvas.getContainer();\r\n};\r\n\r\n\r\n/* markup definition */\r\n\r\nPalette.HTML_MARKUP =\r\n  '<div class=\"djs-palette\">' +\r\n    '<div class=\"djs-palette-entries\"></div>' +\r\n    '<div class=\"djs-palette-toggle\"></div>' +\r\n  '</div>';\r\n\r\n\r\n// helpers //////////////////////\r\n\r\nfunction addClasses(element, classNames) {\r\n\r\n  var classes = domClasses(element);\r\n\r\n  var actualClassNames = isArray(classNames) ? classNames : classNames.split(/\\s+/g);\r\n  actualClassNames.forEach(function(cls) {\r\n    classes.add(cls);\r\n  });\r\n}\r\n\r\nfunction addPaletteEntries(entries, provider) {\r\n\r\n  var entriesOrUpdater = provider.getPaletteEntries();\r\n\r\n  if (isFunction(entriesOrUpdater)) {\r\n    return entriesOrUpdater(entries);\r\n  }\r\n\r\n  forEach(entriesOrUpdater, function(entry, id) {\r\n    entries[id] = entry;\r\n  });\r\n\r\n  return entries;\r\n}","import Palette from './Palette';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [ 'palette' ],\r\n  palette: [ 'type', Palette ]\r\n};\r\n","import { values } from 'min-dash';\r\n\r\nimport { getEnclosedElements } from '../../util/Elements';\r\n\r\nimport {\r\n  hasSecondaryModifier\r\n} from '../../util/Mouse';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../mouse/Mouse').default} Mouse\r\n * @typedef {import('../selection/Selection').default} Selection\r\n * @typedef {import('../tool-manager/ToolManager').default} ToolManager\r\n *\r\n * @typedef {import('../../util/Types').Rect} Rect\r\n */\r\n\r\nvar LASSO_TOOL_CURSOR = 'crosshair';\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Dragging} dragging\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {Selection} selection\r\n * @param {ToolManager} toolManager\r\n * @param {Mouse} mouse\r\n */\r\nexport default function LassoTool(\r\n    eventBus, canvas, dragging,\r\n    elementRegistry, selection, toolManager,\r\n    mouse) {\r\n\r\n  this._selection = selection;\r\n  this._dragging = dragging;\r\n  this._mouse = mouse;\r\n\r\n  var self = this;\r\n\r\n  // lasso visuals implementation\r\n\r\n  /**\r\n  * A helper that realizes the selection box visual\r\n  */\r\n  var visuals = {\r\n\r\n    create: function(context) {\r\n      var container = canvas.getActiveLayer(),\r\n          frame;\r\n\r\n      frame = context.frame = svgCreate('rect');\r\n      svgAttr(frame, {\r\n        class: 'djs-lasso-overlay',\r\n        width:  1,\r\n        height: 1,\r\n        x: 0,\r\n        y: 0\r\n      });\r\n\r\n      svgAppend(container, frame);\r\n    },\r\n\r\n    update: function(context) {\r\n      var frame = context.frame,\r\n          bbox = context.bbox;\r\n\r\n      svgAttr(frame, {\r\n        x: bbox.x,\r\n        y: bbox.y,\r\n        width: bbox.width,\r\n        height: bbox.height\r\n      });\r\n    },\r\n\r\n    remove: function(context) {\r\n\r\n      if (context.frame) {\r\n        svgRemove(context.frame);\r\n      }\r\n    }\r\n  };\r\n\r\n  toolManager.registerTool('lasso', {\r\n    tool: 'lasso.selection',\r\n    dragging: 'lasso'\r\n  });\r\n\r\n  eventBus.on('lasso.selection.end', function(event) {\r\n    var target = event.originalEvent.target;\r\n\r\n    // only reactive on diagram click\r\n    // on some occasions, event.hover is not set and we have to check if the target is an svg\r\n    if (!event.hover && !(target instanceof SVGElement)) {\r\n      return;\r\n    }\r\n\r\n    eventBus.once('lasso.selection.ended', function() {\r\n      self.activateLasso(event.originalEvent, true);\r\n    });\r\n  });\r\n\r\n  // lasso interaction implementation\r\n\r\n  eventBus.on('lasso.end', 0, function(event) {\r\n\r\n    var context = event.context;\r\n\r\n    var bbox = toBBox(event);\r\n\r\n    var elements = elementRegistry.filter(function(element) {\r\n      return element;\r\n    });\r\n\r\n    var add = hasSecondaryModifier(event);\r\n\r\n    self.select(elements, bbox, add ? context.selection : []);\r\n  });\r\n\r\n  eventBus.on('lasso.start', function(event) {\r\n\r\n    var context = event.context;\r\n\r\n    context.bbox = toBBox(event);\r\n    visuals.create(context);\r\n\r\n    context.selection = selection.get();\r\n  });\r\n\r\n  eventBus.on('lasso.move', function(event) {\r\n\r\n    var context = event.context;\r\n\r\n    context.bbox = toBBox(event);\r\n    visuals.update(context);\r\n  });\r\n\r\n  eventBus.on('lasso.cleanup', function(event) {\r\n\r\n    var context = event.context;\r\n\r\n    visuals.remove(context);\r\n  });\r\n\r\n\r\n  // event integration\r\n\r\n  eventBus.on('element.mousedown', 1500, function(event) {\r\n\r\n    if (!hasSecondaryModifier(event)) {\r\n      return;\r\n    }\r\n\r\n    self.activateLasso(event.originalEvent);\r\n\r\n    // we've handled the event\r\n    return true;\r\n  });\r\n}\r\n\r\nLassoTool.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'dragging',\r\n  'elementRegistry',\r\n  'selection',\r\n  'toolManager',\r\n  'mouse'\r\n];\r\n\r\n/**\r\n * Activate lasso.\r\n *\r\n * @param {MouseEvent} event\r\n * @param {boolean} [autoActivate=false]\r\n */\r\nLassoTool.prototype.activateLasso = function(event, autoActivate) {\r\n\r\n  this._dragging.init(event, 'lasso', {\r\n    autoActivate: autoActivate,\r\n    cursor: LASSO_TOOL_CURSOR,\r\n    data: {\r\n      context: {}\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Activate selection.\r\n *\r\n * @param {MouseEvent} event\r\n * @param {boolean} [autoActivate=false]\r\n */\r\nLassoTool.prototype.activateSelection = function(event, autoActivate) {\r\n\r\n  this._dragging.init(event, 'lasso.selection', {\r\n    trapClick: false,\r\n    autoActivate: autoActivate,\r\n    cursor: LASSO_TOOL_CURSOR,\r\n    data: {\r\n      context: {}\r\n    },\r\n    keepSelection: true\r\n  });\r\n};\r\n\r\n/**\r\n * Select elements within the given bounds.\r\n *\r\n * @param {Element[]} elements\r\n * @param {Rect} bbox\r\n * @param {Element[]} [previousSelection]\r\n */\r\nLassoTool.prototype.select = function(elements, bbox, previousSelection = []) {\r\n  var selectedElements = getEnclosedElements(elements, bbox);\r\n\r\n  this._selection.select([\r\n    ...previousSelection,\r\n    ...values(selectedElements)\r\n  ]);\r\n};\r\n\r\n/**\r\n * Toggle the lasso tool.\r\n */\r\nLassoTool.prototype.toggle = function() {\r\n  if (this.isActive()) {\r\n    return this._dragging.cancel();\r\n  }\r\n\r\n  var mouseEvent = this._mouse.getLastMoveEvent();\r\n\r\n  this.activateSelection(mouseEvent, !!mouseEvent);\r\n};\r\n\r\n/**\r\n * Check if the lasso tool is active.\r\n *\r\n * @returns {boolean}\r\n */\r\nLassoTool.prototype.isActive = function() {\r\n  var context = this._dragging.context();\r\n\r\n  return context && /^lasso/.test(context.prefix);\r\n};\r\n\r\n\r\nfunction toBBox(event) {\r\n\r\n  var start = {\r\n\r\n    x: event.x - event.dx,\r\n    y: event.y - event.dy\r\n  };\r\n\r\n  var end = {\r\n    x: event.x,\r\n    y: event.y\r\n  };\r\n\r\n  var bbox;\r\n\r\n  if ((start.x <= end.x && start.y < end.y) ||\r\n      (start.x < end.x && start.y <= end.y)) {\r\n\r\n    bbox = {\r\n      x: start.x,\r\n      y: start.y,\r\n      width:  end.x - start.x,\r\n      height: end.y - start.y\r\n    };\r\n  } else if ((start.x >= end.x && start.y < end.y) ||\r\n             (start.x > end.x && start.y <= end.y)) {\r\n\r\n    bbox = {\r\n      x: end.x,\r\n      y: start.y,\r\n      width:  start.x - end.x,\r\n      height: end.y - start.y\r\n    };\r\n  } else if ((start.x <= end.x && start.y > end.y) ||\r\n             (start.x < end.x && start.y >= end.y)) {\r\n\r\n    bbox = {\r\n      x: start.x,\r\n      y: end.y,\r\n      width:  end.x - start.x,\r\n      height: start.y - end.y\r\n    };\r\n  } else if ((start.x >= end.x && start.y > end.y) ||\r\n             (start.x > end.x && start.y >= end.y)) {\r\n\r\n    bbox = {\r\n      x: end.x,\r\n      y: end.y,\r\n      width:  start.x - end.x,\r\n      height: start.y - end.y\r\n    };\r\n  } else {\r\n\r\n    bbox = {\r\n      x: end.x,\r\n      y: end.y,\r\n      width:  0,\r\n      height: 0\r\n    };\r\n  }\r\n  return bbox;\r\n}\r\n","import ToolManagerModule from '../tool-manager';\r\nimport MouseModule from '../mouse';\r\n\r\nimport LassoTool from './LassoTool';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    ToolManagerModule,\r\n    MouseModule\r\n  ],\r\n  __init__: [ 'lassoTool' ],\r\n  lassoTool: [ 'type', LassoTool ]\r\n};\r\n","import {\r\n  hasPrimaryModifier\r\n} from '../../util/Mouse';\r\n\r\nimport { isKey } from '../../features/keyboard/KeyboardUtil';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n *\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../mouse/Mouse').default} Mouse\r\n * @typedef {import('../tool-manager/ToolManager').default} ToolManager\r\n */\r\n\r\nvar HIGH_PRIORITY = 1500;\r\nvar HAND_CURSOR = 'grab';\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {Dragging} dragging\r\n * @param {Injector} injector\r\n * @param {ToolManager} toolManager\r\n * @param {Mouse} mouse\r\n */\r\nexport default function HandTool(\r\n    eventBus, canvas, dragging,\r\n    injector, toolManager, mouse) {\r\n\r\n  this._dragging = dragging;\r\n  this._mouse = mouse;\r\n\r\n  var self = this,\r\n      keyboard = injector.get('keyboard', false);\r\n\r\n  toolManager.registerTool('hand', {\r\n    tool: 'hand',\r\n    dragging: 'hand.move'\r\n  });\r\n\r\n  eventBus.on('element.mousedown', HIGH_PRIORITY, function(event) {\r\n\r\n    if (!hasPrimaryModifier(event)) {\r\n      return;\r\n    }\r\n\r\n    self.activateMove(event.originalEvent, true);\r\n\r\n    return false;\r\n  });\r\n\r\n  keyboard && keyboard.addListener(HIGH_PRIORITY, function(e) {\r\n    if (!isSpace(e.keyEvent) || self.isActive()) {\r\n      return;\r\n    }\r\n\r\n    var mouseEvent = self._mouse.getLastMoveEvent();\r\n\r\n    self.activateMove(mouseEvent, !!mouseEvent);\r\n  }, 'keyboard.keydown');\r\n\r\n  keyboard && keyboard.addListener(HIGH_PRIORITY, function(e) {\r\n    if (!isSpace(e.keyEvent) || !self.isActive()) {\r\n      return;\r\n    }\r\n\r\n    self.toggle();\r\n  }, 'keyboard.keyup');\r\n\r\n  eventBus.on('hand.end', function(event) {\r\n    var target = event.originalEvent.target;\r\n\r\n    // only reactive on diagram click\r\n    // on some occasions, event.hover is not set and we have to check if the target is an svg\r\n    if (!event.hover && !(target instanceof SVGElement)) {\r\n      return false;\r\n    }\r\n\r\n    eventBus.once('hand.ended', function() {\r\n      self.activateMove(event.originalEvent, { reactivate: true });\r\n    });\r\n\r\n  });\r\n\r\n  eventBus.on('hand.move.move', function(event) {\r\n    var scale = canvas.viewbox().scale;\r\n\r\n    canvas.scroll({\r\n      dx: event.dx * scale,\r\n      dy: event.dy * scale\r\n    });\r\n  });\r\n\r\n  eventBus.on('hand.move.end', function(event) {\r\n    var context = event.context,\r\n        reactivate = context.reactivate;\r\n\r\n    // Don't reactivate if the user is using the keyboard keybinding\r\n    if (!hasPrimaryModifier(event) && reactivate) {\r\n\r\n      eventBus.once('hand.move.ended', function(event) {\r\n        self.activateHand(event.originalEvent, true, true);\r\n      });\r\n\r\n    }\r\n\r\n    return false;\r\n  });\r\n\r\n}\r\n\r\nHandTool.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'dragging',\r\n  'injector',\r\n  'toolManager',\r\n  'mouse'\r\n];\r\n\r\n/**\r\n *\r\n * @param event\r\n * @param {boolean} [autoActivate]\r\n * @param {object} [context]\r\n */\r\nHandTool.prototype.activateMove = function(event, autoActivate, context) {\r\n  if (typeof autoActivate === 'object') {\r\n    context = autoActivate;\r\n    autoActivate = false;\r\n  }\r\n\r\n  this._dragging.init(event, 'hand.move', {\r\n    autoActivate: autoActivate,\r\n    cursor: HAND_CURSOR,\r\n    data: {\r\n      context: context || {}\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n *\r\n * @param event\r\n * @param {boolean} [autoActivate]\r\n * @param {boolean} [reactivate]\r\n */\r\nHandTool.prototype.activateHand = function(event, autoActivate, reactivate) {\r\n  this._dragging.init(event, 'hand', {\r\n    trapClick: false,\r\n    autoActivate: autoActivate,\r\n    cursor: HAND_CURSOR,\r\n    data: {\r\n      context: {\r\n        reactivate: reactivate\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nHandTool.prototype.toggle = function() {\r\n  if (this.isActive()) {\r\n    return this._dragging.cancel();\r\n  }\r\n\r\n  var mouseEvent = this._mouse.getLastMoveEvent();\r\n\r\n  this.activateHand(mouseEvent, !!mouseEvent);\r\n};\r\n\r\nHandTool.prototype.isActive = function() {\r\n  var context = this._dragging.context();\r\n\r\n  if (context) {\r\n    return /^(hand|hand\\.move)$/.test(context.prefix);\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction isSpace(keyEvent) {\r\n  return isKey('Space', keyEvent);\r\n}","import ToolManagerModule from '../tool-manager';\r\nimport MouseModule from '../mouse';\r\n\r\nimport HandTool from './HandTool';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    ToolManagerModule,\r\n    MouseModule\r\n  ],\r\n  __init__: [ 'handTool' ],\r\n  handTool: [ 'type', HandTool ]\r\n};\r\n","var MARKER_OK = 'connect-ok',\r\n    MARKER_NOT_OK = 'connect-not-ok';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../connect/Connect').default} Connect\r\n * @typedef {import('../dragging/Dragging').default} Dragging\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../mouse/Mouse').default} Mouse\r\n * @typedef {import('../rules/Rules').default} Rules\r\n * @typedef {import('../tool-manager/ToolManager').default} ToolManager\r\n *\r\n * @typedef {import('../../model/Types').Element} Element\r\n */\r\n\r\n/**\r\n * @class\r\n * @constructor\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Dragging} dragging\r\n * @param {Connect} connect\r\n * @param {Canvas} canvas\r\n * @param {ToolManager} toolManager\r\n * @param {Rules} rules\r\n * @param {Mouse} mouse\r\n */\r\nexport default function GlobalConnect(\r\n    eventBus, dragging, connect,\r\n    canvas, toolManager, rules,\r\n    mouse) {\r\n\r\n  var self = this;\r\n\r\n  this._dragging = dragging;\r\n  this._rules = rules;\r\n  this._mouse = mouse;\r\n\r\n  toolManager.registerTool('global-connect', {\r\n    tool: 'global-connect',\r\n    dragging: 'global-connect.drag'\r\n  });\r\n\r\n  eventBus.on('global-connect.hover', function(event) {\r\n    var context = event.context,\r\n        startTarget = event.hover;\r\n\r\n    var canStartConnect = context.canStartConnect = self.canStartConnect(startTarget);\r\n\r\n    // simply ignore hover\r\n    if (canStartConnect === null) {\r\n      return;\r\n    }\r\n\r\n    context.startTarget = startTarget;\r\n\r\n    canvas.addMarker(startTarget, canStartConnect ? MARKER_OK : MARKER_NOT_OK);\r\n  });\r\n\r\n\r\n  eventBus.on([ 'global-connect.out', 'global-connect.cleanup' ], function(event) {\r\n    var startTarget = event.context.startTarget,\r\n        canStartConnect = event.context.canStartConnect;\r\n\r\n    if (startTarget) {\r\n      canvas.removeMarker(startTarget, canStartConnect ? MARKER_OK : MARKER_NOT_OK);\r\n    }\r\n  });\r\n\r\n\r\n  eventBus.on([ 'global-connect.ended' ], function(event) {\r\n    var context = event.context,\r\n        startTarget = context.startTarget,\r\n        startPosition = {\r\n          x: event.x,\r\n          y: event.y\r\n        };\r\n\r\n    var canStartConnect = self.canStartConnect(startTarget);\r\n\r\n    if (!canStartConnect) {\r\n      return;\r\n    }\r\n\r\n    eventBus.once('element.out', function() {\r\n      eventBus.once([ 'connect.ended', 'connect.canceled' ], function() {\r\n        eventBus.fire('global-connect.drag.ended');\r\n      });\r\n\r\n      connect.start(null, startTarget, startPosition);\r\n    });\r\n\r\n    return false;\r\n  });\r\n}\r\n\r\nGlobalConnect.$inject = [\r\n  'eventBus',\r\n  'dragging',\r\n  'connect',\r\n  'canvas',\r\n  'toolManager',\r\n  'rules',\r\n  'mouse'\r\n];\r\n\r\n/**\r\n * Initiates tool activity.\r\n */\r\nGlobalConnect.prototype.start = function(event, autoActivate) {\r\n  this._dragging.init(event, 'global-connect', {\r\n    autoActivate: autoActivate,\r\n    trapClick: false,\r\n    data: {\r\n      context: {}\r\n    }\r\n  });\r\n};\r\n\r\nGlobalConnect.prototype.toggle = function() {\r\n\r\n  if (this.isActive()) {\r\n    return this._dragging.cancel();\r\n  }\r\n\r\n  var mouseEvent = this._mouse.getLastMoveEvent();\r\n\r\n  return this.start(mouseEvent, !!mouseEvent);\r\n};\r\n\r\nGlobalConnect.prototype.isActive = function() {\r\n  var context = this._dragging.context();\r\n\r\n  return context && /^global-connect/.test(context.prefix);\r\n};\r\n\r\n/**\r\n * Check if source element can initiate connection.\r\n *\r\n * @param {Element} startTarget\r\n * @return {boolean}\r\n */\r\nGlobalConnect.prototype.canStartConnect = function(startTarget) {\r\n  return this._rules.allowed('connection.start', { source: startTarget });\r\n};\r\n","import ConnectModule from '../connect';\r\nimport RulesModule from '../rules';\r\nimport DraggingModule from '../dragging';\r\nimport ToolManagerModule from '../tool-manager';\r\nimport MouseModule from '../mouse';\r\n\r\nimport GlobalConnect from './GlobalConnect';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    ConnectModule,\r\n    RulesModule,\r\n    DraggingModule,\r\n    ToolManagerModule,\r\n    MouseModule\r\n  ],\r\n  globalConnect: [ 'type', GlobalConnect ]\r\n};\r\n","import {\n  assign\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/features/palette/Palette').default} Palette\n * @typedef {import('diagram-js/lib/features/create/Create').default} Create\n * @typedef {import('diagram-js/lib/core/ElementFactory').default} ElementFactory\n * @typedef {import('../space-tool/BpmnSpaceTool').default} SpaceTool\n * @typedef {import('diagram-js/lib/features/lasso-tool/LassoTool').default} LassoTool\n * @typedef {import('diagram-js/lib/features/hand-tool/HandTool').default} HandTool\n * @typedef {import('diagram-js/lib/features/global-connect/GlobalConnect').default} GlobalConnect\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('diagram-js/lib/features/palette/Palette').PaletteEntries} PaletteEntries\n */\n\n/**\n * A palette provider for BPMN 2.0 elements.\n *\n * @param {Palette} palette\n * @param {Create} create\n * @param {ElementFactory} elementFactory\n * @param {SpaceTool} spaceTool\n * @param {LassoTool} lassoTool\n * @param {HandTool} handTool\n * @param {GlobalConnect} globalConnect\n * @param {Translate} translate\n */\nexport default function PaletteProvider(\n    palette, create, elementFactory,\n    spaceTool, lassoTool, handTool,\n    globalConnect, translate) {\n\n  this._palette = palette;\n  this._create = create;\n  this._elementFactory = elementFactory;\n  this._spaceTool = spaceTool;\n  this._lassoTool = lassoTool;\n  this._handTool = handTool;\n  this._globalConnect = globalConnect;\n  this._translate = translate;\n\n  palette.registerProvider(this);\n}\n\nPaletteProvider.$inject = [\n  'palette',\n  'create',\n  'elementFactory',\n  'spaceTool',\n  'lassoTool',\n  'handTool',\n  'globalConnect',\n  'translate'\n];\n\n/**\n * @return {PaletteEntries}\n */\nPaletteProvider.prototype.getPaletteEntries = function() {\n\n  var actions = {},\n      create = this._create,\n      elementFactory = this._elementFactory,\n      spaceTool = this._spaceTool,\n      lassoTool = this._lassoTool,\n      handTool = this._handTool,\n      globalConnect = this._globalConnect,\n      translate = this._translate;\n\n  function createAction(type, group, className, title, options) {\n\n    function createListener(event) {\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n      create.start(event, shape);\n    }\n\n    return {\n      group: group,\n      className: className,\n      title: title,\n      action: {\n        dragstart: createListener,\n        click: createListener\n      }\n    };\n  }\n\n  function createSubprocess(event) {\n    var subProcess = elementFactory.createShape({\n      type: 'bpmn:SubProcess',\n      x: 0,\n      y: 0,\n      isExpanded: true\n    });\n\n    var startEvent = elementFactory.createShape({\n      type: 'bpmn:StartEvent',\n      x: 40,\n      y: 82,\n      parent: subProcess\n    });\n\n    create.start(event, [ subProcess, startEvent ], {\n      hints: {\n        autoSelect: [ subProcess ]\n      }\n    });\n  }\n\n  function createParticipant(event) {\n    create.start(event, elementFactory.createParticipantShape());\n  }\n\n  assign(actions, {\n    'hand-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-hand-tool',\n      title: translate('Activate hand tool'),\n      action: {\n        click: function(event) {\n          handTool.activateHand(event);\n        }\n      }\n    },\n    'lasso-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-lasso-tool',\n      title: translate('Activate lasso tool'),\n      action: {\n        click: function(event) {\n          lassoTool.activateSelection(event);\n        }\n      }\n    },\n    'space-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-space-tool',\n      title: translate('Activate create/remove space tool'),\n      action: {\n        click: function(event) {\n          spaceTool.activateSelection(event);\n        }\n      }\n    },\n    'global-connect-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-connection-multi',\n      title: translate('Activate global connect tool'),\n      action: {\n        click: function(event) {\n          globalConnect.start(event);\n        }\n      }\n    },\n    'tool-separator': {\n      group: 'tools',\n      separator: true\n    },\n    'create.start-event': createAction(\n      'bpmn:StartEvent', 'event', 'bpmn-icon-start-event-none',\n      translate('Create start event')\n    ),\n    'create.intermediate-event': createAction(\n      'bpmn:IntermediateThrowEvent', 'event', 'bpmn-icon-intermediate-event-none',\n      translate('Create intermediate/boundary event')\n    ),\n    'create.end-event': createAction(\n      'bpmn:EndEvent', 'event', 'bpmn-icon-end-event-none',\n      translate('Create end event')\n    ),\n    'create.exclusive-gateway': createAction(\n      'bpmn:ExclusiveGateway', 'gateway', 'bpmn-icon-gateway-none',\n      translate('Create gateway')\n    ),\n    'create.task': createAction(\n      'bpmn:Task', 'activity', 'bpmn-icon-task',\n      translate('Create task')\n    ),\n    'create.data-object': createAction(\n      'bpmn:DataObjectReference', 'data-object', 'bpmn-icon-data-object',\n      translate('Create data object reference')\n    ),\n    'create.data-store': createAction(\n      'bpmn:DataStoreReference', 'data-store', 'bpmn-icon-data-store',\n      translate('Create data store reference')\n    ),\n    'create.subprocess-expanded': {\n      group: 'activity',\n      className: 'bpmn-icon-subprocess-expanded',\n      title: translate('Create expanded sub-process'),\n      action: {\n        dragstart: createSubprocess,\n        click: createSubprocess\n      }\n    },\n    'create.participant-expanded': {\n      group: 'collaboration',\n      className: 'bpmn-icon-participant',\n      title: translate('Create pool/participant'),\n      action: {\n        dragstart: createParticipant,\n        click: createParticipant\n      }\n    },\n    'create.group': createAction(\n      'bpmn:Group', 'artifact', 'bpmn-icon-group',\n      translate('Create group')\n    ),\n  });\n\n  return actions;\n};\n","import PaletteModule from 'diagram-js/lib/features/palette';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport SpaceToolModule from '../space-tool';\nimport LassoToolModule from 'diagram-js/lib/features/lasso-tool';\nimport HandToolModule from 'diagram-js/lib/features/hand-tool';\nimport GlobalConnectModule from 'diagram-js/lib/features/global-connect';\nimport translate from 'diagram-js/lib/i18n/translate';\n\nimport PaletteProvider from './PaletteProvider';\n\nexport default {\n  __depends__: [\n    PaletteModule,\n    CreateModule,\n    SpaceToolModule,\n    LassoToolModule,\n    HandToolModule,\n    GlobalConnectModule,\n    translate\n  ],\n  __init__: [ 'paletteProvider' ],\n  paletteProvider: [ 'type', PaletteProvider ]\n};\n","import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport inherits from 'inherits-browser';\n\nimport { escapeCSS as cssEscape } from 'diagram-js/lib/util/EscapeUtil';\n\nimport {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport {\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  attr as svgAttr\n} from 'tiny-svg';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/ElementFactory').default} ElementFactory\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/features/preview-support/PreviewSupport').default} PreviewSupport\n */\n\nvar LOW_PRIORITY = 250;\n\n/**\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {ElementFactory} elementFactory\n * @param {Canvas} canvas\n * @param {PreviewSupport} previewSupport\n */\nexport default function BpmnReplacePreview(\n    eventBus, elementRegistry, elementFactory,\n    canvas, previewSupport) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Replace the visuals of all elements in the context which can be replaced\n   *\n   * @param  {Object} context\n   */\n  function replaceVisual(context) {\n\n    var replacements = context.canExecute.replacements;\n\n    forEach(replacements, function(replacement) {\n\n      var id = replacement.oldElementId;\n\n      var newElement = {\n        type: replacement.newElementType\n      };\n\n      // if the visual of the element is already replaced\n      if (context.visualReplacements[id]) {\n        return;\n      }\n\n      var element = elementRegistry.get(id);\n\n      assign(newElement, { x: element.x, y: element.y });\n\n      // create a temporary shape\n      var tempShape = elementFactory.createShape(newElement);\n\n      canvas.addShape(tempShape, element.parent);\n\n      // select the original SVG element related to the element and hide it\n      var gfx = domQuery('[data-element-id=\"' + cssEscape(element.id) + '\"]', context.dragGroup);\n\n      if (gfx) {\n        svgAttr(gfx, { display: 'none' });\n      }\n\n      // clone the gfx of the temporary shape and add it to the drag group\n      var dragger = previewSupport.addDragger(tempShape, context.dragGroup);\n\n      context.visualReplacements[id] = dragger;\n\n      canvas.removeShape(tempShape);\n    });\n  }\n\n  /**\n   * Restore the original visuals of the previously replaced elements\n   *\n   * @param  {Object} context\n   */\n  function restoreVisual(context) {\n\n    var visualReplacements = context.visualReplacements;\n\n    forEach(visualReplacements, function(dragger, id) {\n\n      var originalGfx = domQuery('[data-element-id=\"' + cssEscape(id) + '\"]', context.dragGroup);\n\n      if (originalGfx) {\n        svgAttr(originalGfx, { display: 'inline' });\n      }\n\n      dragger.remove();\n\n      if (visualReplacements[id]) {\n        delete visualReplacements[id];\n      }\n    });\n  }\n\n  eventBus.on('shape.move.move', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        canExecute = context.canExecute;\n\n    if (!context.visualReplacements) {\n      context.visualReplacements = {};\n    }\n\n    if (canExecute && canExecute.replacements) {\n      replaceVisual(context);\n    } else {\n      restoreVisual(context);\n    }\n  });\n}\n\nBpmnReplacePreview.$inject = [\n  'eventBus',\n  'elementRegistry',\n  'elementFactory',\n  'canvas',\n  'previewSupport'\n];\n\ninherits(BpmnReplacePreview, CommandInterceptor);","import PreviewSupportModule from 'diagram-js/lib/features/preview-support';\n\nimport BpmnReplacePreview from './BpmnReplacePreview';\n\nexport default {\n  __depends__: [\n    PreviewSupportModule\n  ],\n  __init__: [ 'bpmnReplacePreview' ],\n  bpmnReplacePreview: [ 'type', BpmnReplacePreview ]\n};\n","import {\r\n  mid,\r\n  setSnapped\r\n} from 'diagram-js/lib/features/snapping/SnapUtil';\r\n\r\nimport { isCmd } from 'diagram-js/lib/features/keyboard/KeyboardUtil';\r\n\r\nimport {\r\n  getOrientation\r\n} from 'diagram-js/lib/layout/LayoutUtil';\r\n\r\nimport { is } from '../../util/ModelUtil';\r\n\r\nimport { isAny } from '../modeling/util/ModelingUtil';\r\n\r\nimport { some } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('diagram-js/lib/core/EventBus').Event} Event\r\n *\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('diagram-js/lib/util/Types').Axis} Axis\r\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\r\n */\r\n\r\nvar HIGHER_PRIORITY = 1250;\r\n\r\nvar BOUNDARY_TO_HOST_THRESHOLD = 40;\r\n\r\nvar TARGET_BOUNDS_PADDING = 20,\r\n    TASK_BOUNDS_PADDING = 10;\r\n\r\nvar TARGET_CENTER_PADDING = 20;\r\n\r\nvar AXES = [ 'x', 'y' ];\r\n\r\nvar abs = Math.abs;\r\n\r\n/**\r\n * Snap during connect.\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function BpmnConnectSnapping(eventBus) {\r\n  eventBus.on([\r\n    'connect.hover',\r\n    'connect.move',\r\n    'connect.end',\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        canExecute = context.canExecute,\r\n        start = context.start,\r\n        hover = context.hover,\r\n        source = context.source,\r\n        target = context.target;\r\n\r\n    // do NOT snap on CMD\r\n    if (event.originalEvent && isCmd(event.originalEvent)) {\r\n      return;\r\n    }\r\n\r\n    if (!context.initialConnectionStart) {\r\n      context.initialConnectionStart = context.connectionStart;\r\n    }\r\n\r\n    // snap hover\r\n    if (canExecute && hover) {\r\n      snapToShape(event, hover, getTargetBoundsPadding(hover));\r\n    }\r\n\r\n    if (hover && isAnyType(canExecute, [\r\n      'bpmn:Association',\r\n      'bpmn:DataInputAssociation',\r\n      'bpmn:DataOutputAssociation',\r\n      'bpmn:SequenceFlow'\r\n    ])) {\r\n      context.connectionStart = mid(start);\r\n\r\n      // snap hover\r\n      if (isAny(hover, [ 'bpmn:Event', 'bpmn:Gateway' ])) {\r\n        snapToPosition(event, mid(hover));\r\n      }\r\n\r\n      // snap hover\r\n      if (isAny(hover, [ 'bpmn:Task', 'bpmn:SubProcess' ])) {\r\n        snapToTargetMid(event, hover);\r\n      }\r\n\r\n      // snap source and target\r\n      if (is(source, 'bpmn:BoundaryEvent') && target === source.host) {\r\n        snapBoundaryEventLoop(event);\r\n      }\r\n\r\n    } else if (isType(canExecute, 'bpmn:MessageFlow')) {\r\n\r\n      if (is(start, 'bpmn:Event')) {\r\n\r\n        // snap start\r\n        context.connectionStart = mid(start);\r\n      }\r\n\r\n      if (is(hover, 'bpmn:Event')) {\r\n\r\n        // snap hover\r\n        snapToPosition(event, mid(hover));\r\n      }\r\n\r\n    } else {\r\n\r\n      // un-snap source\r\n      context.connectionStart = context.initialConnectionStart;\r\n    }\r\n  });\r\n}\r\n\r\nBpmnConnectSnapping.$inject = [ 'eventBus' ];\r\n\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * Snap to the given target if the event is inside the bounds of the target.\r\n *\r\n * @param {Event} event\r\n * @param {Shape} target\r\n * @param {number} padding\r\n */\r\nfunction snapToShape(event, target, padding) {\r\n  AXES.forEach(function(axis) {\r\n    var dimensionForAxis = getDimensionForAxis(axis, target);\r\n\r\n    if (event[ axis ] < target[ axis ] + padding) {\r\n      setSnapped(event, axis, target[ axis ] + padding);\r\n    } else if (event[ axis ] > target[ axis ] + dimensionForAxis - padding) {\r\n      setSnapped(event, axis, target[ axis ] + dimensionForAxis - padding);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Snap to the target mid if the event is in the target mid.\r\n *\r\n * @param {Event} event\r\n * @param {Shape} target\r\n */\r\nfunction snapToTargetMid(event, target) {\r\n  var targetMid = mid(target);\r\n\r\n  AXES.forEach(function(axis) {\r\n    if (isMid(event, target, axis)) {\r\n      setSnapped(event, axis, targetMid[ axis ]);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Snap to prevent a loop overlapping a boundary event.\r\n *\r\n * @param {Event} event\r\n */\r\nfunction snapBoundaryEventLoop(event) {\r\n  var context = event.context,\r\n      source = context.source,\r\n      target = context.target;\r\n\r\n  if (isReverse(context)) {\r\n    return;\r\n  }\r\n\r\n  var sourceMid = mid(source),\r\n      orientation = getOrientation(sourceMid, target, -10),\r\n      axes = [];\r\n\r\n  if (/top|bottom/.test(orientation)) {\r\n    axes.push('x');\r\n  }\r\n\r\n  if (/left|right/.test(orientation)) {\r\n    axes.push('y');\r\n  }\r\n\r\n  axes.forEach(function(axis) {\r\n    var coordinate = event[ axis ], newCoordinate;\r\n\r\n    if (abs(coordinate - sourceMid[ axis ]) < BOUNDARY_TO_HOST_THRESHOLD) {\r\n      if (coordinate > sourceMid[ axis ]) {\r\n        newCoordinate = sourceMid[ axis ] + BOUNDARY_TO_HOST_THRESHOLD;\r\n      }\r\n      else {\r\n        newCoordinate = sourceMid[ axis ] - BOUNDARY_TO_HOST_THRESHOLD;\r\n      }\r\n\r\n      setSnapped(event, axis, newCoordinate);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * @param {Event} event\r\n * @param {Point} position\r\n */\r\nfunction snapToPosition(event, position) {\r\n  setSnapped(event, 'x', position.x);\r\n  setSnapped(event, 'y', position.y);\r\n}\r\n\r\nfunction isType(attrs, type) {\r\n  return attrs && attrs.type === type;\r\n}\r\n\r\nfunction isAnyType(attrs, types) {\r\n  return some(types, function(type) {\r\n    return isType(attrs, type);\r\n  });\r\n}\r\n\r\n/**\r\n * @param {Axis} axis\r\n * @param {Shape} element\r\n *\r\n * @return {number}\r\n */\r\nfunction getDimensionForAxis(axis, element) {\r\n  return axis === 'x' ? element.width : element.height;\r\n}\r\n\r\n/**\r\n * @param {Shape} target\r\n *\r\n * @return {number}\r\n */\r\nfunction getTargetBoundsPadding(target) {\r\n  if (is(target, 'bpmn:Task')) {\r\n    return TASK_BOUNDS_PADDING;\r\n  } else {\r\n    return TARGET_BOUNDS_PADDING;\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Event} event\r\n * @param {Shape} target\r\n * @param {Axis} axis\r\n *\r\n * @return {boolean}\r\n */\r\nfunction isMid(event, target, axis) {\r\n  return event[ axis ] > target[ axis ] + TARGET_CENTER_PADDING\r\n    && event[ axis ] < target[ axis ] + getDimensionForAxis(axis, target) - TARGET_CENTER_PADDING;\r\n}\r\n\r\nfunction isReverse(context) {\r\n  var hover = context.hover,\r\n      source = context.source;\r\n\r\n  return hover && source && hover === source;\r\n}","import {\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  snapTo\r\n} from './SnapUtil';\r\n\r\n/**\r\n * @typedef {import('../../model/Types').Element} Element\r\n *\r\n * @typedef {import('../../util/Types').Axis} Axis\r\n * @typedef {import('../../util/Types').DirectionTRBL} DirectionTRBL\r\n * @typedef {import('../../util/Types').Point} Point\r\n *\r\n * @typedef {DirectionTRBL & 'mid'} SnapLocation\r\n */\r\n\r\n/**\r\n * A snap context, containing the (possibly incomplete)\r\n * mappings of drop targets (to identify the snapping)\r\n * to computed snap points.\r\n */\r\nexport default function SnapContext() {\r\n\r\n  /**\r\n   * @type {Record<string, SnapPoints>}\r\n   */\r\n  this._targets = {};\r\n\r\n  /**\r\n   * @type {Record<SnapLocation, Point>}\r\n   */\r\n  this._snapOrigins = {};\r\n\r\n  /**\r\n   * @type {SnapLocation[]}\r\n   */\r\n  this._snapLocations = [];\r\n\r\n  /**\r\n   * @type {Record<SnapLocation, Point[]>}\r\n   */\r\n  this._defaultSnaps = {};\r\n}\r\n\r\n/**\r\n * Get the snap origin for a given location.\r\n *\r\n * @param {SnapLocation} snapLocation\r\n *\r\n * @return {Point}\r\n */\r\nSnapContext.prototype.getSnapOrigin = function(snapLocation) {\r\n  return this._snapOrigins[snapLocation];\r\n};\r\n\r\n/**\r\n * Set the snap origin for a given location.\r\n *\r\n * @param {SnapLocation} snapLocation\r\n * @param {Point} snapOrigin\r\n */\r\nSnapContext.prototype.setSnapOrigin = function(snapLocation, snapOrigin) {\r\n  this._snapOrigins[snapLocation] = snapOrigin;\r\n\r\n  if (this._snapLocations.indexOf(snapLocation) === -1) {\r\n    this._snapLocations.push(snapLocation);\r\n  }\r\n};\r\n\r\n/**\r\n * Add a default snap point.\r\n *\r\n * @param {SnapLocation} snapLocation\r\n * @param {Point} point\r\n */\r\nSnapContext.prototype.addDefaultSnap = function(snapLocation, point) {\r\n\r\n  var snapValues = this._defaultSnaps[snapLocation];\r\n\r\n  if (!snapValues) {\r\n    snapValues = this._defaultSnaps[snapLocation] = [];\r\n  }\r\n\r\n  snapValues.push(point);\r\n};\r\n\r\n/**\r\n * Get the snap locations for this context.\r\n *\r\n * @return {SnapLocation[]}\r\n */\r\nSnapContext.prototype.getSnapLocations = function() {\r\n  return this._snapLocations;\r\n};\r\n\r\n/**\r\n * Set the snap locations for this context.\r\n *\r\n * The order of locations determines precedence.\r\n *\r\n * @param {SnapLocation[]} snapLocations\r\n */\r\nSnapContext.prototype.setSnapLocations = function(snapLocations) {\r\n  this._snapLocations = snapLocations;\r\n};\r\n\r\n/**\r\n * Get snap points for the given target.\r\n *\r\n * @param {Element|string} target\r\n *\r\n * @return {SnapPoints}\r\n */\r\nSnapContext.prototype.pointsForTarget = function(target) {\r\n\r\n  var targetId = target.id || target;\r\n\r\n  var snapPoints = this._targets[targetId];\r\n\r\n  if (!snapPoints) {\r\n    snapPoints = this._targets[targetId] = new SnapPoints();\r\n    snapPoints.initDefaults(this._defaultSnaps);\r\n  }\r\n\r\n  return snapPoints;\r\n};\r\n\r\n\r\n/**\r\n * Add points to snap to.\r\n */\r\nexport function SnapPoints() {\r\n\r\n  /**\r\n   * Example:\r\n   *\r\n   * ```javascript\r\n   * {\r\n   *   'top-right': {\r\n   *     x: [ 100, 200, 300 ]\r\n   *     y: [ 100, 200, 300 ]\r\n   *   }\r\n   * }\r\n   * ```\r\n   *\r\n   * @type {Record<string, Record<Axis, number[]>>}\r\n   */\r\n  this._snapValues = {};\r\n}\r\n\r\n/**\r\n * Add a snap point.\r\n *\r\n * @param {SnapLocation} snapLocation\r\n * @param {Point} point\r\n */\r\nSnapPoints.prototype.add = function(snapLocation, point) {\r\n\r\n  var snapValues = this._snapValues[snapLocation];\r\n\r\n  if (!snapValues) {\r\n    snapValues = this._snapValues[snapLocation] = { x: [], y: [] };\r\n  }\r\n\r\n  if (snapValues.x.indexOf(point.x) === -1) {\r\n    snapValues.x.push(point.x);\r\n  }\r\n\r\n  if (snapValues.y.indexOf(point.y) === -1) {\r\n    snapValues.y.push(point.y);\r\n  }\r\n};\r\n\r\n/**\r\n * Snap a point's x or y value.\r\n *\r\n * @param {Point} point\r\n * @param {SnapLocation} snapLocation\r\n * @param {Axis} axis\r\n * @param {number} tolerance\r\n *\r\n * @return {number}\r\n */\r\nSnapPoints.prototype.snap = function(point, snapLocation, axis, tolerance) {\r\n  var snappingValues = this._snapValues[snapLocation];\r\n\r\n  return snappingValues && snapTo(point[axis], snappingValues[axis], tolerance);\r\n};\r\n\r\n/**\r\n * Initialize default snap points.\r\n *\r\n * @param {Record<SnapLocation, Point[]>} defaultSnaps\r\n */\r\nSnapPoints.prototype.initDefaults = function(defaultSnaps) {\r\n\r\n  var self = this;\r\n\r\n  forEach(defaultSnaps || {}, function(snapPoints, snapLocation) {\r\n    forEach(snapPoints, function(point) {\r\n      self.add(snapLocation, point);\r\n    });\r\n  });\r\n};","import SnapContext from './SnapContext';\r\n\r\nimport {\r\n  getChildren,\r\n  isSnapped,\r\n  mid\r\n} from './SnapUtil';\r\n\r\nimport { isCmd } from '../keyboard/KeyboardUtil';\r\n\r\nimport {\r\n  forEach,\r\n  isNumber\r\n} from 'min-dash';\r\n\r\nimport {\r\n  isConnection,\r\n  isLabel\r\n} from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('./Snapping').default} Snapping\r\n */\r\n\r\nvar HIGHER_PRIORITY = 1250;\r\n\r\n\r\n/**\r\n * Snap during create and move.\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Snapping} snapping\r\n */\r\nexport default function CreateMoveSnapping(elementRegistry, eventBus, snapping) {\r\n  var self = this;\r\n\r\n  this._elementRegistry = elementRegistry;\r\n\r\n  eventBus.on([\r\n    'create.start',\r\n    'shape.move.start'\r\n  ], function(event) {\r\n    self.initSnap(event);\r\n  });\r\n\r\n  eventBus.on([\r\n    'create.move',\r\n    'create.end',\r\n    'shape.move.move',\r\n    'shape.move.end'\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        snapContext = context.snapContext,\r\n        target = context.target;\r\n\r\n    if (event.originalEvent && isCmd(event.originalEvent)) {\r\n      return;\r\n    }\r\n\r\n    if (isSnapped(event) || !target) {\r\n      return;\r\n    }\r\n\r\n    var snapPoints = snapContext.pointsForTarget(target);\r\n\r\n    if (!snapPoints.initialized) {\r\n      snapPoints = self.addSnapTargetPoints(snapPoints, shape, target);\r\n\r\n      snapPoints.initialized = true;\r\n    }\r\n\r\n    snapping.snap(event, snapPoints);\r\n  });\r\n\r\n  eventBus.on([\r\n    'create.cleanup',\r\n    'shape.move.cleanup'\r\n  ], function() {\r\n    snapping.hide();\r\n  });\r\n}\r\n\r\nCreateMoveSnapping.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'snapping'\r\n];\r\n\r\nCreateMoveSnapping.prototype.initSnap = function(event) {\r\n  var elementRegistry = this._elementRegistry;\r\n\r\n  var context = event.context,\r\n      shape = context.shape,\r\n      snapContext = context.snapContext;\r\n\r\n  if (!snapContext) {\r\n    snapContext = context.snapContext = new SnapContext();\r\n  }\r\n\r\n  var shapeMid;\r\n\r\n  if (elementRegistry.get(shape.id)) {\r\n\r\n    // move\r\n    shapeMid = mid(shape, event);\r\n  } else {\r\n\r\n    // create\r\n    shapeMid = {\r\n      x: event.x + mid(shape).x,\r\n      y: event.y + mid(shape).y\r\n    };\r\n  }\r\n\r\n  var shapeTopLeft = {\r\n        x: shapeMid.x - shape.width / 2,\r\n        y: shapeMid.y - shape.height / 2\r\n      },\r\n      shapeBottomRight = {\r\n        x: shapeMid.x + shape.width / 2,\r\n        y: shapeMid.y + shape.height / 2\r\n      };\r\n\r\n  snapContext.setSnapOrigin('mid', {\r\n    x: shapeMid.x - event.x,\r\n    y: shapeMid.y - event.y\r\n  });\r\n\r\n  // snap labels to mid only\r\n  if (isLabel(shape)) {\r\n    return snapContext;\r\n  }\r\n\r\n  snapContext.setSnapOrigin('top-left', {\r\n    x: shapeTopLeft.x - event.x,\r\n    y: shapeTopLeft.y - event.y\r\n  });\r\n\r\n  snapContext.setSnapOrigin('bottom-right', {\r\n    x: shapeBottomRight.x - event.x,\r\n    y: shapeBottomRight.y - event.y\r\n  });\r\n\r\n  return snapContext;\r\n};\r\n\r\nCreateMoveSnapping.prototype.addSnapTargetPoints = function(snapPoints, shape, target) {\r\n  var snapTargets = this.getSnapTargets(shape, target);\r\n\r\n  forEach(snapTargets, function(snapTarget) {\r\n\r\n    // handle labels\r\n    if (isLabel(snapTarget)) {\r\n\r\n      if (isLabel(shape)) {\r\n        snapPoints.add('mid', mid(snapTarget));\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // handle connections\r\n    if (isConnection(snapTarget)) {\r\n\r\n      // ignore single segment connections\r\n      if (snapTarget.waypoints.length < 3) {\r\n        return;\r\n      }\r\n\r\n      // ignore first and last waypoint\r\n      var waypoints = snapTarget.waypoints.slice(1, -1);\r\n\r\n      forEach(waypoints, function(waypoint) {\r\n        snapPoints.add('mid', waypoint);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    // handle shapes\r\n    snapPoints.add('mid', mid(snapTarget));\r\n  });\r\n\r\n  if (!isNumber(shape.x) || !isNumber(shape.y)) {\r\n    return snapPoints;\r\n  }\r\n\r\n  // snap to original position when moving\r\n  if (this._elementRegistry.get(shape.id)) {\r\n    snapPoints.add('mid', mid(shape));\r\n  }\r\n\r\n  return snapPoints;\r\n};\r\n\r\nCreateMoveSnapping.prototype.getSnapTargets = function(shape, target) {\r\n  return getChildren(target).filter(function(child) {\r\n    return !isHidden(child);\r\n  });\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction isHidden(element) {\r\n  return !!element.hidden;\r\n}","import inherits from 'inherits-browser';\n\nimport CreateMoveSnapping from 'diagram-js/lib/features/snapping/CreateMoveSnapping';\n\nimport {\n  isSnapped,\n  setSnapped,\n  topLeft,\n  bottomRight\n} from 'diagram-js/lib/features/snapping/SnapUtil';\n\nimport { isExpanded } from '../../util/DiUtil';\n\nimport { is } from '../../util/ModelUtil';\n\nimport {\n  asTRBL,\n  getMid\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport { getBoundaryAttachment } from './BpmnSnappingUtil';\n\nimport { forEach } from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('diagram-js/lib/features/snapping/SnapContext').default} SnapContext\n * @typedef {import('diagram-js/lib/features/snapping/SnapContext').SnapPoints} SnapPoints\n *\n * @typedef {import('diagram-js/lib/core/EventBus').Event} Event\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\nvar HIGH_PRIORITY = 1500;\n\n\n/**\n * Snap during create and move.\n *\n * @param {EventBus} eventBus\n * @param {Injector} injector\n */\nexport default function BpmnCreateMoveSnapping(eventBus, injector) {\n  injector.invoke(CreateMoveSnapping, this);\n\n  // creating first participant\n  eventBus.on([ 'create.move', 'create.end' ], HIGH_PRIORITY, setSnappedIfConstrained);\n\n  // snap boundary events\n  eventBus.on([\n    'create.move',\n    'create.end',\n    'shape.move.move',\n    'shape.move.end'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        canExecute = context.canExecute,\n        target = context.target;\n\n    var canAttach = canExecute && (canExecute === 'attach' || canExecute.attach);\n\n    if (canAttach && !isSnapped(event)) {\n      snapBoundaryEvent(event, target);\n    }\n  });\n}\n\ninherits(BpmnCreateMoveSnapping, CreateMoveSnapping);\n\nBpmnCreateMoveSnapping.$inject = [\n  'eventBus',\n  'injector'\n];\n\n/**\n * @param {Event} event\n *\n * @return {SnapContext}\n */\nBpmnCreateMoveSnapping.prototype.initSnap = function(event) {\n  var snapContext = CreateMoveSnapping.prototype.initSnap.call(this, event);\n\n  var shape = event.shape;\n\n  var isMove = !!this._elementRegistry.get(shape.id);\n\n  // snap to docking points\n  forEach(shape.outgoing, function(connection) {\n    var docking = connection.waypoints[0];\n\n    docking = docking.original || docking;\n\n    snapContext.setSnapOrigin(connection.id + '-docking', getDockingSnapOrigin(docking, isMove, event));\n  });\n\n  forEach(shape.incoming, function(connection) {\n    var docking = connection.waypoints[connection.waypoints.length - 1];\n\n    docking = docking.original || docking;\n\n    snapContext.setSnapOrigin(connection.id + '-docking', getDockingSnapOrigin(docking, isMove, event));\n  });\n\n  if (is(shape, 'bpmn:Participant')) {\n\n    // snap to borders with higher priority\n    snapContext.setSnapLocations([ 'top-left', 'bottom-right', 'mid' ]);\n  }\n\n  return snapContext;\n};\n\n/**\n * @param {SnapPoints} snapPoints\n * @param {Shape} shape\n * @param {Shape} target\n *\n * @return {SnapPoints}\n */\nBpmnCreateMoveSnapping.prototype.addSnapTargetPoints = function(snapPoints, shape, target) {\n  CreateMoveSnapping.prototype.addSnapTargetPoints.call(this, snapPoints, shape, target);\n\n  var snapTargets = this.getSnapTargets(shape, target);\n\n  forEach(snapTargets, function(snapTarget) {\n\n    // handle TRBL alignment\n    //\n    // * with container elements\n    // * with text annotations\n    if (isContainer(snapTarget) || areAll([ shape, snapTarget ], 'bpmn:TextAnnotation')) {\n      snapPoints.add('top-left', topLeft(snapTarget));\n      snapPoints.add('bottom-right', bottomRight(snapTarget));\n    }\n  });\n\n  var elementRegistry = this._elementRegistry;\n\n  // snap to docking points if not create mode\n  forEach(shape.incoming, function(connection) {\n    if (elementRegistry.get(shape.id)) {\n\n      if (!includes(snapTargets, connection.source)) {\n        snapPoints.add('mid', getMid(connection.source));\n      }\n\n      var docking = connection.waypoints[0];\n      snapPoints.add(connection.id + '-docking', docking.original || docking);\n    }\n  });\n\n  forEach(shape.outgoing, function(connection) {\n    if (elementRegistry.get(shape.id)) {\n\n      if (!includes(snapTargets, connection.target)) {\n        snapPoints.add('mid', getMid(connection.target));\n      }\n\n      var docking = connection.waypoints[ connection.waypoints.length - 1 ];\n\n      snapPoints.add(connection.id + '-docking', docking.original || docking);\n    }\n  });\n\n  // add sequence flow parents as snap targets\n  if (is(target, 'bpmn:SequenceFlow')) {\n    snapPoints = this.addSnapTargetPoints(snapPoints, shape, target.parent);\n  }\n\n  return snapPoints;\n};\n\n/**\n * @param {Shape} shape\n * @param {Shape} target\n *\n * @return {Shape[]}\n */\nBpmnCreateMoveSnapping.prototype.getSnapTargets = function(shape, target) {\n  return CreateMoveSnapping.prototype.getSnapTargets.call(this, shape, target)\n    .filter(function(snapTarget) {\n\n      // do not snap to lanes\n      return !is(snapTarget, 'bpmn:Lane');\n    });\n};\n\n// helpers //////////\n\n/**\n * @param {Shape} event\n * @param {Shape} target\n */\nfunction snapBoundaryEvent(event, target) {\n  var targetTRBL = asTRBL(target);\n\n  var direction = getBoundaryAttachment(event, target);\n\n  var context = event.context,\n      shape = context.shape;\n\n  var offset;\n\n  if (shape.parent) {\n    offset = { x: 0, y: 0 };\n  } else {\n    offset = getMid(shape);\n  }\n\n  if (/top/.test(direction)) {\n    setSnapped(event, 'y', targetTRBL.top - offset.y);\n  } else if (/bottom/.test(direction)) {\n    setSnapped(event, 'y', targetTRBL.bottom - offset.y);\n  }\n\n  if (/left/.test(direction)) {\n    setSnapped(event, 'x', targetTRBL.left - offset.x);\n  } else if (/right/.test(direction)) {\n    setSnapped(event, 'x', targetTRBL.right - offset.x);\n  }\n}\n\n/**\n * @param {Element[]} elements\n * @param {string} type\n *\n * @return {boolean}\n */\nfunction areAll(elements, type) {\n  return elements.every(function(el) {\n    return is(el, type);\n  });\n}\n\n/**\n * @param {Element} element\n */\nfunction isContainer(element) {\n  if (is(element, 'bpmn:SubProcess') && isExpanded(element)) {\n    return true;\n  }\n\n  return is(element, 'bpmn:Participant');\n}\n\n/**\n * @param {Event} event\n */\nfunction setSnappedIfConstrained(event) {\n  var context = event.context,\n      createConstraints = context.createConstraints;\n\n  if (!createConstraints) {\n    return;\n  }\n\n  var top = createConstraints.top,\n      right = createConstraints.right,\n      bottom = createConstraints.bottom,\n      left = createConstraints.left;\n\n  if ((left && left >= event.x) || (right && right <= event.x)) {\n    setSnapped(event, 'x', event.x);\n  }\n\n  if ((top && top >= event.y) || (bottom && bottom <= event.y)) {\n    setSnapped(event, 'y', event.y);\n  }\n}\n\nfunction includes(array, value) {\n  return array.indexOf(value) !== -1;\n}\n\nfunction getDockingSnapOrigin(docking, isMove, event) {\n  return isMove ? (\n    {\n      x: docking.x - event.x,\n      y: docking.y - event.y\n    }\n  ) : {\n    x: docking.x,\n    y: docking.y\n  };\n}\n","import SnapContext from './SnapContext';\r\n\r\nimport {\r\n  bottomRight,\r\n  getChildren,\r\n  isSnapped,\r\n  setSnapped,\r\n  topLeft,\r\n} from './SnapUtil';\r\n\r\nimport { isCmd } from '../keyboard/KeyboardUtil';\r\n\r\nimport {\r\n  asTRBL,\r\n  getMid\r\n} from '../../layout/LayoutUtil';\r\n\r\nimport { forEach } from 'min-dash';\r\n\r\nimport {\r\n  isConnection,\r\n  isLabel\r\n} from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('./Snapping').default} Snapping\r\n */\r\n\r\nvar HIGHER_PRIORITY = 1250;\r\n\r\n\r\n/**\r\n * Snap during resize.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Snapping} snapping\r\n */\r\nexport default function ResizeSnapping(eventBus, snapping) {\r\n  var self = this;\r\n\r\n  eventBus.on([ 'resize.start' ], function(event) {\r\n    self.initSnap(event);\r\n  });\r\n\r\n  eventBus.on([\r\n    'resize.move',\r\n    'resize.end',\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        parent = shape.parent,\r\n        direction = context.direction,\r\n        snapContext = context.snapContext;\r\n\r\n    if (event.originalEvent && isCmd(event.originalEvent)) {\r\n      return;\r\n    }\r\n\r\n    if (isSnapped(event)) {\r\n      return;\r\n    }\r\n\r\n    var snapPoints = snapContext.pointsForTarget(parent);\r\n\r\n    if (!snapPoints.initialized) {\r\n      snapPoints = self.addSnapTargetPoints(snapPoints, shape, parent, direction);\r\n\r\n      snapPoints.initialized = true;\r\n    }\r\n\r\n    if (isHorizontal(direction)) {\r\n      setSnapped(event, 'x', event.x);\r\n    }\r\n\r\n    if (isVertical(direction)) {\r\n      setSnapped(event, 'y', event.y);\r\n    }\r\n\r\n    snapping.snap(event, snapPoints);\r\n  });\r\n\r\n  eventBus.on([ 'resize.cleanup' ], function() {\r\n    snapping.hide();\r\n  });\r\n}\r\n\r\nResizeSnapping.prototype.initSnap = function(event) {\r\n  var context = event.context,\r\n      shape = context.shape,\r\n      direction = context.direction,\r\n      snapContext = context.snapContext;\r\n\r\n  if (!snapContext) {\r\n    snapContext = context.snapContext = new SnapContext();\r\n  }\r\n\r\n  var snapOrigin = getSnapOrigin(shape, direction);\r\n\r\n  snapContext.setSnapOrigin('corner', {\r\n    x: snapOrigin.x - event.x,\r\n    y: snapOrigin.y - event.y\r\n  });\r\n\r\n  return snapContext;\r\n};\r\n\r\nResizeSnapping.prototype.addSnapTargetPoints = function(snapPoints, shape, target, direction) {\r\n  var snapTargets = this.getSnapTargets(shape, target);\r\n\r\n  forEach(snapTargets, function(snapTarget) {\r\n    snapPoints.add('corner', bottomRight(snapTarget));\r\n    snapPoints.add('corner', topLeft(snapTarget));\r\n  });\r\n\r\n  snapPoints.add('corner', getSnapOrigin(shape, direction));\r\n\r\n  return snapPoints;\r\n};\r\n\r\nResizeSnapping.$inject = [\r\n  'eventBus',\r\n  'snapping'\r\n];\r\n\r\nResizeSnapping.prototype.getSnapTargets = function(shape, target) {\r\n  return getChildren(target).filter(function(child) {\r\n    return !isAttached(child, shape)\r\n      && !isConnection(child)\r\n      && !isHidden(child)\r\n      && !isLabel(child);\r\n  });\r\n};\r\n\r\n// helpers //////////\r\n\r\nfunction getSnapOrigin(shape, direction) {\r\n  var mid = getMid(shape),\r\n      trbl = asTRBL(shape);\r\n\r\n  var snapOrigin = {\r\n    x: mid.x,\r\n    y: mid.y\r\n  };\r\n\r\n  if (direction.indexOf('n') !== -1) {\r\n    snapOrigin.y = trbl.top;\r\n  } else if (direction.indexOf('s') !== -1) {\r\n    snapOrigin.y = trbl.bottom;\r\n  }\r\n\r\n  if (direction.indexOf('e') !== -1) {\r\n    snapOrigin.x = trbl.right;\r\n  } else if (direction.indexOf('w') !== -1) {\r\n    snapOrigin.x = trbl.left;\r\n  }\r\n\r\n  return snapOrigin;\r\n}\r\n\r\nfunction isAttached(element, host) {\r\n  return element.host === host;\r\n}\r\n\r\nfunction isHidden(element) {\r\n  return !!element.hidden;\r\n}\r\n\r\nfunction isHorizontal(direction) {\r\n  return direction === 'n' || direction === 's';\r\n}\r\n\r\nfunction isVertical(direction) {\r\n  return direction === 'e' || direction === 'w';\r\n}","import {\r\n  bind,\r\n  debounce,\r\n  forEach,\r\n  isNumber,\r\n  isObject\r\n} from 'min-dash';\r\n\r\nimport {\r\n  isSnapped,\r\n  setSnapped\r\n} from './SnapUtil';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  classes as svgClasses,\r\n  create as svgCreate\r\n} from 'tiny-svg';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n *\r\n * @typedef {import('../../core/EventBus').Event} Event\r\n *\r\n * @typedef {import('./SnapContext').SnapPoints} SnapPoints\r\n */\r\n\r\nvar SNAP_TOLERANCE = 7;\r\n\r\nexport var SNAP_LINE_HIDE_DELAY = 1000;\r\n\r\n\r\n/**\r\n * Generic snapping feature.\r\n *\r\n * @param {Canvas} canvas\r\n */\r\nexport default function Snapping(canvas) {\r\n  this._canvas = canvas;\r\n\r\n  // delay hide by 1000 seconds since last snap\r\n  this._asyncHide = debounce(bind(this.hide, this), SNAP_LINE_HIDE_DELAY);\r\n}\r\n\r\nSnapping.$inject = [ 'canvas' ];\r\n\r\n/**\r\n * Snap an event to given snap points.\r\n *\r\n * @param {Event} event\r\n * @param {SnapPoints} snapPoints\r\n */\r\nSnapping.prototype.snap = function(event, snapPoints) {\r\n  var context = event.context,\r\n      snapContext = context.snapContext,\r\n      snapLocations = snapContext.getSnapLocations();\r\n\r\n  var snapping = {\r\n    x: isSnapped(event, 'x'),\r\n    y: isSnapped(event, 'y')\r\n  };\r\n\r\n  forEach(snapLocations, function(location) {\r\n    var snapOrigin = snapContext.getSnapOrigin(location);\r\n\r\n    var snapCurrent = {\r\n      x: event.x + snapOrigin.x,\r\n      y: event.y + snapOrigin.y\r\n    };\r\n\r\n    // snap both axis if not snapped already\r\n    forEach([ 'x', 'y' ], function(axis) {\r\n      var locationSnapping;\r\n\r\n      if (!snapping[axis]) {\r\n        locationSnapping = snapPoints.snap(snapCurrent, location, axis, SNAP_TOLERANCE);\r\n\r\n        if (locationSnapping !== undefined) {\r\n          snapping[axis] = {\r\n            value: locationSnapping,\r\n            originValue: locationSnapping - snapOrigin[axis]\r\n          };\r\n        }\r\n      }\r\n    });\r\n\r\n    // no need to continue snapping\r\n    if (snapping.x && snapping.y) {\r\n      return false;\r\n    }\r\n  });\r\n\r\n  // show snap lines\r\n  this.showSnapLine('vertical', snapping.x && snapping.x.value);\r\n  this.showSnapLine('horizontal', snapping.y && snapping.y.value);\r\n\r\n  // snap event\r\n  forEach([ 'x', 'y' ], function(axis) {\r\n    var axisSnapping = snapping[axis];\r\n\r\n    if (isObject(axisSnapping)) {\r\n      setSnapped(event, axis, axisSnapping.originValue);\r\n    }\r\n  });\r\n};\r\n\r\nSnapping.prototype._createLine = function(orientation) {\r\n  var root = this._canvas.getLayer('snap');\r\n\r\n  var line = svgCreate('path');\r\n\r\n  svgAttr(line, { d: 'M0,0 L0,0' });\r\n\r\n  svgClasses(line).add('djs-snap-line');\r\n\r\n  svgAppend(root, line);\r\n\r\n  return {\r\n    update: function(position) {\r\n\r\n      if (!isNumber(position)) {\r\n        svgAttr(line, { display: 'none' });\r\n      } else {\r\n        if (orientation === 'horizontal') {\r\n          svgAttr(line, {\r\n            d: 'M-100000,' + position + ' L+100000,' + position,\r\n            display: ''\r\n          });\r\n        } else {\r\n          svgAttr(line, {\r\n            d: 'M ' + position + ',-100000 L ' + position + ', +100000',\r\n            display: ''\r\n          });\r\n        }\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\nSnapping.prototype._createSnapLines = function() {\r\n  this._snapLines = {\r\n    horizontal: this._createLine('horizontal'),\r\n    vertical: this._createLine('vertical')\r\n  };\r\n};\r\n\r\nSnapping.prototype.showSnapLine = function(orientation, position) {\r\n\r\n  var line = this.getSnapLine(orientation);\r\n\r\n  if (line) {\r\n    line.update(position);\r\n  }\r\n\r\n  this._asyncHide();\r\n};\r\n\r\nSnapping.prototype.getSnapLine = function(orientation) {\r\n  if (!this._snapLines) {\r\n    this._createSnapLines();\r\n  }\r\n\r\n  return this._snapLines[orientation];\r\n};\r\n\r\nSnapping.prototype.hide = function() {\r\n  forEach(this._snapLines, function(snapLine) {\r\n    snapLine.update();\r\n  });\r\n};\r\n","import CreateMoveSnapping from './CreateMoveSnapping';\r\nimport ResizeSnapping from './ResizeSnapping';\r\nimport Snapping from './Snapping';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __init__: [\r\n    'createMoveSnapping',\r\n    'resizeSnapping',\r\n    'snapping'\r\n  ],\r\n  createMoveSnapping: [ 'type', CreateMoveSnapping ],\r\n  resizeSnapping: [ 'type', ResizeSnapping ],\r\n  snapping: [ 'type', Snapping ]\r\n};","import BpmnConnectSnapping from './BpmnConnectSnapping';\nimport BpmnCreateMoveSnapping from './BpmnCreateMoveSnapping';\nimport SnappingModule from 'diagram-js/lib/features/snapping';\n\nexport default {\n  __depends__: [ SnappingModule ],\n  __init__: [\n    'connectSnapping',\n    'createMoveSnapping'\n  ],\n  connectSnapping: [ 'type', BpmnConnectSnapping ],\n  createMoveSnapping: [ 'type', BpmnCreateMoveSnapping ]\n};","import {\r\n  assignStyle,\r\n  clear as domClear,\r\n  delegate as domDelegate,\r\n  query as domQuery,\r\n  classes as domClasses,\r\n  attr as domAttr,\r\n  domify as domify\r\n} from 'min-dom';\r\n\r\nimport {\r\n  getBBox as getBoundingBox\r\n} from '../../util/Elements';\r\n\r\nimport {\r\n  escapeHTML\r\n} from '../../util/EscapeUtil';\r\n\r\nimport { isKey } from '../keyboard/KeyboardUtil';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../overlays/Overlays').default} Overlays\r\n * @typedef {import('../selection/Selection').default} Selection\r\n * @typedef {import('../../i18n/translate/translate.js').default} Translate\r\n *\r\n * @typedef {import('../overlays/Overlays').OverlayAttrs} OverlayAttrs\r\n *\r\n * @typedef {import('../../util/Types').Dimensions} Dimensions\r\n *\r\n * @typedef {import('./SearchPadProvider').default} SearchPadProvider\r\n * @typedef {import('./SearchPadProvider').SearchResult} SearchResult\r\n * @typedef {import('./SearchPadProvider').Token} Token\r\n */\r\n\r\n/**\r\n * Provides searching infrastructure.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n * @param {Overlays} overlays\r\n * @param {Selection} selection\r\n * @param {Translate} translate\r\n */\r\nexport default function SearchPad(canvas, eventBus, overlays, selection, translate) {\r\n  this._open = false;\r\n  this._results = [];\r\n  this._eventMaps = [];\r\n\r\n  this._canvas = canvas;\r\n  this._eventBus = eventBus;\r\n  this._overlays = overlays;\r\n  this._selection = selection;\r\n  this._translate = translate;\r\n\r\n  // setup elements\r\n  this._container = this._getBoxHtml();\r\n  this._searchInput = domQuery(SearchPad.INPUT_SELECTOR, this._container);\r\n  this._resultsContainer = domQuery(SearchPad.RESULTS_CONTAINER_SELECTOR, this._container);\r\n\r\n  // attach search pad\r\n  this._canvas.getContainer().appendChild(this._container);\r\n\r\n  // cleanup on destroy\r\n  eventBus.on([ 'canvas.destroy', 'diagram.destroy' ], this.close, this);\r\n}\r\n\r\n\r\nSearchPad.$inject = [\r\n  'canvas',\r\n  'eventBus',\r\n  'overlays',\r\n  'selection',\r\n  'translate'\r\n];\r\n\r\n\r\n/**\r\n * Binds and keeps track of all event listereners\r\n */\r\nSearchPad.prototype._bindEvents = function() {\r\n  var self = this;\r\n\r\n  function listen(el, selector, type, fn) {\r\n    self._eventMaps.push({\r\n      el: el,\r\n      type: type,\r\n      listener: domDelegate.bind(el, selector, type, fn)\r\n    });\r\n  }\r\n\r\n  // close search on clicking anywhere outside\r\n  listen(document, 'html', 'click', function(e) {\r\n    self.close();\r\n  });\r\n\r\n  // stop event from propagating and closing search\r\n  // focus on input\r\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'click', function(e) {\r\n    e.stopPropagation();\r\n    e.delegateTarget.focus();\r\n  });\r\n\r\n  // preselect result on hover\r\n  listen(this._container, SearchPad.RESULT_SELECTOR, 'mouseover', function(e) {\r\n    e.stopPropagation();\r\n    self._scrollToNode(e.delegateTarget);\r\n    self._preselect(e.delegateTarget);\r\n  });\r\n\r\n  // selects desired result on mouse click\r\n  listen(this._container, SearchPad.RESULT_SELECTOR, 'click', function(e) {\r\n    e.stopPropagation();\r\n    self._select(e.delegateTarget);\r\n  });\r\n\r\n  // prevent cursor in input from going left and right when using up/down to\r\n  // navigate results\r\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'keydown', function(e) {\r\n\r\n    if (isKey('ArrowUp', e)) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    if (isKey('ArrowDown', e)) {\r\n      e.preventDefault();\r\n    }\r\n  });\r\n\r\n  // handle keyboard input\r\n  listen(this._container, SearchPad.INPUT_SELECTOR, 'keyup', function(e) {\r\n\r\n    if (isKey('Escape', e)) {\r\n      return self.close();\r\n    }\r\n\r\n    if (isKey('Enter', e)) {\r\n      var selected = self._getCurrentResult();\r\n\r\n      return selected ? self._select(selected) : self.close();\r\n    }\r\n\r\n    if (isKey('ArrowUp', e)) {\r\n      return self._scrollToDirection(true);\r\n    }\r\n\r\n    if (isKey('ArrowDown', e)) {\r\n      return self._scrollToDirection();\r\n    }\r\n\r\n    // do not search while navigating text input\r\n    if (isKey([ 'ArrowLeft', 'ArrowRight' ], e)) {\r\n      return;\r\n    }\r\n\r\n    // anything else\r\n    self._search(e.delegateTarget.value);\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Unbinds all previously established listeners\r\n */\r\nSearchPad.prototype._unbindEvents = function() {\r\n  this._eventMaps.forEach(function(m) {\r\n    domDelegate.unbind(m.el, m.type, m.listener);\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Performs a search for the given pattern.\r\n *\r\n * @param {string} pattern\r\n */\r\nSearchPad.prototype._search = function(pattern) {\r\n  var self = this;\r\n\r\n  this._clearResults();\r\n\r\n  // do not search on empty query\r\n  if (!pattern || pattern === '') {\r\n    return;\r\n  }\r\n\r\n  var searchResults = this._searchProvider.find(pattern);\r\n\r\n  if (!searchResults.length) {\r\n    return;\r\n  }\r\n\r\n  // append new results\r\n  searchResults.forEach(function(result) {\r\n    var id = result.element.id;\r\n    var node = self._createResultNode(result, id);\r\n    self._results[id] = {\r\n      element: result.element,\r\n      node: node\r\n    };\r\n  });\r\n\r\n  // preselect first result\r\n  var node = domQuery(SearchPad.RESULT_SELECTOR, this._resultsContainer);\r\n  this._scrollToNode(node);\r\n  this._preselect(node);\r\n};\r\n\r\n\r\n/**\r\n * Navigate to the previous/next result. Defaults to next result.\r\n *\r\n * @param {boolean} previous\r\n */\r\nSearchPad.prototype._scrollToDirection = function(previous) {\r\n  var selected = this._getCurrentResult();\r\n  if (!selected) {\r\n    return;\r\n  }\r\n\r\n  var node = previous ? selected.previousElementSibling : selected.nextElementSibling;\r\n  if (node) {\r\n    this._scrollToNode(node);\r\n    this._preselect(node);\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Scroll to the node if it is not visible.\r\n *\r\n * @param {HTMLElement} node\r\n */\r\nSearchPad.prototype._scrollToNode = function(node) {\r\n  if (!node || node === this._getCurrentResult()) {\r\n    return;\r\n  }\r\n\r\n  var nodeOffset = node.offsetTop;\r\n  var containerScroll = this._resultsContainer.scrollTop;\r\n\r\n  var bottomScroll = nodeOffset - this._resultsContainer.clientHeight + node.clientHeight;\r\n\r\n  if (nodeOffset < containerScroll) {\r\n    this._resultsContainer.scrollTop = nodeOffset;\r\n  } else if (containerScroll < bottomScroll) {\r\n    this._resultsContainer.scrollTop = bottomScroll;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Clears all results data.\r\n */\r\nSearchPad.prototype._clearResults = function() {\r\n  domClear(this._resultsContainer);\r\n\r\n  this._results = [];\r\n\r\n  this._resetOverlay();\r\n\r\n  this._eventBus.fire('searchPad.cleared');\r\n};\r\n\r\n\r\n/**\r\n * Get currently selected result.\r\n *\r\n * @return {HTMLElement}\r\n */\r\nSearchPad.prototype._getCurrentResult = function() {\r\n  return domQuery(SearchPad.RESULT_SELECTED_SELECTOR, this._resultsContainer);\r\n};\r\n\r\n\r\n/**\r\n * Create result DOM element within results container\r\n * that corresponds to a search result.\r\n *\r\n * 'result' : one of the elements returned by Pad\r\n * 'id' : id attribute value to assign to the new DOM node\r\n * return : created DOM element\r\n *\r\n * @param {SearchResult} result\r\n * @param {string} id\r\n *\r\n * @return {HTMLElement}\r\n */\r\nSearchPad.prototype._createResultNode = function(result, id) {\r\n  var node = domify(SearchPad.RESULT_HTML);\r\n\r\n  // create only if available\r\n  if (result.primaryTokens.length > 0) {\r\n    createInnerTextNode(node, result.primaryTokens, SearchPad.RESULT_PRIMARY_HTML);\r\n  }\r\n\r\n  // secondary tokens (represent element ID) are allways available\r\n  createInnerTextNode(node, result.secondaryTokens, SearchPad.RESULT_SECONDARY_HTML);\r\n\r\n  domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE, id);\r\n\r\n  this._resultsContainer.appendChild(node);\r\n\r\n  return node;\r\n};\r\n\r\n\r\n/**\r\n * Register search element provider.\r\n *\r\n * @param {SearchPadProvider} provider\r\n */\r\nSearchPad.prototype.registerProvider = function(provider) {\r\n  this._searchProvider = provider;\r\n};\r\n\r\n\r\n/**\r\n * Open search pad.\r\n */\r\nSearchPad.prototype.open = function() {\r\n  if (!this._searchProvider) {\r\n    throw new Error('no search provider registered');\r\n  }\r\n\r\n  if (this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  this._bindEvents();\r\n\r\n  this._open = true;\r\n\r\n  domClasses(this._container).add('open');\r\n\r\n  this._searchInput.focus();\r\n\r\n  this._eventBus.fire('searchPad.opened');\r\n};\r\n\r\n\r\n/**\r\n * Close search pad.\r\n */\r\nSearchPad.prototype.close = function() {\r\n  if (!this.isOpen()) {\r\n    return;\r\n  }\r\n\r\n  this._unbindEvents();\r\n\r\n  this._open = false;\r\n\r\n  domClasses(this._container).remove('open');\r\n\r\n  this._clearResults();\r\n\r\n  this._searchInput.value = '';\r\n  this._searchInput.blur();\r\n\r\n  this._resetOverlay();\r\n\r\n  this._eventBus.fire('searchPad.closed');\r\n};\r\n\r\n\r\n/**\r\n * Toggles search pad on/off.\r\n */\r\nSearchPad.prototype.toggle = function() {\r\n  this.isOpen() ? this.close() : this.open();\r\n};\r\n\r\n\r\n/**\r\n * Report state of search pad.\r\n */\r\nSearchPad.prototype.isOpen = function() {\r\n  return this._open;\r\n};\r\n\r\n\r\n/**\r\n * Preselect result entry.\r\n *\r\n * @param {HTMLElement} element\r\n */\r\nSearchPad.prototype._preselect = function(node) {\r\n  var selectedNode = this._getCurrentResult();\r\n\r\n  // already selected\r\n  if (node === selectedNode) {\r\n    return;\r\n  }\r\n\r\n  // removing preselection from current node\r\n  if (selectedNode) {\r\n    domClasses(selectedNode).remove(SearchPad.RESULT_SELECTED_CLASS);\r\n  }\r\n\r\n  var id = domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE);\r\n  var element = this._results[id].element;\r\n\r\n  domClasses(node).add(SearchPad.RESULT_SELECTED_CLASS);\r\n\r\n  this._resetOverlay(element);\r\n\r\n  this._canvas.scrollToElement(element, { top: 400 });\r\n\r\n  this._selection.select(element);\r\n\r\n  this._eventBus.fire('searchPad.preselected', element);\r\n};\r\n\r\n\r\n/**\r\n * Select result node.\r\n *\r\n * @param {HTMLElement} element\r\n */\r\nSearchPad.prototype._select = function(node) {\r\n  var id = domAttr(node, SearchPad.RESULT_ID_ATTRIBUTE);\r\n  var element = this._results[id].element;\r\n\r\n  this.close();\r\n\r\n  this._resetOverlay();\r\n\r\n  this._canvas.scrollToElement(element, { top: 400 });\r\n\r\n  this._selection.select(element);\r\n\r\n  this._eventBus.fire('searchPad.selected', element);\r\n};\r\n\r\n\r\n/**\r\n * Reset overlay removes and, optionally, set\r\n * overlay to a new element.\r\n *\r\n * @param {HTMLElement} element\r\n */\r\nSearchPad.prototype._resetOverlay = function(element) {\r\n  if (this._overlayId) {\r\n    this._overlays.remove(this._overlayId);\r\n  }\r\n\r\n  if (element) {\r\n    var box = getBoundingBox(element);\r\n    var overlay = constructOverlay(box);\r\n    this._overlayId = this._overlays.add(element, overlay);\r\n  }\r\n};\r\n\r\nSearchPad.prototype._getBoxHtml = function() {\r\n  const box = domify(SearchPad.BOX_HTML);\r\n  const input = domQuery(SearchPad.INPUT_SELECTOR, box);\r\n\r\n  if (input) {\r\n    input.setAttribute('aria-label', this._translate('Search in diagram'));\r\n  }\r\n\r\n  return box;\r\n};\r\n\r\n\r\n/**\r\n * Construct overlay object for the given bounding box.\r\n *\r\n * @param {Dimensions} box\r\n *\r\n * @return {OverlayAttrs}\r\n */\r\nfunction constructOverlay(box) {\r\n\r\n  var offset = 6;\r\n  var w = box.width + offset * 2;\r\n  var h = box.height + offset * 2;\r\n\r\n  var styles = {\r\n    width: w + 'px',\r\n    height: h + 'px'\r\n  };\r\n\r\n  var html = domify('<div class=\"' + SearchPad.OVERLAY_CLASS + '\"></div>');\r\n\r\n  assignStyle(html, styles);\r\n\r\n  return {\r\n    position: {\r\n      bottom: h - offset,\r\n      right: w - offset\r\n    },\r\n    show: true,\r\n    html: html\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * Creates and appends child node from result tokens and HTML template.\r\n *\r\n * @param {HTMLElement} node\r\n * @param {Token[]} tokens\r\n * @param {string} template\r\n */\r\nfunction createInnerTextNode(parentNode, tokens, template) {\r\n  var text = createHtmlText(tokens);\r\n  var childNode = domify(template);\r\n  childNode.innerHTML = text;\r\n  parentNode.appendChild(childNode);\r\n}\r\n\r\n/**\r\n * Create internal HTML markup from result tokens.\r\n * Caters for highlighting pattern matched tokens.\r\n *\r\n * @param {Token[]} tokens\r\n *\r\n * @return {string|null}\r\n */\r\nfunction createHtmlText(tokens) {\r\n  var htmlText = '';\r\n\r\n  tokens.forEach(function(t) {\r\n    if (t.matched) {\r\n      htmlText += '<strong class=\"' + SearchPad.RESULT_HIGHLIGHT_CLASS + '\">' + escapeHTML(t.matched) + '</strong>';\r\n    } else {\r\n      htmlText += escapeHTML(t.normal);\r\n    }\r\n  });\r\n\r\n  return htmlText !== '' ? htmlText : null;\r\n}\r\n\r\n\r\n/**\r\n * CONSTANTS\r\n */\r\nSearchPad.CONTAINER_SELECTOR = '.djs-search-container';\r\nSearchPad.INPUT_SELECTOR = '.djs-search-input input';\r\nSearchPad.RESULTS_CONTAINER_SELECTOR = '.djs-search-results';\r\nSearchPad.RESULT_SELECTOR = '.djs-search-result';\r\nSearchPad.RESULT_SELECTED_CLASS = 'djs-search-result-selected';\r\nSearchPad.RESULT_SELECTED_SELECTOR = '.' + SearchPad.RESULT_SELECTED_CLASS;\r\nSearchPad.RESULT_ID_ATTRIBUTE = 'data-result-id';\r\nSearchPad.RESULT_HIGHLIGHT_CLASS = 'djs-search-highlight';\r\nSearchPad.OVERLAY_CLASS = 'djs-search-overlay';\r\n\r\nSearchPad.BOX_HTML =\r\n  '<div class=\"djs-search-container djs-draggable djs-scrollable\">' +\r\n    '<div class=\"djs-search-input\">' +\r\n      '<input type=\"text\"/>' +\r\n    '</div>' +\r\n    '<div class=\"djs-search-results\"></div>' +\r\n  '</div>';\r\n\r\nSearchPad.RESULT_HTML =\r\n  '<div class=\"djs-search-result\"></div>';\r\n\r\nSearchPad.RESULT_PRIMARY_HTML =\r\n  '<div class=\"djs-search-result-primary\"></div>';\r\n\r\nSearchPad.RESULT_SECONDARY_HTML =\r\n  '<p class=\"djs-search-result-secondary\"></p>';\r\n","import OverlaysModule from '../overlays';\r\nimport SelectionModule from '../selection';\r\nimport TranslateModule from '../../i18n/translate/index.js';\r\n\r\nimport SearchPad from './SearchPad';\r\n\r\n\r\n/**\r\n * @type { import('didi').ModuleDeclaration }\r\n */\r\nexport default {\r\n  __depends__: [\r\n    TranslateModule,\r\n    OverlaysModule,\r\n    SelectionModule\r\n  ],\r\n  searchPad: [ 'type', SearchPad ]\r\n};\r\n","import {\n  map,\n  filter,\n  sortBy\n} from 'min-dash';\n\nimport {\n  getLabel\n} from '../../util/LabelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/features/search-pad/SearchPad').default} SearchPad\n *\n * @typedef {import('diagram-js/lib/features/search-pad/SearchPadProvider').default} SearchPadProvider\n * @typedef {import('diagram-js/lib/features/search-pad/SearchPadProvider').SearchResult} SearchResult\n */\n\n/**\n * Provides ability to search for BPMN elements.\n *\n * @implements {SearchPadProvider}\n *\n * @param {ElementRegistry} elementRegistry\n * @param {SearchPad} searchPad\n * @param {Canvas} canvas\n */\nexport default function BpmnSearchProvider(elementRegistry, searchPad, canvas) {\n  this._elementRegistry = elementRegistry;\n  this._canvas = canvas;\n\n  searchPad.registerProvider(this);\n}\n\nBpmnSearchProvider.$inject = [\n  'elementRegistry',\n  'searchPad',\n  'canvas'\n];\n\n/**\n * @param {string} pattern\n *\n * @return {SearchResult[]}\n */\nBpmnSearchProvider.prototype.find = function(pattern) {\n  var rootElement = this._canvas.getRootElement();\n\n  var elements = this._elementRegistry.filter(function(element) {\n    if (element.labelTarget) {\n      return false;\n    }\n    return true;\n  });\n\n  // do not include root element\n  elements = filter(elements, function(element) {\n    return element !== rootElement;\n  });\n\n  elements = map(elements, function(element) {\n    return {\n      primaryTokens: matchAndSplit(getLabel(element), pattern),\n      secondaryTokens: matchAndSplit(element.id, pattern),\n      element: element\n    };\n  });\n\n  // exclude non-matched elements\n  elements = filter(elements, function(element) {\n    return hasMatched(element.primaryTokens) || hasMatched(element.secondaryTokens);\n  });\n\n  elements = sortBy(elements, function(element) {\n    return getLabel(element.element) + element.element.id;\n  });\n\n  return elements;\n};\n\n/**\n * @param {Token[]} tokens\n *\n * @return {boolean}\n */\nfunction hasMatched(tokens) {\n  var matched = filter(tokens, function(token) {\n    return !!token.matched;\n  });\n\n  return matched.length > 0;\n}\n\n/**\n * @param {string} text\n * @param {string} pattern\n *\n * @return {Token[]}\n */\nfunction matchAndSplit(text, pattern) {\n  var tokens = [],\n      originalText = text;\n\n  if (!text) {\n    return tokens;\n  }\n\n  text = text.toLowerCase();\n  pattern = pattern.toLowerCase();\n\n  var i = text.indexOf(pattern);\n\n  if (i > -1) {\n    if (i !== 0) {\n      tokens.push({\n        normal: originalText.substr(0, i)\n      });\n    }\n\n    tokens.push({\n      matched: originalText.substr(i, pattern.length)\n    });\n\n    if (pattern.length + i < text.length) {\n      tokens.push({\n        normal: originalText.substr(pattern.length + i, text.length)\n      });\n    }\n  } else {\n    tokens.push({\n      normal: originalText\n    });\n  }\n\n  return tokens;\n}","import SearchPadModule from 'diagram-js/lib/features/search-pad';\n\nimport BpmnSearchProvider from './BpmnSearchProvider';\n\n\nexport default {\n  __depends__: [\n    SearchPadModule\n  ],\n  __init__: [ 'bpmnSearch' ],\n  bpmnSearch: [ 'type', BpmnSearchProvider ]\n};\n","import inherits from 'inherits-browser';\n\nimport BaseModeler from './BaseModeler';\n\nimport Viewer from './Viewer';\nimport NavigatedViewer from './NavigatedViewer';\n\nimport KeyboardMoveModule from 'diagram-js/lib/navigation/keyboard-move';\nimport MoveCanvasModule from 'diagram-js/lib/navigation/movecanvas';\nimport ZoomScrollModule from 'diagram-js/lib/navigation/zoomscroll';\n\nimport AlignElementsModule from './features/align-elements';\nimport AutoPlaceModule from './features/auto-place';\nimport AutoResizeModule from './features/auto-resize';\nimport AutoScrollModule from 'diagram-js/lib/features/auto-scroll';\nimport BendpointsModule from 'diagram-js/lib/features/bendpoints';\nimport ConnectModule from 'diagram-js/lib/features/connect';\nimport ConnectionPreviewModule from 'diagram-js/lib/features/connection-preview';\nimport ContextPadModule from './features/context-pad';\nimport CopyPasteModule from './features/copy-paste';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport DistributeElementsModule from './features/distribute-elements';\nimport EditorActionsModule from './features/editor-actions';\nimport GridSnappingModule from './features/grid-snapping';\nimport InteractionEventsModule from './features/interaction-events';\nimport KeyboardModule from './features/keyboard';\nimport KeyboardMoveSelectionModule from 'diagram-js/lib/features/keyboard-move-selection';\nimport LabelEditingModule from './features/label-editing';\nimport ModelingModule from './features/modeling';\nimport ModelingFeedbackModule from './features/modeling-feedback';\nimport MoveModule from 'diagram-js/lib/features/move';\nimport PaletteModule from './features/palette';\nimport ReplacePreviewModule from './features/replace-preview';\nimport ResizeModule from 'diagram-js/lib/features/resize';\nimport SnappingModule from './features/snapping';\nimport SearchModule from './features/search';\n\nvar initialDiagram =\n  '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' +\n  '<bpmn:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" ' +\n                    'xmlns:bpmn=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" ' +\n                    'xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" ' +\n                    'xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" ' +\n                    'targetNamespace=\"http://bpmn.io/schema/bpmn\" ' +\n                    'id=\"Definitions_1\">' +\n    '<bpmn:process id=\"Process_1\" isExecutable=\"false\">' +\n      '<bpmn:startEvent id=\"StartEvent_1\"/>' +\n    '</bpmn:process>' +\n    '<bpmndi:BPMNDiagram id=\"BPMNDiagram_1\">' +\n      '<bpmndi:BPMNPlane id=\"BPMNPlane_1\" bpmnElement=\"Process_1\">' +\n        '<bpmndi:BPMNShape id=\"_BPMNShape_StartEvent_2\" bpmnElement=\"StartEvent_1\">' +\n          '<dc:Bounds height=\"36.0\" width=\"36.0\" x=\"173.0\" y=\"102.0\"/>' +\n        '</bpmndi:BPMNShape>' +\n      '</bpmndi:BPMNPlane>' +\n    '</bpmndi:BPMNDiagram>' +\n  '</bpmn:definitions>';\n\n\n/**\n * @typedef {import('./BaseViewer').BaseViewerOptions} BaseViewerOptions\n * @typedef {import('./BaseViewer').ImportXMLResult} ImportXMLResult\n */\n\n/**\n * A modeler for BPMN 2.0 diagrams.\n *\n * ## Extending the Modeler\n *\n * In order to extend the viewer pass extension modules to bootstrap via the\n * `additionalModules` option. An extension module is an object that exposes\n * named services.\n *\n * The following example depicts the integration of a simple\n * logging component that integrates with interaction events:\n *\n *\n * ```javascript\n *\n * // logging component\n * function InteractionLogger(eventBus) {\n *   eventBus.on('element.hover', function(event) {\n *     console.log()\n *   })\n * }\n *\n * InteractionLogger.$inject = [ 'eventBus' ]; // minification save\n *\n * // extension module\n * var extensionModule = {\n *   __init__: [ 'interactionLogger' ],\n *   interactionLogger: [ 'type', InteractionLogger ]\n * };\n *\n * // extend the viewer\n * var bpmnModeler = new Modeler({ additionalModules: [ extensionModule ] });\n * bpmnModeler.importXML(...);\n * ```\n *\n *\n * ## Customizing / Replacing Components\n *\n * You can replace individual diagram components by redefining them in override modules.\n * This works for all components, including those defined in the core.\n *\n * Pass in override modules via the `options.additionalModules` flag like this:\n *\n * ```javascript\n * function CustomContextPadProvider(contextPad) {\n *\n *   contextPad.registerProvider(this);\n *\n *   this.getContextPadEntries = function(element) {\n *     // no entries, effectively disable the context pad\n *     return {};\n *   };\n * }\n *\n * CustomContextPadProvider.$inject = [ 'contextPad' ];\n *\n * var overrideModule = {\n *   contextPadProvider: [ 'type', CustomContextPadProvider ]\n * };\n *\n * var bpmnModeler = new Modeler({ additionalModules: [ overrideModule ]});\n * ```\n *\n * @template [ServiceMap=null]\n *\n * @extends BaseModeler<ServiceMap>\n *\n * @param {BaseViewerOptions} [options] The options to configure the modeler.\n */\nexport default function Modeler(options) {\n  BaseModeler.call(this, options);\n}\n\ninherits(Modeler, BaseModeler);\n\n\nModeler.Viewer = Viewer;\nModeler.NavigatedViewer = NavigatedViewer;\n\n/**\n * Create a new diagram to start modeling.\n *\n * @throws {ImportXMLError} An error thrown during the import of the XML.\n *\n * @return {Promise<ImportXMLResult>} A promise resolving with warnings that were produced during the import.\n */\nModeler.prototype.createDiagram = function createDiagram() {\n  return this.importXML(initialDiagram);\n};\n\n\nModeler.prototype._interactionModules = [\n\n  // non-modeling components\n  KeyboardMoveModule,\n  MoveCanvasModule,\n  ZoomScrollModule\n];\n\nModeler.prototype._modelingModules = [\n\n  // modeling components\n  AlignElementsModule,\n  AutoPlaceModule,\n  AutoScrollModule,\n  AutoResizeModule,\n  BendpointsModule,\n  ConnectModule,\n  ConnectionPreviewModule,\n  ContextPadModule,\n  CopyPasteModule,\n  CreateModule,\n  DistributeElementsModule,\n  EditorActionsModule,\n  GridSnappingModule,\n  InteractionEventsModule,\n  KeyboardModule,\n  KeyboardMoveSelectionModule,\n  LabelEditingModule,\n  ModelingModule,\n  ModelingFeedbackModule,\n  MoveModule,\n  PaletteModule,\n  ReplacePreviewModule,\n  ResizeModule,\n  SnappingModule,\n  SearchModule\n];\n\n\n// modules the modeler is composed of\n//\n// - viewer modules\n// - interaction modules\n// - modeling modules\n\nModeler.prototype._modules = [].concat(\n  Viewer.prototype._modules,\n  Modeler.prototype._interactionModules,\n  Modeler.prototype._modelingModules\n);\n","export const defaultBpmnXml = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<bpmn:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"  \nxmlns:bpmn=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"  \nxmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"  \nxmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"  \ntargetNamespace=\"http://bpmn.io/schema/bpmn\"  \nid=\"Definitions_1\"> \n     <bpmn:process id=\"Process_1\" isExecutable=\"false\"> \n          <bpmn:startEvent id=\"StartEvent_1\"/> \n     </bpmn:process>\n     <bpmndi:BPMNDiagram id=\"BPMNDiagram_1\"> \n          <bpmndi:BPMNPlane id=\"BPMNPlane_1\" bpmnElement=\"Process_1\"> \n                <bpmndi:BPMNShape id=\"_BPMNShape_StartEvent_2\" bpmnElement=\"StartEvent_1\"> \n                    <dc:Bounds height=\"36.0\" width=\"36.0\" x=\"173.0\" y=\"102.0\"/> \n                </bpmndi:BPMNShape>\n          </bpmndi:BPMNPlane>\n     </bpmndi:BPMNDiagram>\n</bpmn:definitions>`;\n","'use client';\nfunction keys(object) {\n  return Object.keys(object);\n}\n\nexport { keys };\n//# sourceMappingURL=keys.mjs.map\n","function isObject(item) {\n  return item && typeof item === \"object\" && !Array.isArray(item);\n}\nfunction deepMerge(target, source) {\n  const result = { ...target };\n  const _source = source;\n  if (isObject(target) && isObject(source)) {\n    Object.keys(source).forEach((key) => {\n      if (isObject(_source[key])) {\n        if (!(key in target)) {\n          result[key] = _source[key];\n        } else {\n          result[key] = deepMerge(result[key], _source[key]);\n        }\n      } else {\n        result[key] = _source[key];\n      }\n    });\n  }\n  return result;\n}\n\nexport { deepMerge };\n//# sourceMappingURL=deep-merge.mjs.map\n","'use client';\nfunction camelToKebabCase(value) {\n  return value.replace(/[A-Z]/g, (letter) => `-${letter.toLowerCase()}`);\n}\n\nexport { camelToKebabCase };\n//# sourceMappingURL=camel-to-kebab-case.mjs.map\n","function getTransformedScaledValue(value) {\n  if (typeof value !== \"string\" || !value.includes(\"var(--mantine-scale)\")) {\n    return value;\n  }\n  return value.match(/^calc\\((.*?)\\)$/)?.[1].split(\"*\")[0].trim();\n}\nfunction px(value) {\n  const transformedValue = getTransformedScaledValue(value);\n  if (typeof transformedValue === \"number\") {\n    return transformedValue;\n  }\n  if (typeof transformedValue === \"string\") {\n    if (transformedValue.includes(\"calc\") || transformedValue.includes(\"var\")) {\n      return transformedValue;\n    }\n    if (transformedValue.includes(\"px\")) {\n      return Number(transformedValue.replace(\"px\", \"\"));\n    }\n    if (transformedValue.includes(\"rem\")) {\n      return Number(transformedValue.replace(\"rem\", \"\")) * 16;\n    }\n    if (transformedValue.includes(\"em\")) {\n      return Number(transformedValue.replace(\"em\", \"\")) * 16;\n    }\n    return Number(transformedValue);\n  }\n  return NaN;\n}\n\nexport { px };\n//# sourceMappingURL=px.mjs.map\n","function scaleRem(remValue) {\n  if (remValue === \"0rem\") {\n    return \"0rem\";\n  }\n  return `calc(${remValue} * var(--mantine-scale))`;\n}\nfunction createConverter(units, { shouldScale = false } = {}) {\n  function converter(value) {\n    if (value === 0 || value === \"0\") {\n      return `0${units}`;\n    }\n    if (typeof value === \"number\") {\n      const val = `${value / 16}${units}`;\n      return shouldScale ? scaleRem(val) : val;\n    }\n    if (typeof value === \"string\") {\n      if (value === \"\") {\n        return value;\n      }\n      if (value.startsWith(\"calc(\") || value.startsWith(\"clamp(\") || value.includes(\"rgba(\")) {\n        return value;\n      }\n      if (value.includes(\",\")) {\n        return value.split(\",\").map((val) => converter(val)).join(\",\");\n      }\n      if (value.includes(\" \")) {\n        return value.split(\" \").map((val) => converter(val)).join(\" \");\n      }\n      if (value.includes(units)) {\n        return shouldScale ? scaleRem(value) : value;\n      }\n      const replaced = value.replace(\"px\", \"\");\n      if (!Number.isNaN(Number(replaced))) {\n        const val = `${Number(replaced) / 16}${units}`;\n        return shouldScale ? scaleRem(val) : val;\n      }\n    }\n    return value;\n  }\n  return converter;\n}\nconst rem = createConverter(\"rem\", { shouldScale: true });\nconst em = createConverter(\"em\");\n\nexport { em, rem };\n//# sourceMappingURL=rem.mjs.map\n","'use client';\nfunction filterProps(props) {\n  return Object.keys(props).reduce((acc, key) => {\n    if (props[key] !== void 0) {\n      acc[key] = props[key];\n    }\n    return acc;\n  }, {});\n}\n\nexport { filterProps };\n//# sourceMappingURL=filter-props.mjs.map\n","'use client';\nfunction isNumberLike(value) {\n  if (typeof value === \"number\") {\n    return true;\n  }\n  if (typeof value === \"string\") {\n    if (value.startsWith(\"calc(\") || value.startsWith(\"var(\") || value.includes(\" \") && value.trim() !== \"\") {\n      return true;\n    }\n    return /[0-9]/.test(value.trim().replace(\"-\", \"\")[0]);\n  }\n  return false;\n}\n\nexport { isNumberLike };\n//# sourceMappingURL=is-number-like.mjs.map\n","'use client';\nimport { isNumberLike } from '../is-number-like/is-number-like.mjs';\nimport { rem } from '../units-converters/rem.mjs';\n\nfunction getSize(size, prefix = \"size\", convertToRem = true) {\n  if (size === void 0) {\n    return void 0;\n  }\n  return isNumberLike(size) ? convertToRem ? rem(size) : size : `var(--${prefix}-${size})`;\n}\nfunction getSpacing(size) {\n  return getSize(size, \"mantine-spacing\");\n}\nfunction getRadius(size) {\n  if (size === void 0) {\n    return \"var(--mantine-radius-default)\";\n  }\n  return getSize(size, \"mantine-radius\");\n}\nfunction getFontSize(size) {\n  return getSize(size, \"mantine-font-size\");\n}\nfunction getLineHeight(size) {\n  return getSize(size, \"mantine-line-height\", false);\n}\nfunction getShadow(size) {\n  if (!size) {\n    return void 0;\n  }\n  return getSize(size, \"mantine-shadow\", false);\n}\n\nexport { getFontSize, getLineHeight, getRadius, getShadow, getSize, getSpacing };\n//# sourceMappingURL=get-size.mjs.map\n","'use client';\nimport { useState, useRef, useEffect } from 'react';\n\nfunction attachMediaListener(query, callback) {\n  try {\n    query.addEventListener(\"change\", callback);\n    return () => query.removeEventListener(\"change\", callback);\n  } catch (e) {\n    query.addListener(callback);\n    return () => query.removeListener(callback);\n  }\n}\nfunction getInitialValue(query, initialValue) {\n  if (typeof initialValue === \"boolean\") {\n    return initialValue;\n  }\n  if (typeof window !== \"undefined\" && \"matchMedia\" in window) {\n    return window.matchMedia(query).matches;\n  }\n  return false;\n}\nfunction useMediaQuery(query, initialValue, { getInitialValueInEffect } = {\n  getInitialValueInEffect: true\n}) {\n  const [matches, setMatches] = useState(\n    getInitialValueInEffect ? initialValue : getInitialValue(query)\n  );\n  const queryRef = useRef();\n  useEffect(() => {\n    if (\"matchMedia\" in window) {\n      queryRef.current = window.matchMedia(query);\n      setMatches(queryRef.current.matches);\n      return attachMediaListener(queryRef.current, (event) => setMatches(event.matches));\n    }\n    return void 0;\n  }, [query]);\n  return matches;\n}\n\nexport { useMediaQuery };\n//# sourceMappingURL=use-media-query.mjs.map\n","'use client';\nimport { useLayoutEffect, useEffect } from 'react';\n\nconst useIsomorphicEffect = typeof document !== \"undefined\" ? useLayoutEffect : useEffect;\n\nexport { useIsomorphicEffect };\n//# sourceMappingURL=use-isomorphic-effect.mjs.map\n","'use client';\nimport { useRef, useEffect } from 'react';\n\nfunction useDidUpdate(fn, dependencies) {\n  const mounted = useRef(false);\n  useEffect(\n    () => () => {\n      mounted.current = false;\n    },\n    []\n  );\n  useEffect(() => {\n    if (mounted.current) {\n      return fn();\n    }\n    mounted.current = true;\n    return void 0;\n  }, dependencies);\n}\n\nexport { useDidUpdate };\n//# sourceMappingURL=use-did-update.mjs.map\n","'use client';\nimport { useMediaQuery } from '../use-media-query/use-media-query.mjs';\n\nfunction useReducedMotion(initialValue, options) {\n  return useMediaQuery(\"(prefers-reduced-motion: reduce)\", initialValue, options);\n}\n\nexport { useReducedMotion };\n//# sourceMappingURL=use-reduced-motion.mjs.map\n","function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f)}else for(f in e)e[f]&&(n&&(n+=\" \"),n+=f);return n}export function clsx(){for(var e,t,f=0,n=\"\",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;","'use client';\nimport cx from 'clsx';\n\nconst EMPTY_CLASS_NAMES = {};\nfunction mergeClassNames(objects) {\n  const merged = {};\n  objects.forEach((obj) => {\n    Object.entries(obj).forEach(([key, value]) => {\n      if (merged[key]) {\n        merged[key] = cx(merged[key], value);\n      } else {\n        merged[key] = value;\n      }\n    });\n  });\n  return merged;\n}\nfunction resolveClassNames({ theme, classNames, props, stylesCtx }) {\n  const arrayClassNames = Array.isArray(classNames) ? classNames : [classNames];\n  const resolvedClassNames = arrayClassNames.map(\n    (item) => typeof item === \"function\" ? item(theme, props, stylesCtx) : item || EMPTY_CLASS_NAMES\n  );\n  return mergeClassNames(resolvedClassNames);\n}\n\nexport { resolveClassNames };\n//# sourceMappingURL=resolve-class-names.mjs.map\n","'use client';\nfunction resolveStyles({ theme, styles, props, stylesCtx }) {\n  const arrayStyles = Array.isArray(styles) ? styles : [styles];\n  return arrayStyles.reduce((acc, style) => {\n    if (typeof style === \"function\") {\n      return { ...acc, ...style(theme, props, stylesCtx) };\n    }\n    return { ...acc, ...style };\n  }, {});\n}\n\nexport { resolveStyles };\n//# sourceMappingURL=resolve-styles.mjs.map\n","'use client';\nimport { createContext, useContext } from 'react';\n\nconst MantineContext = createContext(null);\nfunction useMantineContext() {\n  const ctx = useContext(MantineContext);\n  if (!ctx) {\n    throw new Error(\"[@mantine/core] MantineProvider was not found in tree\");\n  }\n  return ctx;\n}\nfunction useMantineCssVariablesResolver() {\n  return useMantineContext().cssVariablesResolver;\n}\nfunction useMantineClassNamesPrefix() {\n  return useMantineContext().classNamesPrefix;\n}\nfunction useMantineStyleNonce() {\n  return useMantineContext().getStyleNonce;\n}\nfunction useMantineWithStaticClasses() {\n  return useMantineContext().withStaticClasses;\n}\nfunction useMantineIsHeadless() {\n  return useMantineContext().headless;\n}\nfunction useMantineSxTransform() {\n  return useMantineContext().stylesTransform?.sx;\n}\nfunction useMantineStylesTransform() {\n  return useMantineContext().stylesTransform?.styles;\n}\n\nexport { MantineContext, useMantineClassNamesPrefix, useMantineContext, useMantineCssVariablesResolver, useMantineIsHeadless, useMantineStyleNonce, useMantineStylesTransform, useMantineSxTransform, useMantineWithStaticClasses };\n//# sourceMappingURL=Mantine.context.mjs.map\n","function isHexColor(hex) {\n  const HEX_REGEXP = /^#?([0-9A-F]{3}){1,2}([0-9A-F]{2})?$/i;\n  return HEX_REGEXP.test(hex);\n}\nfunction hexToRgba(color) {\n  let hexString = color.replace(\"#\", \"\");\n  if (hexString.length === 3) {\n    const shorthandHex = hexString.split(\"\");\n    hexString = [\n      shorthandHex[0],\n      shorthandHex[0],\n      shorthandHex[1],\n      shorthandHex[1],\n      shorthandHex[2],\n      shorthandHex[2]\n    ].join(\"\");\n  }\n  if (hexString.length === 8) {\n    const alpha = parseInt(hexString.slice(6, 8), 16) / 255;\n    return {\n      r: parseInt(hexString.slice(0, 2), 16),\n      g: parseInt(hexString.slice(2, 4), 16),\n      b: parseInt(hexString.slice(4, 6), 16),\n      a: alpha\n    };\n  }\n  const parsed = parseInt(hexString, 16);\n  const r = parsed >> 16 & 255;\n  const g = parsed >> 8 & 255;\n  const b = parsed & 255;\n  return {\n    r,\n    g,\n    b,\n    a: 1\n  };\n}\nfunction rgbStringToRgba(color) {\n  const [r, g, b, a] = color.replace(/[^0-9,./]/g, \"\").split(/[/,]/).map(Number);\n  return { r, g, b, a: a || 1 };\n}\nfunction hslStringToRgba(hslaString) {\n  const hslaRegex = /^hsla?\\(\\s*(\\d+)\\s*,\\s*(\\d+%)\\s*,\\s*(\\d+%)\\s*(,\\s*(0?\\.\\d+|\\d+(\\.\\d+)?))?\\s*\\)$/i;\n  const matches = hslaString.match(hslaRegex);\n  if (!matches) {\n    return {\n      r: 0,\n      g: 0,\n      b: 0,\n      a: 1\n    };\n  }\n  const h = parseInt(matches[1], 10);\n  const s = parseInt(matches[2], 10) / 100;\n  const l = parseInt(matches[3], 10) / 100;\n  const a = matches[5] ? parseFloat(matches[5]) : void 0;\n  const chroma = (1 - Math.abs(2 * l - 1)) * s;\n  const huePrime = h / 60;\n  const x = chroma * (1 - Math.abs(huePrime % 2 - 1));\n  const m = l - chroma / 2;\n  let r;\n  let g;\n  let b;\n  if (huePrime >= 0 && huePrime < 1) {\n    r = chroma;\n    g = x;\n    b = 0;\n  } else if (huePrime >= 1 && huePrime < 2) {\n    r = x;\n    g = chroma;\n    b = 0;\n  } else if (huePrime >= 2 && huePrime < 3) {\n    r = 0;\n    g = chroma;\n    b = x;\n  } else if (huePrime >= 3 && huePrime < 4) {\n    r = 0;\n    g = x;\n    b = chroma;\n  } else if (huePrime >= 4 && huePrime < 5) {\n    r = x;\n    g = 0;\n    b = chroma;\n  } else {\n    r = chroma;\n    g = 0;\n    b = x;\n  }\n  return {\n    r: Math.round((r + m) * 255),\n    g: Math.round((g + m) * 255),\n    b: Math.round((b + m) * 255),\n    a: a || 1\n  };\n}\nfunction toRgba(color) {\n  if (isHexColor(color)) {\n    return hexToRgba(color);\n  }\n  if (color.startsWith(\"rgb\")) {\n    return rgbStringToRgba(color);\n  }\n  if (color.startsWith(\"hsl\")) {\n    return hslStringToRgba(color);\n  }\n  return {\n    r: 0,\n    g: 0,\n    b: 0,\n    a: 1\n  };\n}\n\nexport { toRgba };\n//# sourceMappingURL=to-rgba.mjs.map\n","import { toRgba } from '../to-rgba/to-rgba.mjs';\n\nfunction darken(color, alpha) {\n  if (color.startsWith(\"var(\")) {\n    return `color-mix(in srgb, ${color}, black ${alpha * 100}%)`;\n  }\n  const { r, g, b, a } = toRgba(color);\n  const f = 1 - alpha;\n  const dark = (input) => Math.round(input * f);\n  return `rgba(${dark(r)}, ${dark(g)}, ${dark(b)}, ${a})`;\n}\n\nexport { darken };\n//# sourceMappingURL=darken.mjs.map\n","'use client';\nfunction getPrimaryShade(theme, colorScheme) {\n  if (typeof theme.primaryShade === \"number\") {\n    return theme.primaryShade;\n  }\n  if (colorScheme === \"dark\") {\n    return theme.primaryShade.dark;\n  }\n  return theme.primaryShade.light;\n}\n\nexport { getPrimaryShade };\n//# sourceMappingURL=get-primary-shade.mjs.map\n","'use client';\nimport { toRgba } from '../to-rgba/to-rgba.mjs';\n\nfunction gammaCorrect(c) {\n  return c <= 0.03928 ? c / 12.92 : ((c + 0.055) / 1.055) ** 2.4;\n}\nfunction getLightnessFromOklch(oklchColor) {\n  const match = oklchColor.match(/oklch\\((.*?)%\\s/);\n  return match ? parseFloat(match[1]) : null;\n}\nfunction luminance(color) {\n  if (color.startsWith(\"oklch(\")) {\n    return (getLightnessFromOklch(color) || 0) / 100;\n  }\n  const { r, g, b } = toRgba(color);\n  const sR = r / 255;\n  const sG = g / 255;\n  const sB = b / 255;\n  const rLinear = gammaCorrect(sR);\n  const gLinear = gammaCorrect(sG);\n  const bLinear = gammaCorrect(sB);\n  return 0.2126 * rLinear + 0.7152 * gLinear + 0.0722 * bLinear;\n}\nfunction isLightColor(color, luminanceThreshold = 0.179) {\n  if (color.startsWith(\"var(\")) {\n    return false;\n  }\n  return luminance(color) > luminanceThreshold;\n}\n\nexport { isLightColor, luminance };\n//# sourceMappingURL=luminance.mjs.map\n","'use client';\nimport { getPrimaryShade } from '../get-primary-shade/get-primary-shade.mjs';\nimport { isLightColor } from '../luminance/luminance.mjs';\n\nfunction parseThemeColor({\n  color,\n  theme,\n  colorScheme\n}) {\n  if (typeof color !== \"string\") {\n    throw new Error(\n      `[@mantine/core] Failed to parse color. Expected color to be a string, instead got ${typeof color}`\n    );\n  }\n  if (color === \"bright\") {\n    return {\n      color,\n      value: colorScheme === \"dark\" ? theme.white : theme.black,\n      shade: void 0,\n      isThemeColor: false,\n      isLight: isLightColor(\n        colorScheme === \"dark\" ? theme.white : theme.black,\n        theme.luminanceThreshold\n      ),\n      variable: \"--mantine-color-bright\"\n    };\n  }\n  if (color === \"dimmed\") {\n    return {\n      color,\n      value: colorScheme === \"dark\" ? theme.colors.dark[2] : theme.colors.gray[7],\n      shade: void 0,\n      isThemeColor: false,\n      isLight: isLightColor(\n        colorScheme === \"dark\" ? theme.colors.dark[2] : theme.colors.gray[6],\n        theme.luminanceThreshold\n      ),\n      variable: \"--mantine-color-dimmed\"\n    };\n  }\n  if (color === \"white\" || color === \"black\") {\n    return {\n      color,\n      value: color === \"white\" ? theme.white : theme.black,\n      shade: void 0,\n      isThemeColor: false,\n      isLight: isLightColor(\n        color === \"white\" ? theme.white : theme.black,\n        theme.luminanceThreshold\n      ),\n      variable: `--mantine-color-${color}`\n    };\n  }\n  const [_color, shade] = color.split(\".\");\n  const colorShade = shade ? Number(shade) : void 0;\n  const isThemeColor = _color in theme.colors;\n  if (isThemeColor) {\n    const colorValue = colorShade !== void 0 ? theme.colors[_color][colorShade] : theme.colors[_color][getPrimaryShade(theme, colorScheme || \"light\")];\n    return {\n      color: _color,\n      value: colorValue,\n      shade: colorShade,\n      isThemeColor,\n      isLight: isLightColor(colorValue, theme.luminanceThreshold),\n      variable: shade ? `--mantine-color-${_color}-${colorShade}` : `--mantine-color-${_color}-filled`\n    };\n  }\n  return {\n    color,\n    value: color,\n    isThemeColor,\n    isLight: isLightColor(color, theme.luminanceThreshold),\n    shade: colorShade,\n    variable: void 0\n  };\n}\n\nexport { parseThemeColor };\n//# sourceMappingURL=parse-theme-color.mjs.map\n","'use client';\nimport { parseThemeColor } from '../parse-theme-color/parse-theme-color.mjs';\n\nfunction getThemeColor(color, theme) {\n  const parsed = parseThemeColor({ color: color || theme.primaryColor, theme });\n  return parsed.variable ? `var(${parsed.variable})` : color;\n}\n\nexport { getThemeColor };\n//# sourceMappingURL=get-theme-color.mjs.map\n","'use client';\nimport { getThemeColor } from '../get-theme-color/get-theme-color.mjs';\n\nfunction getGradient(gradient, theme) {\n  const merged = {\n    from: gradient?.from || theme.defaultGradient.from,\n    to: gradient?.to || theme.defaultGradient.to,\n    deg: gradient?.deg || theme.defaultGradient.deg || 0\n  };\n  const fromColor = getThemeColor(merged.from, theme);\n  const toColor = getThemeColor(merged.to, theme);\n  return `linear-gradient(${merged.deg}deg, ${fromColor} 0%, ${toColor} 100%)`;\n}\n\nexport { getGradient };\n//# sourceMappingURL=get-gradient.mjs.map\n","import { toRgba } from '../to-rgba/to-rgba.mjs';\n\nfunction rgba(color, alpha2) {\n  if (typeof color !== \"string\" || alpha2 > 1 || alpha2 < 0) {\n    return \"rgba(0, 0, 0, 1)\";\n  }\n  if (color.startsWith(\"var(\")) {\n    const mixPercentage = (1 - alpha2) * 100;\n    return `color-mix(in srgb, ${color}, transparent ${mixPercentage}%)`;\n  }\n  if (color.startsWith(\"oklch\")) {\n    if (color.includes(\"/\")) {\n      return color.replace(/\\/\\s*[\\d.]+\\s*\\)/, `/ ${alpha2})`);\n    }\n    return color.replace(\")\", ` / ${alpha2})`);\n  }\n  const { r, g, b } = toRgba(color);\n  return `rgba(${r}, ${g}, ${b}, ${alpha2})`;\n}\nconst alpha = rgba;\n\nexport { alpha, rgba };\n//# sourceMappingURL=rgba.mjs.map\n","'use client';\nimport { rem } from '../../../utils/units-converters/rem.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { darken } from '../darken/darken.mjs';\nimport { getGradient } from '../get-gradient/get-gradient.mjs';\nimport { parseThemeColor } from '../parse-theme-color/parse-theme-color.mjs';\nimport { rgba } from '../rgba/rgba.mjs';\n\nconst defaultVariantColorsResolver = ({\n  color,\n  theme,\n  variant,\n  gradient,\n  autoContrast\n}) => {\n  const parsed = parseThemeColor({ color, theme });\n  const _autoContrast = typeof autoContrast === \"boolean\" ? autoContrast : theme.autoContrast;\n  if (variant === \"filled\") {\n    const textColor = _autoContrast ? parsed.isLight ? \"var(--mantine-color-black)\" : \"var(--mantine-color-white)\" : \"var(--mantine-color-white)\";\n    if (parsed.isThemeColor) {\n      if (parsed.shade === void 0) {\n        return {\n          background: `var(--mantine-color-${color}-filled)`,\n          hover: `var(--mantine-color-${color}-filled-hover)`,\n          color: textColor,\n          border: `${rem(1)} solid transparent`\n        };\n      }\n      return {\n        background: `var(--mantine-color-${parsed.color}-${parsed.shade})`,\n        hover: `var(--mantine-color-${parsed.color}-${parsed.shade === 9 ? 8 : parsed.shade + 1})`,\n        color: textColor,\n        border: `${rem(1)} solid transparent`\n      };\n    }\n    return {\n      background: color,\n      hover: darken(color, 0.1),\n      color: textColor,\n      border: `${rem(1)} solid transparent`\n    };\n  }\n  if (variant === \"light\") {\n    if (parsed.isThemeColor) {\n      if (parsed.shade === void 0) {\n        return {\n          background: `var(--mantine-color-${color}-light)`,\n          hover: `var(--mantine-color-${color}-light-hover)`,\n          color: `var(--mantine-color-${color}-light-color)`,\n          border: `${rem(1)} solid transparent`\n        };\n      }\n      const parsedColor = theme.colors[parsed.color][parsed.shade];\n      return {\n        background: rgba(parsedColor, 0.1),\n        hover: rgba(parsedColor, 0.12),\n        color: `var(--mantine-color-${parsed.color}-${Math.min(parsed.shade, 6)})`,\n        border: `${rem(1)} solid transparent`\n      };\n    }\n    return {\n      background: rgba(color, 0.1),\n      hover: rgba(color, 0.12),\n      color,\n      border: `${rem(1)} solid transparent`\n    };\n  }\n  if (variant === \"outline\") {\n    if (parsed.isThemeColor) {\n      if (parsed.shade === void 0) {\n        return {\n          background: \"transparent\",\n          hover: `var(--mantine-color-${color}-outline-hover)`,\n          color: `var(--mantine-color-${color}-outline)`,\n          border: `${rem(1)} solid var(--mantine-color-${color}-outline)`\n        };\n      }\n      return {\n        background: \"transparent\",\n        hover: rgba(theme.colors[parsed.color][parsed.shade], 0.05),\n        color: `var(--mantine-color-${parsed.color}-${parsed.shade})`,\n        border: `${rem(1)} solid var(--mantine-color-${parsed.color}-${parsed.shade})`\n      };\n    }\n    return {\n      background: \"transparent\",\n      hover: rgba(color, 0.05),\n      color,\n      border: `${rem(1)} solid ${color}`\n    };\n  }\n  if (variant === \"subtle\") {\n    if (parsed.isThemeColor) {\n      if (parsed.shade === void 0) {\n        return {\n          background: \"transparent\",\n          hover: `var(--mantine-color-${color}-light-hover)`,\n          color: `var(--mantine-color-${color}-light-color)`,\n          border: `${rem(1)} solid transparent`\n        };\n      }\n      const parsedColor = theme.colors[parsed.color][parsed.shade];\n      return {\n        background: \"transparent\",\n        hover: rgba(parsedColor, 0.12),\n        color: `var(--mantine-color-${parsed.color}-${Math.min(parsed.shade, 6)})`,\n        border: `${rem(1)} solid transparent`\n      };\n    }\n    return {\n      background: \"transparent\",\n      hover: rgba(color, 0.12),\n      color,\n      border: `${rem(1)} solid transparent`\n    };\n  }\n  if (variant === \"transparent\") {\n    if (parsed.isThemeColor) {\n      if (parsed.shade === void 0) {\n        return {\n          background: \"transparent\",\n          hover: \"transparent\",\n          color: `var(--mantine-color-${color}-light-color)`,\n          border: `${rem(1)} solid transparent`\n        };\n      }\n      return {\n        background: \"transparent\",\n        hover: \"transparent\",\n        color: `var(--mantine-color-${parsed.color}-${Math.min(parsed.shade, 6)})`,\n        border: `${rem(1)} solid transparent`\n      };\n    }\n    return {\n      background: \"transparent\",\n      hover: \"transparent\",\n      color,\n      border: `${rem(1)} solid transparent`\n    };\n  }\n  if (variant === \"white\") {\n    if (parsed.isThemeColor) {\n      if (parsed.shade === void 0) {\n        return {\n          background: \"var(--mantine-color-white)\",\n          hover: darken(theme.white, 0.01),\n          color: `var(--mantine-color-${color}-filled)`,\n          border: `${rem(1)} solid transparent`\n        };\n      }\n      return {\n        background: \"var(--mantine-color-white)\",\n        hover: darken(theme.white, 0.01),\n        color: `var(--mantine-color-${parsed.color}-${parsed.shade})`,\n        border: `${rem(1)} solid transparent`\n      };\n    }\n    return {\n      background: \"var(--mantine-color-white)\",\n      hover: darken(theme.white, 0.01),\n      color,\n      border: `${rem(1)} solid transparent`\n    };\n  }\n  if (variant === \"gradient\") {\n    return {\n      background: getGradient(gradient, theme),\n      hover: getGradient(gradient, theme),\n      color: \"var(--mantine-color-white)\",\n      border: \"none\"\n    };\n  }\n  if (variant === \"default\") {\n    return {\n      background: \"var(--mantine-color-default)\",\n      hover: \"var(--mantine-color-default-hover)\",\n      color: \"var(--mantine-color-default-color)\",\n      border: `${rem(1)} solid var(--mantine-color-default-border)`\n    };\n  }\n  return {};\n};\n\nexport { defaultVariantColorsResolver };\n//# sourceMappingURL=default-variant-colors-resolver.mjs.map\n","const DEFAULT_COLORS = {\n  dark: [\n    \"#C9C9C9\",\n    \"#b8b8b8\",\n    \"#828282\",\n    \"#696969\",\n    \"#424242\",\n    \"#3b3b3b\",\n    \"#2e2e2e\",\n    \"#242424\",\n    \"#1f1f1f\",\n    \"#141414\"\n  ],\n  gray: [\n    \"#f8f9fa\",\n    \"#f1f3f5\",\n    \"#e9ecef\",\n    \"#dee2e6\",\n    \"#ced4da\",\n    \"#adb5bd\",\n    \"#868e96\",\n    \"#495057\",\n    \"#343a40\",\n    \"#212529\"\n  ],\n  red: [\n    \"#fff5f5\",\n    \"#ffe3e3\",\n    \"#ffc9c9\",\n    \"#ffa8a8\",\n    \"#ff8787\",\n    \"#ff6b6b\",\n    \"#fa5252\",\n    \"#f03e3e\",\n    \"#e03131\",\n    \"#c92a2a\"\n  ],\n  pink: [\n    \"#fff0f6\",\n    \"#ffdeeb\",\n    \"#fcc2d7\",\n    \"#faa2c1\",\n    \"#f783ac\",\n    \"#f06595\",\n    \"#e64980\",\n    \"#d6336c\",\n    \"#c2255c\",\n    \"#a61e4d\"\n  ],\n  grape: [\n    \"#f8f0fc\",\n    \"#f3d9fa\",\n    \"#eebefa\",\n    \"#e599f7\",\n    \"#da77f2\",\n    \"#cc5de8\",\n    \"#be4bdb\",\n    \"#ae3ec9\",\n    \"#9c36b5\",\n    \"#862e9c\"\n  ],\n  violet: [\n    \"#f3f0ff\",\n    \"#e5dbff\",\n    \"#d0bfff\",\n    \"#b197fc\",\n    \"#9775fa\",\n    \"#845ef7\",\n    \"#7950f2\",\n    \"#7048e8\",\n    \"#6741d9\",\n    \"#5f3dc4\"\n  ],\n  indigo: [\n    \"#edf2ff\",\n    \"#dbe4ff\",\n    \"#bac8ff\",\n    \"#91a7ff\",\n    \"#748ffc\",\n    \"#5c7cfa\",\n    \"#4c6ef5\",\n    \"#4263eb\",\n    \"#3b5bdb\",\n    \"#364fc7\"\n  ],\n  blue: [\n    \"#e7f5ff\",\n    \"#d0ebff\",\n    \"#a5d8ff\",\n    \"#74c0fc\",\n    \"#4dabf7\",\n    \"#339af0\",\n    \"#228be6\",\n    \"#1c7ed6\",\n    \"#1971c2\",\n    \"#1864ab\"\n  ],\n  cyan: [\n    \"#e3fafc\",\n    \"#c5f6fa\",\n    \"#99e9f2\",\n    \"#66d9e8\",\n    \"#3bc9db\",\n    \"#22b8cf\",\n    \"#15aabf\",\n    \"#1098ad\",\n    \"#0c8599\",\n    \"#0b7285\"\n  ],\n  teal: [\n    \"#e6fcf5\",\n    \"#c3fae8\",\n    \"#96f2d7\",\n    \"#63e6be\",\n    \"#38d9a9\",\n    \"#20c997\",\n    \"#12b886\",\n    \"#0ca678\",\n    \"#099268\",\n    \"#087f5b\"\n  ],\n  green: [\n    \"#ebfbee\",\n    \"#d3f9d8\",\n    \"#b2f2bb\",\n    \"#8ce99a\",\n    \"#69db7c\",\n    \"#51cf66\",\n    \"#40c057\",\n    \"#37b24d\",\n    \"#2f9e44\",\n    \"#2b8a3e\"\n  ],\n  lime: [\n    \"#f4fce3\",\n    \"#e9fac8\",\n    \"#d8f5a2\",\n    \"#c0eb75\",\n    \"#a9e34b\",\n    \"#94d82d\",\n    \"#82c91e\",\n    \"#74b816\",\n    \"#66a80f\",\n    \"#5c940d\"\n  ],\n  yellow: [\n    \"#fff9db\",\n    \"#fff3bf\",\n    \"#ffec99\",\n    \"#ffe066\",\n    \"#ffd43b\",\n    \"#fcc419\",\n    \"#fab005\",\n    \"#f59f00\",\n    \"#f08c00\",\n    \"#e67700\"\n  ],\n  orange: [\n    \"#fff4e6\",\n    \"#ffe8cc\",\n    \"#ffd8a8\",\n    \"#ffc078\",\n    \"#ffa94d\",\n    \"#ff922b\",\n    \"#fd7e14\",\n    \"#f76707\",\n    \"#e8590c\",\n    \"#d9480f\"\n  ]\n};\n\nexport { DEFAULT_COLORS };\n//# sourceMappingURL=default-colors.mjs.map\n","import { rem } from '../utils/units-converters/rem.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { defaultVariantColorsResolver } from './color-functions/default-variant-colors-resolver/default-variant-colors-resolver.mjs';\nimport { DEFAULT_COLORS } from './default-colors.mjs';\n\nconst DEFAULT_FONT_FAMILY = \"-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji\";\nconst DEFAULT_THEME = {\n  scale: 1,\n  fontSmoothing: true,\n  focusRing: \"auto\",\n  white: \"#fff\",\n  black: \"#000\",\n  colors: DEFAULT_COLORS,\n  primaryShade: { light: 6, dark: 8 },\n  primaryColor: \"blue\",\n  variantColorResolver: defaultVariantColorsResolver,\n  autoContrast: false,\n  luminanceThreshold: 0.3,\n  fontFamily: DEFAULT_FONT_FAMILY,\n  fontFamilyMonospace: \"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace\",\n  respectReducedMotion: false,\n  cursorType: \"default\",\n  defaultGradient: { from: \"blue\", to: \"cyan\", deg: 45 },\n  defaultRadius: \"sm\",\n  activeClassName: \"mantine-active\",\n  focusClassName: \"\",\n  headings: {\n    fontFamily: DEFAULT_FONT_FAMILY,\n    fontWeight: \"700\",\n    textWrap: \"wrap\",\n    sizes: {\n      h1: { fontSize: rem(34), lineHeight: \"1.3\" },\n      h2: { fontSize: rem(26), lineHeight: \"1.35\" },\n      h3: { fontSize: rem(22), lineHeight: \"1.4\" },\n      h4: { fontSize: rem(18), lineHeight: \"1.45\" },\n      h5: { fontSize: rem(16), lineHeight: \"1.5\" },\n      h6: { fontSize: rem(14), lineHeight: \"1.5\" }\n    }\n  },\n  fontSizes: {\n    xs: rem(12),\n    sm: rem(14),\n    md: rem(16),\n    lg: rem(18),\n    xl: rem(20)\n  },\n  lineHeights: {\n    xs: \"1.4\",\n    sm: \"1.45\",\n    md: \"1.55\",\n    lg: \"1.6\",\n    xl: \"1.65\"\n  },\n  radius: {\n    xs: rem(2),\n    sm: rem(4),\n    md: rem(8),\n    lg: rem(16),\n    xl: rem(32)\n  },\n  spacing: {\n    xs: rem(10),\n    sm: rem(12),\n    md: rem(16),\n    lg: rem(20),\n    xl: rem(32)\n  },\n  breakpoints: {\n    xs: \"36em\",\n    sm: \"48em\",\n    md: \"62em\",\n    lg: \"75em\",\n    xl: \"88em\"\n  },\n  shadows: {\n    xs: `0 ${rem(1)} ${rem(3)} rgba(0, 0, 0, 0.05), 0 ${rem(1)} ${rem(2)} rgba(0, 0, 0, 0.1)`,\n    sm: `0 ${rem(1)} ${rem(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${rem(10)} ${rem(\n      15\n    )} ${rem(-5)}, rgba(0, 0, 0, 0.04) 0 ${rem(7)} ${rem(7)} ${rem(-5)}`,\n    md: `0 ${rem(1)} ${rem(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${rem(20)} ${rem(\n      25\n    )} ${rem(-5)}, rgba(0, 0, 0, 0.04) 0 ${rem(10)} ${rem(10)} ${rem(-5)}`,\n    lg: `0 ${rem(1)} ${rem(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${rem(28)} ${rem(\n      23\n    )} ${rem(-7)}, rgba(0, 0, 0, 0.04) 0 ${rem(12)} ${rem(12)} ${rem(-7)}`,\n    xl: `0 ${rem(1)} ${rem(3)} rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0 ${rem(36)} ${rem(\n      28\n    )} ${rem(-7)}, rgba(0, 0, 0, 0.04) 0 ${rem(17)} ${rem(17)} ${rem(-7)}`\n  },\n  other: {},\n  components: {}\n};\n\nexport { DEFAULT_THEME };\n//# sourceMappingURL=default-theme.mjs.map\n","'use client';\nfunction isMantineColorScheme(value) {\n  return value === \"auto\" || value === \"dark\" || value === \"light\";\n}\n\nexport { isMantineColorScheme };\n//# sourceMappingURL=is-mantine-color-scheme.mjs.map\n","'use client';\nimport { isMantineColorScheme } from './is-mantine-color-scheme.mjs';\n\nfunction localStorageColorSchemeManager({\n  key = \"mantine-color-scheme-value\"\n} = {}) {\n  let handleStorageEvent;\n  return {\n    get: (defaultValue) => {\n      if (typeof window === \"undefined\") {\n        return defaultValue;\n      }\n      try {\n        const storedColorScheme = window.localStorage.getItem(key);\n        return isMantineColorScheme(storedColorScheme) ? storedColorScheme : defaultValue;\n      } catch {\n        return defaultValue;\n      }\n    },\n    set: (value) => {\n      try {\n        window.localStorage.setItem(key, value);\n      } catch (error) {\n        console.warn(\n          \"[@mantine/core] Local storage color scheme manager was unable to save color scheme.\",\n          error\n        );\n      }\n    },\n    subscribe: (onUpdate) => {\n      handleStorageEvent = (event) => {\n        if (event.storageArea === window.localStorage && event.key === key) {\n          isMantineColorScheme(event.newValue) && onUpdate(event.newValue);\n        }\n      };\n      window.addEventListener(\"storage\", handleStorageEvent);\n    },\n    unsubscribe: () => {\n      window.removeEventListener(\"storage\", handleStorageEvent);\n    },\n    clear: () => {\n      window.localStorage.removeItem(key);\n    }\n  };\n}\n\nexport { localStorageColorSchemeManager };\n//# sourceMappingURL=local-storage-manager.mjs.map\n","import { deepMerge } from '../../utils/deep-merge/deep-merge.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\n\nconst INVALID_PRIMARY_COLOR_ERROR = \"[@mantine/core] MantineProvider: Invalid theme.primaryColor, it accepts only key of theme.colors, learn more \\u2013 https://mantine.dev/theming/colors/#primary-color\";\nconst INVALID_PRIMARY_SHADE_ERROR = \"[@mantine/core] MantineProvider: Invalid theme.primaryShade, it accepts only 0-9 integers or an object { light: 0-9, dark: 0-9 }\";\nfunction isValidPrimaryShade(shade) {\n  if (shade < 0 || shade > 9) {\n    return false;\n  }\n  return parseInt(shade.toString(), 10) === shade;\n}\nfunction validateMantineTheme(theme) {\n  if (!(theme.primaryColor in theme.colors)) {\n    throw new Error(INVALID_PRIMARY_COLOR_ERROR);\n  }\n  if (typeof theme.primaryShade === \"object\") {\n    if (!isValidPrimaryShade(theme.primaryShade.dark) || !isValidPrimaryShade(theme.primaryShade.light)) {\n      throw new Error(INVALID_PRIMARY_SHADE_ERROR);\n    }\n  }\n  if (typeof theme.primaryShade === \"number\" && !isValidPrimaryShade(theme.primaryShade)) {\n    throw new Error(INVALID_PRIMARY_SHADE_ERROR);\n  }\n}\nfunction mergeMantineTheme(currentTheme, themeOverride) {\n  if (!themeOverride) {\n    validateMantineTheme(currentTheme);\n    return currentTheme;\n  }\n  const result = deepMerge(currentTheme, themeOverride);\n  if (themeOverride.fontFamily && !themeOverride.headings?.fontFamily) {\n    result.headings.fontFamily = themeOverride.fontFamily;\n  }\n  validateMantineTheme(result);\n  return result;\n}\n\nexport { INVALID_PRIMARY_COLOR_ERROR, INVALID_PRIMARY_SHADE_ERROR, mergeMantineTheme, validateMantineTheme };\n//# sourceMappingURL=merge-mantine-theme.mjs.map\n","'use client';\nimport { jsx } from 'react/jsx-runtime';\nimport { createContext, useContext, useMemo } from 'react';\nimport { DEFAULT_THEME } from '../default-theme.mjs';\nimport { mergeMantineTheme } from '../merge-mantine-theme/merge-mantine-theme.mjs';\n\nconst MantineThemeContext = createContext(null);\nconst useSafeMantineTheme = () => useContext(MantineThemeContext) || DEFAULT_THEME;\nfunction useMantineTheme() {\n  const ctx = useContext(MantineThemeContext);\n  if (!ctx) {\n    throw new Error(\n      \"@mantine/core: MantineProvider was not found in component tree, make sure you have it in your app\"\n    );\n  }\n  return ctx;\n}\nfunction MantineThemeProvider({\n  theme,\n  children,\n  inherit = true\n}) {\n  const parentTheme = useSafeMantineTheme();\n  const mergedTheme = useMemo(\n    () => mergeMantineTheme(inherit ? parentTheme : DEFAULT_THEME, theme),\n    [theme, parentTheme, inherit]\n  );\n  return /* @__PURE__ */ jsx(MantineThemeContext.Provider, { value: mergedTheme, children });\n}\nMantineThemeProvider.displayName = \"@mantine/core/MantineThemeProvider\";\n\nexport { MantineThemeContext, MantineThemeProvider, useMantineTheme, useSafeMantineTheme };\n//# sourceMappingURL=MantineThemeProvider.mjs.map\n","'use client';\nimport { jsx } from 'react/jsx-runtime';\nimport { keys } from '../../utils/keys/keys.mjs';\nimport { px } from '../../utils/units-converters/px.mjs';\nimport { em } from '../../utils/units-converters/rem.mjs';\nimport 'react';\nimport '@mantine/hooks';\nimport { useMantineStyleNonce } from '../Mantine.context.mjs';\nimport { useMantineTheme } from '../MantineThemeProvider/MantineThemeProvider.mjs';\n\nfunction MantineClasses() {\n  const theme = useMantineTheme();\n  const nonce = useMantineStyleNonce();\n  const classes = keys(theme.breakpoints).reduce((acc, breakpoint) => {\n    const isPxBreakpoint = theme.breakpoints[breakpoint].includes(\"px\");\n    const pxValue = px(theme.breakpoints[breakpoint]);\n    const maxWidthBreakpoint = isPxBreakpoint ? `${pxValue - 0.1}px` : em(pxValue - 0.1);\n    const minWidthBreakpoint = isPxBreakpoint ? `${pxValue}px` : em(pxValue);\n    return `${acc}@media (max-width: ${maxWidthBreakpoint}) {.mantine-visible-from-${breakpoint} {display: none !important;}}@media (min-width: ${minWidthBreakpoint}) {.mantine-hidden-from-${breakpoint} {display: none !important;}}`;\n  }, \"\");\n  return /* @__PURE__ */ jsx(\n    \"style\",\n    {\n      \"data-mantine-styles\": \"classes\",\n      nonce: nonce?.(),\n      dangerouslySetInnerHTML: { __html: classes }\n    }\n  );\n}\n\nexport { MantineClasses };\n//# sourceMappingURL=MantineClasses.mjs.map\n","'use client';\nfunction cssVariablesObjectToString(variables) {\n  return Object.entries(variables).map(([name, value]) => `${name}: ${value};`).join(\"\");\n}\n\nexport { cssVariablesObjectToString };\n//# sourceMappingURL=css-variables-object-to-string.mjs.map\n","'use client';\nfunction wrapWithSelector(selectors, code) {\n  const _selectors = Array.isArray(selectors) ? selectors : [selectors];\n  return _selectors.reduce((acc, selector) => `${selector}{${acc}}`, code);\n}\n\nexport { wrapWithSelector };\n//# sourceMappingURL=wrap-with-selector.mjs.map\n","'use client';\nimport { cssVariablesObjectToString } from './css-variables-object-to-string.mjs';\nimport { wrapWithSelector } from './wrap-with-selector.mjs';\n\nfunction convertCssVariables(input, selector) {\n  const sharedVariables = cssVariablesObjectToString(input.variables);\n  const shared = sharedVariables ? wrapWithSelector(selector, sharedVariables) : \"\";\n  const dark = cssVariablesObjectToString(input.dark);\n  const darkForced = dark ? wrapWithSelector(`${selector}[data-mantine-color-scheme=\"dark\"]`, dark) : \"\";\n  const light = cssVariablesObjectToString(input.light);\n  const lightForced = light ? wrapWithSelector(`${selector}[data-mantine-color-scheme=\"light\"]`, light) : \"\";\n  return `${shared}${darkForced}${lightForced}`;\n}\n\nexport { convertCssVariables };\n//# sourceMappingURL=convert-css-variables.mjs.map\n","'use client';\nimport { getPrimaryShade } from '../get-primary-shade/get-primary-shade.mjs';\nimport { parseThemeColor } from '../parse-theme-color/parse-theme-color.mjs';\n\nfunction getContrastColor({ color, theme, autoContrast }) {\n  const _autoContrast = typeof autoContrast === \"boolean\" ? autoContrast : theme.autoContrast;\n  if (!_autoContrast) {\n    return \"var(--mantine-color-white)\";\n  }\n  const parsed = parseThemeColor({ color: color || theme.primaryColor, theme });\n  return parsed.isLight ? \"var(--mantine-color-black)\" : \"var(--mantine-color-white)\";\n}\nfunction getPrimaryContrastColor(theme, colorScheme) {\n  return getContrastColor({\n    color: theme.colors[theme.primaryColor][getPrimaryShade(theme, colorScheme)],\n    theme,\n    autoContrast: null\n  });\n}\n\nexport { getContrastColor, getPrimaryContrastColor };\n//# sourceMappingURL=get-contrast-color.mjs.map\n","'use client';\nimport { getPrimaryShade } from '../color-functions/get-primary-shade/get-primary-shade.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { alpha } from '../color-functions/rgba/rgba.mjs';\n\nfunction getCSSColorVariables({\n  theme,\n  color,\n  colorScheme,\n  name = color,\n  withColorValues = true\n}) {\n  if (!theme.colors[color]) {\n    return {};\n  }\n  if (colorScheme === \"light\") {\n    const primaryShade2 = getPrimaryShade(theme, \"light\");\n    const dynamicVariables2 = {\n      [`--mantine-color-${name}-text`]: `var(--mantine-color-${name}-filled)`,\n      [`--mantine-color-${name}-filled`]: `var(--mantine-color-${name}-${primaryShade2})`,\n      [`--mantine-color-${name}-filled-hover`]: `var(--mantine-color-${name}-${primaryShade2 === 9 ? 8 : primaryShade2 + 1})`,\n      [`--mantine-color-${name}-light`]: alpha(theme.colors[color][primaryShade2], 0.1),\n      [`--mantine-color-${name}-light-hover`]: alpha(theme.colors[color][primaryShade2], 0.12),\n      [`--mantine-color-${name}-light-color`]: `var(--mantine-color-${name}-${primaryShade2})`,\n      [`--mantine-color-${name}-outline`]: `var(--mantine-color-${name}-${primaryShade2})`,\n      [`--mantine-color-${name}-outline-hover`]: alpha(theme.colors[color][primaryShade2], 0.05)\n    };\n    if (!withColorValues) {\n      return dynamicVariables2;\n    }\n    return {\n      [`--mantine-color-${name}-0`]: theme.colors[color][0],\n      [`--mantine-color-${name}-1`]: theme.colors[color][1],\n      [`--mantine-color-${name}-2`]: theme.colors[color][2],\n      [`--mantine-color-${name}-3`]: theme.colors[color][3],\n      [`--mantine-color-${name}-4`]: theme.colors[color][4],\n      [`--mantine-color-${name}-5`]: theme.colors[color][5],\n      [`--mantine-color-${name}-6`]: theme.colors[color][6],\n      [`--mantine-color-${name}-7`]: theme.colors[color][7],\n      [`--mantine-color-${name}-8`]: theme.colors[color][8],\n      [`--mantine-color-${name}-9`]: theme.colors[color][9],\n      ...dynamicVariables2\n    };\n  }\n  const primaryShade = getPrimaryShade(theme, \"dark\");\n  const dynamicVariables = {\n    [`--mantine-color-${name}-text`]: `var(--mantine-color-${name}-4)`,\n    [`--mantine-color-${name}-filled`]: `var(--mantine-color-${name}-${primaryShade})`,\n    [`--mantine-color-${name}-filled-hover`]: `var(--mantine-color-${name}-${primaryShade === 9 ? 8 : primaryShade + 1})`,\n    [`--mantine-color-${name}-light`]: alpha(\n      theme.colors[color][Math.max(0, primaryShade - 2)],\n      0.15\n    ),\n    [`--mantine-color-${name}-light-hover`]: alpha(\n      theme.colors[color][Math.max(0, primaryShade - 2)],\n      0.2\n    ),\n    [`--mantine-color-${name}-light-color`]: `var(--mantine-color-${name}-${Math.max(primaryShade - 5, 0)})`,\n    [`--mantine-color-${name}-outline`]: `var(--mantine-color-${name}-${Math.max(primaryShade - 4, 0)})`,\n    [`--mantine-color-${name}-outline-hover`]: alpha(\n      theme.colors[color][Math.max(primaryShade - 4, 0)],\n      0.05\n    )\n  };\n  if (!withColorValues) {\n    return dynamicVariables;\n  }\n  return {\n    [`--mantine-color-${name}-0`]: theme.colors[color][0],\n    [`--mantine-color-${name}-1`]: theme.colors[color][1],\n    [`--mantine-color-${name}-2`]: theme.colors[color][2],\n    [`--mantine-color-${name}-3`]: theme.colors[color][3],\n    [`--mantine-color-${name}-4`]: theme.colors[color][4],\n    [`--mantine-color-${name}-5`]: theme.colors[color][5],\n    [`--mantine-color-${name}-6`]: theme.colors[color][6],\n    [`--mantine-color-${name}-7`]: theme.colors[color][7],\n    [`--mantine-color-${name}-8`]: theme.colors[color][8],\n    [`--mantine-color-${name}-9`]: theme.colors[color][9],\n    ...dynamicVariables\n  };\n}\n\nexport { getCSSColorVariables };\n//# sourceMappingURL=get-css-color-variables.mjs.map\n","'use client';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { colorsTuple } from '../../color-functions/colors-tuple/colors-tuple.mjs';\n\nfunction virtualColor(input) {\n  const result = colorsTuple(\n    Array.from({ length: 10 }).map((_, i) => `var(--mantine-color-${input.name}-${i})`)\n  );\n  Object.defineProperty(result, \"mantine-virtual-color\", {\n    enumerable: false,\n    writable: false,\n    configurable: false,\n    value: true\n  });\n  Object.defineProperty(result, \"dark\", {\n    enumerable: false,\n    writable: false,\n    configurable: false,\n    value: input.dark\n  });\n  Object.defineProperty(result, \"light\", {\n    enumerable: false,\n    writable: false,\n    configurable: false,\n    value: input.light\n  });\n  Object.defineProperty(result, \"name\", {\n    enumerable: false,\n    writable: false,\n    configurable: false,\n    value: input.name\n  });\n  return result;\n}\nfunction isVirtualColor(value) {\n  return !!value && typeof value === \"object\" && \"mantine-virtual-color\" in value;\n}\n\nexport { isVirtualColor, virtualColor };\n//# sourceMappingURL=virtual-color.mjs.map\n","'use client';\nimport { keys } from '../../utils/keys/keys.mjs';\nimport { rem } from '../../utils/units-converters/rem.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { getPrimaryShade } from '../color-functions/get-primary-shade/get-primary-shade.mjs';\nimport { getPrimaryContrastColor } from '../color-functions/get-contrast-color/get-contrast-color.mjs';\nimport { getCSSColorVariables } from './get-css-color-variables.mjs';\nimport { isVirtualColor } from './virtual-color/virtual-color.mjs';\n\nfunction assignSizeVariables(variables, sizes, name) {\n  keys(sizes).forEach(\n    (size) => Object.assign(variables, { [`--mantine-${name}-${size}`]: sizes[size] })\n  );\n}\nconst defaultCssVariablesResolver = (theme) => {\n  const lightPrimaryShade = getPrimaryShade(theme, \"light\");\n  const defaultRadius = theme.defaultRadius in theme.radius ? theme.radius[theme.defaultRadius] : rem(theme.defaultRadius);\n  const result = {\n    variables: {\n      \"--mantine-scale\": theme.scale.toString(),\n      \"--mantine-cursor-type\": theme.cursorType,\n      \"--mantine-color-scheme\": \"light dark\",\n      \"--mantine-webkit-font-smoothing\": theme.fontSmoothing ? \"antialiased\" : \"unset\",\n      \"--mantine-moz-font-smoothing\": theme.fontSmoothing ? \"grayscale\" : \"unset\",\n      \"--mantine-color-white\": theme.white,\n      \"--mantine-color-black\": theme.black,\n      \"--mantine-line-height\": theme.lineHeights.md,\n      \"--mantine-font-family\": theme.fontFamily,\n      \"--mantine-font-family-monospace\": theme.fontFamilyMonospace,\n      \"--mantine-font-family-headings\": theme.headings.fontFamily,\n      \"--mantine-heading-font-weight\": theme.headings.fontWeight,\n      \"--mantine-heading-text-wrap\": theme.headings.textWrap,\n      \"--mantine-radius-default\": defaultRadius,\n      // Primary colors\n      \"--mantine-primary-color-filled\": `var(--mantine-color-${theme.primaryColor}-filled)`,\n      \"--mantine-primary-color-filled-hover\": `var(--mantine-color-${theme.primaryColor}-filled-hover)`,\n      \"--mantine-primary-color-light\": `var(--mantine-color-${theme.primaryColor}-light)`,\n      \"--mantine-primary-color-light-hover\": `var(--mantine-color-${theme.primaryColor}-light-hover)`,\n      \"--mantine-primary-color-light-color\": `var(--mantine-color-${theme.primaryColor}-light-color)`\n    },\n    light: {\n      \"--mantine-primary-color-contrast\": getPrimaryContrastColor(theme, \"light\"),\n      \"--mantine-color-bright\": \"var(--mantine-color-black)\",\n      \"--mantine-color-text\": theme.black,\n      \"--mantine-color-body\": theme.white,\n      \"--mantine-color-error\": \"var(--mantine-color-red-6)\",\n      \"--mantine-color-placeholder\": \"var(--mantine-color-gray-5)\",\n      \"--mantine-color-anchor\": `var(--mantine-color-${theme.primaryColor}-${lightPrimaryShade})`,\n      \"--mantine-color-default\": \"var(--mantine-color-white)\",\n      \"--mantine-color-default-hover\": \"var(--mantine-color-gray-0)\",\n      \"--mantine-color-default-color\": \"var(--mantine-color-black)\",\n      \"--mantine-color-default-border\": \"var(--mantine-color-gray-4)\",\n      \"--mantine-color-dimmed\": \"var(--mantine-color-gray-6)\"\n    },\n    dark: {\n      \"--mantine-primary-color-contrast\": getPrimaryContrastColor(theme, \"dark\"),\n      \"--mantine-color-bright\": \"var(--mantine-color-white)\",\n      \"--mantine-color-text\": \"var(--mantine-color-dark-0)\",\n      \"--mantine-color-body\": \"var(--mantine-color-dark-7)\",\n      \"--mantine-color-error\": \"var(--mantine-color-red-8)\",\n      \"--mantine-color-placeholder\": \"var(--mantine-color-dark-3)\",\n      \"--mantine-color-anchor\": `var(--mantine-color-${theme.primaryColor}-4)`,\n      \"--mantine-color-default\": \"var(--mantine-color-dark-6)\",\n      \"--mantine-color-default-hover\": \"var(--mantine-color-dark-5)\",\n      \"--mantine-color-default-color\": \"var(--mantine-color-white)\",\n      \"--mantine-color-default-border\": \"var(--mantine-color-dark-4)\",\n      \"--mantine-color-dimmed\": \"var(--mantine-color-dark-2)\"\n    }\n  };\n  assignSizeVariables(result.variables, theme.breakpoints, \"breakpoint\");\n  assignSizeVariables(result.variables, theme.spacing, \"spacing\");\n  assignSizeVariables(result.variables, theme.fontSizes, \"font-size\");\n  assignSizeVariables(result.variables, theme.lineHeights, \"line-height\");\n  assignSizeVariables(result.variables, theme.shadows, \"shadow\");\n  assignSizeVariables(result.variables, theme.radius, \"radius\");\n  theme.colors[theme.primaryColor].forEach((_, index) => {\n    result.variables[`--mantine-primary-color-${index}`] = `var(--mantine-color-${theme.primaryColor}-${index})`;\n  });\n  keys(theme.colors).forEach((color) => {\n    const value = theme.colors[color];\n    if (isVirtualColor(value)) {\n      Object.assign(\n        result.light,\n        getCSSColorVariables({\n          theme,\n          name: value.name,\n          color: value.light,\n          colorScheme: \"light\",\n          withColorValues: true\n        })\n      );\n      Object.assign(\n        result.dark,\n        getCSSColorVariables({\n          theme,\n          name: value.name,\n          color: value.dark,\n          colorScheme: \"dark\",\n          withColorValues: true\n        })\n      );\n      return;\n    }\n    value.forEach((shade, index) => {\n      result.variables[`--mantine-color-${color}-${index}`] = shade;\n    });\n    Object.assign(\n      result.light,\n      getCSSColorVariables({\n        theme,\n        color,\n        colorScheme: \"light\",\n        withColorValues: false\n      })\n    );\n    Object.assign(\n      result.dark,\n      getCSSColorVariables({\n        theme,\n        color,\n        colorScheme: \"dark\",\n        withColorValues: false\n      })\n    );\n  });\n  const headings = theme.headings.sizes;\n  keys(headings).forEach((heading) => {\n    result.variables[`--mantine-${heading}-font-size`] = headings[heading].fontSize;\n    result.variables[`--mantine-${heading}-line-height`] = headings[heading].lineHeight;\n    result.variables[`--mantine-${heading}-font-weight`] = headings[heading].fontWeight || theme.headings.fontWeight;\n  });\n  return result;\n};\n\nexport { defaultCssVariablesResolver };\n//# sourceMappingURL=default-css-variables-resolver.mjs.map\n","'use client';\nimport { deepMerge } from '../../utils/deep-merge/deep-merge.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { defaultCssVariablesResolver } from './default-css-variables-resolver.mjs';\n\nfunction getMergedVariables({ theme, generator }) {\n  const defaultResolver = defaultCssVariablesResolver(theme);\n  const providerGenerator = generator?.(theme);\n  return providerGenerator ? deepMerge(defaultResolver, providerGenerator) : defaultResolver;\n}\n\nexport { getMergedVariables };\n//# sourceMappingURL=get-merged-variables.mjs.map\n","'use client';\nimport { keys } from '../../utils/keys/keys.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { DEFAULT_THEME } from '../default-theme.mjs';\nimport { defaultCssVariablesResolver } from './default-css-variables-resolver.mjs';\n\nconst defaultCssVariables = defaultCssVariablesResolver(DEFAULT_THEME);\nfunction removeDefaultVariables(input) {\n  const cleaned = {\n    variables: {},\n    light: {},\n    dark: {}\n  };\n  keys(input.variables).forEach((key) => {\n    if (defaultCssVariables.variables[key] !== input.variables[key]) {\n      cleaned.variables[key] = input.variables[key];\n    }\n  });\n  keys(input.light).forEach((key) => {\n    if (defaultCssVariables.light[key] !== input.light[key]) {\n      cleaned.light[key] = input.light[key];\n    }\n  });\n  keys(input.dark).forEach((key) => {\n    if (defaultCssVariables.dark[key] !== input.dark[key]) {\n      cleaned.dark[key] = input.dark[key];\n    }\n  });\n  return cleaned;\n}\n\nexport { removeDefaultVariables };\n//# sourceMappingURL=remove-default-variables.mjs.map\n","'use client';\nimport { jsx } from 'react/jsx-runtime';\nimport { convertCssVariables } from '../convert-css-variables/convert-css-variables.mjs';\nimport { useMantineStyleNonce, useMantineCssVariablesResolver } from '../Mantine.context.mjs';\nimport { useMantineTheme } from '../MantineThemeProvider/MantineThemeProvider.mjs';\nimport { getMergedVariables } from './get-merged-variables.mjs';\nimport { removeDefaultVariables } from './remove-default-variables.mjs';\n\nfunction getColorSchemeCssVariables(selector) {\n  return `\n  ${selector}[data-mantine-color-scheme=\"dark\"] { --mantine-color-scheme: dark; }\n  ${selector}[data-mantine-color-scheme=\"light\"] { --mantine-color-scheme: light; }\n`;\n}\nfunction MantineCssVariables({\n  cssVariablesSelector,\n  deduplicateCssVariables\n}) {\n  const theme = useMantineTheme();\n  const nonce = useMantineStyleNonce();\n  const generator = useMantineCssVariablesResolver();\n  const mergedVariables = getMergedVariables({ theme, generator });\n  const shouldCleanVariables = cssVariablesSelector === \":root\" && deduplicateCssVariables;\n  const cleanedVariables = shouldCleanVariables ? removeDefaultVariables(mergedVariables) : mergedVariables;\n  const css = convertCssVariables(cleanedVariables, cssVariablesSelector);\n  if (css) {\n    return /* @__PURE__ */ jsx(\n      \"style\",\n      {\n        \"data-mantine-styles\": true,\n        nonce: nonce?.(),\n        dangerouslySetInnerHTML: {\n          __html: `${css}${shouldCleanVariables ? \"\" : getColorSchemeCssVariables(cssVariablesSelector)}`\n        }\n      }\n    );\n  }\n  return null;\n}\nMantineCssVariables.displayName = \"@mantine/CssVariables\";\n\nexport { MantineCssVariables };\n//# sourceMappingURL=MantineCssVariables.mjs.map\n","'use client';\nfunction suppressNextjsWarning() {\n  const originalError = console.error;\n  console.error = (...args) => {\n    if (args.length > 1 && typeof args[0] === \"string\" && args[0].toLowerCase().includes(\"extra attributes from the server\") && typeof args[1] === \"string\" && args[1].toLowerCase().includes(\"data-mantine-color-scheme\")) ; else {\n      originalError(...args);\n    }\n  };\n}\n\nexport { suppressNextjsWarning };\n//# sourceMappingURL=suppress-nextjs-warning.mjs.map\n","'use client';\nimport { useRef, useState, useCallback, useEffect } from 'react';\nimport { useIsomorphicEffect } from '@mantine/hooks';\n\nfunction setColorSchemeAttribute(colorScheme, getRootElement) {\n  const computedColorScheme = colorScheme !== \"auto\" ? colorScheme : window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n  getRootElement()?.setAttribute(\"data-mantine-color-scheme\", computedColorScheme);\n}\nfunction useProviderColorScheme({\n  manager,\n  defaultColorScheme,\n  getRootElement,\n  forceColorScheme\n}) {\n  const media = useRef();\n  const [value, setValue] = useState(() => manager.get(defaultColorScheme));\n  const colorSchemeValue = forceColorScheme || value;\n  const setColorScheme = useCallback(\n    (colorScheme) => {\n      if (!forceColorScheme) {\n        setColorSchemeAttribute(colorScheme, getRootElement);\n        setValue(colorScheme);\n        manager.set(colorScheme);\n      }\n    },\n    [manager.set, colorSchemeValue, forceColorScheme]\n  );\n  const clearColorScheme = useCallback(() => {\n    setValue(defaultColorScheme);\n    setColorSchemeAttribute(defaultColorScheme, getRootElement);\n    manager.clear();\n  }, [manager.clear, defaultColorScheme]);\n  useEffect(() => {\n    manager.subscribe(setColorScheme);\n    return manager.unsubscribe;\n  }, [manager.subscribe, manager.unsubscribe]);\n  useIsomorphicEffect(() => {\n    setColorSchemeAttribute(manager.get(defaultColorScheme), getRootElement);\n  }, []);\n  useEffect(() => {\n    if (forceColorScheme) {\n      setColorSchemeAttribute(forceColorScheme, getRootElement);\n      return () => {\n      };\n    }\n    if (forceColorScheme === void 0) {\n      setColorSchemeAttribute(value, getRootElement);\n    }\n    media.current = window.matchMedia(\"(prefers-color-scheme: dark)\");\n    const listener = (event) => {\n      if (value === \"auto\") {\n        setColorSchemeAttribute(event.matches ? \"dark\" : \"light\", getRootElement);\n      }\n    };\n    media.current?.addEventListener(\"change\", listener);\n    return () => media.current?.removeEventListener(\"change\", listener);\n  }, [value, forceColorScheme]);\n  return { colorScheme: colorSchemeValue, setColorScheme, clearColorScheme };\n}\n\nexport { useProviderColorScheme };\n//# sourceMappingURL=use-provider-color-scheme.mjs.map\n","'use client';\nimport { useIsomorphicEffect } from '@mantine/hooks';\n\nfunction useRespectReduceMotion({\n  respectReducedMotion,\n  getRootElement\n}) {\n  useIsomorphicEffect(() => {\n    if (respectReducedMotion) {\n      getRootElement()?.setAttribute(\"data-respect-reduced-motion\", \"true\");\n    }\n  }, [respectReducedMotion]);\n}\n\nexport { useRespectReduceMotion };\n//# sourceMappingURL=use-respect-reduce-motion.mjs.map\n","'use client';\nimport { jsx, jsxs } from 'react/jsx-runtime';\nimport { localStorageColorSchemeManager } from './color-scheme-managers/local-storage-manager.mjs';\nimport { MantineContext } from './Mantine.context.mjs';\nimport { MantineClasses } from './MantineClasses/MantineClasses.mjs';\nimport { MantineCssVariables } from './MantineCssVariables/MantineCssVariables.mjs';\nimport 'react';\nimport '@mantine/hooks';\nimport { MantineThemeProvider } from './MantineThemeProvider/MantineThemeProvider.mjs';\nimport { suppressNextjsWarning } from './suppress-nextjs-warning.mjs';\nimport { useProviderColorScheme } from './use-mantine-color-scheme/use-provider-color-scheme.mjs';\nimport { useRespectReduceMotion } from './use-respect-reduce-motion/use-respect-reduce-motion.mjs';\n\nsuppressNextjsWarning();\nfunction MantineProvider({\n  theme,\n  children,\n  getStyleNonce,\n  withStaticClasses = true,\n  withGlobalClasses = true,\n  deduplicateCssVariables = true,\n  withCssVariables = true,\n  cssVariablesSelector = \":root\",\n  classNamesPrefix = \"mantine\",\n  colorSchemeManager = localStorageColorSchemeManager(),\n  defaultColorScheme = \"light\",\n  getRootElement = () => document.documentElement,\n  cssVariablesResolver,\n  forceColorScheme,\n  stylesTransform\n}) {\n  const { colorScheme, setColorScheme, clearColorScheme } = useProviderColorScheme({\n    defaultColorScheme,\n    forceColorScheme,\n    manager: colorSchemeManager,\n    getRootElement\n  });\n  useRespectReduceMotion({\n    respectReducedMotion: theme?.respectReducedMotion || false,\n    getRootElement\n  });\n  return /* @__PURE__ */ jsx(\n    MantineContext.Provider,\n    {\n      value: {\n        colorScheme,\n        setColorScheme,\n        clearColorScheme,\n        getRootElement,\n        classNamesPrefix,\n        getStyleNonce,\n        cssVariablesResolver,\n        cssVariablesSelector,\n        withStaticClasses,\n        stylesTransform\n      },\n      children: /* @__PURE__ */ jsxs(MantineThemeProvider, { theme, children: [\n        withCssVariables && /* @__PURE__ */ jsx(\n          MantineCssVariables,\n          {\n            cssVariablesSelector,\n            deduplicateCssVariables\n          }\n        ),\n        withGlobalClasses && /* @__PURE__ */ jsx(MantineClasses, {}),\n        children\n      ] })\n    }\n  );\n}\nMantineProvider.displayName = \"@mantine/core/MantineProvider\";\nfunction HeadlessMantineProvider({ children, theme }) {\n  return /* @__PURE__ */ jsx(\n    MantineContext.Provider,\n    {\n      value: {\n        colorScheme: \"auto\",\n        setColorScheme: () => {\n        },\n        clearColorScheme: () => {\n        },\n        getRootElement: () => document.documentElement,\n        classNamesPrefix: \"mantine\",\n        cssVariablesSelector: \":root\",\n        withStaticClasses: false,\n        headless: true\n      },\n      children: /* @__PURE__ */ jsx(MantineThemeProvider, { theme, children })\n    }\n  );\n}\nHeadlessMantineProvider.displayName = \"@mantine/core/HeadlessMantineProvider\";\n\nexport { HeadlessMantineProvider, MantineProvider };\n//# sourceMappingURL=MantineProvider.mjs.map\n","'use client';\nimport cx from 'clsx';\n\nconst FOCUS_CLASS_NAMES = {\n  always: \"mantine-focus-always\",\n  auto: \"mantine-focus-auto\",\n  never: \"mantine-focus-never\"\n};\nfunction getGlobalClassNames({ theme, options, unstyled }) {\n  return cx(\n    options?.focusable && !unstyled && (theme.focusClassName || FOCUS_CLASS_NAMES[theme.focusRing]),\n    options?.active && !unstyled && theme.activeClassName\n  );\n}\n\nexport { FOCUS_CLASS_NAMES, getGlobalClassNames };\n//# sourceMappingURL=get-global-class-names.mjs.map\n","'use client';\nimport { resolveClassNames } from '../resolve-class-names/resolve-class-names.mjs';\n\nfunction getOptionsClassNames({\n  selector,\n  stylesCtx,\n  options,\n  props,\n  theme\n}) {\n  return resolveClassNames({\n    theme,\n    classNames: options?.classNames,\n    props: options?.props || props,\n    stylesCtx\n  })[selector];\n}\n\nexport { getOptionsClassNames };\n//# sourceMappingURL=get-options-class-names.mjs.map\n","'use client';\nimport { resolveClassNames } from '../resolve-class-names/resolve-class-names.mjs';\n\nfunction getResolvedClassNames({\n  selector,\n  stylesCtx,\n  theme,\n  classNames,\n  props\n}) {\n  return resolveClassNames({ theme, classNames, props, stylesCtx })[selector];\n}\n\nexport { getResolvedClassNames };\n//# sourceMappingURL=get-resolved-class-names.mjs.map\n","'use client';\nfunction getRootClassName({ rootSelector, selector, className }) {\n  return rootSelector === selector ? className : void 0;\n}\n\nexport { getRootClassName };\n//# sourceMappingURL=get-root-class-name.mjs.map\n","'use client';\nfunction getSelectorClassName({ selector, classes, unstyled }) {\n  return unstyled ? void 0 : classes[selector];\n}\n\nexport { getSelectorClassName };\n//# sourceMappingURL=get-selector-class-name.mjs.map\n","'use client';\nfunction getStaticClassNames({\n  themeName,\n  classNamesPrefix,\n  selector,\n  withStaticClass\n}) {\n  if (withStaticClass === false) {\n    return [];\n  }\n  return themeName.map((n) => `${classNamesPrefix}-${n}-${selector}`);\n}\n\nexport { getStaticClassNames };\n//# sourceMappingURL=get-static-class-names.mjs.map\n","'use client';\nimport { resolveClassNames } from '../resolve-class-names/resolve-class-names.mjs';\n\nfunction getThemeClassNames({\n  themeName,\n  theme,\n  selector,\n  props,\n  stylesCtx\n}) {\n  return themeName.map(\n    (n) => resolveClassNames({\n      theme,\n      classNames: theme.components[n]?.classNames,\n      props,\n      stylesCtx\n    })?.[selector]\n  );\n}\n\nexport { getThemeClassNames };\n//# sourceMappingURL=get-theme-class-names.mjs.map\n","'use client';\nfunction getVariantClassName({\n  options,\n  classes,\n  selector,\n  unstyled\n}) {\n  return options?.variant && !unstyled ? classes[`${selector}--${options.variant}`] : void 0;\n}\n\nexport { getVariantClassName };\n//# sourceMappingURL=get-variant-class-name.mjs.map\n","'use client';\nimport cx from 'clsx';\nimport { getGlobalClassNames } from './get-global-class-names/get-global-class-names.mjs';\nimport { getOptionsClassNames } from './get-options-class-names/get-options-class-names.mjs';\nimport { getResolvedClassNames } from './get-resolved-class-names/get-resolved-class-names.mjs';\nimport { getRootClassName } from './get-root-class-name/get-root-class-name.mjs';\nimport { getSelectorClassName } from './get-selector-class-name/get-selector-class-name.mjs';\nimport { getStaticClassNames } from './get-static-class-names/get-static-class-names.mjs';\nimport { getThemeClassNames } from './get-theme-class-names/get-theme-class-names.mjs';\nimport { getVariantClassName } from './get-variant-class-name/get-variant-class-name.mjs';\n\nfunction getClassName({\n  theme,\n  options,\n  themeName,\n  selector,\n  classNamesPrefix,\n  classNames,\n  classes,\n  unstyled,\n  className,\n  rootSelector,\n  props,\n  stylesCtx,\n  withStaticClasses,\n  headless,\n  transformedStyles\n}) {\n  return cx(\n    getGlobalClassNames({ theme, options, unstyled: unstyled || headless }),\n    getThemeClassNames({ theme, themeName, selector, props, stylesCtx }),\n    getVariantClassName({ options, classes, selector, unstyled }),\n    getResolvedClassNames({ selector, stylesCtx, theme, classNames, props }),\n    getResolvedClassNames({ selector, stylesCtx, theme, classNames: transformedStyles, props }),\n    getOptionsClassNames({ selector, stylesCtx, options, props, theme }),\n    getRootClassName({ rootSelector, selector, className }),\n    getSelectorClassName({ selector, classes, unstyled: unstyled || headless }),\n    withStaticClasses && !headless && getStaticClassNames({\n      themeName,\n      classNamesPrefix,\n      selector,\n      withStaticClass: options?.withStaticClass\n    }),\n    options?.className\n  );\n}\n\nexport { getClassName };\n//# sourceMappingURL=get-class-name.mjs.map\n","'use client';\nimport { resolveStyles } from '../resolve-styles/resolve-styles.mjs';\n\nfunction getThemeStyles({\n  theme,\n  themeName,\n  props,\n  stylesCtx,\n  selector\n}) {\n  return themeName.map(\n    (n) => resolveStyles({\n      theme,\n      styles: theme.components[n]?.styles,\n      props,\n      stylesCtx\n    })[selector]\n  ).reduce((acc, val) => ({ ...acc, ...val }), {});\n}\n\nexport { getThemeStyles };\n//# sourceMappingURL=get-theme-styles.mjs.map\n","'use client';\nfunction resolveStyle({ style, theme }) {\n  if (Array.isArray(style)) {\n    return [...style].reduce(\n      (acc, item) => ({ ...acc, ...resolveStyle({ style: item, theme }) }),\n      {}\n    );\n  }\n  if (typeof style === \"function\") {\n    return style(theme);\n  }\n  if (style == null) {\n    return {};\n  }\n  return style;\n}\n\nexport { resolveStyle };\n//# sourceMappingURL=resolve-style.mjs.map\n","'use client';\nimport { filterProps } from '../../../../utils/filter-props/filter-props.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\n\nfunction mergeVars(vars) {\n  return vars.reduce((acc, current) => {\n    if (current) {\n      Object.keys(current).forEach((key) => {\n        acc[key] = { ...acc[key], ...filterProps(current[key]) };\n      });\n    }\n    return acc;\n  }, {});\n}\n\nexport { mergeVars };\n//# sourceMappingURL=merge-vars.mjs.map\n","'use client';\nimport { mergeVars } from './merge-vars.mjs';\n\nfunction resolveVars({\n  vars,\n  varsResolver,\n  theme,\n  props,\n  stylesCtx,\n  selector,\n  themeName,\n  headless\n}) {\n  return mergeVars([\n    headless ? {} : varsResolver?.(theme, props, stylesCtx),\n    ...themeName.map((name) => theme.components?.[name]?.vars?.(theme, props, stylesCtx)),\n    vars?.(theme, props, stylesCtx)\n  ])?.[selector];\n}\n\nexport { resolveVars };\n//# sourceMappingURL=resolve-vars.mjs.map\n","'use client';\nimport { getThemeStyles } from './get-theme-styles/get-theme-styles.mjs';\nimport { resolveStyle } from './resolve-style/resolve-style.mjs';\nimport { resolveStyles } from './resolve-styles/resolve-styles.mjs';\nimport { resolveVars } from './resolve-vars/resolve-vars.mjs';\n\nfunction getStyle({\n  theme,\n  themeName,\n  selector,\n  options,\n  props,\n  stylesCtx,\n  rootSelector,\n  styles,\n  style,\n  vars,\n  varsResolver,\n  headless,\n  withStylesTransform\n}) {\n  return {\n    ...!withStylesTransform && getThemeStyles({ theme, themeName, props, stylesCtx, selector }),\n    ...!withStylesTransform && resolveStyles({ theme, styles, props, stylesCtx })[selector],\n    ...!withStylesTransform && resolveStyles({ theme, styles: options?.styles, props: options?.props || props, stylesCtx })[selector],\n    ...resolveVars({ theme, props, stylesCtx, vars, varsResolver, selector, themeName, headless }),\n    ...rootSelector === selector ? resolveStyle({ style, theme }) : null,\n    ...resolveStyle({ style: options?.style, theme })\n  };\n}\n\nexport { getStyle };\n//# sourceMappingURL=get-style.mjs.map\n","'use client';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { useMantineStylesTransform } from '../../MantineProvider/Mantine.context.mjs';\nimport '../../MantineProvider/default-theme.mjs';\nimport '../../MantineProvider/MantineProvider.mjs';\nimport { useMantineTheme } from '../../MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../../MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\n\nfunction useStylesTransform({ props, stylesCtx, themeName }) {\n  const theme = useMantineTheme();\n  const stylesTransform = useMantineStylesTransform();\n  const getTransformedStyles = (styles) => {\n    if (!stylesTransform) {\n      return [];\n    }\n    const transformedStyles = styles.map(\n      (style) => stylesTransform(style, { props, theme, ctx: stylesCtx })\n    );\n    return [\n      ...transformedStyles,\n      ...themeName.map(\n        (n) => stylesTransform(theme.components[n]?.styles, { props, theme, ctx: stylesCtx })\n      )\n    ].filter(Boolean);\n  };\n  return {\n    getTransformedStyles,\n    withStylesTransform: !!stylesTransform\n  };\n}\n\nexport { useStylesTransform };\n//# sourceMappingURL=use-transformed-styles.mjs.map\n","'use client';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { useMantineClassNamesPrefix, useMantineWithStaticClasses, useMantineIsHeadless } from '../../MantineProvider/Mantine.context.mjs';\nimport '../../MantineProvider/default-theme.mjs';\nimport '../../MantineProvider/MantineProvider.mjs';\nimport { useMantineTheme } from '../../MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../../MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { getClassName } from './get-class-name/get-class-name.mjs';\nimport { getStyle } from './get-style/get-style.mjs';\nimport { useStylesTransform } from './use-transformed-styles.mjs';\n\nfunction useStyles({\n  name,\n  classes,\n  props,\n  stylesCtx,\n  className,\n  style,\n  rootSelector = \"root\",\n  unstyled,\n  classNames,\n  styles,\n  vars,\n  varsResolver\n}) {\n  const theme = useMantineTheme();\n  const classNamesPrefix = useMantineClassNamesPrefix();\n  const withStaticClasses = useMantineWithStaticClasses();\n  const headless = useMantineIsHeadless();\n  const themeName = (Array.isArray(name) ? name : [name]).filter((n) => n);\n  const { withStylesTransform, getTransformedStyles } = useStylesTransform({\n    props,\n    stylesCtx,\n    themeName\n  });\n  return (selector, options) => ({\n    className: getClassName({\n      theme,\n      options,\n      themeName,\n      selector,\n      classNamesPrefix,\n      classNames,\n      classes,\n      unstyled,\n      className,\n      rootSelector,\n      props,\n      stylesCtx,\n      withStaticClasses,\n      headless,\n      transformedStyles: getTransformedStyles([options?.styles, styles])\n    }),\n    style: getStyle({\n      theme,\n      themeName,\n      selector,\n      options,\n      props,\n      stylesCtx,\n      rootSelector,\n      styles,\n      style,\n      vars,\n      varsResolver,\n      headless,\n      withStylesTransform\n    })\n  });\n}\n\nexport { useStyles };\n//# sourceMappingURL=use-styles.mjs.map\n","'use client';\nimport { filterProps } from '../../utils/filter-props/filter-props.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { useMantineTheme } from '../MantineThemeProvider/MantineThemeProvider.mjs';\n\nfunction useProps(component, defaultProps, props) {\n  const theme = useMantineTheme();\n  const contextPropsPayload = theme.components[component]?.defaultProps;\n  const contextProps = typeof contextPropsPayload === \"function\" ? contextPropsPayload(theme) : contextPropsPayload;\n  return { ...defaultProps, ...contextProps, ...filterProps(props) };\n}\n\nexport { useProps };\n//# sourceMappingURL=use-props.mjs.map\n","'use client';\nimport { keys } from '../../utils/keys/keys.mjs';\nimport { camelToKebabCase } from '../../utils/camel-to-kebab-case/camel-to-kebab-case.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\n\nfunction cssObjectToString(css) {\n  return keys(css).reduce(\n    (acc, rule) => css[rule] !== void 0 ? `${acc}${camelToKebabCase(rule)}:${css[rule]};` : acc,\n    \"\"\n  ).trim();\n}\n\nexport { cssObjectToString };\n//# sourceMappingURL=css-object-to-string.mjs.map\n","'use client';\nimport { cssObjectToString } from '../css-object-to-string/css-object-to-string.mjs';\n\nfunction stylesToString({ selector, styles, media }) {\n  const baseStyles = styles ? cssObjectToString(styles) : \"\";\n  const mediaQueryStyles = !Array.isArray(media) ? [] : media.map((item) => `@media${item.query}{${selector}{${cssObjectToString(item.styles)}}}`);\n  return `${baseStyles ? `${selector}{${baseStyles}}` : \"\"}${mediaQueryStyles.join(\"\")}`.trim();\n}\n\nexport { stylesToString };\n//# sourceMappingURL=styles-to-string.mjs.map\n","'use client';\nimport { jsx } from 'react/jsx-runtime';\nimport 'react';\nimport '@mantine/hooks';\nimport { useMantineStyleNonce } from '../MantineProvider/Mantine.context.mjs';\nimport '../MantineProvider/default-theme.mjs';\nimport '../MantineProvider/MantineProvider.mjs';\nimport '../MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { stylesToString } from './styles-to-string/styles-to-string.mjs';\n\nfunction InlineStyles({ selector, styles, media }) {\n  const nonce = useMantineStyleNonce();\n  return /* @__PURE__ */ jsx(\n    \"style\",\n    {\n      \"data-mantine-styles\": \"inline\",\n      nonce: nonce?.(),\n      dangerouslySetInnerHTML: { __html: stylesToString({ selector, styles, media }) }\n    }\n  );\n}\n\nexport { InlineStyles };\n//# sourceMappingURL=InlineStyles.mjs.map\n","'use client';\nimport { filterProps } from '../../../utils/filter-props/filter-props.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\n\nfunction extractStyleProps(others) {\n  const {\n    m,\n    mx,\n    my,\n    mt,\n    mb,\n    ml,\n    mr,\n    me,\n    ms,\n    p,\n    px,\n    py,\n    pt,\n    pb,\n    pl,\n    pr,\n    pe,\n    ps,\n    bg,\n    c,\n    opacity,\n    ff,\n    fz,\n    fw,\n    lts,\n    ta,\n    lh,\n    fs,\n    tt,\n    td,\n    w,\n    miw,\n    maw,\n    h,\n    mih,\n    mah,\n    bgsz,\n    bgp,\n    bgr,\n    bga,\n    pos,\n    top,\n    left,\n    bottom,\n    right,\n    inset,\n    display,\n    flex,\n    hiddenFrom,\n    visibleFrom,\n    lightHidden,\n    darkHidden,\n    sx,\n    ...rest\n  } = others;\n  const styleProps = filterProps({\n    m,\n    mx,\n    my,\n    mt,\n    mb,\n    ml,\n    mr,\n    me,\n    ms,\n    p,\n    px,\n    py,\n    pt,\n    pb,\n    pl,\n    pr,\n    pe,\n    ps,\n    bg,\n    c,\n    opacity,\n    ff,\n    fz,\n    fw,\n    lts,\n    ta,\n    lh,\n    fs,\n    tt,\n    td,\n    w,\n    miw,\n    maw,\n    h,\n    mih,\n    mah,\n    bgsz,\n    bgp,\n    bgr,\n    bga,\n    pos,\n    top,\n    left,\n    bottom,\n    right,\n    inset,\n    display,\n    flex,\n    hiddenFrom,\n    visibleFrom,\n    lightHidden,\n    darkHidden,\n    sx\n  });\n  return { styleProps, rest };\n}\n\nexport { extractStyleProps };\n//# sourceMappingURL=extract-style-props.mjs.map\n","'use client';\nconst STYlE_PROPS_DATA = {\n  m: { type: \"spacing\", property: \"margin\" },\n  mt: { type: \"spacing\", property: \"marginTop\" },\n  mb: { type: \"spacing\", property: \"marginBottom\" },\n  ml: { type: \"spacing\", property: \"marginLeft\" },\n  mr: { type: \"spacing\", property: \"marginRight\" },\n  ms: { type: \"spacing\", property: \"marginInlineStart\" },\n  me: { type: \"spacing\", property: \"marginInlineEnd\" },\n  mx: { type: \"spacing\", property: \"marginInline\" },\n  my: { type: \"spacing\", property: \"marginBlock\" },\n  p: { type: \"spacing\", property: \"padding\" },\n  pt: { type: \"spacing\", property: \"paddingTop\" },\n  pb: { type: \"spacing\", property: \"paddingBottom\" },\n  pl: { type: \"spacing\", property: \"paddingLeft\" },\n  pr: { type: \"spacing\", property: \"paddingRight\" },\n  ps: { type: \"spacing\", property: \"paddingInlineStart\" },\n  pe: { type: \"spacing\", property: \"paddingInlineEnd\" },\n  px: { type: \"spacing\", property: \"paddingInline\" },\n  py: { type: \"spacing\", property: \"paddingBlock\" },\n  bg: { type: \"color\", property: \"background\" },\n  c: { type: \"textColor\", property: \"color\" },\n  opacity: { type: \"identity\", property: \"opacity\" },\n  ff: { type: \"fontFamily\", property: \"fontFamily\" },\n  fz: { type: \"fontSize\", property: \"fontSize\" },\n  fw: { type: \"identity\", property: \"fontWeight\" },\n  lts: { type: \"size\", property: \"letterSpacing\" },\n  ta: { type: \"identity\", property: \"textAlign\" },\n  lh: { type: \"lineHeight\", property: \"lineHeight\" },\n  fs: { type: \"identity\", property: \"fontStyle\" },\n  tt: { type: \"identity\", property: \"textTransform\" },\n  td: { type: \"identity\", property: \"textDecoration\" },\n  w: { type: \"spacing\", property: \"width\" },\n  miw: { type: \"spacing\", property: \"minWidth\" },\n  maw: { type: \"spacing\", property: \"maxWidth\" },\n  h: { type: \"spacing\", property: \"height\" },\n  mih: { type: \"spacing\", property: \"minHeight\" },\n  mah: { type: \"spacing\", property: \"maxHeight\" },\n  bgsz: { type: \"size\", property: \"backgroundSize\" },\n  bgp: { type: \"identity\", property: \"backgroundPosition\" },\n  bgr: { type: \"identity\", property: \"backgroundRepeat\" },\n  bga: { type: \"identity\", property: \"backgroundAttachment\" },\n  pos: { type: \"identity\", property: \"position\" },\n  top: { type: \"identity\", property: \"top\" },\n  left: { type: \"size\", property: \"left\" },\n  bottom: { type: \"size\", property: \"bottom\" },\n  right: { type: \"size\", property: \"right\" },\n  inset: { type: \"size\", property: \"inset\" },\n  display: { type: \"identity\", property: \"display\" },\n  flex: { type: \"identity\", property: \"flex\" }\n};\n\nexport { STYlE_PROPS_DATA };\n//# sourceMappingURL=style-props-data.mjs.map\n","'use client';\nimport { parseThemeColor } from '../../../../MantineProvider/color-functions/parse-theme-color/parse-theme-color.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport '../../../../MantineProvider/Mantine.context.mjs';\nimport '../../../../MantineProvider/default-theme.mjs';\nimport '../../../../MantineProvider/MantineProvider.mjs';\nimport '../../../../MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../../../../MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\n\nfunction colorResolver(color, theme) {\n  const parsedColor = parseThemeColor({ color, theme });\n  if (parsedColor.color === \"dimmed\") {\n    return \"var(--mantine-color-dimmed)\";\n  }\n  if (parsedColor.color === \"bright\") {\n    return \"var(--mantine-color-bright)\";\n  }\n  return parsedColor.variable ? `var(${parsedColor.variable})` : parsedColor.color;\n}\nfunction textColorResolver(color, theme) {\n  const parsedColor = parseThemeColor({ color, theme });\n  if (parsedColor.isThemeColor && parsedColor.shade === void 0) {\n    return `var(--mantine-color-${parsedColor.color}-text)`;\n  }\n  return colorResolver(color, theme);\n}\n\nexport { colorResolver, textColorResolver };\n//# sourceMappingURL=color-resolver.mjs.map\n","'use client';\nconst values = {\n  text: \"var(--mantine-font-family)\",\n  mono: \"var(--mantine-font-family-monospace)\",\n  monospace: \"var(--mantine-font-family-monospace)\",\n  heading: \"var(--mantine-font-family-headings)\",\n  headings: \"var(--mantine-font-family-headings)\"\n};\nfunction fontFamilyResolver(fontFamily) {\n  if (typeof fontFamily === \"string\" && fontFamily in values) {\n    return values[fontFamily];\n  }\n  return fontFamily;\n}\n\nexport { fontFamilyResolver };\n//# sourceMappingURL=font-family-resolver.mjs.map\n","'use client';\nimport { rem } from '../../../../utils/units-converters/rem.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\n\nconst headings = [\"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"];\nfunction fontSizeResolver(value, theme) {\n  if (typeof value === \"string\" && value in theme.fontSizes) {\n    return `var(--mantine-font-size-${value})`;\n  }\n  if (typeof value === \"string\" && headings.includes(value)) {\n    return `var(--mantine-${value}-font-size)`;\n  }\n  if (typeof value === \"number\") {\n    return rem(value);\n  }\n  if (typeof value === \"string\") {\n    return rem(value);\n  }\n  return value;\n}\n\nexport { fontSizeResolver };\n//# sourceMappingURL=font-size-resolver.mjs.map\n","'use client';\nfunction identityResolver(value) {\n  return value;\n}\n\nexport { identityResolver };\n//# sourceMappingURL=identity-resolver.mjs.map\n","'use client';\nconst headings = [\"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"];\nfunction lineHeightResolver(value, theme) {\n  if (typeof value === \"string\" && value in theme.lineHeights) {\n    return `var(--mantine-line-height-${value})`;\n  }\n  if (typeof value === \"string\" && headings.includes(value)) {\n    return `var(--mantine-${value}-line-height)`;\n  }\n  return value;\n}\n\nexport { lineHeightResolver };\n//# sourceMappingURL=line-height-resolver.mjs.map\n","'use client';\nimport { rem } from '../../../../utils/units-converters/rem.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\n\nfunction sizeResolver(value) {\n  if (typeof value === \"number\") {\n    return rem(value);\n  }\n  return value;\n}\n\nexport { sizeResolver };\n//# sourceMappingURL=size-resolver.mjs.map\n","'use client';\nimport { rem } from '../../../../utils/units-converters/rem.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\n\nfunction spacingResolver(value, theme) {\n  if (typeof value === \"number\") {\n    return rem(value);\n  }\n  if (typeof value === \"string\") {\n    const mod = value.replace(\"-\", \"\");\n    if (!(mod in theme.spacing)) {\n      return rem(value);\n    }\n    const variable = `--mantine-spacing-${mod}`;\n    return value.startsWith(\"-\") ? `calc(var(${variable}) * -1)` : `var(${variable})`;\n  }\n  return value;\n}\n\nexport { spacingResolver };\n//# sourceMappingURL=spacing-resolver.mjs.map\n","'use client';\nimport { colorResolver, textColorResolver } from './color-resolver/color-resolver.mjs';\nimport { fontFamilyResolver } from './font-family-resolver/font-family-resolver.mjs';\nimport { fontSizeResolver } from './font-size-resolver/font-size-resolver.mjs';\nimport { identityResolver } from './identity-resolver/identity-resolver.mjs';\nimport { lineHeightResolver } from './line-height-resolver/line-height-resolver.mjs';\nimport { sizeResolver } from './size-resolver/size-resolver.mjs';\nimport { spacingResolver } from './spacing-resolver/spacing-resolver.mjs';\n\nconst resolvers = {\n  color: colorResolver,\n  textColor: textColorResolver,\n  fontSize: fontSizeResolver,\n  spacing: spacingResolver,\n  identity: identityResolver,\n  size: sizeResolver,\n  lineHeight: lineHeightResolver,\n  fontFamily: fontFamilyResolver\n};\n\nexport { resolvers };\n//# sourceMappingURL=index.mjs.map\n","'use client';\nfunction replaceMediaQuery(query) {\n  return query.replace(\"(min-width: \", \"\").replace(\"em)\", \"\");\n}\nfunction sortMediaQueries({\n  media,\n  ...props\n}) {\n  const breakpoints = Object.keys(media);\n  const sortedMedia = breakpoints.sort((a, b) => Number(replaceMediaQuery(a)) - Number(replaceMediaQuery(b))).map((query) => ({ query, styles: media[query] }));\n  return { ...props, media: sortedMedia };\n}\n\nexport { sortMediaQueries };\n//# sourceMappingURL=sort-media-queries.mjs.map\n","'use client';\nimport { keys } from '../../../utils/keys/keys.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport { resolvers } from '../resolvers/index.mjs';\nimport { sortMediaQueries } from './sort-media-queries.mjs';\n\nfunction hasResponsiveStyles(styleProp) {\n  if (typeof styleProp !== \"object\" || styleProp === null) {\n    return false;\n  }\n  const breakpoints = Object.keys(styleProp);\n  if (breakpoints.length === 1 && breakpoints[0] === \"base\") {\n    return false;\n  }\n  return true;\n}\nfunction getBaseValue(value) {\n  if (typeof value === \"object\" && value !== null) {\n    if (\"base\" in value) {\n      return value.base;\n    }\n    return void 0;\n  }\n  return value;\n}\nfunction getBreakpointKeys(value) {\n  if (typeof value === \"object\" && value !== null) {\n    return keys(value).filter((key) => key !== \"base\");\n  }\n  return [];\n}\nfunction getBreakpointValue(value, breakpoint) {\n  if (typeof value === \"object\" && value !== null && breakpoint in value) {\n    return value[breakpoint];\n  }\n  return value;\n}\nfunction parseStyleProps({\n  styleProps,\n  data,\n  theme\n}) {\n  return sortMediaQueries(\n    keys(styleProps).reduce(\n      (acc, styleProp) => {\n        if (styleProp === \"hiddenFrom\" || styleProp === \"visibleFrom\" || styleProp === \"sx\") {\n          return acc;\n        }\n        const propertyData = data[styleProp];\n        const properties = Array.isArray(propertyData.property) ? propertyData.property : [propertyData.property];\n        const baseValue = getBaseValue(styleProps[styleProp]);\n        if (!hasResponsiveStyles(styleProps[styleProp])) {\n          properties.forEach((property) => {\n            acc.inlineStyles[property] = resolvers[propertyData.type](baseValue, theme);\n          });\n          return acc;\n        }\n        acc.hasResponsiveStyles = true;\n        const breakpoints = getBreakpointKeys(styleProps[styleProp]);\n        properties.forEach((property) => {\n          if (baseValue) {\n            acc.styles[property] = resolvers[propertyData.type](baseValue, theme);\n          }\n          breakpoints.forEach((breakpoint) => {\n            const bp = `(min-width: ${theme.breakpoints[breakpoint]})`;\n            acc.media[bp] = {\n              ...acc.media[bp],\n              [property]: resolvers[propertyData.type](\n                getBreakpointValue(styleProps[styleProp], breakpoint),\n                theme\n              )\n            };\n          });\n        });\n        return acc;\n      },\n      {\n        hasResponsiveStyles: false,\n        styles: {},\n        inlineStyles: {},\n        media: {}\n      }\n    )\n  );\n}\n\nexport { parseStyleProps };\n//# sourceMappingURL=parse-style-props.mjs.map\n","'use client';\nimport { useId } from 'react';\n\nfunction useRandomClassName() {\n  const id = useId().replace(/:/g, \"\");\n  return `__m__-${id}`;\n}\n\nexport { useRandomClassName };\n//# sourceMappingURL=use-random-classname.mjs.map\n","'use client';\nfunction transformModKey(key) {\n  return key.startsWith(\"data-\") ? key : `data-${key}`;\n}\nfunction getMod(props) {\n  return Object.keys(props).reduce((acc, key) => {\n    const value = props[key];\n    if (value === void 0 || value === \"\" || value === false || value === null) {\n      return acc;\n    }\n    acc[transformModKey(key)] = props[key];\n    return acc;\n  }, {});\n}\nfunction getBoxMod(mod) {\n  if (!mod) {\n    return null;\n  }\n  if (typeof mod === \"string\") {\n    return { [transformModKey(mod)]: true };\n  }\n  if (Array.isArray(mod)) {\n    return [...mod].reduce(\n      (acc, value) => ({ ...acc, ...getBoxMod(value) }),\n      {}\n    );\n  }\n  return getMod(mod);\n}\n\nexport { getBoxMod, getMod };\n//# sourceMappingURL=get-box-mod.mjs.map\n","'use client';\nfunction mergeStyles(styles, theme) {\n  if (Array.isArray(styles)) {\n    return [...styles].reduce(\n      (acc, item) => ({ ...acc, ...mergeStyles(item, theme) }),\n      {}\n    );\n  }\n  if (typeof styles === \"function\") {\n    return styles(theme);\n  }\n  if (styles == null) {\n    return {};\n  }\n  return styles;\n}\nfunction getBoxStyle({\n  theme,\n  style,\n  vars,\n  styleProps\n}) {\n  const _style = mergeStyles(style, theme);\n  const _vars = mergeStyles(vars, theme);\n  return { ..._style, ..._vars, ...styleProps };\n}\n\nexport { getBoxStyle };\n//# sourceMappingURL=get-box-style.mjs.map\n","'use client';\nimport { jsxs, Fragment, jsx } from 'react/jsx-runtime';\nimport { forwardRef } from 'react';\nimport cx from 'clsx';\nimport { createPolymorphicComponent } from '../factory/create-polymorphic-component.mjs';\nimport { InlineStyles } from '../InlineStyles/InlineStyles.mjs';\nimport { isNumberLike } from '../utils/is-number-like/is-number-like.mjs';\nimport '@mantine/hooks';\nimport { useMantineSxTransform } from '../MantineProvider/Mantine.context.mjs';\nimport '../MantineProvider/default-theme.mjs';\nimport '../MantineProvider/MantineProvider.mjs';\nimport { useMantineTheme } from '../MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { getBoxMod } from './get-box-mod/get-box-mod.mjs';\nimport { getBoxStyle } from './get-box-style/get-box-style.mjs';\nimport { extractStyleProps } from './style-props/extract-style-props/extract-style-props.mjs';\nimport { STYlE_PROPS_DATA } from './style-props/style-props-data.mjs';\nimport { parseStyleProps } from './style-props/parse-style-props/parse-style-props.mjs';\nimport { useRandomClassName } from './use-random-classname/use-random-classname.mjs';\n\nconst _Box = forwardRef(\n  ({\n    component,\n    style,\n    __vars,\n    className,\n    variant,\n    mod,\n    size,\n    hiddenFrom,\n    visibleFrom,\n    lightHidden,\n    darkHidden,\n    renderRoot,\n    ...others\n  }, ref) => {\n    const theme = useMantineTheme();\n    const Element = component || \"div\";\n    const { styleProps, rest } = extractStyleProps(others);\n    const useSxTransform = useMantineSxTransform();\n    const transformedSx = useSxTransform?.(styleProps.sx);\n    const responsiveClassName = useRandomClassName();\n    const parsedStyleProps = parseStyleProps({\n      styleProps,\n      theme,\n      data: STYlE_PROPS_DATA\n    });\n    const props = {\n      ref,\n      style: getBoxStyle({\n        theme,\n        style,\n        vars: __vars,\n        styleProps: parsedStyleProps.inlineStyles\n      }),\n      className: cx(className, transformedSx, {\n        [responsiveClassName]: parsedStyleProps.hasResponsiveStyles,\n        \"mantine-light-hidden\": lightHidden,\n        \"mantine-dark-hidden\": darkHidden,\n        [`mantine-hidden-from-${hiddenFrom}`]: hiddenFrom,\n        [`mantine-visible-from-${visibleFrom}`]: visibleFrom\n      }),\n      \"data-variant\": variant,\n      \"data-size\": isNumberLike(size) ? void 0 : size || void 0,\n      ...getBoxMod(mod),\n      ...rest\n    };\n    return /* @__PURE__ */ jsxs(Fragment, { children: [\n      parsedStyleProps.hasResponsiveStyles && /* @__PURE__ */ jsx(\n        InlineStyles,\n        {\n          selector: `.${responsiveClassName}`,\n          styles: parsedStyleProps.styles,\n          media: parsedStyleProps.media\n        }\n      ),\n      typeof renderRoot === \"function\" ? renderRoot(props) : /* @__PURE__ */ jsx(Element, { ...props })\n    ] });\n  }\n);\n_Box.displayName = \"@mantine/core/Box\";\nconst Box = createPolymorphicComponent(_Box);\n\nexport { Box };\n//# sourceMappingURL=Box.mjs.map\n","'use client';\nimport { forwardRef } from 'react';\n\nfunction identity(value) {\n  return value;\n}\nfunction factory(ui) {\n  const Component = forwardRef(ui);\n  Component.extend = identity;\n  return Component;\n}\n\nexport { factory, identity };\n//# sourceMappingURL=factory.mjs.map\n","'use client';\nimport { forwardRef } from 'react';\nimport { identity } from './factory.mjs';\n\nfunction polymorphicFactory(ui) {\n  const Component = forwardRef(ui);\n  Component.extend = identity;\n  return Component;\n}\n\nexport { polymorphicFactory };\n//# sourceMappingURL=polymorphic-factory.mjs.map\n","'use client';\nvar classes = {\"root\":\"m_87cf2631\"};\n\nexport { classes as default };\n//# sourceMappingURL=UnstyledButton.module.css.mjs.map\n","'use client';\nimport { jsx } from 'react/jsx-runtime';\nimport 'react';\nimport '@mantine/hooks';\nimport 'clsx';\nimport '../../core/MantineProvider/Mantine.context.mjs';\nimport '../../core/MantineProvider/default-theme.mjs';\nimport '../../core/MantineProvider/MantineProvider.mjs';\nimport '../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport { useProps } from '../../core/MantineProvider/use-props/use-props.mjs';\nimport '../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { useStyles } from '../../core/styles-api/use-styles/use-styles.mjs';\nimport { Box } from '../../core/Box/Box.mjs';\nimport { polymorphicFactory } from '../../core/factory/polymorphic-factory.mjs';\nimport '../../core/DirectionProvider/DirectionProvider.mjs';\nimport classes from './UnstyledButton.module.css.mjs';\n\nconst defaultProps = {\n  __staticSelector: \"UnstyledButton\"\n};\nconst UnstyledButton = polymorphicFactory(\n  (_props, ref) => {\n    const props = useProps(\"UnstyledButton\", defaultProps, _props);\n    const {\n      className,\n      component = \"button\",\n      __staticSelector,\n      unstyled,\n      classNames,\n      styles,\n      style,\n      ...others\n    } = props;\n    const getStyles = useStyles({\n      name: __staticSelector,\n      props,\n      classes,\n      className,\n      style,\n      classNames,\n      styles,\n      unstyled\n    });\n    return /* @__PURE__ */ jsx(\n      Box,\n      {\n        ...getStyles(\"root\", { focusable: true }),\n        component,\n        ref,\n        type: component === \"button\" ? \"button\" : void 0,\n        ...others\n      }\n    );\n  }\n);\nUnstyledButton.classes = classes;\nUnstyledButton.displayName = \"@mantine/core/UnstyledButton\";\n\nexport { UnstyledButton };\n//# sourceMappingURL=UnstyledButton.mjs.map\n","'use client';\nimport { rem } from '../../core/utils/units-converters/rem.mjs';\nimport 'react';\nimport 'react/jsx-runtime';\nimport '@mantine/hooks';\nimport 'clsx';\nimport '../../core/MantineProvider/Mantine.context.mjs';\nimport '../../core/MantineProvider/default-theme.mjs';\nimport '../../core/MantineProvider/MantineProvider.mjs';\nimport '../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport '../../core/Box/Box.mjs';\nimport '../../core/DirectionProvider/DirectionProvider.mjs';\n\nconst popIn = (from) => ({\n  in: { opacity: 1, transform: \"scale(1)\" },\n  out: { opacity: 0, transform: `scale(.9) translateY(${rem(from === \"bottom\" ? 10 : -10)})` },\n  transitionProperty: \"transform, opacity\"\n});\nconst transitions = {\n  fade: {\n    in: { opacity: 1 },\n    out: { opacity: 0 },\n    transitionProperty: \"opacity\"\n  },\n  \"fade-up\": {\n    in: { opacity: 1, transform: \"translateY(0)\" },\n    out: { opacity: 0, transform: `translateY(${rem(30)}` },\n    transitionProperty: \"opacity, transform\"\n  },\n  \"fade-down\": {\n    in: { opacity: 1, transform: \"translateY(0)\" },\n    out: { opacity: 0, transform: `translateY(${rem(-30)}` },\n    transitionProperty: \"opacity, transform\"\n  },\n  \"fade-left\": {\n    in: { opacity: 1, transform: \"translateX(0)\" },\n    out: { opacity: 0, transform: `translateX(${rem(30)}` },\n    transitionProperty: \"opacity, transform\"\n  },\n  \"fade-right\": {\n    in: { opacity: 1, transform: \"translateX(0)\" },\n    out: { opacity: 0, transform: `translateX(${rem(-30)}` },\n    transitionProperty: \"opacity, transform\"\n  },\n  scale: {\n    in: { opacity: 1, transform: \"scale(1)\" },\n    out: { opacity: 0, transform: \"scale(0)\" },\n    common: { transformOrigin: \"top\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"scale-y\": {\n    in: { opacity: 1, transform: \"scaleY(1)\" },\n    out: { opacity: 0, transform: \"scaleY(0)\" },\n    common: { transformOrigin: \"top\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"scale-x\": {\n    in: { opacity: 1, transform: \"scaleX(1)\" },\n    out: { opacity: 0, transform: \"scaleX(0)\" },\n    common: { transformOrigin: \"left\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"skew-up\": {\n    in: { opacity: 1, transform: \"translateY(0) skew(0deg, 0deg)\" },\n    out: { opacity: 0, transform: `translateY(${rem(-20)}) skew(-10deg, -5deg)` },\n    common: { transformOrigin: \"top\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"skew-down\": {\n    in: { opacity: 1, transform: \"translateY(0) skew(0deg, 0deg)\" },\n    out: { opacity: 0, transform: `translateY(${rem(20)}) skew(-10deg, -5deg)` },\n    common: { transformOrigin: \"bottom\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"rotate-left\": {\n    in: { opacity: 1, transform: \"translateY(0) rotate(0deg)\" },\n    out: { opacity: 0, transform: `translateY(${rem(20)}) rotate(-5deg)` },\n    common: { transformOrigin: \"bottom\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"rotate-right\": {\n    in: { opacity: 1, transform: \"translateY(0) rotate(0deg)\" },\n    out: { opacity: 0, transform: `translateY(${rem(20)}) rotate(5deg)` },\n    common: { transformOrigin: \"top\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"slide-down\": {\n    in: { opacity: 1, transform: \"translateY(0)\" },\n    out: { opacity: 0, transform: \"translateY(-100%)\" },\n    common: { transformOrigin: \"top\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"slide-up\": {\n    in: { opacity: 1, transform: \"translateY(0)\" },\n    out: { opacity: 0, transform: \"translateY(100%)\" },\n    common: { transformOrigin: \"bottom\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"slide-left\": {\n    in: { opacity: 1, transform: \"translateX(0)\" },\n    out: { opacity: 0, transform: \"translateX(100%)\" },\n    common: { transformOrigin: \"left\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  \"slide-right\": {\n    in: { opacity: 1, transform: \"translateX(0)\" },\n    out: { opacity: 0, transform: \"translateX(-100%)\" },\n    common: { transformOrigin: \"right\" },\n    transitionProperty: \"transform, opacity\"\n  },\n  pop: {\n    ...popIn(\"bottom\"),\n    common: { transformOrigin: \"center center\" }\n  },\n  \"pop-bottom-left\": {\n    ...popIn(\"bottom\"),\n    common: { transformOrigin: \"bottom left\" }\n  },\n  \"pop-bottom-right\": {\n    ...popIn(\"bottom\"),\n    common: { transformOrigin: \"bottom right\" }\n  },\n  \"pop-top-left\": {\n    ...popIn(\"top\"),\n    common: { transformOrigin: \"top left\" }\n  },\n  \"pop-top-right\": {\n    ...popIn(\"top\"),\n    common: { transformOrigin: \"top right\" }\n  }\n};\n\nexport { transitions };\n//# sourceMappingURL=transitions.mjs.map\n","'use client';\nimport { transitions } from '../transitions.mjs';\n\nconst transitionStatuses = {\n  entering: \"in\",\n  entered: \"in\",\n  exiting: \"out\",\n  exited: \"out\",\n  \"pre-exiting\": \"out\",\n  \"pre-entering\": \"out\"\n};\nfunction getTransitionStyles({\n  transition,\n  state,\n  duration,\n  timingFunction\n}) {\n  const shared = {\n    transitionDuration: `${duration}ms`,\n    transitionTimingFunction: timingFunction\n  };\n  if (typeof transition === \"string\") {\n    if (!(transition in transitions)) {\n      return {};\n    }\n    return {\n      transitionProperty: transitions[transition].transitionProperty,\n      ...shared,\n      ...transitions[transition].common,\n      ...transitions[transition][transitionStatuses[state]]\n    };\n  }\n  return {\n    transitionProperty: transition.transitionProperty,\n    ...shared,\n    ...transition.common,\n    ...transition[transitionStatuses[state]]\n  };\n}\n\nexport { getTransitionStyles };\n//# sourceMappingURL=get-transition-styles.mjs.map\n","'use client';\nimport { useState, useRef, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport { useReducedMotion, useDidUpdate } from '@mantine/hooks';\nimport 'react/jsx-runtime';\nimport 'clsx';\nimport '../../core/MantineProvider/Mantine.context.mjs';\nimport '../../core/MantineProvider/default-theme.mjs';\nimport '../../core/MantineProvider/MantineProvider.mjs';\nimport { useMantineTheme } from '../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport '../../core/Box/Box.mjs';\nimport '../../core/DirectionProvider/DirectionProvider.mjs';\n\nfunction useTransition({\n  duration,\n  exitDuration,\n  timingFunction,\n  mounted,\n  onEnter,\n  onExit,\n  onEntered,\n  onExited\n}) {\n  const theme = useMantineTheme();\n  const shouldReduceMotion = useReducedMotion();\n  const reduceMotion = theme.respectReducedMotion ? shouldReduceMotion : false;\n  const [transitionDuration, setTransitionDuration] = useState(reduceMotion ? 0 : duration);\n  const [transitionStatus, setStatus] = useState(mounted ? \"entered\" : \"exited\");\n  const timeoutRef = useRef(-1);\n  const rafRef = useRef(-1);\n  const handleStateChange = (shouldMount) => {\n    const preHandler = shouldMount ? onEnter : onExit;\n    const handler = shouldMount ? onEntered : onExited;\n    window.clearTimeout(timeoutRef.current);\n    const newTransitionDuration = reduceMotion ? 0 : shouldMount ? duration : exitDuration;\n    setTransitionDuration(newTransitionDuration);\n    if (newTransitionDuration === 0) {\n      typeof preHandler === \"function\" && preHandler();\n      typeof handler === \"function\" && handler();\n      setStatus(shouldMount ? \"entered\" : \"exited\");\n    } else {\n      rafRef.current = requestAnimationFrame(() => {\n        ReactDOM.flushSync(() => {\n          setStatus(shouldMount ? \"pre-entering\" : \"pre-exiting\");\n        });\n        rafRef.current = requestAnimationFrame(() => {\n          typeof preHandler === \"function\" && preHandler();\n          setStatus(shouldMount ? \"entering\" : \"exiting\");\n          timeoutRef.current = window.setTimeout(() => {\n            typeof handler === \"function\" && handler();\n            setStatus(shouldMount ? \"entered\" : \"exited\");\n          }, newTransitionDuration);\n        });\n      });\n    }\n  };\n  useDidUpdate(() => {\n    handleStateChange(mounted);\n  }, [mounted]);\n  useEffect(\n    () => () => {\n      window.clearTimeout(timeoutRef.current);\n      cancelAnimationFrame(rafRef.current);\n    },\n    []\n  );\n  return {\n    transitionDuration,\n    transitionStatus,\n    transitionTimingFunction: timingFunction || \"ease\"\n  };\n}\n\nexport { useTransition };\n//# sourceMappingURL=use-transition.mjs.map\n","'use client';\nimport { jsx, Fragment } from 'react/jsx-runtime';\nimport { getTransitionStyles } from './get-transition-styles/get-transition-styles.mjs';\nimport { useTransition } from './use-transition.mjs';\n\nfunction Transition({\n  keepMounted,\n  transition = \"fade\",\n  duration = 250,\n  exitDuration = duration,\n  mounted,\n  children,\n  timingFunction = \"ease\",\n  onExit,\n  onEntered,\n  onEnter,\n  onExited\n}) {\n  const { transitionDuration, transitionStatus, transitionTimingFunction } = useTransition({\n    mounted,\n    exitDuration,\n    duration,\n    timingFunction,\n    onExit,\n    onEntered,\n    onEnter,\n    onExited\n  });\n  if (transitionDuration === 0) {\n    return mounted ? /* @__PURE__ */ jsx(Fragment, { children: children({}) }) : keepMounted ? children({ display: \"none\" }) : null;\n  }\n  return transitionStatus === \"exited\" ? keepMounted ? children({ display: \"none\" }) : null : /* @__PURE__ */ jsx(Fragment, { children: children(\n    getTransitionStyles({\n      transition,\n      duration: transitionDuration,\n      state: transitionStatus,\n      timingFunction: transitionTimingFunction\n    })\n  ) });\n}\nTransition.displayName = \"@mantine/core/Transition\";\n\nexport { Transition };\n//# sourceMappingURL=Transition.mjs.map\n","'use client';\nvar classes = {\"root\":\"m_5ae2e3c\",\"barsLoader\":\"m_7a2bd4cd\",\"bar\":\"m_870bb79\",\"bars-loader-animation\":\"m_5d2b3b9d\",\"dotsLoader\":\"m_4e3f22d7\",\"dot\":\"m_870c4af\",\"loader-dots-animation\":\"m_aac34a1\",\"ovalLoader\":\"m_b34414df\",\"oval-loader-animation\":\"m_f8e89c4b\"};\n\nexport { classes as default };\n//# sourceMappingURL=Loader.module.css.mjs.map\n","'use client';\nimport { jsxs, jsx } from 'react/jsx-runtime';\nimport { forwardRef } from 'react';\nimport cx from 'clsx';\nimport '@mantine/hooks';\nimport '../../../core/MantineProvider/Mantine.context.mjs';\nimport '../../../core/MantineProvider/default-theme.mjs';\nimport '../../../core/MantineProvider/MantineProvider.mjs';\nimport '../../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { Box } from '../../../core/Box/Box.mjs';\nimport '../../../core/DirectionProvider/DirectionProvider.mjs';\nimport classes from '../Loader.module.css.mjs';\n\nconst Bars = forwardRef(({ className, ...others }, ref) => /* @__PURE__ */ jsxs(Box, { component: \"span\", className: cx(classes.barsLoader, className), ...others, ref, children: [\n  /* @__PURE__ */ jsx(\"span\", { className: classes.bar }),\n  /* @__PURE__ */ jsx(\"span\", { className: classes.bar }),\n  /* @__PURE__ */ jsx(\"span\", { className: classes.bar })\n] }));\n\nexport { Bars };\n//# sourceMappingURL=Bars.mjs.map\n","'use client';\nimport { jsxs, jsx } from 'react/jsx-runtime';\nimport { forwardRef } from 'react';\nimport cx from 'clsx';\nimport '@mantine/hooks';\nimport '../../../core/MantineProvider/Mantine.context.mjs';\nimport '../../../core/MantineProvider/default-theme.mjs';\nimport '../../../core/MantineProvider/MantineProvider.mjs';\nimport '../../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { Box } from '../../../core/Box/Box.mjs';\nimport '../../../core/DirectionProvider/DirectionProvider.mjs';\nimport classes from '../Loader.module.css.mjs';\n\nconst Dots = forwardRef(({ className, ...others }, ref) => /* @__PURE__ */ jsxs(Box, { component: \"span\", className: cx(classes.dotsLoader, className), ...others, ref, children: [\n  /* @__PURE__ */ jsx(\"span\", { className: classes.dot }),\n  /* @__PURE__ */ jsx(\"span\", { className: classes.dot }),\n  /* @__PURE__ */ jsx(\"span\", { className: classes.dot })\n] }));\n\nexport { Dots };\n//# sourceMappingURL=Dots.mjs.map\n","'use client';\nimport { jsx } from 'react/jsx-runtime';\nimport { forwardRef } from 'react';\nimport cx from 'clsx';\nimport '@mantine/hooks';\nimport '../../../core/MantineProvider/Mantine.context.mjs';\nimport '../../../core/MantineProvider/default-theme.mjs';\nimport '../../../core/MantineProvider/MantineProvider.mjs';\nimport '../../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport '../../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { Box } from '../../../core/Box/Box.mjs';\nimport '../../../core/DirectionProvider/DirectionProvider.mjs';\nimport classes from '../Loader.module.css.mjs';\n\nconst Oval = forwardRef(({ className, ...others }, ref) => /* @__PURE__ */ jsx(Box, { component: \"span\", className: cx(classes.ovalLoader, className), ...others, ref }));\n\nexport { Oval };\n//# sourceMappingURL=Oval.mjs.map\n","'use client';\nimport { jsx } from 'react/jsx-runtime';\nimport 'react';\nimport { getSize } from '../../core/utils/get-size/get-size.mjs';\nimport '@mantine/hooks';\nimport { createVarsResolver } from '../../core/styles-api/create-vars-resolver/create-vars-resolver.mjs';\nimport 'clsx';\nimport { getThemeColor } from '../../core/MantineProvider/color-functions/get-theme-color/get-theme-color.mjs';\nimport '../../core/MantineProvider/Mantine.context.mjs';\nimport '../../core/MantineProvider/default-theme.mjs';\nimport '../../core/MantineProvider/MantineProvider.mjs';\nimport '../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport { useProps } from '../../core/MantineProvider/use-props/use-props.mjs';\nimport '../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { useStyles } from '../../core/styles-api/use-styles/use-styles.mjs';\nimport { Box } from '../../core/Box/Box.mjs';\nimport { factory } from '../../core/factory/factory.mjs';\nimport '../../core/DirectionProvider/DirectionProvider.mjs';\nimport { Bars } from './loaders/Bars.mjs';\nimport { Dots } from './loaders/Dots.mjs';\nimport { Oval } from './loaders/Oval.mjs';\nimport classes from './Loader.module.css.mjs';\n\nconst defaultLoaders = {\n  bars: Bars,\n  oval: Oval,\n  dots: Dots\n};\nconst defaultProps = {\n  loaders: defaultLoaders,\n  type: \"oval\"\n};\nconst varsResolver = createVarsResolver((theme, { size, color }) => ({\n  root: {\n    \"--loader-size\": getSize(size, \"loader-size\"),\n    \"--loader-color\": color ? getThemeColor(color, theme) : void 0\n  }\n}));\nconst Loader = factory((_props, ref) => {\n  const props = useProps(\"Loader\", defaultProps, _props);\n  const {\n    size,\n    color,\n    type,\n    vars,\n    className,\n    style,\n    classNames,\n    styles,\n    unstyled,\n    loaders,\n    variant,\n    children,\n    ...others\n  } = props;\n  const getStyles = useStyles({\n    name: \"Loader\",\n    props,\n    classes,\n    className,\n    style,\n    classNames,\n    styles,\n    unstyled,\n    vars,\n    varsResolver\n  });\n  if (children) {\n    return /* @__PURE__ */ jsx(Box, { ...getStyles(\"root\"), ref, ...others, children });\n  }\n  return /* @__PURE__ */ jsx(\n    Box,\n    {\n      ...getStyles(\"root\"),\n      ref,\n      component: loaders[type],\n      variant,\n      size,\n      ...others\n    }\n  );\n});\nLoader.defaultLoaders = defaultLoaders;\nLoader.classes = classes;\nLoader.displayName = \"@mantine/core/Loader\";\n\nexport { Loader, defaultLoaders };\n//# sourceMappingURL=Loader.mjs.map\n","'use client';\nvar classes = {\"root\":\"m_77c9d27d\",\"inner\":\"m_80f1301b\",\"label\":\"m_811560b9\",\"section\":\"m_a74036a\",\"loader\":\"m_a25b86ee\",\"group\":\"m_80d6d844\"};\n\nexport { classes as default };\n//# sourceMappingURL=Button.module.css.mjs.map\n","'use client';\nimport { jsx } from 'react/jsx-runtime';\nimport { rem } from '../../../core/utils/units-converters/rem.mjs';\nimport 'react';\nimport '@mantine/hooks';\nimport { createVarsResolver } from '../../../core/styles-api/create-vars-resolver/create-vars-resolver.mjs';\nimport 'clsx';\nimport '../../../core/MantineProvider/Mantine.context.mjs';\nimport '../../../core/MantineProvider/default-theme.mjs';\nimport '../../../core/MantineProvider/MantineProvider.mjs';\nimport '../../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport { useProps } from '../../../core/MantineProvider/use-props/use-props.mjs';\nimport '../../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { useStyles } from '../../../core/styles-api/use-styles/use-styles.mjs';\nimport { Box } from '../../../core/Box/Box.mjs';\nimport { factory } from '../../../core/factory/factory.mjs';\nimport '../../../core/DirectionProvider/DirectionProvider.mjs';\nimport classes from '../Button.module.css.mjs';\n\nconst defaultProps = {\n  orientation: \"horizontal\"\n};\nconst varsResolver = createVarsResolver((_, { borderWidth }) => ({\n  group: { \"--button-border-width\": rem(borderWidth) }\n}));\nconst ButtonGroup = factory((_props, ref) => {\n  const props = useProps(\"ButtonGroup\", defaultProps, _props);\n  const {\n    className,\n    style,\n    classNames,\n    styles,\n    unstyled,\n    orientation,\n    vars,\n    borderWidth,\n    variant,\n    mod,\n    ...others\n  } = useProps(\"ButtonGroup\", defaultProps, _props);\n  const getStyles = useStyles({\n    name: \"ButtonGroup\",\n    props,\n    classes,\n    className,\n    style,\n    classNames,\n    styles,\n    unstyled,\n    vars,\n    varsResolver,\n    rootSelector: \"group\"\n  });\n  return /* @__PURE__ */ jsx(\n    Box,\n    {\n      ...getStyles(\"group\"),\n      ref,\n      variant,\n      mod: [{ \"data-orientation\": orientation }, mod],\n      role: \"group\",\n      ...others\n    }\n  );\n});\nButtonGroup.classes = classes;\nButtonGroup.displayName = \"@mantine/core/ButtonGroup\";\n\nexport { ButtonGroup };\n//# sourceMappingURL=ButtonGroup.mjs.map\n","'use client';\nimport { jsxs, jsx } from 'react/jsx-runtime';\nimport { rem } from '../../core/utils/units-converters/rem.mjs';\nimport 'react';\nimport { getSize, getFontSize, getRadius } from '../../core/utils/get-size/get-size.mjs';\nimport '@mantine/hooks';\nimport { createVarsResolver } from '../../core/styles-api/create-vars-resolver/create-vars-resolver.mjs';\nimport 'clsx';\nimport '../../core/MantineProvider/Mantine.context.mjs';\nimport '../../core/MantineProvider/default-theme.mjs';\nimport '../../core/MantineProvider/MantineProvider.mjs';\nimport '../../core/MantineProvider/MantineThemeProvider/MantineThemeProvider.mjs';\nimport { useProps } from '../../core/MantineProvider/use-props/use-props.mjs';\nimport '../../core/MantineProvider/MantineCssVariables/MantineCssVariables.mjs';\nimport { useStyles } from '../../core/styles-api/use-styles/use-styles.mjs';\nimport { Box } from '../../core/Box/Box.mjs';\nimport { polymorphicFactory } from '../../core/factory/polymorphic-factory.mjs';\nimport '../../core/DirectionProvider/DirectionProvider.mjs';\nimport { Loader } from '../Loader/Loader.mjs';\nimport '../Transition/transitions.mjs';\nimport { Transition } from '../Transition/Transition.mjs';\nimport { UnstyledButton } from '../UnstyledButton/UnstyledButton.mjs';\nimport { ButtonGroup } from './ButtonGroup/ButtonGroup.mjs';\nimport classes from './Button.module.css.mjs';\n\nconst loaderTransition = {\n  in: { opacity: 1, transform: `translate(-50%, calc(-50% + ${rem(1)}))` },\n  out: { opacity: 0, transform: \"translate(-50%, -200%)\" },\n  common: { transformOrigin: \"center\" },\n  transitionProperty: \"transform, opacity\"\n};\nconst defaultProps = {};\nconst varsResolver = createVarsResolver(\n  (theme, { radius, color, gradient, variant, size, justify, autoContrast }) => {\n    const colors = theme.variantColorResolver({\n      color: color || theme.primaryColor,\n      theme,\n      gradient,\n      variant: variant || \"filled\",\n      autoContrast\n    });\n    return {\n      root: {\n        \"--button-justify\": justify,\n        \"--button-height\": getSize(size, \"button-height\"),\n        \"--button-padding-x\": getSize(size, \"button-padding-x\"),\n        \"--button-fz\": size?.includes(\"compact\") ? getFontSize(size.replace(\"compact-\", \"\")) : getFontSize(size),\n        \"--button-radius\": radius === void 0 ? void 0 : getRadius(radius),\n        \"--button-bg\": color || variant ? colors.background : void 0,\n        \"--button-hover\": color || variant ? colors.hover : void 0,\n        \"--button-color\": colors.color,\n        \"--button-bd\": color || variant ? colors.border : void 0,\n        \"--button-hover-color\": color || variant ? colors.hoverColor : void 0\n      }\n    };\n  }\n);\nconst Button = polymorphicFactory((_props, ref) => {\n  const props = useProps(\"Button\", defaultProps, _props);\n  const {\n    style,\n    vars,\n    className,\n    color,\n    disabled,\n    children,\n    leftSection,\n    rightSection,\n    fullWidth,\n    variant,\n    radius,\n    loading,\n    loaderProps,\n    gradient,\n    classNames,\n    styles,\n    unstyled,\n    \"data-disabled\": dataDisabled,\n    autoContrast,\n    mod,\n    ...others\n  } = props;\n  const getStyles = useStyles({\n    name: \"Button\",\n    props,\n    classes,\n    className,\n    style,\n    classNames,\n    styles,\n    unstyled,\n    vars,\n    varsResolver\n  });\n  const hasLeftSection = !!leftSection;\n  const hasRightSection = !!rightSection;\n  return /* @__PURE__ */ jsxs(\n    UnstyledButton,\n    {\n      ref,\n      ...getStyles(\"root\", { active: !disabled && !loading && !dataDisabled }),\n      unstyled,\n      variant,\n      disabled: disabled || loading,\n      mod: [\n        {\n          disabled: disabled || dataDisabled,\n          loading,\n          block: fullWidth,\n          \"with-left-section\": hasLeftSection,\n          \"with-right-section\": hasRightSection\n        },\n        mod\n      ],\n      ...others,\n      children: [\n        /* @__PURE__ */ jsx(Transition, { mounted: !!loading, transition: loaderTransition, duration: 150, children: (transitionStyles) => /* @__PURE__ */ jsx(Box, { component: \"span\", ...getStyles(\"loader\", { style: transitionStyles }), \"aria-hidden\": true, children: /* @__PURE__ */ jsx(\n          Loader,\n          {\n            color: \"var(--button-color)\",\n            size: \"calc(var(--button-height) / 1.8)\",\n            ...loaderProps\n          }\n        ) }) }),\n        /* @__PURE__ */ jsxs(\"span\", { ...getStyles(\"inner\"), children: [\n          leftSection && /* @__PURE__ */ jsx(Box, { component: \"span\", ...getStyles(\"section\"), mod: { position: \"left\" }, children: leftSection }),\n          /* @__PURE__ */ jsx(Box, { component: \"span\", mod: { loading }, ...getStyles(\"label\"), children }),\n          rightSection && /* @__PURE__ */ jsx(Box, { component: \"span\", ...getStyles(\"section\"), mod: { position: \"right\" }, children: rightSection })\n        ] })\n      ]\n    }\n  );\n});\nButton.classes = classes;\nButton.displayName = \"@mantine/core/Button\";\nButton.Group = ButtonGroup;\n\nexport { Button };\n//# sourceMappingURL=Button.mjs.map\n","/**\n * @license @tabler/icons-react v3.3.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nvar defaultAttributes = {\n  outline: {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    strokeWidth: 2,\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  },\n  filled: {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"currentColor\",\n    stroke: \"none\"\n  }\n};\n\nexport { defaultAttributes as default };\n//# sourceMappingURL=defaultAttributes.mjs.map\n","/**\n * @license @tabler/icons-react v3.3.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport defaultAttributes from './defaultAttributes.mjs';\n\nconst createReactComponent = (type, iconName, iconNamePascal, iconNode) => {\n  const Component = forwardRef(\n    ({ color = \"currentColor\", size = 24, stroke = 2, className, children, ...rest }, ref) => createElement(\n      \"svg\",\n      {\n        ref,\n        ...defaultAttributes[type],\n        width: size,\n        height: size,\n        className: [`tabler-icon`, `tabler-icon-${iconName}`, className].join(\" \"),\n        ...type === \"filled\" ? {\n          fill: color\n        } : {\n          strokeWidth: stroke,\n          stroke: color\n        },\n        ...rest\n      },\n      [\n        ...iconNode.map(([tag, attrs]) => createElement(tag, attrs)),\n        ...Array.isArray(children) ? children : [children]\n      ]\n    )\n  );\n  Component.displayName = `${iconNamePascal}`;\n  return Component;\n};\n\nexport { createReactComponent as default };\n//# sourceMappingURL=createReactComponent.mjs.map\n","/**\n * @license @tabler/icons-react v3.3.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nvar IconViewfinder = createReactComponent(\"outline\", \"viewfinder\", \"IconViewfinder\", [[\"path\", { \"d\": \"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\", \"key\": \"svg-0\" }], [\"path\", { \"d\": \"M12 3l0 4\", \"key\": \"svg-1\" }], [\"path\", { \"d\": \"M12 21l0 -3\", \"key\": \"svg-2\" }], [\"path\", { \"d\": \"M3 12l4 0\", \"key\": \"svg-3\" }], [\"path\", { \"d\": \"M21 12l-3 0\", \"key\": \"svg-4\" }], [\"path\", { \"d\": \"M12 12l0 .01\", \"key\": \"svg-5\" }]]);\n\nexport { IconViewfinder as default };\n//# sourceMappingURL=IconViewfinder.mjs.map\n","/**\n * @license @tabler/icons-react v3.3.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nvar IconZoomIn = createReactComponent(\"outline\", \"zoom-in\", \"IconZoomIn\", [[\"path\", { \"d\": \"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0\", \"key\": \"svg-0\" }], [\"path\", { \"d\": \"M7 10l6 0\", \"key\": \"svg-1\" }], [\"path\", { \"d\": \"M10 7l0 6\", \"key\": \"svg-2\" }], [\"path\", { \"d\": \"M21 21l-6 -6\", \"key\": \"svg-3\" }]]);\n\nexport { IconZoomIn as default };\n//# sourceMappingURL=IconZoomIn.mjs.map\n","/**\n * @license @tabler/icons-react v3.3.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nvar IconZoomOut = createReactComponent(\"outline\", \"zoom-out\", \"IconZoomOut\", [[\"path\", { \"d\": \"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0\", \"key\": \"svg-0\" }], [\"path\", { \"d\": \"M7 10l6 0\", \"key\": \"svg-1\" }], [\"path\", { \"d\": \"M21 21l-6 -6\", \"key\": \"svg-2\" }]]);\n\nexport { IconZoomOut as default };\n//# sourceMappingURL=IconZoomOut.mjs.map\n","import React, { MouseEventHandler } from \"react\";\nimport { Stack, ActionIcon, MantineProvider, Button } from \"@mantine/core\";\nimport { IconZoomIn, IconZoomOut, IconViewfinder } from \"@tabler/icons-react\";\n\nconst ZoomActions = ({\n  zoomIn = () => {},\n  zoomOut = () => {},\n  zoomFit = () => {},\n}: {\n  zoomIn?: MouseEventHandler;\n  zoomOut?: MouseEventHandler;\n  zoomFit?: MouseEventHandler;\n}) => {\n  return (\n    <>\n      <Button.Group orientation=\"vertical\" style={{ width: 40 }}>\n        {zoomIn && (\n          <Button variant=\"default\" size=\"compact-sm\" onClick={zoomIn}>\n            <IconZoomIn size={17} />\n          </Button>\n        )}\n        {zoomOut && (\n          <Button variant=\"default\" size=\"compact-sm\" onClick={zoomOut}>\n            <IconZoomOut size={17} />\n          </Button>\n        )}\n        {zoomFit && (\n          <Button variant=\"default\" size=\"compact-sm\" onClick={zoomFit}>\n            <IconViewfinder size={17} />\n          </Button>\n        )}\n      </Button.Group>\n    </>\n  );\n};\n\nexport default ZoomActions;\n","import React, {\n  forwardRef,\n  ForwardRefRenderFunction,\n  Ref,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from \"react\";\n\n// import BpmnJSModeler from \"bpmn-js/dist/bpmn-modeler.production.min.js\";\n//@ts-ignore\nimport BpmnModeler, { BpmnModeler as IBpmnModeler } from \"bpmn-js/lib/Modeler\";\n\nimport { defaultBpmnXml } from \"../utils/bpmn.utils\";\nimport ZoomActions from \"../components/ZoomActions\";\nimport {\n  BpmnJsReactHandle,\n  BpmnJsReactProps,\n} from \"../interfaces/bpmnJsReact.interface\";\nimport ConfigPanel from \"../components/ConfigPanel\";\n\nconst BpmnJsModeler: ForwardRefRenderFunction<\n  BpmnJsReactHandle,\n  BpmnJsReactProps\n> = (\n  {\n    useBpmnJsReact,\n    xml = defaultBpmnXml,\n    height = 500,\n    zoomActions = true,\n    onLoading = () => {},\n    onError = () => {},\n    onShown = () => {},\n    click = () => {},\n    dbclick = () => {},\n    ...props\n  }: BpmnJsReactProps,\n  ref\n) => {\n  const containerRef = useRef(null);\n  const [bpmnEditor, setBpmnEditor] =\n    useState<ReturnType<typeof IBpmnModeler>>(null);\n  const [selectedElement, setSelectedElement] = useState();\n  useEffect(() => {\n    const container: any = containerRef.current;\n    const newModeler = new BpmnModeler({ container });\n    useBpmnJsReact?.setBpmnModeler(newModeler);\n    setBpmnEditor(newModeler);\n\n    return () => bpmnEditor?.destroy();\n  }, []);\n\n  useEffect(() => {\n    console.log(`my xml:${xml}`);\n    bpmnEditor?.importXML(xml);\n\n    bpmnEditor?.on(\"import.done\", (event: any) => {\n      const { error, warning } = event;\n\n      if (error) {\n        return onError(error);\n      }\n\n      zoomFit();\n\n      onShown(warning);\n    });\n\n    // bpmnEditor?.on(\"element.click\", onClick);\n    // Define the function\n\n    bpmnEditor?.on(\"element.click\", (e: any) => {\n      setSelectedElement(e.element);\n      console.log(\"🚀element:\", e.element);\n      click(e);\n      // getConvas().addMarker(e.element.id, \"test\");\n    });\n  }, [bpmnEditor, xml]);\n\n  const getConvas = () => {\n    return bpmnEditor?.get(\"canvas\");\n  };\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      saveXml(result: any, options = { format: false }) {\n        bpmnEditor.saveXML(options, result);\n      },\n      async saveXmlAsync(result: any, options = { format: false }) {\n        return await bpmnEditor.saveXML(options, result);\n      },\n      importXml(xml: string) {\n        bpmnEditor?.importXML(xml);\n      },\n      getModeler() {\n        return bpmnEditor;\n      },\n      getCanvas() {\n        return bpmnEditor.get(\"canvas\");\n      },\n      zoomIn(step = 0.1) {\n        bpmnEditor.get(\"zoomScroll\").stepZoom(step);\n      },\n      zoomOut(step = 0.1) {\n        bpmnEditor.get(\"zoomScroll\").stepZoom(-step);\n      },\n      zoomFit() {\n        bpmnEditor.get(\"canvas\").zoom(\"fit-viewport\");\n      },\n      setColor(elements: any, color: any) {\n        bpmnEditor.get(\"modeling\").setColor(elements, color);\n      },\n      addMarker(id: string, cssClass: string) {\n        bpmnEditor.get(\"canvas\").addMarker(id, cssClass);\n      },\n      removeMarker(id: string, cssClass: string) {\n        bpmnEditor.get(\"canvas\").removeMarker(id, cssClass);\n      },\n    }),\n    [bpmnEditor]\n  );\n\n  const zoomIn = () => {\n    bpmnEditor.get(\"zoomScroll\").stepZoom(0.1);\n  };\n\n  const zoomOut = () => {\n    bpmnEditor.get(\"zoomScroll\").stepZoom(-0.1);\n  };\n\n  const zoomFit = () => {\n    bpmnEditor.get(\"canvas\").zoom(\"fit-viewport\");\n  };\n\n  // const saveXml = () => {\n  //   alert(\"hi\");\n  // };\n\n  // useEffect(() => {\n  //   bpmnEditor?.importXML(xml);\n  // }, [xml, bpmnEditor]);\n\n  return (\n    <>\n      <div\n        className=\"bpmn-wrapper\"\n        style={{\n          display: \"flex\",\n          flexDirection: \"row\",\n          justifyContent: \"flex-start\",\n        }}\n      >\n        <div\n          className=\"bpmn-js-react-editor-container\"\n          ref={containerRef}\n          style={{ height, width: \"800\" }}\n        ></div>\n        <div className=\"actions-wrapper\">\n          {zoomActions && (\n            <ZoomActions\n              zoomIn={zoomIn}\n              zoomOut={zoomOut}\n              zoomFit={zoomFit}\n            ></ZoomActions>\n          )}\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default forwardRef(BpmnJsModeler);\n","/*! bpmn-js - bpmn-navigated-viewer v17.6.0 | Copyright (c) 2014-present, camunda Services GmbH | bpmn.io/license */\n!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=\"undefined\"!=typeof globalThis?globalThis:e||self).BpmnJS=t()}(this,(function(){\"use strict\";function e(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}const t=Object.prototype.toString,n=Object.prototype.hasOwnProperty;function i(e){return void 0===e}function r(e){return void 0!==e}function o(e){return\"[object Array]\"===t.call(e)}function a(e){return\"[object Object]\"===t.call(e)}function s(e){return\"[object Number]\"===t.call(e)}function l(e){const n=t.call(e);return\"[object Function]\"===n||\"[object AsyncFunction]\"===n||\"[object GeneratorFunction]\"===n||\"[object AsyncGeneratorFunction]\"===n||\"[object Proxy]\"===n}function p(e){return\"[object String]\"===t.call(e)}function c(e,t){return n.call(e,t)}function u(e,t){const n=v(t);let i;return f(e,(function(e,t){if(n(e,t))return i=e,!1})),i}function h(e,t){const n=v(t);let i=[];return f(e,(function(e,t){n(e,t)&&i.push(e)})),i}function f(e,t){let n,r;if(i(e))return;const a=o(e)?b:x;for(let i in e)if(c(e,i)&&(n=e[i],r=t(n,a(i)),!1===r))return n}function m(e,t,n){return f(e,(function(e,i){n=t(n,e,i)})),n}function d(e,t){return!!m(e,(function(e,n,i){return e&&t(n,i)}),!0)}function y(e,t){return!!u(e,t)}function g(e){return function(t){return d(e,(function(e,n){return t[n]===e}))}}function v(e){return l(e)?e:t=>t===e}function x(e){return e}function b(e){return Number(e)}function w(e,t){return e.bind(t)}function E(e,...t){return Object.assign(e,...t)}var _=1e3;function A(e,t){var n=this;t=t||_,e.on([\"render.shape\",\"render.connection\"],t,(function(e,t){var i=e.type,r=t.element,o=t.gfx,a=t.attrs;if(n.canRender(r))return\"render.shape\"===i?n.drawShape(o,r,a):n.drawConnection(o,r,a)})),e.on([\"render.getShapePath\",\"render.getConnectionPath\"],t,(function(e,t){if(n.canRender(t))return\"render.getShapePath\"===e.type?n.getShapePath(t):n.getConnectionPath(t)}))}function k(e,t){var n=S(e);return n&&\"function\"==typeof n.$instanceOf&&n.$instanceOf(t)}function R(e,t){return y(t,(function(t){return k(e,t)}))}function S(e){return e&&e.businessObject||e}function C(e){return e&&e.di}function M(e,t){return!k(e,\"bpmn:CallActivity\")&&(k(e,\"bpmn:SubProcess\")?!(!(t=t||C(e))||!k(t,\"bpmndi:BPMNPlane\"))||t&&!!t.isExpanded:!k(e,\"bpmn:Participant\")||!!S(e).processRef)}function P(e){if(k(e,\"bpmn:Participant\")||k(e,\"bpmn:Lane\")){var t=C(e).isHorizontal;return void 0===t||t}}function D(e){return a(e)&&c(e,\"labelTarget\")}A.prototype.canRender=function(e){},A.prototype.drawShape=function(e,t){},A.prototype.drawConnection=function(e,t){},A.prototype.getShapePath=function(e){},A.prototype.getConnectionPath=function(e){};var N={width:90,height:20},T=15;function O(e){var t=e.length/2-1,n=e[Math.floor(t)],i=e[Math.ceil(t+.01)],r=function(e){var t=e.length/2-1,n=e[Math.floor(t)],i=e[Math.ceil(t+.01)];return{x:n.x+(i.x-n.x)/2,y:n.y+(i.y-n.y)/2}}(e),o=Math.atan((i.y-n.y)/(i.x-n.x)),a=r.x,s=r.y;return Math.abs(o)<Math.PI/2?s-=T:a+=T,{x:a,y:s}}function B(e,t){var n,i,r,o=e.label;return o&&o.bounds?(r=o.bounds,i={width:Math.max(N.width,r.width),height:r.height},n={x:r.x+r.width/2,y:r.y+r.height/2}):(n=function(e){return e.waypoints?O(e.waypoints):k(e,\"bpmn:Group\")?{x:e.x+e.width/2,y:e.y+N.height/2}:{x:e.x+e.width/2,y:e.y+e.height+N.height/2}}(t),i=N),E({x:n.x-i.width/2,y:n.y-i.height/2},i)}function L(e){var t=e.businessObject,n=function(e){return k(e,\"bpmn:FlowElement\")||k(e,\"bpmn:Participant\")||k(e,\"bpmn:Lane\")||k(e,\"bpmn:SequenceFlow\")||k(e,\"bpmn:MessageFlow\")||k(e,\"bpmn:DataInput\")||k(e,\"bpmn:DataOutput\")?\"name\":k(e,\"bpmn:TextAnnotation\")?\"text\":k(e,\"bpmn:Group\")?\"categoryValueRef\":void 0}(t);if(n)return\"categoryValueRef\"===n?function(e){var t=e.categoryValueRef;return t&&t.value||\"\"}(t):t[n]||\"\"}function I(e,t){return t.appendChild(function(e,t){if(e.ownerDocument!==t.ownerDocument)try{return t.ownerDocument.importNode(e,!0)}catch(e){}return e}(e,t))}function j(e,t){return I(t,e),e}var F=2,V={\"alignment-baseline\":1,\"baseline-shift\":1,clip:1,\"clip-path\":1,\"clip-rule\":1,color:1,\"color-interpolation\":1,\"color-interpolation-filters\":1,\"color-profile\":1,\"color-rendering\":1,cursor:1,direction:1,display:1,\"dominant-baseline\":1,\"enable-background\":1,fill:1,\"fill-opacity\":1,\"fill-rule\":1,filter:1,\"flood-color\":1,\"flood-opacity\":1,font:1,\"font-family\":1,\"font-size\":F,\"font-size-adjust\":1,\"font-stretch\":1,\"font-style\":1,\"font-variant\":1,\"font-weight\":1,\"glyph-orientation-horizontal\":1,\"glyph-orientation-vertical\":1,\"image-rendering\":1,kerning:1,\"letter-spacing\":1,\"lighting-color\":1,marker:1,\"marker-end\":1,\"marker-mid\":1,\"marker-start\":1,mask:1,opacity:1,overflow:1,\"pointer-events\":1,\"shape-rendering\":1,\"stop-color\":1,\"stop-opacity\":1,stroke:1,\"stroke-dasharray\":1,\"stroke-dashoffset\":1,\"stroke-linecap\":1,\"stroke-linejoin\":1,\"stroke-miterlimit\":1,\"stroke-opacity\":1,\"stroke-width\":F,\"text-anchor\":1,\"text-decoration\":1,\"text-rendering\":1,\"unicode-bidi\":1,visibility:1,\"word-spacing\":1,\"writing-mode\":1};function W(e,t,n){var i=t.replace(/([a-z])([A-Z])/g,\"$1-$2\").toLowerCase(),r=V[i];r?(r===F&&\"number\"==typeof n&&(n=String(n)+\"px\"),e.style[i]=n):e.setAttributeNS(null,t,n)}function z(e,t,n){if(\"string\"==typeof t){if(void 0===n)return function(e,t){return V[t]?e.style[t]:e.getAttributeNS(null,t)}(e,t);W(e,t,n)}else!function(e,t){var n,i,r=Object.keys(t);for(n=0;i=r[n];n++)W(e,i,t[i])}(e,t);return e}const $=Object.prototype.toString;function G(e){return new H(e)}function H(e){if(!e||!e.nodeType)throw new Error(\"A DOM element reference is required\");this.el=e,this.list=e.classList}function K(e){var t=e.parentNode;return t&&t.removeChild(e),e}function U(e){for(var t;t=e.firstChild;)K(t);return e}H.prototype.add=function(e){return this.list.add(e),this},H.prototype.remove=function(e){return\"[object RegExp]\"==$.call(e)?this.removeMatching(e):(this.list.remove(e),this)},H.prototype.removeMatching=function(e){const t=this.array();for(let n=0;n<t.length;n++)e.test(t[n])&&this.remove(t[n]);return this},H.prototype.toggle=function(e,t){return void 0!==t?t!==this.list.toggle(e,t)&&this.list.toggle(e):this.list.toggle(e),this},H.prototype.array=function(){return Array.from(this.list)},H.prototype.has=H.prototype.contains=function(e){return this.list.contains(e)};var q={svg:\"http://www.w3.org/2000/svg\"},Y='<svg xmlns=\"'+q.svg+'\"';function X(e){var t=!1;\"<svg\"===e.substring(0,4)?-1===e.indexOf(q.svg)&&(e=Y+e.substring(4)):(e=Y+\">\"+e+\"</svg>\",t=!0);var n=function(e){var t;return(t=new DOMParser).async=!1,t.parseFromString(e,\"text/xml\")}(e);if(!t)return n;for(var i=document.createDocumentFragment(),r=n.firstChild;r.firstChild;)i.appendChild(r.firstChild);return i}function Z(e,t){var n;return\"<\"===e.charAt(0)?(n=X(e).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(q.svg,e),t&&z(n,t),n}var J=null;function Q(){return null===J&&(J=Z(\"svg\")),J}function ee(e,t){var n,i,r=Object.keys(t);for(n=0;i=r[n];n++)e[i]=t[i];return e}function te(e){return e?Q().createSVGTransformFromMatrix(e):Q().createSVGTransform()}var ne=/([&<>]{1})/g,ie=/([\\n\\r\"]{1})/g,re={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"'\"};function oe(e,t){return e.replace(t,(function(e,t){return re[t]||t}))}function ae(e,t){var n,i,r,o,a;switch(e.nodeType){case 3:t.push(oe(e.textContent,ne));break;case 1:if(t.push(\"<\",e.tagName),e.hasAttributes())for(n=0,i=(r=e.attributes).length;n<i;++n)o=r.item(n),t.push(\" \",o.name,'=\"',oe(o.value,ie),'\"');if(e.hasChildNodes()){for(t.push(\">\"),n=0,i=(a=e.childNodes).length;n<i;++n)ae(a.item(n),t);t.push(\"</\",e.tagName,\">\")}else t.push(\"/>\");break;case 8:t.push(\"\\x3c!--\",oe(e.nodeValue,ne),\"--\\x3e\");break;case 4:t.push(\"<![CDATA[\",e.nodeValue,\"]]>\");break;default:throw new Error(\"unable to handle node \"+e.nodeType)}return t}function se(e,t){var n=X(t);if(U(e),t){(function(e){return\"#document-fragment\"===e.nodeName})(n)||(n=n.documentElement);for(var i,r=(i=n.childNodes,Array.prototype.slice.call(i)),o=0;o<r.length;o++)I(r[o],e)}}function le(e,t){if(void 0!==t){try{se(e,t)}catch(e){throw new Error(\"error parsing SVG: \"+e.message)}return e}return function(e){for(var t=e.firstChild,n=[];t;)ae(t,n),t=t.nextSibling;return n.join(\"\")}(e)}function pe(e,t){return t instanceof SVGMatrix?e.createSVGTransformFromMatrix(t):t}function ce(e,t){var n=e.transform.baseVal;return t&&(Array.isArray(t)||(t=[t]),function(e,t){var n,i;for(e.clear(),n=0;i=t[n];n++)e.appendItem(pe(e,i))}(n,t)),n.consolidate()}function ue(e){return e.flat().join(\",\").replace(/,?([A-z]),?/g,\"$1\")}function he(e){return[\"L\",e.x,e.y]}function fe(e,t){const n=e.length,i=[(r=e[0],[\"M\",r.x,r.y])];var r,o,a,s;for(let r=1;r<n;r++){const n=e[r-1],l=e[r],p=e[r+1];if(!p||!t){i.push(he(l));continue}const c=Math.min(t,de(l.x-n.x,l.y-n.y),de(p.x-l.x,p.y-l.y));if(!c){i.push(he(l));continue}const u=me(l,n,c),h=me(l,n,.5*c),f=me(l,p,c),m=me(l,p,.5*c);i.push(he(u)),i.push((a=m,s=f,[\"C\",(o=h).x,o.y,a.x,a.y,s.x,s.y]))}return i}function me(e,t,n){const i=t.x-e.x,r=t.y-e.y,o=n/de(i,r);return{x:e.x+i*o,y:e.y+r*o}}function de(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))}function ye(e,t,n){s(t)&&(n=t,t=null),t||(t={});const i=Z(\"path\",t);return s(n)&&(i.dataset.cornerRadius=String(n)),ge(i,e)}function ge(e,t){return z(e,{d:ue(fe(t,parseInt(e.dataset.cornerRadius,10)||0))}),e}var ve=\"hsl(225, 10%, 15%)\",xe=\"white\";function be(e,t){return y(e.eventDefinitions,(function(e){return e.$type===t}))}function we(e,t,n){var i=C(e);return n||i.get(\"color:background-color\")||i.get(\"bioc:fill\")||t||xe}function Ee(e,t,n){var i=C(e);return n||i.get(\"color:border-color\")||i.get(\"bioc:stroke\")||t||ve}function _e(e,t,n,i){var r=C(e).get(\"label\");return i||r&&r.get(\"color:color\")||t||Ee(e,n)}function Ae(e,t={}){return{width:ke(e,t),height:Re(e,t)}}function ke(e,t={}){return c(t,\"width\")?t.width:e.width}function Re(e,t={}){return c(t,\"height\")?t.height:e.height}function Se(e,t){return t.forEach((function(t){t&&\"string\"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if(\"default\"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}const Ce=Object.prototype.toString,Me=Object.prototype.hasOwnProperty;function Pe(e,t){return Me.call(e,t)}function De(e,t){let n,i;if(void 0===e)return;const r=function(e){return\"[object Array]\"===Ce.call(e)}(e)?Te:Ne;for(let o in e)if(Pe(e,o)&&(n=e[o],i=t(n,r(o)),!1===i))return n}function Ne(e){return e}function Te(e){return Number(e)}function Oe(e,...t){const n=e.style;return De(t,(function(e){e&&De(e,(function(e,t){n[t]=e}))})),e}const Be=Object.prototype.toString;function Le(e){return new Ie(e)}function Ie(e){if(!e||!e.nodeType)throw new Error(\"A DOM element reference is required\");this.el=e,this.list=e.classList}function je(e){for(var t;e.childNodes.length;)t=e.childNodes[0],e.removeChild(t);return e}function Fe(e,t){return e&&\"function\"==typeof e.matches&&e.matches(t)}function Ve(e,t,n){for(var i=n?e:e.parentNode;i&&i.nodeType!==document.DOCUMENT_NODE&&i.nodeType!==document.DOCUMENT_FRAGMENT_NODE;){if(Fe(i,t))return i;i=i.parentNode}return Fe(i,t)?i:null}Ie.prototype.add=function(e){return this.list.add(e),this},Ie.prototype.remove=function(e){return\"[object RegExp]\"==Be.call(e)?this.removeMatching(e):(this.list.remove(e),this)},Ie.prototype.removeMatching=function(e){const t=this.array();for(let n=0;n<t.length;n++)e.test(t[n])&&this.remove(t[n]);return this},Ie.prototype.toggle=function(e,t){return void 0!==t?t!==this.list.toggle(e,t)&&this.list.toggle(e):this.list.toggle(e),this},Ie.prototype.array=function(){return Array.from(this.list)},Ie.prototype.has=Ie.prototype.contains=function(e){return this.list.contains(e)};var We,ze,$e,Ge={};function He(){We=window.addEventListener?\"addEventListener\":\"attachEvent\",ze=window.removeEventListener?\"removeEventListener\":\"detachEvent\",$e=\"addEventListener\"!==We?\"on\":\"\"}var Ke=Se({__proto__:null,bind:Ge.bind=function(e,t,n,i){return We||He(),e[We]($e+t,n,i||!1),n},unbind:Ge.unbind=function(e,t,n,i){return ze||He(),e[ze]($e+t,n,i||!1),n},default:Ge},[Ge]),Ue=[\"focus\",\"blur\"];var qe,Ye={bind:function(e,t,n,i,r){return-1!==Ue.indexOf(n)&&(r=!0),Ke.bind(e,n,(function(n){var r=n.target||n.srcElement;n.delegateTarget=Ve(r,t,!0),n.delegateTarget&&i.call(e,n)}),r)},unbind:function(e,t,n,i){return-1!==Ue.indexOf(t)&&(i=!0),Ke.unbind(e,t,n,i)}},Xe=function(e,t){if(\"string\"!=typeof e)throw new TypeError(\"String expected\");t||(t=document);var n=/<([\\w:]+)/.exec(e);if(!n)return t.createTextNode(e);e=e.replace(/^\\s+|\\s+$/g,\"\");var i=n[1];if(\"body\"==i){return(r=t.createElement(\"html\")).innerHTML=e,r.removeChild(r.lastChild)}var r,o=Object.prototype.hasOwnProperty.call(Je,i)?Je[i]:Je._default,a=o[0],s=o[1],l=o[2];(r=t.createElement(\"div\")).innerHTML=s+e+l;for(;a--;)r=r.lastChild;if(r.firstChild==r.lastChild)return r.removeChild(r.firstChild);var p=t.createDocumentFragment();for(;r.firstChild;)p.appendChild(r.removeChild(r.firstChild));return p},Ze=!1;\"undefined\"!=typeof document&&((qe=document.createElement(\"div\")).innerHTML='  <link/><table></table><a href=\"/a\">a</a><input type=\"checkbox\"/>',Ze=!qe.getElementsByTagName(\"link\").length,qe=void 0);var Je={legend:[1,\"<fieldset>\",\"</fieldset>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],col:[2,\"<table><tbody></tbody><colgroup>\",\"</colgroup></table>\"],_default:Ze?[1,\"X<div>\",\"</div>\"]:[0,\"\",\"\"]};Je.td=Je.th=[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],Je.option=Je.optgroup=[1,'<select multiple=\"multiple\">',\"</select>\"],Je.thead=Je.tbody=Je.colgroup=Je.caption=Je.tfoot=[1,\"<table>\",\"</table>\"],Je.polyline=Je.ellipse=Je.polygon=Je.circle=Je.text=Je.line=Je.path=Je.rect=Je.g=[1,'<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">',\"</svg>\"];var Qe=Xe;function et(e,t){return(t=t||document).querySelector(e)}function tt(e){e.parentNode&&e.parentNode.removeChild(e)}function nt(e,t,n,i,r){var o=te();o.setTranslate(t,n);var a=te();a.setRotate(i||0,0,0);var s=te();s.setScale(r||1,r||1),ce(e,[o,a,s])}function it(e,t,n){var i=te();i.setTranslate(t,n),ce(e,i)}var rt=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=e.exports=function(e,n){if(n||(n=16),void 0===e&&(e=128),e<=0)return\"0\";for(var i=Math.log(Math.pow(2,e))/Math.log(n),r=2;i===1/0;r*=2)i=Math.log(Math.pow(2,e/r))/Math.log(n)*r;var o=i-Math.floor(i),a=\"\";for(r=0;r<Math.floor(i);r++){a=Math.floor(Math.random()*n).toString(n)+a}if(o){var s=Math.pow(n,o);a=Math.floor(Math.random()*s).toString(n)+a}var l=parseInt(a,n);return l!==1/0&&l>=Math.pow(2,e)?t(e,n):a};t.rack=function(e,n,i){var r=function(r){var a=0;do{if(a++>10){if(!i)throw new Error(\"too many ID collisions, use more bits\");e+=i}var s=t(e,n)}while(Object.hasOwnProperty.call(o,s));return o[s]=r,s},o=r.hats={};return r.get=function(e){return r.hats[e]},r.set=function(e,t){return r.hats[e]=t,r},r.bits=e||128,r.base=n||16,r}}));function ot(e){if(!(this instanceof ot))return new ot(e);e=e||[128,36,1],this._seed=e.length?rt.rack(e[0],e[1],e[2]):e}ot.prototype.next=function(e){return this._seed(e||!0)},ot.prototype.nextPrefixed=function(e,t){var n;do{n=e+this.next(!0)}while(this.assigned(n));return this.claim(n,t),n},ot.prototype.claim=function(e,t){this._seed.set(e,t||!0)},ot.prototype.assigned=function(e){return this._seed.get(e)||!1},ot.prototype.unclaim=function(e){delete this._seed.hats[e]},ot.prototype.clear=function(){var e,t=this._seed.hats;for(e in t)this.unclaim(e)};var at=new ot,st=.95;function lt(e,t,n,i,r,o,s){A.call(this,t,s);var l=e&&e.defaultFillColor,p=e&&e.defaultStrokeColor,c=e&&e.defaultLabelColor,u=at.next(),h={};function m(e){return n.computeStyle(e,{strokeLinecap:\"round\",strokeLinejoin:\"round\",stroke:ve,strokeWidth:2,fill:\"white\"})}function d(e){return n.computeStyle(e,[\"no-fill\"],{strokeLinecap:\"round\",strokeLinejoin:\"round\",stroke:ve,strokeWidth:2})}function y(e,t){var{ref:n={x:0,y:0},scale:i=1,element:o}=t,a=Z(\"marker\",{id:e,viewBox:\"0 0 20 20\",refX:n.x,refY:n.y,markerWidth:20*i,markerHeight:20*i,orient:\"auto\"});j(a,o);var s=et(\"defs\",r._svg);s||(s=Z(\"defs\"),j(r._svg,s)),j(s,a),h[e]=a}function g(e){return e.replace(/[^0-9a-zA-Z]+/g,\"_\")}function v(e,t,n){var i=e+\"-\"+g(t)+\"-\"+g(n)+\"-\"+u;return h[i]||function(e,t,n,i){if(\"sequenceflow-end\"===t){y(e,{element:Z(\"path\",{d:\"M 1 5 L 11 10 L 1 15 Z\",...m({fill:i,stroke:i,strokeWidth:1})}),ref:{x:11,y:10},scale:.5})}if(\"messageflow-start\"===t){y(e,{element:Z(\"circle\",{cx:6,cy:6,r:3.5,...m({fill:n,stroke:i,strokeWidth:1,strokeDasharray:[1e4,1]})}),ref:{x:6,y:6}})}if(\"messageflow-end\"===t){y(e,{element:Z(\"path\",{d:\"m 1 5 l 0 -3 l 7 3 l -7 3 z\",...m({fill:n,stroke:i,strokeWidth:1,strokeDasharray:[1e4,1]})}),ref:{x:8.5,y:5}})}if(\"association-start\"===t){y(e,{element:Z(\"path\",{d:\"M 11 5 L 1 10 L 11 15\",...d({fill:\"none\",stroke:i,strokeWidth:1.5,strokeDasharray:[1e4,1]})}),ref:{x:1,y:10},scale:.5})}if(\"association-end\"===t){y(e,{element:Z(\"path\",{d:\"M 1 5 L 11 10 L 1 15\",...d({fill:\"none\",stroke:i,strokeWidth:1.5,strokeDasharray:[1e4,1]})}),ref:{x:11,y:10},scale:.5})}if(\"conditional-flow-marker\"===t){y(e,{element:Z(\"path\",{d:\"M 0 10 L 8 6 L 16 10 L 8 14 Z\",...m({fill:n,stroke:i})}),ref:{x:-1,y:10},scale:.5})}if(\"conditional-default-flow-marker\"===t){y(e,{element:Z(\"path\",{d:\"M 6 4 L 10 16\",...m({stroke:i})}),ref:{x:0,y:10},scale:.5})}}(i,e,t,n),\"url(#\"+i+\")\"}function x(e,t,n,i,r={}){a(i)&&(r=i,i=0),i=i||0,r=m(r);var o=Z(\"circle\",{cx:t/2,cy:n/2,r:Math.round((t+n)/4-i),...r});return j(e,o),o}function b(e,t,n,i,r,o){a(r)&&(o=r,r=0),r=r||0,o=m(o);var s=Z(\"rect\",{x:r,y:r,width:t-2*r,height:n-2*r,rx:i,ry:i,...o});return j(e,s),s}function w(e,t,n,i){var r=ye(t,n=d(n),i);return j(e,r),r}function _(e,t,n){return w(e,t,n,5)}function R(e,t,n){n=d(n);var i=Z(\"path\",{...n,d:t});return j(e,i),i}function D(e,t,n,i){return R(t,n,E({\"data-marker\":e},i))}function N(e){return me[e]}function T(e){return function(t,n,i){return N(e)(t,n,i)}}var O=function(e,t,n={},r){return R(e,i.getScaledPath(\"EVENT_MESSAGE\",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:t.width,containerHeight:t.height,position:{mx:.235,my:.315}}),{fill:r?Ee(t,p,n.stroke):we(t,l,n.fill),stroke:r?we(t,l,n.fill):Ee(t,p,n.stroke),strokeWidth:1})},B=function(e,t,n={}){var r=x(e,t.width,t.height,.2*t.height,{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:2});R(e,i.getScaledPath(\"EVENT_TIMER_WH\",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.5}}),{stroke:Ee(t,p,n.stroke),strokeWidth:2});for(var o=0;o<12;o++){var a=i.getScaledPath(\"EVENT_TIMER_LINE\",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.5}}),s=t.width/2,c=t.height/2;R(e,a,{strokeWidth:1,stroke:Ee(t,p,n.stroke),transform:\"rotate(\"+30*o+\",\"+c+\",\"+s+\")\"})}return r},I=function(e,t,n={},r){return R(e,i.getScaledPath(\"EVENT_ESCALATION\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.2}}),{fill:r?Ee(t,p,n.stroke):we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1})},F=function(e,t,n={}){return R(e,i.getScaledPath(\"EVENT_CONDITIONAL\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.222}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1})},V=function(e,t,n={},r){return R(e,i.getScaledPath(\"EVENT_LINK\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.57,my:.263}}),{fill:r?Ee(t,p,n.stroke):we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1})},W=function(e,t,n={},r){return R(e,i.getScaledPath(\"EVENT_ERROR\",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:t.width,containerHeight:t.height,position:{mx:.2,my:.722}}),{fill:r?Ee(t,p,n.stroke):we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1})},$=function(e,t,n={},r){var o=R(e,i.getScaledPath(\"EVENT_CANCEL_45\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.638,my:-.055}}),{fill:r?Ee(t,p,n.stroke):\"none\",stroke:Ee(t,p,n.stroke),strokeWidth:1});return function(e,t){var n=te();n.setRotate(t,0,0),ce(e,n)}(o,45),o},H=function(e,t,n={},r){return R(e,i.getScaledPath(\"EVENT_COMPENSATION\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.22,my:.5}}),{fill:r?Ee(t,p,n.stroke):we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1})},K=function(e,t,n={},r){return R(e,i.getScaledPath(\"EVENT_SIGNAL\",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:t.width,containerHeight:t.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:r?Ee(t,p,n.stroke):we(t,l,n.fill),stroke:Ee(t,p,n.stroke)})},U=function(e,t,n={},r){return R(e,i.getScaledPath(\"EVENT_MULTIPLE\",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:t.width,containerHeight:t.height,position:{mx:.222,my:.36}}),{fill:r?Ee(t,p,n.stroke):we(t,l,n.fill),strokeWidth:1})},q=function(e,t,n={}){return R(e,i.getScaledPath(\"EVENT_PARALLEL_MULTIPLE\",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:t.width,containerHeight:t.height,position:{mx:.458,my:.194}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1})},Y=function(e,t,n={}){return x(e,t.width,t.height,8,{fill:Ee(t,p,n.stroke),stroke:Ee(t,p,n.stroke),strokeWidth:4})};function X(e,t,n={}){var i=S(e),r=function(e){return\"bpmn:IntermediateThrowEvent\"===e.$type||\"bpmn:EndEvent\"===e.$type}(i);return i.get(\"eventDefinitions\")&&i.get(\"eventDefinitions\").length>1?i.get(\"parallelMultiple\")?q(t,e,n,r):U(t,e,n,r):be(i,\"bpmn:MessageEventDefinition\")?O(t,e,n,r):be(i,\"bpmn:TimerEventDefinition\")?B(t,e,n,r):be(i,\"bpmn:ConditionalEventDefinition\")?F(t,e,n,r):be(i,\"bpmn:SignalEventDefinition\")?K(t,e,n,r):be(i,\"bpmn:EscalationEventDefinition\")?I(t,e,n,r):be(i,\"bpmn:LinkEventDefinition\")?V(t,e,n,r):be(i,\"bpmn:ErrorEventDefinition\")?W(t,e,n,r):be(i,\"bpmn:CancelEventDefinition\")?$(t,e,n,r):be(i,\"bpmn:CompensateEventDefinition\")?H(t,e,n,r):be(i,\"bpmn:TerminateEventDefinition\")?Y(t,e,n,r):null}var J={ParticipantMultiplicityMarker:function(e,t,n={}){var r=ke(t,n),o=Re(t,n);D(\"participant-multiplicity\",e,i.getScaledPath(\"MARKER_PARALLEL\",{xScaleFactor:1,yScaleFactor:1,containerWidth:r,containerHeight:o,position:{mx:(r/2-6)/r,my:(o-15)/o}}),{strokeWidth:2,fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke)})},SubProcessMarker:function(e,t,n={}){it(b(e,14,14,0,{strokeWidth:1,fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke)}),t.width/2-7.5,t.height-20),D(\"sub-process\",e,i.getScaledPath(\"MARKER_SUB_PROCESS\",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2-7.5)/t.width,my:(t.height-20)/t.height}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke)})},ParallelMarker:function(e,t,n){var r=ke(t,n),o=Re(t,n);D(\"parallel\",e,i.getScaledPath(\"MARKER_PARALLEL\",{xScaleFactor:1,yScaleFactor:1,containerWidth:r,containerHeight:o,position:{mx:(r/2+n.parallel)/r,my:(o-20)/o}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke)})},SequentialMarker:function(e,t,n){D(\"sequential\",e,i.getScaledPath(\"MARKER_SEQUENTIAL\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+n.seq)/t.width,my:(t.height-19)/t.height}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke)})},CompensationMarker:function(e,t,n){D(\"compensation\",e,i.getScaledPath(\"MARKER_COMPENSATION\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:(t.width/2+n.compensation)/t.width,my:(t.height-13)/t.height}}),{strokeWidth:1,fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke)})},LoopMarker:function(e,t,n){var r=ke(t,n),o=Re(t,n);D(\"loop\",e,i.getScaledPath(\"MARKER_LOOP\",{xScaleFactor:1,yScaleFactor:1,containerWidth:r,containerHeight:o,position:{mx:(r/2+n.loop)/r,my:(o-7)/o}}),{strokeWidth:1.5,fill:\"none\",stroke:Ee(t,p,n.stroke),strokeMiterlimit:.5})},AdhocMarker:function(e,t,n){var r=ke(t,n),o=Re(t,n);D(\"adhoc\",e,i.getScaledPath(\"MARKER_ADHOC\",{xScaleFactor:1,yScaleFactor:1,containerWidth:r,containerHeight:o,position:{mx:(r/2+n.adhoc)/r,my:(o-15)/o}}),{strokeWidth:1,fill:Ee(t,p,n.stroke),stroke:Ee(t,p,n.stroke)})}};function Q(e,t,n,i){J[e](t,n,i)}function ee(e,t,n,i={}){i={fill:i.fill,stroke:i.stroke,width:ke(t,i),height:Re(t,i)};var r=S(t),o=n&&n.includes(\"SubProcessMarker\");i=o?{...i,seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:{...i,seq:-5,parallel:-6,compensation:-27,loop:0,adhoc:10},f(n,(function(n){Q(n,e,t,i)})),r.get(\"isForCompensation\")&&Q(\"CompensationMarker\",e,t,i),k(r,\"bpmn:AdHocSubProcess\")&&Q(\"AdhocMarker\",e,t,i);var a=r.get(\"loopCharacteristics\"),s=a&&a.get(\"isSequential\");a&&(void 0===s&&Q(\"LoopMarker\",e,t,i),!1===s&&Q(\"ParallelMarker\",e,t,i),!0===s&&Q(\"SequentialMarker\",e,t,i))}function ne(e,t,n={}){n=E({size:{width:100}},n);var i=o.createText(t||\"\",n);return G(i).add(\"djs-label\"),j(e,i),i}function ie(e,t,n,i={}){var r=S(t),o=Ae({x:t.x,y:t.y,width:t.width,height:t.height},i);return ne(e,r.name,{align:n,box:o,padding:7,style:{fill:_e(t,c,p,i.stroke)}})}function re(e,t,n,i={}){var r=P(n),o=ne(e,t,{box:{height:30,width:r?Re(n,i):ke(n,i)},align:\"center-middle\",style:{fill:_e(n,c,p,i.stroke)}});r&&nt(o,0,-(-1*Re(n,i)),270)}function oe(e,t,n={}){var{width:i,height:r}=Ae(t,n);return b(e,i,r,10,{...n,fill:we(t,l,n.fill),fillOpacity:st,stroke:Ee(t,p,n.stroke)})}function ae(e,t,n={}){var i=S(t),r=we(t,l,n.fill),o=Ee(t,p,n.stroke);return\"One\"!==i.get(\"associationDirection\")&&\"Both\"!==i.get(\"associationDirection\")||(n.markerEnd=v(\"association-end\",r,o)),\"Both\"===i.get(\"associationDirection\")&&(n.markerStart=v(\"association-start\",r,o)),n=pt(n,[\"markerStart\",\"markerEnd\"]),_(e,t.waypoints,{...n,stroke:o,strokeDasharray:\"0, 5\"})}function se(e,t,n={}){var r=we(t,l,n.fill),o=Ee(t,p,n.stroke),a=R(e,i.getScaledPath(\"DATA_OBJECT_PATH\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.474,my:.296}}),{fill:r,fillOpacity:st,stroke:o});(function(e){var t=e.dataObjectRef;return e.isCollection||t&&t.isCollection})(S(t))&&R(e,i.getScaledPath(\"DATA_OBJECT_COLLECTION_PATH\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:.33,my:(t.height-18)/t.height}}),{strokeWidth:2,fill:r,stroke:o});return a}function le(e,t,n={}){return x(e,t.width,t.height,{fillOpacity:st,...n,fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke)})}function pe(e,t,n={}){return function(e,t,n,i){var r=t/2,o=n/2,a=[{x:r,y:0},{x:t,y:o},{x:r,y:n},{x:0,y:o}].map((function(e){return e.x+\",\"+e.y})).join(\" \");i=m(i);var s=Z(\"polygon\",{...i,points:a});return j(e,s),s}(e,t.width,t.height,{fill:we(t,l,n.fill),fillOpacity:st,stroke:Ee(t,p,n.stroke)})}function ue(e,t,n={}){var i=b(e,ke(t,n),Re(t,n),0,{fill:we(t,l,n.fill),fillOpacity:n.fillOpacity||st,stroke:Ee(t,p,n.stroke),strokeWidth:1.5}),r=S(t);k(r,\"bpmn:Lane\")&&re(e,r.get(\"name\"),t,n);return i}function he(e,t,n={}){var i=oe(e,t,n);(function(e){return e&&!!S(e).triggeredByEvent})(t)&&z(i,{strokeDasharray:\"0, 5.5\",strokeWidth:2.5});var r=M(t);return ie(e,t,r?\"center-top\":\"center-middle\",n),ee(e,t,r?void 0:[\"SubProcessMarker\"],n),i}function fe(e,t,n={}){var i=oe(e,t,n);return ie(e,t,\"center-middle\",n),ee(e,t,void 0,n),i}var me=this.handlers={\"bpmn:AdHocSubProcess\":function(e,t,n={}){return he(e,t,n=M(t)?pt(n,[\"fill\",\"stroke\",\"width\",\"height\"]):pt(n,[\"fill\",\"stroke\"]))},\"bpmn:Association\":function(e,t,n={}){return ae(e,t,n=pt(n,[\"fill\",\"stroke\"]))},\"bpmn:BoundaryEvent\":function(e,t,n={}){var{renderIcon:i=!0}=n;n=pt(n,[\"fill\",\"stroke\"]);var r=S(t).get(\"cancelActivity\");n={strokeWidth:1.5,fill:we(t,l,n.fill),fillOpacity:1,stroke:Ee(t,p,n.stroke)},r||(n.strokeDasharray=\"6\");var o=le(e,t,n);return x(e,t.width,t.height,3,{...n,fill:\"none\"}),i&&X(t,e,n),o},\"bpmn:BusinessRuleTask\":function(e,t,n={}){var r=fe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return z(R(e,i.getScaledPath(\"TASK_TYPE_BUSINESS_RULE_MAIN\",{abspos:{x:8,y:8}})),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1}),z(R(e,i.getScaledPath(\"TASK_TYPE_BUSINESS_RULE_HEADER\",{abspos:{x:8,y:8}})),{fill:Ee(t,p,n.stroke),stroke:Ee(t,p,n.stroke),strokeWidth:1}),r},\"bpmn:CallActivity\":function(e,t,n={}){return n=pt(n,[\"fill\",\"stroke\"]),he(e,t,{strokeWidth:5,...n})},\"bpmn:ComplexGateway\":function(e,t,n={}){var r=pe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return R(e,i.getScaledPath(\"GATEWAY_COMPLEX\",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:t.width,containerHeight:t.height,position:{mx:.46,my:.26}}),{fill:Ee(t,p,n.stroke),stroke:Ee(t,p,n.stroke),strokeWidth:1}),r},\"bpmn:DataInput\":function(e,t,n={}){n=pt(n,[\"fill\",\"stroke\"]);var r=i.getRawPath(\"DATA_ARROW\"),o=se(e,t,n);return R(e,r,{fill:\"none\",stroke:Ee(t,p,n.stroke),strokeWidth:1}),o},\"bpmn:DataInputAssociation\":function(e,t,n={}){return n=pt(n,[\"fill\",\"stroke\"]),ae(e,t,{...n,markerEnd:v(\"association-end\",we(t,l,n.fill),Ee(t,p,n.stroke))})},\"bpmn:DataObject\":function(e,t,n={}){return se(e,t,n=pt(n,[\"fill\",\"stroke\"]))},\"bpmn:DataObjectReference\":T(\"bpmn:DataObject\"),\"bpmn:DataOutput\":function(e,t,n={}){n=pt(n,[\"fill\",\"stroke\"]);var r=i.getRawPath(\"DATA_ARROW\"),o=se(e,t,n);return R(e,r,{strokeWidth:1,fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke)}),o},\"bpmn:DataOutputAssociation\":function(e,t,n={}){return n=pt(n,[\"fill\",\"stroke\"]),ae(e,t,{...n,markerEnd:v(\"association-end\",we(t,l,n.fill),Ee(t,p,n.stroke))})},\"bpmn:DataStoreReference\":function(e,t,n={}){return n=pt(n,[\"fill\",\"stroke\"]),R(e,i.getScaledPath(\"DATA_STORE\",{xScaleFactor:1,yScaleFactor:1,containerWidth:t.width,containerHeight:t.height,position:{mx:0,my:.133}}),{fill:we(t,l,n.fill),fillOpacity:st,stroke:Ee(t,p,n.stroke),strokeWidth:2})},\"bpmn:EndEvent\":function(e,t,n={}){var{renderIcon:i=!0}=n;n=pt(n,[\"fill\",\"stroke\"]);var r=le(e,t,{...n,strokeWidth:4});return i&&X(t,e,n),r},\"bpmn:EventBasedGateway\":function(e,t,n={}){n=pt(n,[\"fill\",\"stroke\"]);var r=S(t),o=pe(e,t,n);x(e,t.width,t.height,.2*t.height,{fill:we(t,\"none\",n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1});var a=r.get(\"eventGatewayType\"),s=!!r.get(\"instantiate\");if(\"Parallel\"===a){var l=i.getScaledPath(\"GATEWAY_PARALLEL\",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:t.width,containerHeight:t.height,position:{mx:.474,my:.296}});R(e,l,{fill:\"none\",stroke:Ee(t,p,n.stroke),strokeWidth:1})}else\"Exclusive\"===a&&(s||x(e,t.width,t.height,.26*t.height,{fill:\"none\",stroke:Ee(t,p,n.stroke),strokeWidth:1}),function(){var r=i.getScaledPath(\"GATEWAY_EVENT_BASED\",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:t.width,containerHeight:t.height,position:{mx:.36,my:.44}});R(e,r,{fill:\"none\",stroke:Ee(t,p,n.stroke),strokeWidth:2})}());return o},\"bpmn:ExclusiveGateway\":function(e,t,n={}){var r=pe(e,t,n=pt(n,[\"fill\",\"stroke\"])),o=i.getScaledPath(\"GATEWAY_EXCLUSIVE\",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:t.width,containerHeight:t.height,position:{mx:.32,my:.3}});return C(t).get(\"isMarkerVisible\")&&R(e,o,{fill:Ee(t,p,n.stroke),stroke:Ee(t,p,n.stroke),strokeWidth:1}),r},\"bpmn:Gateway\":function(e,t,n={}){return pe(e,t,n=pt(n,[\"fill\",\"stroke\"]))},\"bpmn:Group\":function(e,t,n={}){return n=pt(n,[\"fill\",\"stroke\",\"width\",\"height\"]),b(e,t.width,t.height,10,{stroke:Ee(t,p,n.stroke),strokeWidth:1.5,strokeDasharray:\"10, 6, 0, 6\",fill:\"none\",pointerEvents:\"none\",width:ke(t,n),height:Re(t,n)})},\"bpmn:InclusiveGateway\":function(e,t,n={}){var i=pe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return x(e,t.width,t.height,.24*t.height,{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:2.5}),i},\"bpmn:IntermediateEvent\":function(e,t,n={}){var{renderIcon:i=!0}=n;n=pt(n,[\"fill\",\"stroke\"]);var r=le(e,t,{...n,strokeWidth:1.5});return x(e,t.width,t.height,3,{fill:\"none\",stroke:Ee(t,p,n.stroke),strokeWidth:1.5}),i&&X(t,e,n),r},\"bpmn:IntermediateCatchEvent\":T(\"bpmn:IntermediateEvent\"),\"bpmn:IntermediateThrowEvent\":T(\"bpmn:IntermediateEvent\"),\"bpmn:Lane\":function(e,t,n={}){return n=pt(n,[\"fill\",\"stroke\",\"width\",\"height\"]),ue(e,t,{...n,fillOpacity:.25})},\"bpmn:ManualTask\":function(e,t,n={}){var r=fe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return R(e,i.getScaledPath(\"TASK_TYPE_MANUAL\",{abspos:{x:17,y:15}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:.5}),r},\"bpmn:MessageFlow\":function(e,t,n={}){n=pt(n,[\"fill\",\"stroke\"]);var r=S(t),o=C(t),a=we(t,l,n.fill),s=Ee(t,p,n.stroke),c=_(e,t.waypoints,{markerEnd:v(\"messageflow-end\",a,s),markerStart:v(\"messageflow-start\",a,s),stroke:s,strokeDasharray:\"10, 11\",strokeWidth:1.5});if(r.get(\"messageRef\")){var u=c.getPointAtLength(c.getTotalLength()/2),h=i.getScaledPath(\"MESSAGE_FLOW_MARKER\",{abspos:{x:u.x,y:u.y}}),f={strokeWidth:1};\"initiating\"===o.get(\"messageVisibleKind\")?(f.fill=a,f.stroke=s):(f.fill=s,f.stroke=a);var m=R(e,h,f),d=ne(e,r.get(\"messageRef\").get(\"name\"),{align:\"center-top\",fitBox:!0,style:{fill:s}}),y=m.getBBox(),g=d.getBBox();nt(d,u.x-g.width/2,u.y+y.height/2+10,0)}return c},\"bpmn:ParallelGateway\":function(e,t,n={}){var r=pe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return R(e,i.getScaledPath(\"GATEWAY_PARALLEL\",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:t.width,containerHeight:t.height,position:{mx:.46,my:.2}}),{fill:Ee(t,p,n.stroke),stroke:Ee(t,p,n.stroke),strokeWidth:1}),r},\"bpmn:Participant\":function(e,t,n={}){var i=ue(e,t,n=pt(n,[\"fill\",\"stroke\",\"width\",\"height\"])),r=M(t),o=P(t),a=S(t),s=a.get(\"name\");if(r){w(e,o?[{x:30,y:0},{x:30,y:Re(t,n)}]:[{x:0,y:30},{x:ke(t,n),y:30}],{stroke:Ee(t,p,n.stroke),strokeWidth:1.5}),re(e,s,t,n)}else{var l=Ae(t,n);o||(l.height=ke(t,n),l.width=Re(t,n));var u=ne(e,s,{box:l,align:\"center-middle\",style:{fill:_e(t,c,p,n.stroke)}});if(!o)nt(u,0,-(-1*Re(t,n)),270)}return a.get(\"participantMultiplicity\")&&Q(\"ParticipantMultiplicityMarker\",e,t,n),i},\"bpmn:ReceiveTask\":function(e,t,n={}){n=pt(n,[\"fill\",\"stroke\"]);var r,o=S(t),a=fe(e,t,n);return o.get(\"instantiate\")?(x(e,28,28,4.4,{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1}),r=i.getScaledPath(\"TASK_TYPE_INSTANTIATING_SEND\",{abspos:{x:7.77,y:9.52}})):r=i.getScaledPath(\"TASK_TYPE_SEND\",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}}),R(e,r,{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1}),a},\"bpmn:ScriptTask\":function(e,t,n={}){var r=fe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return R(e,i.getScaledPath(\"TASK_TYPE_SCRIPT\",{abspos:{x:15,y:20}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1}),r},\"bpmn:SendTask\":function(e,t,n={}){var r=fe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return R(e,i.getScaledPath(\"TASK_TYPE_SEND\",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}}),{fill:Ee(t,p,n.stroke),stroke:we(t,l,n.fill),strokeWidth:1}),r},\"bpmn:SequenceFlow\":function(e,t,n={}){n=pt(n,[\"fill\",\"stroke\"]);var i=we(t,l,n.fill),r=Ee(t,p,n.stroke),o=_(e,t.waypoints,{markerEnd:v(\"sequenceflow-end\",i,r),stroke:r}),a=S(t),{source:s}=t;if(s){var c=S(s);a.get(\"conditionExpression\")&&k(c,\"bpmn:Activity\")&&z(o,{markerStart:v(\"conditional-flow-marker\",i,r)}),c.get(\"default\")&&(k(c,\"bpmn:Gateway\")||k(c,\"bpmn:Activity\"))&&c.get(\"default\")===a&&z(o,{markerStart:v(\"conditional-default-flow-marker\",i,r)})}return o},\"bpmn:ServiceTask\":function(e,t,n={}){var r=fe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return x(e,10,10,{fill:we(t,l,n.fill),stroke:\"none\",transform:\"translate(6, 6)\"}),R(e,i.getScaledPath(\"TASK_TYPE_SERVICE\",{abspos:{x:12,y:18}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1}),x(e,10,10,{fill:we(t,l,n.fill),stroke:\"none\",transform:\"translate(11, 10)\"}),R(e,i.getScaledPath(\"TASK_TYPE_SERVICE\",{abspos:{x:17,y:22}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:1}),r},\"bpmn:StartEvent\":function(e,t,n={}){var{renderIcon:i=!0}=n;n=pt(n,[\"fill\",\"stroke\"]),S(t).get(\"isInterrupting\")||(n={...n,strokeDasharray:\"6\"});var r=le(e,t,n);return i&&X(t,e,n),r},\"bpmn:SubProcess\":function(e,t,n={}){return he(e,t,n=M(t)?pt(n,[\"fill\",\"stroke\",\"width\",\"height\"]):pt(n,[\"fill\",\"stroke\"]))},\"bpmn:Task\":function(e,t,n={}){return fe(e,t,n=pt(n,[\"fill\",\"stroke\"]))},\"bpmn:TextAnnotation\":function(e,t,n={}){n=pt(n,[\"fill\",\"stroke\",\"width\",\"height\"]);var{width:r,height:o}=Ae(t,n),a=b(e,r,o,0,0,{fill:\"none\",stroke:\"none\"});return R(e,i.getScaledPath(\"TEXT_ANNOTATION\",{xScaleFactor:1,yScaleFactor:1,containerWidth:r,containerHeight:o,position:{mx:0,my:0}}),{stroke:Ee(t,p,n.stroke)}),ne(e,S(t).get(\"text\")||\"\",{align:\"left-top\",box:Ae(t,n),padding:7,style:{fill:_e(t,c,p,n.stroke)}}),a},\"bpmn:Transaction\":function(e,t,i={}){i=M(t)?pt(i,[\"fill\",\"stroke\",\"width\",\"height\"]):pt(i,[\"fill\",\"stroke\"]);var r=he(e,t,{strokeWidth:1.5,...i}),o=n.style([\"no-fill\",\"no-events\"],{stroke:Ee(t,p,i.stroke),strokeWidth:1.5});return M(t)||(i={}),b(e,ke(t,i),Re(t,i),7,3,o),r},\"bpmn:UserTask\":function(e,t,n={}){var r=fe(e,t,n=pt(n,[\"fill\",\"stroke\"]));return R(e,i.getScaledPath(\"TASK_TYPE_USER_1\",{abspos:{x:15,y:12}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:.5}),R(e,i.getScaledPath(\"TASK_TYPE_USER_2\",{abspos:{x:15,y:12}}),{fill:we(t,l,n.fill),stroke:Ee(t,p,n.stroke),strokeWidth:.5}),R(e,i.getScaledPath(\"TASK_TYPE_USER_3\",{abspos:{x:15,y:12}}),{fill:Ee(t,p,n.stroke),stroke:Ee(t,p,n.stroke),strokeWidth:.5}),r},label:function(e,t,n={}){return function(e,t,n={}){var i={width:90,height:30,x:t.width/2+t.x,y:t.height/2+t.y};return ne(e,L(t),{box:i,fitBox:!0,style:E({},o.getExternalStyle(),{fill:_e(t,c,p,n.stroke)})})}(e,t,n)}};this._drawPath=R,this._renderer=N}function pt(e,t=[]){return t.reduce(((t,n)=>(e[n]&&(t[n]=e[n]),t)),{})}e(lt,A),lt.$inject=[\"config.bpmnRenderer\",\"eventBus\",\"styles\",\"pathMap\",\"canvas\",\"textRenderer\"],lt.prototype.canRender=function(e){return k(e,\"bpmn:BaseElement\")},lt.prototype.drawShape=function(e,t,n={}){var{type:i}=t;return this._renderer(i)(e,t,n)},lt.prototype.drawConnection=function(e,t,n={}){var{type:i}=t;return this._renderer(i)(e,t,n)},lt.prototype.getShapePath=function(e){return k(e,\"bpmn:Event\")?(n=(t=e).x+t.width/2,i=t.y+t.height/2,r=t.width/2,ue([[\"M\",n,i],[\"m\",0,-r],[\"a\",r,r,0,1,1,0,2*r],[\"a\",r,r,0,1,1,0,-2*r],[\"z\"]])):k(e,\"bpmn:Activity\")?function(e,t){var n=e.x,i=e.y,r=e.width,o=e.height;return ue([[\"M\",n+t,i],[\"l\",r-2*t,0],[\"a\",t,t,0,0,1,t,t],[\"l\",0,o-2*t],[\"a\",t,t,0,0,1,-t,t],[\"l\",2*t-r,0],[\"a\",t,t,0,0,1,-t,-t],[\"l\",0,2*t-o],[\"a\",t,t,0,0,1,t,-t],[\"z\"]])}(e,10):k(e,\"bpmn:Gateway\")?function(e){var t=e.width/2,n=e.height/2;return ue([[\"M\",e.x+t,e.y],[\"l\",t,n],[\"l\",-t,n],[\"l\",-t,-n],[\"z\"]])}(e):function(e){var t=e.x,n=e.y,i=e.width;return ue([[\"M\",t,n],[\"l\",i,0],[\"l\",0,e.height],[\"l\",-i,0],[\"z\"]])}(e);var t,n,i,r};var ct=0,ut={width:150,height:50};function ht(e,t){var n;t.textContent=e;try{var i,r=\"\"===e;return t.textContent=r?\"dummy\":e,i={width:(n=t.getBBox()).width+2*n.x,height:n.height},r&&(i.width=0),i}catch(e){return{width:0,height:0}}}function ft(e,t,n){for(var i,r=e.shift(),o=r;;){if((i=ht(o,n)).width=o?i.width:0,\" \"===o||\"\"===o||i.width<Math.round(t)||o.length<2)return mt(e,o,r,i);o=yt(o,i.width,t)}}function mt(e,t,n,i){if(t.length<n.length){var r=n.slice(t.length).trim();e.unshift(r)}return{width:i.width,height:i.height,text:t}}var dt=\"­\";function yt(e,t,n){var i=Math.max(e.length*(n/t),1),r=function(e,t){var n,i=e.split(/(\\s|-|\\u00AD)/g),r=[],o=0;if(i.length>1)for(;n=i.shift();){if(!(n.length+o<t)){\"-\"!==n&&n!==dt||r.pop();break}r.push(n),o+=n.length}var a=r[r.length-1];return a&&a===dt&&(r[r.length-1]=\"-\"),r.join(\"\")}(e,i);return r||(r=e.slice(0,Math.max(Math.round(i-1),1))),r}function gt(e){this._config=E({},{size:ut,padding:ct,style:{},align:\"center-top\"},e||{})}gt.prototype.createText=function(e,t){return this.layoutText(e,t).element},gt.prototype.getDimensions=function(e,t){return this.layoutText(e,t).dimensions},gt.prototype.layoutText=function(e,t){var n=E({},this._config.size,t.box),i=E({},this._config.style,t.style),r=function(e){var t=e.split(\"-\");return{horizontal:t[0]||\"center\",vertical:t[1]||\"top\"}}(t.align||this._config.align),o=function(e){return a(e)?E({top:0,left:0,right:0,bottom:0},e):{top:e,left:e,right:e,bottom:e}}(void 0!==t.padding?t.padding:this._config.padding),s=t.fitBox||!1,l=function(e){if(\"fontSize\"in e&&\"lineHeight\"in e)return e.lineHeight*parseInt(e.fontSize,10)}(i),p=e.split(/\\u00AD?\\r?\\n/),c=[],u=n.width-o.left-o.right,h=Z(\"text\");for(z(h,{x:0,y:0}),z(h,i),j(function(){var e=document.getElementById(\"helper-svg\");return e||(z(e=Z(\"svg\"),{id:\"helper-svg\"}),Oe(e,{visibility:\"hidden\",position:\"fixed\",width:0,height:0}),document.body.appendChild(e)),e}(),h);p.length;)c.push(ft(p,u,h));\"middle\"===r.vertical&&(o.top=o.bottom=0);var d=m(c,(function(e,t,n){return e+(l||t.height)}),0)+o.top+o.bottom,y=m(c,(function(e,t,n){return t.width>e?t.width:e}),0),g=o.top;\"middle\"===r.vertical&&(g+=(n.height-d)/2),g-=(l||c[0].height)/4;var v=Z(\"text\");return z(v,i),f(c,(function(e){var t;switch(g+=l||e.height,r.horizontal){case\"left\":t=o.left;break;case\"right\":t=(s?y:u)-o.right-e.width;break;default:t=Math.max(((s?y:u)-e.width)/2+o.left,0)}var n=Z(\"tspan\");z(n,{x:t,y:g}),n.textContent=e.text,j(v,n)})),K(h),{dimensions:{width:y,height:d},element:v}};function vt(e){var t=E({fontFamily:\"Arial, sans-serif\",fontSize:12,fontWeight:\"normal\",lineHeight:1.2},e&&e.defaultStyle||{}),n=parseInt(t.fontSize,10)-1,i=E({},t,{fontSize:n},e&&e.externalStyle||{}),r=new gt({style:t});this.getExternalLabelBounds=function(e,t){var n=r.getDimensions(t,{box:{width:90,height:30},style:i});return{x:Math.round(e.x+e.width/2-n.width/2),y:Math.round(e.y),width:Math.ceil(n.width),height:Math.ceil(n.height)}},this.getTextAnnotationBounds=function(e,n){var i=r.getDimensions(n,{box:e,style:t,align:\"left-top\",padding:5});return{x:e.x,y:e.y,width:e.width,height:Math.max(30,Math.round(i.height))}},this.createText=function(e,t){return r.createText(e,t||{})},this.getDefaultStyle=function(){return t},this.getExternalStyle=function(){return i}}vt.$inject=[\"config.textRenderer\"];var xt=/\\{([^{}]+)\\}/g,bt=/(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[('|\")(.+?)\\2\\])(\\(\\))?/g;var wt={__init__:[\"bpmnRenderer\"],bpmnRenderer:[\"type\",lt],textRenderer:[\"type\",vt],pathMap:[\"type\",function(){this.pathMap={EVENT_MESSAGE:{d:\"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}\",height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},EVENT_SIGNAL:{d:\"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z\",height:36,width:36,heightElements:[18],widthElements:[10,20]},EVENT_ESCALATION:{d:\"M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z\",height:36,width:36,heightElements:[20,7],widthElements:[8]},EVENT_CONDITIONAL:{d:\"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 \",height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},EVENT_LINK:{d:\"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z\",height:36,width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},EVENT_ERROR:{d:\"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z\",height:36,width:36,heightElements:[.023,8.737,8.151,16.564,10.591,8.714],widthElements:[.085,6.672,6.97,4.273,5.337,6.636]},EVENT_CANCEL_45:{d:\"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z\",height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},EVENT_COMPENSATION:{d:\"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z\",height:36,width:36,heightElements:[6.5,13,.4,6.1],widthElements:[9,9.3,8.7]},EVENT_TIMER_WH:{d:\"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} \",height:36,width:36,heightElements:[10,2],widthElements:[3,7]},EVENT_TIMER_LINE:{d:\"M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} \",height:36,width:36,heightElements:[10,3],widthElements:[0,0]},EVENT_MULTIPLE:{d:\"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z\",height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},EVENT_PARALLEL_MULTIPLE:{d:\"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z\",height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},GATEWAY_EXCLUSIVE:{d:\"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z\",height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},GATEWAY_PARALLEL:{d:\"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z\",height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},GATEWAY_EVENT_BASED:{d:\"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z\",height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},GATEWAY_COMPLEX:{d:\"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z\",height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},DATA_OBJECT_PATH:{d:\"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0\",height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},DATA_OBJECT_COLLECTION_PATH:{d:\"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10\",height:10,width:10,heightElements:[],widthElements:[]},DATA_ARROW:{d:\"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z\",height:61,width:51,heightElements:[],widthElements:[]},DATA_STORE:{d:\"m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0\",height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},TEXT_ANNOTATION:{d:\"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0\",height:30,width:10,heightElements:[30],widthElements:[10]},MARKER_SUB_PROCESS:{d:\"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0\",height:10,width:10,heightElements:[],widthElements:[]},MARKER_PARALLEL:{d:\"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10\",height:10,width:10,heightElements:[],widthElements:[]},MARKER_SEQUENTIAL:{d:\"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0\",height:10,width:10,heightElements:[],widthElements:[]},MARKER_COMPENSATION:{d:\"m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z\",height:10,width:21,heightElements:[],widthElements:[]},MARKER_LOOP:{d:\"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902\",height:13.9,width:13.7,heightElements:[],widthElements:[]},MARKER_ADHOC:{d:\"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z\",height:4,width:15,heightElements:[],widthElements:[]},TASK_TYPE_SEND:{d:\"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}\",height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_SCRIPT:{d:\"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0\",height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_USER_1:{d:\"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5\"},TASK_TYPE_USER_2:{d:\"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 \"},TASK_TYPE_USER_3:{d:\"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z\"},TASK_TYPE_MANUAL:{d:\"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z\"},TASK_TYPE_INSTANTIATING_SEND:{d:\"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6\"},TASK_TYPE_SERVICE:{d:\"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z\"},TASK_TYPE_SERVICE_FILL:{d:\"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z\"},TASK_TYPE_BUSINESS_RULE_HEADER:{d:\"m {mx},{my} 0,4 20,0 0,-4 z\"},TASK_TYPE_BUSINESS_RULE_MAIN:{d:\"m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8\"},MESSAGE_FLOW_MARKER:{d:\"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6\"}},this.getRawPath=function(e){return this.pathMap[e].d},this.getScaledPath=function(e,t){var n,i,r=this.pathMap[e];t.abspos?(n=t.abspos.x,i=t.abspos.y):(n=t.containerWidth*t.position.mx,i=t.containerHeight*t.position.my);var o={};if(t.position){for(var a=t.containerHeight/r.height*t.yScaleFactor,s=t.containerWidth/r.width*t.xScaleFactor,l=0;l<r.heightElements.length;l++)o[\"y\"+l]=r.heightElements[l]*a;for(var p=0;p<r.widthElements.length;p++)o[\"x\"+p]=r.widthElements[p]*s}var c,u,h=(c=r.d,u={mx:n,my:i,e:o},String(c).replace(xt,(function(e,t){return function(e,t,n){var i=n;return t.replace(bt,(function(e,t,n,r,o){t=t||r,i&&(t in i&&(i=i[t]),\"function\"==typeof i&&o&&(i=i()))})),i=(null==i||i==n?e:i)+\"\"}(e,t,u)})));return h}}]};var Et={translate:[\"value\",function(e,t){return t=t||{},e.replace(/{([^}]+)}/g,(function(e,n){return t[n]||\"{\"+n+\"}\"}))}]};function _t(e){return{top:e.y,right:e.x+(e.width||0),bottom:e.y+(e.height||0),left:e.x}}function At(e){return t={x:e.x+(e.width||0)/2,y:e.y+(e.height||0)/2},{x:Math.round(t.x),y:Math.round(t.y)};var t}function kt(e){for(var t=e.waypoints,n=t.reduce((function(e,n,i){var r,o,a=t[i-1];if(a){var s=e[e.length-1],l=s&&s.endLength||0,p=(r=a,o=n,Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)));e.push({start:a,end:n,startLength:l,endLength:l+p,length:p})}return e}),[]),i=n.reduce((function(e,t){return e+t.length}),0),r=i/2,o=0,a=n[o];a.endLength<r;)a=n[++o];var s=(r-a.startLength)/a.length;return{x:a.start.x+(a.end.x-a.start.x)*s,y:a.start.y+(a.end.y-a.start.y)*s}}function Rt(e){return a(t=e)&&c(t,\"waypoints\")?kt(e):At(e);var t}function St(e){return e?\"<\"+e.$type+(e.id?' id=\"'+e.id:\"\")+'\" />':\"<null>\"}function Ct(e,t,n){return E({id:e.id,type:e.$type,businessObject:e,di:t},n)}function Mt(e,t,n){var i=e.waypoint;return!i||i.length<2?[Rt(t),Rt(n)]:i.map((function(e){return{x:e.x,y:e.y}}))}function Pt(e,t,n){return new Error(`element ${St(t)} referenced by ${St(e)}#${n} not yet drawn`)}function Dt(e,t,n,i,r){this._eventBus=e,this._canvas=t,this._elementFactory=n,this._elementRegistry=i,this._textRenderer=r}Dt.$inject=[\"eventBus\",\"canvas\",\"elementFactory\",\"elementRegistry\",\"textRenderer\"],Dt.prototype.add=function(e,t,n){var i,r,o,a,s,l,p;if(k(t,\"bpmndi:BPMNPlane\")){var c=k(e,\"bpmn:SubProcess\")?{id:e.id+\"_plane\"}:{};i=this._elementFactory.createRoot(Ct(e,t,c)),this._canvas.addRootElement(i)}else if(k(t,\"bpmndi:BPMNShape\")){var u=!M(e,t),h=function(e){return k(e,\"bpmn:Group\")}(e);r=n&&(n.hidden||n.collapsed);var f=t.bounds;i=this._elementFactory.createShape(Ct(e,t,{collapsed:u,hidden:r,x:Math.round(f.x),y:Math.round(f.y),width:Math.round(f.width),height:Math.round(f.height),isFrame:h})),k(e,\"bpmn:BoundaryEvent\")&&this._attachBoundary(e,i),k(e,\"bpmn:Lane\")&&(o=0),k(e,\"bpmn:DataStoreReference\")&&(a=n,s=Rt(f),l=s.x,p=s.y,l>=a.x&&l<=a.x+a.width&&p>=a.y&&p<=a.y+a.height||(n=this._canvas.findRoot(n))),this._canvas.addShape(i,n,o)}else{if(!k(t,\"bpmndi:BPMNEdge\"))throw new Error(`unknown di ${St(t)} for element ${St(e)}`);var m=this._getSource(e),d=this._getTarget(e);r=n&&(n.hidden||n.collapsed),i=this._elementFactory.createConnection(Ct(e,t,{hidden:r,source:m,target:d,waypoints:Mt(t,m,d)})),k(e,\"bpmn:DataAssociation\")&&(n=this._canvas.findRoot(n)),this._canvas.addConnection(i,n,o)}return function(e){return k(e,\"bpmn:Event\")||k(e,\"bpmn:Gateway\")||k(e,\"bpmn:DataStoreReference\")||k(e,\"bpmn:DataObjectReference\")||k(e,\"bpmn:DataInput\")||k(e,\"bpmn:DataOutput\")||k(e,\"bpmn:SequenceFlow\")||k(e,\"bpmn:MessageFlow\")||k(e,\"bpmn:Group\")}(e)&&L(i)&&this.addLabel(e,t,i),this._eventBus.fire(\"bpmnElement.added\",{element:i}),i},Dt.prototype._attachBoundary=function(e,t){var n=e.attachedToRef;if(!n)throw new Error(`missing ${St(e)}#attachedToRef`);var i=this._elementRegistry.get(n.id),r=i&&i.attachers;if(!i)throw Pt(e,n,\"attachedToRef\");t.host=i,r||(i.attachers=r=[]),-1===r.indexOf(t)&&r.push(t)},Dt.prototype.addLabel=function(e,t,n){var i,r,o;return i=B(t,n),(r=L(n))&&(i=this._textRenderer.getExternalLabelBounds(i,r)),o=this._elementFactory.createLabel(Ct(e,t,{id:e.id+\"_label\",labelTarget:n,type:\"label\",hidden:n.hidden||!L(n),x:Math.round(i.x),y:Math.round(i.y),width:Math.round(i.width),height:Math.round(i.height)})),this._canvas.addShape(o,n.parent)},Dt.prototype._getConnectedElement=function(e,t){var n,i,r=e.$type;if(i=e[t+\"Ref\"],\"source\"===t&&\"bpmn:DataInputAssociation\"===r&&(i=i&&i[0]),(\"source\"===t&&\"bpmn:DataOutputAssociation\"===r||\"target\"===t&&\"bpmn:DataInputAssociation\"===r)&&(i=e.$parent),n=i&&this._getElement(i))return n;throw i?Pt(e,i,t+\"Ref\"):new Error(`${St(e)}#${t} Ref not specified`)},Dt.prototype._getSource=function(e){return this._getConnectedElement(e,\"source\")},Dt.prototype._getTarget=function(e){return this._getConnectedElement(e,\"target\")},Dt.prototype._getElement=function(e){return this._elementRegistry.get(e.id)};var Nt={__depends__:[wt,{__depends__:[Et],bpmnImporter:[\"type\",Dt]}]};function Tt(e,t){var n,i,r,a;return t=!!t,o(e)||(e=[e]),f(e,(function(e){var o=e;e.waypoints&&!t&&(o=Tt(e.waypoints,!0));var s=o.x,l=o.y,p=o.height||0,c=o.width||0;(s<n||void 0===n)&&(n=s),(l<i||void 0===i)&&(i=l),(s+c>r||void 0===r)&&(r=s+c),(l+p>a||void 0===a)&&(a=l+p)})),{x:n,y:i,height:a-i,width:r-n}}function Ot(e){return\"waypoints\"in e?\"connection\":\"x\"in e?\"shape\":\"root\"}function Bt(e){return!(!e||!e.isFrame)}function Lt(e){this._counter=0,this._prefix=(e?e+\"-\":\"\")+Math.floor(1e9*Math.random())+\"-\"}Lt.prototype.next=function(){return this._prefix+ ++this._counter};var It=new Lt(\"ov\");function jt(e,t,n,i){var r,o;this._eventBus=t,this._canvas=n,this._elementRegistry=i,this._ids=It,this._overlayDefaults=E({show:null,scale:!0},e&&e.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=(r=n.getContainer(),Oe(o=Qe('<div class=\"djs-overlay-container\" />'),{position:\"absolute\",width:0,height:0}),r.insertBefore(o,r.firstChild),o),this._init()}function Ft(e,t,n){Oe(e,{left:t+\"px\",top:n+\"px\"})}function Vt(e,t){e.style.display=!1===t?\"none\":\"\"}function Wt(e,t){e.style[\"transform-origin\"]=\"top left\",[\"\",\"-ms-\",\"-webkit-\"].forEach((function(n){e.style[n+\"transform\"]=t}))}jt.$inject=[\"config.overlays\",\"eventBus\",\"canvas\",\"elementRegistry\"],jt.prototype.get=function(e){if(p(e)&&(e={id:e}),p(e.element)&&(e.element=this._elementRegistry.get(e.element)),e.element){var t=this._getOverlayContainer(e.element,!0);return t?e.type?h(t.overlays,g({type:e.type})):t.overlays.slice():[]}return e.type?h(this._overlays,g({type:e.type})):e.id?this._overlays[e.id]:null},jt.prototype.add=function(e,t,n){if(a(t)&&(n=t,t=null),e.id||(e=this._elementRegistry.get(e)),!n.position)throw new Error(\"must specifiy overlay position\");if(!n.html)throw new Error(\"must specifiy overlay html\");if(!e)throw new Error(\"invalid element specified\");var i=this._ids.next();return n=E({},this._overlayDefaults,n,{id:i,type:t,element:e,html:n.html}),this._addOverlay(n),i},jt.prototype.remove=function(e){var t=this.get(e)||[];o(t)||(t=[t]);var n=this;f(t,(function(e){var t=n._getOverlayContainer(e.element,!0);if(e&&(tt(e.html),tt(e.htmlContainer),delete e.htmlContainer,delete e.element,delete n._overlays[e.id]),t){var i=t.overlays.indexOf(e);-1!==i&&t.overlays.splice(i,1)}}))},jt.prototype.isShown=function(){return\"none\"!==this._overlayRoot.style.display},jt.prototype.show=function(){Vt(this._overlayRoot)},jt.prototype.hide=function(){Vt(this._overlayRoot,!1)},jt.prototype.clear=function(){this._overlays={},this._overlayContainers=[],je(this._overlayRoot)},jt.prototype._updateOverlayContainer=function(e){var t=e.element,n=e.html,i=t.x,r=t.y;if(t.waypoints){var o=Tt(t);i=o.x,r=o.y}Ft(n,i,r),function(e,t,n){2==arguments.length?e.getAttribute(t):null===n?e.removeAttribute(t):e.setAttribute(t,n)}(e.html,\"data-container-id\",t.id)},jt.prototype._updateOverlay=function(e){var t,n,i=e.position,r=e.htmlContainer,o=e.element,a=i.left,s=i.top;void 0!==i.right&&(t=o.waypoints?Tt(o).width:o.width,a=-1*i.right+t);void 0!==i.bottom&&(n=o.waypoints?Tt(o).height:o.height,s=-1*i.bottom+n);Ft(r,a||0,s||0),this._updateOverlayVisibilty(e,this._canvas.viewbox())},jt.prototype._createOverlayContainer=function(e){var t=Qe('<div class=\"djs-overlays\" />');Oe(t,{position:\"absolute\"}),this._overlayRoot.appendChild(t);var n={html:t,element:e,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n},jt.prototype._updateRoot=function(e){var t=e.scale||1,n=\"matrix(\"+[t,0,0,t,-1*e.x*t,-1*e.y*t].join(\",\")+\")\";Wt(this._overlayRoot,n)},jt.prototype._getOverlayContainer=function(e,t){var n=u(this._overlayContainers,(function(t){return t.element===e}));return n||t?n:this._createOverlayContainer(e)},jt.prototype._addOverlay=function(e){var t,n,i=e.id,r=e.element,o=e.html;o.get&&o.constructor.prototype.jquery&&(o=o.get(0)),p(o)&&(o=Qe(o)),n=this._getOverlayContainer(r),Oe(t=Qe('<div class=\"djs-overlay\" data-overlay-id=\"'+i+'\">'),{position:\"absolute\"}),t.appendChild(o),e.type&&Le(t).add(\"djs-overlay-\"+e.type),Vt(t,this._canvas.findRoot(r)===this._canvas.getRootElement()),e.htmlContainer=t,n.overlays.push(e),n.html.appendChild(t),this._overlays[i]=e,this._updateOverlay(e),this._updateOverlayVisibilty(e,this._canvas.viewbox())},jt.prototype._updateOverlayVisibilty=function(e,t){var n=e.show,i=this._canvas.findRoot(e.element),o=n&&n.minZoom,a=n&&n.maxZoom,s=e.htmlContainer,l=!0;(i!==this._canvas.getRootElement()||n&&(r(o)&&o>t.scale||r(a)&&a<t.scale))&&(l=!1),Vt(s,l),this._updateOverlayScale(e,t)},jt.prototype._updateOverlayScale=function(e,t){var n,i,o,a=e.scale,s=e.htmlContainer,l=\"\";!0!==a&&(!1===a?(n=1,i=1):(n=a.min,i=a.max),r(n)&&t.scale<n&&(o=(1/t.scale||1)*n),r(i)&&t.scale>i&&(o=(1/t.scale||1)*i)),r(o)&&(l=\"scale(\"+o+\",\"+o+\")\"),Wt(s,l)},jt.prototype._updateOverlaysVisibilty=function(e){var t=this;f(this._overlays,(function(n){t._updateOverlayVisibilty(n,e)}))},jt.prototype._init=function(){var e=this._eventBus,t=this;e.on(\"canvas.viewbox.changing\",(function(e){t.hide()})),e.on(\"canvas.viewbox.changed\",(function(e){var n;n=e.viewbox,t._updateRoot(n),t._updateOverlaysVisibilty(n),t.show()})),e.on([\"shape.remove\",\"connection.remove\"],(function(e){var n=e.element;f(t.get({element:n}),(function(e){t.remove(e.id)}));var i=t._getOverlayContainer(n);if(i){tt(i.html);var r=t._overlayContainers.indexOf(i);-1!==r&&t._overlayContainers.splice(r,1)}})),e.on(\"element.changed\",500,(function(e){var n=e.element,i=t._getOverlayContainer(n,!0);i&&(f(i.overlays,(function(e){t._updateOverlay(e)})),t._updateOverlayContainer(i))})),e.on(\"element.marker.update\",(function(e){var n=t._getOverlayContainer(e.element,!0);n&&Le(n.html)[e.add?\"add\":\"remove\"](e.marker)})),e.on(\"root.set\",(function(){t._updateOverlaysVisibilty(t._canvas.viewbox())})),e.on(\"diagram.clear\",this.clear,this)};var zt={__init__:[\"overlays\"],overlays:[\"type\",jt]};function $t(e,t,n,i){e.on(\"element.changed\",(function(i){var r=i.element;(r.parent||r===t.getRootElement())&&(i.gfx=n.getGraphics(r)),i.gfx&&e.fire(Ot(r)+\".changed\",i)})),e.on(\"elements.changed\",(function(t){var n=t.elements;n.forEach((function(t){e.fire(\"element.changed\",{element:t})})),i.updateContainments(n)})),e.on(\"shape.changed\",(function(e){i.update(\"shape\",e.element,e.gfx)})),e.on(\"connection.changed\",(function(e){i.update(\"connection\",e.element,e.gfx)}))}$t.$inject=[\"eventBus\",\"canvas\",\"elementRegistry\",\"graphicsFactory\"];var Gt={__init__:[\"changeSupport\"],changeSupport:[\"type\",$t]};function Ht(e){this._eventBus=e}function Kt(e){return function(t,n,i,r,o){(l(t)||s(t))&&(o=r,r=i,i=n,n=t,t=null),this.on(t,e,n,i,r,o)}}function Ut(e,t){t.invoke(Ht,this),this.executed((function(t){var n=t.context;n.rootElement?e.setRootElement(n.rootElement):n.rootElement=e.getRootElement()})),this.revert((function(t){var n=t.context;n.rootElement&&e.setRootElement(n.rootElement)}))}Ht.$inject=[\"eventBus\"],Ht.prototype.on=function(e,t,n,i,r,p){if((l(t)||s(t))&&(p=r,r=i,i=n,n=t,t=null),l(n)&&(p=r,r=i,i=n,n=1e3),a(r)&&(p=r,r=!1),!l(i))throw new Error(\"handlerFn must be a function\");o(e)||(e=[e]);var c=this._eventBus;f(e,(function(e){var o=[\"commandStack\",e,t].filter((function(e){return e})).join(\".\");c.on(o,n,r?function(e,t){return function(n){return e.call(t||null,n.context,n.command,n)}}(i,p):i,p)}))},Ht.prototype.canExecute=Kt(\"canExecute\"),Ht.prototype.preExecute=Kt(\"preExecute\"),Ht.prototype.preExecuted=Kt(\"preExecuted\"),Ht.prototype.execute=Kt(\"execute\"),Ht.prototype.executed=Kt(\"executed\"),Ht.prototype.postExecute=Kt(\"postExecute\"),Ht.prototype.postExecuted=Kt(\"postExecuted\"),Ht.prototype.revert=Kt(\"revert\"),Ht.prototype.reverted=Kt(\"reverted\"),e(Ut,Ht),Ut.$inject=[\"canvas\",\"injector\"];var qt={__init__:[\"rootElementsBehavior\"],rootElementsBehavior:[\"type\",Ut]},Yt={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"};var Xt=\"_plane\";function Zt(e){var t=e.id;return k(e,\"bpmn:SubProcess\")?function(e){return e+Xt}(t):t}function Jt(e,t,n){var i=Qe('<ul class=\"bjs-breadcrumbs\"></ul>'),r=n.getContainer(),o=Le(r);r.appendChild(i);var a=[];function s(e){e&&(a=function(e){for(var t=S(e),n=[],i=t;i;i=i.$parent)(k(i,\"bpmn:SubProcess\")||k(i,\"bpmn:Process\"))&&n.push(i);return n.reverse()}(e));var r=a.map((function(e){var i,r=(i=\"\"+(i=e.name||e.id))&&i.replace(/[&<>\"']/g,(function(e){return Yt[e]})),o=Qe('<li><span class=\"bjs-crumb\"><a title=\"'+r+'\">'+r+\"</a></span></li>\"),a=n.findRoot(Zt(e))||n.findRoot(e.id);if(!a&&k(e,\"bpmn:Process\")){var s=t.find((function(t){var n=S(t);return n&&n.get(\"processRef\")&&n.get(\"processRef\")===e}));a=n.findRoot(s.id)}return o.addEventListener(\"click\",(function(){n.setRootElement(a)})),o}));i.innerHTML=\"\";var s=r.length>1;o.toggle(\"bjs-breadcrumbs-shown\",s),r.forEach((function(e){i.appendChild(e)}))}e.on(\"element.changed\",(function(e){var t=S(e.element);u(a,(function(e){return e===t}))&&s()})),e.on(\"root.set\",(function(e){s(e.element)}))}function Qt(e,t){var n=null,i=new en;e.on(\"root.set\",(function(e){var r=e.element,o=t.viewbox(),a=i.get(r);if(i.set(n,{x:o.x,y:o.y,zoom:o.scale}),n=r,!k(r,\"bpmn:Collaboration\")||a){a=a||{x:0,y:0,zoom:1};var s=(o.x-a.x)*o.scale,l=(o.y-a.y)*o.scale;0===s&&0===l||t.scroll({dx:s,dy:l}),a.zoom!==o.scale&&t.zoom(a.zoom,{x:0,y:0})}})),e.on(\"diagram.clear\",(function(){i.clear(),n=null}))}function en(){this._entries=[],this.set=function(e,t){var n=!1;for(var i in this._entries)if(this._entries[i][0]===e){this._entries[i][1]=t,n=!0;break}n||this._entries.push([e,t])},this.get=function(e){for(var t in this._entries)if(this._entries[t][0]===e)return this._entries[t][1];return null},this.clear=function(){this._entries.length=0},this.remove=function(e){var t=-1;for(var n in this._entries)if(this._entries[n][0]===e){t=n;break}-1!==t&&this._entries.splice(t,1)}}Jt.$inject=[\"eventBus\",\"elementRegistry\",\"canvas\"],Qt.$inject=[\"eventBus\",\"canvas\"];var tn=180,nn=160;function rn(e,t){this._eventBus=e,this._moddle=t;var n=this;e.on(\"import.render.start\",1500,(function(e,t){n._handleImport(t.definitions)}))}function on(e){return k(e,\"bpmndi:BPMNDiagram\")?e:on(e.$parent)}rn.prototype._handleImport=function(e){if(e.diagrams){var t=this;this._definitions=e,this._processToDiagramMap={},e.diagrams.forEach((function(e){e.plane&&e.plane.bpmnElement&&(t._processToDiagramMap[e.plane.bpmnElement.id]=e)}));var n=[];e.diagrams.forEach((function(e){var i=t._createNewDiagrams(e.plane);Array.prototype.push.apply(n,i)})),n.forEach((function(e){t._movePlaneElementsToOrigin(e.plane)}))}},rn.prototype._createNewDiagrams=function(e){var t=this,n=[],i=[];e.get(\"planeElement\").forEach((function(t){var r=t.bpmnElement;if(r){var o=r.$parent;k(r,\"bpmn:SubProcess\")&&!t.isExpanded&&n.push(r),function(e,t){var n=e.$parent;if(!k(n,\"bpmn:SubProcess\")||n===t.bpmnElement)return!1;if(R(e,[\"bpmn:DataInputAssociation\",\"bpmn:DataOutputAssociation\"]))return!1;return!0}(r,e)&&i.push({diElement:t,parent:o})}}));var r=[];return n.forEach((function(e){if(!t._processToDiagramMap[e.id]){var n=t._createDiagram(e);t._processToDiagramMap[e.id]=n,r.push(n)}})),i.forEach((function(e){for(var i=e.diElement,r=e.parent;r&&-1===n.indexOf(r);)r=r.$parent;if(r){var o=t._processToDiagramMap[r.id];t._moveToDiPlane(i,o.plane)}})),r},rn.prototype._movePlaneElementsToOrigin=function(e){var t=e.get(\"planeElement\"),n=function(e){var t={top:1/0,right:-1/0,bottom:-1/0,left:1/0};return e.planeElement.forEach((function(e){if(e.bounds){var n=_t(e.bounds);t.top=Math.min(n.top,t.top),t.left=Math.min(n.left,t.left)}})),function(e){return{x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top}}(t)}(e),i=n.x-tn,r=n.y-nn;t.forEach((function(e){e.waypoint?e.waypoint.forEach((function(e){e.x=e.x-i,e.y=e.y-r})):e.bounds&&(e.bounds.x=e.bounds.x-i,e.bounds.y=e.bounds.y-r)}))},rn.prototype._moveToDiPlane=function(e,t){var n=on(e).plane.get(\"planeElement\");n.splice(n.indexOf(e),1),t.get(\"planeElement\").push(e)},rn.prototype._createDiagram=function(e){var t=this._moddle.create(\"bpmndi:BPMNPlane\",{bpmnElement:e}),n=this._moddle.create(\"bpmndi:BPMNDiagram\",{plane:t});return t.$parent=n,t.bpmnElement=e,n.$parent=this._definitions,this._definitions.diagrams.push(n),n},rn.$inject=[\"eventBus\",\"moddle\"];var an=250;function sn(e,t,n,i){Ht.call(this,t),this._canvas=e,this._eventBus=t,this._elementRegistry=n,this._overlays=i;var r=this;this.executed(\"shape.toggleCollapse\",an,(function(e){var t=e.shape;r._canDrillDown(t)?r._addOverlay(t):r._removeOverlay(t)}),!0),this.reverted(\"shape.toggleCollapse\",an,(function(e){var t=e.shape;r._canDrillDown(t)?r._addOverlay(t):r._removeOverlay(t)}),!0),this.executed([\"shape.create\",\"shape.move\",\"shape.delete\"],an,(function(e){var t=e.oldParent,n=e.newParent||e.parent,i=e.shape;r._canDrillDown(i)&&r._addOverlay(i),r._updateDrilldownOverlay(t),r._updateDrilldownOverlay(n),r._updateDrilldownOverlay(i)}),!0),this.reverted([\"shape.create\",\"shape.move\",\"shape.delete\"],an,(function(e){var t=e.oldParent,n=e.newParent||e.parent,i=e.shape;r._canDrillDown(i)&&r._addOverlay(i),r._updateDrilldownOverlay(t),r._updateDrilldownOverlay(n),r._updateDrilldownOverlay(i)}),!0),t.on(\"import.render.complete\",(function(){n.filter((function(e){return r._canDrillDown(e)})).map((function(e){r._addOverlay(e)}))}))}e(sn,Ht),sn.prototype._updateDrilldownOverlay=function(e){var t=this._canvas;if(e){var n=t.findRoot(e);n&&this._updateOverlayVisibility(n)}},sn.prototype._canDrillDown=function(e){var t=this._canvas;return k(e,\"bpmn:SubProcess\")&&t.findRoot(Zt(e))},sn.prototype._updateOverlayVisibility=function(e){var t=this._overlays,n=S(e),i=t.get({element:n.id,type:\"drilldown\"})[0];if(i){var r=n&&n.get(\"flowElements\")&&n.get(\"flowElements\").length;Le(i.html).toggle(\"bjs-drilldown-empty\",!r)}},sn.prototype._addOverlay=function(e){var t=this._canvas,n=this._overlays;n.get({element:e,type:\"drilldown\"}).length&&this._removeOverlay(e);var i=Qe('<button class=\"bjs-drilldown\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z\"/></svg></button>');i.addEventListener(\"click\",(function(){t.setRootElement(t.findRoot(Zt(e)))})),n.add(e,\"drilldown\",{position:{bottom:-7,right:-8},html:i}),this._updateOverlayVisibility(e)},sn.prototype._removeOverlay=function(e){this._overlays.remove({element:e,type:\"drilldown\"})},sn.$inject=[\"canvas\",\"eventBus\",\"elementRegistry\",\"overlays\"];var ln={__depends__:[zt,Gt,qt],__init__:[\"drilldownBreadcrumbs\",\"drilldownOverlayBehavior\",\"drilldownCentering\",\"subprocessCompatibility\"],drilldownBreadcrumbs:[\"type\",Jt],drilldownCentering:[\"type\",Qt],drilldownOverlayBehavior:[\"type\",sn],subprocessCompatibility:[\"type\",rn]};function pn(e,t){this._eventBus=e,this.offset=5;var n=t.cls(\"djs-outline\",[\"no-fill\"]),i=this;function r(e){var t=Z(\"rect\");return z(t,E({x:0,y:0,rx:4,width:100,height:100},n)),t}e.on([\"shape.added\",\"shape.changed\"],500,(function(e){var t=e.element,n=e.gfx,o=et(\".djs-outline\",n);o||j(n,o=i.getOutline(t)||r()),i.updateShapeOutline(o,t)})),e.on([\"connection.added\",\"connection.changed\"],(function(e){var t=e.element,n=e.gfx,o=et(\".djs-outline\",n);o||j(n,o=r()),i.updateConnectionOutline(o,t)}))}pn.prototype.updateShapeOutline=function(e,t){var n=!1,i=this._getProviders();i.length&&f(i,(function(i){n=n||i.updateOutline(t,e)})),n||z(e,{x:-this.offset,y:-this.offset,width:t.width+2*this.offset,height:t.height+2*this.offset})},pn.prototype.updateConnectionOutline=function(e,t){var n=Tt(t);z(e,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+2*this.offset,height:n.height+2*this.offset})},pn.prototype.registerProvider=function(e,t){t||(t=e,e=1e3),this._eventBus.on(\"outline.getProviders\",e,(function(e){e.providers.push(t)}))},pn.prototype._getProviders=function(){var e=this._eventBus.createEvent({type:\"outline.getProviders\",providers:[]});return this._eventBus.fire(e),e.providers},pn.prototype.getOutline=function(e){var t;return f(this._getProviders(),(function(n){l(n.getOutline)&&(t=t||n.getOutline(e))})),t},pn.$inject=[\"eventBus\",\"styles\",\"elementRegistry\"];var cn={__init__:[\"outline\"],outline:[\"type\",pn]};const un={width:36,height:50},hn={width:50,height:50};function fn(e,t,n){return Z(\"path\",{d:e,strokeWidth:2,transform:`translate(${t.x}, ${t.y})`,...n})}function mn(e,t){this._styles=t,e.registerProvider(this)}function dn(e,t){var n;return\"bpmn:DataObjectReference\"===t?n=un:\"bpmn:DataStoreReference\"===t&&(n=hn),e.width===n.width&&e.height===n.height}mn.$inject=[\"outline\",\"styles\"],mn.prototype.getOutline=function(e){const t=this._styles.cls(\"djs-outline\",[\"no-fill\"]);var n;if(!D(e))return k(e,\"bpmn:Gateway\")?(E((n=Z(\"rect\")).style,{\"transform-box\":\"fill-box\",transform:\"rotate(45deg)\",\"transform-origin\":\"center\"}),z(n,E({x:2,y:2,rx:4,width:e.width-4,height:e.height-4},t))):R(e,[\"bpmn:Task\",\"bpmn:SubProcess\",\"bpmn:Group\"])?z(n=Z(\"rect\"),E({x:-5,y:-5,rx:14,width:e.width+10,height:e.height+10},t)):k(e,\"bpmn:EndEvent\")?z(n=Z(\"circle\"),E({cx:e.width/2,cy:e.height/2,r:e.width/2+5+1},t)):k(e,\"bpmn:Event\")?z(n=Z(\"circle\"),E({cx:e.width/2,cy:e.height/2,r:e.width/2+5},t)):k(e,\"bpmn:DataObjectReference\")&&dn(e,\"bpmn:DataObjectReference\")?n=fn(\"M44.7648 11.3263L36.9892 2.64074C36.0451 1.58628 34.5651 0.988708 33.1904 0.988708H5.98667C3.22688 0.988708 0.989624 3.34892 0.989624 6.26039V55.0235C0.989624 57.9349 3.22688 60.2952 5.98667 60.2952H40.966C43.7257 60.2952 45.963 57.9349 45.963 55.0235V14.9459C45.963 13.5998 45.6407 12.3048 44.7648 11.3263Z\",{x:-6,y:-6},t):k(e,\"bpmn:DataStoreReference\")&&dn(e,\"bpmn:DataStoreReference\")&&(n=fn(\"M1.03845 48.1347C1.03845 49.3511 1.07295 50.758 1.38342 52.064C1.69949 53.3938 2.32428 54.7154 3.56383 55.6428C6.02533 57.4841 10.1161 58.7685 14.8212 59.6067C19.5772 60.4538 25.1388 60.8738 30.6831 60.8738C36.2276 60.8738 41.7891 60.4538 46.545 59.6067C51.2504 58.7687 55.3412 57.4842 57.8028 55.6429C59.0424 54.7156 59.6673 53.3938 59.9834 52.064C60.2938 50.7579 60.3285 49.351 60.3285 48.1344V13.8415C60.3285 12.6249 60.2938 11.218 59.9834 9.91171C59.6673 8.58194 59.0423 7.2602 57.8027 6.33294C55.341 4.49168 51.2503 3.20723 46.545 2.36914C41.7891 1.522 36.2276 1.10204 30.6831 1.10205C25.1388 1.10206 19.5772 1.52206 14.8213 2.36923C10.1162 3.20734 6.02543 4.49183 3.5639 6.33314C2.32433 7.26038 1.69951 8.58206 1.38343 9.91181C1.07295 11.2179 1.03845 12.6247 1.03845 13.8411V48.1347Z\",{x:-6,y:-6},t)),n},mn.prototype.updateOutline=function(e,t){if(!D(e))return R(e,[\"bpmn:SubProcess\",\"bpmn:Group\"])?(z(t,{width:e.width+10,height:e.height+10}),!0):!!R(e,[\"bpmn:Event\",\"bpmn:Gateway\",\"bpmn:DataStoreReference\",\"bpmn:DataObjectReference\"])};var yn={__depends__:[cn],__init__:[\"outlineProvider\"],outlineProvider:[\"type\",mn]};function gn(e){return e.originalEvent||e.srcEvent}function vn(e){return e.pointers&&e.pointers.length&&(e=e.pointers[0]),e.touches&&e.touches.length&&(e=e.touches[0]),e?{x:e.clientX,y:e.clientY}:null}function xn(e,t){return(gn(e)||e).button===t}function bn(e){return xn(e,0)}function wn(e){return!0}function En(e){return bn(e)||function(e){return xn(e,1)}(e)}function _n(e,t,n){var i=this;function r(n,i,r){var o,a;(function(e,t){var n=l[e]||bn;return!n(t)})(n,i)||(r?a=t.getGraphics(r):(o=i.delegateTarget||i.target)&&(a=o,r=t.get(a)),a&&r&&!1===e.fire(n,{element:r,gfx:a,originalEvent:i})&&(i.stopPropagation(),i.preventDefault()))}var o={};function a(e){return o[e]}var s={click:\"element.click\",contextmenu:\"element.contextmenu\",dblclick:\"element.dblclick\",mousedown:\"element.mousedown\",mousemove:\"element.mousemove\",mouseover:\"element.hover\",mouseout:\"element.out\",mouseup:\"element.mouseup\"},l={\"element.contextmenu\":wn,\"element.mousedown\":En,\"element.mouseup\":En,\"element.click\":En,\"element.dblclick\":En};var p=\"svg, .djs-element\";function c(e,t,n,i){var a=o[n]=function(e){r(n,e)};i&&(l[n]=i),a.$delegate=Ye.bind(e,p,t,a)}function u(e,t,n){var i=a(n);i&&Ye.unbind(e,t,i.$delegate)}e.on(\"canvas.destroy\",(function(e){var t;t=e.svg,f(s,(function(e,n){u(t,n,e)}))})),e.on(\"canvas.init\",(function(e){var t;t=e.svg,f(s,(function(e,n){c(t,n,e)}))})),e.on([\"shape.added\",\"connection.added\"],(function(t){var n=t.element,i=t.gfx;e.fire(\"interactionEvents.createHit\",{element:n,gfx:i})})),e.on([\"shape.changed\",\"connection.changed\"],500,(function(t){var n=t.element,i=t.gfx;e.fire(\"interactionEvents.updateHit\",{element:n,gfx:i})})),e.on(\"interactionEvents.createHit\",500,(function(e){var t=e.element,n=e.gfx;i.createDefaultHit(t,n)})),e.on(\"interactionEvents.updateHit\",(function(e){var t=e.element,n=e.gfx;i.updateDefaultHit(t,n)}));var h=y(\"djs-hit djs-hit-stroke\"),m=y(\"djs-hit djs-hit-click-stroke\"),d={all:y(\"djs-hit djs-hit-all\"),\"click-stroke\":m,stroke:h,\"no-move\":y(\"djs-hit djs-hit-no-move\")};function y(e,t){return t=E({stroke:\"white\",strokeWidth:15},t||{}),n.cls(e,[\"no-fill\",\"no-border\"],t)}function g(e,t){var n=d[t];if(!n)throw new Error(\"invalid hit type <\"+t+\">\");return z(e,n),e}function v(e,t){j(e,t)}this.removeHits=function(e){var t;f((t=\".djs-hit\",(e||document).querySelectorAll(t)),K)},this.createDefaultHit=function(e,t){var n,i=e.waypoints,r=e.isFrame;return i?this.createWaypointsHit(t,i):(n=r?\"stroke\":\"all\",this.createBoxHit(t,n,{width:e.width,height:e.height}))},this.createWaypointsHit=function(e,t){var n=ye(t);return g(n,\"stroke\"),v(e,n),n},this.createBoxHit=function(e,t,n){n=E({x:0,y:0},n);var i=Z(\"rect\");return g(i,t),z(i,n),v(e,i),i},this.updateDefaultHit=function(e,t){var n=et(\".djs-hit\",t);if(n)return e.waypoints?ge(n,e.waypoints):z(n,{width:e.width,height:e.height}),n},this.fire=r,this.triggerMouseEvent=function(e,t,n){var i=s[e];if(!i)throw new Error(\"unmapped DOM event name <\"+e+\">\");return r(i,t,n)},this.mouseHandler=a,this.registerEvent=c,this.unregisterEvent=u}_n.$inject=[\"eventBus\",\"elementRegistry\",\"styles\"];var An={__init__:[\"interactionEvents\"],interactionEvents:[\"type\",_n]};function kn(e,t){this._eventBus=e,this._canvas=t,this._selectedElements=[];var n=this;e.on([\"shape.remove\",\"connection.remove\"],(function(e){var t=e.element;n.deselect(t)})),e.on([\"diagram.clear\",\"root.set\"],(function(e){n.select(null)}))}kn.$inject=[\"eventBus\",\"canvas\"],kn.prototype.deselect=function(e){var t=this._selectedElements,n=t.indexOf(e);if(-1!==n){var i=t.slice();t.splice(n,1),this._eventBus.fire(\"selection.changed\",{oldSelection:i,newSelection:t})}},kn.prototype.get=function(){return this._selectedElements},kn.prototype.isSelected=function(e){return-1!==this._selectedElements.indexOf(e)},kn.prototype.select=function(e,t){var n=this._selectedElements,i=n.slice();o(e)||(e=e?[e]:[]);var r=this._canvas,a=r.getRootElement();e=e.filter((function(e){var t=r.findRoot(e);return a===t})),t?f(e,(function(e){-1===n.indexOf(e)&&n.push(e)})):this._selectedElements=n=e.slice(),this._eventBus.fire(\"selection.changed\",{oldSelection:i,newSelection:n})};var Rn=\"hover\",Sn=\"selected\";function Cn(e,t,n){this._canvas=e;var i=this;function r(t,n){e.addMarker(t,n)}function o(t,n){e.removeMarker(t,n)}this._multiSelectionBox=null,t.on(\"element.hover\",(function(e){r(e.element,Rn)})),t.on(\"element.out\",(function(e){o(e.element,Rn)})),t.on(\"selection.changed\",(function(e){var t=e.oldSelection,n=e.newSelection;f(t,(function(e){-1===n.indexOf(e)&&o(e,Sn)})),f(n,(function(e){-1===t.indexOf(e)&&r(e,Sn)})),i._updateSelectionOutline(n)})),t.on(\"element.changed\",(function(e){n.isSelected(e.element)&&i._updateSelectionOutline(n.get())}))}function Mn(e,t,n,i){e.on(\"create.end\",500,(function(e){var n=e.context,i=n.canExecute,r=n.elements,a=(n.hints||{}).autoSelect;if(i){if(!1===a)return;o(a)?t.select(a):t.select(r.filter(Pn))}})),e.on(\"connect.end\",500,(function(e){var n=e.context.connection;n&&t.select(n)})),e.on(\"shape.move.end\",500,(function(e){var n=e.previousSelection||[],r=i.get(e.context.shape.id);u(n,(function(e){return r.id===e.id}))||t.select(r)})),e.on(\"element.click\",(function(e){if(bn(e)){var i=e.element;i===n.getRootElement()&&(i=null);var r=t.isSelected(i),o=t.get().length>1,a=function(e){var t=gn(e)||e;return bn(e)&&t.shiftKey}(e);if(r&&o)return a?t.deselect(i):t.select(i);r?t.deselect(i):t.select(i,a)}}))}function Pn(e){return!e.hidden}Cn.$inject=[\"canvas\",\"eventBus\",\"selection\"],Cn.prototype._updateSelectionOutline=function(e){var t=this._canvas.getLayer(\"selectionOutline\");U(t);var n=e.length>1;if(G(this._canvas.getContainer())[n?\"add\":\"remove\"](\"djs-multi-select\"),n){var i=function(e){return{x:e.x-6,y:e.y-6,width:e.width+12,height:e.height+12}}(Tt(e)),r=Z(\"rect\");z(r,E({rx:3},i)),G(r).add(\"djs-selection-outline\"),j(t,r)}},Mn.$inject=[\"eventBus\",\"selection\",\"canvas\",\"elementRegistry\"];var Dn={__init__:[\"selectionVisuals\",\"selectionBehavior\"],__depends__:[An,cn],selection:[\"type\",kn],selectionVisuals:[\"type\",Cn],selectionBehavior:[\"type\",Mn]};const Nn=/^class[ {]/;function Tn(e){return Array.isArray(e)}function On(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Bn(...e){1===e.length&&Tn(e[0])&&(e=e[0]);const t=(e=[...e]).pop();return t.$inject=e,t}const Ln=/constructor\\s*[^(]*\\(\\s*([^)]*)\\)/m,In=/^(?:async\\s+)?(?:function\\s*[^(]*)?(?:\\(\\s*([^)]*)\\)|(\\w+))/m,jn=/\\/\\*([^*]*)\\*\\//m;function Fn(e){if(\"function\"!=typeof e)throw new Error(`Cannot annotate \"${e}\". Expected a function!`);const t=e.toString().match(function(e){return Nn.test(e.toString())}(e)?Ln:In);if(!t)return[];const n=t[1]||t[2];return n&&n.split(\",\").map((e=>{const t=e.match(jn);return(t&&t[1]||e).trim()}))||[]}function Vn(e,t){const n=t||{get:function(e,t){if(i.push(e),!1===t)return null;throw s(`No provider for \"${e}\"!`)}},i=[],r=this._providers=Object.create(n._providers||null),o=this._instances=Object.create(null),a=o.injector=this,s=function(e){const t=i.join(\" -> \");return i.length=0,new Error(t?`${e} (Resolving: ${t})`:e)};function l(e,t){if(!r[e]&&e.includes(\".\")){const t=e.split(\".\");let n=l(t.shift());for(;t.length;)n=n[t.shift()];return n}if(On(o,e))return o[e];if(On(r,e)){if(-1!==i.indexOf(e))throw i.push(e),s(\"Cannot resolve circular dependency!\");return i.push(e),o[e]=r[e][0](r[e][1]),i.pop(),o[e]}return n.get(e,t)}function p(e,t){if(void 0===t&&(t={}),\"function\"!=typeof e){if(!Tn(e))throw s(`Cannot invoke \"${e}\". Expected a function!`);e=Bn(e.slice())}return{fn:e,dependencies:(e.$inject||Fn(e)).map((e=>On(t,e)?t[e]:l(e)))}}function c(e){const{fn:t,dependencies:n}=p(e);return new(Function.prototype.bind.call(t,null,...n))}function u(e,t,n){const{fn:i,dependencies:r}=p(e,n);return i.apply(t,r)}function h(e){return Bn((t=>e.get(t)))}function f(e,t){if(t&&t.length){const n=Object.create(null),i=Object.create(null),o=[],a=[],s=[];let l,p,c,u;for(let e in r)l=r[e],-1!==t.indexOf(e)&&(\"private\"===l[2]?(p=o.indexOf(l[3]),-1===p?(c=l[3].createChild([],t),u=h(c),o.push(l[3]),a.push(c),s.push(u),n[e]=[u,e,\"private\",c]):n[e]=[s[p],e,\"private\",a[p]]):n[e]=[l[2],l[1]],i[e]=!0),\"factory\"!==l[2]&&\"type\"!==l[2]||!l[1].$scope||t.forEach((t=>{-1!==l[1].$scope.indexOf(t)&&(n[e]=[l[2],l[1]],i[t]=!0)}));t.forEach((e=>{if(!i[e])throw new Error('No provider for \"'+e+'\". Cannot use provider from the parent!')})),e.unshift(n)}return new Vn(e,a)}const m={factory:u,type:c,value:function(e){return e}};function d(e,t){const n=e.__init__||[];return function(){n.forEach((e=>{\"string\"==typeof e?t.get(e):t.invoke(e)}))}}function y(e){const t=e.__exports__;if(t){const n=e.__modules__,i=Object.keys(e).reduce(((t,n)=>(\"__exports__\"!==n&&\"__modules__\"!==n&&\"__init__\"!==n&&\"__depends__\"!==n&&(t[n]=e[n]),t)),Object.create(null)),o=f((n||[]).concat(i)),a=Bn((function(e){return o.get(e)}));t.forEach((function(e){r[e]=[a,e,\"private\",o]}));const s=(e.__init__||[]).slice();return s.unshift((function(){o.init()})),d(e=Object.assign({},e,{__init__:s}),o)}return Object.keys(e).forEach((function(t){if(\"__init__\"===t||\"__depends__\"===t)return;const n=e[t];if(\"private\"===n[2])return void(r[t]=n);const i=n[0],o=n[1];r[t]=[m[i],Wn(i,o),i]})),d(e,a)}function g(e,t){return-1!==e.indexOf(t)||-1!==(e=(t.__depends__||[]).reduce(g,e)).indexOf(t)?e:e.concat(t)}this.get=l,this.invoke=u,this.instantiate=c,this.createChild=f,this.init=function(e){const t=e.reduce(g,[]).map(y);let n=!1;return function(){n||(n=!0,t.forEach((e=>e())))}}(e)}function Wn(e,t){return\"value\"!==e&&Tn(t)&&(t=Bn(t.slice())),t}function zn(e,t){A.call(this,e,1),this.CONNECTION_STYLE=t.style([\"no-fill\"],{strokeWidth:5,stroke:\"fuchsia\"}),this.SHAPE_STYLE=t.style({fill:\"white\",stroke:\"fuchsia\",strokeWidth:2}),this.FRAME_STYLE=t.style([\"no-fill\"],{stroke:\"fuchsia\",strokeDasharray:4,strokeWidth:2})}e(zn,A),zn.prototype.canRender=function(){return!0},zn.prototype.drawShape=function(e,t,n){var i=Z(\"rect\");return z(i,{x:0,y:0,width:t.width||0,height:t.height||0}),Bt(t)?z(i,E({},this.FRAME_STYLE,n||{})):z(i,E({},this.SHAPE_STYLE,n||{})),j(e,i),i},zn.prototype.drawConnection=function(e,t,n){var i=ye(t.waypoints,E({},this.CONNECTION_STYLE,n||{}));return j(e,i),i},zn.prototype.getShapePath=function(e){var t=e.x,n=e.y,i=e.width;return ue([[\"M\",t,n],[\"l\",i,0],[\"l\",0,e.height],[\"l\",-i,0],[\"z\"]])},zn.prototype.getConnectionPath=function(e){var t,n,i=e.waypoints,r=[];for(t=0;n=i[t];t++)n=n.original||n,r.push([0===t?\"M\":\"L\",n.x,n.y]);return ue(r)},zn.$inject=[\"eventBus\",\"styles\"];var $n={__init__:[\"defaultRenderer\"],defaultRenderer:[\"type\",zn],styles:[\"type\",function(){var e={\"no-fill\":{fill:\"none\"},\"no-border\":{strokeOpacity:0},\"no-events\":{pointerEvents:\"none\"}},t=this;this.cls=function(e,t,n){return E(this.style(t,n),{class:e})},this.style=function(t,n){o(t)||n||(n=t,t=[]);var i=m(t,(function(t,n){return E(t,e[n]||{})}),{});return n?E(i,n):i},this.computeStyle=function(e,n,i){return o(n)||(i=n,n=[]),t.style(n||[],E({},i,e||{}))}}]};function Gn(e,t){return Math.round(e*t)/t}function Hn(e){return s(e)?e+\"px\":e}function Kn(e,t,n){const i=Z(\"g\");G(i).add(t);const r=void 0!==n?n:e.childNodes.length-1;return e.insertBefore(i,e.childNodes[r]||null),i}const Un={shape:[\"x\",\"y\",\"width\",\"height\"],connection:[\"waypoints\"]};function qn(e,t,n,i){this._eventBus=t,this._elementRegistry=i,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(e||{})}function Yn(e,t){const n=\"matrix(\"+t.a+\",\"+t.b+\",\"+t.c+\",\"+t.d+\",\"+t.e+\",\"+t.f+\")\";e.setAttribute(\"transform\",n)}qn.$inject=[\"config.canvas\",\"eventBus\",\"graphicsFactory\",\"elementRegistry\"],qn.prototype._init=function(e){const t=this._eventBus,n=this._container=function(e){const t=(e=E({},{width:\"100%\",height:\"100%\"},e)).container||document.body,n=document.createElement(\"div\");return n.setAttribute(\"class\",\"djs-container djs-parent\"),Oe(n,{position:\"relative\",overflow:\"hidden\",width:Hn(e.width),height:Hn(e.height)}),t.appendChild(n),n}(e),i=this._svg=Z(\"svg\");z(i,{width:\"100%\",height:\"100%\"}),j(n,i);const r=this._viewport=Kn(i,\"viewport\");e.deferUpdate&&(this._viewboxChanged=function(e,t){let n,i,r,o;function a(n){let a=Date.now(),p=n?0:o+t-a;if(p>0)return s(p);e.apply(r,i),l()}function s(e){n=setTimeout(a,e)}function l(){n&&clearTimeout(n),n=o=i=r=void 0}function p(...e){o=Date.now(),i=e,r=this,n||s(t)}return p.flush=function(){n&&a(!0),l()},p.cancel=l,p}(w(this._viewboxChanged,this),300)),t.on(\"diagram.init\",(()=>{t.fire(\"canvas.init\",{svg:i,viewport:r})})),t.on([\"shape.added\",\"connection.added\",\"shape.removed\",\"connection.removed\",\"elements.changed\",\"root.set\"],(()=>{delete this._cachedViewbox})),t.on(\"diagram.destroy\",500,this._destroy,this),t.on(\"diagram.clear\",500,this._clear,this)},qn.prototype._destroy=function(){this._eventBus.fire(\"canvas.destroy\",{svg:this._svg,viewport:this._viewport});const e=this._container.parentNode;e&&e.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport},qn.prototype._clear=function(){this._elementRegistry.getAll().forEach((e=>{const t=Ot(e);\"root\"===t?this.removeRootElement(e):this._removeElement(e,t)})),this._planes=[],this._rootElement=null,delete this._cachedViewbox},qn.prototype.getDefaultLayer=function(){return this.getLayer(\"base\",0)},qn.prototype.getLayer=function(e,t){if(!e)throw new Error(\"must specify a name\");let n=this._layers[e];if(n||(n=this._layers[e]=this._createLayer(e,t)),void 0!==t&&n.index!==t)throw new Error(\"layer <\"+e+\"> already created at index <\"+t+\">\");return n.group},qn.prototype._getChildIndex=function(e){return m(this._layers,(function(t,n){return n.visible&&e>=n.index&&t++,t}),0)},qn.prototype._createLayer=function(e,t){void 0===t&&(t=1);const n=this._getChildIndex(t);return{group:Kn(this._viewport,\"layer-\"+e,n),index:t,visible:!0}},qn.prototype.showLayer=function(e){if(!e)throw new Error(\"must specify a name\");const t=this._layers[e];if(!t)throw new Error(\"layer <\"+e+\"> does not exist\");const n=this._viewport,i=t.group,r=t.index;if(t.visible)return i;const o=this._getChildIndex(r);return n.insertBefore(i,n.childNodes[o]||null),t.visible=!0,i},qn.prototype.hideLayer=function(e){if(!e)throw new Error(\"must specify a name\");const t=this._layers[e];if(!t)throw new Error(\"layer <\"+e+\"> does not exist\");const n=t.group;return t.visible?(K(n),t.visible=!1,n):n},qn.prototype._removeLayer=function(e){const t=this._layers[e];t&&(delete this._layers[e],K(t.group))},qn.prototype.getActiveLayer=function(){const e=this._findPlaneForRoot(this.getRootElement());return e?e.layer:null},qn.prototype.findRoot=function(e){if(\"string\"==typeof e&&(e=this._elementRegistry.get(e)),!e)return;const t=this._findPlaneForRoot(function(e){for(;e.parent;)e=e.parent;return e}(e))||{};return t.rootElement},qn.prototype.getRootElements=function(){return this._planes.map((function(e){return e.rootElement}))},qn.prototype._findPlaneForRoot=function(e){return u(this._planes,(function(t){return t.rootElement===e}))},qn.prototype.getContainer=function(){return this._container},qn.prototype._updateMarker=function(e,t,n){let i;e.id||(e=this._elementRegistry.get(e)),i=this._elementRegistry._elements[e.id],i&&(f([i.gfx,i.secondaryGfx],(function(e){e&&(n?G(e).add(t):G(e).remove(t))})),this._eventBus.fire(\"element.marker.update\",{element:e,gfx:i.gfx,marker:t,add:!!n}))},qn.prototype.addMarker=function(e,t){this._updateMarker(e,t,!0)},qn.prototype.removeMarker=function(e,t){this._updateMarker(e,t,!1)},qn.prototype.hasMarker=function(e,t){e.id||(e=this._elementRegistry.get(e));return G(this.getGraphics(e)).has(t)},qn.prototype.toggleMarker=function(e,t){this.hasMarker(e,t)?this.removeMarker(e,t):this.addMarker(e,t)},qn.prototype.getRootElement=function(){const e=this._rootElement;return e||this._planes.length?e:this.setRootElement(this.addRootElement(null))},qn.prototype.addRootElement=function(e){const t=this._rootsIdx++;e||(e={id:\"__implicitroot_\"+t,children:[],isImplicit:!0});const n=e.layer=\"root-\"+t;this._ensureValid(\"root\",e);const i=this.getLayer(n,0);return this.hideLayer(n),this._addRoot(e,i),this._planes.push({rootElement:e,layer:i}),e},qn.prototype.removeRootElement=function(e){\"string\"==typeof e&&(e=this._elementRegistry.get(e));if(this._findPlaneForRoot(e))return this._removeRoot(e),this._removeLayer(e.layer),this._planes=this._planes.filter((function(t){return t.rootElement!==e})),this._rootElement===e&&(this._rootElement=null),e},qn.prototype.setRootElement=function(e){if(e===this._rootElement)return e;let t;if(!e)throw new Error(\"rootElement required\");return t=this._findPlaneForRoot(e),t||(e=this.addRootElement(e)),this._setRoot(e),e},qn.prototype._removeRoot=function(e){const t=this._elementRegistry,n=this._eventBus;n.fire(\"root.remove\",{element:e}),n.fire(\"root.removed\",{element:e}),t.remove(e)},qn.prototype._addRoot=function(e,t){const n=this._elementRegistry,i=this._eventBus;i.fire(\"root.add\",{element:e}),n.add(e,t),i.fire(\"root.added\",{element:e,gfx:t})},qn.prototype._setRoot=function(e,t){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),e&&(t||(t=this._findPlaneForRoot(e).layer),this._elementRegistry.updateGraphics(e,this._svg,!0),this.showLayer(e.layer)),this._rootElement=e,this._eventBus.fire(\"root.set\",{element:e})},qn.prototype._ensureValid=function(e,t){if(!t.id)throw new Error(\"element must have an id\");if(this._elementRegistry.get(t.id))throw new Error(\"element <\"+t.id+\"> already exists\");const n=Un[e],i=d(n,(function(e){return void 0!==t[e]}));if(!i)throw new Error(\"must supply { \"+n.join(\", \")+\" } with \"+e)},qn.prototype._setParent=function(e,t,n){!function(e,t,n){if(e&&t){\"number\"!=typeof n&&(n=-1);var i=e.indexOf(t);if(-1!==i){if(i===n)return;if(-1===n)return;e.splice(i,1)}-1!==n?e.splice(n,0,t):e.push(t)}}(t.children,e,n),e.parent=t},qn.prototype._addElement=function(e,t,n,i){n=n||this.getRootElement();const r=this._eventBus,o=this._graphicsFactory;this._ensureValid(e,t),r.fire(e+\".add\",{element:t,parent:n}),this._setParent(t,n,i);const a=o.create(e,t,i);return this._elementRegistry.add(t,a),o.update(e,t,a),r.fire(e+\".added\",{element:t,gfx:a}),t},qn.prototype.addShape=function(e,t,n){return this._addElement(\"shape\",e,t,n)},qn.prototype.addConnection=function(e,t,n){return this._addElement(\"connection\",e,t,n)},qn.prototype._removeElement=function(e,t){const n=this._elementRegistry,i=this._graphicsFactory,r=this._eventBus;if(e=n.get(e.id||e))return r.fire(t+\".remove\",{element:e}),i.remove(e),function(e,t){if(!e||!t)return-1;var n=e.indexOf(t);-1!==n&&e.splice(n,1)}(e.parent&&e.parent.children,e),e.parent=null,r.fire(t+\".removed\",{element:e}),n.remove(e),e},qn.prototype.removeShape=function(e){return this._removeElement(e,\"shape\")},qn.prototype.removeConnection=function(e){return this._removeElement(e,\"connection\")},qn.prototype.getGraphics=function(e,t){return this._elementRegistry.getGraphics(e,t)},qn.prototype._changeViewbox=function(e){this._eventBus.fire(\"canvas.viewbox.changing\"),e.apply(this),this._cachedViewbox=null,this._viewboxChanged()},qn.prototype._viewboxChanged=function(){this._eventBus.fire(\"canvas.viewbox.changed\",{viewbox:this.viewbox()})},qn.prototype.viewbox=function(e){if(void 0===e&&this._cachedViewbox)return this._cachedViewbox;const t=this._viewport,n=this.getSize();let i,r,o,a,s,l,p;return e?(this._changeViewbox((function(){s=Math.min(n.width/e.width,n.height/e.height);const i=this._svg.createSVGMatrix().scale(s).translate(-e.x,-e.y);ce(t,i)})),e):(o=this._rootElement?this.getActiveLayer():null,i=o&&o.getBBox()||{},a=ce(t),r=a?a.matrix:function(e,t,n,i,r,o){var a=Q().createSVGMatrix();switch(arguments.length){case 0:return a;case 1:return ee(a,e);case 6:return ee(a,{a:e,b:t,c:n,d:i,e:r,f:o})}}(),s=Gn(r.a,1e3),l=Gn(-r.e||0,1e3),p=Gn(-r.f||0,1e3),e=this._cachedViewbox={x:l?l/s:0,y:p?p/s:0,width:n.width/s,height:n.height/s,scale:s,inner:{width:i.width||0,height:i.height||0,x:i.x||0,y:i.y||0},outer:n})},qn.prototype.scroll=function(e){const t=this._viewport;let n=t.getCTM();return e&&this._changeViewbox((function(){e=E({dx:0,dy:0},e||{}),n=this._svg.createSVGMatrix().translate(e.dx,e.dy).multiply(n),Yn(t,n)})),{x:n.e,y:n.f}},qn.prototype.scrollToElement=function(e,t){let n=100;\"string\"==typeof e&&(e=this._elementRegistry.get(e));const i=this.findRoot(e);if(i!==this.getRootElement()&&this.setRootElement(i),i===e)return;t||(t={}),\"number\"==typeof t&&(n=t),t={top:t.top||n,right:t.right||n,bottom:t.bottom||n,left:t.left||n};const r=Tt(e),o=_t(r),a=this.viewbox(),s=this.zoom();let l,p;a.y+=t.top/s,a.x+=t.left/s,a.width-=(t.right+t.left)/s,a.height-=(t.bottom+t.top)/s;const c=_t(a);if(r.width<a.width&&r.height<a.height){const e=Math.max(0,o.right-c.right),t=Math.min(0,o.left-c.left),n=Math.max(0,o.bottom-c.bottom),i=Math.min(0,o.top-c.top);l=e||t,p=n||i}else l=r.x-a.x,p=r.y-a.y;this.scroll({dx:-l*s,dy:-p*s})},qn.prototype.zoom=function(e,t){if(!e)return this.viewbox(e).scale;if(\"fit-viewport\"===e)return this._fitViewport(t);let n,i;return this._changeViewbox((function(){\"object\"!=typeof t&&(n=this.viewbox().outer,t={x:n.width/2,y:n.height/2}),i=this._setZoom(e,t)})),Gn(i.a,1e3)},qn.prototype._fitViewport=function(e){const t=this.viewbox(),n=t.outer,i=t.inner;let r,o;return i.x>=0&&i.y>=0&&i.x+i.width<=n.width&&i.y+i.height<=n.height&&!e?o={x:0,y:0,width:Math.max(i.width+i.x,n.width),height:Math.max(i.height+i.y,n.height)}:(r=Math.min(1,n.width/i.width,n.height/i.height),o={x:i.x+(e?i.width/2-n.width/r/2:0),y:i.y+(e?i.height/2-n.height/r/2:0),width:n.width/r,height:n.height/r}),this.viewbox(o),this.viewbox(!1).scale},qn.prototype._setZoom=function(e,t){const n=this._svg,i=this._viewport,r=n.createSVGMatrix(),o=n.createSVGPoint();let a,s,l,p,c;l=i.getCTM();const u=l.a;return t?(a=E(o,t),s=a.matrixTransform(l.inverse()),p=r.translate(s.x,s.y).scale(1/u*e).translate(-s.x,-s.y),c=l.multiply(p)):c=r.scale(e),Yn(this._viewport,c),c},qn.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},qn.prototype.getAbsoluteBBox=function(e){const t=this.viewbox();let n;if(e.waypoints){n=this.getGraphics(e).getBBox()}else n=e;return{x:n.x*t.scale-t.x*t.scale,y:n.y*t.scale-t.y*t.scale,width:n.width*t.scale,height:n.height*t.scale}},qn.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire(\"canvas.resized\")};var Xn=\"data-element-id\";function Zn(e){this._elements={},this._eventBus=e}function Jn(e,t,n){var i=function(e,t,n,i){var r=n.inverse;return Object.defineProperty(e,\"remove\",{value:function(e){var n=this.indexOf(e);return-1!==n&&(this.splice(n,1),t.unset(e,r,i)),e}}),Object.defineProperty(e,\"contains\",{value:function(e){return-1!==this.indexOf(e)}}),Object.defineProperty(e,\"add\",{value:function(e,n){var o=this.indexOf(e);if(void 0===n){if(-1!==o)return;n=this.length}-1!==o&&this.splice(o,1),this.splice(n,0,e),-1===o&&t.set(e,r,i)}}),Object.defineProperty(e,\"__refs_collection\",{value:!0}),e}(n[t.name]||[],e,t,n);Object.defineProperty(n,t.name,{enumerable:t.enumerable,value:i}),i.length&&i.forEach((function(i){e.set(i,t.inverse,n)}))}function Qn(e,t){if(!(this instanceof Qn))return new Qn(e,t);e.inverse=t,t.inverse=e,this.props={},this.props[e.name]=e,this.props[t.name]=t}Zn.$inject=[\"eventBus\"],Zn.prototype.add=function(e,t,n){var i=e.id;this._validateId(i),z(t,Xn,i),n&&z(n,Xn,i),this._elements[i]={element:e,gfx:t,secondaryGfx:n}},Zn.prototype.remove=function(e){var t=this._elements,n=e.id||e,i=n&&t[n];i&&(z(i.gfx,Xn,\"\"),i.secondaryGfx&&z(i.secondaryGfx,Xn,\"\"),delete t[n])},Zn.prototype.updateId=function(e,t){this._validateId(t),\"string\"==typeof e&&(e=this.get(e)),this._eventBus.fire(\"element.updateId\",{element:e,newId:t});var n=this.getGraphics(e),i=this.getGraphics(e,!0);this.remove(e),e.id=t,this.add(e,n,i)},Zn.prototype.updateGraphics=function(e,t,n){var i=e.id||e,r=this._elements[i];return n?r.secondaryGfx=t:r.gfx=t,t&&z(t,Xn,i),t},Zn.prototype.get=function(e){var t;t=\"string\"==typeof e?e:e&&z(e,Xn);var n=this._elements[t];return n&&n.element},Zn.prototype.filter=function(e){var t=[];return this.forEach((function(n,i){e(n,i)&&t.push(n)})),t},Zn.prototype.find=function(e){for(var t=this._elements,n=Object.keys(t),i=0;i<n.length;i++){var r=t[n[i]],o=r.element;if(e(o,r.gfx))return o}},Zn.prototype.getAll=function(){return this.filter((function(e){return e}))},Zn.prototype.forEach=function(e){var t=this._elements;Object.keys(t).forEach((function(n){var i=t[n],r=i.element,o=i.gfx;return e(r,o)}))},Zn.prototype.getGraphics=function(e,t){var n=e.id||e,i=this._elements[n];return i&&(t?i.secondaryGfx:i.gfx)},Zn.prototype._validateId=function(e){if(!e)throw new Error(\"element must have an id\");if(this._elements[e])throw new Error(\"element with id \"+e+\" already added\")},Qn.prototype.bind=function(e,t){if(\"string\"==typeof t){if(!this.props[t])throw new Error(\"no property <\"+t+\"> in ref\");t=this.props[t]}t.collection?Jn(this,t,e):function(e,t,n){var i=t.inverse,r=n[t.name];Object.defineProperty(n,t.name,{configurable:t.configurable,enumerable:t.enumerable,get:function(){return r},set:function(t){if(t!==r){var o=r;r=null,o&&e.unset(o,i,n),r=t,e.set(r,i,n)}}})}(this,t,e)},Qn.prototype.ensureRefsCollection=function(e,t){var n=e[t.name];return function(e){return!0===e.__refs_collection}(n)||Jn(this,t,e),n},Qn.prototype.ensureBound=function(e,t){(function(e,t){return Object.prototype.hasOwnProperty.call(e,t.name||t)})(e,t)||this.bind(e,t)},Qn.prototype.unset=function(e,t,n){e&&(this.ensureBound(e,t),t.collection?this.ensureRefsCollection(e,t).remove(n):e[t.name]=void 0)},Qn.prototype.set=function(e,t,n){e&&(this.ensureBound(e,t),t.collection?this.ensureRefsCollection(e,t).add(n):e[t.name]=n)};var ei=new Qn({name:\"children\",enumerable:!0,collection:!0},{name:\"parent\"}),ti=new Qn({name:\"labels\",enumerable:!0,collection:!0},{name:\"labelTarget\"}),ni=new Qn({name:\"attachers\",collection:!0},{name:\"host\"}),ii=new Qn({name:\"outgoing\",collection:!0},{name:\"source\"}),ri=new Qn({name:\"incoming\",collection:!0},{name:\"target\"});function oi(){Object.defineProperty(this,\"businessObject\",{writable:!0}),Object.defineProperty(this,\"label\",{get:function(){return this.labels[0]},set:function(e){var t=this.label,n=this.labels;!e&&t?n.remove(t):n.add(e,0)}}),ei.bind(this,\"parent\"),ti.bind(this,\"labels\"),ii.bind(this,\"outgoing\"),ri.bind(this,\"incoming\")}function ai(){oi.call(this),ei.bind(this,\"children\"),ni.bind(this,\"host\"),ni.bind(this,\"attachers\")}function si(){oi.call(this),ei.bind(this,\"children\")}function li(){ai.call(this),ti.bind(this,\"labelTarget\")}function pi(){oi.call(this),ii.bind(this,\"source\"),ri.bind(this,\"target\")}e(ai,oi),e(si,ai),e(li,ai),e(pi,oi);var ci={connection:pi,shape:ai,label:li,root:si};function ui(){this._uid=12}ui.prototype.createRoot=function(e){return this.create(\"root\",e)},ui.prototype.createLabel=function(e){return this.create(\"label\",e)},ui.prototype.createShape=function(e){return this.create(\"shape\",e)},ui.prototype.createConnection=function(e){return this.create(\"connection\",e)},ui.prototype.create=function(e,t){return(t=E({},t||{})).id||(t.id=e+\"_\"+this._uid++),function(e,t){var n=ci[e];if(!n)throw new Error(\"unknown type: <\"+e+\">\");return E(new n,t)}(e,t)};var hi=\"__fn\",fi=Array.prototype.slice;function mi(){this._listeners={},this.on(\"diagram.destroy\",1,this._destroy,this)}function di(){}function yi(e,t){this._eventBus=e,this._elementRegistry=t}function gi(e,t,n){var i=n||t.firstChild;e!==i&&t.insertBefore(e,i)}mi.prototype.on=function(e,t,n,i){if(e=o(e)?e:[e],l(t)&&(i=n,n=t,t=1e3),!s(t))throw new Error(\"priority must be a number\");var r=n;i&&((r=w(n,i))[hi]=n[hi]||n);var a=this;e.forEach((function(e){a._addListener(e,{priority:t,callback:r,next:null})}))},mi.prototype.once=function(e,t,n,i){var r=this;if(l(t)&&(i=n,n=t,t=1e3),!s(t))throw new Error(\"priority must be a number\");function o(){o.__isTomb=!0;var t=n.apply(i,arguments);return r.off(e,o),t}o[hi]=n,this.on(e,t,o)},mi.prototype.off=function(e,t){e=o(e)?e:[e];var n=this;e.forEach((function(e){n._removeListener(e,t)}))},mi.prototype.createEvent=function(e){var t=new di;return t.init(e),t},mi.prototype.fire=function(e,t){var n,i,r,o;if(o=fi.call(arguments),\"object\"==typeof e&&(e=(t=e).type),!e)throw new Error(\"no event type specified\");if(i=this._listeners[e]){n=t instanceof di?t:this.createEvent(t),o[0]=n;var a=n.type;e!==a&&(n.type=e);try{r=this._invokeListeners(n,o,i)}finally{e!==a&&(n.type=a)}return void 0===r&&n.defaultPrevented&&(r=!1),r}},mi.prototype.handleError=function(e){return!1===this.fire(\"error\",{error:e})},mi.prototype._destroy=function(){this._listeners={}},mi.prototype._invokeListeners=function(e,t,n){for(var i;n&&!e.cancelBubble;)i=this._invokeListener(e,t,n),n=n.next;return i},mi.prototype._invokeListener=function(e,t,n){var i;if(n.callback.__isTomb)return i;try{i=function(e,t){return e.apply(null,t)}(n.callback,t),void 0!==i&&(e.returnValue=i,e.stopPropagation()),!1===i&&e.preventDefault()}catch(e){if(!this.handleError(e))throw console.error(\"unhandled error in event listener\",e),e}return i},mi.prototype._addListener=function(e,t){var n,i=this._getListeners(e);if(i){for(;i;){if(i.priority<t.priority)return t.next=i,void(n?n.next=t:this._setListeners(e,t));n=i,i=i.next}n.next=t}else this._setListeners(e,t)},mi.prototype._getListeners=function(e){return this._listeners[e]},mi.prototype._setListeners=function(e,t){this._listeners[e]=t},mi.prototype._removeListener=function(e,t){var n,i,r,o=this._getListeners(e);if(t)for(;o;)n=o.next,(r=o.callback)!==t&&r[hi]!==t||(i?i.next=n:this._setListeners(e,n)),i=o,o=n;else this._setListeners(e,null)},di.prototype.stopPropagation=function(){this.cancelBubble=!0},di.prototype.preventDefault=function(){this.defaultPrevented=!0},di.prototype.init=function(e){E(this,e||{})},yi.$inject=[\"eventBus\",\"elementRegistry\"],yi.prototype._getChildrenContainer=function(e){var t,n=this._elementRegistry.getGraphics(e);return e.parent?(t=function(e){return e.parentNode.childNodes[1]}(n),t||(G(t=Z(\"g\")).add(\"djs-children\"),j(n.parentNode,t))):t=n,t},yi.prototype._clear=function(e){var t=function(e){return e.childNodes[0]}(e);return je(t),t},yi.prototype._createContainer=function(e,t,n,i){var r=Z(\"g\");G(r).add(\"djs-group\"),void 0!==n?gi(r,t,t.childNodes[n]):j(t,r);var o=Z(\"g\");G(o).add(\"djs-element\"),G(o).add(\"djs-\"+e),i&&G(o).add(\"djs-frame\"),j(r,o);var a=Z(\"g\");return G(a).add(\"djs-visual\"),j(o,a),o},yi.prototype.create=function(e,t,n){var i=this._getChildrenContainer(t.parent);return this._createContainer(e,i,n,Bt(t))},yi.prototype.updateContainments=function(e){var t,n=this,i=this._elementRegistry;t=m(e,(function(e,t){return t.parent&&(e[t.parent.id]=t.parent),e}),{}),f(t,(function(e){var t=e.children;if(t){var r=n._getChildrenContainer(e);f(t.slice().reverse(),(function(e){gi(i.getGraphics(e).parentNode,r)}))}}))},yi.prototype.drawShape=function(e,t,n={}){return this._eventBus.fire(\"render.shape\",{gfx:e,element:t,attrs:n})},yi.prototype.getShapePath=function(e){return this._eventBus.fire(\"render.getShapePath\",e)},yi.prototype.drawConnection=function(e,t,n={}){return this._eventBus.fire(\"render.connection\",{gfx:e,element:t,attrs:n})},yi.prototype.getConnectionPath=function(e){return this._eventBus.fire(\"render.getConnectionPath\",e)},yi.prototype.update=function(e,t,n){if(t.parent){var i=this._clear(n);if(\"shape\"===e)this.drawShape(i,t),it(n,t.x,t.y);else{if(\"connection\"!==e)throw new Error(\"unknown type: \"+e);this.drawConnection(i,t)}t.hidden?z(n,\"display\",\"none\"):z(n,\"display\",\"block\")}},yi.prototype.remove=function(e){K(this._elementRegistry.getGraphics(e).parentNode)};var vi={__depends__:[$n],__init__:[\"canvas\"],canvas:[\"type\",qn],elementRegistry:[\"type\",Zn],elementFactory:[\"type\",ui],eventBus:[\"type\",mi],graphicsFactory:[\"type\",yi]};function xi(e){return function(e){var t=new Vn(e);return t.init(),t}([{config:[\"value\",e=e||{}]},vi].concat(e.modules||[]))}function bi(e,t){this._injector=t||xi(e),this.get(\"eventBus\").fire(\"diagram.init\")}function wi(){}function Ei(e,t){this.model=e,this.properties=t}bi.prototype.get=function(e,t){return this._injector.get(e,t)},bi.prototype.invoke=function(e,t,n){return this._injector.invoke(e,t,n)},bi.prototype.destroy=function(){this.get(\"eventBus\").fire(\"diagram.destroy\")},bi.prototype.clear=function(){this.get(\"eventBus\").fire(\"diagram.clear\")},wi.prototype.get=function(e){return this.$model.properties.get(this,e)},wi.prototype.set=function(e,t){this.$model.properties.set(this,e,t)},Ei.prototype.createType=function(e){var t=this.model,n=this.properties,i=Object.create(wi.prototype);f(e.properties,(function(e){e.isMany||void 0===e.default||(i[e.name]=e.default)})),n.defineModel(i,t),n.defineDescriptor(i,e);var r=e.ns.name;function o(e){n.define(this,\"$type\",{value:r,enumerable:!0}),n.define(this,\"$attrs\",{value:{}}),n.define(this,\"$parent\",{writable:!0}),f(e,w((function(e,t){this.set(t,e)}),this))}return o.prototype=i,o.hasType=i.$instanceOf=this.model.hasType,n.defineModel(o,t),n.defineDescriptor(o,e),o};var _i={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},Ai={String:function(e){return e},Boolean:function(e){return\"true\"===e},Integer:function(e){return parseInt(e,10)},Real:function(e){return parseFloat(e)}};function ki(e,t){var n=Ai[e];return n?n(t):t}function Ri(e){return!!_i[e]}function Si(e){return!!Ai[e]}function Ci(e,t){var n,i,r=e.split(/:/);if(1===r.length)n=e,i=t;else{if(2!==r.length)throw new Error(\"expected <prefix:localName> or <localName>, got \"+e);n=r[1],i=r[0]}return{name:e=(i?i+\":\":\"\")+n,prefix:i,localName:n}}function Mi(e){this.ns=e,this.name=e.name,this.allTypes=[],this.allTypesByName={},this.properties=[],this.propertiesByName={}}function Pi(e,t){this.packageMap={},this.typeMap={},this.packages=[],this.properties=t,f(e,w(this.registerPackage,this))}function Di(e,t,n){var i=t[n];if(i in e)throw new Error(\"package with \"+n+\" <\"+i+\"> already defined\")}function Ni(e){this.model=e}function Ti(e,t,n){Object.defineProperty(e,t.name,{enumerable:!t.isReference,writable:!0,value:n,configurable:!0})}function Oi(e){return e.replace(/^:/,\"\")}function Bi(e,t={}){this.properties=new Ni(this),this.factory=new Ei(this,this.properties),this.registry=new Pi(e,this.properties),this.typeCache={},this.config=t}Mi.prototype.build=function(){return function(e,t){let n={},i=Object(e);return f(t,(function(t){t in i&&(n[t]=e[t])})),n}(this,[\"ns\",\"name\",\"allTypes\",\"allTypesByName\",\"properties\",\"propertiesByName\",\"bodyProperty\",\"idProperty\"])},Mi.prototype.addProperty=function(e,t,n){\"boolean\"==typeof t&&(n=t,t=void 0),this.addNamedProperty(e,!1!==n);var i=this.properties;void 0!==t?i.splice(t,0,e):i.push(e)},Mi.prototype.replaceProperty=function(e,t,n){var i=e.ns,r=this.properties,o=this.propertiesByName,a=e.name!==t.name;if(e.isId){if(!t.isId)throw new Error(\"property <\"+t.ns.name+\"> must be id property to refine <\"+e.ns.name+\">\");this.setIdProperty(t,!1)}if(e.isBody){if(!t.isBody)throw new Error(\"property <\"+t.ns.name+\"> must be body property to refine <\"+e.ns.name+\">\");this.setBodyProperty(t,!1)}var s=r.indexOf(e);if(-1===s)throw new Error(\"property <\"+i.name+\"> not found in property list\");r.splice(s,1),this.addProperty(t,n?void 0:s,a),o[i.name]=o[i.localName]=t},Mi.prototype.redefineProperty=function(e,t,n){var i=e.ns.prefix,r=t.split(\"#\"),o=Ci(r[0],i),a=Ci(r[1],o.prefix).name,s=this.propertiesByName[a];if(!s)throw new Error(\"refined property <\"+a+\"> not found\");this.replaceProperty(s,e,n),delete e.redefines},Mi.prototype.addNamedProperty=function(e,t){var n=e.ns,i=this.propertiesByName;t&&(this.assertNotDefined(e,n.name),this.assertNotDefined(e,n.localName)),i[n.name]=i[n.localName]=e},Mi.prototype.removeNamedProperty=function(e){var t=e.ns,n=this.propertiesByName;delete n[t.name],delete n[t.localName]},Mi.prototype.setBodyProperty=function(e,t){if(t&&this.bodyProperty)throw new Error(\"body property defined multiple times (<\"+this.bodyProperty.ns.name+\">, <\"+e.ns.name+\">)\");this.bodyProperty=e},Mi.prototype.setIdProperty=function(e,t){if(t&&this.idProperty)throw new Error(\"id property defined multiple times (<\"+this.idProperty.ns.name+\">, <\"+e.ns.name+\">)\");this.idProperty=e},Mi.prototype.assertNotTrait=function(e){if((e.extends||[]).length)throw new Error(`cannot create <${e.name}> extending <${e.extends}>`)},Mi.prototype.assertNotDefined=function(e,t){var n=e.name,i=this.propertiesByName[n];if(i)throw new Error(\"property <\"+n+\"> already defined; override of <\"+i.definedBy.ns.name+\"#\"+i.ns.name+\"> by <\"+e.definedBy.ns.name+\"#\"+e.ns.name+\"> not allowed without redefines\")},Mi.prototype.hasProperty=function(e){return this.propertiesByName[e]},Mi.prototype.addTrait=function(e,t){t&&this.assertNotTrait(e);var n=this.allTypesByName,i=this.allTypes,r=e.name;r in n||(f(e.properties,w((function(n){n=E({},n,{name:n.ns.localName,inherited:t}),Object.defineProperty(n,\"definedBy\",{value:e});var i=n.replaces,r=n.redefines;i||r?this.redefineProperty(n,i||r,i):(n.isBody&&this.setBodyProperty(n),n.isId&&this.setIdProperty(n),this.addProperty(n))}),this)),i.push(e),n[r]=e)},Pi.prototype.getPackage=function(e){return this.packageMap[e]},Pi.prototype.getPackages=function(){return this.packages},Pi.prototype.registerPackage=function(e){e=E({},e);var t=this.packageMap;Di(t,e,\"prefix\"),Di(t,e,\"uri\"),f(e.types,w((function(t){this.registerType(t,e)}),this)),t[e.uri]=t[e.prefix]=e,this.packages.push(e)},Pi.prototype.registerType=function(e,t){var n=Ci((e=E({},e,{superClass:(e.superClass||[]).slice(),extends:(e.extends||[]).slice(),properties:(e.properties||[]).slice(),meta:E(e.meta||{})})).name,t.prefix),i=n.name,r={};f(e.properties,w((function(e){var t=Ci(e.name,n.prefix),i=t.name;Ri(e.type)||(e.type=Ci(e.type,t.prefix).name),E(e,{ns:t,name:i}),r[i]=e}),this)),E(e,{ns:n,name:i,propertiesByName:r}),f(e.extends,w((function(e){var t=Ci(e,n.prefix),r=this.typeMap[t.name];r.traits=r.traits||[],r.traits.push(i)}),this)),this.definePackage(e,t),this.typeMap[i]=e},Pi.prototype.mapTypes=function(e,t,n){var i=Ri(e.name)?{name:e.name}:this.typeMap[e.name],r=this;function o(n,i){var o=Ci(n,Ri(n)?\"\":e.prefix);r.mapTypes(o,t,i)}function a(e){return o(e,!0)}if(!i)throw new Error(\"unknown type <\"+e.name+\">\");f(i.superClass,n?a:function(e){return o(e,!1)}),t(i,!n),f(i.traits,a)},Pi.prototype.getEffectiveDescriptor=function(e){var t=Ci(e),n=new Mi(t);this.mapTypes(t,(function(e,t){n.addTrait(e,t)}));var i=n.build();return this.definePackage(i,i.allTypes[i.allTypes.length-1].$pkg),i},Pi.prototype.definePackage=function(e,t){this.properties.define(e,\"$pkg\",{value:t})},Ni.prototype.set=function(e,t,n){if(!p(t)||!t.length)throw new TypeError(\"property name must be a non-empty string\");var i=this.getProperty(e,t),r=i&&i.name;void 0===n?i?delete e[r]:delete e.$attrs[Oi(t)]:i?r in e?e[r]=n:Ti(e,i,n):e.$attrs[Oi(t)]=n},Ni.prototype.get=function(e,t){var n=this.getProperty(e,t);if(!n)return e.$attrs[Oi(t)];var i=n.name;return!e[i]&&n.isMany&&Ti(e,n,[]),e[i]},Ni.prototype.define=function(e,t,n){if(!n.writable){var i=n.value;delete(n=E({},n,{get:function(){return i}})).value}Object.defineProperty(e,t,n)},Ni.prototype.defineDescriptor=function(e,t){this.define(e,\"$descriptor\",{value:t})},Ni.prototype.defineModel=function(e,t){this.define(e,\"$model\",{value:t})},Ni.prototype.getProperty=function(e,t){var n=this.model,i=n.getPropertyDescriptor(e,t);if(i)return i;if(t.includes(\":\"))return null;const r=n.config.strict;if(void 0!==r){const n=new TypeError(`unknown property <${t}> on <${e.$type}>`);if(r)throw n;\"undefined\"!=typeof console&&console.warn(n)}return null},Bi.prototype.create=function(e,t){var n=this.getType(e);if(!n)throw new Error(\"unknown type <\"+e+\">\");return new n(t)},Bi.prototype.getType=function(e){var t=this.typeCache,n=p(e)?e:e.ns.name,i=t[n];return i||(e=this.registry.getEffectiveDescriptor(n),i=t[n]=this.factory.createType(e)),i},Bi.prototype.createAny=function(e,t,n){var o=Ci(e),s={$type:e,$instanceOf:function(e){return e===this.$type},get:function(e){return this[e]},set:function(e,t){!function(e,t,n){let o=e;f(t,(function(e,a){if(\"number\"!=typeof e&&\"string\"!=typeof e)throw new Error(\"illegal key type: \"+typeof e+\". Key should be of type number or string.\");if(\"constructor\"===e)throw new Error(\"illegal key: constructor\");if(\"__proto__\"===e)throw new Error(\"illegal key: __proto__\");let s=t[a+1],l=o[e];r(s)&&null==l&&(l=o[e]=isNaN(+s)?{}:[]),i(s)?i(n)?delete o[e]:o[e]=n:o=l}))}(this,[e],t)}},l={name:e,isGeneric:!0,ns:{prefix:o.prefix,localName:o.localName,uri:t}};return this.properties.defineDescriptor(s,l),this.properties.defineModel(s,this),this.properties.define(s,\"get\",{enumerable:!1,writable:!0}),this.properties.define(s,\"set\",{enumerable:!1,writable:!0}),this.properties.define(s,\"$parent\",{enumerable:!1,writable:!0}),this.properties.define(s,\"$instanceOf\",{enumerable:!1,writable:!0}),f(n,(function(e,t){a(e)&&void 0!==e.value?s[e.name]=e.value:s[t]=e})),s},Bi.prototype.getPackage=function(e){return this.registry.getPackage(e)},Bi.prototype.getPackages=function(){return this.registry.getPackages()},Bi.prototype.getElementDescriptor=function(e){return e.$descriptor},Bi.prototype.hasType=function(e,t){return void 0===t&&(t=e,e=this),t in e.$model.getElementDescriptor(e).allTypesByName},Bi.prototype.getPropertyDescriptor=function(e,t){return this.getElementDescriptor(e).propertiesByName[t]},Bi.prototype.getTypeDescriptor=function(e){return this.registry.typeMap[e]};var Li=String.fromCharCode,Ii=Object.prototype.hasOwnProperty,ji=/&#(\\d+);|&#x([0-9a-f]+);|&(\\w+);/gi,Fi={amp:\"&\",apos:\"'\",gt:\">\",lt:\"<\",quot:'\"'};function Vi(e,t,n,i){return i?Ii.call(Fi,i)?Fi[i]:\"&\"+i+\";\":Li(t||parseInt(n,16))}function Wi(e){return e.length>3&&-1!==e.indexOf(\"&\")?e.replace(ji,Vi):e}Object.keys(Fi).forEach((function(e){Fi[e.toUpperCase()]=Fi[e]}));var zi=\"xsi:type\",$i=\"non-whitespace outside of root node\";function Gi(e){return new Error(e)}function Hi(e){return\"missing namespace for prefix <\"+e+\">\"}function Ki(e){return{get:e,enumerable:!0}}function Ui(e){var t,n={};for(t in e)n[t]=e[t];return n}function qi(e){return e+\"$uri\"}function Yi(){return{line:0,column:0}}function Xi(e){throw e}function Zi(e){if(!this)return new Zi(e);var t,n,i,r,o,a,s,l,p,c=e&&e.proxy,u=Xi,h=Yi,f=!1,m=!1,d=null,y=!1;function g(e){e instanceof Error||(e=Gi(e)),d=e,u(e,h)}function v(e){o&&(e instanceof Error||(e=Gi(e)),o(e,h))}this.on=function(e,p){if(\"function\"!=typeof p)throw Gi(\"required args <name, cb>\");switch(e){case\"openTag\":n=p;break;case\"text\":t=p;break;case\"closeTag\":i=p;break;case\"error\":u=p;break;case\"warn\":o=p;break;case\"cdata\":r=p;break;case\"attention\":l=p;break;case\"question\":s=p;break;case\"comment\":a=p;break;default:throw Gi(\"unsupported event: \"+e)}return this},this.ns=function(e){if(void 0===e&&(e={}),\"object\"!=typeof e)throw Gi(\"required args <nsMap={}>\");var t,n={};for(t in e)n[t]=e[t];return n[\"http://www.w3.org/2001/XMLSchema-instance\"]=\"xsi\",m=!0,p=n,this},this.parse=function(e){if(\"string\"!=typeof e)throw Gi(\"required args <xml=string>\");return d=null,function(e){var o,u,d,x,b,w,E,_,A,k,R,S=m?[]:null,C=m?function(e){var t,n,i={};for(t in e)i[n=e[t]]=n,i[qi(n)]=t;return i}(p):null,M=[],P=0,D=!1,N=!1,T=0,O=0,B=\"\",L=0;function I(){if(null!==R)return R;var e,t,n,i,r,o,a,s,l,c,u,h=m&&C.xmlns,d=m&&f?[]:null,y=L,g=B,x=g.length,b={},w={};e:for(;y<x;y++)if(l=!1,!(32===(c=g.charCodeAt(y))||c<14&&c>8)){for((c<65||c>122||c>90&&c<97)&&95!==c&&58!==c&&(v(\"illegal first char attribute name\"),l=!0),u=y+1;u<x;u++)if(!((c=g.charCodeAt(u))>96&&c<123||c>64&&c<91||c>47&&c<59||46===c||45===c||95===c)){if(32===c||c<14&&c>8){v(\"missing attribute value\"),y=u;continue e}if(61===c)break;v(\"illegal attribute name char\"),l=!0}if(\"xmlns:xmlns\"===(s=g.substring(y,u))&&(v(\"illegal declaration of xmlns\"),l=!0),34===(c=g.charCodeAt(u+1)))-1===(u=g.indexOf('\"',y=u+2))&&-1!==(u=g.indexOf(\"'\",y))&&(v(\"attribute value quote missmatch\"),l=!0);else if(39===c)-1===(u=g.indexOf(\"'\",y=u+2))&&-1!==(u=g.indexOf('\"',y))&&(v(\"attribute value quote missmatch\"),l=!0);else for(v(\"missing attribute value quotes\"),l=!0,u+=1;u<x&&!(32===(c=g.charCodeAt(u+1))||c<14&&c>8);u++);for(-1===u&&(v(\"missing closing quotes\"),u=x,l=!0),l||(o=g.substring(y,u)),y=u;u+1<x&&!(32===(c=g.charCodeAt(u+1))||c<14&&c>8);u++)y===u&&(v(\"illegal character after attribute end\"),l=!0);if(y=u+1,!l)if(s in w)v(\"attribute <\"+s+\"> already defined\");else if(w[s]=!0,m)if(f){if(null!==(r=\"xmlns\"===s?\"xmlns\":120===s.charCodeAt(0)&&\"xmlns:\"===s.substr(0,6)?s.substr(6):null)){if(e=Wi(o),t=qi(r),!(a=p[e])){if(\"xmlns\"===r||t in C&&C[t]!==e)do{a=\"ns\"+P++}while(void 0!==C[a]);else a=r;p[e]=a}C[r]!==a&&(i||(C=Ui(C),i=!0),C[r]=a,\"xmlns\"===r&&(C[qi(a)]=e,h=a),C[t]=e),b[s]=o;continue}d.push(s,o)}else-1!==(c=s.indexOf(\":\"))?(n=C[s.substring(0,c)])?((s=h===n?s.substr(c+1):n+s.substr(c))===zi&&(-1!==(c=o.indexOf(\":\"))?(n=o.substring(0,c),o=(n=C[n]||n)+o.substring(c)):o=h+\":\"+o),b[s]=o):v(Hi(s.substring(0,c))):b[s]=o;else b[s]=o}if(f)for(y=0,x=d.length;y<x;y++){if(s=d[y++],o=d[y],-1!==(c=s.indexOf(\":\"))){if(!(n=C[s.substring(0,c)])){v(Hi(s.substring(0,c)));continue}(s=h===n?s.substr(c+1):n+s.substr(c))===zi&&(-1!==(c=o.indexOf(\":\"))?(n=o.substring(0,c),o=(n=C[n]||n)+o.substring(c)):o=h+\":\"+o)}b[s]=o}return R=b}function j(){for(var t,n,i=/(\\r\\n|\\r|\\n)/g,r=0,o=0,a=0,s=O;T>=a&&(t=i.exec(e))&&!((s=t[0].length+t.index)>T);)r+=1,a=s;return-1==T?(o=s,n=e.substring(O)):0===O?n=e.substring(O,T):(o=T-a,n=-1==O?e.substring(T):e.substring(T,O+1)),{data:n,line:r,column:o}}h=j,c&&(k=Object.create({},{name:Ki((function(){return _})),originalName:Ki((function(){return A})),attrs:Ki(I),ns:Ki((function(){return C}))}));for(;-1!==O;){if(-1===(T=60===e.charCodeAt(O)?O:e.indexOf(\"<\",O)))return M.length?g(\"unexpected end of file\"):0===O?g(\"missing start tag\"):void(O<e.length&&e.substring(O).trim()&&v($i));if(O!==T)if(M.length){if(t&&(t(e.substring(O,T),Wi,h),y))return}else if(e.substring(O,T).trim()&&(v($i),y))return;if(33===(b=e.charCodeAt(T+1))){if(91===(x=e.charCodeAt(T+2))&&\"CDATA[\"===e.substr(T+3,6)){if(-1===(O=e.indexOf(\"]]>\",T)))return g(\"unclosed cdata\");if(r&&(r(e.substring(T+9,O),h),y))return;O+=3;continue}if(45===x&&45===e.charCodeAt(T+3)){if(-1===(O=e.indexOf(\"--\\x3e\",T)))return g(\"unclosed comment\");if(a&&(a(e.substring(T+4,O),Wi,h),y))return;O+=3;continue}}if(63!==b){for(u=T+1;;u++){if(w=e.charCodeAt(u),isNaN(w))return O=-1,g(\"unclosed tag\");if(34===w)u=-1!==(x=e.indexOf('\"',u+1))?x:u;else if(39===w)u=-1!==(x=e.indexOf(\"'\",u+1))?x:u;else if(62===w){O=u;break}}if(33!==b){if(R={},47===b){if(D=!1,N=!0,!M.length)return g(\"missing open tag\");if(u=_=M.pop(),x=T+2+u.length,e.substring(T+2,x)!==u)return g(\"closing tag mismatch\");for(;x<O;x++)if(!(32===(b=e.charCodeAt(x))||b>8&&b<14))return g(\"close tag\")}else{if(47===e.charCodeAt(O-1)?(u=_=e.substring(T+1,O-1),D=!0,N=!0):(u=_=e.substring(T+1,O),D=!0,N=!1),!(b>96&&b<123||b>64&&b<91||95===b||58===b))return g(\"illegal first char nodeName\");for(x=1,d=u.length;x<d;x++)if(!((b=u.charCodeAt(x))>96&&b<123||b>64&&b<91||b>47&&b<59||45===b||95===b||46==b)){if(32===b||b<14&&b>8){_=u.substring(0,x),R=null;break}return g(\"invalid nodeName\")}N||M.push(_)}if(m){if(o=C,D&&(N||S.push(o),null===R&&(f=-1!==u.indexOf(\"xmlns\",x))&&(L=x,B=u,I(),f=!1)),A=_,-1!==(b=_.indexOf(\":\"))){if(!(E=C[_.substring(0,b)]))return g(\"missing namespace on <\"+A+\">\");_=_.substr(b+1)}else E=C.xmlns;E&&(_=E+\":\"+_)}if(D&&(L=x,B=u,n&&(c?n(k,Wi,N,h):n(_,I,Wi,N,h),y)))return;if(N){if(i&&(i(c?k:_,Wi,D,h),y))return;m&&(C=D?o:S.pop())}O+=1}else{if(l&&(l(e.substring(T,O+1),Wi,h),y))return;O+=1}}else{if(-1===(O=e.indexOf(\"?>\",T)))return g(\"unclosed question\");if(s&&(s(e.substring(T,O+2),h),y))return;O+=2}}}(e),h=Yi,y=!1,d},this.stop=function(){y=!0}}function Ji(e){return e.xml&&\"lowerCase\"===e.xml.tagAlias}var Qi={xsi:\"http://www.w3.org/2001/XMLSchema-instance\",xml:\"http://www.w3.org/XML/1998/namespace\"},er=\"xsi:type\";function tr(e){return e.xml&&e.xml.serialize}function nr(e){return tr(e)===er}function ir(e,t){return Ji(t)?e.prefix+\":\"+((n=e.localName).charAt(0).toUpperCase()+n.slice(1)):e.name;var n}function rr(e){return new Error(e)}function or(e){return e.$descriptor}function ar(e){E(this,e),this.elementsById={},this.references=[],this.warnings=[],this.addReference=function(e){this.references.push(e)},this.addElement=function(e){if(!e)throw rr(\"expected element\");var t,n=this.elementsById,i=or(e).idProperty;if(i&&(t=e.get(i.name))){if(!/^([a-z][\\w-.]*:)?[a-z_][\\w-.]*$/i.test(t))throw new Error(\"illegal ID <\"+t+\">\");if(n[t])throw rr(\"duplicate ID <\"+t+\">\");n[t]=e}},this.addWarning=function(e){this.warnings.push(e)}}function sr(){}function lr(){}function pr(){}function cr(e,t){this.property=e,this.context=t}function ur(e,t){this.element=t,this.propertyDesc=e}function hr(){}function fr(e,t,n){this.model=e,this.type=e.getType(t),this.context=n}function mr(e,t,n){fr.call(this,e,t,n)}function dr(e,t,n){this.model=e,this.context=n}function yr(e){e instanceof Bi&&(e={model:e}),E(this,{lax:!1},e)}sr.prototype.handleEnd=function(){},sr.prototype.handleText=function(){},sr.prototype.handleNode=function(){},lr.prototype=Object.create(sr.prototype),lr.prototype.handleNode=function(){return this},pr.prototype=Object.create(sr.prototype),pr.prototype.handleText=function(e){this.body=(this.body||\"\")+e},cr.prototype=Object.create(pr.prototype),cr.prototype.handleNode=function(e){if(this.element)throw rr(\"expected no sub nodes\");return this.element=this.createReference(e),this},cr.prototype.handleEnd=function(){this.element.id=this.body},cr.prototype.createReference=function(e){return{property:this.property.ns.name,id:\"\"}},ur.prototype=Object.create(pr.prototype),ur.prototype.handleEnd=function(){var e=this.body||\"\",t=this.element,n=this.propertyDesc;e=ki(n.type,e),n.isMany?t.get(n.name).push(e):t.set(n.name,e)},hr.prototype=Object.create(pr.prototype),hr.prototype.handleNode=function(e){var t=this,n=this.element;return n?t=this.handleChild(e):(n=this.element=this.createElement(e),this.context.addElement(n)),t},fr.prototype=Object.create(hr.prototype),fr.prototype.addReference=function(e){this.context.addReference(e)},fr.prototype.handleText=function(e){if(!or(this.element).bodyProperty)throw rr(\"unexpected body text <\"+e+\">\");pr.prototype.handleText.call(this,e)},fr.prototype.handleEnd=function(){var e=this.body,t=this.element,n=or(t).bodyProperty;n&&void 0!==e&&(e=ki(n.type,e),t.set(n.name,e))},fr.prototype.createElement=function(e){var t,n=e.attributes,i=this.type,r=or(i),o=this.context,a=new i({}),s=this.model;return f(n,(function(e,n){var i=r.propertiesByName[n];i&&i.isReference?i.isMany?f(e.split(\" \"),(function(e){o.addReference({element:a,property:i.ns.name,id:e})})):o.addReference({element:a,property:i.ns.name,id:e}):(i?e=ki(i.type,e):\"xmlns\"!==n&&(t=Ci(n,r.ns.prefix),s.getPackage(t.prefix)&&o.addWarning({message:\"unknown attribute <\"+n+\">\",element:a,property:n,value:e})),a.set(n,e))})),a},fr.prototype.getPropertyForNode=function(e){var t,n,i=Ci(e.name),r=this.type,o=this.model,a=or(r),s=i.name,l=a.propertiesByName[s];if(l&&!l.isAttr)return nr(l)&&(t=e.attributes[er])?(t=function(e,t){var n=Ci(e);return function(e,t){var n=e.name,i=e.localName,r=t.xml&&t.xml.typePrefix;return r&&0===i.indexOf(r)?e.prefix+\":\"+i.slice(r.length):n}(n,t.getPackage(n.prefix))}(t,o),E({},l,{effectiveType:or(n=o.getType(t)).name})):l;var p=o.getPackage(i.prefix);if(p){if(t=ir(i,p),n=o.getType(t),l=u(a.properties,(function(e){return!e.isVirtual&&!e.isReference&&!e.isAttribute&&n.hasType(e.type)})))return E({},l,{effectiveType:or(n).name})}else if(l=u(a.properties,(function(e){return!e.isReference&&!e.isAttribute&&\"Element\"===e.type})))return l;throw rr(\"unrecognized element <\"+i.name+\">\")},fr.prototype.toString=function(){return\"ElementDescriptor[\"+or(this.type).name+\"]\"},fr.prototype.valueHandler=function(e,t){return new ur(e,t)},fr.prototype.referenceHandler=function(e){return new cr(e,this.context)},fr.prototype.handler=function(e){return\"Element\"===e?new dr(this.model,e,this.context):new fr(this.model,e,this.context)},fr.prototype.handleChild=function(e){var t,n,i,r;if(t=this.getPropertyForNode(e),i=this.element,Si(n=t.effectiveType||t.type))return this.valueHandler(t,i);var o=(r=t.isReference?this.referenceHandler(t).handleNode(e):this.handler(n).handleNode(e)).element;return void 0!==o&&(t.isMany?i.get(t.name).push(o):i.set(t.name,o),t.isReference?(E(o,{element:i}),this.context.addReference(o)):o.$parent=i),r},mr.prototype=Object.create(fr.prototype),mr.prototype.createElement=function(e){var t=e.name,n=Ci(t),i=this.model,r=this.type,o=i.getPackage(n.prefix),a=o&&ir(n,o)||t;if(!r.hasType(a))throw rr(\"unexpected element <\"+e.originalName+\">\");return fr.prototype.createElement.call(this,e)},dr.prototype=Object.create(hr.prototype),dr.prototype.createElement=function(e){var t=e.name,n=Ci(t).prefix,i=e.ns[n+\"$uri\"],r=e.attributes;return this.model.createAny(t,i,r)},dr.prototype.handleChild=function(e){var t=new dr(this.model,\"Element\",this.context).handleNode(e),n=this.element,i=t.element;return void 0!==i&&((n.$children=n.$children||[]).push(i),i.$parent=n),t},dr.prototype.handleEnd=function(){this.body&&(this.element.$body=this.body)},yr.prototype.fromXML=function(e,t,n){var i=t.rootHandler;t instanceof fr?(i=t,t={}):\"string\"==typeof t?(i=this.handler(t),t={}):\"string\"==typeof i&&(i=this.handler(i));var r=this.model,o=this.lax,a=new ar(E({},t,{rootHandler:i})),s=new Zi({proxy:!0}),l=function(){var e=[];return Object.defineProperty(e,\"peek\",{value:function(){return this[this.length-1]}}),e}();function p(e,t,n){var i=t(),r=i.line,o=i.column,s=i.data;\"<\"===s.charAt(0)&&-1!==s.indexOf(\" \")&&(s=s.slice(0,s.indexOf(\" \"))+\">\");var l=\"unparsable content \"+(s?s+\" \":\"\")+\"detected\\n\\tline: \"+r+\"\\n\\tcolumn: \"+o+\"\\n\\tnested error: \"+e.message;if(n)return a.addWarning({message:l,error:e}),!0;throw rr(l)}function c(e,t){return p(e,t,!0)}i.context=a,l.push(i);var u=/^<\\?xml /i,h=/ encoding=\"([^\"]+)\"/i,f=/^utf-8$/i;function m(e,t){try{l.peek().handleText(e)}catch(e){c(e,t)}}var d=r.getPackages().reduce((function(e,t){return e[t.uri]=t.prefix,e}),{\"http://www.w3.org/XML/1998/namespace\":\"xml\"});return s.ns(d).on(\"openTag\",(function(e,t,n,i){var r=e.attrs||{},a=Object.keys(r).reduce((function(e,n){var i=t(r[n]);return e[n]=i,e}),{});!function(e,t){var n=l.peek();try{l.push(n.handleNode(e))}catch(e){p(e,t,o)&&l.push(new lr)}}({name:e.name,originalName:e.originalName,attributes:a,ns:e.ns},i)})).on(\"question\",(function(e){if(u.test(e)){var t=h.exec(e),n=t&&t[1];n&&!f.test(n)&&a.addWarning({message:\"unsupported document encoding <\"+n+\">, falling back to UTF-8\"})}})).on(\"closeTag\",(function(){l.pop().handleEnd()})).on(\"cdata\",m).on(\"text\",(function(e,t,n){!function(e,t){e.trim()&&m(e,t)}(t(e),n)})).on(\"error\",p).on(\"warn\",c),new Promise((function(t,n){var r;try{s.parse(e),function(){var e,t,n=a.elementsById,i=a.references;for(e=0;t=i[e];e++){var r=t.element,o=n[t.id],s=or(r).propertiesByName[t.property];if(o||a.addWarning({message:\"unresolved reference <\"+t.id+\">\",element:t.element,property:t.property,value:t.id}),s.isMany){var l=r.get(s.name),p=l.indexOf(t);-1===p&&(p=l.length),o?l[p]=o:l.splice(p,1)}else r.set(s.name,o)}}()}catch(e){r=e}var o=i.element;r||o||(r=rr(\"failed to parse document as <\"+i.type.$descriptor.name+\">\"));var l=a.warnings,p=a.references,c=a.elementsById;return r?(r.warnings=l,n(r)):t({rootElement:o,elementsById:c,references:p,warnings:l})}))},yr.prototype.handler=function(e){return new mr(this.model,e)};var gr=/<|>|'|\"|&|\\n\\r|\\n/g,vr=/<|>|&/g;function xr(e){var t={},n={},i={},r=[],o=[];this.byUri=function(t){return n[t]||e&&e.byUri(t)},this.add=function(e,t){n[e.uri]=e,t?r.push(e):o.push(e),this.mapPrefix(e.prefix,e.uri)},this.uriByPrefix=function(e){return t[e||\"xmlns\"]},this.mapPrefix=function(e,n){t[e||\"xmlns\"]=n},this.getNSKey=function(e){return void 0!==e.prefix?e.uri+\"|\"+e.prefix:e.uri},this.logUsed=function(t){var n=t.uri,r=this.getNSKey(t);i[r]=this.byUri(n),e&&e.logUsed(t)},this.getUsed=function(e){var t=this;return[].concat(r,o).filter((function(e){var n=t.getNSKey(e);return i[n]}))}}function br(e,t){return Ji(t)?(n=e).charAt(0).toLowerCase()+n.slice(1):e;var n}function wr(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function Er(e){return p(e)?e:(e.prefix?e.prefix+\":\":\"\")+e.localName}var _r={\"\\n\":\"#10\",\"\\n\\r\":\"#10\",'\"':\"#34\",\"'\":\"#39\",\"<\":\"#60\",\">\":\"#62\",\"&\":\"#38\"},Ar={\"<\":\"lt\",\">\":\"gt\",\"&\":\"amp\"};function kr(e,t,n){return(e=p(e)?e:\"\"+e).replace(t,(function(e){return\"&\"+n[e]+\";\"}))}function Rr(e){this.tagName=e}function Sr(){}function Cr(e){this.tagName=e}function Mr(e,t){this.body=[],this.attrs=[],this.parent=e,this.propertyDescriptor=t}function Pr(e,t){Mr.call(this,e,t)}function Dr(){this.value=\"\",this.write=function(e){this.value+=e}}function Nr(e,t){var n=[\"\"];this.append=function(t){return e.write(t),this},this.appendNewLine=function(){return t&&e.write(\"\\n\"),this},this.appendIndent=function(){return t&&e.write(n.join(\"  \")),this},this.indent=function(){return n.push(\"\"),this},this.unindent=function(){return n.pop(),this}}function Tr(e){return e=E({format:!1,preamble:!0},e||{}),{toXML:function(t,n){var i=n||new Dr,r=new Nr(i,e.format);if(e.preamble&&r.append('<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n'),(new Mr).build(t).serializeTo(r),!n)return i.value}}}function Or(e,t){Bi.call(this,e,t)}Rr.prototype.build=function(e){return this.element=e,this},Rr.prototype.serializeTo=function(e){e.appendIndent().append(\"<\"+this.tagName+\">\"+this.element.id+\"</\"+this.tagName+\">\").appendNewLine()},Sr.prototype.serializeValue=Sr.prototype.serializeTo=function(e){e.append(this.escape?kr(this.value,vr,Ar):this.value)},Sr.prototype.build=function(e,t){return this.value=t,\"String\"===e.type&&-1!==t.search(vr)&&(this.escape=!0),this},wr(Cr,Sr),Cr.prototype.serializeTo=function(e){e.appendIndent().append(\"<\"+this.tagName+\">\"),this.serializeValue(e),e.append(\"</\"+this.tagName+\">\").appendNewLine()},Mr.prototype.build=function(e){this.element=e;var t,n,i=e.$descriptor,r=this.propertyDescriptor,o=i.isGeneric;return t=o?this.parseGeneric(e):this.parseNsAttributes(e),this.ns=r?this.nsPropertyTagName(r):this.nsTagName(i),this.tagName=this.addTagName(this.ns),o||(n=function(e){return h(e.$descriptor.properties,(function(t){var n=t.name;if(t.isVirtual)return!1;if(!c(e,n))return!1;var i=e[n];return i!==t.default&&null!==i&&(!t.isMany||i.length)}))}(e),this.parseAttributes(h(n,(function(e){return e.isAttr}))),this.parseContainments(function(e){return h(e,(function(e){return!e.isAttr}))}(n))),this.parseGenericAttributes(e,t),this},Mr.prototype.nsTagName=function(e){return function(e,t){return t.isGeneric?E({localName:t.ns.localName},e):E({localName:br(t.ns.localName,t.$pkg)},e)}(this.logNamespaceUsed(e.ns),e)},Mr.prototype.nsPropertyTagName=function(e){return function(e,t){return E({localName:t.ns.localName},e)}(this.logNamespaceUsed(e.ns),e)},Mr.prototype.isLocalNs=function(e){return e.uri===this.ns.uri},Mr.prototype.nsAttributeName=function(e){var t;if(t=p(e)?Ci(e):e.ns,e.inherited)return{localName:t.localName};var n=this.logNamespaceUsed(t);return this.getNamespaces().logUsed(n),this.isLocalNs(n)?{localName:t.localName}:E({localName:t.localName},n)},Mr.prototype.parseGeneric=function(e){var t=this,n=this.body,i=[];return f(e,(function(r,o){\"$body\"===o?n.push((new Sr).build({type:\"String\"},r)):\"$children\"===o?f(r,(function(e){n.push(new Mr(t).build(e))})):0!==o.indexOf(\"$\")&&t.parseNsAttribute(e,o,r)&&i.push({name:o,value:r})})),i},Mr.prototype.parseNsAttribute=function(e,t,n){var i,r=e.$model,o=Ci(t);if(\"xmlns\"===o.prefix&&(i={prefix:o.localName,uri:n}),o.prefix||\"xmlns\"!==o.localName||(i={uri:n}),!i)return{name:t,value:n};if(r&&r.getPackage(n))this.logNamespace(i,!0,!0);else{var a=this.logNamespaceUsed(i,!0);this.getNamespaces().logUsed(a)}},Mr.prototype.parseNsAttributes=function(e,t){var n=this,i=e.$attrs,r=[];return f(i,(function(t,i){var o=n.parseNsAttribute(e,i,t);o&&r.push(o)})),r},Mr.prototype.parseGenericAttributes=function(e,t){var n=this;f(t,(function(t){if(t.name!==er)try{n.addAttribute(n.nsAttributeName(t.name),t.value)}catch(n){console.warn(\"missing namespace information for \",t.name,\"=\",t.value,\"on\",e,n)}}))},Mr.prototype.parseContainments=function(e){var t=this,n=this.body,i=this.element;f(e,(function(e){var r=i.get(e.name),o=e.isReference;if(e.isMany||(r=[r]),e.isBody)n.push((new Sr).build(e,r[0]));else if(Si(e.type))f(r,(function(i){n.push(new Cr(t.addTagName(t.nsPropertyTagName(e))).build(e,i))}));else if(o)f(r,(function(i){n.push(new Rr(t.addTagName(t.nsPropertyTagName(e))).build(i))}));else{var a=nr(e),s=function(e){return\"property\"===tr(e)}(e);f(r,(function(i){var r;r=a?new Pr(t,e):s?new Mr(t,e):new Mr(t),n.push(r.build(i))}))}}))},Mr.prototype.getNamespaces=function(e){var t,n=this.namespaces,i=this.parent;return n||(t=i&&i.getNamespaces(),e||!t?this.namespaces=n=new xr(t):n=t),n},Mr.prototype.logNamespace=function(e,t,n){var i=this.getNamespaces(n),r=e.uri,o=e.prefix;return i.byUri(r)&&!n||i.add(e,t),i.mapPrefix(o,r),e},Mr.prototype.logNamespaceUsed=function(e,t){var n,i,r,o=this.element.$model,a=this.getNamespaces(t),s=e.prefix,l=e.uri;if(!s&&!l)return{localName:e.localName};if(r=Qi[s]||o&&(o.getPackage(s)||{}).uri,!(l=l||r||a.uriByPrefix(s)))throw new Error(\"no namespace uri given for prefix <\"+s+\">\");if(!(e=a.byUri(l))){for(n=s,i=1;a.uriByPrefix(n);)n=s+\"_\"+i++;e=this.logNamespace({prefix:n,uri:l},r===l)}return s&&a.mapPrefix(s,l),e},Mr.prototype.parseAttributes=function(e){var t=this,n=this.element;f(e,(function(e){var i=n.get(e.name);if(e.isReference)if(e.isMany){var r=[];f(i,(function(e){r.push(e.id)})),i=r.join(\" \")}else i=i.id;t.addAttribute(t.nsAttributeName(e),i)}))},Mr.prototype.addTagName=function(e){var t=this.logNamespaceUsed(e);return this.getNamespaces().logUsed(t),Er(e)},Mr.prototype.addAttribute=function(e,t){var n=this.attrs;p(t)&&(t=kr(t,gr,_r));var i=function(e,t){const n=v(t);let i=o(e)?-1:void 0;return f(e,(function(e,t){if(n(e,t))return i=t,!1})),i}(n,(function(t){return t.name.localName===e.localName&&t.name.uri===e.uri&&t.name.prefix===e.prefix})),r={name:e,value:t};-1!==i?n.splice(i,1,r):n.push(r)},Mr.prototype.serializeAttributes=function(e){var t=this.attrs,n=this.namespaces;n&&(t=function(e){return e.getUsed().filter((function(e){return\"xml\"!==e.prefix})).map((function(e){return{name:\"xmlns\"+(e.prefix?\":\"+e.prefix:\"\"),value:e.uri}}))}(n).concat(t)),f(t,(function(t){e.append(\" \").append(Er(t.name)).append('=\"').append(t.value).append('\"')}))},Mr.prototype.serializeTo=function(e){var t=this.body[0],n=t&&t.constructor!==Sr;e.appendIndent().append(\"<\"+this.tagName),this.serializeAttributes(e),e.append(t?\">\":\" />\"),t&&(n&&e.appendNewLine().indent(),f(this.body,(function(t){t.serializeTo(e)})),n&&e.unindent().appendIndent(),e.append(\"</\"+this.tagName+\">\")),e.appendNewLine()},wr(Pr,Mr),Pr.prototype.parseNsAttributes=function(e){var t=Mr.prototype.parseNsAttributes.call(this,e),n=e.$descriptor;if(n.name===this.propertyDescriptor.type)return t;var i=this.typeNs=this.nsTagName(n);this.getNamespaces().logUsed(this.typeNs);var r=e.$model.getPackage(i.uri),o=r.xml&&r.xml.typePrefix||\"\";return this.addAttribute(this.nsAttributeName(er),(i.prefix?i.prefix+\":\":\"\")+o+n.ns.localName),t},Pr.prototype.isLocalNs=function(e){return e.uri===(this.typeNs||this.ns).uri},Or.prototype=Object.create(Bi.prototype),Or.prototype.fromXML=function(e,t,n){p(t)||(n=t,t=\"bpmn:Definitions\");var i=new yr(E({model:this,lax:!0},n)),r=i.handler(t);return i.fromXML(e,r)},Or.prototype.toXML=function(e,t){var n=new Tr(t);return new Promise((function(t,i){try{return t({xml:n.toXML(e)})}catch(e){return i(e)}}))};var Br={bpmn:{name:\"BPMN20\",uri:\"http://www.omg.org/spec/BPMN/20100524/MODEL\",prefix:\"bpmn\",associations:[],types:[{name:\"Interface\",superClass:[\"RootElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"operations\",type:\"Operation\",isMany:!0},{name:\"implementationRef\",isAttr:!0,type:\"String\"}]},{name:\"Operation\",superClass:[\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"inMessageRef\",type:\"Message\",isReference:!0},{name:\"outMessageRef\",type:\"Message\",isReference:!0},{name:\"errorRef\",type:\"Error\",isMany:!0,isReference:!0},{name:\"implementationRef\",isAttr:!0,type:\"String\"}]},{name:\"EndPoint\",superClass:[\"RootElement\"]},{name:\"Auditing\",superClass:[\"BaseElement\"]},{name:\"GlobalTask\",superClass:[\"CallableElement\"],properties:[{name:\"resources\",type:\"ResourceRole\",isMany:!0}]},{name:\"Monitoring\",superClass:[\"BaseElement\"]},{name:\"Performer\",superClass:[\"ResourceRole\"]},{name:\"Process\",superClass:[\"FlowElementsContainer\",\"CallableElement\"],properties:[{name:\"processType\",type:\"ProcessType\",isAttr:!0},{name:\"isClosed\",isAttr:!0,type:\"Boolean\"},{name:\"auditing\",type:\"Auditing\"},{name:\"monitoring\",type:\"Monitoring\"},{name:\"properties\",type:\"Property\",isMany:!0},{name:\"laneSets\",isMany:!0,replaces:\"FlowElementsContainer#laneSets\",type:\"LaneSet\"},{name:\"flowElements\",isMany:!0,replaces:\"FlowElementsContainer#flowElements\",type:\"FlowElement\"},{name:\"artifacts\",type:\"Artifact\",isMany:!0},{name:\"resources\",type:\"ResourceRole\",isMany:!0},{name:\"correlationSubscriptions\",type:\"CorrelationSubscription\",isMany:!0},{name:\"supports\",type:\"Process\",isMany:!0,isReference:!0},{name:\"definitionalCollaborationRef\",type:\"Collaboration\",isAttr:!0,isReference:!0},{name:\"isExecutable\",isAttr:!0,type:\"Boolean\"}]},{name:\"LaneSet\",superClass:[\"BaseElement\"],properties:[{name:\"lanes\",type:\"Lane\",isMany:!0},{name:\"name\",isAttr:!0,type:\"String\"}]},{name:\"Lane\",superClass:[\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"partitionElementRef\",type:\"BaseElement\",isAttr:!0,isReference:!0},{name:\"partitionElement\",type:\"BaseElement\"},{name:\"flowNodeRef\",type:\"FlowNode\",isMany:!0,isReference:!0},{name:\"childLaneSet\",type:\"LaneSet\",xml:{serialize:\"xsi:type\"}}]},{name:\"GlobalManualTask\",superClass:[\"GlobalTask\"]},{name:\"ManualTask\",superClass:[\"Task\"]},{name:\"UserTask\",superClass:[\"Task\"],properties:[{name:\"renderings\",type:\"Rendering\",isMany:!0},{name:\"implementation\",isAttr:!0,type:\"String\"}]},{name:\"Rendering\",superClass:[\"BaseElement\"]},{name:\"HumanPerformer\",superClass:[\"Performer\"]},{name:\"PotentialOwner\",superClass:[\"HumanPerformer\"]},{name:\"GlobalUserTask\",superClass:[\"GlobalTask\"],properties:[{name:\"implementation\",isAttr:!0,type:\"String\"},{name:\"renderings\",type:\"Rendering\",isMany:!0}]},{name:\"Gateway\",isAbstract:!0,superClass:[\"FlowNode\"],properties:[{name:\"gatewayDirection\",type:\"GatewayDirection\",default:\"Unspecified\",isAttr:!0}]},{name:\"EventBasedGateway\",superClass:[\"Gateway\"],properties:[{name:\"instantiate\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"eventGatewayType\",type:\"EventBasedGatewayType\",isAttr:!0,default:\"Exclusive\"}]},{name:\"ComplexGateway\",superClass:[\"Gateway\"],properties:[{name:\"activationCondition\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"default\",type:\"SequenceFlow\",isAttr:!0,isReference:!0}]},{name:\"ExclusiveGateway\",superClass:[\"Gateway\"],properties:[{name:\"default\",type:\"SequenceFlow\",isAttr:!0,isReference:!0}]},{name:\"InclusiveGateway\",superClass:[\"Gateway\"],properties:[{name:\"default\",type:\"SequenceFlow\",isAttr:!0,isReference:!0}]},{name:\"ParallelGateway\",superClass:[\"Gateway\"]},{name:\"RootElement\",isAbstract:!0,superClass:[\"BaseElement\"]},{name:\"Relationship\",superClass:[\"BaseElement\"],properties:[{name:\"type\",isAttr:!0,type:\"String\"},{name:\"direction\",type:\"RelationshipDirection\",isAttr:!0},{name:\"source\",isMany:!0,isReference:!0,type:\"Element\"},{name:\"target\",isMany:!0,isReference:!0,type:\"Element\"}]},{name:\"BaseElement\",isAbstract:!0,properties:[{name:\"id\",isAttr:!0,type:\"String\",isId:!0},{name:\"documentation\",type:\"Documentation\",isMany:!0},{name:\"extensionDefinitions\",type:\"ExtensionDefinition\",isMany:!0,isReference:!0},{name:\"extensionElements\",type:\"ExtensionElements\"}]},{name:\"Extension\",properties:[{name:\"mustUnderstand\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"definition\",type:\"ExtensionDefinition\",isAttr:!0,isReference:!0}]},{name:\"ExtensionDefinition\",properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"extensionAttributeDefinitions\",type:\"ExtensionAttributeDefinition\",isMany:!0}]},{name:\"ExtensionAttributeDefinition\",properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"type\",isAttr:!0,type:\"String\"},{name:\"isReference\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"extensionDefinition\",type:\"ExtensionDefinition\",isAttr:!0,isReference:!0}]},{name:\"ExtensionElements\",properties:[{name:\"valueRef\",isAttr:!0,isReference:!0,type:\"Element\"},{name:\"values\",type:\"Element\",isMany:!0},{name:\"extensionAttributeDefinition\",type:\"ExtensionAttributeDefinition\",isAttr:!0,isReference:!0}]},{name:\"Documentation\",superClass:[\"BaseElement\"],properties:[{name:\"text\",type:\"String\",isBody:!0},{name:\"textFormat\",default:\"text/plain\",isAttr:!0,type:\"String\"}]},{name:\"Event\",isAbstract:!0,superClass:[\"FlowNode\",\"InteractionNode\"],properties:[{name:\"properties\",type:\"Property\",isMany:!0}]},{name:\"IntermediateCatchEvent\",superClass:[\"CatchEvent\"]},{name:\"IntermediateThrowEvent\",superClass:[\"ThrowEvent\"]},{name:\"EndEvent\",superClass:[\"ThrowEvent\"]},{name:\"StartEvent\",superClass:[\"CatchEvent\"],properties:[{name:\"isInterrupting\",default:!0,isAttr:!0,type:\"Boolean\"}]},{name:\"ThrowEvent\",isAbstract:!0,superClass:[\"Event\"],properties:[{name:\"dataInputs\",type:\"DataInput\",isMany:!0},{name:\"dataInputAssociations\",type:\"DataInputAssociation\",isMany:!0},{name:\"inputSet\",type:\"InputSet\"},{name:\"eventDefinitions\",type:\"EventDefinition\",isMany:!0},{name:\"eventDefinitionRef\",type:\"EventDefinition\",isMany:!0,isReference:!0}]},{name:\"CatchEvent\",isAbstract:!0,superClass:[\"Event\"],properties:[{name:\"parallelMultiple\",isAttr:!0,type:\"Boolean\",default:!1},{name:\"dataOutputs\",type:\"DataOutput\",isMany:!0},{name:\"dataOutputAssociations\",type:\"DataOutputAssociation\",isMany:!0},{name:\"outputSet\",type:\"OutputSet\"},{name:\"eventDefinitions\",type:\"EventDefinition\",isMany:!0},{name:\"eventDefinitionRef\",type:\"EventDefinition\",isMany:!0,isReference:!0}]},{name:\"BoundaryEvent\",superClass:[\"CatchEvent\"],properties:[{name:\"cancelActivity\",default:!0,isAttr:!0,type:\"Boolean\"},{name:\"attachedToRef\",type:\"Activity\",isAttr:!0,isReference:!0}]},{name:\"EventDefinition\",isAbstract:!0,superClass:[\"RootElement\"]},{name:\"CancelEventDefinition\",superClass:[\"EventDefinition\"]},{name:\"ErrorEventDefinition\",superClass:[\"EventDefinition\"],properties:[{name:\"errorRef\",type:\"Error\",isAttr:!0,isReference:!0}]},{name:\"TerminateEventDefinition\",superClass:[\"EventDefinition\"]},{name:\"EscalationEventDefinition\",superClass:[\"EventDefinition\"],properties:[{name:\"escalationRef\",type:\"Escalation\",isAttr:!0,isReference:!0}]},{name:\"Escalation\",properties:[{name:\"structureRef\",type:\"ItemDefinition\",isAttr:!0,isReference:!0},{name:\"name\",isAttr:!0,type:\"String\"},{name:\"escalationCode\",isAttr:!0,type:\"String\"}],superClass:[\"RootElement\"]},{name:\"CompensateEventDefinition\",superClass:[\"EventDefinition\"],properties:[{name:\"waitForCompletion\",isAttr:!0,type:\"Boolean\",default:!0},{name:\"activityRef\",type:\"Activity\",isAttr:!0,isReference:!0}]},{name:\"TimerEventDefinition\",superClass:[\"EventDefinition\"],properties:[{name:\"timeDate\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"timeCycle\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"timeDuration\",type:\"Expression\",xml:{serialize:\"xsi:type\"}}]},{name:\"LinkEventDefinition\",superClass:[\"EventDefinition\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"target\",type:\"LinkEventDefinition\",isReference:!0},{name:\"source\",type:\"LinkEventDefinition\",isMany:!0,isReference:!0}]},{name:\"MessageEventDefinition\",superClass:[\"EventDefinition\"],properties:[{name:\"messageRef\",type:\"Message\",isAttr:!0,isReference:!0},{name:\"operationRef\",type:\"Operation\",isAttr:!0,isReference:!0}]},{name:\"ConditionalEventDefinition\",superClass:[\"EventDefinition\"],properties:[{name:\"condition\",type:\"Expression\",xml:{serialize:\"xsi:type\"}}]},{name:\"SignalEventDefinition\",superClass:[\"EventDefinition\"],properties:[{name:\"signalRef\",type:\"Signal\",isAttr:!0,isReference:!0}]},{name:\"Signal\",superClass:[\"RootElement\"],properties:[{name:\"structureRef\",type:\"ItemDefinition\",isAttr:!0,isReference:!0},{name:\"name\",isAttr:!0,type:\"String\"}]},{name:\"ImplicitThrowEvent\",superClass:[\"ThrowEvent\"]},{name:\"DataState\",superClass:[\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"}]},{name:\"ItemAwareElement\",superClass:[\"BaseElement\"],properties:[{name:\"itemSubjectRef\",type:\"ItemDefinition\",isAttr:!0,isReference:!0},{name:\"dataState\",type:\"DataState\"}]},{name:\"DataAssociation\",superClass:[\"BaseElement\"],properties:[{name:\"sourceRef\",type:\"ItemAwareElement\",isMany:!0,isReference:!0},{name:\"targetRef\",type:\"ItemAwareElement\",isReference:!0},{name:\"transformation\",type:\"FormalExpression\",xml:{serialize:\"property\"}},{name:\"assignment\",type:\"Assignment\",isMany:!0}]},{name:\"DataInput\",superClass:[\"ItemAwareElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"isCollection\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"inputSetRef\",type:\"InputSet\",isMany:!0,isVirtual:!0,isReference:!0},{name:\"inputSetWithOptional\",type:\"InputSet\",isMany:!0,isVirtual:!0,isReference:!0},{name:\"inputSetWithWhileExecuting\",type:\"InputSet\",isMany:!0,isVirtual:!0,isReference:!0}]},{name:\"DataOutput\",superClass:[\"ItemAwareElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"isCollection\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"outputSetRef\",type:\"OutputSet\",isMany:!0,isVirtual:!0,isReference:!0},{name:\"outputSetWithOptional\",type:\"OutputSet\",isMany:!0,isVirtual:!0,isReference:!0},{name:\"outputSetWithWhileExecuting\",type:\"OutputSet\",isMany:!0,isVirtual:!0,isReference:!0}]},{name:\"InputSet\",superClass:[\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"dataInputRefs\",type:\"DataInput\",isMany:!0,isReference:!0},{name:\"optionalInputRefs\",type:\"DataInput\",isMany:!0,isReference:!0},{name:\"whileExecutingInputRefs\",type:\"DataInput\",isMany:!0,isReference:!0},{name:\"outputSetRefs\",type:\"OutputSet\",isMany:!0,isReference:!0}]},{name:\"OutputSet\",superClass:[\"BaseElement\"],properties:[{name:\"dataOutputRefs\",type:\"DataOutput\",isMany:!0,isReference:!0},{name:\"name\",isAttr:!0,type:\"String\"},{name:\"inputSetRefs\",type:\"InputSet\",isMany:!0,isReference:!0},{name:\"optionalOutputRefs\",type:\"DataOutput\",isMany:!0,isReference:!0},{name:\"whileExecutingOutputRefs\",type:\"DataOutput\",isMany:!0,isReference:!0}]},{name:\"Property\",superClass:[\"ItemAwareElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"}]},{name:\"DataInputAssociation\",superClass:[\"DataAssociation\"]},{name:\"DataOutputAssociation\",superClass:[\"DataAssociation\"]},{name:\"InputOutputSpecification\",superClass:[\"BaseElement\"],properties:[{name:\"dataInputs\",type:\"DataInput\",isMany:!0},{name:\"dataOutputs\",type:\"DataOutput\",isMany:!0},{name:\"inputSets\",type:\"InputSet\",isMany:!0},{name:\"outputSets\",type:\"OutputSet\",isMany:!0}]},{name:\"DataObject\",superClass:[\"FlowElement\",\"ItemAwareElement\"],properties:[{name:\"isCollection\",default:!1,isAttr:!0,type:\"Boolean\"}]},{name:\"InputOutputBinding\",properties:[{name:\"inputDataRef\",type:\"InputSet\",isAttr:!0,isReference:!0},{name:\"outputDataRef\",type:\"OutputSet\",isAttr:!0,isReference:!0},{name:\"operationRef\",type:\"Operation\",isAttr:!0,isReference:!0}]},{name:\"Assignment\",superClass:[\"BaseElement\"],properties:[{name:\"from\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"to\",type:\"Expression\",xml:{serialize:\"xsi:type\"}}]},{name:\"DataStore\",superClass:[\"RootElement\",\"ItemAwareElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"capacity\",isAttr:!0,type:\"Integer\"},{name:\"isUnlimited\",default:!0,isAttr:!0,type:\"Boolean\"}]},{name:\"DataStoreReference\",superClass:[\"ItemAwareElement\",\"FlowElement\"],properties:[{name:\"dataStoreRef\",type:\"DataStore\",isAttr:!0,isReference:!0}]},{name:\"DataObjectReference\",superClass:[\"ItemAwareElement\",\"FlowElement\"],properties:[{name:\"dataObjectRef\",type:\"DataObject\",isAttr:!0,isReference:!0}]},{name:\"ConversationLink\",superClass:[\"BaseElement\"],properties:[{name:\"sourceRef\",type:\"InteractionNode\",isAttr:!0,isReference:!0},{name:\"targetRef\",type:\"InteractionNode\",isAttr:!0,isReference:!0},{name:\"name\",isAttr:!0,type:\"String\"}]},{name:\"ConversationAssociation\",superClass:[\"BaseElement\"],properties:[{name:\"innerConversationNodeRef\",type:\"ConversationNode\",isAttr:!0,isReference:!0},{name:\"outerConversationNodeRef\",type:\"ConversationNode\",isAttr:!0,isReference:!0}]},{name:\"CallConversation\",superClass:[\"ConversationNode\"],properties:[{name:\"calledCollaborationRef\",type:\"Collaboration\",isAttr:!0,isReference:!0},{name:\"participantAssociations\",type:\"ParticipantAssociation\",isMany:!0}]},{name:\"Conversation\",superClass:[\"ConversationNode\"]},{name:\"SubConversation\",superClass:[\"ConversationNode\"],properties:[{name:\"conversationNodes\",type:\"ConversationNode\",isMany:!0}]},{name:\"ConversationNode\",isAbstract:!0,superClass:[\"InteractionNode\",\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"participantRef\",type:\"Participant\",isMany:!0,isReference:!0},{name:\"messageFlowRefs\",type:\"MessageFlow\",isMany:!0,isReference:!0},{name:\"correlationKeys\",type:\"CorrelationKey\",isMany:!0}]},{name:\"GlobalConversation\",superClass:[\"Collaboration\"]},{name:\"PartnerEntity\",superClass:[\"RootElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"participantRef\",type:\"Participant\",isMany:!0,isReference:!0}]},{name:\"PartnerRole\",superClass:[\"RootElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"participantRef\",type:\"Participant\",isMany:!0,isReference:!0}]},{name:\"CorrelationProperty\",superClass:[\"RootElement\"],properties:[{name:\"correlationPropertyRetrievalExpression\",type:\"CorrelationPropertyRetrievalExpression\",isMany:!0},{name:\"name\",isAttr:!0,type:\"String\"},{name:\"type\",type:\"ItemDefinition\",isAttr:!0,isReference:!0}]},{name:\"Error\",superClass:[\"RootElement\"],properties:[{name:\"structureRef\",type:\"ItemDefinition\",isAttr:!0,isReference:!0},{name:\"name\",isAttr:!0,type:\"String\"},{name:\"errorCode\",isAttr:!0,type:\"String\"}]},{name:\"CorrelationKey\",superClass:[\"BaseElement\"],properties:[{name:\"correlationPropertyRef\",type:\"CorrelationProperty\",isMany:!0,isReference:!0},{name:\"name\",isAttr:!0,type:\"String\"}]},{name:\"Expression\",superClass:[\"BaseElement\"],isAbstract:!1,properties:[{name:\"body\",isBody:!0,type:\"String\"}]},{name:\"FormalExpression\",superClass:[\"Expression\"],properties:[{name:\"language\",isAttr:!0,type:\"String\"},{name:\"evaluatesToTypeRef\",type:\"ItemDefinition\",isAttr:!0,isReference:!0}]},{name:\"Message\",superClass:[\"RootElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"itemRef\",type:\"ItemDefinition\",isAttr:!0,isReference:!0}]},{name:\"ItemDefinition\",superClass:[\"RootElement\"],properties:[{name:\"itemKind\",type:\"ItemKind\",isAttr:!0},{name:\"structureRef\",isAttr:!0,type:\"String\"},{name:\"isCollection\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"import\",type:\"Import\",isAttr:!0,isReference:!0}]},{name:\"FlowElement\",isAbstract:!0,superClass:[\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"auditing\",type:\"Auditing\"},{name:\"monitoring\",type:\"Monitoring\"},{name:\"categoryValueRef\",type:\"CategoryValue\",isMany:!0,isReference:!0}]},{name:\"SequenceFlow\",superClass:[\"FlowElement\"],properties:[{name:\"isImmediate\",isAttr:!0,type:\"Boolean\"},{name:\"conditionExpression\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"sourceRef\",type:\"FlowNode\",isAttr:!0,isReference:!0},{name:\"targetRef\",type:\"FlowNode\",isAttr:!0,isReference:!0}]},{name:\"FlowElementsContainer\",isAbstract:!0,superClass:[\"BaseElement\"],properties:[{name:\"laneSets\",type:\"LaneSet\",isMany:!0},{name:\"flowElements\",type:\"FlowElement\",isMany:!0}]},{name:\"CallableElement\",isAbstract:!0,superClass:[\"RootElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"ioSpecification\",type:\"InputOutputSpecification\",xml:{serialize:\"property\"}},{name:\"supportedInterfaceRef\",type:\"Interface\",isMany:!0,isReference:!0},{name:\"ioBinding\",type:\"InputOutputBinding\",isMany:!0,xml:{serialize:\"property\"}}]},{name:\"FlowNode\",isAbstract:!0,superClass:[\"FlowElement\"],properties:[{name:\"incoming\",type:\"SequenceFlow\",isMany:!0,isReference:!0},{name:\"outgoing\",type:\"SequenceFlow\",isMany:!0,isReference:!0},{name:\"lanes\",type:\"Lane\",isMany:!0,isVirtual:!0,isReference:!0}]},{name:\"CorrelationPropertyRetrievalExpression\",superClass:[\"BaseElement\"],properties:[{name:\"messagePath\",type:\"FormalExpression\"},{name:\"messageRef\",type:\"Message\",isAttr:!0,isReference:!0}]},{name:\"CorrelationPropertyBinding\",superClass:[\"BaseElement\"],properties:[{name:\"dataPath\",type:\"FormalExpression\"},{name:\"correlationPropertyRef\",type:\"CorrelationProperty\",isAttr:!0,isReference:!0}]},{name:\"Resource\",superClass:[\"RootElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"resourceParameters\",type:\"ResourceParameter\",isMany:!0}]},{name:\"ResourceParameter\",superClass:[\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"isRequired\",isAttr:!0,type:\"Boolean\"},{name:\"type\",type:\"ItemDefinition\",isAttr:!0,isReference:!0}]},{name:\"CorrelationSubscription\",superClass:[\"BaseElement\"],properties:[{name:\"correlationKeyRef\",type:\"CorrelationKey\",isAttr:!0,isReference:!0},{name:\"correlationPropertyBinding\",type:\"CorrelationPropertyBinding\",isMany:!0}]},{name:\"MessageFlow\",superClass:[\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"sourceRef\",type:\"InteractionNode\",isAttr:!0,isReference:!0},{name:\"targetRef\",type:\"InteractionNode\",isAttr:!0,isReference:!0},{name:\"messageRef\",type:\"Message\",isAttr:!0,isReference:!0}]},{name:\"MessageFlowAssociation\",superClass:[\"BaseElement\"],properties:[{name:\"innerMessageFlowRef\",type:\"MessageFlow\",isAttr:!0,isReference:!0},{name:\"outerMessageFlowRef\",type:\"MessageFlow\",isAttr:!0,isReference:!0}]},{name:\"InteractionNode\",isAbstract:!0,properties:[{name:\"incomingConversationLinks\",type:\"ConversationLink\",isMany:!0,isVirtual:!0,isReference:!0},{name:\"outgoingConversationLinks\",type:\"ConversationLink\",isMany:!0,isVirtual:!0,isReference:!0}]},{name:\"Participant\",superClass:[\"InteractionNode\",\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"interfaceRef\",type:\"Interface\",isMany:!0,isReference:!0},{name:\"participantMultiplicity\",type:\"ParticipantMultiplicity\"},{name:\"endPointRefs\",type:\"EndPoint\",isMany:!0,isReference:!0},{name:\"processRef\",type:\"Process\",isAttr:!0,isReference:!0}]},{name:\"ParticipantAssociation\",superClass:[\"BaseElement\"],properties:[{name:\"innerParticipantRef\",type:\"Participant\",isAttr:!0,isReference:!0},{name:\"outerParticipantRef\",type:\"Participant\",isAttr:!0,isReference:!0}]},{name:\"ParticipantMultiplicity\",properties:[{name:\"minimum\",default:0,isAttr:!0,type:\"Integer\"},{name:\"maximum\",default:1,isAttr:!0,type:\"Integer\"}],superClass:[\"BaseElement\"]},{name:\"Collaboration\",superClass:[\"RootElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"isClosed\",isAttr:!0,type:\"Boolean\"},{name:\"participants\",type:\"Participant\",isMany:!0},{name:\"messageFlows\",type:\"MessageFlow\",isMany:!0},{name:\"artifacts\",type:\"Artifact\",isMany:!0},{name:\"conversations\",type:\"ConversationNode\",isMany:!0},{name:\"conversationAssociations\",type:\"ConversationAssociation\"},{name:\"participantAssociations\",type:\"ParticipantAssociation\",isMany:!0},{name:\"messageFlowAssociations\",type:\"MessageFlowAssociation\",isMany:!0},{name:\"correlationKeys\",type:\"CorrelationKey\",isMany:!0},{name:\"choreographyRef\",type:\"Choreography\",isMany:!0,isReference:!0},{name:\"conversationLinks\",type:\"ConversationLink\",isMany:!0}]},{name:\"ChoreographyActivity\",isAbstract:!0,superClass:[\"FlowNode\"],properties:[{name:\"participantRef\",type:\"Participant\",isMany:!0,isReference:!0},{name:\"initiatingParticipantRef\",type:\"Participant\",isAttr:!0,isReference:!0},{name:\"correlationKeys\",type:\"CorrelationKey\",isMany:!0},{name:\"loopType\",type:\"ChoreographyLoopType\",default:\"None\",isAttr:!0}]},{name:\"CallChoreography\",superClass:[\"ChoreographyActivity\"],properties:[{name:\"calledChoreographyRef\",type:\"Choreography\",isAttr:!0,isReference:!0},{name:\"participantAssociations\",type:\"ParticipantAssociation\",isMany:!0}]},{name:\"SubChoreography\",superClass:[\"ChoreographyActivity\",\"FlowElementsContainer\"],properties:[{name:\"artifacts\",type:\"Artifact\",isMany:!0}]},{name:\"ChoreographyTask\",superClass:[\"ChoreographyActivity\"],properties:[{name:\"messageFlowRef\",type:\"MessageFlow\",isMany:!0,isReference:!0}]},{name:\"Choreography\",superClass:[\"Collaboration\",\"FlowElementsContainer\"]},{name:\"GlobalChoreographyTask\",superClass:[\"Choreography\"],properties:[{name:\"initiatingParticipantRef\",type:\"Participant\",isAttr:!0,isReference:!0}]},{name:\"TextAnnotation\",superClass:[\"Artifact\"],properties:[{name:\"text\",type:\"String\"},{name:\"textFormat\",default:\"text/plain\",isAttr:!0,type:\"String\"}]},{name:\"Group\",superClass:[\"Artifact\"],properties:[{name:\"categoryValueRef\",type:\"CategoryValue\",isAttr:!0,isReference:!0}]},{name:\"Association\",superClass:[\"Artifact\"],properties:[{name:\"associationDirection\",type:\"AssociationDirection\",isAttr:!0},{name:\"sourceRef\",type:\"BaseElement\",isAttr:!0,isReference:!0},{name:\"targetRef\",type:\"BaseElement\",isAttr:!0,isReference:!0}]},{name:\"Category\",superClass:[\"RootElement\"],properties:[{name:\"categoryValue\",type:\"CategoryValue\",isMany:!0},{name:\"name\",isAttr:!0,type:\"String\"}]},{name:\"Artifact\",isAbstract:!0,superClass:[\"BaseElement\"]},{name:\"CategoryValue\",superClass:[\"BaseElement\"],properties:[{name:\"categorizedFlowElements\",type:\"FlowElement\",isMany:!0,isVirtual:!0,isReference:!0},{name:\"value\",isAttr:!0,type:\"String\"}]},{name:\"Activity\",isAbstract:!0,superClass:[\"FlowNode\"],properties:[{name:\"isForCompensation\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"default\",type:\"SequenceFlow\",isAttr:!0,isReference:!0},{name:\"ioSpecification\",type:\"InputOutputSpecification\",xml:{serialize:\"property\"}},{name:\"boundaryEventRefs\",type:\"BoundaryEvent\",isMany:!0,isReference:!0},{name:\"properties\",type:\"Property\",isMany:!0},{name:\"dataInputAssociations\",type:\"DataInputAssociation\",isMany:!0},{name:\"dataOutputAssociations\",type:\"DataOutputAssociation\",isMany:!0},{name:\"startQuantity\",default:1,isAttr:!0,type:\"Integer\"},{name:\"resources\",type:\"ResourceRole\",isMany:!0},{name:\"completionQuantity\",default:1,isAttr:!0,type:\"Integer\"},{name:\"loopCharacteristics\",type:\"LoopCharacteristics\"}]},{name:\"ServiceTask\",superClass:[\"Task\"],properties:[{name:\"implementation\",isAttr:!0,type:\"String\"},{name:\"operationRef\",type:\"Operation\",isAttr:!0,isReference:!0}]},{name:\"SubProcess\",superClass:[\"Activity\",\"FlowElementsContainer\",\"InteractionNode\"],properties:[{name:\"triggeredByEvent\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"artifacts\",type:\"Artifact\",isMany:!0}]},{name:\"LoopCharacteristics\",isAbstract:!0,superClass:[\"BaseElement\"]},{name:\"MultiInstanceLoopCharacteristics\",superClass:[\"LoopCharacteristics\"],properties:[{name:\"isSequential\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"behavior\",type:\"MultiInstanceBehavior\",default:\"All\",isAttr:!0},{name:\"loopCardinality\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"loopDataInputRef\",type:\"ItemAwareElement\",isReference:!0},{name:\"loopDataOutputRef\",type:\"ItemAwareElement\",isReference:!0},{name:\"inputDataItem\",type:\"DataInput\",xml:{serialize:\"property\"}},{name:\"outputDataItem\",type:\"DataOutput\",xml:{serialize:\"property\"}},{name:\"complexBehaviorDefinition\",type:\"ComplexBehaviorDefinition\",isMany:!0},{name:\"completionCondition\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"oneBehaviorEventRef\",type:\"EventDefinition\",isAttr:!0,isReference:!0},{name:\"noneBehaviorEventRef\",type:\"EventDefinition\",isAttr:!0,isReference:!0}]},{name:\"StandardLoopCharacteristics\",superClass:[\"LoopCharacteristics\"],properties:[{name:\"testBefore\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"loopCondition\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"loopMaximum\",type:\"Integer\",isAttr:!0}]},{name:\"CallActivity\",superClass:[\"Activity\",\"InteractionNode\"],properties:[{name:\"calledElement\",type:\"String\",isAttr:!0}]},{name:\"Task\",superClass:[\"Activity\",\"InteractionNode\"]},{name:\"SendTask\",superClass:[\"Task\"],properties:[{name:\"implementation\",isAttr:!0,type:\"String\"},{name:\"operationRef\",type:\"Operation\",isAttr:!0,isReference:!0},{name:\"messageRef\",type:\"Message\",isAttr:!0,isReference:!0}]},{name:\"ReceiveTask\",superClass:[\"Task\"],properties:[{name:\"implementation\",isAttr:!0,type:\"String\"},{name:\"instantiate\",default:!1,isAttr:!0,type:\"Boolean\"},{name:\"operationRef\",type:\"Operation\",isAttr:!0,isReference:!0},{name:\"messageRef\",type:\"Message\",isAttr:!0,isReference:!0}]},{name:\"ScriptTask\",superClass:[\"Task\"],properties:[{name:\"scriptFormat\",isAttr:!0,type:\"String\"},{name:\"script\",type:\"String\"}]},{name:\"BusinessRuleTask\",superClass:[\"Task\"],properties:[{name:\"implementation\",isAttr:!0,type:\"String\"}]},{name:\"AdHocSubProcess\",superClass:[\"SubProcess\"],properties:[{name:\"completionCondition\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"ordering\",type:\"AdHocOrdering\",isAttr:!0},{name:\"cancelRemainingInstances\",default:!0,isAttr:!0,type:\"Boolean\"}]},{name:\"Transaction\",superClass:[\"SubProcess\"],properties:[{name:\"protocol\",isAttr:!0,type:\"String\"},{name:\"method\",isAttr:!0,type:\"String\"}]},{name:\"GlobalScriptTask\",superClass:[\"GlobalTask\"],properties:[{name:\"scriptLanguage\",isAttr:!0,type:\"String\"},{name:\"script\",isAttr:!0,type:\"String\"}]},{name:\"GlobalBusinessRuleTask\",superClass:[\"GlobalTask\"],properties:[{name:\"implementation\",isAttr:!0,type:\"String\"}]},{name:\"ComplexBehaviorDefinition\",superClass:[\"BaseElement\"],properties:[{name:\"condition\",type:\"FormalExpression\"},{name:\"event\",type:\"ImplicitThrowEvent\"}]},{name:\"ResourceRole\",superClass:[\"BaseElement\"],properties:[{name:\"resourceRef\",type:\"Resource\",isReference:!0},{name:\"resourceParameterBindings\",type:\"ResourceParameterBinding\",isMany:!0},{name:\"resourceAssignmentExpression\",type:\"ResourceAssignmentExpression\"},{name:\"name\",isAttr:!0,type:\"String\"}]},{name:\"ResourceParameterBinding\",properties:[{name:\"expression\",type:\"Expression\",xml:{serialize:\"xsi:type\"}},{name:\"parameterRef\",type:\"ResourceParameter\",isAttr:!0,isReference:!0}],superClass:[\"BaseElement\"]},{name:\"ResourceAssignmentExpression\",properties:[{name:\"expression\",type:\"Expression\",xml:{serialize:\"xsi:type\"}}],superClass:[\"BaseElement\"]},{name:\"Import\",properties:[{name:\"importType\",isAttr:!0,type:\"String\"},{name:\"location\",isAttr:!0,type:\"String\"},{name:\"namespace\",isAttr:!0,type:\"String\"}]},{name:\"Definitions\",superClass:[\"BaseElement\"],properties:[{name:\"name\",isAttr:!0,type:\"String\"},{name:\"targetNamespace\",isAttr:!0,type:\"String\"},{name:\"expressionLanguage\",default:\"http://www.w3.org/1999/XPath\",isAttr:!0,type:\"String\"},{name:\"typeLanguage\",default:\"http://www.w3.org/2001/XMLSchema\",isAttr:!0,type:\"String\"},{name:\"imports\",type:\"Import\",isMany:!0},{name:\"extensions\",type:\"Extension\",isMany:!0},{name:\"rootElements\",type:\"RootElement\",isMany:!0},{name:\"diagrams\",isMany:!0,type:\"bpmndi:BPMNDiagram\"},{name:\"exporter\",isAttr:!0,type:\"String\"},{name:\"relationships\",type:\"Relationship\",isMany:!0},{name:\"exporterVersion\",isAttr:!0,type:\"String\"}]}],enumerations:[{name:\"ProcessType\",literalValues:[{name:\"None\"},{name:\"Public\"},{name:\"Private\"}]},{name:\"GatewayDirection\",literalValues:[{name:\"Unspecified\"},{name:\"Converging\"},{name:\"Diverging\"},{name:\"Mixed\"}]},{name:\"EventBasedGatewayType\",literalValues:[{name:\"Parallel\"},{name:\"Exclusive\"}]},{name:\"RelationshipDirection\",literalValues:[{name:\"None\"},{name:\"Forward\"},{name:\"Backward\"},{name:\"Both\"}]},{name:\"ItemKind\",literalValues:[{name:\"Physical\"},{name:\"Information\"}]},{name:\"ChoreographyLoopType\",literalValues:[{name:\"None\"},{name:\"Standard\"},{name:\"MultiInstanceSequential\"},{name:\"MultiInstanceParallel\"}]},{name:\"AssociationDirection\",literalValues:[{name:\"None\"},{name:\"One\"},{name:\"Both\"}]},{name:\"MultiInstanceBehavior\",literalValues:[{name:\"None\"},{name:\"One\"},{name:\"All\"},{name:\"Complex\"}]},{name:\"AdHocOrdering\",literalValues:[{name:\"Parallel\"},{name:\"Sequential\"}]}],xml:{tagAlias:\"lowerCase\",typePrefix:\"t\"}},bpmndi:{name:\"BPMNDI\",uri:\"http://www.omg.org/spec/BPMN/20100524/DI\",prefix:\"bpmndi\",types:[{name:\"BPMNDiagram\",properties:[{name:\"plane\",type:\"BPMNPlane\",redefines:\"di:Diagram#rootElement\"},{name:\"labelStyle\",type:\"BPMNLabelStyle\",isMany:!0}],superClass:[\"di:Diagram\"]},{name:\"BPMNPlane\",properties:[{name:\"bpmnElement\",isAttr:!0,isReference:!0,type:\"bpmn:BaseElement\",redefines:\"di:DiagramElement#modelElement\"}],superClass:[\"di:Plane\"]},{name:\"BPMNShape\",properties:[{name:\"bpmnElement\",isAttr:!0,isReference:!0,type:\"bpmn:BaseElement\",redefines:\"di:DiagramElement#modelElement\"},{name:\"isHorizontal\",isAttr:!0,type:\"Boolean\"},{name:\"isExpanded\",isAttr:!0,type:\"Boolean\"},{name:\"isMarkerVisible\",isAttr:!0,type:\"Boolean\"},{name:\"label\",type:\"BPMNLabel\"},{name:\"isMessageVisible\",isAttr:!0,type:\"Boolean\"},{name:\"participantBandKind\",type:\"ParticipantBandKind\",isAttr:!0},{name:\"choreographyActivityShape\",type:\"BPMNShape\",isAttr:!0,isReference:!0}],superClass:[\"di:LabeledShape\"]},{name:\"BPMNEdge\",properties:[{name:\"label\",type:\"BPMNLabel\"},{name:\"bpmnElement\",isAttr:!0,isReference:!0,type:\"bpmn:BaseElement\",redefines:\"di:DiagramElement#modelElement\"},{name:\"sourceElement\",isAttr:!0,isReference:!0,type:\"di:DiagramElement\",redefines:\"di:Edge#source\"},{name:\"targetElement\",isAttr:!0,isReference:!0,type:\"di:DiagramElement\",redefines:\"di:Edge#target\"},{name:\"messageVisibleKind\",type:\"MessageVisibleKind\",isAttr:!0,default:\"initiating\"}],superClass:[\"di:LabeledEdge\"]},{name:\"BPMNLabel\",properties:[{name:\"labelStyle\",type:\"BPMNLabelStyle\",isAttr:!0,isReference:!0,redefines:\"di:DiagramElement#style\"}],superClass:[\"di:Label\"]},{name:\"BPMNLabelStyle\",properties:[{name:\"font\",type:\"dc:Font\"}],superClass:[\"di:Style\"]}],enumerations:[{name:\"ParticipantBandKind\",literalValues:[{name:\"top_initiating\"},{name:\"middle_initiating\"},{name:\"bottom_initiating\"},{name:\"top_non_initiating\"},{name:\"middle_non_initiating\"},{name:\"bottom_non_initiating\"}]},{name:\"MessageVisibleKind\",literalValues:[{name:\"initiating\"},{name:\"non_initiating\"}]}],associations:[]},dc:{name:\"DC\",uri:\"http://www.omg.org/spec/DD/20100524/DC\",prefix:\"dc\",types:[{name:\"Boolean\"},{name:\"Integer\"},{name:\"Real\"},{name:\"String\"},{name:\"Font\",properties:[{name:\"name\",type:\"String\",isAttr:!0},{name:\"size\",type:\"Real\",isAttr:!0},{name:\"isBold\",type:\"Boolean\",isAttr:!0},{name:\"isItalic\",type:\"Boolean\",isAttr:!0},{name:\"isUnderline\",type:\"Boolean\",isAttr:!0},{name:\"isStrikeThrough\",type:\"Boolean\",isAttr:!0}]},{name:\"Point\",properties:[{name:\"x\",type:\"Real\",default:\"0\",isAttr:!0},{name:\"y\",type:\"Real\",default:\"0\",isAttr:!0}]},{name:\"Bounds\",properties:[{name:\"x\",type:\"Real\",default:\"0\",isAttr:!0},{name:\"y\",type:\"Real\",default:\"0\",isAttr:!0},{name:\"width\",type:\"Real\",isAttr:!0},{name:\"height\",type:\"Real\",isAttr:!0}]}],associations:[]},di:{name:\"DI\",uri:\"http://www.omg.org/spec/DD/20100524/DI\",prefix:\"di\",types:[{name:\"DiagramElement\",isAbstract:!0,properties:[{name:\"id\",isAttr:!0,isId:!0,type:\"String\"},{name:\"extension\",type:\"Extension\"},{name:\"owningDiagram\",type:\"Diagram\",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:\"owningElement\",type:\"DiagramElement\",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:\"modelElement\",isReadOnly:!0,isVirtual:!0,isReference:!0,type:\"Element\"},{name:\"style\",type:\"Style\",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:\"ownedElement\",type:\"DiagramElement\",isReadOnly:!0,isMany:!0,isVirtual:!0}]},{name:\"Node\",isAbstract:!0,superClass:[\"DiagramElement\"]},{name:\"Edge\",isAbstract:!0,superClass:[\"DiagramElement\"],properties:[{name:\"source\",type:\"DiagramElement\",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:\"target\",type:\"DiagramElement\",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:\"waypoint\",isUnique:!1,isMany:!0,type:\"dc:Point\",xml:{serialize:\"xsi:type\"}}]},{name:\"Diagram\",isAbstract:!0,properties:[{name:\"id\",isAttr:!0,isId:!0,type:\"String\"},{name:\"rootElement\",type:\"DiagramElement\",isReadOnly:!0,isVirtual:!0},{name:\"name\",isAttr:!0,type:\"String\"},{name:\"documentation\",isAttr:!0,type:\"String\"},{name:\"resolution\",isAttr:!0,type:\"Real\"},{name:\"ownedStyle\",type:\"Style\",isReadOnly:!0,isMany:!0,isVirtual:!0}]},{name:\"Shape\",isAbstract:!0,superClass:[\"Node\"],properties:[{name:\"bounds\",type:\"dc:Bounds\"}]},{name:\"Plane\",isAbstract:!0,superClass:[\"Node\"],properties:[{name:\"planeElement\",type:\"DiagramElement\",subsettedProperty:\"DiagramElement-ownedElement\",isMany:!0}]},{name:\"LabeledEdge\",isAbstract:!0,superClass:[\"Edge\"],properties:[{name:\"ownedLabel\",type:\"Label\",isReadOnly:!0,subsettedProperty:\"DiagramElement-ownedElement\",isMany:!0,isVirtual:!0}]},{name:\"LabeledShape\",isAbstract:!0,superClass:[\"Shape\"],properties:[{name:\"ownedLabel\",type:\"Label\",isReadOnly:!0,subsettedProperty:\"DiagramElement-ownedElement\",isMany:!0,isVirtual:!0}]},{name:\"Label\",isAbstract:!0,superClass:[\"Node\"],properties:[{name:\"bounds\",type:\"dc:Bounds\"}]},{name:\"Style\",isAbstract:!0,properties:[{name:\"id\",isAttr:!0,isId:!0,type:\"String\"}]},{name:\"Extension\",properties:[{name:\"values\",isMany:!0,type:\"Element\"}]}],associations:[],xml:{tagAlias:\"lowerCase\"}},bioc:{name:\"bpmn.io colors for BPMN\",uri:\"http://bpmn.io/schema/bpmn/biocolor/1.0\",prefix:\"bioc\",types:[{name:\"ColoredShape\",extends:[\"bpmndi:BPMNShape\"],properties:[{name:\"stroke\",isAttr:!0,type:\"String\"},{name:\"fill\",isAttr:!0,type:\"String\"}]},{name:\"ColoredEdge\",extends:[\"bpmndi:BPMNEdge\"],properties:[{name:\"stroke\",isAttr:!0,type:\"String\"},{name:\"fill\",isAttr:!0,type:\"String\"}]}],enumerations:[],associations:[]},color:{name:\"BPMN in Color\",uri:\"http://www.omg.org/spec/BPMN/non-normative/color/1.0\",prefix:\"color\",types:[{name:\"ColoredLabel\",extends:[\"bpmndi:BPMNLabel\"],properties:[{name:\"color\",isAttr:!0,type:\"String\"}]},{name:\"ColoredShape\",extends:[\"bpmndi:BPMNShape\"],properties:[{name:\"background-color\",isAttr:!0,type:\"String\"},{name:\"border-color\",isAttr:!0,type:\"String\"}]},{name:\"ColoredEdge\",extends:[\"bpmndi:BPMNEdge\"],properties:[{name:\"border-color\",isAttr:!0,type:\"String\"}]}],enumerations:[],associations:[]}};function Lr(e,t){return new Or(E({},Br,e),t)}var Ir=\"Tried to access di from the businessObject. The di is available through the diagram element only. For more information, see https://github.com/bpmn-io/bpmn-js/issues/1472\";function jr(e,t){return e.$instanceOf(t)}function Fr(e){var t={},n=[],i={};function r(e,t){return function(n){e(n,t)}}function o(e){t[e.id]=e}function a(t,n){try{var r=i[t.id]&&function(t,n){if(t.gfx)throw new Error(`already rendered ${St(t)}`);return e.element(t,i[t.id],n)}(t,n);return o(t),r}catch(e){s(e.message,{element:t,error:e}),console.error(`failed to import ${St(t)}`,e)}}function s(t,n){e.error(t,n)}var l=this.registerDi=function(e){var t,n=e.bpmnElement;n?i[n.id]?s(`multiple DI elements defined for ${St(n)}`,{element:n}):(i[n.id]=e,c(t=n,\"di\")||Object.defineProperty(t,\"di\",{enumerable:!1,get:function(){throw new Error(Ir)}})):s(`no bpmnElement referenced in ${St(e)}`,{element:e})};function p(e){var t;t=e.plane,l(t),f(t.planeElement,m)}function m(e){l(e)}this.handleDefinitions=function(o,a){var c=o.diagrams;if(a&&-1===c.indexOf(a))throw new Error(\"diagram not part of <bpmn:Definitions />\");if(!a&&c&&c.length&&(a=c[0]),!a)throw new Error(\"no diagram to display\");i={},p(a);var m=a.plane;if(!m)throw new Error(`no plane for ${St(a)}`);var v=m.bpmnElement;if(!v){if(v=function(e){return u(e.rootElements,(function(e){return jr(e,\"bpmn:Process\")||jr(e,\"bpmn:Collaboration\")}))}(o),!v)throw new Error(\"no process or collaboration to display\");s(`correcting missing bpmnElement on ${St(m)} to ${St(v)}`),m.bpmnElement=v,l(m)}var x,b,w=function(t,n){return e.root(t,i[t.id],n)}(v,m);if(jr(v,\"bpmn:Process\")||jr(v,\"bpmn:SubProcess\"))y(v,w);else{if(!jr(v,\"bpmn:Collaboration\"))throw new Error(`unsupported bpmnElement for ${St(m)}: ${St(v)}`);b=w,f((x=v).participants,r(P,b)),E(x.artifacts,b),n.push((function(){!function(e,t){f(e,r(g,t))}(x.messageFlows,b)})),function(e,n){var i=h(e,(function(e){return!t[e.id]&&jr(e,\"bpmn:Process\")&&e.laneSets}));i.forEach(r(y,n))}(o.rootElements,w)}d(n)};var d=this.handleDeferred=function(){for(;n.length;)n.shift()()};function y(e,t){M(e,t),_(e.ioSpecification,t),E(e.artifacts,t),o(e)}function g(e,t){a(e,t)}function v(e,t){a(e,t)}function x(e,t){a(e,t)}function b(e,t){a(e,t)}function w(e,t){a(e,t)}function E(e,t){f(e,(function(e){jr(e,\"bpmn:Association\")?n.push((function(){w(e,t)})):w(e,t)}))}function _(e,t){e&&(f(e.dataInputs,r(x,t)),f(e.dataOutputs,r(b,t)))}var A=this.handleSubProcess=function(e,t){M(e,t),E(e.artifacts,t)};function k(e,t){var i=a(e,t);jr(e,\"bpmn:SubProcess\")&&A(e,i||t),jr(e,\"bpmn:Activity\")&&_(e.ioSpecification,t),n.push((function(){f(e.dataInputAssociations,r(v,t)),f(e.dataOutputAssociations,r(v,t))}))}function R(e,t){a(e,t)}function S(e,t){n.push((function(){var n=a(e,t);e.childLaneSet&&C(e.childLaneSet,n||t),function(e){f(e.flowNodeRef,(function(t){var n=t.get(\"lanes\");n&&n.push(e)}))}(e)}))}function C(e,t){f(e.lanes,r(S,t))}function M(e,t){!function(e,t){f(e,(function(e){jr(e,\"bpmn:SequenceFlow\")?n.push((function(){!function(e,t){a(e,t)}(e,t)})):jr(e,\"bpmn:BoundaryEvent\")?n.unshift((function(){k(e,t)})):jr(e,\"bpmn:FlowNode\")?k(e,t):jr(e,\"bpmn:DataObject\")||(jr(e,\"bpmn:DataStoreReference\")||jr(e,\"bpmn:DataObjectReference\")?R(e,t):s(`unrecognized flowElement ${St(e)} in context ${St(t&&t.businessObject)}`,{element:e,context:t}))}))}(e.flowElements,t),e.laneSets&&function(e,t){f(e,r(C,t))}(e.laneSets,t)}function P(e,t){var n=a(e,t),i=e.processRef;i&&y(i,n||t)}}function Vr(e,t,n){var i,r,o,a=[];function s(e,t){var n=new Fr({root:function(e,t){return i.add(e,t)},element:function(e,t,n){return i.add(e,t,n)},error:function(e,t){a.push({message:e,context:t})}});t=t||e.diagrams&&e.diagrams[0];var r=function(e,t){if(!t)return;var n,i=t.plane.bpmnElement,r=i;k(i,\"bpmn:Process\")||k(i,\"bpmn:Collaboration\")||(r=function(e){var t=e;for(;t;){if(k(t,\"bpmn:Process\"))return t;t=t.$parent}}\n/**\n   * This file must not be changed or exchanged.\n   *\n   * @see http://bpmn.io/license for more information.\n   */(i));n=k(r,\"bpmn:Collaboration\")?r:u(e.rootElements,(function(e){if(k(e,\"bpmn:Collaboration\"))return u(e.participants,(function(e){return e.processRef===r}))}));var o=[r];n&&(o=function(e,t){let n=[];return f(e,(function(e,i){n.push(t(e,i))})),n}(n.participants,(function(e){return e.processRef}))).push(n);var a=Wr(o),s=[t],l=[i];return f(e.diagrams,(function(e){var t=e.plane.bpmnElement;-1!==a.indexOf(t)&&-1===l.indexOf(t)&&(s.push(e),l.push(t))})),s}(e,t);if(!r)throw new Error(\"no diagram to display\");f(r,(function(t){n.handleDefinitions(e,t)}));var s=t.plane.bpmnElement.id;o.setRootElement(o.findRoot(s+\"_plane\")||o.findRoot(s))}return new Promise((function(l,p){try{return i=e.get(\"bpmnImporter\"),r=e.get(\"eventBus\"),o=e.get(\"canvas\"),r.fire(\"import.render.start\",{definitions:t}),s(t,n),r.fire(\"import.render.complete\",{error:undefined,warnings:a}),l({warnings:a})}catch(e){return e.warnings=a,p(e)}}))}function Wr(e){var t=[];return f(e,(function(e){e&&(t.push(e),t=t.concat(Wr(e.flowElements)))})),t}var zr,$r='<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14.02 5.57\" width=\"53\" height=\"21\"><path fill=\"currentColor\" d=\"M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z\"/><path fill=\"currentColor\" d=\"M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z\"/></svg>',Gr={verticalAlign:\"middle\"},Hr={color:\"#404040\"},Kr={zIndex:\"1001\",position:\"fixed\",top:\"0\",left:\"0\",right:\"0\",bottom:\"0\"},Ur={width:\"100%\",height:\"100%\",background:\"rgba(40,40,40,0.2)\"},qr={position:\"absolute\",left:\"50%\",top:\"40%\",transform:\"translate(-50%)\",width:\"260px\",padding:\"10px\",background:\"white\",boxShadow:\"0 1px 4px rgba(0,0,0,0.3)\",fontFamily:\"Helvetica, Arial, sans-serif\",fontSize:\"14px\",display:\"flex\",lineHeight:\"1.3\"},Yr='<div class=\"bjs-powered-by-lightbox\"><div class=\"backdrop\"></div><div class=\"notice\"><a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\" class=\"link\">'+$r+'</a><span>Web-based tooling for BPMN, DMN and forms powered by <a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\">bpmn.io</a>.</span></div></div>';function Xr(){zr||(Oe(zr=Qe(Yr),Kr),Oe(et(\"svg\",zr),Gr),Oe(et(\".backdrop\",zr),Ur),Oe(et(\".notice\",zr),qr),Oe(et(\".link\",zr),Hr,{margin:\"15px 20px 15px 10px\",alignSelf:\"center\"}),Ye.bind(zr,\".backdrop\",\"click\",(function(e){document.body.removeChild(zr)}))),document.body.appendChild(zr)}\n/**\n   * The code in the <project-logo></project-logo> area\n   * must not be changed.\n   *\n   * @see http://bpmn.io/license for more information.\n   */function Zr(e){e=E({},Qr,e),this._moddle=this._createModdle(e),this._container=this._createContainer(e),\n/**\n   * Adds the project logo to the diagram container as\n   * required by the bpmn.io license.\n   *\n   * @see http://bpmn.io/license\n   *\n   * @param {Element} container\n   */\nfunction(e){const t=Qe('<a href=\"http://bpmn.io\" target=\"_blank\" class=\"bjs-powered-by\" title=\"Powered by bpmn.io\" >'+$r+\"</a>\");Oe(et(\"svg\",t),Gr),Oe(t,Hr,{position:\"absolute\",bottom:\"15px\",right:\"15px\",zIndex:\"100\"}),e.appendChild(t),Ke.bind(t,\"click\",(function(e){Xr(),e.preventDefault()}))}(this._container),this._init(this._container,this._moddle,e)}function Jr(e,t){return e.warnings=t,e}e(Zr,bi),Zr.prototype.importXML=async function(e,t){const n=this;let i=[];try{let o;e=this._emit(\"import.parse.start\",{xml:e})||e;try{o=await this._moddle.fromXML(e,\"bpmn:Definitions\")}catch(e){throw this._emit(\"import.parse.complete\",{error:e}),e}let a=o.rootElement;const s=o.references,l=o.warnings,p=o.elementsById;i=i.concat(l),a=this._emit(\"import.parse.complete\",(r={error:null,definitions:a,elementsById:p,references:s,warnings:i},n.get(\"eventBus\").createEvent(r)))||a;const c=await this.importDefinitions(a,t);return i=i.concat(c.warnings),this._emit(\"import.done\",{error:null,warnings:i}),{warnings:i}}catch(e){let t=e;throw i=i.concat(t.warnings||[]),Jr(t,i),t=function(e){const t=/unparsable content <([^>]+)> detected([\\s\\S]*)$/.exec(e.message);t&&(e.message=\"unparsable content <\"+t[1]+\"> detected; this may indicate an invalid BPMN 2.0 diagram file\"+t[2]);return e}(t),this._emit(\"import.done\",{error:t,warnings:t.warnings}),t}var r},Zr.prototype.importDefinitions=async function(e,t){this._setDefinitions(e);return{warnings:(await this.open(t)).warnings}},Zr.prototype.open=async function(e){const t=this._definitions;let n=e;if(!t){const e=new Error(\"no XML imported\");throw Jr(e,[]),e}if(\"string\"==typeof e&&(n=function(e,t){if(!t)return null;return u(e.diagrams,(function(e){return e.id===t}))||null}(t,e),!n)){const t=new Error(\"BPMNDiagram <\"+e+\"> not found\");throw Jr(t,[]),t}try{this.clear()}catch(e){throw Jr(e,[]),e}const{warnings:i}=await Vr(this,t,n);return{warnings:i}},Zr.prototype.saveXML=async function(e){e=e||{};let t,n,i=this._definitions;try{if(!i)throw new Error(\"no definitions loaded\");i=this._emit(\"saveXML.start\",{definitions:i})||i;n=(await this._moddle.toXML(i,e)).xml,n=this._emit(\"saveXML.serialized\",{xml:n})||n}catch(e){t=e}const r=t?{error:t}:{xml:n};if(this._emit(\"saveXML.done\",r),t)throw t;return r},Zr.prototype.saveSVG=async function(){let e,t;this._emit(\"saveSVG.start\");try{const t=this.get(\"canvas\"),n=t.getActiveLayer(),i=et(\"defs\",t._svg),r=le(n),o=i?\"<defs>\"+le(i)+\"</defs>\":\"\",a=n.getBBox();e='<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n\\x3c!-- created with bpmn-js / http://bpmn.io --\\x3e\\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"'+a.width+'\" height=\"'+a.height+'\" viewBox=\"'+a.x+\" \"+a.y+\" \"+a.width+\" \"+a.height+'\" version=\"1.1\">'+o+r+\"</svg>\"}catch(e){t=e}if(this._emit(\"saveSVG.done\",{error:t,svg:e}),t)throw t;return{svg:e}},Zr.prototype._setDefinitions=function(e){this._definitions=e},Zr.prototype.getModules=function(){return this._modules},Zr.prototype.clear=function(){this.getDefinitions()&&bi.prototype.clear.call(this)},Zr.prototype.destroy=function(){bi.prototype.destroy.call(this),tt(this._container)},Zr.prototype.on=function(e,t,n,i){return this.get(\"eventBus\").on(e,t,n,i)},Zr.prototype.off=function(e,t){this.get(\"eventBus\").off(e,t)},Zr.prototype.attachTo=function(e){if(!e)throw new Error(\"parentNode required\");this.detach(),e.get&&e.constructor.prototype.jquery&&(e=e.get(0)),\"string\"==typeof e&&(e=et(e)),e.appendChild(this._container),this._emit(\"attach\",{}),this.get(\"canvas\").resized()},Zr.prototype.getDefinitions=function(){return this._definitions},Zr.prototype.detach=function(){const e=this._container,t=e.parentNode;t&&(this._emit(\"detach\",{}),t.removeChild(e))},Zr.prototype._init=function(e,t,n){const i=n.modules||this.getModules(n),r=n.additionalModules||[],o=[].concat([{bpmnjs:[\"value\",this],moddle:[\"value\",t]}],i,r),a=E(function(e,t){let n={};return f(Object(e),(function(e,i){-1===t.indexOf(i)&&(n[i]=e)})),n}(n,[\"additionalModules\"]),{canvas:E({},n.canvas,{container:e}),modules:o});bi.call(this,a),n&&n.container&&this.attachTo(n.container)},Zr.prototype._emit=function(e,t){return this.get(\"eventBus\").fire(e,t)},Zr.prototype._createContainer=function(e){const t=Qe('<div class=\"bjs-container\"></div>');return Oe(t,{width:eo(e.width),height:eo(e.height),position:e.position}),t},Zr.prototype._createModdle=function(e){return new Lr(E({},this._moddleExtensions,e.moddleExtensions))},Zr.prototype._modules=[];const Qr={width:\"100%\",height:\"100%\",position:\"relative\"};function eo(e){return e+(s(e)?\"px\":\"\")}function to(e){Zr.call(this,e)}e(to,Zr),to.prototype._modules=[Nt,ln,yn,zt,Dn,Et],to.prototype._moddleExtensions={};var no=[\"c\",\"C\"],io=[\"v\",\"V\"],ro=[\"y\",\"Y\"],oo=[\"z\",\"Z\"];function ao(e){return!e.altKey&&(e.ctrlKey||e.metaKey)}function so(e,t){return-1!==(e=o(e)?e:[e]).indexOf(t.key)||-1!==e.indexOf(t.code)}function lo(e){return e.shiftKey}var po=\"keyboard.keydown\",co=\"input-handle-modified-keys\";function uo(e,t){var n=this;this._config=e||{},this._eventBus=t,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),t.on(\"diagram.destroy\",(function(){n._fire(\"destroy\"),n.unbind()})),t.on(\"diagram.init\",(function(){n._fire(\"init\")})),t.on(\"attach\",(function(){e&&e.bindTo&&n.bind(e.bindTo)})),t.on(\"detach\",(function(){n.unbind()}))}uo.$inject=[\"config.keyboard\",\"eventBus\"],uo.prototype._keydownHandler=function(e){this._keyHandler(e,po)},uo.prototype._keyupHandler=function(e){this._keyHandler(e,\"keyboard.keyup\")},uo.prototype._keyHandler=function(e,t){if(!this._isEventIgnored(e)){var n={keyEvent:e};this._eventBus.fire(t||po,n)&&e.preventDefault()}},uo.prototype._isEventIgnored=function(e){return!!e.defaultPrevented||((t=e.target)&&(Fe(t,\"input, textarea\")||\"true\"===t.contentEditable)||function(e){return e&&Fe(e,\"button, input[type=submit], input[type=button], a[href], [aria-role=button]\")}(e.target)&&so([\" \",\"Enter\"],e))&&this._isModifiedKeyIgnored(e);var t},uo.prototype._isModifiedKeyIgnored=function(e){return!ao(e)||-1===this._getAllowedModifiers(e.target).indexOf(e.key)},uo.prototype._getAllowedModifiers=function(e){var t=Ve(e,\"[\"+co+\"]\",!0);return!t||this._node&&!this._node.contains(t)?[]:t.getAttribute(co).split(\",\")},uo.prototype.bind=function(e){this.unbind(),this._node=e,Ke.bind(e,\"keydown\",this._keydownHandler),Ke.bind(e,\"keyup\",this._keyupHandler),this._fire(\"bind\")},uo.prototype.getBinding=function(){return this._node},uo.prototype.unbind=function(){var e=this._node;e&&(this._fire(\"unbind\"),Ke.unbind(e,\"keydown\",this._keydownHandler),Ke.unbind(e,\"keyup\",this._keyupHandler)),this._node=null},uo.prototype._fire=function(e){this._eventBus.fire(\"keyboard.\"+e,{node:this._node})},uo.prototype.addListener=function(e,t,n){l(e)&&(n=t,t=e,e=1e3),this._eventBus.on(n||po,e,t)},uo.prototype.removeListener=function(e,t){this._eventBus.off(t||po,e)},uo.prototype.hasModifier=function(e){return e.ctrlKey||e.metaKey||e.shiftKey||e.altKey},uo.prototype.isCmd=ao,uo.prototype.isShift=lo,uo.prototype.isKey=so;function ho(e,t){var n=this;e.on(\"editorActions.init\",500,(function(e){var i=e.editorActions;n.registerBindings(t,i)}))}ho.$inject=[\"eventBus\",\"keyboard\"],ho.prototype.registerBindings=function(e,t){function n(n,i){t.isRegistered(n)&&e.addListener(i)}n(\"undo\",(function(e){if(function(e){return ao(e)&&!lo(e)&&so(oo,e)}(e.keyEvent))return t.trigger(\"undo\"),!0})),n(\"redo\",(function(e){if(function(e){return ao(e)&&(so(ro,e)||so(oo,e)&&lo(e))}(e.keyEvent))return t.trigger(\"redo\"),!0})),n(\"copy\",(function(e){if(function(e){return ao(e)&&so(no,e)}(e.keyEvent))return t.trigger(\"copy\"),!0})),n(\"paste\",(function(e){if(function(e){return ao(e)&&so(io,e)}(e.keyEvent))return t.trigger(\"paste\"),!0})),n(\"stepZoom\",(function(e){var n=e.keyEvent;if(so([\"+\",\"Add\",\"=\"],n)&&ao(n))return t.trigger(\"stepZoom\",{value:1}),!0})),n(\"stepZoom\",(function(e){var n=e.keyEvent;if(so([\"-\",\"Subtract\"],n)&&ao(n))return t.trigger(\"stepZoom\",{value:-1}),!0})),n(\"zoom\",(function(e){var n=e.keyEvent;if(so(\"0\",n)&&ao(n))return t.trigger(\"zoom\",{value:1}),!0})),n(\"removeSelection\",(function(e){if(so([\"Backspace\",\"Delete\",\"Del\"],e.keyEvent))return t.trigger(\"removeSelection\"),!0}))};var fo={__init__:[\"keyboard\",\"keyboardBindings\"],keyboard:[\"type\",uo],keyboardBindings:[\"type\",ho]},mo={moveSpeed:50,moveSpeedAccelerated:200};function yo(e,t,n){var i=this;this._config=E({},mo,e||{}),t.addListener((function(e){var n=e.keyEvent,r=i._config;if(!t.isCmd(n))return;if(t.isKey([\"ArrowLeft\",\"Left\",\"ArrowUp\",\"Up\",\"ArrowDown\",\"Down\",\"ArrowRight\",\"Right\"],n)){var o,a=t.isShift(n)?r.moveSpeedAccelerated:r.moveSpeed;switch(n.key){case\"ArrowLeft\":case\"Left\":o=\"left\";break;case\"ArrowUp\":case\"Up\":o=\"up\";break;case\"ArrowRight\":case\"Right\":o=\"right\";break;case\"ArrowDown\":case\"Down\":o=\"down\"}return i.moveCanvas({speed:a,direction:o}),!0}})),this.moveCanvas=function(e){var t=0,i=0,r=e.speed/Math.min(Math.sqrt(n.viewbox().scale),1);switch(e.direction){case\"left\":t=r;break;case\"up\":i=r;break;case\"right\":t=-r;break;case\"down\":i=-r}n.scroll({dx:t,dy:i})}}yo.$inject=[\"config.keyboardMove\",\"keyboard\",\"canvas\"];var go={__depends__:[fo],__init__:[\"keyboardMove\"],keyboardMove:[\"type\",yo]},vo=/^djs-cursor-.*$/;function xo(e){var t=Le(document.body);t.removeMatching(vo),e&&t.add(\"djs-cursor-\"+e)}var bo=5e3;function wo(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Eo(e,t){var n;function i(i){var r,o=n.start,a=n.button,s=vn(i),l=wo(s,o);(!n.dragging&&(r=l,Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))>15)&&(n.dragging=!0,0===a&&function(e,t){function n(){return!1}t=t||\"element.click\",e.once(t,bo,n)}(e),xo(\"grab\")),n.dragging)&&(l=wo(s,n.last||n.start),t.scroll({dx:l.x,dy:l.y}),n.last=s);i.preventDefault()}function r(e){Ke.unbind(document,\"mousemove\",i),Ke.unbind(document,\"mouseup\",r),n=null,xo(null)}e.on(\"element.mousedown\",500,(function(e){return function(e){if(Ve(e.target,\".djs-draggable\"))return;var t=e.button;if(t>=2||e.ctrlKey||e.shiftKey||e.altKey)return;return n={button:t,start:vn(e)},Ke.bind(document,\"mousemove\",i),Ke.bind(document,\"mouseup\",r),!0}(e.originalEvent)})),this.isActive=function(){return!!n}}Eo.$inject=[\"eventBus\",\"canvas\"];var _o={__init__:[\"moveCanvas\"],moveCanvas:[\"type\",Eo]};function Ao(e){return Math.log(e)/Math.log(10)}function ko(e,t){var n=Ao(e.min),i=Ao(e.max);return(Math.abs(n)+Math.abs(i))/t}var Ro=Math.sign||function(e){return e>=0?1:-1},So={min:.2,max:4};function Co(e,t,n){e=e||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=w(this._handleWheel,this),this._totalDelta=0,this._scale=e.scale||.75;var i=this;t.on(\"canvas.init\",(function(t){i._init(!1!==e.enabled)}))}Co.$inject=[\"config.zoomScroll\",\"eventBus\",\"canvas\"],Co.prototype.scroll=function(e){this._canvas.scroll(e)},Co.prototype.reset=function(){this._canvas.zoom(\"fit-viewport\")},Co.prototype.zoom=function(e,t){var n=ko(So,20);this._totalDelta+=e,Math.abs(this._totalDelta)>.1&&(this._zoom(e,t,n),this._totalDelta=0)},Co.prototype._handleWheel=function(e){if(!Ve(e.target,\".djs-scrollable\",!0)){var t=this._container;e.preventDefault();var n,i=e.ctrlKey||/mac/i.test(navigator.platform)&&e.metaKey,r=e.shiftKey,o=-1*this._scale;if(o*=i?0===e.deltaMode?.02:.32:0===e.deltaMode?1:16,i){var a=t.getBoundingClientRect(),s={x:e.clientX-a.left,y:e.clientY-a.top};n=Math.sqrt(Math.pow(e.deltaY,2)+Math.pow(e.deltaX,2))*Ro(e.deltaY)*o,this.zoom(n,s)}else n=r?{dx:o*e.deltaY,dy:0}:{dx:o*e.deltaX,dy:o*e.deltaY},this.scroll(n)}},Co.prototype.stepZoom=function(e,t){var n=ko(So,10);this._zoom(e,t,n)},Co.prototype._zoom=function(e,t,n){var i=this._canvas,r=e>0?1:-1,o=Ao(i.zoom()),a=Math.round(o/n)*n;a+=n*r;var s,l,p=Math.pow(10,a);i.zoom((s=So,l=p,Math.max(s.min,Math.min(s.max,l))),t)},Co.prototype.toggle=function(e){var t=this._container,n=this._handleWheel,i=this._enabled;return void 0===e&&(e=!i),i!==e&&Ke[e?\"bind\":\"unbind\"](t,\"wheel\",n,!1),this._enabled=e,e},Co.prototype._init=function(e){this.toggle(e)};var Mo={__init__:[\"zoomScroll\"],zoomScroll:[\"type\",Co]};function Po(e){to.call(this,e)}return e(Po,to),Po.prototype._navigationModules=[go,_o,Mo],Po.prototype._modules=[].concat(to.prototype._modules,Po.prototype._navigationModules),Po}));\n","import React, {\n  useRef,\n  useState,\n  useEffect,\n  forwardRef,\n  ForwardRefRenderFunction,\n} from \"react\";\n\n//@ts-ignore\nimport BpmnViewer from \"bpmn-js/dist/bpmn-navigated-viewer.production.min.js\";\nimport ZoomActions from \"../components/ZoomActions\";\nimport {\n  BpmnJsReactHandle,\n  BpmnJsReactProps,\n} from \"../interfaces/bpmnJsReact.interface\";\n\n// export type BpmnViewerProps = {\n//   xml: any;\n//   height?: any;\n//   zoomActions?: boolean;\n//   onLoading?: Function;\n//   onError?: Function;\n//   onShown?: Function;\n// };\n\nconst BpmnJsViewer: ForwardRefRenderFunction<\n  BpmnJsReactHandle,\n  BpmnJsReactProps\n> = (\n  {\n    xml,\n    height = 300,\n    zoomActions = true,\n    onLoading = () => {},\n    onError = () => {},\n    onShown = () => {},\n    ...props\n  },\n  ref\n) => {\n  const containerRef = useRef(null);\n  const [bpmnViewer, setBpmnViewer] = useState<BpmnViewer>();\n\n  useEffect(() => {\n    const container = containerRef.current;\n    setBpmnViewer(new BpmnViewer({ container }));\n\n    return () => bpmnViewer?.destroy();\n  }, []);\n\n  useEffect(() => {\n    bpmnViewer?.importXML(xml);\n    bpmnViewer?.get(\"canvas\").zoom(\"fit-viewport\");\n\n    bpmnViewer?.on(\"import.done\", (event: any) => {\n      const { error, warning } = event;\n\n      if (error) {\n        return onError(error);\n      }\n\n      zoomFit()\n\n      onShown(warning);\n    });\n  }, [bpmnViewer, xml]);\n\n  const zoomIn = () => {\n    bpmnViewer.get(\"zoomScroll\").stepZoom(0.1);\n  };\n\n  const zoomOut = () => {\n    bpmnViewer.get(\"zoomScroll\").stepZoom(-0.1);\n  };\n\n  const zoomFit = () => {\n    bpmnViewer.get(\"canvas\").zoom(\"fit-viewport\");\n  };\n\n  // useEffect(() => {\n  //   bpmnViewer?.importXML(xml);\n  // }, [xml, bpmnViewer]);\n\n  return (\n    <>\n      <div className=\"bpmn-wrapper\">\n        <div\n          className=\"bpmn-js-react-view-container\"\n          ref={containerRef}\n          style={{ height }}\n        ></div>\n        <div className=\"actions-wrapper\">\n          {zoomActions && (\n            <ZoomActions\n              zoomIn={zoomIn}\n              zoomOut={zoomOut}\n              zoomFit={zoomFit}\n            ></ZoomActions>\n          )}\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default forwardRef(BpmnJsViewer);\n","import React, { forwardRef, ForwardRefRenderFunction, useEffect, useRef, useState } from \"react\";\nimport BpmnJSModeler from \"./BpmnJsModeler\";\nimport BpmnJsViewer from \"./BpmnJsViewer\";\n\nimport \"@mantine/core/styles.css\";\nimport \"./index.scss\";\n\nimport { defaultBpmnXml } from \"../utils/bpmn.utils\";\nimport { createTheme, MantineProvider } from \"@mantine/core\";\nimport { BpmnJsReactHandle, BpmnJsReactProps } from \"../interfaces/bpmnJsReact.interface\";\nimport ConfigPanel from \"../components/ConfigPanel\";\n\nconst BpmnJsReact: ForwardRefRenderFunction<BpmnJsReactHandle, BpmnJsReactProps> = (\n  { mode = \"view\", xml, useBpmnJsReact, ...props },\n  ref\n) => {\n  const theme = createTheme({\n    /** Put your mantine theme override here */\n  });\n\n  return (\n    <>\n        <MantineProvider theme={theme}>\n            <div >\n\n                {mode == \"edit\" && (\n                    <BpmnJSModeler {...props} xml={xml} ref={ref} useBpmnJsReact={useBpmnJsReact}></BpmnJSModeler>\n                )}\n\n                {mode == \"view\" &&\n                    <BpmnJsViewer xml={xml} {...props} ref={ref} useBpmnJsReact={useBpmnJsReact}></BpmnJsViewer>}\n\n            </div>\n        </MantineProvider>\n    </>\n);\n};\n\n// export default forwardRef(BpmnJsReact);\nexport default forwardRef(BpmnJsReact);\n"],"names":["useBpmnJsReact","useState","bpmnModeler","setBpmnModeler","getCanvas","importXml","xml","saveXml","options","getElements","getElementById","id","zoomIn","step","_a","zoomOut","zoomFit","setStyle","canvas","addMarker","cssClass","removeMarker","setColor","elements","color","getElementRegistry","getBusinessObject","key","name","value","f","require$$0","k","l","m","n","p","q","a","g","b","d","e","h","reactJsxRuntime_production_min","React","REACT_ELEMENT_TYPE","REACT_PORTAL_TYPE","REACT_FRAGMENT_TYPE","REACT_STRICT_MODE_TYPE","REACT_PROFILER_TYPE","REACT_PROVIDER_TYPE","REACT_CONTEXT_TYPE","REACT_FORWARD_REF_TYPE","REACT_SUSPENSE_TYPE","REACT_SUSPENSE_LIST_TYPE","REACT_MEMO_TYPE","REACT_LAZY_TYPE","REACT_OFFSCREEN_TYPE","MAYBE_ITERATOR_SYMBOL","FAUX_ITERATOR_SYMBOL","getIteratorFn","maybeIterable","maybeIterator","ReactSharedInternals","error","format","_len2","args","_key2","printWarning","level","ReactDebugCurrentFrame","stack","argsWithFormat","item","enableScopeAPI","enableCacheElement","enableTransitionTracing","enableLegacyHidden","enableDebugTracing","REACT_MODULE_REFERENCE","isValidElementType","type","getWrappedName","outerType","innerType","wrapperName","displayName","functionName","getContextName","getComponentNameFromType","context","provider","outerName","lazyComponent","payload","init","assign","disabledDepth","prevLog","prevInfo","prevWarn","prevError","prevGroup","prevGroupCollapsed","prevGroupEnd","disabledLog","disableLogs","props","reenableLogs","ReactCurrentDispatcher","prefix","describeBuiltInComponentFrame","source","ownerFn","x","match","reentry","componentFrameCache","PossiblyWeakMap","describeNativeComponentFrame","fn","construct","frame","control","previousPrepareStackTrace","previousDispatcher","Fake","sample","sampleLines","controlLines","s","c","_frame","syntheticFrame","describeFunctionComponentFrame","shouldConstruct","Component","prototype","describeUnknownElementTypeFrameInDEV","hasOwnProperty","loggedTypeFailures","setCurrentlyValidatingElement","element","owner","checkPropTypes","typeSpecs","values","location","componentName","has","typeSpecName","error$1","err","ex","isArrayImpl","isArray","typeName","hasToStringTag","willCoercionThrow","testStringCoercion","checkKeyStringCoercion","ReactCurrentOwner","RESERVED_PROPS","specialPropKeyWarningShown","specialPropRefWarningShown","didWarnAboutStringRefs","hasValidRef","config","getter","hasValidKey","warnIfStringRefCannotBeAutoConverted","self","defineKeyPropWarningGetter","warnAboutAccessingKey","defineRefPropWarningGetter","warnAboutAccessingRef","ReactElement","ref","jsxDEV","maybeKey","propName","defaultProps","ReactCurrentOwner$1","ReactDebugCurrentFrame$1","setCurrentlyValidatingElement$1","propTypesMisspellWarningShown","isValidElement","object","getDeclarationErrorAddendum","getSourceInfoErrorAddendum","ownerHasKeyUseWarning","getCurrentComponentErrorInfo","parentType","info","parentName","validateExplicitKey","currentComponentErrorInfo","childOwner","validateChildKeys","node","i","child","iteratorFn","iterator","validatePropTypes","propTypes","_name","validateFragmentProps","fragment","keys","didWarnAboutKeySpread","jsxWithValidation","isStaticChildren","validType","sourceInfo","typeString","children","beforeExample","afterExample","jsxWithValidationStatic","jsxWithValidationDynamic","jsx","jsxs","reactJsxRuntime_development","jsxRuntimeModule","require$$1","createCommonjsModule","module","hat_1","hat","bits","base","digits","rem","res","parsed","expandBy","data","iters","hats","Ids","seed","flatten","arr","nativeToString","nativeHasOwnProperty","isUndefined","obj","isDefined","isNil","isObject","isNumber","isFunction","tag","isString","ensureArray","target","find","collection","matcher","matchFn","toMatcher","forEach","val","findIndex","idx","filter","result","convertKey","toNum","identity","without","el","reduce","every","matches","some","map","size","groupBy","extractor","grouped","toExtractor","discriminator","group","uniqueBy","collections","unionBy","sortBy","sorted","disc","entry","matchPattern","pattern","arg","debounce","timeout","timer","lastArgs","lastThis","lastNow","fire","force","now","scheduledDiff","schedule","clear","flush","callback","bind","others","set","path","currentTarget","nextKey","nextTarget","pick","properties","prop","omit","_mergeNamespaces","styleSources","style","attr","toString","classes","ClassList","re","selector","closest","checkYourSelf","currentElem","componentEvent","bind$1","unbind$1","detect","bind_1","capture","unbind_1","event","forceCaptureEvents","unbind","delegate","domify","parse","innerHTMLBug","bugTestDiv","html","doc","wrap","depth","suffix","domify$1","query","all","remove","ensureImported","appendTo","append","LENGTH_ATTR","CSS_PROPERTIES","getAttribute","setAttribute","hyphenated","setAttributes","attrs","names","parent","clone","ns","SVG_START","svg","unwrap","parseDocument","parser","create","getNode","extend","createMatrix","matrix","createTransform","TEXT_ENTITIES","ATTR_ENTITIES","ENTITY_REPLACEMENT","escape","str","replaceFn","entity","serialize","output","len","attrMap","attrNode","childNodes","get","innerSVG","wrapMatrix","transformList","transform","setTransforms","transforms","t","CLASS_PATTERN","isClass","hasOwnProp","annotate","CONSTRUCTOR_ARGS","FN_ARGS","FN_ARG","parseAnnotations","argMatch","Injector","modules","_parent","strict","currentlyResolving","providers","instances","msg","parts","pivot","fnDef","locals","dependencies","dep","instantiate","Constructor","invoke","func","createPrivateInjectorFactory","childInjector","createChild","forceNewInstances","fromParentModule","matchedScopes","privateInjectorsCache","privateChildInjectors","privateChildFactories","cacheIdx","privateChildInjector","privateChildInjectorFactory","scope","factoryMap","createInitializer","moduleDefinition","injector","initializers","initializer","loadModule","moduleExports","nestedModules","clonedModule","childModules","privateInjector","getFromPrivateInjector","typeDeclaration","arrayUnwrap","resolveDependencies","moduleDefinitions","bootstrap","initialized","DEFAULT_RENDER_PRIORITY","BaseRenderer","eventBus","renderPriority","evt","visuals","shape","connection","componentsToPath","move","point","lineTo","curveTo","p1","p2","p3","drawPath","waypoints","cornerRadius","pointCount","pointBefore","pointAfter","effectiveRadius","vectorLength","beforePoint","getPointAtLength","beforePoint2","afterPoint","afterPoint2","start","end","length","deltaX","deltaY","totalLength","percent","y","createLine","points","radius","line","svgCreate","updateLine","gfx","svgAttr","getParents","getParent","add","unique","canAdd","eachElement","selfAndChildren","maxDepth","processedChildren","selfAndAllChildren","allowDuplicates","getClosure","isTopLevel","closure","allShapes","copyObject","allConnections","enclosedElements","enclosedConnections","topLevel","handleConnection","handleElement","getBBox","stopRecursion","minX","minY","maxX","maxY","bbox","height","width","getEnclosedElements","filteredElements","getType","isFrameElement","src1","src2","DefaultRenderer","styles","inherits","rect","svgAppend","shapePath","connectionPath","Styles","defaultTraits","className","traits","additionalAttrs","custom","defaultStyles","DrawModule$1","currentIdx","indexOf","pointDistance","pointsOnLine","r","accuracy","dist","ALIGNED_THRESHOLD","pointsAligned","axisMap","axis","orientation","pointsAlignedOnAxis","referencePoint","pointInRect","tolerance","getMidPoint","p2s","toFloat","math","PI","mmin","mmax","pow","abs","pathCommand","pathValues","o","hasProperty","property","repush","array","ii","cacher","newf","cache","count","parsePathString","pathString","pth","paths","paramCounts","params","ps","rectBBox","pathToString","pathClone","pathArray","findDotsAtSegment","p1x","p1y","c1x","c1y","c2x","c2y","p2x","p2y","t1","t13","t12","t2","t3","fixError","bezierBBox","curveBBox","isPointInsideBBox","isBBoxIntersect","bbox1","bbox2","base3","p4","bezlen","x1","y1","x2","y2","x3","y3","x4","y4","z","z2","Tvalues","Cvalues","sum","ct","xbase","ybase","comb","intersectLines","nx","ny","denominator","px","py","px2","py2","number","findBezierIntersections","bez1","bez2","justCount","l1","l2","n1","isLine","n2","dots1","dots2","xy","j","di","di1","dj","dj1","ci","cj","is","findPathIntersections","path1","path2","pathToCurve","x1m","y1m","x2m","y2m","pi","jj","pj","intr","kk","pathToAbsolute","mx","my","pa0","pa","bez","lineToCurve","qubicToCurve","ax","ay","_13","_23","arcToCurve","rx","ry","angle","large_arc_flag","sweep_flag","recursive","_120","rad","rotate","X","Y","f1","f2","cx","cy","rx2","ry2","df","f2old","x2old","y2old","c1","s1","c2","s2","hx","hy","m1","m2","m3","m4","newres","x0","y0","tvalues","bounds","b2ac","sqrtb2ac","jlen","mt","curvedPath","processPath","fixArc","pp","pathCommands","pfirst","seg","seglen","isConnection","isLabel","roundBounds","roundPoint","asTRBL","asBounds","trbl","getBoundsMid","getConnectionMid","index","lastPoint","lastPart","startLength","distance","part","midLength","midSegment","segmentProgress","midPoint","getMid","getOrientation","reference","padding","rectOrientation","referenceOrientation","top","right","bottom","left","vertical","horizontal","getElementLineIntersection","elementPath","linePath","cropStart","intersections","getIntersections","intersectPaths","filterRedundantWaypoints","previousPoint","nextPoint","round","resolution","ensurePx","findRoot","createContainer","container","assignStyle","createGroup","cls","childIndex","svgClasses","BASE_LAYER","PLANE_LAYER_INDEX","UTILITY_LAYER_INDEX","REQUIRED_MODEL_ATTRS","Canvas","graphicsFactory","elementRegistry","viewport","layer","svgRemove","plane","rootElement","marker","layerName","currentRoot","requiredAttrs","parentIndex","collectionAdd","collectionRemove","secondary","changeFn","box","outerBox","innerBox","activeLayer","scale","svgTransform","delta","setCTM","defaultPadding","elementBounds","getBoundingBox","elementTrbl","viewboxBounds","zoom","dx","dy","viewboxTrbl","dRight","dLeft","dBottom","dTop","newScale","center","outer","mstr","vbox","inner","newViewbox","centerPoint","originalPoint","currentMatrix","scaleMatrix","newMatrix","currentScale","ELEMENT_ID","ElementRegistry","secondaryGfx","newId","filtered","refs","inverseProperty","isExtended","defineCollectionProperty","defineProperty","_value","old","Refs","parentRefs","labelRefs","attacherRefs","outgoingRefs","incomingRefs","ElementImpl","newLabel","label","labels","ShapeImpl","RootImpl","LabelImpl","ConnectionImpl","types","Type","isModelElement","ElementFactory","FN_REF","DEFAULT_PRIORITY","slice","EventBus","events","priority","that","actualCallback","wrappedCallback","InternalEvent","firstListener","returnValue","originalType","listener","invokeFunction","newListener","previousListener","nextListener","listenerCallback","getVisual","getChildren","amount","translate","GraphicsFactory","childrenGfx","visual","domClear","isFrame","outerGfx","prependTo","parents","childGfx","newNode","parentNode","siblingNode","CoreModule$1","DrawModule","createInjector","configModule","CoreModule","Diagram","Base","Factory","model","descriptor","ModdleElement","BUILTINS","TYPE_CONVERTERS","coerceType","converter","isBuiltIn","isSimple","parseName","defaultPrefix","localName","DescriptorBuilder","nameNs","validate","oldProperty","newProperty","replace","oldNameNs","propertiesByName","rename","targetPropertyName","nsPrefix","attrName","redefinedProperty","propsByName","typeDescriptor","propertyName","definedProperty","inherited","typesByName","replaces","redefines","Registry","packages","uriOrPrefix","pkg","pkgMap","ensureAvailable","propertyNs","extendsName","extendsNameNs","extended","nsName","trait","traverse","parentNs","traverseTrait","traverseSuper","builder","packageMap","identifierKey","Properties","stripGlobal","Moddle","nsUri","fromCharCode","ENTITY_PATTERN","ENTITY_MAPPING","replaceEntities","_","decodeEntities","XSI_URI","XSI_PREFIX","XSI_TYPE","NON_WHITESPACE_OUTSIDE_ROOT_NODE","missingNamespaceForPrefix","getFn","cloneNsMatrix","nsMatrix","uriPrefix","buildNsMatrix","nsUriToPrefix","uri","noopGetContext","throwFunc","Parser","proxy","onText","onOpenTag","onCloseTag","onCDATA","onError","onWarning","onComment","onQuestion","onAttention","getContext","maybeNS","isNamespace","returnError","parseStop","handleError","handleWarning","cb","nsMap","_nsUriToPrefix","nsMatrixStack","_nsMatrix","nodeStack","anonymousNsCount","tagStart","tagEnd","w","v","xmlns","elementName","_elementName","elementProxy","attrsString","attrsStart","cachedAttrs","getAttrs","nsUriPrefix","defaultAlias","attrList","hasNewMatrix","newalias","alias","seenAttrs","skipAttr","parseAttr","getParseContext","splitsRe","column","startOfLine","endOfLine","hasLowerCaseAlias","DEFAULT_NS_MAP","serializeFormat","serializeAsType","serializeAsProperty","capitalize","aliasToName","aliasNs","prefixedToName","typePrefix","normalizeXsiTypeName","parseNameNS","message","getModdleDescriptor","Context","elementsById","idProperty","warning","BaseHandler","NoopHandler","BodyHandler","text","ReferenceHandler","ValueHandler","propertyDesc","BaseElementHandler","ElementHandler","bodyProperty","attributes","instance","propNameNs","elementTypeName","elementType","GenericElementHandler","childHandler","isSimpleType","newElement","RootElementHandler","handler","Reader","done","rootHandler","lax","createStack","ctx","resolveReferences","references","handleClose","PREAMBLE_START_PATTERN","ENCODING_PATTERN","UTF_8_PATTERN","handleQuestion","question","encoding","handleOpen","handleCData","handleText","uriMap","decodeStr","selfClosing","decodedAttrs","resolve","reject","warnings","XML_PREAMBLE","ESCAPE_ATTR_CHARS","ESCAPE_CHARS","Namespaces","prefixMap","used","wellknown","isWellknown","nsKey","isUsed","allNs","lower","string","nameToAlias","ctor","superCtor","getNsAttrs","namespaces","getElementNs","getPropertyNs","getSerializableProperties","ESCAPE_ATTR_MAP","ESCAPE_MAP","charPattern","replaceMap","escapeAttr","escapeBody","filterAttributes","filterContained","ReferenceSerializer","tagName","writer","BodySerializer","ValueSerializer","ElementSerializer","propertyDescriptor","elementDescriptor","otherAttrs","isGeneric","effectiveNs","body","nonNsAttr","actualNs","genericAttrs","isReference","isMany","asType","asProperty","serializer","TypeSerializer","local","parentNamespaces","existing","newPrefix","wellknownUri","nsTagName","firstBody","indent","typeNs","SavingWriter","FormatingWriter","out","Writer","toXML","tree","internalWriter","formatingWriter","BpmnModdle","xmlStr","reader","name$5","uri$5","prefix$5","associations$5","types$5","enumerations$3","xml$1","BpmnPackage","name$4","uri$4","prefix$4","types$4","enumerations$2","associations$4","BpmnDiPackage","name$3","uri$3","prefix$3","types$3","associations$3","DcPackage","name$2","uri$2","prefix$2","types$2","associations$2","DiPackage","name$1","uri$1","prefix$1","types$1","enumerations$1","associations$1","BiocPackage","enumerations","associations","BpmnInColorPackage","simple","additionalPackages","pks","elementToString","DI_ERROR_MESSAGE","ensureCompatDiRef","businessObject","findDisplayCandidate","definitions","BpmnTreeWalker","handledElements","deferred","diMap","contextual","handled","isHandled","visit","visitRoot","diagram","visitIfDi","logError","registerDi","bpmnElement","handleDiagram","handlePlane","handlePlaneElement","planeElement","diagrams","handleProcess","handleCollaboration","handleUnhandledProcesses","handleDeferred","process","handleFlowElementsContainer","handleIoSpecification","handleArtifacts","rootElements","processes","handleMessageFlow","messageFlow","handleMessageFlows","messageFlows","handleDataAssociation","association","handleDataInput","dataInput","handleDataOutput","dataOutput","handleArtifact","artifact","artifacts","ioSpecification","handleSubProcess","subProcess","handleFlowNode","flowNode","childCtx","handleSequenceFlow","sequenceFlow","handleDataElement","dataObject","handleLane","lane","newContext","handleLaneSet","wireFlowNodeRefs","laneSet","handleLaneSets","laneSets","handleFlowElements","flowElements","flowElement","handleParticipant","participant","newCtx","collaboration","lanes","bo","isAny","getDi","importBpmnDiagram","bpmnDiagram","importer","render","visitor","parentShape","walker","diagramsToImport","getDiagramsToImport","rootId","findRootProcess","allChildren","selfAndAllFlowElements","BPMNIO_LOGO_SVG","BPMNIO_IMG","LOGO_STYLES","LINK_STYLES","LIGHTBOX_STYLES","BACKDROP_STYLES","NOTICE_STYLES","LIGHTBOX_MARKUP","lightbox","createLightbox","domQuery","open","domDelegate","BaseViewer","DEFAULT_OPTIONS","addProjectLogo","ParseCompleteEvent","aggregatedWarnings","parseResult","parseWarnings","importResult","addWarningsToError","checkValidationError","bpmnDiagramOrId","findBPMNDiagram","contentNode","defsNode","contents","defs","domRemove","moddle","baseModules","additionalModules","staticModules","diagramModules","diagramOptions","ensureUnit","moddleOptions","warningsAry","diagramId","linkMarkup","linkElement","domEvent","openPoweredBy","BaseModeler","ids","isExpanded","isHorizontal","isInterrupting","isEventSubProcess","hasEventDefinition","eventType","eventDefinitions","hasErrorEventDefinition","hasEscalationEventDefinition","hasCompensateEventDefinition","DEFAULT_LABEL_SIZE","FLOW_LABEL_INDENT","isLabelExternal","semantic","hasExternalLabel","getFlowLabelPosition","mid","first","second","position","getWaypointsMid","getExternalLabelMid","getExternalLabelBounds","getLabelAttr","getCategoryValue","categoryValueRef","getLabel","setLabel","black","white","isTypedEvent","eventDefinitionType","definition","isThrowEvent","isCollection","getFillColor","defaultColor","overrideColor","getStrokeColor","getLabelColor","defaultStrokeColor","getCirclePath","circlePath","getRoundRectPath","borderRadius","roundRectPath","getDiamondPath","halfWidth","halfHeight","diamondPath","getRectPath","rectPath","getBounds","overrides","getWidth","getHeight","rendererIds","ELEMENT_LABEL_DISTANCE","INNER_OUTER_DIST","PARTICIPANT_STROKE_WIDTH","TASK_BORDER_RADIUS","DEFAULT_OPACITY","FULL_OPACITY","LOW_OPACITY","BpmnRenderer","pathMap","textRenderer","defaultFillColor","defaultLabelColor","rendererId","markers","shapeStyle","lineStyle","colorEscape","fill","stroke","createMarker","sequenceflowEnd","messageflowStart","messageflowEnd","associationStart","associationEnd","conditionalFlowMarker","defaultFlowMarker","drawCircle","parentGfx","offset","circle","drawRect","drawDiamond","x_2","y_2","pointsString","polygon","drawLine","drawConnectionSegments","drawMarker","renderer","handlers","as","eventIconRenderers","isThrowing","pathData","messagePath","linePathData","renderEventIcon","getSemantic","taskMarkerRenderers","markerPath","markerRect","markerMath","renderTaskMarker","renderTaskMarkers","taskMarkers","subprocess","loopCharacteristics","isSequential","renderLabel","renderEmbeddedLabel","align","renderExternalLabel","renderLaneLabel","isHorizontalLane","textBox","renderActivity","renderAssociation","pickAttrs","renderDataObject","collectionPathData","renderEvent","renderGateway","renderLane","renderSubProcess","activity","expanded","renderTask","renderIcon","cancelActivity","task","headerData","businessPath","headerPathData","businessHeaderPath","gateway","arrowPathData","dataStorePath","diamond","drawEvent","markerPathData","messageAttrs","messageRef","messageBounds","labelBounds","translateX","translateY","expandedParticipant","horizontalParticipant","sourceSemantic","pathDataService1","pathDataService2","textElement","textPathData","innerAttrs","pathDataUser1","pathDataUser2","pathDataUser3","pickedAttrs","DEFAULT_BOX_PADDING","parseAlign","parsePadding","getTextBBox","fakeText","textBBox","emptyLine","layoutNext","lines","maxWidth","originalLine","fitLine","fit","shortenLine","remainder","SOFT_BREAK","semanticShorten","maxLength","shortenedParts","last","shortenedLine","getHelperSvg","helperSvg","Text","fitBox","lineHeight","getLineHeight","layouted","helperText","totalHeight","maxLineWidth","tspan","dimensions","DEFAULT_FONT_SIZE","LINE_HEIGHT_RATIO","MIN_TEXT_ANNOTATION_HEIGHT","TextRenderer","defaultStyle","fontSize","externalStyle","textUtil","TextUtil","layoutedDimensions","PathMap","pathId","param","rawPath","coordinates","heightRatio","widthRatio","heightIndex","widthIndex","tokenRegex","objNotationRegex","replacer","quote","quotedName","isFunc","template","replacements","TranslateModule","elementData","getWaypoints","notYetDrawn","refSemantic","BpmnImporter","elementFactory","parentElement","hidden","collapsed","boundarySemantic","boundaryElement","hostSemantic","host","attachers","side","ImportModule","IdGenerator","LOW_PRIORITY","Overlays","createRoot","search","overlay","overlays","setVisible","setPosition","domAttr","htmlContainer","viewbox","setTransform","raw","overlayContainer","domClasses","elementRoot","activeRoot","show","minZoom","maxZoom","activeRootElement","visible","shouldScale","minScale","maxScale","updateViewbox","root","OverlaysModule","ChangeSupport","getElementType","ChangeSupportModule","CommandInterceptor","unwrapEvent","hook","handlerFn","fullEvent","createHook","RootElementsBehavior","RootElementsModule","escapeCSS","HTML_ESCAPE_MAP","escapeHTML","planeSuffix","getShapeIdFromPlane","removePlaneSuffix","getPlaneIdFromShape","addPlaneSuffix","toPlaneId","isPlane","OPEN_CLASS","DrilldownBreadcrumbs","breadcrumbs","containerClasses","businessObjectParents","isPresent","updateBreadcrumbs","getBusinessObjectParentChain","title","link","parentPlane","DrilldownCentering","positionMap","Map","newRoot","currentViewbox","storedViewbox","found","DEFAULT_POSITION","SubprocessCompatibility","newDiagrams","createdDiagrams","collapsedElements","elementsToMove","diElement","shouldMoveToPlane","planeBounds","getPlaneBounds","waypoint","newPlane","containingDiagram","findRootDiagram","parentPlaneElement","planeTrbl","ARROW_DOWN_SVG","EMPTY_MARKER","DrilldownOverlayBehavior","oldParent","newParent","hasFlowElements","existingOverlays","button","DrilldownModdule","Outline","OUTLINE_STYLE","createOutline","outline","updated","OutlineModule$1","DATA_OBJECT_REFERENCE_OUTLINE_PATH","DATA_STORE_REFERENCE_OUTLINE_PATH","DATA_OBJECT_REFERENCE_STANDARD_SIZE","DATA_STORE_REFERENCE_STANDARD_SIZE","createPath","DEFAULT_OFFSET","OutlineProvider","isStandardSize","standardSize","OutlineModule","Ouline","OulineProvider","__stopPropagation","getOriginal","stopPropagation","toPoint","isMac","isButton","getOriginalEvent","isPrimaryButton","isAuxiliaryButton","hasPrimaryModifier","originalEvent","hasSecondaryModifier","allowAll","allowPrimaryAndAuxiliary","InteractionEvents","isIgnored","mouseHandler","localEventName","ignoredFilters","bindings","triggerMouseEvent","eventName","targetElement","ELEMENT_SELECTOR","registerEvent","localEvent","ignoredFilter","unregisterEvent","registerEvents","unregisterEvents","STROKE_HIT_STYLE","createHitStyle","CLICK_STROKE_HIT_STYLE","ALL_HIT_STYLE","NO_MOVE_HIT_STYLE","HIT_TYPES","classNames","applyStyle","hit","appendHit","hits","domQueryAll","boxType","InteractionEventsModule$1","Selection","selectedElements","oldSelection","MARKER_HOVER","MARKER_SELECTED","SELECTION_OUTLINE_PADDING","SelectionVisuals","selection","deselect","select","newSelection","svgClear","enabled","bBox","addSelectionOutlinePadding","SelectionBehavior","canExecute","hints","autoSelect","isShown","previousSelection","isSelected","selectedShape","isMultiSelect","SelectionModule","InteractionEventsModule","Viewer","KEYS_COPY","KEYS_PASTE","KEYS_REDO","KEYS_UNDO","hasModifier","isCmd","isKey","isShift","isCopy","isPaste","isUndo","isRedo","KEYDOWN_EVENT","KEYUP_EVENT","HANDLE_MODIFIER_ATTRIBUTE","Keyboard","eventBusResult","isInput","allowedModifiers","modifierContainer","domClosest","domMatches","KeyboardBindings","keyboard","editorActions","addListener","action","KeyboardModule$1","DEFAULT_CONFIG","KeyboardMove","arrowsListener","speed","direction","actualSpeed","KeyboardMoveModule","KeyboardModule","CURSOR_CLS_PATTERN","mode","unset","TRAP_PRIORITY","install","trap","THRESHOLD","MoveCanvas","handleStart","handleMove","deltaPos","installClickTrap","cursorSet","lastPosition","handleEnd","cursorUnset","MoveCanvasModule","log10","getStepSize","range","steps","minLinearRange","maxLinearRange","absoluteLinearRange","cap","sign","RANGE","NUM_STEPS","DELTA_THRESHOLD","DEFAULT_SCALE","ZoomScroll","stepSize","isZoom","isHorizontalScroll","factor","elementRect","currentLinearZoomLevel","newLinearZoomLevel","newLogZoomLevel","newEnabled","handleWheel","oldEnabled","ZoomScrollModule","NavigatedViewer","sortTopOrMiddle","sortLeftOrCenter","ALIGNMENT_SORTING","AlignElements","modeling","rules","dimension","sortedElements","alignment","centers","hasSharedCenters","centeredElements","firstElement","lastElement","getMiddleOrTop","allowed","sortFn","AlignElementsModule$1","MARKERS_HIDDEN","entrySelector","CONTEXT_PAD_MARGIN","HOVER_DELAY","ContextPad","current","targets","targetsChanged","includes","targetsNew","provideFn","entries","entriesOrUpdater","autoActivate","entryId","image","grouping","addClasses","targetsEqual","lastWaypoint","getLastWaypoint","containerBounds","targetBounds","isHidden","elementsGfx","elementGfx","otherTarget","ContextPadModule$1","u","C","P","S","O","$","I","N","H","A","V","F","L","M","T","B","e$1","D","clsx","PopupMenuItem","selected","onMouseEnter","onMouseLeave","onAction","PopupMenuList","selectedEntry","setSelectedEntry","restProps","resultsRef","useRef","groups","useMemo","groupEntries","useLayoutEffect","containerEl","selectedEl","scrollIntoView","getGroup","elem","containsGroup","formatGroup","PopupMenuComponent","onClose","onSelect","headerEntries","emptyPlaceholder","originalEntries","onOpened","onClosed","searchable","setValue","filterEntries","useCallback","searchableFields","word","field","setEntries","updateEntries","newEntries","useEffect","keyboardSelect","nextIdx","handleKeyDown","handleKey","displayHeader","PopupMenuWrapper","getHeaderClasses","onKeydown","onKeyup","positionGetter","popupRef","popupEl","handleClick","getPopupStyle","DATA_REF","CLOSE_EVENTS","PopupMenu","_position","entriesArray","headerEntriesArray","providerId","scaleConfig","documentBounds","overAxis","PopupMenuModule$1","icons","AlignElementsContextPadProvider","contextPad","popupMenu","actions","ICONS","Y_OFFSET","pad","padRect","pos","ALIGNMENT_OPTIONS","AlignElementsMenuProvider","alignElements","RuleProvider","BpmnAlignElements","AlignElementsModule","ContextPadModule","PopupMenuModule","PLACEMENT_DETECTION_PAD","DEFAULT_DISTANCE","DEFAULT_MAX_DISTANCE","findFreePosition","getNextPosition","connectedAtPosition","getConnectedAtPosition","generateGetNextPosition","nextPositionDirection","previousPosition","nextPosition","nextPositionDirectionForAxis","margin","minDistance","getAutoPlaceClosure","getConnectedDistance","getDefaultWeight","defaultDistance","getWeight","maxDistance","noneFilter","getDistance","sourcesDistances","weight","targetsDistances","distances","accumulator","currentValue","distancesGrouped","allConnected","getConnected","shapes","attacher","getTargets","getSources","AutoPlace","getNewShapePosition","newShape","sourceMid","sourceTrbl","AutoPlaceSelectionBehavior","AutoPlaceModule$1","anyType","isDirectionHorizontal","getTextAnnotationPosition","getDataElementPosition","getFlowNodePosition","placeHorizontally","placement","connectedDistance","AutoPlaceModule","BpmnAutoPlace","AutoResize","autoResize","expandings","parentId","elementsTrbl","targetTrbl","newTrbl","newBounds","boundsChanged","resizeDirections","getResizeDirections","oldBounds","directions","BpmnAutoResize","AutoResizeProvider","BpmnAutoResizeProvider","canResize","AutoResizeModule","HIGH_PRIORITY","HoverFix","dragging","ensureHover","hoverGfx","hover","getGfx","HoverFixModule","DRAG_ACTIVE_CLS","preventDefault","isTouchEvent","getLength","Dragging","defaultOptions","toLocalPoint","globalPosition","clientRect","dragContext","restoreSelection","existingSelection","activate","displacement","globalStart","globalCurrent","globalDelta","localStart","localCurrent","localDelta","cancel","previousContext","cleanup","checkCancel","trapClickAndEnd","untrap","trapTouch","restore","wasActive","endDrag","relativeTo","isTouch","DraggingModule","AutoScroll","opts","diff","between","AutoScrollModule","Rules","commandStack","RulesModule$1","max","segments","INTERSECTION_THRESHOLD","getBendpointIntersection","getPathIntersection","getApproxIntersection","vector","getAngle","rotateVector","solveLambaSystem","system","perpendicularFoot","bd","getDistancePointLine","pfPoint","connectionVector","getDistancePointPoint","point1","point2","BENDPOINT_CLS","SEGMENT_DRAGGER_CLS","toCanvasCoordinates","getConnectionIntersection","localPosition","intersection","addBendpoint","groupGfx","createParallelDragger","segmentStart","segmentEnd","draggerGfx","hitWidth","calculateHitWidth","hitHeight","addSegmentDragger","calculateSegmentMoveRegion","segmentLength","getClosestPointOnConnection","segment","getClosestSegment","segmentLengthXAxis","segmentLengthYAxis","segmentIndex","Bendpoints","interactionEvents","bendpointMove","connectionSegmentMove","isIntersectionMiddle","treshold","p0","aligned","xDelta","yDelta","calculateIntersectionThreshold","relevantSegment","threshold","activateBendpointMove","bindInteractionEvents","getBendpointsContainer","getSegmentDragger","createBendpoints","bendpoint","createSegmentDraggers","segmentDraggerGfx","clearBendpoints","clearSegmentDraggers","addHandles","updateHandles","updateFloatingBendpointPosition","floating","updateSegmentDraggerPosition","draggerVisual","relativePosition","getDraggerVisual","bendpointsGfx","primary","bendpointContainer","RECONNECT_START","RECONNECT_END","UPDATE_WAYPOINTS","BendpointMove","bendpointIndex","insert","command","newWaypoints","docking","isReverse","connectionDocking","MARKER_OK","MARKER_NOT_OK","MARKER_CONNECT_HOVER","MARKER_CONNECT_UPDATING","MARKER_DRAGGER","BendpointMovePreview","connectionPreview","drawPreviewHints","axisAdd","axisSet","axisFenced","maxValue","minValue","fencedValue","flipAxis","getDocking","referenceElement","moveAxis","referenceMid","inverseAxis","ConnectionSegmentMove","segmentStartIndex","segmentEndIndex","dragPosition","cropConnection","oldWaypoints","croppedWaypoints","redrawConnection","updateDragger","segmentOffset","draggerPosition","filteredWaypoints","newSegmentStart","newSegmentEnd","waypointCount","sourceToSegmentOrientation","targetToSegmentOrientation","newSegmentStartIndex","snapTo","snapValue","topLeft","bottomRight","defaultValue","isSnapped","snapped","setSnapped","previousValue","TOLERANCE","BendpointSnapping","getSnapPoint","getConnectionSegmentSnaps","snapPoints","referenceWaypoints","sx","sy","getBendpointSnaps","hoverMid","BendpointsModule","RulesModule","Connect","canConnect","canConnectReverse","connectionStart","connectionEnd","ConnectPreview","startPosition","previewStart","previewEnd","ConnectModule","MARKER_CONNECTION_PREVIEW","ConnectionPreview","connectionPreviewGfx","getConnection","noLayout","noCropping","noNoop","cacheReturnValues","sourcePath","targetPath","ensureConnectionAttrs","returnValues","firstArgument","ConnectionPreviewModule","MARKER_TYPES","NODES_CAN_HAVE_MARKER","PreviewSupport","clonedMarker","dragger","svgClone","canHaveMarker","markerType","getMarker","markerId","clonedMarkerId","idToReference","referenceToId","PreviewSupportModule","LAYER_NAME","ComplexPreview","previewSupport","created","moved","removed","resized","ComplexPreviewModule","ALIGNMENTS","AdaptiveLabelPositioningBehavior","checkLabelAdjustment","optimalPosition","getOptimalPosition","adjustLabelPosition","elementMid","labelMid","newLabelMid","substract","getTakenHostAlignments","hostElement","hostOrientation","freeAlignments","takenAlignments","getTakenConnectionAlignments","getApproximateOrientation","labelOrientation","isAligned","takenHostAlignments","AppendBehavior","AssociationBehavior","AttachEventBehavior","bpmnReplace","shouldReplace","eventDefinition","getEventDefinition","boundaryEvent","BoundaryEventBehavior","getBoundaryEvents","boundaryEvents","oldSource","newSource","attachedboundaryEvents","CompensateBoundaryEventBehavior","bpmnRules","handleReplacement","handleReplacementPostExecuted","handleNewConnection","handleConnectionRemoval","handleReconnection","handlePropertiesUpdate","isCompensationBoundaryEvent","isForCompensation","removeIsForCompensationProperty","isForCompensationAllowed","addIsForCompensationProperty","removeExistingAssociations","newTarget","oldTarget","removeDisallowedConnections","removeAttachments","removeIncomingCompensationAssociations","newData","oldShape","targetConnection","removeOutgoingSequenceFlows","ignoredAssociations","attachments","compensationAssociations","sequenceFlows","CreateBehavior","CreateDataObjectBehavior","bpmnFactory","HORIZONTAL_PARTICIPANT_PADDING","VERTICAL_PARTICIPANT_PADDING","PARTICIPANT_BORDER_WIDTH","CreateParticipantBehavior","childrenBBox","participantBounds","getParticipantBounds","getParticipantCreateConstraints","rootElementGfx","ensureHoveringProcess","getOrCreateCollaboration","findParticipant","processRef","TARGET_REF_PLACEHOLDER_NAME","DataInputAssociationBehavior","ifDataInputAssociation","fixTargetRef","usesTargetRef","targetRef","removedConnection","inputAssociations","getTargetRef","targetRefProp","cleanupTargetRef","connectionBo","targetBo","newTargetBo","oldTargetBo","dataAssociation","UpdateSemanticParentHandler","bpmnUpdater","dataStoreBo","dataStoreDi","newSemanticParent","newDiParent","oldSemanticParent","oldDiParent","DataStoreBehavior","getFirstParticipantWithProcessRef","getDataStores","updateDataStoreParent","dataStore","newDataStoreParent","newDataStoreParentBo","dataStoreReferences","getAncestor","isDescendant","oldRoot","dataStores","descendant","ancestor","descendantBo","ancestorBo","min","DEFAULT_CHILD_BOX_PADDING","substractTRBL","trblA","trblB","resizeBounds","resizeTRBL","resize","applyConstraints","resizeConstraints","ensureConstraints","currentBounds","currentTrbl","getMinResizeBounds","minDimensions","childrenBounds","currentBox","minBox","childrenBox","combinedBox","asPadding","mayBePadding","addPadding","isBBoxChild","computeChildrenBBox","shapeOrChildren","getTRBLResize","LANE_PARENTS","LANE_INDENTATION","collectLanes","collectedShapes","getChildLanes","getLanesRoot","computeLanesResize","initialShapes","allLanes","shapeTrbl","shapeNewTrbl","trblResize","resizeNeeded","other","topResize","rightResize","bottomResize","leftResize","otherTrbl","DeleteLaneBehavior","spaceTool","compensateLaneDelete","siblings","topAffected","bottomAffected","leftAffected","rightAffected","topAdjustments","bottomAdjustments","leftAdjustments","rightAdjustments","DetachEventBehavior","newHost","intermediateEvent","DropOnFlowBehavior","insertShape","targetFlow","positionOrBounds","waypointsBefore","waypointsAfter","dockingPoint","incomingConnection","outgoingConnection","oldOutgoing","oldIncoming","copy","duplicateConnections","shapeMid","newShapeMid","canInsert","EventBasedGatewayBehavior","isSequenceFlow","flow","sequenceFlowsFromNewShape","HIGHEST_PRIORITY","FixHoverBehavior","createCategory","createCategoryValue","linkCategoryValue","categoryValue","category","unlinkCategoryValue","unlinkCategory","LOWER_PRIORITY","GroupBehavior","bpmnjs","moddleCopy","getGroupElements","isReferencedCategory","_category","isReferencedCategoryValue","removeCategoryValue","addCategoryValue","setCategoryValue","unsetCategoryValue","labelTarget","groupBo","lineIntersect","l1s","l1e","l2s","l2e","numerator","ImportDockingFix","adjustDocking","startPoint","elementTop","elementLeft","verticalIntersect","horizontalIntersect","centerIntersect","fixDockings","IsHorizontalFix","elementTypesToUpdate","sqrt","sq","getAttachment","segmentStartDistance","segmentEndDistance","attachmentPosition","attachment","attachmentDistance","closestAttachmentDistance","closestAttachment","pointsEqual","getCircleSegmentIntersections","cc","cr","baX","baY","caX","caY","bBy2","pBy2","tmpSqrt","abScalingFactor1","abScalingFactor2","i1","i2","isPointInSegment","fenced","rangeStart","rangeEnd","EQUAL_THRESHOLD","findNewLineStartIndex","oldSegmentStartIndex","newIndex","rel","relativePositionMidWaypoint","getAnchorPointAdjustment","oldPosition","oldLabelLineIndex","newLabelLineIndex","oldLabelLine","getLine","newLabelLine","oldFoot","relativeFootPosition","getRelativeFootPosition","angleDelta","getAngleDelta","oldBendpointIndex","oldBendpoint","newBendpoint","newFoot","newLabelVector","distanceSegment1","distanceSegment2","a1","a2","foot","lengthToFoot","getLabelAdjustment","labelPosition","getNewAttachPoint","oldCenter","newCenter","oldDelta","newDelta","getNewAttachShapeDelta","shapeCenter","shapeDelta","oldCenterDelta","stickyPositionDelta","getStickyPositionDelta","newCenterDelta","newShapeCenter","oldShapeCenter","oldTRBL","newTRBL","isMoved","oldOrientation","newOrientation","isHorizontallyMoved","isVerticallyMoved","NAME_PROPERTY","TEXT_PROPERTY","LabelBehavior","onPropertyUpdate","getVisibleLabelAdjustment","labelAdjustment","edges","asEdges","getReferencePoint","getReferencePointDelta","newReferencePoint","nearestLine","getNearestLine","getConnectionAdjustment","LayoutConnectionBehavior","getnewAnchorPoint","getConnectionAnchorPoint","outgoing","incoming","endPoint","newEndpoint","startpoint","newStartpoint","getResizedSourceAnchor","safeGetWaypoints","waypointsInsideNewBounds","getWaypointsInsideBounds","oldAnchor","getResizedTargetAnchor","getMovedSourceAnchor","moveDelta","subtract","getMovedTargetAnchor","originalWaypoints","isInsideBounds","MessageFlowBehavior","isParticipantCollapse","getMessageFlows","anchor","NON_INTERRUPTING_EVENT_TYPES","canBeNonInterrupting","getInterruptingProperty","NonInterruptingBehavior","isOldInterrupting","isNewInterruptingDefault","RemoveEmbeddedLabelBoundsBehavior","RemoveElementBehavior","inConnection","outConnection","getNewWaypoints","inWaypoints","outWaypoints","RemoveParticipantBehavior","collaborationRoot","ReplaceConnectionBehavior","fixConnection","replacementType","replaceReconnectedConnection","replacement","cleanDraggingSelection","oldConnection","newConnection","ReplaceElementBehaviour","elementReplacements","canReplace","topLevelElements","newElements","oldElement","GROUP_MIN_DIMENSIONS","LANE_MIN_DIMENSIONS","VERTICAL_LANE_MIN_DIMENSIONS","PARTICIPANT_MIN_DIMENSIONS","VERTICAL_PARTICIPANT_MIN_DIMENSIONS","SUB_PROCESS_MIN_DIMENSIONS","TEXT_ANNOTATION_MIN_DIMENSIONS","ResizeBehavior","balanced","getParticipantResizeConstraints","addToTrbl","choice","addMin","addMax","LANE_PADDING","VERTICAL_LANE_PADDING","laneShape","resizeDirection","lanesRoot","isFirst","isLast","laneTrbl","maxTrbl","minTrbl","flowElementTrbl","SLIGHTLY_HIGHER_PRIORITY","ResizeLaneBehavior","RootElementReferenceBehavior","canHaveRootElementReference","hasAnyEventDefinition","hasRootElement","getRootElementReferencePropertyName","getRootElement","setRootElement","addedRootElement","referencedRootElement","SpaceToolBehavior","getParticipantMinDimensions","isHorizontalAxis","hasChildLanes","isHorizontalResize","getParticipantMinWidth","getParticipantMinHeight","lanesMinHeight","getLanesMinHeight","lanesMinWidth","getLanesMinWidth","resizeStart","resizedLane","findResizedLane","childLanes","SubProcessPlaneBehavior","isCollapsedSubProcess","removeRoot","attachedRoot","oldProperties","oldId","primaryShape","referencedShape","visibleChildren","targetMid","childrenMid","diPlane","diDiagram","removedDiagram","SubProcessStartEventBehavior","getStartEventPosition","TextAnnotationBehavior","ToggleCollapseConnectionBehaviour","incomingConnections","outgoingConnections","ToggleElementCollapseBehaviour","hideEmptyLabels","expandedBounds","defaultSize","visibleElements","visibleBBox","filterVisible","collapsedBounds","UnclaimIdBehavior","shapeBo","rootElementBo","DeleteSequenceFlowBehavior","isDefaultFlow","sourceBo","UpdateFlowNodeRefsBehavior","initContext","UpdateContext","releaseContext","triggerUpdate","laneRefUpdateEvents","updateContext","BehaviorModule","UnsetDefaultFlowBehavior","getBoundaryAttachment","BpmnRules","canStartConnection","targetParent","targetAttach","canAttach","canCreate","canMove","canCopy","canConnectMessageFlow","canConnectSequenceFlow","canConnectDataAssociation","canConnectAssociation","canConnectCompensationAssociation","canDrop","nonExistingOrLabel","isSame","getOrganizationalParent","isTextAnnotation","isGroup","isCompensationBoundary","isSameOrganization","parentA","parentB","isMessageFlowSource","hasEventDefinitionOrNone","isMessageFlowTarget","getScopeParent","isSameScope","scopeParentA","scopeParentB","isSequenceFlowSource","isSequenceFlowTarget","isEventBasedTarget","isParent","possibleParent","allParents","connectDataAssociation","isDroppableBoundaryEvent","hasNoEventDefinition","hasCommonBoundaryIntermediateEventDefinition","isBoundaryEvent","isLane","isBoundaryCandidate","hasOneOfEventDefinitions","isReceiveTaskAfterEventBasedGateway","isBoundaryAttachment","isOneTextAnnotation","sourceTextAnnotation","targetTextAnnotation","isHostOfElement","potentialHost","BpmnDiOrdering","orderDi","rootDi","diElements","DiOrderingModule","OrderingProvider","ordering","BpmnOrderingProvider","orders","computeOrder","getOrder","order","findActualParent","containers","actualParent","elementOrder","currentIndex","insertIndex","OrderingModule","Clipboard","ClipboardModule","MARKER_ATTACH","MARKER_NEW_PARENT","PREFIX","Create","attach","connect","isSingleShape","connectionTarget","setMarker","createConstraints","CreatePreview","createDragGroup","dragGroup","CreateModule","Mouse","setLastMoveEvent","mousemoveEvent","createMoveEvent","screenX","screenY","clientX","clientY","MouseModule","CopyPaste","clipboard","mouse","parentCopied","isAttacher","copyWaypoints","branch","elementsData","addElementData","foundElementData","removeElementData","_index","addRelatedElements","removeElement","copyWaypoint","CopyPasteModule$1","copyProperties","BpmnCopyPaste","businessObjectCopy","diCopy","referencesKey","getReferences","setReferences","participantBo","DISALLOWED_PROPERTIES","ModdleCopy","propertyNames","parentDescriptor","sourceElement","getPropertyNames","canCopyProperties","sourceProperty","copiedProperty","canSetProperty","childProperties","childProperty","keepDefaultProperties","CopyPasteModule","Replace","centerX","centerY","ReplaceSelectionBehavior","ReplaceModule$1","CUSTOM_PROPERTIES","shouldToggleCollapsed","oldCollapsed","targetCollapsed","BpmnReplace","replaceElement","oldBusinessObject","isSubProcess","newBusinessObject","elementProps","newElementProps","copyProps","ReplaceModule","ToolManager","tools","tool","eventsToRegister","isPaletteClick","ToolManagerModule","getDirection","getWaypointsUpdatingConnections","movingShapes","resizingShapes","waypointsUpdatingConnections","AXIS_TO_DIMENSION","CURSOR_CROSSHAIR","DIRECTION_TO_TRBL","DIRECTION_TO_OPPOSITE","PADDING","SpaceTool","toolManager","reactivate","spaceToolConstraints","getSpaceToolConstraints","setCursor","connections","moveShape","resizeShape","shapeStart","shapeEnd","mouseEvent","resizingShape","resizingShapeBBox","nonMovingResizingChildren","movingChildren","minOrMax","nonMovingResizingChildrenBBox","movingChildrenBBox","movingAttachers","nonMovingAttachers","movingAttachersBBox","movingAttachersConstraint","nonMovingAttachersBBox","nonMovingAttachersConstraint","resizingShapeMinDimensions","MARKER_DRAGGING","MARKER_RESIZING","SpaceToolPreview","addPreviewGfx","space","crosshairGroup","pathX","pathY","spaceLayer","movingConnections","sourceIsMoving","targetIsMoving","sourceIsResizing","targetIsResizing","frameGroup","frames","initialBounds","opposite","SpaceToolModule$1","BpmnSpaceTool","adjustments","isCollapsedPool","SpaceToolModule","CommandStack","emit","next","handlerCls","qualifier","execution","redo","baseAction","trigger","dirty","stackIdx","CommandModule","saveClear","removeFn","LabelSupport","movePreview","validatedShapes","removeLabels","enclosedLabels","collectionIdx","labelTargetIndex","LabelSupportModule","AttachSupport","addAttached","removeAttached","getAttachers","AttachSupportModule","BpmnFactory","BpmnUpdater","updateParent","reverseUpdateParent","ifBpmn","updateRoot","updateBounds","updateConnection","updateConnectionWaypoints","oldSourceBo","newSourceBo","updateAttachment","updateBPMNLabel","diLabel","parentBusinessObject","parentDi","embeddedLabelBounds","getEmbeddedLabelBounds","embeddedLabelBoundsDelta","newContainment","oldContainment","oldRefs","newRefs","connectionDi","newSourceDi","newTargetDi","planeElements","getDefinitions","visualParent","containment","diChildren","inverseSet","BaseElementFactory","isModdleDi","diAttrs","applyAttributes","applyAttribute","newEventDefinition","attributeNames","attributeName","AppendShapeHandler","existsConnection","CreateConnectionHandler","layouter","CreateElementsHandler","createShapeHints","CreateShapeHandler","CreateLabelHandler","originalExecute","ensureValidDimensions","originalRevert","DeleteConnectionHandler","DeleteElementsHandler","DeleteShapeHandler","oldParentIndex","DistributeElements","OFF_AXIS","updateRange","lastIdx","rangeDiff","centerElement","refCenter","firstGroup","lastGroupIdx","lastGroup","spaceInBetween","groupsSize","refElem","groupIdx","LayoutConnectionHandler","MoveConnectionHandler","newParentIndex","MoveClosure","newClosure","MoveHelper","keepParent","sourceMoved","targetMoved","MoveElementsHandler","MoveShapeHandler","ReconnectConnectionHandler","dockingOrPoints","layoutConnectionHints","ReplaceShapeHandler","canReconnect","ResizeShapeHandler","minBounds","SpaceToolHandler","affectedShapes","getAxisFromDirection","layoutHints","shouldMoveWaypoint","relevantAxis","ToggleShapeCollapseHandler","getElementsVisibilityRecursive","setHiddenRecursive","oldChildrenVisibility","restoreVisibilityRecursive","newHidden","lastState","UpdateAttachmentHandler","oldHost","removeAttacher","addAttacher","attacherIdx","UpdateWaypointsHandler","Modeling","DistributeElementsHandler","AlignElementsHandler","UpdateModdlePropertiesHandler","moddleElement","changed","getModdleProperties","setModdleProperties","getAllDataObjectReferences","DEFAULT_FLOW","ID","DI","NULL_DIMENSIONS","UpdatePropertiesHandler","unwrapBusinessObjects","getProperties","isIdChange","setProperties","newLabelBounds","getDiProperties","setDiProperties","referencePropertyNames","unwrappedProps","UpdateCanvasRootHandler","newRootBusinessObject","oldRootBusinessObject","bpmnDefinitions","AddLaneHandler","isRoot","laneParent","existingChildLanes","siblingPosition","allAffected","lanePosition","spacePos","newLanePosition","SplitLaneHandler","newLanesCount","existingLanesCount","laneBaseSize","newLanesSize","laneSize","laneBounds","newLaneAttrs","ResizeLaneHandler","trblDiff","change","FLOW_NODE_REFS_ATTR","LANES_ATTR","UpdateFlowNodeRefsHandler","flowNodeShapes","laneShapes","handledNodes","updates","participantCache","allFlowNodeShapes","isInLaneShape","addFlowNodeShape","flowNodeShape","getAllLaneShapes","getNewLanes","allLaneShapes","update","oldLane","newLane","IdClaimHandler","claiming","DEFAULT_COLORS","SetColorHandler","hexColor","colorToHex","colors","assignedDi","elementDi","ensureLegacySupport","UpdateLabelHandler","setText","preExecute","isEmptyText","paddingTop","labelCenter","execute","revert","postExecute","BaseModeling","targetLaneShape","targetLane","collaborationElement","processElement","BaseLayouter","MIN_SEGMENT_LENGTH","POINT_ORIENTATION_PADDING","ORIENTATION_THRESHOLD","needsTurn","startDirection","canLayoutStraight","targetOrientation","getSegmentBendpoints","xmid","ymid","segmentDirections","layoutStraight","layoutHorizontal","layoutTurn","turnNextDirections","getBendpoints","getStartSegment","getEndSegment","invertedSegment","invertDirections","getMidSegment","startSegment","endSegment","endDirection","bendpoints","getSimpleBendpoints","isValidDirections","isExplicitDirections","connectPoints","withoutRedundantPoints","connectRectangles","preferredLayouts","preferredLayout","getDirections","directionSplit","startDocking","getDockingPoint","invertOrientation","endDocking","repairConnection","preferStraight","repairedWaypoints","tryLayoutStraight","tryRepairConnectionEnd","tryRepairConnectionStart","inRange","isInRange","primaryAxis","newDocking","_tryRepairConnectionSide","needsRelayout","repairBendpoint","candidate","oldPeer","newPeer","removeOverlapping","oldDocking","newPoints","slicedPoints","defaultLayout","rectangle","dockingDirection","previous","ATTACH_ORIENTATION_PADDING","BOUNDARY_TO_HOST_THRESHOLD","PREFERRED_LAYOUTS_HORIZONTAL","PREFERRED_LAYOUTS_VERTICAL","oppositeOrientationMapping","orientationDirectionMapping","BpmnLayouter","manhattanOptions","updatedWaypoints","getConnectionDocking","isCompensationAssociation","layout","getMessageFlowManhattanOptions","getLoopPreferredLayout","getBoundaryEventPreferredLayouts","isExpandedSubProcess","getSubProcessPreserveDocking","getAttachOrientation","attachedElement","getMessageFlowPreserveDocking","isAnyOrientation","orientations","getHorizontalOrientation","getVerticalOrientation","isOppositeOrientation","isOppositeHorizontalOrientation","horizontalOrientation","oppositeHorizontalOrientation","isOppositeVerticalOrientation","verticalOrientation","oppositeVerticalOrientation","isHorizontalOrientation","attachOrientation","sourceLayout","targetLayout","isLoop","attachedToSide","getBoundaryEventLoopLayout","getBoundaryEventSourceLayout","getBoundaryEventTargetLayout","shouldConnectToSameSide","areCloseOnAxis","verticalAttachOrientation","horizontalAttachOrientation","verticalTargetOrientation","horizontalTargetOrientation","dockingToPoint","CroppingConnectionDocking","sourceDocking","targetDocking","dockStart","dockingIdx","croppedPoint","takeFirst","ModelingModule","AppendPreview","complexPreview","connectionCreateAllowed","AppendPreviewModule","isTextNode","toArray","nodeList","TextBox","content","parentStyle","contentStyle","hasResized","normalizeEndOfLineSequences","success","startContainer","endContainer","startOffset","endOffset","commonAncestorContainer","childNodesArray","containerTextContent","textNode","startContainerChildIndex","endContainerChildIndex","childNode","resizeHandle","minWidth","minHeight","maxHeight","startX","startY","startWidth","startHeight","onMouseDown","onMouseMove","onMouseUp","newWidth","newHeight","DirectEditing","active","previousBounds","newText","previousText","DirectEditingModule","isDifferentType","isTypeEqual","isEventDefinitionEqual","isTriggeredByEventEqual","isExpandedEqual","START_EVENT","START_EVENT_SUB_PROCESS","INTERMEDIATE_EVENT","END_EVENT","GATEWAY","SUBPROCESS_EXPANDED","TRANSACTION","EVENT_SUB_PROCESS","TASK","DATA_OBJECT_REFERENCE","DATA_STORE_REFERENCE","BOUNDARY_EVENT","EVENT_SUB_PROCESS_START_EVENT","SEQUENCE_FLOW","PARTICIPANT","Icons","ReplaceMenuProvider","filteredReplaceOptions","differentType","replaceOptions.DATA_OBJECT_REFERENCE","replaceOptions.DATA_STORE_REFERENCE","replaceOptions.START_EVENT","replaceOptions.PARTICIPANT","replaceOption","replaceOptions.EVENT_SUB_PROCESS_START_EVENT","isInterruptingEqual","replaceOptions.START_EVENT_SUB_PROCESS","replaceOptions.END_EVENT","replaceOptions.BOUNDARY_EVENT","isCancelActivityEqual","replaceOptions.INTERMEDIATE_EVENT","replaceOptions.GATEWAY","replaceOptions.TRANSACTION","replaceOptions.EVENT_SUB_PROCESS","replaceOptions.SUBPROCESS_EXPANDED","replaceOptions.TASK","isTargetSubProcess","isTargetExpanded","replaceOptions.SEQUENCE_FLOW","replaceOptions","conditionExpression","replaceAction","toggleLoopEntry","currentLoopCharacteristics","newLoopCharacteristics","isParallel","toggleIsCollection","toggleParticipantMultiplicity","isActive","participantMultiplicity","isAdHoc","interruptingProperty","icon","isNonInterrupting","ContextPadProvider","appendPreview","baseAllowed","autoPlace","startConnect","getReplaceMenuPosition","appendAction","appendStart","previewAppend","splitLaneHandler","isEventType","deleteAllowed","isType","isDefinition","def","AXIS_DIMENSIONS","filterFn","distributableElements","filters","rangeGroups","elementRange","rangeA","rangeB","DistributeElementsModule$1","BpmnDistributeElements","cannotDistribute","DistributeElementsMenuProvider","distributeElements","DistributeElementsModule","NOT_REGISTERED_ERROR","IS_REGISTERED_ERROR","EditorActions","zoomScroll","copyPaste","keyboardMove","keyboardMoveSelection","removableElements","EditorActionsModule$1","BpmnEditorActions","lassoTool","handTool","globalConnect","directEditing","searchPad","currentSelection","aligneableElements","boundingBox","EditorActionsModule","BpmnGridSnapping","SPACING","quantize","quantum","GridSnapping","gridSnappingContext","snapOffset","getSnapOffset","snapConstraints","getSnapConstraints","snappedValue","minResizeConstraints","maxResizeConstraints","isWest","isNorth","snapLocation","gridSnapping","west","east","snappedNewBounds","north","south","GridSnappingBehaviorModule$1","GridSnappingModule$1","GridSnappingBehaviorModule","GridSnappingAutoPlaceBehavior","HIGHER_PRIORITY","GridSnappingParticipantBehavior","GridSnappingLayoutConnectionBehavior","hasMiddleSegments","snapSegment","horizontallyAligned","verticallyAligned","GridSnappingModule","LABEL_WIDTH","LABEL_HEIGHT","BpmnInteractionEvents","BpmnKeyboardBindings","LEFT","UP","RIGHT","DOWN","KEY_TO_DIRECTION","DIRECTIONS_DELTA","KeyboardMoveSelection","keyEvent","accelerated","KeyboardMoveSelectionModule","DEFAULT_MIN_WIDTH","Resize","contextOrDirection","getCursor","MARKER_RESIZE_NOT_OK","ResizePreview","updateFrame","removeFrame","HANDLE_OFFSET","HANDLE_SIZE","HANDLE_HIT_SIZE","CLS_RESIZER","ResizeHandles","startResize","resizersParent","getHandleOffset","resizer","ResizeModule","LabelEditingProvider","resizeHandles","activateDirectEdit","externalFontSize","externalLineHeight","defaultFontSize","defaultLineHeight","isExpandedPool","isHorizontalPool","poolBounds","paddingBottom","externalLabelMid","absoluteBBox","activeContextText","MARKER_HIDDEN","MARKER_LABEL_HIDDEN","LabelEditingPreview","defaultLayer","absoluteElementBBox","activeProvider","newElementHeight","LabelEditingModule","tooltipClass","tooltipSelector","Tooltips","tooltip","removeTimer","tooltipRoot","TooltipsModule","COLLAB_ERR_MSG","ModelingFeedback","tooltips","showError","ModelingFeedbackModule","MEDIUM_PRIORITY","MoveEvents","removeNested","isAttach","MovePreview","getVisualDragShapes","getAllDraggedElements","removeEdges","makeDraggable","dragShapes","allDraggedElements","visuallyDraggedShapes","haveDifferentParents","MoveModule","Move","TOGGLE_SELECTOR","ENTRY_SELECTOR","PALETTE_PREFIX","PALETTE_SHOWN_CLS","PALETTE_OPEN_CLS","PALETTE_TWO_COLUMN_CLS","Palette","addPaletteEntries","parentContainer","state","twoColumn","parentCls","entriesContainer","availableHeight","entriesHeight","toolsContainer","actionName","toolClasses","actualClassNames","PaletteModule$1","LASSO_TOOL_CURSOR","LassoTool","toBBox","LassoToolModule","HAND_CURSOR","HandTool","isSpace","HandToolModule","GlobalConnect","startTarget","canStartConnect","GlobalConnectModule","PaletteProvider","palette","createAction","createListener","createSubprocess","startEvent","createParticipant","PaletteModule","BpmnReplacePreview","replaceVisual","tempShape","cssEscape","restoreVisual","visualReplacements","originalGfx","ReplacePreviewModule","TARGET_BOUNDS_PADDING","TASK_BOUNDS_PADDING","TARGET_CENTER_PADDING","AXES","BpmnConnectSnapping","snapToShape","getTargetBoundsPadding","isAnyType","snapToPosition","snapToTargetMid","snapBoundaryEventLoop","dimensionForAxis","getDimensionForAxis","isMid","axes","coordinate","newCoordinate","SnapContext","snapOrigin","snapValues","snapLocations","targetId","SnapPoints","snappingValues","defaultSnaps","CreateMoveSnapping","snapping","snapContext","shapeTopLeft","shapeBottomRight","snapTargets","snapTarget","BpmnCreateMoveSnapping","setSnappedIfConstrained","snapBoundaryEvent","isMove","getDockingSnapOrigin","isContainer","areAll","targetTRBL","ResizeSnapping","isVertical","getSnapOrigin","isAttached","SNAP_TOLERANCE","SNAP_LINE_HIDE_DELAY","Snapping","snapCurrent","locationSnapping","axisSnapping","snapLine","SnappingModule$1","SnappingModule","SearchPad","listen","searchResults","nodeOffset","containerScroll","bottomScroll","createInnerTextNode","selectedNode","constructOverlay","input","tokens","createHtmlText","htmlText","SearchPadModule","BpmnSearchProvider","matchAndSplit","hasMatched","matched","token","originalText","SearchModule","initialDiagram","Modeler","defaultBpmnXml","deepMerge","_source","camelToKebabCase","letter","getTransformedScaledValue","transformedValue","scaleRem","remValue","createConverter","units","replaced","em","filterProps","acc","isNumberLike","getSize","convertToRem","getRadius","getFontSize","attachMediaListener","getInitialValue","initialValue","useMediaQuery","getInitialValueInEffect","setMatches","queryRef","useIsomorphicEffect","useDidUpdate","mounted","useReducedMotion","EMPTY_CLASS_NAMES","mergeClassNames","objects","merged","resolveClassNames","theme","stylesCtx","resolvedClassNames","resolveStyles","MantineContext","createContext","useMantineContext","useContext","useMantineCssVariablesResolver","useMantineClassNamesPrefix","useMantineStyleNonce","useMantineWithStaticClasses","useMantineIsHeadless","useMantineSxTransform","useMantineStylesTransform","isHexColor","hex","hexToRgba","hexString","shorthandHex","alpha","rgbStringToRgba","hslStringToRgba","hslaString","hslaRegex","chroma","huePrime","toRgba","darken","dark","getPrimaryShade","colorScheme","gammaCorrect","getLightnessFromOklch","oklchColor","luminance","sR","sG","sB","rLinear","gLinear","bLinear","isLightColor","luminanceThreshold","parseThemeColor","_color","shade","colorShade","isThemeColor","colorValue","getThemeColor","getGradient","gradient","fromColor","toColor","rgba","alpha2","mixPercentage","defaultVariantColorsResolver","variant","autoContrast","_autoContrast","textColor","parsedColor","DEFAULT_FONT_FAMILY","DEFAULT_THEME","isMantineColorScheme","localStorageColorSchemeManager","handleStorageEvent","storedColorScheme","onUpdate","INVALID_PRIMARY_COLOR_ERROR","INVALID_PRIMARY_SHADE_ERROR","isValidPrimaryShade","validateMantineTheme","mergeMantineTheme","currentTheme","themeOverride","MantineThemeContext","useSafeMantineTheme","useMantineTheme","MantineThemeProvider","inherit","parentTheme","mergedTheme","MantineClasses","nonce","breakpoint","isPxBreakpoint","pxValue","maxWidthBreakpoint","minWidthBreakpoint","cssVariablesObjectToString","variables","wrapWithSelector","selectors","code","convertCssVariables","sharedVariables","shared","darkForced","light","lightForced","getContrastColor","getPrimaryContrastColor","getCSSColorVariables","withColorValues","primaryShade2","dynamicVariables2","primaryShade","dynamicVariables","isVirtualColor","assignSizeVariables","sizes","defaultCssVariablesResolver","lightPrimaryShade","defaultRadius","headings","heading","getMergedVariables","generator","defaultResolver","providerGenerator","defaultCssVariables","removeDefaultVariables","cleaned","getColorSchemeCssVariables","MantineCssVariables","cssVariablesSelector","deduplicateCssVariables","mergedVariables","shouldCleanVariables","cleanedVariables","css","suppressNextjsWarning","originalError","setColorSchemeAttribute","computedColorScheme","useProviderColorScheme","manager","defaultColorScheme","forceColorScheme","media","colorSchemeValue","setColorScheme","clearColorScheme","useRespectReduceMotion","respectReducedMotion","MantineProvider","getStyleNonce","withStaticClasses","withGlobalClasses","withCssVariables","classNamesPrefix","colorSchemeManager","cssVariablesResolver","stylesTransform","FOCUS_CLASS_NAMES","getGlobalClassNames","unstyled","getOptionsClassNames","getResolvedClassNames","getRootClassName","rootSelector","getSelectorClassName","getStaticClassNames","themeName","withStaticClass","getThemeClassNames","_b","getVariantClassName","getClassName","headless","transformedStyles","getThemeStyles","resolveStyle","mergeVars","vars","resolveVars","varsResolver","_c","getStyle","withStylesTransform","useStylesTransform","useStyles","getTransformedStyles","useProps","component","contextPropsPayload","contextProps","cssObjectToString","rule","stylesToString","baseStyles","mediaQueryStyles","InlineStyles","extractStyleProps","mb","ml","mr","me","ms","pt","pb","pl","pr","pe","bg","opacity","ff","fz","fw","lts","ta","lh","fs","tt","td","miw","maw","mih","mah","bgsz","bgp","bgr","bga","inset","display","flex","hiddenFrom","visibleFrom","lightHidden","darkHidden","rest","STYlE_PROPS_DATA","colorResolver","textColorResolver","fontFamilyResolver","fontFamily","fontSizeResolver","identityResolver","lineHeightResolver","sizeResolver","spacingResolver","mod","variable","resolvers","replaceMediaQuery","sortMediaQueries","sortedMedia","hasResponsiveStyles","styleProp","breakpoints","getBaseValue","getBreakpointKeys","getBreakpointValue","parseStyleProps","styleProps","propertyData","baseValue","bp","useRandomClassName","useId","transformModKey","getMod","getBoxMod","mergeStyles","getBoxStyle","_style","_vars","_Box","forwardRef","__vars","renderRoot","Element","useSxTransform","transformedSx","responsiveClassName","parsedStyleProps","Fragment","Box","factory","ui","polymorphicFactory","UnstyledButton","_props","__staticSelector","getStyles","popIn","from","transitions","transitionStatuses","getTransitionStyles","transition","duration","timingFunction","useTransition","exitDuration","onEnter","onExit","onEntered","onExited","shouldReduceMotion","reduceMotion","transitionDuration","setTransitionDuration","transitionStatus","setStatus","timeoutRef","rafRef","handleStateChange","shouldMount","preHandler","newTransitionDuration","ReactDOM","Transition","keepMounted","transitionTimingFunction","Bars","Dots","Oval","defaultLoaders","Loader","loaders","borderWidth","ButtonGroup","loaderTransition","justify","Button","disabled","leftSection","rightSection","fullWidth","loading","loaderProps","dataDisabled","hasLeftSection","hasRightSection","transitionStyles","defaultAttributes","createReactComponent","iconName","iconNamePascal","iconNode","createElement","IconViewfinder","IconZoomIn","IconZoomOut","ZoomActions","BpmnJsModeler","zoomActions","onLoading","onShown","click","dbclick","containerRef","bpmnEditor","setBpmnEditor","selectedElement","setSelectedElement","newModeler","BpmnModeler","useImperativeHandle","BpmnJSModeler","this","E","R","W","G","K","U","Z","J","Q","ee","te","ne","ie","oe","ae","le","ce","ue","he","fe","de","ye","ge","ve","xe","be","we","Ee","_e","Ae","ke","Re","Se","Ce","Me","Pe","De","Te","Ne","Oe","Be","Le","Ie","je","Fe","Ve","We","ze","$e","Ge","He","Ke","Ue","qe","Ye","Xe","Je","Ze","Qe","et","nt","it","rt","ot","at","st","lt","se","ut","ht","ft","yt","dt","gt","vt","xt","bt","wt","Et","_t","At","kt","Rt","St","Ct","Mt","Pt","Dt","Nt","Tt","Ot","Bt","Lt","It","jt","Ft","Vt","Wt","zt","$t","Gt","Ht","Kt","Ut","qt","Yt","Xt","Zt","Jt","Qt","en","tn","nn","rn","on","an","sn","ln","pn","cn","un","hn","mn","dn","yn","gn","vn","xn","bn","wn","En","_n","An","kn","Rn","Sn","Cn","Mn","Pn","Dn","Nn","Tn","On","Bn","Ln","In","jn","Fn","Vn","Wn","zn","$n","Gn","Hn","Kn","Un","qn","Yn","Xn","Zn","Jn","Qn","ei","ti","ni","ri","oi","ai","si","li","hi","fi","mi","yi","gi","vi","xi","bi","wi","Ei","_i","Ai","ki","Ri","Si","Ci","Mi","Pi","Di","Ni","Ti","Oi","Bi","Li","Ii","ji","Fi","Vi","Wi","zi","$i","Gi","Hi","Ki","Ui","qi","Yi","Xi","Zi","Ji","Qi","er","tr","nr","ir","rr","or","ar","sr","lr","ur","hr","fr","dr","yr","gr","vr","xr","br","wr","Er","_r","Ar","kr","Rr","Sr","Cr","Mr","Pr","Dr","Nr","Tr","Or","Br","Lr","Ir","jr","Fr","Vr","Wr","zr","$r","Gr","Hr","Kr","Ur","qr","Yr","Xr","Zr","Qr","Jr","eo","to","no","io","ro","oo","ao","so","lo","po","co","uo","ho","fo","mo","yo","go","vo","xo","wo","Eo","_o","Ao","ko","Ro","So","Co","Mo","Po","BpmnJsViewer","bpmnViewer","setBpmnViewer","BpmnViewer","BpmnJsViewer$1","BpmnJsReact","BpmnJsReact$1"],"mappings":"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","x_google_ignoreList":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,484]}